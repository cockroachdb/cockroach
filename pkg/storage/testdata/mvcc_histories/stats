# Tests MVCC stats calculations.

run stats trace
put k=a ts=2 v=a2
del k=a ts=4
del k=b ts=4
put k=d ts=2 v=d2
put k=d ts=4 v=d4
put k=i ts=0 v=inline
with t=A
  txn_begin ts=7
  put k=d v=d7
  put k=j v=j7
----
>> put k=a ts=2 v=a2
stats: live_bytes:+21 live_count:+1 key_bytes:+14 key_count:+1 val_bytes:+7 val_count:+1
data: "a"/2.000000000,0 -> /BYTES/a2
>> del k=a ts=4
stats: live_bytes:-21 live_count:-1 key_bytes:+12 val_count:+1
data: "a"/4.000000000,0 -> /<empty>
data: "a"/2.000000000,0 -> /BYTES/a2
>> del k=b ts=4
stats: key_bytes:+14 key_count:+1 val_count:+1
data: "a"/4.000000000,0 -> /<empty>
data: "a"/2.000000000,0 -> /BYTES/a2
data: "b"/4.000000000,0 -> /<empty>
>> put k=d ts=2 v=d2
stats: live_bytes:+21 live_count:+1 key_bytes:+14 key_count:+1 val_bytes:+7 val_count:+1
data: "a"/4.000000000,0 -> /<empty>
data: "a"/2.000000000,0 -> /BYTES/a2
data: "b"/4.000000000,0 -> /<empty>
data: "d"/2.000000000,0 -> /BYTES/d2
>> put k=d ts=4 v=d4
stats: key_bytes:+12 val_bytes:+7 val_count:+1
data: "a"/4.000000000,0 -> /<empty>
data: "a"/2.000000000,0 -> /BYTES/a2
data: "b"/4.000000000,0 -> /<empty>
data: "d"/4.000000000,0 -> /BYTES/d4
data: "d"/2.000000000,0 -> /BYTES/d2
>> put k=i ts=0 v=inline
stats: live_bytes:+27 live_count:+1 key_bytes:+2 key_count:+1 val_bytes:+25 val_count:+1
data: "a"/4.000000000,0 -> /<empty>
data: "a"/2.000000000,0 -> /BYTES/a2
data: "b"/4.000000000,0 -> /<empty>
data: "d"/4.000000000,0 -> /BYTES/d4
data: "d"/2.000000000,0 -> /BYTES/d2
meta: "i"/0,0 -> txn={<nil>} ts=0,0 del=false klen=0 vlen=0 raw=/BYTES/inline mergeTs=<nil> txnDidNotUpdateMeta=false
>> txn_begin ts=7 t=A
stats: 
txn: "A" meta={id=00000000 key=/Min pri=0.00000000 epo=0 ts=7.000000000,0 min=0,0 seq=0} lock=true stat=PENDING rts=7.000000000,0 wto=false gul=0,0
>> put k=d v=d7 t=A
called PutIntent("d", _, 00000000-0000-0000-0000-000000000001)
stats: live_bytes:+48 key_bytes:+12 val_bytes:+55 val_count:+1 intent_bytes:+19 intent_count:+1 separated_intent_count:+1
data: "a"/4.000000000,0 -> /<empty>
data: "a"/2.000000000,0 -> /BYTES/a2
data: "b"/4.000000000,0 -> /<empty>
meta: "d"/0,0 -> txn={id=00000000 key=/Min pri=0.00000000 epo=0 ts=7.000000000,0 min=0,0 seq=0} ts=7.000000000,0 del=false klen=12 vlen=7 mergeTs=<nil> txnDidNotUpdateMeta=true
data: "d"/7.000000000,0 -> /BYTES/d7
data: "d"/4.000000000,0 -> /BYTES/d4
data: "d"/2.000000000,0 -> /BYTES/d2
meta: "i"/0,0 -> txn={<nil>} ts=0,0 del=false klen=0 vlen=0 raw=/BYTES/inline mergeTs=<nil> txnDidNotUpdateMeta=false
>> put k=j v=j7 t=A
called PutIntent("j", _, 00000000-0000-0000-0000-000000000001)
stats: live_bytes:+69 live_count:+1 key_bytes:+14 key_count:+1 val_bytes:+55 val_count:+1 intent_bytes:+19 intent_count:+1 separated_intent_count:+1
data: "a"/4.000000000,0 -> /<empty>
data: "a"/2.000000000,0 -> /BYTES/a2
data: "b"/4.000000000,0 -> /<empty>
meta: "d"/0,0 -> txn={id=00000000 key=/Min pri=0.00000000 epo=0 ts=7.000000000,0 min=0,0 seq=0} ts=7.000000000,0 del=false klen=12 vlen=7 mergeTs=<nil> txnDidNotUpdateMeta=true
data: "d"/7.000000000,0 -> /BYTES/d7
data: "d"/4.000000000,0 -> /BYTES/d4
data: "d"/2.000000000,0 -> /BYTES/d2
meta: "i"/0,0 -> txn={<nil>} ts=0,0 del=false klen=0 vlen=0 raw=/BYTES/inline mergeTs=<nil> txnDidNotUpdateMeta=false
meta: "j"/0,0 -> txn={id=00000000 key=/Min pri=0.00000000 epo=0 ts=7.000000000,0 min=0,0 seq=0} ts=7.000000000,0 del=false klen=12 vlen=7 mergeTs=<nil> txnDidNotUpdateMeta=true
data: "j"/7.000000000,0 -> /BYTES/j7
stats: {
  contains_estimates:0
  last_update_nanos:1000000000000
  intent_age:1986
  gc_bytes_age:84603
  live_bytes:165
  live_count:3
  key_bytes:94
  key_count:5
  val_bytes:156
  val_count:8
  intent_bytes:38
  intent_count:2
  separated_intent_count:2
  sys_bytes:0
  sys_count:0
  abort_span_bytes:0
}
