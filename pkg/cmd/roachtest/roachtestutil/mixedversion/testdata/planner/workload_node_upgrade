# Tests that workload node get's upgraded after a version upgrade
mixed-version-test-with-workload
----
ok

workload name=bank
----
ok

plan
----
Seed:               12345
Upgrades:           v24.2.2 → <current>
Deployment mode:    system-only
Plan:
├── start cluster at version "v24.2.2" (1)
├── wait for all nodes (:1-4) to acknowledge cluster version '24.2' on system tenant (2)
├── stage workload binary on workload node(s) :1 for version(s) v24.2.2, <current> (3)
├── run "initialize bank workload" (4)
├── run "bank workload" (5)
└── upgrade cluster from "v24.2.2" to "<current>"
   ├── prevent auto-upgrades on system tenant by setting `preserve_downgrade_option` (6)
   ├── upgrade nodes :1-4 from "v24.2.2" to "<current>"
   │   ├── restart node 1 with binary version <current> (7)
   │   ├── restart node 4 with binary version <current> (8)
   │   ├── restart node 3 with binary version <current> (9)
   │   └── restart node 2 with binary version <current> (10)
   ├── downgrade nodes :1-4 from "<current>" to "v24.2.2"
   │   ├── restart node 4 with binary version v24.2.2 (11)
   │   ├── restart node 2 with binary version v24.2.2 (12)
   │   ├── restart node 3 with binary version v24.2.2 (13)
   │   └── restart node 1 with binary version v24.2.2 (14)
   ├── upgrade nodes :1-4 from "v24.2.2" to "<current>"
   │   ├── restart node 4 with binary version <current> (15)
   │   ├── restart node 1 with binary version <current> (16)
   │   ├── restart node 2 with binary version <current> (17)
   │   └── restart node 3 with binary version <current> (18)
   ├── allow upgrade to happen on system tenant by resetting `preserve_downgrade_option` (19)
   └── wait for all nodes (:1-4) to acknowledge cluster version <current> on system tenant (20)
