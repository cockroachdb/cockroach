# Tests that workload node get's upgraded after a version upgrade
mixed-version-test workload_node=(5)
----
ok

plan
----
Seed:               12345
Upgrades:           v24.2.2 → <current>
Deployment mode:    system-only
Plan:
├── install fixtures for version "v24.2.2" (1)
├── start cluster at version "v24.2.2" (2)
├── wait for all nodes (:1-4) to acknowledge cluster version '24.2' on system tenant (3)
├── stage workload binary on workload node(s) :5 for version(s) v24.2.2, <current> (4)
└── upgrade cluster from "v24.2.2" to "<current>"
   ├── prevent auto-upgrades on system tenant by setting `preserve_downgrade_option` (5)
   ├── upgrade nodes :1-4 from "v24.2.2" to "<current>"
   │   ├── restart node 1 with binary version <current> (6)
   │   ├── restart node 4 with binary version <current> (7)
   │   ├── restart node 3 with binary version <current> (8)
   │   └── restart node 2 with binary version <current> (9)
   ├── downgrade nodes :1-4 from "<current>" to "v24.2.2"
   │   ├── restart node 4 with binary version v24.2.2 (10)
   │   ├── restart node 2 with binary version v24.2.2 (11)
   │   ├── restart node 3 with binary version v24.2.2 (12)
   │   └── restart node 1 with binary version v24.2.2 (13)
   ├── upgrade nodes :1-4 from "v24.2.2" to "<current>"
   │   ├── restart node 4 with binary version <current> (14)
   │   ├── restart node 1 with binary version <current> (15)
   │   ├── restart node 2 with binary version <current> (16)
   │   └── restart node 3 with binary version <current> (17)
   ├── allow upgrade to happen on system tenant by resetting `preserve_downgrade_option` (18)
   └── wait for all nodes (:1-4) to acknowledge cluster version <current> on system tenant (19)
