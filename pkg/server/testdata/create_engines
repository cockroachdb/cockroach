store-spec name=a
in-memory
----

store-spec name=b
in-memory
----

# 64 MiB cache; should result in 4 memtable stop writes threshold.

create-engines specs=(a,b) pattern=mem_table_stop_writes_threshold CacheSize=67108864
----
  mem_table_stop_writes_threshold=4
  mem_table_stop_writes_threshold=4

create-engines specs=(a) pattern=mem_table_stop_writes_threshold CacheSize=67108864
----
  mem_table_stop_writes_threshold=4

# 1 GiB cache; should result in 8 memtable stop writes threshold with a single
# store (with 64 MiB memtables).

create-engines specs=(b) pattern=mem_table_stop_writes_threshold CacheSize=1073741824
----
  mem_table_stop_writes_threshold=8

# But if we add another store, the memtable stop writes threshold should be
# halved back to the minimum of 4.

create-engines specs=(a, b) pattern=mem_table_stop_writes_threshold CacheSize=1073741824
----
  mem_table_stop_writes_threshold=4
  mem_table_stop_writes_threshold=4

# 64 GiB cache; should result in 16 memtable stop writes threshold.

create-engines specs=(a,b) pattern=mem_table_stop_writes_threshold CacheSize=68719476736
----
  mem_table_stop_writes_threshold=16
  mem_table_stop_writes_threshold=16
