new-server name=s1
----

exec-sql
CREATE DATABASE d;
CREATE TABLE d.t (x INT);
INSERT INTO d.t VALUES (1), (2), (3);
----

# Test running backup when Bulk IO category feature flags are disabled.
exec-sql
SET CLUSTER SETTING feature.bulkio.enabled = FALSE;
BACKUP TO 'nodelocal://0/test-root/';
----
pq: features in the Bulk IO category were disabled by the database administrator

# Test running backup when BACKUP feature flag is disabled and Bulk IO category is enabled.
exec-sql
SET CLUSTER SETTING feature.bulkio.enabled = TRUE;
SET CLUSTER SETTING feature.bulkio.backup.enabled = FALSE;
BACKUP TO 'nodelocal://0/test-root/';
----
pq: BACKUP feature was disabled by the database administrator

# Test running backup when feature flag is enabled.
exec-sql
SET CLUSTER SETTING feature.bulkio.backup.enabled = TRUE;
BACKUP TO 'nodelocal://0/test-root/';
----

exec-sql
DROP TABLE d.t;
----

# Test running restore when Bulk IO category feature flags are disabled.
exec-sql
SET CLUSTER SETTING feature.bulkio.enabled = FALSE;
RESTORE TABLE d.t FROM 'nodelocal://0/test-root/';
----
pq: features in the Bulk IO category were disabled by the database administrator

# Test running restore when feature flag is disabled and Bulk IO category is enabled.
exec-sql
SET CLUSTER SETTING feature.bulkio.enabled = TRUE;
SET CLUSTER SETTING feature.bulkio.restore.enabled = FALSE;
RESTORE TABLE d.t FROM 'nodelocal://0/test-root/';
----
pq: RESTORE feature was disabled by the database administrator

# Test running restore when feature flag is enabled.
exec-sql
SET CLUSTER SETTING feature.bulkio.restore.enabled = TRUE;
RESTORE TABLE d.t FROM 'nodelocal://0/test-root/';
----
