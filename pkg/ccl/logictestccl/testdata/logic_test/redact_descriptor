# NB: "Xw==" is the byte representation of "_", which is what we use to redact fields. 
statement ok
CREATE TABLE collate_partition (a STRING COLLATE da PRIMARY KEY) PARTITION BY RANGE (a) (
    PARTITION p1 VALUES FROM ('x' COLLATE da) TO ('Ã¼' COLLATE da)
)

SELECT jsonb_pretty(
        crdb_internal.pb_to_json(
            'desc',
            crdb_internal.redact_descriptor(descriptor)
        )
       )
  FROM system.descriptor
 WHERE id = 'collate_partition'::REGCLASS;
----
{
  "table": {
      "columns": [
          {
              "id": 1,
              "name": "a",
              "type": {
                  "family": "CollatedStringFamily",
                  "locale": "da",
                  "oid": 25
              }
          }
      ],
      "createAsOfTime": {},
      "families": [
          {
              "columnIds": [
                  1
              ],
              "columnNames": [
                  "a"
              ],
              "name": "primary"
          }
      ],
      "formatVersion": 3,
      "id": 120,
      "modificationTime": {},
      "name": "collate_partition",
      "nextColumnId": 2,
      "nextConstraintId": 2,
      "nextFamilyId": 1,
      "nextIndexId": 2,
      "nextMutationId": 1,
      "parentId": 115,
      "primaryIndex": {
          "compositeColumnIds": [
              1
          ],
          "constraintId": 1,
          "createdAtNanos": "1663004614583092000",
          "encodingType": 1,
          "foreignKey": {},
          "geoConfig": {},
          "id": 1,
          "interleave": {},
          "keyColumnDirections": [
              "ASC"
          ],
          "keyColumnIds": [
              1
          ],
          "keyColumnNames": [
              "a"
          ],
          "name": "collate_partition_pkey",
          "partitioning": {
              "numColumns": 1,
              "range": [
                  {
                      "fromInclusive": "Xw==",
                      "name": "p1",
                      "toExclusive": "Xw=="
                  }
              ]
          },
          "sharded": {},
          "unique": true,
          "version": 4
      },
      "privileges": {
          "ownerProto": "root",
          "users": [
              {
                  "privileges": 2,
                  "userProto": "admin",
                  "withGrantOption": 2
              },
              {
                  "privileges": 2,
                  "userProto": "root",
                  "withGrantOption": 2
              }
          ],
          "version": 2
      },
      "replacementOf": {
          "time": {}
      },
      "unexposedParentSchemaId": 116,
      "version": "1"
  }
}

statement ok
CREATE TABLE subpartition (
  a INT, b INT, c INT,
  PRIMARY KEY (a, b),
  FAMILY "primary" (a, b, c)
)
  PARTITION BY LIST (a)
    (
      PARTITION p1
        VALUES IN (1)
        PARTITION BY LIST (b)
          (
            PARTITION p1_1 VALUES IN (1),
            PARTITION p1_2 VALUES IN (DEFAULT)
          ),
      PARTITION p2
        VALUES IN (2)
        PARTITION BY LIST (b)
          (PARTITION p2_1 VALUES IN (3)),
      PARTITION p3 VALUES IN (DEFAULT)
    )

SELECT jsonb_pretty(
        crdb_internal.pb_to_json(
            'desc',
            crdb_internal.redact_descriptor(descriptor)
        )
       )
  FROM system.descriptor
 WHERE id = 'subpartition'::REGCLASS;
----
{
  "table": {
      "columns": [
          {
              "id": 1,
              "name": "a",
              "type": {
                  "family": "IntFamily",
                  "oid": 20,
                  "width": 64
              }
          },
          {
              "id": 2,
              "name": "b",
              "type": {
                  "family": "IntFamily",
                  "oid": 20,
                  "width": 64
              }
          },
          {
              "id": 3,
              "name": "c",
              "nullable": true,
              "type": {
                  "family": "IntFamily",
                  "oid": 20,
                  "width": 64
              }
          }
      ],
      "createAsOfTime": {},
      "families": [
          {
              "columnIds": [
                  1,
                  2,
                  3
              ],
              "columnNames": [
                  "a",
                  "b",
                  "c"
              ],
              "defaultColumnId": 3,
              "name": "primary"
          }
      ],
      "formatVersion": 3,
      "id": 121,
      "modificationTime": {},
      "name": "subpartition",
      "nextColumnId": 4,
      "nextConstraintId": 2,
      "nextFamilyId": 1,
      "nextIndexId": 2,
      "nextMutationId": 1,
      "parentId": 100,
      "primaryIndex": {
          "constraintId": 1,
          "createdAtNanos": "1663008685012302000",
          "encodingType": 1,
          "foreignKey": {},
          "geoConfig": {},
          "id": 1,
          "interleave": {},
          "keyColumnDirections": [
              "ASC",
              "ASC"
          ],
          "keyColumnIds": [
              1,
              2
          ],
          "keyColumnNames": [
              "a",
              "b"
          ],
          "name": "subpartition_pkey",
          "partitioning": {
              "list": [
                  {
                      "name": "p1",
                      "subpartitioning": {
                          "list": [
                              {
                                  "name": "p1_1",
                                  "subpartitioning": {},
                                  "values": [
                                      "Xw=="
                                  ]
                              },
                              {
                                  "name": "p1_2",
                                  "subpartitioning": {},
                                  "values": [
                                      "Xw=="
                                  ]
                              }
                          ],
                          "numColumns": 1
                      },
                      "values": [
                          "Xw=="
                      ]
                  },
                  {
                      "name": "p2",
                      "subpartitioning": {
                          "list": [
                              {
                                  "name": "p2_1",
                                  "subpartitioning": {},
                                  "values": [
                                      "Xw=="
                                  ]
                              }
                          ],
                          "numColumns": 1
                      },
                      "values": [
                          "Xw=="
                      ]
                  },
                  {
                      "name": "p3",
                      "subpartitioning": {},
                      "values": [
                          "Xw=="
                      ]
                  }
              ],
              "numColumns": 1
          },
          "sharded": {},
          "storeColumnIds": [
              3
          ],
          "storeColumnNames": [
              "c"
          ],
          "unique": true,
          "version": 4
      },
      "privileges": {
          "ownerProto": "root",
          "users": [
              {
                  "privileges": 2,
                  "userProto": "admin",
                  "withGrantOption": 2
              },
              {
                  "privileges": 2,
                  "userProto": "root",
                  "withGrantOption": 2
              }
          ],
          "version": 2
      },
      "replacementOf": {
          "time": {}
      },
      "unexposedParentSchemaId": 101,
      "version": "1"
  }
}