# LogicTest: multiregion-9node-3region-3azs multiregion-9node-3region-3azs-vec-off multiregion-9node-3region-3azs-tenant multiregion-9node-3region-3azs-no-los !metamorphic-batch-sizes

subtest hello

statement ok
CREATE DATABASE multi_region_test_db PRIMARY REGION "ca-central-1" REGIONS "ap-southeast-2", "us-east-1" SURVIVE REGION FAILURE

statement ok
USE multi_region_test_db

statement ok
SET experimental_enable_unique_without_index_constraints = true;

statement ok
SET CLUSTER SETTING feature.infer_rbr_region_col_using_constraint.enabled = true;

# NOTE: in a multiregion database, the default locality is REGIONAL BY TABLE in
# the primary region.
statement ok
CREATE TABLE parent_default (
  k INT PRIMARY KEY,
  v INT,
  region crdb_internal_region,
  UNIQUE WITHOUT INDEX (k, region)
);
INSERT INTO parent_default (k, v, region) (VALUES
  (1, 10, 'ca-central-1'),
  (2, 20, 'ap-southeast-2'),
  (3, 30, 'us-east-1'),
  (4, 40, 'ca-central-1'),
  (5, 50, 'ap-southeast-2'),
  (6, 60, 'us-east-1')
)


statement ok
CREATE TABLE parent_unique_nullable (
  x INT NOT NULL,
  y INT,
  UNIQUE (x, y),
  UNIQUE WITHOUT INDEX (x, y, crdb_region),
  FAMILY (x, y, crdb_region)
) LOCALITY REGIONAL BY ROW;
INSERT INTO parent_unique_nullable (x, y, crdb_region) (SELECT k, v, region FROM parent_default);

subtest end

