# LogicTest: 3node-tenant

# Show that the version setting for the tenant is set and has the proper value.

query B
SELECT version = crdb_internal.node_executable_version()
  FROM [SHOW CLUSTER SETTING version]
 WHERE EXISTS(SELECT * FROM system.settings WHERE name = 'version');
----
true

# This file documents operations that are supported when running a SQL tenant
# server. It's mostly a dumping ground for tests moved from tenant_unsupported.

statement ok
SHOW SESSIONS

statement ok
SHOW QUERIES

statement error could not cancel query 00000000000000000000000000000000: query ID 00000000000000000000000000000000 not found
CANCEL QUERY ''

statement error could not cancel session 00000000000000000000000000000000: session ID 00000000000000000000000000000000 not found
CANCEL SESSION ''

statement ok
SELECT * FROM crdb_internal.node_transactions

statement ok
SELECT * FROM crdb_internal.node_sessions

statement ok
SELECT * FROM crdb_internal.node_queries

statement ok
SELECT * FROM crdb_internal.node_contention_events

statement ok
SELECT * FROM crdb_internal.cluster_sessions

statement ok
SELECT * FROM crdb_internal.cluster_queries

statement ok
SELECT * FROM crdb_internal.cluster_contention_events

# Selecting from crdb_internal.zones is allowed.
query IITTTTTTTTTTTT
SELECT * FROM crdb_internal.zones
----
0  0  RANGE default  default  NULL  NULL  NULL  NULL  NULL  range_min_bytes: 134217728
range_max_bytes: 536870912
gc:
  ttlseconds: 90000
global_reads: null
num_replicas: 3
num_voters: null
constraints: []
voter_constraints: []
lease_preferences: []
  ALTER RANGE default CONFIGURE ZONE USING
  range_min_bytes = 134217728,
  range_max_bytes = 536870912,
  gc.ttlseconds = 90000,
  num_replicas = 3,
  constraints = '[]',
  lease_preferences = '[]'  [16 128 128 128 64 24 128 128 128 128 2 34 4 8 144 191 5 40 3 80 0 88 0 120 1]  range_min_bytes: 134217728
range_max_bytes: 536870912
gc:
  ttlseconds: 90000
global_reads: null
num_replicas: 3
num_voters: null
constraints: []
voter_constraints: []
lease_preferences: []
  ALTER RANGE default CONFIGURE ZONE USING
  range_min_bytes = 134217728,
  range_max_bytes = 536870912,
  gc.ttlseconds = 90000,
  num_replicas = 3,
  constraints = '[]',
  lease_preferences = '[]'

statement ok
CREATE TABLE t();

statement ok
ALTER TABLE t CONFIGURE ZONE USING num_replicas = 5;

query TT
SHOW ZONE CONFIGURATION FROM TABLE t
----
TABLE t  ALTER TABLE t CONFIGURE ZONE USING
         range_min_bytes = 134217728,
         range_max_bytes = 536870912,
         gc.ttlseconds = 90000,
         num_replicas = 5,
         constraints = '[]',
         lease_preferences = '[]'
