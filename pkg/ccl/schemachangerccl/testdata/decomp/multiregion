setup
CREATE DATABASE multi_region_test_db PRIMARY REGION "us-east1" REGIONS "us-east2", "us-east3" SURVIVE REGION FAILURE;
CREATE TABLE multi_region_test_db.public.table_regional_by_row (
  k INT PRIMARY KEY,
  v STRING
) LOCALITY REGIONAL BY ROW;
CREATE TABLE multi_region_test_db.public.table_regional_by_table (
  a INT
) LOCALITY REGIONAL BY TABLE IN "us-east2";
CREATE TABLE multi_region_test_db.public.table_global (b INT) LOCALITY GLOBAL;
COMMENT ON DATABASE multi_region_test_db IS 'multi region db is good';
COMMENT ON TABLE multi_region_test_db.public.table_regional_by_row IS 'regional by row is good';
COMMENT ON COLUMN multi_region_test_db.public.table_regional_by_row.k IS 'k is good';
COMMENT ON INDEX multi_region_test_db.public.table_regional_by_row@table_regional_by_row_pkey IS 'pkey is good';
----

decompose
multi_region_test_db
----
BackReferencedIDs:
  - 106
ElementState:
- Database:
    databaseId: 104
  Status: PUBLIC
- Namespace:
    databaseId: 0
    descriptorId: 104
    name: multi_region_test_db
    schemaId: 0
  Status: PUBLIC
- Owner:
    descriptorId: 104
    owner: root
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 104
    privileges: 2
    userName: admin
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 104
    privileges: 2
    userName: root
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 104
    privileges: 2048
    userName: public
  Status: PUBLIC
- DatabaseRegionConfig:
    databaseId: 104
    regionEnumTypeId: 105
  Status: PUBLIC
- DatabaseRoleSetting:
    databaseId: 104
    roleName: __placeholder_role_name__
  Status: PUBLIC
- DatabaseComment:
    comment: multi region db is good
    databaseId: 104
  Status: PUBLIC

decompose
table_global
----
BackReferencedIDs:
ElementState:
- Table:
    isTemporary: false
    tableId: 110
  Status: PUBLIC
- ColumnFamily:
    familyId: 0
    name: primary
    tableId: 110
  Status: PUBLIC
- Column:
    columnId: 1
    generatedAsIdentitySequenceOption: ""
    generatedAsIdentityType: 0
    isHidden: false
    isInaccessible: false
    isSystemColumn: false
    pgAttributeNum: 1
    tableId: 110
  Status: PUBLIC
- Column:
    columnId: 2
    generatedAsIdentitySequenceOption: ""
    generatedAsIdentityType: 0
    isHidden: true
    isInaccessible: false
    isSystemColumn: false
    pgAttributeNum: 2
    tableId: 110
  Status: PUBLIC
- Column:
    columnId: 4.294967294e+09
    generatedAsIdentitySequenceOption: ""
    generatedAsIdentityType: 0
    isHidden: true
    isInaccessible: false
    isSystemColumn: true
    pgAttributeNum: 4.294967294e+09
    tableId: 110
  Status: PUBLIC
- Column:
    columnId: 4.294967295e+09
    generatedAsIdentitySequenceOption: ""
    generatedAsIdentityType: 0
    isHidden: true
    isInaccessible: false
    isSystemColumn: true
    pgAttributeNum: 4.294967295e+09
    tableId: 110
  Status: PUBLIC
- PrimaryIndex:
    constraintId: 1
    indexId: 1
    isConcurrently: false
    isCreatedExplicitly: false
    isInverted: false
    isNotVisible: false
    isUnique: true
    sharding: null
    sourceIndexId: 0
    tableId: 110
    temporaryIndexId: 0
  Status: PUBLIC
- TableZoneConfig:
    tableId: 110
  Status: PUBLIC
- TableLocalityGlobal:
    tableId: 110
  Status: PUBLIC
- ColumnName:
    columnId: 1
    name: b
    tableId: 110
  Status: PUBLIC
- ColumnName:
    columnId: 2
    name: rowid
    tableId: 110
  Status: PUBLIC
- ColumnName:
    columnId: 4.294967294e+09
    name: tableoid
    tableId: 110
  Status: PUBLIC
- ColumnName:
    columnId: 4.294967295e+09
    name: crdb_internal_mvcc_timestamp
    tableId: 110
  Status: PUBLIC
- ColumnType:
    closedTypeIds: []
    columnId: 1
    computeExpr: null
    familyId: 0
    isNullable: true
    isRelationBeingDropped: false
    isVirtual: false
    tableId: 110
    type:
      arrayContents: null
      arrayDimensions: []
      arrayElemType: null
      family: IntFamily
      geoMetadata: null
      intervalDurationField: null
      locale: null
      oid: 20
      precision: 0
      timePrecisionIsSet: false
      tupleContents: []
      tupleLabels: []
      udtMetadata: null
      visibleType: 0
      width: 64
  Status: PUBLIC
- ColumnType:
    closedTypeIds: []
    columnId: 2
    computeExpr: null
    familyId: 0
    isNullable: false
    isRelationBeingDropped: false
    isVirtual: false
    tableId: 110
    type:
      arrayContents: null
      arrayDimensions: []
      arrayElemType: null
      family: IntFamily
      geoMetadata: null
      intervalDurationField: null
      locale: null
      oid: 20
      precision: 0
      timePrecisionIsSet: false
      tupleContents: []
      tupleLabels: []
      udtMetadata: null
      visibleType: 0
      width: 64
  Status: PUBLIC
- ColumnType:
    closedTypeIds: []
    columnId: 4.294967294e+09
    computeExpr: null
    familyId: 0
    isNullable: true
    isRelationBeingDropped: false
    isVirtual: false
    tableId: 110
    type:
      arrayContents: null
      arrayDimensions: []
      arrayElemType: null
      family: OidFamily
      geoMetadata: null
      intervalDurationField: null
      locale: null
      oid: 26
      precision: 0
      timePrecisionIsSet: false
      tupleContents: []
      tupleLabels: []
      udtMetadata: null
      visibleType: 0
      width: 0
  Status: PUBLIC
- ColumnType:
    closedTypeIds: []
    columnId: 4.294967295e+09
    computeExpr: null
    familyId: 0
    isNullable: true
    isRelationBeingDropped: false
    isVirtual: false
    tableId: 110
    type:
      arrayContents: null
      arrayDimensions: []
      arrayElemType: null
      family: DecimalFamily
      geoMetadata: null
      intervalDurationField: null
      locale: null
      oid: 1700
      precision: 0
      timePrecisionIsSet: false
      tupleContents: []
      tupleLabels: []
      udtMetadata: null
      visibleType: 0
      width: 0
  Status: PUBLIC
- ColumnDefaultExpression:
    columnId: 2
    expr: unique_rowid()
    referencedColumnIds: []
    tableId: 110
    usesSequenceIds: []
    usesTypeIds: []
  Status: PUBLIC
- IndexName:
    indexId: 1
    name: table_global_pkey
    tableId: 110
  Status: PUBLIC
- IndexColumn:
    columnId: 1
    direction: ASC
    indexId: 1
    kind: STORED
    ordinalInKind: 0
    tableId: 110
  Status: PUBLIC
- IndexColumn:
    columnId: 2
    direction: ASC
    indexId: 1
    kind: KEY
    ordinalInKind: 0
    tableId: 110
  Status: PUBLIC
- Namespace:
    databaseId: 104
    descriptorId: 110
    name: table_global
    schemaId: 106
  Status: PUBLIC
- Owner:
    descriptorId: 110
    owner: root
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 110
    privileges: 2
    userName: admin
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 110
    privileges: 2
    userName: root
  Status: PUBLIC
- ObjectParent:
    objectId: 110
    parentSchemaId: 106
  Status: PUBLIC

decompose
table_regional_by_table
----
BackReferencedIDs:
ElementState:
- Table:
    isTemporary: false
    tableId: 109
  Status: PUBLIC
- ColumnFamily:
    familyId: 0
    name: primary
    tableId: 109
  Status: PUBLIC
- Column:
    columnId: 1
    generatedAsIdentitySequenceOption: ""
    generatedAsIdentityType: 0
    isHidden: false
    isInaccessible: false
    isSystemColumn: false
    pgAttributeNum: 1
    tableId: 109
  Status: PUBLIC
- Column:
    columnId: 2
    generatedAsIdentitySequenceOption: ""
    generatedAsIdentityType: 0
    isHidden: true
    isInaccessible: false
    isSystemColumn: false
    pgAttributeNum: 2
    tableId: 109
  Status: PUBLIC
- Column:
    columnId: 4.294967294e+09
    generatedAsIdentitySequenceOption: ""
    generatedAsIdentityType: 0
    isHidden: true
    isInaccessible: false
    isSystemColumn: true
    pgAttributeNum: 4.294967294e+09
    tableId: 109
  Status: PUBLIC
- Column:
    columnId: 4.294967295e+09
    generatedAsIdentitySequenceOption: ""
    generatedAsIdentityType: 0
    isHidden: true
    isInaccessible: false
    isSystemColumn: true
    pgAttributeNum: 4.294967295e+09
    tableId: 109
  Status: PUBLIC
- PrimaryIndex:
    constraintId: 1
    indexId: 1
    isConcurrently: false
    isCreatedExplicitly: false
    isInverted: false
    isNotVisible: false
    isUnique: true
    sharding: null
    sourceIndexId: 0
    tableId: 109
    temporaryIndexId: 0
  Status: PUBLIC
- TableZoneConfig:
    tableId: 109
  Status: PUBLIC
- TableLocalitySecondaryRegion:
    regionEnumTypeId: 105
    regionName: us-east2
    tableId: 109
  Status: PUBLIC
- ColumnName:
    columnId: 1
    name: a
    tableId: 109
  Status: PUBLIC
- ColumnName:
    columnId: 2
    name: rowid
    tableId: 109
  Status: PUBLIC
- ColumnName:
    columnId: 4.294967294e+09
    name: tableoid
    tableId: 109
  Status: PUBLIC
- ColumnName:
    columnId: 4.294967295e+09
    name: crdb_internal_mvcc_timestamp
    tableId: 109
  Status: PUBLIC
- ColumnType:
    closedTypeIds: []
    columnId: 1
    computeExpr: null
    familyId: 0
    isNullable: true
    isRelationBeingDropped: false
    isVirtual: false
    tableId: 109
    type:
      arrayContents: null
      arrayDimensions: []
      arrayElemType: null
      family: IntFamily
      geoMetadata: null
      intervalDurationField: null
      locale: null
      oid: 20
      precision: 0
      timePrecisionIsSet: false
      tupleContents: []
      tupleLabels: []
      udtMetadata: null
      visibleType: 0
      width: 64
  Status: PUBLIC
- ColumnType:
    closedTypeIds: []
    columnId: 2
    computeExpr: null
    familyId: 0
    isNullable: false
    isRelationBeingDropped: false
    isVirtual: false
    tableId: 109
    type:
      arrayContents: null
      arrayDimensions: []
      arrayElemType: null
      family: IntFamily
      geoMetadata: null
      intervalDurationField: null
      locale: null
      oid: 20
      precision: 0
      timePrecisionIsSet: false
      tupleContents: []
      tupleLabels: []
      udtMetadata: null
      visibleType: 0
      width: 64
  Status: PUBLIC
- ColumnType:
    closedTypeIds: []
    columnId: 4.294967294e+09
    computeExpr: null
    familyId: 0
    isNullable: true
    isRelationBeingDropped: false
    isVirtual: false
    tableId: 109
    type:
      arrayContents: null
      arrayDimensions: []
      arrayElemType: null
      family: OidFamily
      geoMetadata: null
      intervalDurationField: null
      locale: null
      oid: 26
      precision: 0
      timePrecisionIsSet: false
      tupleContents: []
      tupleLabels: []
      udtMetadata: null
      visibleType: 0
      width: 0
  Status: PUBLIC
- ColumnType:
    closedTypeIds: []
    columnId: 4.294967295e+09
    computeExpr: null
    familyId: 0
    isNullable: true
    isRelationBeingDropped: false
    isVirtual: false
    tableId: 109
    type:
      arrayContents: null
      arrayDimensions: []
      arrayElemType: null
      family: DecimalFamily
      geoMetadata: null
      intervalDurationField: null
      locale: null
      oid: 1700
      precision: 0
      timePrecisionIsSet: false
      tupleContents: []
      tupleLabels: []
      udtMetadata: null
      visibleType: 0
      width: 0
  Status: PUBLIC
- ColumnDefaultExpression:
    columnId: 2
    expr: unique_rowid()
    referencedColumnIds: []
    tableId: 109
    usesSequenceIds: []
    usesTypeIds: []
  Status: PUBLIC
- IndexName:
    indexId: 1
    name: table_regional_by_table_pkey
    tableId: 109
  Status: PUBLIC
- IndexColumn:
    columnId: 1
    direction: ASC
    indexId: 1
    kind: STORED
    ordinalInKind: 0
    tableId: 109
  Status: PUBLIC
- IndexColumn:
    columnId: 2
    direction: ASC
    indexId: 1
    kind: KEY
    ordinalInKind: 0
    tableId: 109
  Status: PUBLIC
- Namespace:
    databaseId: 104
    descriptorId: 109
    name: table_regional_by_table
    schemaId: 106
  Status: PUBLIC
- Owner:
    descriptorId: 109
    owner: root
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 109
    privileges: 2
    userName: admin
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 109
    privileges: 2
    userName: root
  Status: PUBLIC
- ObjectParent:
    objectId: 109
    parentSchemaId: 106
  Status: PUBLIC

decompose
table_regional_by_row
----
BackReferencedIDs:
ElementState:
- Table:
    isTemporary: false
    tableId: 108
  Status: PUBLIC
- ColumnFamily:
    familyId: 0
    name: primary
    tableId: 108
  Status: PUBLIC
- Column:
    columnId: 1
    generatedAsIdentitySequenceOption: ""
    generatedAsIdentityType: 0
    isHidden: false
    isInaccessible: false
    isSystemColumn: false
    pgAttributeNum: 1
    tableId: 108
  Status: PUBLIC
- Column:
    columnId: 2
    generatedAsIdentitySequenceOption: ""
    generatedAsIdentityType: 0
    isHidden: false
    isInaccessible: false
    isSystemColumn: false
    pgAttributeNum: 2
    tableId: 108
  Status: PUBLIC
- Column:
    columnId: 3
    generatedAsIdentitySequenceOption: ""
    generatedAsIdentityType: 0
    isHidden: true
    isInaccessible: false
    isSystemColumn: false
    pgAttributeNum: 3
    tableId: 108
  Status: PUBLIC
- Column:
    columnId: 4.294967294e+09
    generatedAsIdentitySequenceOption: ""
    generatedAsIdentityType: 0
    isHidden: true
    isInaccessible: false
    isSystemColumn: true
    pgAttributeNum: 4.294967294e+09
    tableId: 108
  Status: PUBLIC
- Column:
    columnId: 4.294967295e+09
    generatedAsIdentitySequenceOption: ""
    generatedAsIdentityType: 0
    isHidden: true
    isInaccessible: false
    isSystemColumn: true
    pgAttributeNum: 4.294967295e+09
    tableId: 108
  Status: PUBLIC
- PrimaryIndex:
    constraintId: 1
    indexId: 1
    isConcurrently: false
    isCreatedExplicitly: false
    isInverted: false
    isNotVisible: false
    isUnique: true
    sharding: null
    sourceIndexId: 0
    tableId: 108
    temporaryIndexId: 0
  Status: PUBLIC
- TableComment:
    comment: regional by row is good
    tableId: 108
  Status: PUBLIC
- TableZoneConfig:
    tableId: 108
  Status: PUBLIC
- TableLocalityRegionalByRow:
    as: ""
    tableId: 108
  Status: PUBLIC
- ColumnName:
    columnId: 1
    name: k
    tableId: 108
  Status: PUBLIC
- ColumnName:
    columnId: 2
    name: v
    tableId: 108
  Status: PUBLIC
- ColumnName:
    columnId: 3
    name: crdb_region
    tableId: 108
  Status: PUBLIC
- ColumnName:
    columnId: 4.294967294e+09
    name: tableoid
    tableId: 108
  Status: PUBLIC
- ColumnName:
    columnId: 4.294967295e+09
    name: crdb_internal_mvcc_timestamp
    tableId: 108
  Status: PUBLIC
- ColumnType:
    closedTypeIds:
    - 105
    - 107
    columnId: 3
    computeExpr: null
    familyId: 0
    isNullable: false
    isRelationBeingDropped: false
    isVirtual: false
    tableId: 108
    type:
      arrayContents: null
      arrayDimensions: []
      arrayElemType: null
      family: EnumFamily
      geoMetadata: null
      intervalDurationField: null
      locale: null
      oid: 100105
      precision: 0
      timePrecisionIsSet: false
      tupleContents: []
      tupleLabels: []
      udtMetadata:
        arrayTypeOid: 100107
      visibleType: 0
      width: 0
  Status: PUBLIC
- ColumnType:
    closedTypeIds: []
    columnId: 1
    computeExpr: null
    familyId: 0
    isNullable: false
    isRelationBeingDropped: false
    isVirtual: false
    tableId: 108
    type:
      arrayContents: null
      arrayDimensions: []
      arrayElemType: null
      family: IntFamily
      geoMetadata: null
      intervalDurationField: null
      locale: null
      oid: 20
      precision: 0
      timePrecisionIsSet: false
      tupleContents: []
      tupleLabels: []
      udtMetadata: null
      visibleType: 0
      width: 64
  Status: PUBLIC
- ColumnType:
    closedTypeIds: []
    columnId: 2
    computeExpr: null
    familyId: 0
    isNullable: true
    isRelationBeingDropped: false
    isVirtual: false
    tableId: 108
    type:
      arrayContents: null
      arrayDimensions: []
      arrayElemType: null
      family: StringFamily
      geoMetadata: null
      intervalDurationField: null
      locale: null
      oid: 25
      precision: 0
      timePrecisionIsSet: false
      tupleContents: []
      tupleLabels: []
      udtMetadata: null
      visibleType: 0
      width: 0
  Status: PUBLIC
- ColumnType:
    closedTypeIds: []
    columnId: 4.294967294e+09
    computeExpr: null
    familyId: 0
    isNullable: true
    isRelationBeingDropped: false
    isVirtual: false
    tableId: 108
    type:
      arrayContents: null
      arrayDimensions: []
      arrayElemType: null
      family: OidFamily
      geoMetadata: null
      intervalDurationField: null
      locale: null
      oid: 26
      precision: 0
      timePrecisionIsSet: false
      tupleContents: []
      tupleLabels: []
      udtMetadata: null
      visibleType: 0
      width: 0
  Status: PUBLIC
- ColumnType:
    closedTypeIds: []
    columnId: 4.294967295e+09
    computeExpr: null
    familyId: 0
    isNullable: true
    isRelationBeingDropped: false
    isVirtual: false
    tableId: 108
    type:
      arrayContents: null
      arrayDimensions: []
      arrayElemType: null
      family: DecimalFamily
      geoMetadata: null
      intervalDurationField: null
      locale: null
      oid: 1700
      precision: 0
      timePrecisionIsSet: false
      tupleContents: []
      tupleLabels: []
      udtMetadata: null
      visibleType: 0
      width: 0
  Status: PUBLIC
- ColumnDefaultExpression:
    columnId: 3
    expr: default_to_database_primary_region(gateway_region())::@100105
    referencedColumnIds: []
    tableId: 108
    usesSequenceIds: []
    usesTypeIds:
    - 105
    - 107
  Status: PUBLIC
- ColumnComment:
    columnId: 1
    comment: k is good
    pgAttributeNum: 1
    tableId: 108
  Status: PUBLIC
- IndexName:
    indexId: 1
    name: table_regional_by_row_pkey
    tableId: 108
  Status: PUBLIC
- IndexPartitioning:
    indexId: 1
    partitioning:
      list:
      - name: us-east1
        subpartitioning:
          list: []
          numColumns: 0
          numImplicitColumns: 0
          range: []
        values:
        - BgFA
      - name: us-east2
        subpartitioning:
          list: []
          numColumns: 0
          numImplicitColumns: 0
          range: []
        values:
        - BgGA
      - name: us-east3
        subpartitioning:
          list: []
          numColumns: 0
          numImplicitColumns: 0
          range: []
        values:
        - BgHA
      numColumns: 1
      numImplicitColumns: 1
      range: []
    tableId: 108
  Status: PUBLIC
- IndexComment:
    comment: pkey is good
    indexId: 1
    tableId: 108
  Status: PUBLIC
- IndexColumn:
    columnId: 1
    direction: ASC
    indexId: 1
    kind: KEY
    ordinalInKind: 1
    tableId: 108
  Status: PUBLIC
- IndexColumn:
    columnId: 2
    direction: ASC
    indexId: 1
    kind: STORED
    ordinalInKind: 0
    tableId: 108
  Status: PUBLIC
- IndexColumn:
    columnId: 3
    direction: ASC
    indexId: 1
    kind: KEY
    ordinalInKind: 0
    tableId: 108
  Status: PUBLIC
- Namespace:
    databaseId: 104
    descriptorId: 108
    name: table_regional_by_row
    schemaId: 106
  Status: PUBLIC
- Owner:
    descriptorId: 108
    owner: root
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 108
    privileges: 2
    userName: admin
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 108
    privileges: 2
    userName: root
  Status: PUBLIC
- ObjectParent:
    objectId: 108
    parentSchemaId: 106
  Status: PUBLIC

decompose
crdb_internal_region
----
BackReferencedIDs:
  - 108
  - 109
ElementState:
- EnumType:
    arrayTypeId: 107
    isMultiRegion: true
    typeId: 105
  Status: PUBLIC
- Namespace:
    databaseId: 104
    descriptorId: 105
    name: crdb_internal_region
    schemaId: 106
  Status: PUBLIC
- Owner:
    descriptorId: 105
    owner: root
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 105
    privileges: 2
    userName: admin
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 105
    privileges: 2
    userName: root
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 105
    privileges: 512
    userName: public
  Status: PUBLIC
- ObjectParent:
    objectId: 105
    parentSchemaId: 106
  Status: PUBLIC
- EnumTypeValue:
    logicalRepresentation: us-east1
    physicalRepresentation: QA==
    typeId: 105
  Status: PUBLIC
- EnumTypeValue:
    logicalRepresentation: us-east2
    physicalRepresentation: gA==
    typeId: 105
  Status: PUBLIC
- EnumTypeValue:
    logicalRepresentation: us-east3
    physicalRepresentation: wA==
    typeId: 105
  Status: PUBLIC
