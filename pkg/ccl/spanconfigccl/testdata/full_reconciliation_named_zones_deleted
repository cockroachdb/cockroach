# This file tests a full reconciliation scenario when all named zone entries
# have been removed from system.zones. The expectation is for us to still
# generate span config updates for these named zones. These should be the same
# as RANGE DEFAULT because that's what they inherit from in the absence of an
# explicit zone config.

query-sql
SELECT id FROM system.zones
----
0
1
16
17
22
25
27

# Note that discarding RANGE_DEFAULT isn't allowed.
exec-sql
ALTER RANGE liveness CONFIGURE ZONE DISCARD;
ALTER RANGE meta CONFIGURE ZONE DISCARD;
ALTER RANGE system CONFIGURE ZONE DISCARD;
ALTER RANGE timeseries CONFIGURE ZONE DISCARD;
----

query-sql
SELECT id FROM system.zones
----
0
1
25
27


# Even though we deleted explicit zone configurations on the named zones above,
# we still expect there to be an entry for these ranges. The associated config
# should match RANGE DEFAULT as all fields are inherited from it. This can be
# verified by looking at the numvoters/numreplicas fields for these ranges, which
# have the value 3.
full-reconcile
----
Span: /Table/{3-4}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/{4-5}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/{5-6}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/{6-7}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/{8-9}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/1{1-2}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/1{2-3}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/1{3-4}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/1{4-5}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/1{5-6}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/{19-20}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/2{0-1}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/2{1-2}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/2{3-4}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/2{4-5}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/2{5-6}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 600
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/2{6-7}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/2{7-8}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 600
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/2{8-9}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /NamespaceTable/{30-Max}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /{NamespaceTable/Max-Table/32}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/3{2-3}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/3{3-4}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/3{4-5}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/3{5-6}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/3{6-7}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/3{7-8}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/{39-40}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/4{0-1}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/4{1-2}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/4{2-3}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/4{3-4}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/4{4-5}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/4{5-6}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/4{6-7}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /Table/4{7-8}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 5
numvoters: 5
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /System/NodeLiveness{-Max}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 3
numvoters: 3
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /{Min-System/NodeLiveness}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 3
numvoters: 3
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /System/{NodeLivenessMax-tsd}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 3
numvoters: 3
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /System{tse-/Max}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 3
numvoters: 3
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
Span: /System{/tsd-tse}
rangeminbytes: 134217728
rangemaxbytes: 536870912
gcpolicy:
  ttlseconds: 90000
globalreads: false
numreplicas: 3
numvoters: 3
constraints: []
voterconstraints: []
leasepreferences: []
-----------------------
