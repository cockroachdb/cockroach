init
dir1
5
----

load
----

get-active-data-key
----
none

get-active-store-key
----
none

set-active-store-key id=foo
----

get-active-data-key
----
encryption_type:AES128_CTR source:"data key manager" parent_key_id:"foo"

record-active-data-key
----

wait
2
----

compare-active-data-key
----
same

wait
4
----

compare-active-data-key
----
different

get-active-data-key
----
encryption_type:AES128_CTR creation_time:6 source:"data key manager" parent_key_id:"foo"

record-active-data-key
----

check-all-recorded-data-keys
----

init
dir2
5
active-store-key foo
active-data-key data1
----

load
----

get-active-data-key
----
encryption_type:AES192_CTR

get-active-store-key
----
foo

record-active-data-key
----

wait
10
----

compare-active-data-key
----
same

set-active-store-key id=bar
----

get-store-key id=foo
----
encryption_type:AES128_CTR key_id:"foo"

get-store-key id=bar
----
encryption_type:AES128_CTR key_id:"bar"

get-store-key id=baz
----
none

get-active-store-key
----
bar

compare-active-data-key
----
different

get-active-data-key
----
encryption_type:AES128_CTR creation_time:16 source:"data key manager" parent_key_id:"bar"

check-exposed val=false
----

record-active-data-key
----

check-all-recorded-data-keys
----

init
dir3
5
active-store-key foo
active-data-key data1
----

load
----

get-active-data-key
----
encryption_type:AES192_CTR

set-active-store-key-plain id=bar
----

check-exposed val=true
----

get-active-data-key
----
creation_time:16 source:"data key manager" was_exposed:true parent_key_id:"bar"

