# A test setup helper that sets up four ranges on n1s1-n3s3 with leases on s1,
# and s1 is CPU overloaded due to their foreground load.

set-store
  store-id=1 node-id=1 attrs=purple locality-tiers=region=us-west-1,zone=us-west-1a
  store-id=2 node-id=2 attrs=yellow locality-tiers=region=us-east-1,zone=us-east-1a
  store-id=3 node-id=3 attrs=green locality-tiers=region=us-central-1,zone=us-central-1a
----
node-id=1 locality-tiers=region=us-west-1,zone=us-west-1a,node=1
  store-id=1 attrs=purple locality-code=1:2:3:
node-id=2 locality-tiers=region=us-east-1,zone=us-east-1a,node=2
  store-id=2 attrs=yellow locality-code=4:5:6:
node-id=3 locality-tiers=region=us-central-1,zone=us-central-1a,node=3
  store-id=3 attrs=green locality-code=7:8:9:

store-load-msg
  store-id=1 node-id=1 load=[1000,0,0] capacity=[1000,1000,1000] secondary-load=0 load-time=0s
----

store-load-msg
  store-id=2 node-id=2 load=[100,0,0] capacity=[1000,1000,1000] secondary-load=0 load-time=0s
----

store-load-msg
  store-id=3 node-id=3 load=[100,0,0] capacity=[1000,1000,1000] secondary-load=0 load-time=0s
----

get-load-info
----
store-id=1 node-id=1 status=ok accepting all reported=[cpu:1000, write-bandwidth:0, byte-size:0] adjusted=[cpu:1000, write-bandwidth:0, byte-size:0] node-reported-cpu=1000 node-adjusted-cpu=1000 seq=1
store-id=2 node-id=2 status=ok accepting all reported=[cpu:100, write-bandwidth:0, byte-size:0] adjusted=[cpu:100, write-bandwidth:0, byte-size:0] node-reported-cpu=100 node-adjusted-cpu=100 seq=1
store-id=3 node-id=3 status=ok accepting all reported=[cpu:100, write-bandwidth:0, byte-size:0] adjusted=[cpu:100, write-bandwidth:0, byte-size:0] node-reported-cpu=100 node-adjusted-cpu=100 seq=1

store-leaseholder-msg
store-id=1
  range-id=1 load=[250,0,0] raft-cpu=20
    store-id=1 replica-id=1 type=VOTER_FULL leaseholder=true
    store-id=2 replica-id=2 type=VOTER_FULL
    store-id=3 replica-id=3 type=VOTER_FULL
    config=num_replicas=3 constraints={} voter_constraints={}
  range-id=2 load=[250,0,0] raft-cpu=20
    store-id=1 replica-id=1 type=VOTER_FULL leaseholder=true
    store-id=2 replica-id=2 type=VOTER_FULL
    store-id=3 replica-id=3 type=VOTER_FULL
    config=num_replicas=3 constraints={} voter_constraints={}
  range-id=3 load=[250,0,0] raft-cpu=20
    store-id=1 replica-id=1 type=VOTER_FULL leaseholder=true
    store-id=2 replica-id=2 type=VOTER_FULL
    store-id=3 replica-id=3 type=VOTER_FULL
    config=num_replicas=3 constraints={} voter_constraints={}
  range-id=4 load=[250,0,0] raft-cpu=20
    store-id=1 replica-id=1 type=VOTER_FULL leaseholder=true
    store-id=2 replica-id=2 type=VOTER_FULL
    store-id=3 replica-id=3 type=VOTER_FULL
    config=num_replicas=3 constraints={} voter_constraints={}
----

# n1's top-k-ranges reflect r3, r2, and r1.
get-load-info
----
store-id=1 node-id=1 status=ok accepting all reported=[cpu:1000, write-bandwidth:0, byte-size:0] adjusted=[cpu:1000, write-bandwidth:0, byte-size:0] node-reported-cpu=1000 node-adjusted-cpu=1000 seq=1
  top-k-ranges (local-store-id=1) dim=CPURate: r4 r3 r2 r1
store-id=2 node-id=2 status=ok accepting all reported=[cpu:100, write-bandwidth:0, byte-size:0] adjusted=[cpu:100, write-bandwidth:0, byte-size:0] node-reported-cpu=100 node-adjusted-cpu=100 seq=1
  top-k-ranges (local-store-id=1) dim=WriteBandwidth: r4 r3 r2 r1
store-id=3 node-id=3 status=ok accepting all reported=[cpu:100, write-bandwidth:0, byte-size:0] adjusted=[cpu:100, write-bandwidth:0, byte-size:0] node-reported-cpu=100 node-adjusted-cpu=100 seq=1
  top-k-ranges (local-store-id=1) dim=WriteBandwidth: r4 r3 r2 r1
