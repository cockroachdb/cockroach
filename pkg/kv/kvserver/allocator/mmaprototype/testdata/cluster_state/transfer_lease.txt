set-store
  store-id=1 node-id=1 attrs=purple locality-tiers=region=us-west-1,zone=us-west-1a
  store-id=2 node-id=2 attrs=yellow locality-tiers=region=us-east-1,zone=us-east-1a
----
node-id=1 locality-tiers=region=us-west-1,zone=us-west-1a,node=1
  store-id=1 attrs=purple
node-id=2 locality-tiers=region=us-east-1,zone=us-east-1a,node=2
  store-id=2 attrs=yellow

store-load-msg
  store-id=1 node-id=1 load=[80,80,80] capacity=[100,100,100] secondary-load=1 load-time=0s
----

store-load-msg
  store-id=2 node-id=2 load=[20,80,80] capacity=[100,100,100] secondary-load=1 load-time=0s
----

get-load-info
----
store-id=1 node-id=1 status=ok accepting all reported=[cpu:80ns/s, write-bandwidth:80 B/s, byte-size:80 B] adjusted=[cpu:80ns/s, write-bandwidth:80 B/s, byte-size:80 B] node-reported-cpu=80 node-adjusted-cpu=80 seq=1
store-id=2 node-id=2 status=ok accepting all reported=[cpu:20ns/s, write-bandwidth:80 B/s, byte-size:80 B] adjusted=[cpu:20ns/s, write-bandwidth:80 B/s, byte-size:80 B] node-reported-cpu=20 node-adjusted-cpu=20 seq=1

store-leaseholder-msg 
store-id=1
  range-id=1 load=[80,80,80] raft-cpu=20
  config=(num_replicas=3 constraints={'+region=us-west-1:1'} voter_constraints={'+region=us-west-1:1'})
    store-id=1 replica-id=1 type=VOTER_FULL leaseholder=true
    store-id=2 replica-id=2 type=VOTER_FULL
----

get-load-info
----
store-id=1 node-id=1 status=ok accepting all reported=[cpu:80ns/s, write-bandwidth:80 B/s, byte-size:80 B] adjusted=[cpu:80ns/s, write-bandwidth:80 B/s, byte-size:80 B] node-reported-cpu=80 node-adjusted-cpu=80 seq=1
  top-k-ranges (local-store-id=1) dim=CPURate: r1
store-id=2 node-id=2 status=ok accepting all reported=[cpu:20ns/s, write-bandwidth:80 B/s, byte-size:80 B] adjusted=[cpu:20ns/s, write-bandwidth:80 B/s, byte-size:80 B] node-reported-cpu=20 node-adjusted-cpu=20 seq=1
  top-k-ranges (local-store-id=1) dim=WriteBandwidth: r1

ranges
----
range-id=1 local-store=1 load=[cpu:80ns/s, write-bandwidth:80 B/s, byte-size:80 B] raft-cpu=20
  store-id=1 replica-id=1 type=VOTER_FULL leaseholder=true
  store-id=2 replica-id=2 type=VOTER_FULL

# The gc duration for lease shedding is 1min.
make-pending-changes range-id=1
  transfer-lease: remove-store-id=1 add-store-id=2 
----
pending(2)
change-id=1 store-id=1 node-id=1 range-id=1 load-delta=[cpu:-60ns/s, write-bandwidth:0 B/s, byte-size:0 B] start=0s gc=1m0s
  prev=(replica-id=1 type=VOTER_FULL leaseholder=true)
  next=(replica-id=1 type=VOTER_FULL)
change-id=2 store-id=2 node-id=2 range-id=1 load-delta=[cpu:66ns/s, write-bandwidth:0 B/s, byte-size:0 B] start=0s gc=1m0s
  prev=(replica-id=2 type=VOTER_FULL)
  next=(replica-id=2 type=VOTER_FULL leaseholder=true)

get-load-info
----
store-id=1 node-id=1 status=ok accepting all reported=[cpu:80ns/s, write-bandwidth:80 B/s, byte-size:80 B] adjusted=[cpu:20ns/s, write-bandwidth:80 B/s, byte-size:80 B] node-reported-cpu=80 node-adjusted-cpu=20 seq=2
  top-k-ranges (local-store-id=1) dim=CPURate: r1
store-id=2 node-id=2 status=ok accepting all reported=[cpu:20ns/s, write-bandwidth:80 B/s, byte-size:80 B] adjusted=[cpu:86ns/s, write-bandwidth:80 B/s, byte-size:80 B] node-reported-cpu=20 node-adjusted-cpu=86 seq=2
  top-k-ranges (local-store-id=1) dim=WriteBandwidth: r1

ranges
----
range-id=1 local-store=1 load=[cpu:80ns/s, write-bandwidth:80 B/s, byte-size:80 B] raft-cpu=20
  store-id=1 replica-id=1 type=VOTER_FULL
  store-id=2 replica-id=2 type=VOTER_FULL leaseholder=true

reject-pending-changes change-ids=(1,2)
----
pending(0)

get-load-info
----
store-id=1 node-id=1 status=ok accepting all reported=[cpu:80ns/s, write-bandwidth:80 B/s, byte-size:80 B] adjusted=[cpu:80ns/s, write-bandwidth:80 B/s, byte-size:80 B] node-reported-cpu=80 node-adjusted-cpu=80 seq=3
  top-k-ranges (local-store-id=1) dim=CPURate: r1
store-id=2 node-id=2 status=ok accepting all reported=[cpu:20ns/s, write-bandwidth:80 B/s, byte-size:80 B] adjusted=[cpu:20ns/s, write-bandwidth:80 B/s, byte-size:80 B] node-reported-cpu=20 node-adjusted-cpu=20 seq=3
  top-k-ranges (local-store-id=1) dim=WriteBandwidth: r1

ranges
----
range-id=1 local-store=1 load=[cpu:80ns/s, write-bandwidth:80 B/s, byte-size:80 B] raft-cpu=20
  store-id=1 replica-id=1 type=VOTER_FULL leaseholder=true
  store-id=2 replica-id=2 type=VOTER_FULL

# Set both existing stores again, this should have no effect.
set-store
  store-id=1 node-id=1 attrs=purple locality-tiers=region=us-west-1,zone=us-west-1a
  store-id=2 node-id=2 attrs=yellow locality-tiers=region=us-east-1,zone=us-east-1a
----
node-id=1 locality-tiers=region=us-west-1,zone=us-west-1a,node=1
  store-id=1 attrs=purple
node-id=2 locality-tiers=region=us-east-1,zone=us-east-1a,node=2
  store-id=2 attrs=yellow
