set-txn-expiration 100s
----

set-closed-ts-override lag=1h
----

init num-nodes=3
----
n1, n2, n3

debug "Created 3-node cluster"
----

split
----

put account=1 balance=50
----

put account=25 balance=50
----

put account=60 balance=100
----

dump-accounts
----
key: /Table/100/1, value: /INT/50
key: /Table/100/25, value: /INT/50
key: /Table/100/60, value: /INT/100

get account=20
----

scan start=20 end=50
----
key: /Table/100/25, value: /INT/50

scan start=30 end=50
----

range-desc account=25
----
span: /{Table/100-Max}
voters: n1, n2, n3

check-lease account=25
----
n1

transfer-lease account=5 node-id=2
----

check-lease account=5
----
n2

get account=60
----
key: /Table/100/60, value: /INT/100

delete account=60
----

new-txn name=emptyTxn
----

async op=commit commit-txn name=emptyTxn
----

dump-accounts
----
key: /Table/100/1, value: /INT/50
key: /Table/100/25, value: /INT/50

await op=commit
----

new-txn name=txn1
----

exec-batch txn=txn1
  load-balances accounts=(1,25) for-update=true
----
key: /Table/100/1, value: /INT/50
key: /Table/100/25, value: /INT/50

exec-batch txn=txn1
  modify-balances accounts=1 delta=+10
  modify-balances accounts=25 delta=-10
----


exec-batch txn=txn1 commit=true
  store-balances accounts=(1,25)
----


dump-accounts
----
key: /Table/100/1, value: /INT/60
key: /Table/100/25, value: /INT/40
