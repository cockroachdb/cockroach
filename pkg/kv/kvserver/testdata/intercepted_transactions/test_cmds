echo new-txn name=txn1 ts=10,1 epoch=0
----
new-txn name=txn1 ts=10,1 epoch=0

set-txn-expiration 100s
----

sleep 100ms
----

set-closed-ts-override lag=1h
----

init num-nodes=3 intercept-on-nodes=(3,5)
----
n1, n2, n3

debug "Created 3-node cluster"
----

split
----

put account=1 balance=50
----

put account=25 balance=50
----

put account=60 balance=100
----

dump-accounts
----
key: /Table/100/1, value: /INT/50
key: /Table/100/25, value: /INT/50
key: /Table/100/60, value: /INT/100

get account=20
----

scan start=20 end=50
----
key: /Table/100/25, value: /INT/50

scan start=30 end=50
----

range-desc account=25
----
span: /{Table/100-Max}
voters: n1, n2, n3

check-lease account=25
----
n1

transfer-lease account=5 node-id=2
----

check-lease account=5
----
n2

get account=60
----
key: /Table/100/60, value: /INT/100

delete account=60
----

new-txn name=txn1
----

async op=t2Commit commit-txn name=txn2
----

async op=t1Commit commit-txn name=txn1
----

dump-accounts
----
key: /Table/100/1, value: /INT/50
key: /Table/100/25, value: /INT/50

await op=t1Commit
----
committed

await op=t2Commit
----
txn "txn2" not found

new-txn name=txn3
----

exec-batch txn=txn3
  load-balances accounts=(1,25,30) for-update=true
  load-balances accounts=99 for-update=false
  load-balances accounts=(1,2,20) delta=10
  modify-balances accounts=(2,30) delta=+75
  store-balances accounts=2
----
key: /Table/100/1, value: /INT/50
key: /Table/100/25, value: /INT/50
key: /Table/100/1, value: /INT/50
key: /Table/100/2, value: /INT/75

exec-batch txn=txn3
  store-balances accounts=30
----
key: /Table/100/30, value: /INT/75

commit-txn name=txn3
----
committed

dump-accounts
----
key: /Table/100/1, value: /INT/50
key: /Table/100/2, value: /INT/75
key: /Table/100/25, value: /INT/50
key: /Table/100/30, value: /INT/75

# TODO(sarkesian): Improve this test with a more complete validation of the error handling of the data-driven test.
