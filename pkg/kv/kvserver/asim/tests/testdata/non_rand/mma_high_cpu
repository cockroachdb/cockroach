gen_cluster nodes=7
----

gen_ranges ranges=100
----

# Set the rebalance mode to use the mma store rebalancer and disable the lease
# and replicate queues so that only the mma store rebalancer is moving replicas
# or leases.
setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false 
----

gen_load rate=7000 rw_ratio=0.95 access_skew=true min_block=128 max_block=256
----

eval duration=5m samples=1 seed=42
----
OK

plot stat=cpu sample=1  show_last_value=true
----
----

 530555707 ┤   ╭───────────╮ ╭─────────────╮
 495185326 ┤ ╭─╯           │ │─────────────│───────────────────────────────────────────────
 459814946 ┤ │             │ │             │ ╭─────────────────────────────────────────────
 424444565 ┤ ╭───────────────╯             │ │╭────────────────────────────────────────────
 389074185 ┤ ╭──╮╭─╮───────╮╭──────────────╮╮│╯────────────────────────────────────────╭───
 353703804 ┤ │──╰╯─╰────────╯──────────────╰─╯─────────────────────────────────────────╯
 318333424 ┤ │             ╰╮╭─────────────╮╭╯
 282963043 ┤ │───────────────╯             ╰╯╰─────────────────────────────────────────────
 247592663 ┤ │              │
 212222283 ┤ │              ╰──────────────────────────────────────────────────────────────
 176851902 ┤ │
 141481522 ┤ │
 106111141 ┤ │
  70740761 ┤ │
  35370380 ┤ │
         0 ┼─╯
                                                  cpu

last store values: [s1=221706480 s4=290518462 s5=371646607 s2=404078056 s6=422978781 s7=462406455 s3=504831333]
----
----

plot stat=write_bytes_per_second show_last_value=true
----
----

 51430 ┤ ╭─────────────╮                                                         ╭─────
 48001 ┤ │             │      ╭──────────────────────────────────────────────────╯
 44573 ┤ │             │ ╭────╯                    ╭───────────────────────────────────
 41144 ┤ │             │ │╭────────────────────────╯
 37715 ┤ │             │ │╯                    ╭───────────────────────────────────────
 34287 ┤ │             ╰─╯   ╭─────────────────╯
 30858 ┤ │             ╭─────╯
 27429 ┤ │             │ ╭──────────────╮
 24001 ┤ │             │ │              ╰──────────────────────────────────────────────
 20572 ┤ │             │ ╭─────────────╮  ╭────────────────────────────────────────────
 17143 ┤ │             │╮│             ╰──╯
 13715 ┤ ╭──────────────────────────────╮ ╭────────────────────────────────────────────
 10286 ┤ ╭─────────────────────────────────────────────────────────────────────────────
  6857 ┤ │
  3429 ┤ │
     0 ┼─╯
                                     write_bytes_per_second

last store values: [s7=10296 s6=12114 s4=19041 s2=24539 s5=38034 s1=43883 s3=49814]
----
----

plot stat=replicas sample=1 show_last_value=true
----
----

 47.00 ┤             ╭─────────────────────────────────────────────────────────────────
 46.67 ┤             │ │
 46.33 ┤             │ │
 46.00 ┤         ╭───╯ │───────────────────────────────────────────────────────────────
 45.67 ┤         │     │
 45.33 ┤         │     │
 45.00 ┤      ╭──╯     ╭───────────────────────────────────────────────────────────────
 44.67 ┤      │        │
 44.33 ┤      │        │
 44.00 ┤   ╭──╯        │───────────────────────────────────────────────────────────────
 43.67 ┤   │           │
 43.33 ┤   │           │
 43.00 ┼───────────────────────────────────────────────────────────────────────────────
 42.67 ┤
 42.33 ┤
 42.00 ┼───────────────────────────────────────────────────────────────────────────────
                                            replicas

last store values: [s7=42 s6=43 s4=44 s2=45 s5=45 s1=46 s3=47]
----
----

plot stat=leases sample=1 show_last_value=true
----
----

 21.00 ┤                                 ╭─────────────────────────────────────────────
 19.80 ┤                                 ╭─────────────────────────────────────────────
 18.60 ┤             ╭─╮ ╭───────────────│─────────────────────────────────────────────
 17.40 ┤         ╭───╯ │╭──────────────╮╭╯
 16.20 ┤      ╭──╯     ╭╯──────────────││──────────────────────────────────────────────
 15.00 ┼───────────────╯╯              ╭╯──────────────────────────────────────────────
 13.80 ┼───────────────────────────────╯╯
 12.60 ┤                │               │
 11.40 ┤                │               │
 10.20 ┤                │               │
  9.00 ┤                ╰╮              │
  7.80 ┤                 ╰──────────────│──────────────────────────────────────────────
  6.60 ┤                                ╰╮
  5.40 ┤                                 │
  4.20 ┤                                 │
  3.00 ┤                                 ╰─────────────────────────────────────────────
                                             leases

last store values: [s4=3 s1=8 s5=16 s2=17 s3=19 s7=20 s6=21]
----
----
