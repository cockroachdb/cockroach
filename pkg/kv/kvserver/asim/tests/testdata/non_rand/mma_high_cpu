gen_cluster nodes=7
----

gen_ranges ranges=100
----

# Set the rebalance mode to use the mma store rebalancer and disable the lease
# and replicate queues so that only the mma store rebalancer is moving replicas
# or leases.
setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false 
----

gen_load rate=7000 rw_ratio=0.95 access_skew=true min_block=128 max_block=256
----

eval duration=5m samples=1 seed=42
----
OK

plot stat=cpu sample=1  show_last_value=true
----
----

 520042928 ┤ ╭─────────────╮
 485373399 ┤ │             │
 450703871 ┤ │             │ ╭─────────────╮───────────────────────────────────────────────
 416034342 ┤ ╭───────────────│─────────────╰╮╭─────────────────────────────────────────────
 381364814 ┤ ╭─────────────────────────────────────────────────────────────────────────────
 346695285 ┤ │───────────────────────────────╯
 312025757 ┤ │╮            ╭─╯
 277356228 ┤ │╰────────────╯│
 242686700 ┤ │              │
 208017171 ┤ │              ╰──────────────────────────────────────────────────────────────
 173347643 ┤ │
 138678114 ┤ │
 104008586 ┤ │
  69339057 ┤ │
  34669529 ┤ │
         0 ┼─╯
                                                  cpu

last store values: [s1=222752668 s7=373230000 s5=399587491 s2=405921450 s6=410996867 s4=414745662 s3=453304240]
----
----

plot stat=write_bytes_per_second show_last_value=true
----
----

 51430 ┤ ╭─────────────╮                                                        ╭──────
 48001 ┤ │             │      ╭─────────────────────────────────────────────────╯
 44573 ┤ │             │ ╭────╯                    ╭─╭─────────────────────────────────
 41144 ┤ │             │ │ ╭──╭──────────────────────╯
 37715 ┤ │             │ ╭────╯
 34287 ┤ │             ╰─│
 30858 ┤ │             ╭─╯
 27429 ┤ │             │ ╭──────────────╮
 24001 ┤ │             │ │              ╰──────────────────────────────────────────────
 20572 ┤ │             │ │
 17143 ┤ │             │─╯
 13715 ┤ ╭─────────────────────────────╮─╭─────────────────────────────────────────────
 10286 ┤ ╭─────────────────────────────────────────────────────────────────────────────
  6857 ┤ │
  3429 ┤ │
     0 ┼─╯
                                     write_bytes_per_second

last store values: [s7=10355 s6=12127 s4=12824 s2=24545 s1=43883 s5=44383 s3=49820]
----
----

plot stat=replicas sample=1 show_last_value=true
----
----

 47.00 ┤             ╭─────────────────────────────────────────────────────────────────
 46.67 ┤             │ │
 46.33 ┤             │ │
 46.00 ┤         ╭───╯ ╭───────────────────────────────────────────────────────────────
 45.67 ┤         │     │
 45.33 ┤         │     │
 45.00 ┤      ╭──╯     │───────────────────────────────────────────────────────────────
 44.67 ┤      │        │
 44.33 ┤      │        │
 44.00 ┤   ╭──╯        │
 43.67 ┤   │           │
 43.33 ┤   │           │
 43.00 ┼───────────────────────────────────────────────────────────────────────────────
 42.67 ┤
 42.33 ┤
 42.00 ┼───────────────────────────────────────────────────────────────────────────────
                                            replicas

last store values: [s7=42 s4=43 s6=43 s2=45 s1=46 s5=46 s3=47]
----
----

plot stat=leases sample=1 show_last_value=true
----
----

 21.00 ┤                ╭──────────────╮
 20.27 ┤                │              │
 19.53 ┤                │              │
 18.80 ┤             ╭─╮│              │
 18.07 ┤         ╭───╯ ││              ╰───────────────────────────────────────────────
 17.33 ┤         │     ││
 16.60 ┤      ╭──╯     ╰│              ╭───────────────────────────────────────────────
 15.87 ┤   ╭──╯         │              │
 15.13 ┤   │           ╭╯              │
 14.40 ┼───────────────│───────────────│───────────────────────────────────────────────
 13.67 ┼───────────────────────────────────────────────────────────────────────────────
 12.93 ┤                │
 12.20 ┤                │
 11.47 ┤                │
 10.73 ┤                │
 10.00 ┤                ╰──────────────────────────────────────────────────────────────
                                             leases

last store values: [s1=10 s7=14 s2=15 s3=15 s4=15 s6=17 s5=18]
----
----
