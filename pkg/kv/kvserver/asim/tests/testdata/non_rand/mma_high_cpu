gen_cluster nodes=7
----

gen_ranges ranges=100
----

# Set the rebalance mode to use the mma store rebalancer and disable the lease
# and replicate queues so that only the mma store rebalancer is moving replicas
# or leases.
setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false
----

gen_load rate=7000 rw_ratio=0.95 access_skew=true min_block=128 max_block=256
----

eval duration=25m samples=1 seed=42
----
OK

plot stat=cpu sample=1  show_last_value=true
----
----

 518935998 ┤╭──╮
 484340265 ┤│  │
 449744532 ┤│  ╰───────────────────────────────────────────────────────────────────────────
 415148799 ┤╭──╭───────────────────────────────────────────────────────────────────────────
 380553066 ┤╭──────────────────────────────────────────────────────────────────────────────
 345957332 ┤│──────────────────────────────────────────────────────────────────────────────
 311361599 ┤│  │───────────────────────────────────────────────────────────────────────────
 276765866 ┤│──╯
 242170133 ┤│
 207574399 ┤│
 172978666 ┤│
 138382933 ┤│
 103787200 ┤│
  69191466 ┤│
  34595733 ┤│
         0 ┼╯
                                                  cpu

last store values: [s2=323141583 s6=345504549 s3=349789216 s7=386383749 s4=414531574 s5=418160610 s1=444711574]
----
----

plot stat=write_bytes_per_second show_last_value=true
----
----

 51390 ┤╭──────────────────────────────────────────────────────────────────────────────
 47964 ┤│  │───────────────────────────────────────────────────────────────────────────
 44538 ┤│  │
 41112 ┤│  │
 37686 ┤│  ╰╮
 34260 ┤│   ╰───╮                                                   ╭──────────────────
 30834 ┤│       ╰╭──────────────────────────────────────────────────╯
 27408 ┤│    ╭───╯                      ╰──────────────────────────────────────────────
 23982 ┤│  ╭─╯
 20556 ┤│  │
 17130 ┤│  │───────────────────────────────────────────────────────────────────────────
 13704 ┤╭──│───────────────────────────────────────────────────────────────────────────
 10278 ┤╭──╯
  6852 ┤│
  3426 ┤│
     0 ┼╯
                                     write_bytes_per_second

last store values: [s6=12194 s4=12820 s5=15954 s2=28408 s7=32708 s1=48485 s3=51012]
----
----

plot stat=replicas sample=1 show_last_value=true
----
----

 47.00 ┤  ╭╭───────────────────────────────────────────────────────────────────────────
 46.67 ┤  ││
 46.33 ┤  ││
 46.00 ┤ ╭╯│
 45.67 ┤ │ │
 45.33 ┤ │ │
 45.00 ┤ │ │
 44.67 ┤ │ │
 44.33 ┤ │ │
 44.00 ┤╭╯ ╭───────────────────────────────────────────────────────────────────────────
 43.67 ┤│  │
 43.33 ┤│  │
 43.00 ┼───│───────────────────────────────────────────────────────────────────────────
 42.67 ┤   │
 42.33 ┤   │
 42.00 ┼───╯
                                            replicas

last store values: [s4=43 s6=43 s1=44 s2=44 s7=44 s3=47 s5=47]
----
----

plot stat=leases sample=1 show_last_value=true
----
----

 19.00 ┤  ╭╮
 18.60 ┤  ││
 18.20 ┤  ││
 17.80 ┤ ╭╯╰───────────────────────────────────────────────────────────────────────────
 17.40 ┤ │
 17.00 ┤ │
 16.60 ┤ │
 16.20 ┤ │
 15.80 ┤╭╯ ╭───────────────────────────────────────────────────────────────────────────
 15.40 ┤│  │
 15.00 ┼───│───────────────────────────────────────────────────────────────────────────
 14.60 ┤   │
 14.20 ┤   │
 13.80 ┼───────────────────────────────────────────────────────────────────────────────
 13.40 ┤   │
 13.00 ┤   ╰───────────────────────────────────────────────────────────────────────────
                                             leases

last store values: [s2=13 s3=14 s6=14 s7=14 s4=15 s5=16 s1=18]
----
----
