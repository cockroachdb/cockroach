gen_cluster nodes=7
----

gen_ranges ranges=100
----

# Set the rebalance mode to use the mma store rebalancer and disable the lease
# and replicate queues so that only the mma store rebalancer is moving replicas
# or leases.
setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false 
----

gen_load rate=7000 rw_ratio=0.95 access_skew=true min_block=128 max_block=256
----

eval duration=5m samples=1 seed=42
----
OK

plot stat=cpu sample=1  show_last_value=true
----
----

 535254580 ┤       ╭───────╮ ╭─────────────────────────────────────────────────────────────
 499570941 ┤ ╭─────╯       │ ╭─────────────────────────────────────────────────────────────
 463887302 ┤ │             │ │
 428203664 ┤ ╭───────────────│─────────────────────────────────────────────────────────────
 392520025 ┤ ╭─╮───────────╮ │─────────────────────────────────────────────────────────────
 356836386 ┤ │─╰─────────────╯─────────────────────────────────────────────────────────────
 321152748 ┤ │             │─│
 285469109 ┤ │───────────────╯
 249785471 ┤ │             │
 214101832 ┤ │             ╰╮
 178418193 ┤ │              │
 142734555 ┤ │              │╭─────────────────────────────────────────────────────────────
 107050916 ┤ │              ╰╯
  71367277 ┤ │
  35683639 ┤ │
         0 ┼─╯
                                                  cpu

last store values: [s1=128945820 s6=345616666 s3=348053780 s2=405520830 s4=414828931 s7=501372259 s5=535166279]
----
----

plot stat=write_bytes_per_second show_last_value=true
----
----

 51430 ┤ ╭─────────────╮
 48001 ┤ │             │                ╭──────────────────────────────────────────────
 44573 ┤ │             │   ╭────────────╯───╯
 41144 ┤ │             │ ╭─╯─╯
 37715 ┤ │             │ │
 34287 ┤ │             │ │                                                ╭────────────
 30858 ┤ │             ╭─╯         ╭──────────────────────────────────────╯
 27429 ┤ │             │ │╭────────╯
 24001 ┤ │             │─╯─────────────────────────────────────────────────────────────
 20572 ┤ │             │ │
 17143 ┤ │             │ │         ╭╮  ╭─╮╭──╮╭╮  ╭───────────────────╮  ╭╮╭╮╭─────────
 13715 ┤ ╭───────────────╭─────────╯╰──╯─╰╯──╰╯╰──╯───────────────────╰──╯╰╯╰╯─────────
 10286 ┤ ╭───────────────╯
  6857 ┤ │             ╰─╯
  3429 ┤ │
     0 ┼─╯
                                     write_bytes_per_second

last store values: [s6=12147 s4=12844 s7=15452 s2=23658 s1=33042 s3=48934 s5=49260]
----
----

plot stat=replicas sample=1 show_last_value=true
----
----

 47.00 ┤             ╭─╭───────────────────────────────────────────────────────────────
 46.67 ┤             │ │
 46.33 ┤             │ │
 46.00 ┤         ╭───╯ │
 45.67 ┤         │     │
 45.33 ┤         │     │
 45.00 ┤      ╭──╯     │───────────────────────────────────────────────────────────────
 44.67 ┤      │        │
 44.33 ┤      │        │
 44.00 ┤   ╭──╯        │───────────────────────────────────────────────────────────────
 43.67 ┤   │           │
 43.33 ┤   │           │
 43.00 ┼───────────────╭───────────────────────────────────────────────────────────────
 42.67 ┤               │
 42.33 ┤               │
 42.00 ┼───────────────╯
                                            replicas

last store values: [s4=43 s6=43 s7=43 s1=44 s2=45 s3=47 s5=47]
----
----

plot stat=leases sample=1 show_last_value=true
----
----

 23.00 ┤                ╭──────────────────────────────────────────────────────────────
 22.00 ┤                │
 21.00 ┤                │
 20.00 ┤                │
 19.00 ┤             ╭─╮│
 18.00 ┤         ╭───╯ ││
 17.00 ┤      ╭──╯     ╭╯
 16.00 ┤   ╭──╯        │
 15.00 ┼───────────────╭───────────────────────────────────────────────────────────────
 14.00 ┼───────────────╯───────────────────────────────────────────────────────────────
 13.00 ┤                │
 12.00 ┤                │
 11.00 ┤                │
 10.00 ┤                │
  9.00 ┤                │
  8.00 ┤                ╰──────────────────────────────────────────────────────────────
                                             leases

last store values: [s1=8 s3=14 s6=14 s2=15 s4=15 s7=15 s5=23]
----
----
