gen_cluster nodes=7
----

gen_ranges ranges=100
----

# Set the rebalance mode to use the mma store rebalancer and disable the lease
# and replicate queues so that only the mma store rebalancer is moving replicas
# or leases.
setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false 
----

gen_load rate=7000 rw_ratio=0.95 access_skew=true min_block=128 max_block=256
----

eval duration=25m samples=1 seed=42
----
OK

plot stat=cpu sample=1  show_last_value=true
----
----

 518935998 ┤╭──╮
 484340265 ┤│  ╭──╮
 449744532 ┤│  │  │
 415148799 ┤╭──│──╭────────────────────────────────────────────────────────────────────────
 380553066 ┤╭──────────────────────────────────────────────────────────────────────────────
 345957332 ┤│─────╯────────────────────────────────────────────────────────────────────────
 311361599 ┤│  │──╯
 276765866 ┤│──╯
 242170133 ┤│
 207574399 ┤│
 172978666 ┤│
 138382933 ┤│
 103787200 ┤│
  69191466 ┤│
  34595733 ┤│
         0 ┼╯
                                                  cpu

last store values: [s5=331268456 s3=360431437 s7=372260666 s2=378479479 s1=408139557 s4=414537507 s6=417796768]
----
----

plot stat=write_bytes_per_second show_last_value=true
----
----

 57790 ┤   ╭─╮
 53937 ┤   ╭──────────────────────╮──╮
 50085 ┤╭──│                      ╰────────────────────────────────────────────────────
 46232 ┤│  │
 42379 ┤│  │───────────────────────────────────────────────────────────────────────────
 38527 ┤│  │
 34674 ┤│  │
 30821 ┤│  │─╮
 26969 ┤│  │ ╰────────╮
 23116 ┤│  │          ╰────────────────────────────────────────────────────────────────
 19263 ┤│  │
 15411 ┤╭╮ │
 11558 ┤╭──────────────────────────────────────────────────────────────────────────────
  7705 ┤│
  3853 ┤│
     0 ┼╯
                                     write_bytes_per_second

last store values: [s7=10416 s6=12196 s4=12819 s1=23481 s2=40910 s3=51386 s5=51495]
----
----

plot stat=replicas sample=1 show_last_value=true
----
----

 47.00 ┤  ╭╭───────────────────────────────────────────────────────────────────────────
 46.67 ┤  ││
 46.33 ┤  ││
 46.00 ┤ ╭╯│
 45.67 ┤ │ │
 45.33 ┤ │ │
 45.00 ┤ │ │───────────────────────────────────────────────────────────────────────────
 44.67 ┤ │ │
 44.33 ┤ │ │
 44.00 ┤╭╯ │
 43.67 ┤│  │
 43.33 ┤│  │
 43.00 ┼───────────────────────────────────────────────────────────────────────────────
 42.67 ┤
 42.33 ┤
 42.00 ┼───────────────────────────────────────────────────────────────────────────────
                                            replicas

last store values: [s7=42 s4=43 s6=43 s1=45 s2=45 s3=47 s5=47]
----
----

plot stat=leases sample=1 show_last_value=true
----
----

 21.00 ┤   ╭──╮
 20.20 ┤   │  │
 19.40 ┤  ╭│  │
 18.60 ┤ ╭╯│  ╭────────────────────────────────────────────────────────────────────────
 17.80 ┤ │ │  │
 17.00 ┤ │ │  │
 16.20 ┤╭╯ │──│────────────────────────────────────────────────────────────────────────
 15.40 ┼───│──│────────────────────────────────────────────────────────────────────────
 14.60 ┼───────────────────────────────────────────────────────────────────────────────
 13.80 ┤   │
 13.00 ┤   │
 12.20 ┤   │  ╭────────────────────────────────────────────────────────────────────────
 11.40 ┤   │  │
 10.60 ┤   │  │
  9.80 ┤   │  │
  9.00 ┤   ╰──╯
                                             leases

last store values: [s1=12 s5=14 s7=14 s3=15 s4=15 s2=16 s6=18]
----
----
