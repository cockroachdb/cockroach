gen_cluster nodes=7
----

gen_ranges ranges=100
----

# Set the rebalance mode to use the mma store rebalancer and disable the lease
# and replicate queues so that only the mma store rebalancer is moving replicas
# or leases.
setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false 
----

gen_load rate=7000 rw_ratio=0.95 access_skew=true min_block=128 max_block=256
----

eval duration=50m samples=1 seed=42
----
OK

plot stat=cpu sample=1  show_last_value=true
----
----

 518935843 ┤╭╮
 484340120 ┤││
 449744397 ┤│╭─╮───────────────────────────────────────────────────────────────────────────
 415148674 ┤╭│─╭───────────────────────────────────────────────────────────────────────────
 380552951 ┤╭──────────────────────────────────────────────────────────────────────────────
 345957228 ┤│──╯
 311361506 ┤││
 276765783 ┤│╯
 242170060 ┤││
 207574337 ┤│╰─────────────────────────────────────────────────────────────────────────────
 172978614 ┤│
 138382891 ┤│
 103787169 ┤│
  69191446 ┤│
  34595723 ┤│
         0 ┼╯
                                                  cpu

last store values: [s1=222523757 s7=372646666 s5=400824599 s2=407143460 s6=411364568 s4=414770922 s3=454954693]
----
----

plot stat=write_bytes_per_second show_last_value=true
----
----

 51245 ┤╭╮    ╭────────────────────────────────────────────────────────────────────────
 47828 ┤││╭───╯                                        ╭───────────────────────────────
 44412 ┤│╰╯ ╭──────────────────────────────────────────╯───────────────────────────────
 40996 ┤││╭─╯
 37579 ┤│╭╯
 34163 ┤││
 30747 ┤││
 27330 ┤││─╮
 23914 ┤││ ╰───────────────────────────────────────────────────────────────────────────
 20498 ┤││
 17082 ┤││
 13665 ┤╭──────────────────────────────────────────────────────────────────────────────
 10249 ┤╭──────────────────────────────────────────────────────────────────────────────
  6833 ┤│
  3416 ┤│
     0 ┼╯
                                     write_bytes_per_second

last store values: [s7=10413 s6=12254 s4=12813 s2=23708 s1=45050 s5=46354 s3=51018]
----
----

plot stat=replicas sample=1 show_last_value=true
----
----

 47.00 ┤ ╭─────────────────────────────────────────────────────────────────────────────
 46.67 ┤ │
 46.33 ┤ │
 46.00 ┤╭╭─────────────────────────────────────────────────────────────────────────────
 45.67 ┤││
 45.33 ┤││
 45.00 ┤││─────────────────────────────────────────────────────────────────────────────
 44.67 ┤││
 44.33 ┤││
 44.00 ┤││
 43.67 ┤││
 43.33 ┤││
 43.00 ┼───────────────────────────────────────────────────────────────────────────────
 42.67 ┤
 42.33 ┤
 42.00 ┼───────────────────────────────────────────────────────────────────────────────
                                            replicas

last store values: [s7=42 s4=43 s6=43 s2=45 s1=46 s5=46 s3=47]
----
----

plot stat=leases sample=1 show_last_value=true
----
----

 21.00 ┤ ╭─╮
 20.27 ┤ │ │
 19.53 ┤ │ │
 18.80 ┤ │ │
 18.07 ┤╭│ ╰───────────────────────────────────────────────────────────────────────────
 17.33 ┤││
 16.60 ┤││ ╭───────────────────────────────────────────────────────────────────────────
 15.87 ┤││ │
 15.13 ┤││ │
 14.40 ┼─│─│───────────────────────────────────────────────────────────────────────────
 13.67 ┼───────────────────────────────────────────────────────────────────────────────
 12.93 ┤ │
 12.20 ┤ │
 11.47 ┤ │
 10.73 ┤ │
 10.00 ┤ ╰─────────────────────────────────────────────────────────────────────────────
                                             leases

last store values: [s1=10 s7=14 s2=15 s3=15 s4=15 s6=17 s5=18]
----
----
