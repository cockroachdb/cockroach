gen_cluster nodes=7
----

gen_ranges ranges=100
----

# Set the rebalance mode to use the mma store rebalancer and disable the lease
# and replicate queues so that only the mma store rebalancer is moving replicas
# or leases.
setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false 
----

gen_load rate=7000 rw_ratio=0.95 access_skew=true min_block=128 max_block=256
----

# TODO(kvoli): We are now generating changes, so this test is failing. Investigate:
#
# panic: programming error: unexpected multiple snapshot targets for replica change (+voter=[n1,s1 n7,s7] +non-voter=[]) changes=[{ADD_VOTER n1,s1} {ADD_VOTER n7,s7}] [recovered]

eval duration=5m samples=1 seed=42
----
OK

plot stat=cpu sample=1
----
----

 530555707 ┤   ╭───────────╮ ╭─────────────╮
 495185326 ┤ ╭─╯           │ │─────────────│───────────────────────────────────────────────
 459814946 ┤ │             │ │             │ ╭─────────────────────────────────────────────
 424444565 ┤ ╭───────────────╯╭────────────│─│╭────────────────────────────────────────────
 389074185 ┤ ╭──╮╭─╮───────╮╭──────────────╮╮│╯                                        ╭───
 353703804 ┤ │──╰╯─╰────────╯──────────────╰─╯─────────────────────────────────────────╯
 318333424 ┤ │             │╮╭─────────────╮╭╯
 282963043 ┤ │───────────────╯             ╰╯╰─────────────────────────────────────────────
 247592663 ┤ │              │
 212222283 ┤ │              ╰──────────────────────────────────────────────────────────────
 176851902 ┤ │
 141481522 ┤ │
 106111141 ┤ │
  70740761 ┤ │
  35370380 ┤ │
         0 ┼─╯
                                                  cpu
----
----
