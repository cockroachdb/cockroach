gen_cluster nodes=7
----

gen_ranges ranges=100
----

# Set the rebalance mode to use the mma store rebalancer and disable the lease
# and replicate queues so that only the mma store rebalancer is moving replicas
# or leases.
setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false split_queue_enabled=false
----

gen_load rate=7000 rw_ratio=0.95 access_skew=true min_block=128 max_block=256
----

eval duration=25m samples=1 seed=42
----
OK

plot stat=cpu sample=1  show_last_value=true
----
----

 518935998 ┤╭──╮
 484340265 ┤│  │
 449744532 ┤│  ╰──╮
 415148799 ┤╭──╭──╭────────────────────────────────────────────────────────────────────────
 380553066 ┤╭──────────────────────────────────────────────────────────────────────────────
 345957332 ┤│─────╯────────────────────────────────────────────────────────────────────────
 311361599 ┤│  │───────────────────────────────────────────────────────────────────────────
 276765866 ┤│──╯
 242170133 ┤│
 207574399 ┤│
 172978666 ┤│
 138382933 ┤│
 103787200 ┤│
  69191466 ┤│
  34595733 ┤│
         0 ┼╯
                                                  cpu

last store values: [s2=296762767 s3=341186234 s7=385696451 s1=408340240 s4=414540127 s6=415742924 s5=420043830]
----
----

plot stat=write_bytes_per_second show_last_value=true
----
----

 51390 ┤╭──╮   ╭─╮
 47964 ┤│  ╰───╯─╰─────────────────────────────────────────────────────────────────────
 44538 ┤│
 41112 ┤│
 37686 ┤│
 34260 ┤│
 30834 ┤│
 27408 ┤│
 23982 ┤│
 20556 ┤│
 17130 ┤│  ╭───────────────────────────────────────────────────────────────────────────
 13704 ┤╭────╭─────────────────────────────────────────────────────────────────────────
 10278 ┤╭────╯
  6852 ┤│
  3426 ┤│
     0 ┼╯
                                     write_bytes_per_second

last store values: [s4=12822 s7=13011 s6=14275 s5=16317 s1=47150 s2=48671 s3=49340]
----
----

plot stat=replicas sample=1 show_last_value=true
----
----

 57.00 ┤         ╭─────────────────────────────────────────────────────────────────────
 55.07 ┤         │
 53.13 ┤         │
 51.20 ┤      ╭──│─────────────────────────────────────────────────────────────────────
 49.27 ┤   ╭──╭──╯─────────────────────────────────────────────────────────────────────
 47.33 ┤   ╭──╯
 45.40 ┤   │──╯
 43.47 ┼───╯───────────────────────────────────────────────────────────────────────────
 41.53 ┤   │     │
 39.60 ┤   ╰──╮  ╰─────────────────────────────────────────────────────────────────────
 37.67 ┤      │
 35.73 ┤      ╰────────────────────────────────────────────────────────────────────────
 33.80 ┤      ╰──╮
 31.87 ┤         │
 29.93 ┤         │
 28.00 ┤         ╰─────────────────────────────────────────────────────────────────────
                                            replicas

last store values: [s1=28 s2=34 s3=38 s4=43 s5=49 s6=51 s7=57]
----
----

plot stat=leases sample=1 show_last_value=true
----
----

 18.00 ┤      ╭────────────────────────────────────────────────────────────────────────
 17.53 ┤      │
 17.07 ┤      │
 16.60 ┤      │
 16.13 ┤      │
 15.67 ┤   ╭──│────────────────────────────────────────────────────────────────────────
 15.20 ┤   │  │
 14.73 ┼───│──│────────────────────────────────────────────────────────────────────────
 14.27 ┤   │  │
 13.80 ┼───────────────────────────────────────────────────────────────────────────────
 13.33 ┤   │  │
 12.87 ┤   ╰──╮
 12.40 ┤      │
 11.93 ┤      │────────────────────────────────────────────────────────────────────────
 11.47 ┤      │
 11.00 ┤      ╰────────────────────────────────────────────────────────────────────────
                                             leases

last store values: [s2=11 s1=12 s3=14 s7=14 s4=15 s5=16 s6=18]
----
----
