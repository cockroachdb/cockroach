gen_cluster nodes=7
----

gen_ranges ranges=100
----

# Set the rebalance mode to use the mma store rebalancer and disable the lease
# and replicate queues so that only the mma store rebalancer is moving replicas
# or leases.
setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false 
----

gen_load rate=7000 rw_ratio=0.95 access_skew=true min_block=128 max_block=256
----

eval duration=5m samples=1 seed=42
----
OK

plot stat=cpu sample=1  show_last_value=true
----
----

 520042928 ┤ ╭─────────────╮
 485373399 ┤ │             │
 450703871 ┤ │             │ ╭─────────────╮─╭─────────────────────────────────────────────
 416034342 ┤ ╭───────────────╯╭──────────────╭─────────────────────────────────────────────
 381364814 ┤ ╭───────────────────────────────╯───╭───╮─────╭╮──────────────────╭╮─╭────────
 346695285 ┤ │───────────────────────────────────╯   ╰─────╯╰──────────────────╯╰─╯
 312025757 ┤ │╮            ╰─│
 277356228 ┤ │╰──────────────╯
 242686700 ┤ │              │
 208017171 ┤ │              │╭─────────────────────────────────────────────────────────────
 173347643 ┤ │              ╰╯
 138678114 ┤ │
 104008586 ┤ │
  69339057 ┤ │
  34669529 ┤ │
         0 ┼─╯
                                                  cpu

last store values: [s1=218180966 s6=364234922 s4=387831658 s2=405921450 s7=413486499 s5=436407680 s3=453304240]
----
----

plot stat=write_bytes_per_second show_last_value=true
----
----

 51430 ┤ ╭─────────────╮                                                        ╭──────
 48001 ┤ │             │      ╭─────────────────────────────────────────────────╯
 44573 ┤ │             │ ╭────╯                    ╭───────────────────────────────────
 41144 ┤ │             │ │ ╭───────────────────────╯
 37715 ┤ │             │ │─╯                           ╭───────────────────────────────
 34287 ┤ │             ╰─╯     ╭───────────────────────╯
 30858 ┤ │             ╭───────╯
 27429 ┤ │             │ ╭──────────────╮
 24001 ┤ │             │ │              ╰──────────────────────────────────────────────
 20572 ┤ │             │ ╭─────────────╮ ╭─────────────────────────────────────────────
 17143 ┤ │             │─│             ╰─╯
 13715 ┤ ╭─────────────╯╮╭─────────────────────────────────────────────────────────────
 10286 ┤ ╭─────────────────────────────────────────────────────────────────────────────
  6857 ┤ │
  3429 ┤ │
     0 ┼─╯
                                     write_bytes_per_second

last store values: [s7=10311 s5=12791 s4=19074 s2=24545 s6=37414 s1=43883 s3=49820]
----
----

plot stat=replicas sample=1 show_last_value=true
----
----

 47.00 ┤             ╭─────────────────────────────────────────────────────────────────
 46.67 ┤             │ │
 46.33 ┤             │ │
 46.00 ┤         ╭───╯ │───────────────────────────────────────────────────────────────
 45.67 ┤         │     │
 45.33 ┤         │     │
 45.00 ┤      ╭──╯     ╭───────────────────────────────────────────────────────────────
 44.67 ┤      │        │
 44.33 ┤      │        │
 44.00 ┤   ╭──╯        │───────────────────────────────────────────────────────────────
 43.67 ┤   │           │
 43.33 ┤   │           │
 43.00 ┼───────────────╯───────────────────────────────────────────────────────────────
 42.67 ┤
 42.33 ┤
 42.00 ┼───────────────────────────────────────────────────────────────────────────────
                                            replicas

last store values: [s7=42 s5=43 s4=44 s2=45 s6=45 s1=46 s3=47]
----
----

plot stat=leases sample=1 show_last_value=true
----
----

 22.00 ┤                               ╭───────────────────────────────────────────────
 21.13 ┤                ╭──────────────╯
 20.27 ┤                │
 19.40 ┤             ╭─╮│
 18.53 ┤         ╭───╯ ││
 17.67 ┤      ╭──╯     ││
 16.80 ┤      │        ╰│
 15.93 ┤   ╭──╯        ╭│──────────────╮
 15.07 ┼───────────────╭╯──────────────╭───────────────────────────────────────────────
 14.20 ┼───────────────────────────────╯───────────────────────────────────────────────
 13.33 ┤                │
 12.47 ┤                │
 11.60 ┤                │
 10.73 ┤                │
  9.87 ┤                ╰╮
  9.00 ┤                 ╰─────────────────────────────────────────────────────────────
                                             leases

last store values: [s1=9 s4=14 s6=14 s2=15 s3=15 s7=15 s5=22]
----
----
