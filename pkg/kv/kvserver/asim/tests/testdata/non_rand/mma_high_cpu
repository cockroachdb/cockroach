gen_cluster nodes=7
----

gen_ranges ranges=100
----

# Set the rebalance mode to use the mma store rebalancer and disable the lease
# and replicate queues so that only the mma store rebalancer is moving replicas
# or leases.
setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false
----

gen_load rate=7000 rw_ratio=0.95 access_skew=true min_block=128 max_block=256
----

eval duration=25m samples=1 seed=42
----
OK

plot stat=cpu sample=1  show_last_value=true
----
----

 518935998 ┤╭──╮
 484340265 ┤│  │
 449744532 ┤│  ╰──╮
 415148799 ┤╭──╭───────────────────────────────────────────────────────────────────────────
 380553066 ┤╭──────────────────────────────────────────────────────────────────────────────
 345957332 ┤│──╯                                  ╭────────────────────────────────────────
 311361599 ┤│  │───────────────────────────────────────────────────────────────────────────
 276765866 ┤│──╯
 242170133 ┤│
 207574399 ┤│
 172978666 ┤│
 138382933 ┤│
 103787200 ┤│
  69191466 ┤│
  34595733 ┤│
         0 ┼╯
                                                  cpu

last store values: [s3=317351351 s2=344013248 s7=387581749 s6=394110374 s1=404411333 s4=414508569 s5=420012272]
----
----

plot stat=write_bytes_per_second show_last_value=true
----
----

 51390 ┤╭──╮
 47964 ┤│  │───────────────────────────────────────────────────────────────────────────
 44538 ┤│  │           ╭───────────────────────────────────────────────────────────────
 41112 ┤│  ╰───────────╯
 37686 ┤│  ╰╮
 34260 ┤│   ╰──╮                                     ╭─────────────────────────────────
 30834 ┤│      ╰╭────────────────────────────────────╯
 27408 ┤│    ╭──╯                  ╰───────────────────────────────────────────────────
 23982 ┤│  ╭─╯╭─╮
 20556 ┤│  │──╯ ╰──────────────────────────────────────────────────────────────────────
 17130 ┤│  │───────────────────────────────────────────────────────────────────────────
 13704 ┤╭──│───────────────────────────────────────────────────────────────────────────
 10278 ┤╭──╯
  6852 ┤│
  3426 ┤│
     0 ┼╯
                                     write_bytes_per_second

last store values: [s4=12817 s5=16312 s6=20873 s2=28792 s7=32939 s3=43438 s1=46395]
----
----

plot stat=replicas sample=1 show_last_value=true
----
----

 55.00 ┤      ╭────────────────────────────────────────────────────────────────────────
 53.20 ┤      │
 51.40 ┤      │                                                           ╭────────────
 49.60 ┤      │                                                           │
 47.80 ┤   ╭──│────────────────────────────────────────────────────────────────────────
 46.00 ┤ ╭─│  │                              ╭───────────────╯
 44.20 ┤ │ ╭───────────────────────────────────────────────────────────────────────────
 42.40 ┼───│───────────────────────────────────────────────────────────────────────────
 40.60 ┼───╯──│
 38.80 ┤      ╰────────────────────────────────────────────────────────────────────────
 37.00 ┤      ╰──────────────────────────────╮
 35.20 ┤                                     │
 33.40 ┤                                     ╰───────────────╮
 31.60 ┤                                                     │
 29.80 ┤                                                     ╰────────────╮
 28.00 ┤                                                                  ╰────────────
                                            replicas

last store values: [s1=28 s3=40 s4=43 s7=45 s5=49 s2=52 s6=55]
----
----

plot stat=leases sample=1 show_last_value=true
----
----

 19.00 ┤  ╭╮
 18.60 ┤  ││
 18.20 ┤  ││
 17.80 ┤ ╭╯╰──╮
 17.40 ┤ │    │
 17.00 ┤ │    ╰──────────────────────────────╮
 16.60 ┤ │                                   │
 16.20 ┤ │                                   │
 15.80 ┤╭╯ ╭───────────────────────────────────────────────────────────────────────────
 15.40 ┤│  │                                                 │            │
 15.00 ┼───│──╭────────────────────────────────────────────────────────────────────────
 14.60 ┤   │  │                                              │            │
 14.20 ┤   │  │                                              │            │
 13.80 ┼───────────────────────────────────────────────────────────────────────────────
 13.40 ┤   │                                 │
 13.00 ┤   ╰─────────────────────────────────╯
                                             leases

last store values: [s1=14 s3=14 s7=14 s4=15 s6=15 s2=16 s5=16]
----
----
