gen_cluster nodes=10 node_cpu_rate_capacity=30000
----

# Read only workload, which generates 100_000 request cpu nanos/s evenly over
# the first half of the keyspace, which will be on all stores initially.
gen_ranges ranges=30 min_key=1 max_key=10000 placement_type=even
----

gen_load rate=1000 rw_ratio=1 request_cpu_per_access=100 min_key=1 max_key=10000
----

# Write only workload, which generates no CPU and 100_000 (x replication
# factor) write bytes per second over the second half of the keyspace, which
# are all on s1-s3 initially.
gen_ranges ranges=30 min_key=10001 max_key=20000 placement_type=skewed add_to_existing=true
----

gen_load rate=20000 rw_ratio=0 min_block=1000 max_block=1000 min_key=10001 max_key=20000 add_to_existing=true
----

setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false split_queue_enabled=false
----

eval duration=20m samples=1 seed=42
----
OK

plot stat=cpu show_last_value=true
----
----

 16826 ┤    ╭──╮╭──╮╭───╮                                     ╭──────╮╭──╮   ╭───╮    ╭
 15704 ┤    │  ││  ││   │                                    ╭│  │││ ││  │   │   │    │
 14582 ┤    │  ││  ││   │                                    ││  │││ ││  │   │   │    │
 13461 ┤    │  ╰│──╰│───╰───────────────────────────╮──╮──╭──╮│───╯╭───────────────────
 12339 ┤    │   │   │   │                          │││ ││ │  ││    │ │     │
 11217 ┤    │   │   │   │                          │││ ││ │  ││    │ │     │
 10095 ┤╭───────────╯───╯──────────────────────────╰╰─────╯──╰─────╯─╯     ╰───────────
  8974 ┤│  │                                                 │
  7852 ┤│  │                                                 │
  6730 ┤│  ╰────╮                                       ╭╮   ╰────╮        ╭─╮    ╭───╮
  5609 ┤│       │                                       ││        │        │ │    │   │
  4487 ┤│       │                                       ││        │        │ │    │   │
  3365 ┤│       ╰───╮                               ╭──╭╮╰───╮╭──╮╰───────╭───────╯───╰
  2243 ┤│           │                               │  ││    ││  │        │
  1122 ┤│           │                               │  ││    ││  │        │
     0 ┼╯           ╰──────────────────────────────────╯╰─────╯──╰────────╯────────────
                                              cpu

last store values: [s1=3334 s2=0 s3=3328 s4=13367 s5=13334 s6=16734 s7=13305 s8=10135 s9=13321 s10=13342]
----
----

plot stat=write_bytes_per_second show_last_value=true
----
----

 20000000 ┤╭───────╮
 18666667 ┤│   ╰───│
 17333333 ┤│   ╰───╰───────────────╮
 16000000 ┤│           ╰───────────╰────────────────────────────╮
 14666667 ┤│                    ╰────────╮        ╰╯╰───────────╰────────╮
 13333333 ┤│                             ╰────────╮                 ╰────╰─────────╮
 12000000 ┤│                                      ╰─────╮                       ╰──╰─────╮
 10666667 ┤│                                            ╰─────╮                      ╰───╰
  9333333 ┤│                                                  ╰─╮      ╭──╮
  8000000 ┤│                                                   ╭──────╭───╮╭╮─╭╮╭──╮╭─╮
  6666667 ┤│                             ╭──────────────────╮  │  ╭──╭╯───╰╯╰─╯╰╯──╰╯─╰───
  5333333 ┤│                        ╭────╯                  ╰──╭╭────╯╯     ╰─╯╰╯  ╰╯─╯  ╰
  4000000 ┤│                    ╭───╯              ╭───────╭╮╭──╯               ╭───╯
  2666667 ┤│           ╭───────────────────────────╯    ╭──╯││─╮                │
  1333333 ┤│   ╭───╭────────────────────────────────────╯───╰╯ ╰───────╮╭───────╯─────────
        0 ┼────────╯────────────────────────────────────────────────────╯──╯─╰────────────
                                        write_bytes_per_second

last store values: [s1=7319625 s2=11308450 s3=11307265 s4=5979291 s5=1986117 s6=661668 s7=1332072 s8=7330913 s9=6011971 s10=6673965]
----
----

plot stat=replicas show_last_value=true
----
----

 39.00 ┼───╮
 36.67 ┤   ╰╮                              ╭────────╮             ╭────────────────╮
 34.33 ┤   ╰╰───╮                    ╭─────╯        ╰───╮        ╭╯                ╰───
 32.00 ┤    ╰───│                    │                  ╰╮    ╭──╯                    ╭
 29.67 ┤    ╰───│                ╭───╯                   │╭───╯───╮                ╭──╯
 27.33 ┤        ╰──────────────╭─╯              ╭╮ ╭─────╭╯──╭───────────────╮  ╭──╯
 25.00 ┤            ╰──────────│╰──────────────────╯╰───╯│───│───╮ ╭─╮       ╰╮─╯
 22.67 ┤                    ╭──╯      ╰────────╮       ╭─╯ ╭─╯───╰─╯ ╰─────╮ ╰│╭╮
 20.33 ┤                   ╭╯                  ╰──────╮│ ╭─╯     ╰─────────╰──╰────────
 18.00 ┤                   │                   ╭─────╭─╯╮│──╮                ╭╯╰──────╮
 15.67 ┤            ╭──────────╮───────────────╯     │  ╰│  ╰╮               │        ╰
 13.33 ┤    ╭───────╯──────╮   ╰─────────────────────╯╭╮ │──╮╰───────────────│─────────
 11.00 ┤   ╭╯───╯──────╮╯  ╰─────────────────────────╮╯│╭╯  ╰─╮              │
  8.67 ┼───╯╯          ╰╮   ╰────────╮              ╭╰──╯╮    ╰─────╮ ╭───╮  │
  6.33 ┤                ╰──────────────────────╮────╯  ╰╰────────────╭───────╯─────────
  4.00 ┤                                       ╰─────────────────────╯───────╯
                                            replicas

last store values: [s1=13 s2=19 s3=19 s4=17 s5=8 s6=8 s7=7 s8=33 s9=20 s10=36]
----
----

plot stat=leases show_last_value=true
----
----

 33.00 ┼────╮
 30.80 ┤    ╰───╮
 28.60 ┤        ╰────────╮
 26.40 ┤                 ╰───────╮
 24.20 ┤                         ╰─────────╮
 22.00 ┤                                   ╰─────────╮
 19.80 ┤                                             ╰─────╮
 17.60 ┤                                                   ╰─╮
 15.40 ┤                                                     ╰────╮
 13.20 ┤                                                     ╭────╮──╭─────────╮──╮
 11.00 ┤                              ╭──────────────────────╯    ╭─╮╯       ╰─╰╮ ╰───╭
  8.80 ┤                         ╭────╯                      ╭──╭─╯ ╰───╮       ╰╭────╯
  6.60 ┤            ╭───╮────────╮             ╭─╮  ╭─╭─╮╭──────╯────╮  ╰──────────╮  ╰
  4.40 ┤   ╭╭───────╯───╰────────────────────────────────╯─╯─────────╰─────────────╰───
  2.20 ┼────╯───╯───╯                              ╰╯  ╰─╯               ╭╯╰╯───╯ ╰─╯ ╰
  0.00 ┤        ╰────────────────────────────────────────────────────────╯╯
                                             leases

last store values: [s1=12 s2=4 s3=3 s4=7 s5=5 s6=5 s7=4 s8=11 s9=4 s10=5]
----
----
