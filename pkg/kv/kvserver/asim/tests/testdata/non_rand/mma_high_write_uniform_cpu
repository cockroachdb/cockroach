gen_cluster nodes=10 node_cpu_rate_capacity=30000
----

# Read only workload, which generates 100_000 request cpu nanos/s evenly over
# the first half of the keyspace, which will be on all stores initially.
gen_ranges ranges=30 min_key=1 max_key=10000 placement_type=even
----

gen_load rate=1000 rw_ratio=1 request_cpu_per_access=100 min_key=1 max_key=10000
----

# Write only workload, which generates no CPU and 100_000 (x replication
# factor) write bytes per second over the second half of the keyspace, which
# are all on s1-s3 initially.
gen_ranges ranges=30 min_key=10001 max_key=20000 placement_type=skewed
----

gen_load rate=20000 rw_ratio=0 min_block=1000 max_block=1000 min_key=10001 max_key=20000
----

setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false split_queue_enabled=false
----

eval duration=20m samples=1 seed=42
----
OK

plot stat=cpu
----
 0.00 ┼───────────────────────────────────────────────────────────────────────────────
                                             cpu
initial store values: [s1=0, s2=0, s3=0, s4=0, s5=0, s6=0, s7=0, s8=0, s9=0, s10=0] (stddev=0.00, mean=0.00, sum=0)
last store values: [s1=0, s2=0, s3=0, s4=0, s5=0, s6=0, s7=0, s8=0, s9=0, s10=0] (stddev=0.00, mean=0.00, sum=0)

plot stat=write_bytes_per_second
----
 40000000 ┤╭───╮
 37333333 ┤│   ╰───╮
 34666667 ┤│   ╰───│
 32000000 ┤│       ╰───╮╮
 29333333 ┤│        │  ╰───╮
 26666667 ┤│        ╰────╮╮│
 24000000 ┤│             ╰╮│╮
 21333333 ┤│              ╰╰──╮
 18666667 ┤│               ╰╮╰╰╮
 16000000 ┤│                ╰─╮╰──╭╮
 13333333 ┤│                ╭╮╭────╭──────────────────────────────────────────────────────
 10666667 ┤│               ╭╭──────╯──────────────────────────────────────────────────────
  8000000 ┤│             ╭─╭╯─────╯─╯
  5333333 ┤│       ╭─────╭─╯╯──╯
  2666667 ┤│   ╭───╮╭────╯─╯
        0 ┼─────────╯
                                        write_bytes_per_second
initial store values: [s1=0, s2=0, s3=0, s4=0, s5=0, s6=0, s7=0, s8=0, s9=0, s10=0] (stddev=0.00, mean=0.00, sum=0)
last store values: [s1=13308481, s2=13311985, s3=11979172, s4=10699427, s5=10693684, s6=10658015, s7=11989053, s8=13359801, s9=10658583, s10=13322905] (stddev=1184540.27, mean=11998110.60, sum=119981106)

plot stat=replicas
----
 39.00 ┼────╮
 37.00 ┤    ╰───╮
 35.00 ┤    ╰───╰╮
 33.00 ┤        ╰╰──╮╮
 31.00 ┤         │  ╰───╮
 29.00 ┤         ╰────╮╮│
 27.00 ┤              ╰─│╮
 25.00 ┤                ╰──╮
 23.00 ┤                ╰╮╰╰─╮
 21.00 ┤                 ╰─╮╰╰─╮
 19.00 ┤                   ╭────╭──────────────────────────────────────────────────────
 17.00 ┤                ╭──╯╭───╯──────────────────────────────────────────────────────
 15.00 ┤                ╭───╯─╯──╯
 13.00 ┤        ╭╭───╭╭─╯╯╯─╯
 11.00 ┤        ╭╭────╯─╯
  9.00 ┼─────────╯
                                            replicas
initial store values: [s1=39, s2=39, s3=39, s4=9, s5=9, s6=9, s7=9, s8=9, s9=9, s10=9] (stddev=13.75, mean=18.00, sum=180)
last store values: [s1=19, s2=19, s3=18, s4=17, s5=17, s6=17, s7=18, s8=19, s9=17, s10=19] (stddev=0.89, mean=18.00, sum=180)

plot stat=leases
----
 33.00 ┼────╮
 31.00 ┤    │
 29.00 ┤    ╰───╮
 27.00 ┤        ╰────╮
 25.00 ┤             ╰╮
 23.00 ┤              ╰╮
 21.00 ┤               ╰─╮
 19.00 ┤                 ╰╮
 17.00 ┤                  ╰─╮
 15.00 ┤                    ╰─╮
 13.00 ┤                      ╰────────────────────────────────────────────────────────
 11.00 ┤
  9.00 ┤
  7.00 ┤                 ╭─────────────────────────────────────────────────────────────
  5.00 ┤        ╭╭───────╯────╯────────────────────────────────────────────────────────
  3.00 ┼─────────╯─────╯───────────────────────────────────────────────────────────────
                                             leases
initial store values: [s1=33, s2=3, s3=3, s4=3, s5=3, s6=3, s7=3, s8=3, s9=3, s10=3] (stddev=9.00, mean=6.00, sum=60)
last store values: [s1=13, s2=3, s3=3, s4=8, s5=4, s6=7, s7=5, s8=3, s9=7, s10=7] (stddev=2.97, mean=6.00, sum=60)
