gen_cluster nodes=10 node_cpu_rate_capacity=30000
----

# Read only workload, which generates 100_000 request cpu nanos/s evenly over
# the first half of the keyspace, which will be on all stores initially.
gen_ranges ranges=30 min_key=1 max_key=10000 placement_type=even
----

gen_load rate=1000 rw_ratio=1 request_cpu_per_access=100 min_key=1 max_key=10000
----

# Write only workload, which generates no CPU and 100_000 (x replication
# factor) write bytes per second over the second half of the keyspace, which
# are all on s1-s3 initially.
gen_ranges ranges=30 min_key=10001 max_key=20000 placement_type=skewed add_to_existing=true
----

gen_load rate=1000 rw_ratio=0 min_block=100 max_block=100 min_key=10001 max_key=20000 add_to_existing=true
----

setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false split_queue_enabled=false
----

eval duration=30m samples=1 seed=42
----
OK

plot stat=cpu show_last_value=true
----
----

 10357 ┤╭╮╭─╭╮╭╮─╭──╮╭╮─╭─────╮╭╭╮────╭────╮────╭────────────────────────────╮─────────
  9667 ┤│╰──╯╰╯╰─╯──╰╯╰─╯─────╰─╯╰────╯────╰────╯────────╰──╯╰───────────────╰─────────
  8976 ┤│
  8286 ┤│
  7595 ┤│
  6905 ┤│
  6214 ┤│
  5524 ┤│
  4833 ┤│
  4143 ┤│
  3452 ┤│
  2762 ┤│
  2071 ┤│
  1381 ┤│
   690 ┤│
     0 ┼╯
                                              cpu

last store values: [s7=9953 s2=9956 s6=9962 s9=9971 s5=9986 s1=9991 s10=10004 s4=10039 s3=10059 s8=10108]
----
----

plot stat=write_bytes_per_second show_last_value=true
----
----

 100000 ┤╭─╮
  93333 ┤│ ╰──╮
  86667 ┤│ ╰──╰─╮
  80000 ┤│    │─╰╮
  73333 ┤│    │  ╰─╮
  66667 ┤│    ╰─╮╰─│╮
  60000 ┤│      ╰╮ │╰─╮
  53333 ┤│       ╰─╰╮ ╰──╮
  46667 ┤│          ╰─╮  ╰──╮
  40000 ┤│            │     ╰─╮
  33333 ┤│            ╭──╭╮───────────╭─╮───╭─╮─────────────────────────────────────────
  26667 ┤│         ╭╭──╭─╯╰─────────────────────────────────────────────────────────────
  20000 ┤│      ╭───╭──╯───────────────────────────────────╯╰──╯  ╰╯
  13333 ┤│    ╭─╭───╯──╯
   6667 ┤│ ╭────╯───╯
      0 ┼──╯─╯╯
                                      write_bytes_per_second

last store values: [s8=23344 s6=26678 s9=29912 s10=29946 s7=30044 s5=30054 s4=30117 s1=33260 s3=33297 s2=33342]
----
----

plot stat=replicas show_last_value=true
----
----

 39.00 ┼──╮
 37.00 ┤  ╰──╮
 35.00 ┤  ╰──╰─╮
 33.00 ┤     │─╰╮
 31.00 ┤     │  ╰─╮
 29.00 ┤     ╰─╮╰─│╮
 27.00 ┤       ╰╮ │╰─╮
 25.00 ┤        ╰─╰╮ ╰──╮
 23.00 ┤           ╰─╮  ╰──╮
 21.00 ┤             │     ╰─╮
 19.00 ┤             ╰─────────────────────────────────────────────────────────────────
 17.00 ┤           ╭─╭─────────────────────────────────────────────────────────────────
 15.00 ┤        ╭──╭─╯─────────────────────────────────────────────────────────────────
 13.00 ┤     ╭─╭───╯─╯
 11.00 ┤     ╭─╯───╯
  9.00 ┼─────╯
                                            replicas

last store values: [s8=16 s6=17 s4=18 s5=18 s7=18 s9=18 s10=18 s1=19 s2=19 s3=19]
----
----

plot stat=leases show_last_value=true
----
----

 33.00 ┼──╮
 31.00 ┤  │
 29.00 ┤  ╰──╮
 27.00 ┤     ╰──╮
 25.00 ┤        │
 23.00 ┤        ╰──╮
 21.00 ┤           ╰─╮
 19.00 ┤             ╰──╮
 17.00 ┤                ╰──╮
 15.00 ┤                   ╰─╮
 13.00 ┤                     ╰─────────────────────────────────────────────────────────
 11.00 ┤
  9.00 ┤
  7.00 ┤           ╭────╭──────────────────────────────────────────────────────────────
  5.00 ┤     ╭──╭───────╯────╭─────────────────────────────────────────────────────────
  3.00 ┼────────╯────────────╯─────────────────────────────────────────────────────────
                                             leases

last store values: [s2=3 s3=3 s7=3 s8=5 s4=6 s6=6 s5=7 s9=7 s10=7 s1=13]
----
----
