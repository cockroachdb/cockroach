gen_cluster nodes=7
----

# The placement will be skewed, s.t. n1/s1, n2/s2 and n3/s3 will have every
# replicas initially and n1/s1 will have every lease.
gen_ranges ranges=100 placement_skew=true
----

# Set the rebalance mode to use the mma store rebalancer and disable the lease
# and replicate queues so that only the mma store rebalancer is moving replicas
# or leases.
setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false  split_queue_enabled=false
----

gen_load rate=7000 rw_ratio=0.95 access_skew=false min_block=128 max_block=256
----

eval duration=5m samples=1 seed=42
----
OK

plot stat=cpu sample=1  show_last_value=true
----
----

 6255866492 ┤ ╭─────────────────────────────────────────────────────────────────────────────
 5838808726 ┤ │
 5421750960 ┤ │
 5004693194 ┤ │
 4587635427 ┤ │
 4170577661 ┤ │
 3753519895 ┤ │
 3336462129 ┤ │
 2919404363 ┤ │
 2502346597 ┤ │
 2085288831 ┤ │
 1668231065 ┤ │
 1251173298 ┤ │
  834115532 ┤ │
  417057766 ┤ ╭─────────────────────────────────────────────────────────────────────────────
          0 ┼───────────────────────────────────────────────────────────────────────────────
                                                   cpu

last store values: [s4=0 s5=0 s6=0 s7=0 s2=346916666 s3=346916666 s1=6252989999]
----
----

plot stat=write_bytes_per_second show_last_value=true
----
----

 67429 ┤ ╭─────────────────────────────────────────────────────────────────────────────
 62934 ┤ │
 58439 ┤ │
 53943 ┤ │
 49448 ┤ │
 44953 ┤ │
 40457 ┤ │
 35962 ┤ │
 31467 ┤ │
 26972 ┤ │
 22476 ┤ │
 17981 ┤ │
 13486 ┤ │
  8991 ┤ │
  4495 ┤ │
     0 ┼───────────────────────────────────────────────────────────────────────────────
                                     write_bytes_per_second

last store values: [s4=0 s5=0 s6=0 s7=0 s1=67182 s2=67182 s3=67182]
----
----

plot stat=replicas sample=1 show_last_value=true
----
----

 100.00 ┼───────────────────────────────────────────────────────────────────────────────
  93.33 ┤
  86.67 ┤
  80.00 ┤
  73.33 ┤
  66.67 ┤
  60.00 ┤
  53.33 ┤
  46.67 ┤
  40.00 ┤
  33.33 ┤
  26.67 ┤
  20.00 ┤
  13.33 ┤
   6.67 ┤
   0.00 ┼───────────────────────────────────────────────────────────────────────────────
                                             replicas

last store values: [s4=0 s5=0 s6=0 s7=0 s1=100 s2=100 s3=100]
----
----

plot stat=leases sample=1 show_last_value=true
----
----

 100.00 ┼───────────────────────────────────────────────────────────────────────────────
  93.33 ┤
  86.67 ┤
  80.00 ┤
  73.33 ┤
  66.67 ┤
  60.00 ┤
  53.33 ┤
  46.67 ┤
  40.00 ┤
  33.33 ┤
  26.67 ┤
  20.00 ┤
  13.33 ┤
   6.67 ┤
   0.00 ┼───────────────────────────────────────────────────────────────────────────────
                                              leases

last store values: [s2=0 s3=0 s4=0 s5=0 s6=0 s7=0 s1=100]
----
----
