gen_cluster nodes=7 node_cpu_rate_capacity=700000000
----

# The placement will be skewed, s.t. n1/s1, n2/s2 and n3/s3 will have every
# replicas initially and n1/s1 will have every lease.
gen_ranges ranges=100 placement_skew=true
----

# Set the rebalance mode to use the mma store rebalancer and disable the lease
# and replicate queues so that only the mma store rebalancer is moving replicas
# or leases.
setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false  split_queue_enabled=false
----

gen_load rate=7000 rw_ratio=0.95 access_skew=false min_block=128 max_block=256
----

eval duration=25m samples=1 seed=42
----
OK

plot stat=cpu sample=1  show_last_value=true
----
----

 6252940909 ┤╭─────╮
 5836078182 ┤│     ╰────────╮
 5419215454 ┤│              ╰────────────╮
 5002352727 ┤│                           ╰────────╮
 4585490000 ┤│                                    ╰─────────╮
 4168627273 ┤│                                              ╰────────────╮
 3751764545 ┤│                                                           ╰──────────────────
 3334901818 ┤│
 2918039091 ┤│
 2501176364 ┤│
 2084313636 ┤│
 1667450909 ┤│
 1250588182 ┤│
  833725455 ┤│                                                       ╭──────────────────────
  416862727 ┤╭───────────────╭──╭────────────────────────────────────╯╯╰─╯─────╯────────────
          0 ┼───────────────────╯─────────────────────╯
                                                   cpu

last store values: [s3=225120415 s2=614443984 s5=628224494 s6=628248087 s7=628897798 s4=639987959 s1=3572494413]
----
----

plot stat=write_bytes_per_second show_last_value=true
----
----

 67233 ┤╭───────────╮
 62751 ┤│     ╰──╰──╰─────────╮
 58269 ┤│              ╰╯─╰╯╰─╰───────────╮
 53786 ┤│                           ╰──╰──╰─────────╮
 49304 ┤│                                    ╰╯──╰──╰────────╮
 44822 ┤│                                              ╰───╰─╰─────────────────────────
 40340 ┤│                                                       ╰╯  ╰──────────────────
 35858 ┤│
 31375 ┤│
 26893 ┤│
 22411 ┤│                                                                 ╭──╮─────────
 17929 ┤│                                              ╭──╭────────────────────────────
 13447 ┤│                                 ╭──╭────────────╯────────────╯
  8964 ┤│                     ╭──────────────╯────────────╯
  4482 ┤│           ╭─────────╯──╯─╰╯╯
     0 ┼────────────╯──╯
                                     write_bytes_per_second

last store values: [s6=18734 s5=18761 s7=18805 s4=20841 s2=39475 s1=40911 s3=43611]
----
----

plot stat=replicas sample=1 show_last_value=true
----
----

 100.00 ┼────────────╮
  93.33 ┤      ╰──╰──╰────────────╮
  86.67 ┤                  ╰───╰──╰────────╮
  80.00 ┤                            ╰──╰──╰─────────╮
  73.33 ┤                                     ╰───╰──╰───────────╮
  66.67 ┤                                                  ╰──╰──╰──────────────────────
  60.00 ┤                                                            ╰──────────────────
  53.33 ┤
  46.67 ┤
  40.00 ┤
  33.33 ┤                                                                  ╭──╮─────────
  26.67 ┤                                               ╭──╭────────────────────────────
  20.00 ┤                                  ╭──╭────────────╯────────────╯
  13.33 ┤                      ╭──────────────╯────────────╯
   6.67 ┤            ╭─────────╯──╯
   0.00 ┼────────────╯──╯
                                             replicas

last store values: [s5=28 s6=28 s7=28 s4=31 s2=59 s1=61 s3=65]
----
----

plot stat=leases sample=1 show_last_value=true
----
----

 100.00 ┼──────╮
  93.33 ┤      ╰───────────╮
  86.67 ┤                  ╰─────────╮
  80.00 ┤                            ╰────────╮
  73.33 ┤                                     ╰────────────╮
  66.67 ┤                                                  ╰─────────╮
  60.00 ┤                                                            ╰──────────────────
  53.33 ┤
  46.67 ┤
  40.00 ┤
  33.33 ┤
  26.67 ┤
  20.00 ┤
  13.33 ┤
   6.67 ┤               ╭───╭──╭────────────────────────────────────────────────────────
   0.00 ┼──────────────────────╯────────────────────────╯───────────────────────────────
                                              leases

last store values: [s3=0 s2=7 s4=9 s5=9 s6=9 s7=9 s1=57]
----
----
