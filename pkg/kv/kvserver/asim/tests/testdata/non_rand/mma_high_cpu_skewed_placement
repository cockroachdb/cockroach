gen_cluster nodes=7 node_cpu_rate_capacity=700000000
----

# The placement will be skewed, s.t. n1/s1, n2/s2 and n3/s3 will have every
# replicas initially and n1/s1 will have every lease.
gen_ranges ranges=100 placement_skew=true
----

# Set the rebalance mode to use the mma store rebalancer and disable the lease
# and replicate queues so that only the mma store rebalancer is moving replicas
# or leases.
setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false  split_queue_enabled=false
----

gen_load rate=7000 rw_ratio=0.95 access_skew=false min_block=128 max_block=256
----

eval duration=5m samples=1 seed=42
----
OK

plot stat=cpu sample=1  show_last_value=true
----
----

 6253460493 ┤ ╭─────────────────────────────╮
 5836563127 ┤ │                             ╰───────────────────────────────────────────────
 5419665761 ┤ │
 5002768395 ┤ │
 4585871029 ┤ │
 4168973662 ┤ │
 3752076296 ┤ │
 3335178930 ┤ │
 2918281564 ┤ │
 2501384197 ┤ │
 2084486831 ┤ │
 1667589465 ┤ │
 1250692099 ┤ │
  833794732 ┤ │
  416897366 ┤ ╭─────────────────────────────────────────────────────────────────────────────
          0 ┼───────────────────────────────────────────────────────────────────────────────
                                                   cpu

last store values: [s4=10366604 s7=139747331 s5=186550074 s6=199875326 s2=325374635 s3=332675915 s1=5748276666]
----
----

plot stat=write_bytes_per_second show_last_value=true
----
----

 67429 ┤ ╭─────────────────────────────────────────────╮╭──────────────╮
 62934 ┤ │                             ╰─╯─────────────╰╯──────────────╰───────────────
 58439 ┤ │
 53943 ┤ │
 49448 ┤ │
 44953 ┤ │
 40457 ┤ │
 35962 ┤ │
 31467 ┤ │
 26972 ┤ │
 22476 ┤ │
 17981 ┤ │
 13486 ┤ │
  8991 ┤ │
  4495 ┤ │                                                ╭─╮          ╭───────────────
     0 ┼───────────────────────────────────────────────────────────────╯───────────────
                                     write_bytes_per_second

last store values: [s5=2013 s4=2020 s7=4010 s6=4114 s1=61689 s2=62972 s3=64384]
----
----

plot stat=replicas sample=1 show_last_value=true
----
----

 100.00 ┼───────────────────────────────────────────────────────────────╮
  93.33 ┤                               ╰───────────────╰───────────────╰───────────────
  86.67 ┤
  80.00 ┤
  73.33 ┤
  66.67 ┤
  60.00 ┤
  53.33 ┤
  46.67 ┤
  40.00 ┤
  33.33 ┤
  26.67 ┤
  20.00 ┤
  13.33 ┤
   6.67 ┤                                                               ╭───────────────
   0.00 ┼───────────────────────────────────────────────────────────────╯───────────────
                                             replicas

last store values: [s4=3 s5=3 s6=6 s7=6 s1=92 s2=94 s3=96]
----
----

plot stat=leases sample=1 show_last_value=true
----
----

 100.00 ┼───────────────────────────────╮
  93.33 ┤                               ╰───────────────────────────────────────────────
  86.67 ┤
  80.00 ┤
  73.33 ┤
  66.67 ┤
  60.00 ┤
  53.33 ┤
  46.67 ┤
  40.00 ┤
  33.33 ┤
  26.67 ┤
  20.00 ┤
  13.33 ┤
   6.67 ┤
   0.00 ┼───────────────────────────────────────────────────────────────────────────────
                                              leases

last store values: [s2=0 s3=0 s4=0 s7=2 s5=3 s6=3 s1=92]
----
----
