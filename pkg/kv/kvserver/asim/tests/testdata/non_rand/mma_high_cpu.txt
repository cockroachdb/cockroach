skip_under_ci
----

gen_cluster nodes=10 node_cpu_rate_capacity=8000000000
----

# Set the rebalance mode to use the mma store rebalancer and disable the lease
# and replicate queues so that only the mma store rebalancer is moving replicas
# or leases.
setting split_queue_enabled=false
----

# This workload will be initially evenly distributed over the cluster.
gen_ranges ranges=100 min_key=0 max_key=10000
----

gen_load rate=5000 rw_ratio=0.95 min_block=100 max_block=100 request_cpu_per_access=100 raft_cpu_per_write=20 min_key=0 max_key=10000
----

# Another workload is added over the second half of the keyspace, which is initially
# only on s1-s3.
gen_ranges ranges=50 min_key=10001 max_key=20000 placement_type=skewed
----

gen_load rate=5000 rw_ratio=0.95 min_block=128 max_block=128 request_cpu_per_access=100000 raft_cpu_per_write=20000 min_key=10001 max_key=20000
----

eval duration=15m samples=1 seed=42 cfgs=(mma-only,mma-count) metrics=(cpu,write_bytes_per_second,replicas,leases)
----
cpu#1: last:  [s1=274870057, s2=124118783, s3=42166496, s4=21298975, s5=10805903, s6=10577758, s7=453407, s8=10306222, s9=10413474, s10=10503921] (stddev=81956672.84, mean=51551499.60, sum=515514996)
cpu#1: thrash_pct: [s1=7%, s2=6%, s3=4%, s4=3%, s5=2%, s6=2%, s7=0%, s8=2%, s9=2%, s10=2%]  (sum=30%)
leases#1: first: [s1=37, s2=22, s3=14, s4=13, s5=11, s6=11, s7=10, s8=11, s9=10, s10=11] (stddev=8.07, mean=15.00, sum=150)
leases#1: last:  [s1=37, s2=22, s3=14, s4=13, s5=11, s6=11, s7=10, s8=11, s9=10, s10=11] (stddev=8.07, mean=15.00, sum=150)
leases#1: thrash_pct: [s1=0%, s2=0%, s3=0%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%, s10=0%]  (sum=0%)
replicas#1: first: [s1=80, s2=70, s3=51, s4=42, s5=37, s6=35, s7=34, s8=33, s9=34, s10=34] (stddev=16.02, mean=45.00, sum=450)
replicas#1: last:  [s1=80, s2=70, s3=51, s4=42, s5=37, s6=35, s7=34, s8=33, s9=34, s10=34] (stddev=16.02, mean=45.00, sum=450)
replicas#1: thrash_pct: [s1=0%, s2=0%, s3=0%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%, s10=0%]  (sum=0%)
write_bytes_per_second#1: last:  [s1=39511, s2=33080, s3=20899, s4=15208, s5=11942, s6=10699, s7=10093, s8=9465, s9=10055, s10=10043] (stddev=10247.09, mean=17099.50, sum=170995)
write_bytes_per_second#1: thrash_pct: [s1=13%, s2=18%, s3=20%, s4=19%, s5=17%, s6=16%, s7=14%, s8=14%, s9=17%, s10=16%]  (sum=165%)
artifacts[mma-only]: bd71a8872f557e0f
==========================
cpu#1: last:  [s1=172958439, s2=103077201, s3=51834573, s4=41708935, s5=21208167, s6=20905916, s7=20909314, s8=20775784, s9=11084988, s10=51056705] (stddev=47828067.35, mean=51552002.20, sum=515520022)
cpu#1: thrash_pct: [s1=10%, s2=8%, s3=15%, s4=6%, s5=4%, s6=4%, s7=5%, s8=3%, s9=2%, s10=8%]  (sum=64%)
leases#1: first: [s1=37, s2=22, s3=14, s4=13, s5=11, s6=11, s7=10, s8=11, s9=10, s10=11] (stddev=8.07, mean=15.00, sum=150)
leases#1: last:  [s1=20, s2=17, s3=14, s4=16, s5=12, s6=15, s7=13, s8=13, s9=15, s10=15] (stddev=2.19, mean=15.00, sum=150)
leases#1: thrash_pct: [s1=0%, s2=0%, s3=15%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%, s10=9%]  (sum=24%)
replicas#1: first: [s1=80, s2=70, s3=51, s4=42, s5=37, s6=35, s7=34, s8=33, s9=34, s10=34] (stddev=16.02, mean=45.00, sum=450)
replicas#1: last:  [s1=46, s2=47, s3=44, s4=45, s5=44, s6=44, s7=44, s8=47, s9=44, s10=45] (stddev=1.18, mean=45.00, sum=450)
replicas#1: thrash_pct: [s1=0%, s2=0%, s3=0%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%, s10=0%]  (sum=0%)
write_bytes_per_second#1: last:  [s1=23183, s2=23453, s3=17983, s4=17122, s5=15710, s6=14489, s7=14531, s8=14469, s9=14906, s10=15172] (stddev=3300.69, mean=17101.80, sum=171018)
write_bytes_per_second#1: thrash_pct: [s1=58%, s2=71%, s3=68%, s4=38%, s5=33%, s6=27%, s7=27%, s8=25%, s9=39%, s10=37%]  (sum=422%)
artifacts[mma-count]: 669177d3004af538
==========================
