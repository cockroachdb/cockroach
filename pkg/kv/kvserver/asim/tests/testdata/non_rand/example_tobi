gen_cluster nodes=6 node_cpu_rate_capacity=5000000000
----

gen_ranges ranges=72 min_key=1 max_key=10000 placement_type=replica_placement bytes=268435456
{s1,s2,s3}:1
----
{s1:*,s2,s3}:1

# 5ms of request CPU per access and 500µs of raft CPU per write @ 1000/s.
gen_load rate=1000 rw_ratio=0.95 min_block=100 max_block=100 request_cpu_per_access=5000000 raft_cpu_per_write=500000 min_key=1 max_key=10000
----

# Idle ranges on n4-n6.
gen_ranges ranges=72 min_key=10001 max_key=20000 placement_type=replica_placement bytes=268435456
{s4,s5,s6}:1
----
{s4:*,s5,s6}:1

setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false split_queue_enabled=false
----

eval duration=25m samples=1 seed=42
----
OK

plot stat=cpu sample=1
----
 750000000 ┤╭──╮
 700000000 ┤│  ╰╮
 650000000 ┤│   │
 600000000 ┤│   ╰──╮
 550000000 ┤│      ╰───╮
 500000000 ┤│          ╰──╮
 450000000 ┤│             ╰──╮
 400000000 ┤│                │╭──╮
 350000000 ┤│                ╰╯  ╰──╮
 300000000 ┤│   ╭──╮╭───╮╮╭──╮╭╮───╮╭─╮──╮
 250000000 ┤╭───╯  ╰╯   ╰─╯  ╰╯╰───────────────────────────────────────────────────────────
 200000000 ┤│                            ╭─────────────────────────────────────────────────
 150000000 ┤│                    ╭─────╭───────────────────────────────────────────────────
 100000000 ┤│               ╭────╭─────╯╯
  50000000 ┤│      ╭───╭─────────╯
         0 ┼───────────╯
                                                  cpu
initial store values: [s1=0, s2=0, s3=0, s4=0, s5=0, s6=0] (stddev=0.00, mean=0.00, sum=0)
last store values: [s1=243131661, s2=246646297, s3=243957019, s4=153233368, s5=215074201, s6=142976078] (stddev=43391117.35, mean=207503104.00, sum=1245018624)

plot stat=leases sample=1
----
 86.00 ┤                            ╭──────────────────────────────────────────────────
 80.27 ┤            ╭───────────────╯
 74.53 ┼────────────╯
 68.80 ┤   │
 63.07 ┤   ╰╮
 57.33 ┤    ╰──╮
 51.60 ┤       │
 45.87 ┤       ╰───╮
 40.13 ┤           ╰──╮
 34.40 ┤              │
 28.67 ┤              ╰──╮
 22.93 ┤                 ╰───╮
 17.20 ┤                     ╰──╭─╭────────────────────────────────────────────────────
 11.47 ┤       ╭╮  ╭╮─╭──╭────────╭────────────────────────────────────────────────────
  5.73 ┤   ╭───╭───╭──────────────╯  ╰─────────────────────────────────────────────────
  0.00 ┼───────────╯
                                             leases
initial store values: [s1=72, s2=0, s3=0, s4=72, s5=0, s6=0] (stddev=33.94, mean=24.00, sum=144)
last store values: [s1=7, s2=11, s3=10, s4=86, s5=19, s6=11] (stddev=27.96, mean=24.00, sum=144)

plot stat=replicas
----
 96.00 ┤                              ╭────────────────────────────────────────────────
 92.93 ┤                             ╭╭────────────────────────────────────────────────
 89.87 ┤                         ╭─╭──╯
 86.80 ┤                     ╭─╭───╯ ╭─────────────────────────────────────────────────
 83.73 ┤                 ╭───╭─╯─────╯
 80.67 ┤             ╭───╭───╯
 77.60 ┤        ╭──╭╭────╯
 74.53 ┤   ╭───╭────╯
 71.47 ┼───────╯───╮──────────╮
 68.40 ┤        ╰──╰╮         ╰─────╮
 65.33 ┤            ╰────╮          ╰╮
 62.27 ┤                ╰╰─╮         ╰╮
 59.20 ┤                 ╰─╰─╮╮       ╰────────────────────────────────────────────────
 56.13 ┤                     ╰────╮
 53.07 ┤                          ╰────────────────────────────────────────────────────
 50.00 ┤                              ╰────────────────────────────────────────────────
                                            replicas
initial store values: [s1=72, s2=72, s3=72, s4=72, s5=72, s6=72] (stddev=0.00, mean=72.00, sum=432)
last store values: [s1=57, s2=50, s3=51, s4=87, s5=96, s6=91] (stddev=19.63, mean=72.00, sum=432)

plot stat=write_bytes_per_second
----
 5000 ┤╭──╮╭─╮
 4667 ┤│  ╰╯─╰╮╭───╮────╮╭─────╮
 4333 ┤│      ╰╯  ╰╰────╮╯     ╰────╮
 4000 ┤│               ╰│╭──╮       ╰─────────────────────────────────────────────────
 3667 ┤│                ╰╯  ╰──╮─╮ ╭─╮   ╭─╮                        ╭──╮    ╭────╮╭─╮
 3333 ┤│                ╰╯     ╰───╯ ╰───╯─╰────────────────────────╯──╰────╯────╰╯─╰─
 3000 ┤│
 2667 ┤│
 2333 ┤│
 2000 ┤│
 1667 ┤│                             ╭────────────────────────────────────────────────
 1333 ┤│                          ╭───────────────────────────────────────────────────
 1000 ┤│                ╭────╭────╯╭──────────────────────────────────────────────────
  667 ┤│           ╭╮  ╭╭────╯─────╯
  333 ┤│      ╭───╭─────╯
    0 ┼───────────╯
                                    write_bytes_per_second
initial store values: [s1=0, s2=0, s3=0, s4=0, s5=0, s6=0] (stddev=0.00, mean=0.00, sum=0)
last store values: [s1=3900, s2=3418, s3=3498, s4=1076, s5=1679, s6=1339] (stddev=1143.61, mean=2485.00, sum=14910)
