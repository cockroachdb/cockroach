gen_cluster nodes=6 node_cpu_rate_capacity=5000000000
----

gen_ranges ranges=72 min_key=1 max_key=10000 placement_type=replica_placement bytes=268435456
{s1,s2,s3}:1
----
{s1:*,s2,s3}:1

# 5ms of request CPU per access and 500µs of raft CPU per write @ 1000/s.
gen_load rate=1000 rw_ratio=0.95 min_block=100 max_block=100 request_cpu_per_access=5000000 raft_cpu_per_write=500000 min_key=1 max_key=10000
----

# Idle ranges on n4-n6.
gen_ranges ranges=72 min_key=10001 max_key=20000 placement_type=replica_placement bytes=268435456
{s4,s5,s6}:1
----
{s4:*,s5,s6}:1

setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false split_queue_enabled=false
----

eval duration=25m samples=1 seed=42
----
OK

plot stat=cpu sample=1
----
 5024999999 ┤╭──╮
 4689999999 ┤│  ╰╮
 4354999999 ┤│   ╰╮
 4019999999 ┤│    ╰─╮
 3684999999 ┤│      ╰───╮
 3349999999 ┤│          ╰╮
 3014999999 ┤│           ╰╮
 2680000000 ┤│            ╰───╮
 2345000000 ┤│                ╰╮
 2010000000 ┤│                 ╰──────╮
 1675000000 ┤│                        ╰──╮
 1340000000 ┤│                           ╰─────╮
 1005000000 ┤│                     ╭───────────────────╭───────────────╮╭─╮─────────────────
  670000000 ┤│           ╭─────────╯  ╭───╭─────────────────────────────────────────────────
  335000000 ┤│   ╭─╭──────────────────────╯───╯
          0 ┼──────╯╯
                                                   cpu
initial store values: [s1=0, s2=0, s3=0, s4=0, s5=0, s6=0] (stddev=0.00, mean=0.00, sum=0)
last store values: [s1=910630012, s2=917480074, s3=915605499, s4=726526725, s5=835471520, s6=761180308] (stddev=77132610.86, mean=844482356.33, sum=5066894138)

plot stat=leases sample=1
----
 82.00 ┤                         ╭─────────────────────────────────────────────────────
 76.53 ┤      ╭──────────────────╯
 71.07 ┼──────╯
 65.60 ┤    ╰╮
 60.13 ┤     ╰╮
 54.67 ┤      ╰────╮
 49.20 ┤           ╰╮
 43.73 ┤            ╰╮
 38.27 ┤             ╰───╮
 32.80 ┤                 ╰───╮
 27.33 ┤                     ╰───╮
 21.87 ┤                         ╰─────╮
 16.40 ┤                         ╭──╭╮─╭─╮╭──╮──╮╮
 10.93 ┤              ╭─────────────╯╰─╯╭──────────────────────────────────────────────
  5.47 ┤     ╭╭─────────────────────────╯───╯
  0.00 ┼──────╯
                                             leases
initial store values: [s1=72, s2=0, s3=0, s4=72, s5=0, s6=0] (stddev=33.94, mean=24.00, sum=144)
last store values: [s1=13, s2=13, s3=13, s4=82, s5=12, s6=11] (stddev=25.95, mean=24.00, sum=144)

plot stat=replicas
----
 84.00 ┤                                     ╭─────────────────────────────────────────
 81.80 ┤                            ╭───╭────╯╯────────────────────────────────────────
 79.60 ┤                  ╭─────────────╯╭──╯
 77.40 ┤       ╭──────────╯──────────────╯
 75.20 ┤     ╭─╯────╯
 73.00 ┼─────╯───────────────────╮──╮
 70.80 ┤   ╰╮                    ╰──────╮
 68.60 ┤    ╰╮                          ╰────╮
 66.40 ┤     ╰╮                              ╰─────────────────────────────────────────
 64.20 ┤      ╰╮
 62.00 ┤       ╰───╮
 59.80 ┤           ╰╮
 57.60 ┤            ╰╮
 55.40 ┤             ╰────╮
 53.20 ┤                  ╰──────────────────────╮
 51.00 ┤                                         ╰─────────────────────────────────────
                                            replicas
initial store values: [s1=72, s2=72, s3=72, s4=72, s5=72, s6=72] (stddev=0.00, mean=72.00, sum=432)
last store values: [s1=51, s2=66, s3=66, s4=82, s5=84, s6=83] (stddev=12.10, mean=72.00, sum=432)

plot stat=write_bytes_per_second
----
 5055 ┤╭────────────╮╭──────╮╭──╮───╮
 4718 ┤│   ╰─╮      ╰╯      ╰╯  ╰────────╮╭─╮─────────╭───────────────────────────────
 4381 ┤│     ╰─────╮                     ╰╯ ╰─────────╯
 4044 ┤│           ╰╮
 3707 ┤│            ╰───────╮╭─────────╮╭╮╭──────╮  ╭─────────────────────────────────
 3370 ┤│                    ╰╯         ╰╯╰╯      ╰──╯
 3033 ┤│
 2696 ┤│
 2359 ┤│
 2022 ┤│
 1685 ┤│
 1348 ┤│
 1011 ┤│                                               ╭─────╮╭╮╭╮ ╭╮
  674 ┤│                 ╭─╮   ╭╮───╭─────────────────────────────────────────────────
  337 ┤│    ╭────────────╯─╰───╯╰───╯───╯
    0 ┼─────╯─╯
                                    write_bytes_per_second
initial store values: [s1=0, s2=0, s3=0, s4=0, s5=0, s6=0] (stddev=0.00, mean=0.00, sum=0)
last store values: [s1=3546, s2=4595, s3=4556, s4=724, s5=829, s6=768] (stddev=1763.35, mean=2503.00, sum=15018)
