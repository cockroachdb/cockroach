gen_cluster nodes=6 node_cpu_rate_capacity=5000000000
----

gen_ranges ranges=72 min_key=1 max_key=10000 placement_type=replica_placement bytes=268435456
{s1,s2,s3}:1
----
{s1:*,s2,s3}:1

# 5ms of request CPU per access and 500µs of raft CPU per write @ 1000/s.
gen_load rate=1000 rw_ratio=0.95 min_block=100 max_block=100 request_cpu_per_access=5000000 raft_cpu_per_write=500000 min_key=1 max_key=10000
----

# Idle ranges on n4-n6.
gen_ranges ranges=72 min_key=10001 max_key=20000 placement_type=replica_placement bytes=268435456
{s4,s5,s6}:1
----
{s4:*,s5,s6}:1

setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false split_queue_enabled=false
----

eval duration=25m samples=1 seed=42
----
OK

plot stat=cpu sample=1
----
 750000000 ┤╭──╮
 700000000 ┤│  ╰──╮
 650000000 ┤│     ╰──╮╭╮
 600000000 ┤│        ╰╯╰─╮ ╭╮
 550000000 ┤│            ╰─╯│
 500000000 ┤│               ╰──╮
 450000000 ┤│                  ╰───────────────────────────────────────────────────────────
 400000000 ┤│                   ╭──────────────────────────────────────────────────────────
 350000000 ┤│            ╭──╭──╮│
 300000000 ┤│     ╭──╮╭─────╯  ╰╯
 250000000 ┤╭─────╯  ╰╯
 200000000 ┤│
 150000000 ┤│
 100000000 ┤│
  50000000 ┤│
         0 ┼───────────────────────────────────────────────────────────────────────────────
                                                  cpu
initial store values: [s1=0, s2=0, s3=0, s4=0, s5=0, s6=0] (stddev=0.00, mean=0.00, sum=0)
last store values: [s1=455132782, s2=407625557, s3=382792579, s4=0, s5=0, s6=0] (stddev=208673756.92, mean=207591819.67, sum=1245550918)

plot stat=leases sample=1
----
 72.00 ┼───────────────────────────────────────────────────────────────────────────────
 67.20 ┤   ╰──╮
 62.40 ┤      ╰──╮
 57.60 ┤         │
 52.80 ┤         ╰───╮
 48.00 ┤             ╰──╮
 43.20 ┤                │
 38.40 ┤                ╰──╮
 33.60 ┤                   ╰───╮
 28.80 ┤                       ╰───────────────────────────────────────────────────────
 24.00 ┤                       ╭───────────────────────────────────────────────────────
 19.20 ┤                ╭──╭───────────────────────────────────────────────────────────
 14.40 ┤             ╭──╭──╯
  9.60 ┤         ╭──────╯
  4.80 ┤   ╭──╭──╯
  0.00 ┼───────────────────────────────────────────────────────────────────────────────
                                             leases
initial store values: [s1=72, s2=0, s3=0, s4=72, s5=0, s6=0] (stddev=33.94, mean=24.00, sum=144)
last store values: [s1=30, s2=23, s3=19, s4=72, s5=0, s6=0] (stddev=24.21, mean=24.00, sum=144)

plot stat=replicas
----
 72.00 ┼───────────────────────────────────────────────────────────────────────────────
                                            replicas
initial store values: [s1=72, s2=72, s3=72, s4=72, s5=72, s6=72] (stddev=0.00, mean=72.00, sum=432)
last store values: [s1=72, s2=72, s3=72, s4=72, s5=72, s6=72] (stddev=0.00, mean=72.00, sum=432)

plot stat=write_bytes_per_second
----
 10000 ┤╭────────╮╭────────╮╭──────────────────────────────────────────────────────────
  9333 ┤│        ││        ││
  8667 ┤│        ╰╯        ╰╯
  8000 ┤│
  7333 ┤│
  6667 ┤│
  6000 ┤│
  5333 ┤│
  4667 ┤│
  4000 ┤│
  3333 ┤│
  2667 ┤│
  2000 ┤│
  1333 ┤│
   667 ┤│
     0 ┼───────────────────────────────────────────────────────────────────────────────
                                     write_bytes_per_second
initial store values: [s1=0, s2=0, s3=0, s4=0, s5=0, s6=0] (stddev=0.00, mean=0.00, sum=0)
last store values: [s1=9946, s2=9946, s3=9946, s4=0, s5=0, s6=0] (stddev=4973.00, mean=4973.00, sum=29838)
