gen_cluster nodes=5
----

# Each range will be 500 MiB in size and the placement will be skewed, s.t.
# n1/s1, n2/s2 and n3/s3 will have every replicas initially and n1/s1 will have
# every lease.
gen_ranges ranges=15 bytes=524288000 repl_factor=3 placement_skew=true
----

# Set the rebalance mode to use the mma store rebalancer and disable the lease
# and replicate queues so that only the mma store rebalancer is moving replicas
# or leases.
setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false 
----

# Set the capacity of each store to approx. 10 GiB
#
# TODO(kvoli): Support setting the capacity of each store via gen_cluster.
set_capacity store=1 capacity=10737418240
----

set_capacity store=2 capacity=10737418240
----

set_capacity store=3 capacity=10737418240
----

set_capacity store=4 capacity=10737418240
----

set_capacity store=5 capacity=10737418240
----

eval duration=10m seed=42
----
OK

plot stat=disk_fraction_used
----
----

 0.92 ┼───────────────────────────────────────────────────────────────────────────────
 0.85 ┤
 0.79 ┤
 0.73 ┤
 0.67 ┤
 0.61 ┤
 0.55 ┤
 0.49 ┤
 0.43 ┤
 0.37 ┤
 0.31 ┤
 0.24 ┤
 0.18 ┤
 0.12 ┤
 0.06 ┤
 0.00 ┼───────────────────────────────────────────────────────────────────────────────
                                      disk_fraction_used
----
----

plot stat=replicas
----
----

 15.00 ┼───────────────────────────────────────────────────────────────────────────────
 14.00 ┤
 13.00 ┤
 12.00 ┤
 11.00 ┤
 10.00 ┤
  9.00 ┤
  8.00 ┤
  7.00 ┤
  6.00 ┤
  5.00 ┤
  4.00 ┤
  3.00 ┤
  2.00 ┤
  1.00 ┤
  0.00 ┼───────────────────────────────────────────────────────────────────────────────
                                            replicas
----
----

plot stat=leases
----
----

 15.00 ┼───────────────────────────────────────────────────────────────────────────────
 14.00 ┤
 13.00 ┤
 12.00 ┤
 11.00 ┤
 10.00 ┤
  9.00 ┤
  8.00 ┤
  7.00 ┤
  6.00 ┤
  5.00 ┤
  4.00 ┤
  3.00 ┤
  2.00 ┤
  1.00 ┤
  0.00 ┼───────────────────────────────────────────────────────────────────────────────
                                             leases
----
----

topology
----
AU_EAST
  AU_EAST_1
    └── [1 2 3 4 5]
