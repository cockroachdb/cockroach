skip_under_ci
----

gen_cluster nodes=10 node_cpu_rate_capacity=30000
----

# Read only workload, which generates 100_000 request cpu nanos/s evenly over
# the first half of the keyspace, which will be on all stores initially.
gen_ranges ranges=30 min_key=1 max_key=10000 placement_type=even
----

gen_load rate=1000 rw_ratio=1 request_cpu_per_access=100 min_key=1 max_key=10000
----

# Write only workload, which generates no CPU and 100_000 (x replication
# factor) write bytes per second over the second half of the keyspace, which
# are all on s1-s3 initially.
gen_ranges ranges=30 min_key=10001 max_key=20000 placement_type=skewed
----

gen_load rate=20000 rw_ratio=0 min_block=1000 max_block=1000 min_key=10001 max_key=20000
----

setting rebalance_mode=3 replicate_queue_enabled=false lease_queue_enabled=false split_queue_enabled=false
----

eval duration=20m samples=1 seed=42
----
OK

plot stat=cpu
----
last store values: [s1=10021, s2=9925, s3=10036, s4=9990, s5=9983, s6=9939, s7=9950, s8=10112, s9=10013, s10=10025] (stddev=52.26, mean=9999.40, sum=99994)
mma_high_write_uniform_cpu_1_cpu.png (ee5994f0e5949397)

plot stat=write_bytes_per_second
----
last store values: [s1=5987749, s2=6014369, s3=5995794, s4=5994510, s5=6013338, s6=5991392, s7=5995224, s8=6010245, s9=5993349, s10=5999974] (stddev=9092.56, mean=5999594.40, sum=59995944)
mma_high_write_uniform_cpu_1_write_bytes_per_second.png (981640536be8ab40)

plot stat=replicas
----
initial store values: [s1=39, s2=31, s3=23, s4=17, s5=13, s6=13, s7=13, s8=13, s9=9, s10=9] (stddev=9.48, mean=18.00, sum=180)
last store values: [s1=18, s2=18, s3=18, s4=18, s5=18, s6=18, s7=18, s8=18, s9=18, s10=18] (stddev=0.00, mean=18.00, sum=180)
mma_high_write_uniform_cpu_1_replicas.png (03be80bde4915e53)

plot stat=leases
----
initial store values: [s1=18, s2=10, s3=6, s4=4, s5=4, s6=4, s7=4, s8=4, s9=3, s10=3] (stddev=4.45, mean=6.00, sum=60)
last store values: [s1=12, s2=8, s3=4, s4=4, s5=4, s6=4, s7=5, s8=6, s9=7, s10=6] (stddev=2.41, mean=6.00, sum=60)
mma_high_write_uniform_cpu_1_leases.png (a3ba2736c35aa9b4)
