gen_cluster nodes=5
----

gen_ranges ranges=500 bytes=300000000
----

gen_load rate=500 max_block=128000 min_block=128000
----

set_capacity store=5 capacity=45000000000
----

eval duration=30m seed=42
----
OK

# Plot the replicas over time per store. With a steady state of writes, we will
# repeatedly hit the disk fullness threshold which causes shedding replicas on
# store 5. This is shown below as it sheds replicas.
plot stat=replicas
----
 340 ┤                                                                     ╭╮     ╭╮╭
 329 ┤                                    ╭╭─╭──╮╭─╮╭─╮╭─╭╮╭╭╮  ╭╮ ╭╮╮╭╭─╮─╭╭╮─╭╭╮╯╭╯
 319 ┤                 ╭╮ ╭╮  ╭╮╭╭╮╭╮ ╭╮╭────╯─╯╰╯╭╰──────╮╭╯│─╭╯│╭╯╰╮╭╯╰│─╭╯│─╭╯╰─╯─
 308 ┤                ╭╭──╮╭╭────╯╰╮╭─╯╰╯╰╯ ╰╯   ╰╯ ╰─╰─╯╰╰╯╯╰─╯╰╰╯  ╰╯─╯╰─╯╰╰─╯╰╯  ╰
 297 ┼╮────────────────╯╭╯╰╭╮─╯╯╯╰╯╰╯││
 286 ┤╰───────────────╮╰╯  ││        ╰╯
 276 ┤                │╭─╮╭╯╰╮
 265 ┤                ╰╯ ╰╯  │╭─╮ ╭╮ ╭╮
 254 ┤                       ╰╯ │ ││ ││
 243 ┤                          ╰─╯╰─╯╰╮
 233 ┤                                 │                  ╭╮  ╭╮
 222 ┤                                 ╰──╮           ╭╮  │╰╮╭╯│ ╭╮
 211 ┤                                    │ ╭─╮     ╭╮│╰╮╭╯ ││ ╰─╯│  ╭╮             ╭
 200 ┤                                    ╰╮│ │  ╭╮ │╰╯ ╰╯  ╰╯    ╰╮ │╰╮ ╭─╮╭──╮╭─╮ │
 190 ┤                                     ╰╯ ╰╮╭╯╰─╯              ╰─╯ │ │ ││  ││ ╰─╯
 179 ┤                                         ╰╯                      ╰─╯ ╰╯  ╰╯
                                          replicas
initial store values: [s1=300, s2=300, s3=300, s4=300, s5=300] (stddev=0.00, mean=300.00, sum=1500)
last store values: [s1=313, s2=334, s3=317, s4=340, s5=211] (stddev=47.10, mean=303.00, sum=1515)

# Plot the % of disk storage capacity used. We should see s5 hovering right
# around 92.5-95% (the storage capacity threshold value).
plot stat=disk_fraction_used
----
 1.09 ┤                                                        ╭╮ ╭╮
 1.02 ┤                     ╭─╮╭╮     ╭─╮ ╭╮ ╭─╮       ╭╮  ╭╮  ││ │╰╮ ╭╮  ╭─╮ ╭╮  ╭╮
 0.95 ┤          ╭────────╮ │ ││╰───╮╭╯ ╰─╯╰╮│ ╰╮╭─╮ ╭╮│╰╮╭╯╰╮╭╯│╭╯ │ │╰╮ │ │╭╯╰╮╭╯╰╮╭
 0.87 ┤ ╭────────╯        ╰─╯ ╰╯    ╰╯      ╰╯  ╰╯ ╰─╯╰╯ ╰╯  ╰╯ ╰╯  ╰─╯ ╰─╯ ╰╯  ╰╯  ╰╯
 0.80 ┼─╯
 0.73 ┤
 0.66 ┤
 0.58 ┤
 0.51 ┤
 0.44 ┤
 0.36 ┤
 0.29 ┤
 0.22 ┤
 0.15 ┤
 0.07 ┤
 0.00 ┼───────────────────────────────────────────────────────────────────────────────
                                      disk_fraction_used
initial store values: [s1=0.00, s2=0.00, s3=0.00, s4=0.00, s5=0.83] (stddev=0.33, mean=0.17, sum=1)
last store values: [s1=0.00, s2=0.00, s3=0.00, s4=0.00, s5=0.97] (stddev=0.39, mean=0.19, sum=1)
