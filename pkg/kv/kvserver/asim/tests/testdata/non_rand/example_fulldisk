gen_cluster nodes=5
----

gen_ranges ranges=500 bytes=300000000
----

gen_load rate=500 max_block=128000 min_block=128000
----

set_capacity store=5 capacity=45000000000
----

eval duration=30m seed=42
----
OK

# Plot the replicas over time per store. With a steady state of writes, we will
# repeatedly hit the disk fullness threshold which causes shedding replicas on
# store 5. This is shown below as it sheds replicas.
plot stat=replicas
----
 345 ┤                                                    ╭╮               ╭╮
 334 ┤                      ╭─╮ ╭╮         ╭╮╭─╮╭╮╭╮╭╮╭─╭╮╯│     ╭─╭╮╭╮  ╭╮╯│╭─╭─╮╮─╭
 324 ┤             ╭╮╭─╮ ╭╭─│─│╭╯╭─╮╭─╭──╮╭╮╭─╮│╯╭╯╰╮╰╮╭╯│╮╰╮╭─╮╭╯╭╯╰╮─╮╭╯╰╮─╯╭│╯╰╮╮╭
 313 ┤           ╭╮╯╭╭─╮╭───╯ ╰╮╰│╮│╯╭│╮╯╰──╯╯╰╮╭╯╭╯│╯╭╯╭╰╮╮╭╯ │╯││││││╭╯╮╰│ ╭╭╯│╭│╭╯
 303 ┤╭──────────╯╰╮╭╯│╰╯╭╯│╰─╯│╭╯│╰╮╭╯╰─╯│  ╰╯╰╯╭╯ │╭╯─╯││╭╯╮╭│╰╭╯─╰╰─╯ ╰╯│─╭╯╯╰╯╰╯
 292 ┼─╮────────────╯ ╰╯╰╯╰│╭╯ ││ ╰─╰╯╰──╯╰╮╭╯  ││  ╰╯   ╰╰╯ ╰╯╰─╯╯    │╭╯ ╰─╯
 282 ┤ ╰─────────╮         ╰╯  ╰╯          ╰╯   ╰╯                     ╰╯
 271 ┤           │╭─╮
 261 ┤           ╰╯ │  ╭╮                                              ╭╮
 250 ┤              ╰╮╭╯╰╮ ╭╮  ╭╮  ╭╮ ╭─╮  ╭╮              ╭╮   ╭─╮   ╭╯│   ╭╮
 240 ┤               ││  │╭╯╰╮╭╯│ ╭╯╰╮│ ╰╮ │╰╮  ╭╮   ╭╮   ╭╯╰╮  │ │  ╭╯ ╰╮  ││
 229 ┤               ╰╯  ╰╯  ││ ╰╮│  ╰╯  │╭╯ │  ││   │╰╮  │  ╰╮╭╯ ╰╮ │   │ ╭╯╰╮
 219 ┤                       ╰╯  ╰╯      ╰╯  ╰╮╭╯╰╮ ╭╯ │ ╭╯   ││   │╭╯   ╰╮│  ╰╮   ╭╮
 208 ┤                                        ││  │ │  ╰╮│    ╰╯   ╰╯     ╰╯   │  ╭╯│
 198 ┤                                        ╰╯  ╰─╯   ╰╯                     ╰╮ │ ╰
 187 ┤                                                                          ╰─╯
                                          replicas
initial store values: [s1=300, s2=300, s3=300, s4=300, s5=300] (stddev=0.00, mean=300.00, sum=1500)
last store values: [s1=321, s2=337, s3=323, s4=324, s5=201] (stddev=50.42, mean=301.20, sum=1506)

# Plot the % of disk storage capacity used. We should see s5 hovering right
# around 92.5-95% (the storage capacity threshold value).
plot stat=disk_fraction_used
----
 1.14 ┤                                                                      ╭─╮
 1.06 ┤                                     ╭╮              ╭╮         ╭─╮   │ │    ╭╮
 0.99 ┤         ╭─╮╭─╮  ╭╮ ╭─╮ ╭─╮ ╭─╮ ╭─╮  │╰╮ ╭──╮  ╭─╮  ╭╯╰╮  ╭─╮   │ ╰╮ ╭╯ ╰╮  ╭╯╰
 0.91 ┤   ╭─────╯ ╰╯ ╰╮╭╯╰─╯ ╰─╯ ╰╮│ ╰─╯ ╰╮╭╯ ╰╮│  ╰╮╭╯ │ ╭╯  ╰╮╭╯ ╰╮ ╭╯  ╰╮│   ╰──╯
 0.84 ┼─╮╭╯           ╰╯          ╰╯      ╰╯   ╰╯   ╰╯  ╰─╯    ╰╯   ╰─╯    ╰╯
 0.76 ┤ ╰╯
 0.68 ┤
 0.61 ┤
 0.53 ┤
 0.46 ┤
 0.38 ┤
 0.30 ┤
 0.23 ┤
 0.15 ┤
 0.08 ┤
 0.00 ┼───────────────────────────────────────────────────────────────────────────────
                                      disk_fraction_used
initial store values: [s1=0.00, s2=0.00, s3=0.00, s4=0.00, s5=0.83] (stddev=0.33, mean=0.17, sum=1)
last store values: [s1=0.00, s2=0.00, s3=0.00, s4=0.00, s5=1.02] (stddev=0.41, mean=0.20, sum=1)
