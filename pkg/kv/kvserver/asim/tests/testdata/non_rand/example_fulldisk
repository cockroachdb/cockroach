gen_cluster nodes=5
----

gen_ranges ranges=500 bytes=300000000
----

gen_load rate=500 max_block=128000 min_block=128000
----

set_capacity store=5 capacity=45000000000
----

eval duration=30m seed=42
----
OK

# Plot the replicas over time per store. With a steady state of writes, we will
# repeatedly hit the disk fullness threshold which causes shedding replicas on
# store 5. This is shown below as it sheds replicas.
plot stat=replicas
----
 342 ┤                                        ╭╮       ╭╮    ╭╮ ╭╮╭╮╮ ╭╮       ╭╮╭╮╭─
 330 ┤                        ╭╭╭─╮─╭╮╮╭─╭─╮╭─╮─╭─╮╮╭──╮╭─╮─╭╯╰───────╯│─╭─────╮╭╯╰╯╯
 319 ┤                ╭───╭─────╯─│╭╯╰───╯─╰╯╰╰─╯╯╰─╯╭╯╰╯╰╰─╯│╭─╯╰─╯│╭╯╰─╯╰─╯ ╰╰╯╰─╯
 307 ┼───────────────╮────╯─╯╰╯╰╯ ╰╯ ╰╯             ╰╯╰╰╯    ╰╯     ╰╯
 295 ┤               │╭╮╯╰╯ ╰╯
 284 ┤               ╰╯╰╮
 272 ┤                  │╭─╮ ╭╮
 260 ┤                  ╰╯ ╰─╯│
 249 ┤                        │╭╮
 237 ┤                        ╰╯╰╮╭╮ ╭╮            ╭╮
 225 ┤                           ││╰─╯╰╮╭─╮ ╭╮ ╭─╮ │╰╮╭─╮ ╭╮               ╭╮
 214 ┤                           ╰╯    ╰╯ ╰─╯╰╮│ │╭╯ ╰╯ ╰╮│╰╮ ╭╮ ╭╮ ╭─╮ ╭╮ ││ ╭╮ ╭─╮
 202 ┤                                        ╰╯ ╰╯      ╰╯ ╰─╯╰╮│╰╮│ │╭╯╰─╯╰╮│╰╮│ │
 190 ┤                                                          ╰╯ ╰╯ ╰╯     ╰╯ ╰╯ ╰╮
 179 ┤                                                                              │
 167 ┤                                                                              ╰
                                          replicas
initial store values: [s1=300, s2=300, s3=300, s4=300, s5=300] (stddev=0.00, mean=300.00, sum=1500)
last store values: [s1=330, s2=339, s3=335, s4=335, s5=167] (stddev=67.16, mean=301.20, sum=1506)

# Plot the % of disk storage capacity used. We should see s5 hovering right
# around 92.5-95% (the storage capacity threshold value).
plot stat=disk_fraction_used
----
 1.10 ┤                                                                           ╭─╮
 1.03 ┤                       ╭╮╭╮ ╭╮    ╭─╮    ╭╮      ╭╮ ╭─╮ ╭╮ ╭╮        ╭╮    │ │
 0.97 ┤           ╭───╮╭─╮ ╭╮╭╯││╰╮││ ╭─╮│ │ ╭╮ │╰╮ ╭─╮╭╯│╭╯ │╭╯│ │╰╮╭─╮╭─╮ │╰╮╭─╮│ ╰╮
 0.90 ┤   ╭───────╯   ╰╯ ╰─╯╰╯ ╰╯ ╰╯╰─╯ ╰╯ ╰─╯╰─╯ │╭╯ ╰╯ ╰╯  ╰╯ ╰╮│ ╰╯ ╰╯ ╰─╯ ╰╯ ╰╯  │
 0.84 ┼───╯                                       ╰╯             ╰╯                  ╰
 0.78 ┤
 0.71 ┤
 0.65 ┤
 0.58 ┤
 0.52 ┤
 0.46 ┤
 0.39 ┤
 0.33 ┤
 0.26 ┤                                               ╭╮╭─────╭──╮╭───────────────────
 0.20 ┤               ╭╮╭─────────────────────────────────────╯─╯╰╯─╯ ╰╯ ╰╯
 0.14 ┼─────────────────╯ ╰╰╯╰╯
                                      disk_fraction_used
initial store values: [s1=0.14, s2=0.14, s3=0.14, s4=0.14, s5=0.83] (stddev=0.28, mean=0.28, sum=1)
last store values: [s1=0.26, s2=0.27, s3=0.27, s4=0.27, s5=0.84] (stddev=0.23, mean=0.38, sum=2)
