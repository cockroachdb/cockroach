# Set every store's capacity to 512 GiB, we will later adjust just one store to
# have less free capacity.
gen_cluster nodes=5 store_byte_capacity=549755813888
----

gen_ranges ranges=500 bytes=300000000
----

gen_load rate=500 max_block=128000 min_block=128000
----

# Set the disk storage capacity of s5 to 100 GiB. This will necessitate
# shedding replicas from s5 continously as the workload fills up ranges.
set_capacity store=5 capacity=107374182400
----

eval duration=30m seed=42
----
OK

# Plot the replicas over time per store. With a steady state of writes, we will
# repeatedly hit the disk fullness threshold which causes shedding replicas on
# store 5. This is shown below as it sheds replicas.
plot stat=replicas
----
----

 355 ┤                                                                          ╭╮
 341 ┤                               ╭╮  ╭╭╮╮     ╭╮  ╭╮ ╭─╮─╭╮╭─╮─╭─╮╭─╮╮╭──╭──╮╰─╭─
 326 ┤   ╭╮╮  ╭─╮ ╭╮╭╮╭─╮╭──╮╭─╭─╮─╭───╮─╭╯╰╮╭──╮╮╯╰╭──╮╭╯╭╰╮╯╭╯─╰╮╯─╭╯─╰╮╭──╯││╰──╯─
 312 ┤  ╭─╮╭─╭───────────╯─╭╰╮╭╯╯╰─╯╯╭╯╰─╯╯╯╰╯╯╰╰╮─╭╯╰─╰╯─╯ │╭╯╰─╯│╰╭╯  ╰╰╯╰╯ ╰╮╭─╯
 297 ┼─╮─────╯╰╯─╯╯ ╰─╯╯╰╮╭╯╯╰╯╯─╯╰╯─╯ ╰╯  ╰─╯   ╰─╯        ╰╯    ╰─╯    ╰╯    ╰╯
 283 ┤ ╰╮                ╰╯
 269 ┤  │
 254 ┤  ╰╮ ╭─╮  ╭╮
 240 ┤   │╭╯ │ ╭╯╰╮  ╭─╮  ╭╮
 225 ┤   ╰╯  ╰─╯  ╰╮╭╯ │ ╭╯│  ╭╮  ╭╮   ╭╮
 211 ┤             ╰╯  ╰─╯ ╰╮╭╯╰╮ │╰╮  │╰╮   ╭╮   ╭╮
 197 ┤                      ╰╯  ╰─╯ ╰╮╭╯ │  ╭╯│  ╭╯╰╮  ╭─╮   ╭╮    ╭╮    ╭╮
 182 ┤                               ╰╯  ╰╮╭╯ ╰──╯  ╰╮ │ ╰╮ ╭╯╰╮  ╭╯│    │╰╮    ╭╮
 168 ┤                                    ╰╯         ╰─╯  │ │  ╰╮ │ ╰╮  ╭╯ ╰╮  ╭╯╰╮
 153 ┤                                                    ╰─╯   ╰─╯  ╰╮╭╯   ╰╮╭╯  ╰╮
 139 ┤                                                                ╰╯     ╰╯    ╰─
                                          replicas
----
----

# Plot the % of disk storage capacity used. We should see s5 hovering right
# around 92.5-95% (the storage capacity threshold value).
plot stat=disk_fraction_used
----
----

 1.18 ┤                                                                   ╭╮     ╭╮
 1.11 ┤                                            ╭╮         ╭╮    ╭╮    │╰╮    ││
 1.05 ┼──╮       ╭╮            ╭╮  ╭╮   ╭╮    ╭╮  ╭╯│   ╭─╮  ╭╯╰╮  ╭╯│   ╭╯ ╰╮  ╭╯╰╮
 0.98 ┤  │  ╭─╮ ╭╯╰╮  ╭─╮ ╭─╮ ╭╯╰╮ │╰╮ ╭╯╰╮  ╭╯╰╮ │ ╰─╮ │ ╰╮ │  │  │ ╰╮  │   │  │  ╰╮
 0.92 ┤  ╰╮╭╯ │ │  ╰╮╭╯ ╰─╯ ╰╮│  ╰─╯ ╰╮│  ╰╮╭╯  ╰─╯   ╰─╯  │ │  ╰╮╭╯  ╰╮╭╯   ╰╮╭╯   ╰╮
 0.85 ┤   ╰╯  ╰─╯   ╰╯       ╰╯       ╰╯   ╰╯              ╰─╯   ╰╯    ╰╯     ╰╯     ╰
 0.79 ┤
 0.72 ┤
 0.66 ┤
 0.59 ┤
 0.53 ┤
 0.46 ┤
 0.40 ┤                                                   ╭╮  ╭─╭──╮──╭───────────────
 0.33 ┤                           ╭╮╭─╭─╮─╭───────╮╭──────╯╰────╯──╰──╯  ╰─╯
 0.27 ┤   ╭╮╭─╭───────────────────────╯╯╰─╯ ╰─╯   ╰╯
 0.20 ┼───────╯ ╰╯╰╯
                                      disk_fraction_used
----
----
