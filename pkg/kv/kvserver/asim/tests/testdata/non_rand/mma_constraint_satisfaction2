# specify zone survivability (2, 2, 1) replicas across 3 regions.
# (specify the weight )
gen_cluster nodes=9 stores_per_node=1
----

setting rebalance_mode=0 replicate_queue_enabled=false lease_queue_enabled=false split_queue_enabled=false
----

# specify non-voters
# 50 replicas to place / 9
# s1:2,s2:2,s3:2,s4:2,s5:2,s6:2,s7:1,s8:1,s9:1
# (s1-3: region 1) (s4-6: region 2) (s7-9: region 3)
# ratio (region1:2, region2:2, region3: 1)

# replica_weights=(0.2,0.2,0.2,0.2,0.2,0.2,0.1,0.1,0.1)
gen_ranges ranges=10 repl_factor=5 placement_type=replica_placement 
lease: r1
r1: store_weights=[s1=1,s2=1,s3=1] replica_type=VOTER_FULL
r2: store_weights=[s1=1,s2=1,s3=1] replica_type=VOTER_FULL
r3: store_weights=[s4=1,s5=1,s6=1] replica_type=VOTER_FULL
r4: store_weights=[s4=1,s5=1,s6=1] replica_type=VOTER_FULL
r5: store_weights=[s7=1,s8=1,s9=1] replica_type=VOTER_FULL
----


eval duration=30m samples=1 seed=42
----
OK

print
----
cluster state:
stores(9)=[s1n1=(r1:1,r2:1,r3:1,r4:1,r5:2,r6:2,r7:2,r8:2,r9:3,r10:4),s2n2=(r1:2,r2:2,r3:2,r4:2,r5:1,r6:1,r7:1,r8:1,r9:4,r10:3),s3n3=(r1:3,r2:4,r3:5,r9:1,r10:1),s4n4=(r1:4,r2:3,r3:3,r4:3,r5:3,r6:4,r7:4,r8:4,r9:2,r10:5),s5n5=(r1:5,r3:4,r4:4,r5:4,r6:3,r7:3,r8:3,r10:2),s6n6=(),s7n7=(r2:5,r4:5,r5:5),s8n8=(r6:5,r7:5,r8:5),s9n9=(r9:5)] 
ranges(10)=[r1(0)=(s1:r1(VOTER_FULL)*,s2:r2(VOTER_FULL),s3:r3(VOTER_FULL),s4:r4(VOTER_FULL),s5:r5(VOTER_FULL)),r2(1000)=(s1:r1(VOTER_FULL)*,s2:r2(VOTER_FULL),s3:r4(VOTER_FULL),s4:r3(VOTER_FULL),s7:r5(VOTER_FULL)),r3(2000)=(s1:r1(VOTER_FULL)*,s2:r2(VOTER_FULL),s3:r5(VOTER_FULL),s4:r3(VOTER_FULL),s5:r4(VOTER_FULL)),r4(3000)=(s1:r1(VOTER_FULL)*,s2:r2(VOTER_FULL),s4:r3(VOTER_FULL),s5:r4(VOTER_FULL),s7:r5(VOTER_FULL)),r5(4000)=(s1:r2(VOTER_FULL)*,s2:r1(VOTER_FULL),s4:r3(VOTER_FULL),s5:r4(VOTER_FULL),s7:r5(VOTER_FULL)),r6(5000)=(s1:r2(VOTER_FULL)*,s2:r1(VOTER_FULL),s4:r4(VOTER_FULL),s5:r3(VOTER_FULL),s8:r5(VOTER_FULL)),r7(6000)=(s1:r2(VOTER_FULL)*,s2:r1(VOTER_FULL),s4:r4(VOTER_FULL),s5:r3(VOTER_FULL),s8:r5(VOTER_FULL)),r8(7000)=(s1:r2(VOTER_FULL)*,s2:r1(VOTER_FULL),s4:r4(VOTER_FULL),s5:r3(VOTER_FULL),s8:r5(VOTER_FULL)),r9(8000)=(s1:r3(VOTER_FULL)*,s2:r4(VOTER_FULL),s3:r1(VOTER_FULL),s4:r2(VOTER_FULL),s9:r5(VOTER_FULL)),r10(9000)=(s1:r4(VOTER_FULL)*,s2:r3(VOTER_FULL),s3:r1(VOTER_FULL),s4:r5(VOTER_FULL),s5:r2(VOTER_FULL))]


plot stat=replicas show_last_value=true
----
----

 10.00 ┼───────────────────────────────────────────────────────────────────────────────
  9.33 ┤
  8.67 ┤
  8.00 ┼───────────────────────────────────────────────────────────────────────────────
  7.33 ┤
  6.67 ┤
  6.00 ┤
  5.33 ┼───────────────────────────────────────────────────────────────────────────────
  4.67 ┤
  4.00 ┤
  3.33 ┼───────────────────────────────────────────────────────────────────────────────
  2.67 ┤
  2.00 ┤
  1.33 ┼───────────────────────────────────────────────────────────────────────────────
  0.67 ┤
  0.00 ┼───────────────────────────────────────────────────────────────────────────────
                                            replicas

last store values: [s6=0 s9=1 s7=3 s8=3 s3=5 s5=8 s1=10 s2=10 s4=10]
----
----
