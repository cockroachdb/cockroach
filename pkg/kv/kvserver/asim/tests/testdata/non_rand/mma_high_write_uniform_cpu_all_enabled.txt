skip_under_ci
----

# This is identical to mma_high_write_uniform_cpu_all_enabled, but with
# the split/lease/replicate queues enable along with the mma store rebalancer.
gen_cluster nodes=10 node_cpu_rate_capacity=30000
----

# Read only workload, which generates 100_000 request cpu nanos/s evenly over
# the first half of the keyspace, which will be on all stores initially.
gen_ranges ranges=30 min_key=1 max_key=10000 placement_type=even
----

gen_load rate=1000 rw_ratio=1 request_cpu_per_access=100 min_key=1 max_key=10000
----

setting rebalance_mode=3
----

# Write only workload, which generates no CPU and 100_000 (x replication
# factor) write bytes per second over the second half of the keyspace, which
# are all on s1-s3 initially.
gen_ranges ranges=30 min_key=10001 max_key=20000 placement_type=skewed
----

gen_load rate=20000 rw_ratio=0 min_block=1000 max_block=1000 min_key=10001 max_key=20000
----

eval duration=20m samples=1 seed=42
----
OK

plot stat=cpu
----
last store values: [s1=10091, s2=9983, s3=9969, s4=9994, s5=9989, s6=9946, s7=10003, s8=10019, s9=9972, s10=9986] (stddev=37.05, mean=9995.20, sum=99952)
mma_high_write_uniform_cpu_all_enabled_1_cpu.png (dff1fb21cfc10d9d)

plot stat=write_bytes_per_second
----
last store values: [s1=5992623, s2=5816400, s3=5817831, s4=5992521, s5=6000034, s6=5989865, s7=5996345, s8=5995034, s9=5990435, s10=5818525] (stddev=80817.44, mean=5940961.30, sum=59409613)
mma_high_write_uniform_cpu_all_enabled_1_write_bytes_per_second.png (83dd125ae87a6d9f)

plot stat=replicas
----
initial store values: [s1=39, s2=31, s3=23, s4=17, s5=13, s6=13, s7=13, s8=13, s9=9, s10=9] (stddev=9.48, mean=18.00, sum=180)
last store values: [s1=27, s2=29, s3=26, s4=28, s5=29, s6=28, s7=26, s8=26, s9=26, s10=28] (stddev=1.19, mean=27.30, sum=273)
mma_high_write_uniform_cpu_all_enabled_1_replicas.png (d8f6680ca985b621)

plot stat=leases
----
initial store values: [s1=18, s2=10, s3=6, s4=4, s5=4, s6=4, s7=4, s8=4, s9=3, s10=3] (stddev=4.45, mean=6.00, sum=60)
last store values: [s1=14, s2=6, s3=9, s4=8, s5=7, s6=5, s7=11, s8=8, s9=9, s10=14] (stddev=2.91, mean=9.10, sum=91)
mma_high_write_uniform_cpu_all_enabled_1_leases.png (f542c4dda32f1a53)
