skip_under_ci
----

# This is identical to mma_high_write_uniform_cpu_all_enabled, but with
# the split/lease/replicate queues enable along with the mma store rebalancer.
gen_cluster nodes=10 node_cpu_rate_capacity=30000
----

# Read only workload, which generates 100_000 request cpu nanos/s evenly over
# the first half of the keyspace, which will be on all stores initially.
gen_ranges ranges=30 min_key=1 max_key=10000 placement_type=even
----

gen_load rate=1000 rw_ratio=1 request_cpu_per_access=100 min_key=1 max_key=10000
----

setting rebalance_mode=3
----

# Write only workload, which generates no CPU and 100_000 (x replication
# factor) write bytes per second over the second half of the keyspace, which
# are all on s1-s3 initially.
gen_ranges ranges=30 min_key=10001 max_key=20000 placement_type=skewed
----

gen_load rate=20000 rw_ratio=0 min_block=1000 max_block=1000 min_key=10001 max_key=20000
----

eval duration=20m samples=1 seed=42
----
OK

plot stat=cpu
----
last store values: [s1=9934, s2=10057, s3=10073, s4=9944, s5=9960, s6=9974, s7=9971, s8=10035, s9=10013, s10=10044] (stddev=47.45, mean=10000.50, sum=100005)
mma_high_write_uniform_cpu_all_enabled_1_cpu.png (ef60f77d1ad45126)

plot stat=write_bytes_per_second
----
last store values: [s1=6344285, s2=6328357, s3=4760955, s4=6090640, s5=5995078, s6=6349857, s7=5443994, s8=6328220, s9=6326437, s10=6327367] (stddev=501409.05, mean=6029519.00, sum=60295190)
mma_high_write_uniform_cpu_all_enabled_1_write_bytes_per_second.png (84d0ebd341cd8f87)

plot stat=replicas
----
initial store values: [s1=39, s2=33, s3=23, s4=16, s5=13, s6=12, s7=11, s8=11, s9=11, s10=11] (stddev=9.76, mean=18.00, sum=180)
last store values: [s1=26, s2=28, s3=26, s4=28, s5=27, s6=28, s7=27, s8=27, s9=28, s10=28] (stddev=0.78, mean=27.30, sum=273)
mma_high_write_uniform_cpu_all_enabled_1_replicas.png (b9338fac816e08dc)

plot stat=leases
----
initial store values: [s1=19, s2=11, s3=6, s4=3, s5=3, s6=3, s7=4, s8=3, s9=4, s10=4] (stddev=4.92, mean=6.00, sum=60)
last store values: [s1=9, s2=12, s3=6, s4=11, s5=13, s6=6, s7=11, s8=5, s9=9, s10=9] (stddev=2.59, mean=9.10, sum=91)
mma_high_write_uniform_cpu_all_enabled_1_leases.png (87b073468de01c2b)
