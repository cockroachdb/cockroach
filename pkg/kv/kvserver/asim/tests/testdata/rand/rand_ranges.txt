# In this test, we run the randomized testing framework with both the
# rand_ranges and rand_cluster options. We expect that the range_gen and
# cluster_gen configurations will change across iterations and runs.
#
# When a specific generator type is used, we expect the numbers generated to
# form a distribution. Due to limited sample size, it can be hard to observe the
# corresponding distribution pattern, but we can confirm that the parameters are
# set correctly and numbers generated look roughly accurate.
#
# Other parameters, such as replication factor and placement type should also be
# set and remain consistent across iterations.
rand_cluster cluster_gen_type=single_region
----

# We expect the placement of ranges across stores to be randomized with a
# replication factor of 3. range∈[1, 1000] should be generated with an uniform
# distribution pattern across iterations. The numbers generated are
# (305,944,479,487,285,611,271,502,865,787) - randomly distributed within [1,
# 1000]. keyspace∈[1000, 200000] should be generated with a zipf distribution
# pattern across iterations (1015,2357,1003,2171,1060,1000,1439,1198,1427.1001)
# - numbers close to 1000 are expected to occur frequently. configurations
# should be generated with an uniform distribution pattern across iterations.
rand_ranges placement_type=random replication_factor=3 range_gen_type=uniform keyspace_gen_type=zipf
----

eval duration=5m num_iterations=10 verbose=(test_settings,config_gen)
----
test settings
	num_iterations=10 duration=5m0s
----------------------------------
generating cluster configurations using randomized option
	cluster_gen_type=single_region
generating ranges configurations using randomized option
	placement_type=random, range_gen_type=uniform, key_space=zipf, replication_factor=3, weightedRand=[]
generating load configurations using static option
	rw_ratio=0.00, rate=0.00, min_block=1, max_block=1, min_key=0, max_key=200000, skewed_access=false
generating events configurations using static option
generating settings configurations using static option
----------------------------------
sample1: start running
configurations generated using seed 1926012586526624009
	cluster: region:US [zone=US_1(nodes=1,stores=5), zone=US_2(nodes=1,stores=5), zone=US_3(nodes=1,stores=5)]
store_disk_capacity=1099511627776 bytes, node_cpu_rate_capacity=0 cpu-ns/sec
	randomized ranges with placement_type=random, num_ranges=305, key=[0,1015], rf=3, range_size=0 MiB
	[workload: 0ops/s(r:0,w:1), 1-1B/op, key=[0,200000]
	number of mutation events=0, number of assertion events=0
sample1: pass
----------------------------------
sample2: start running
configurations generated using seed 2643318057788968173
	cluster: region:US [zone=US_1(nodes=5,stores=1), zone=US_2(nodes=5,stores=1), zone=US_3(nodes=5,stores=1)]
store_disk_capacity=1099511627776 bytes, node_cpu_rate_capacity=0 cpu-ns/sec
	randomized ranges with placement_type=random, num_ranges=944, key=[0,1357], rf=3, range_size=0 MiB
	[workload: 0ops/s(r:0,w:1), 1-1B/op, key=[0,200000]
	number of mutation events=0, number of assertion events=0
sample2: pass
----------------------------------
sample3: start running
configurations generated using seed 6972490225919430754
	cluster: region:US [zone=US_1(nodes=5,stores=1), zone=US_2(nodes=5,stores=1), zone=US_3(nodes=5,stores=1)]
store_disk_capacity=1099511627776 bytes, node_cpu_rate_capacity=0 cpu-ns/sec
	randomized ranges with placement_type=random, num_ranges=479, key=[0,1003], rf=3, range_size=0 MiB
	[workload: 0ops/s(r:0,w:1), 1-1B/op, key=[0,200000]
	number of mutation events=0, number of assertion events=0
sample3: pass
----------------------------------
sample4: start running
configurations generated using seed 8427801741804500990
	cluster: region:US [zone=US_1(nodes=1,stores=5), zone=US_2(nodes=1,stores=5), zone=US_3(nodes=1,stores=5)]
store_disk_capacity=1099511627776 bytes, node_cpu_rate_capacity=0 cpu-ns/sec
	randomized ranges with placement_type=random, num_ranges=487, key=[0,2171], rf=3, range_size=0 MiB
	[workload: 0ops/s(r:0,w:1), 1-1B/op, key=[0,200000]
	number of mutation events=0, number of assertion events=0
sample4: pass
----------------------------------
sample5: start running
configurations generated using seed 8063729658764635782
	cluster: region:US [zone=US_1(nodes=1,stores=5), zone=US_2(nodes=1,stores=5), zone=US_3(nodes=1,stores=5)]
store_disk_capacity=1099511627776 bytes, node_cpu_rate_capacity=0 cpu-ns/sec
	randomized ranges with placement_type=random, num_ranges=285, key=[0,1060], rf=3, range_size=0 MiB
	[workload: 0ops/s(r:0,w:1), 1-1B/op, key=[0,200000]
	number of mutation events=0, number of assertion events=0
sample5: pass
----------------------------------
sample6: start running
configurations generated using seed 3814222400681984302
	cluster: region:US [zone=US_1(nodes=1,stores=5), zone=US_2(nodes=1,stores=5), zone=US_3(nodes=1,stores=5)]
store_disk_capacity=1099511627776 bytes, node_cpu_rate_capacity=0 cpu-ns/sec
	randomized ranges with placement_type=random, num_ranges=611, key=[0,1000], rf=3, range_size=0 MiB
	[workload: 0ops/s(r:0,w:1), 1-1B/op, key=[0,200000]
	number of mutation events=0, number of assertion events=0
sample6: pass
----------------------------------
sample7: start running
configurations generated using seed 13013938835543503
	cluster: region:US [zone=US_1(nodes=1,stores=5), zone=US_2(nodes=1,stores=5), zone=US_3(nodes=1,stores=5)]
store_disk_capacity=1099511627776 bytes, node_cpu_rate_capacity=0 cpu-ns/sec
	randomized ranges with placement_type=random, num_ranges=271, key=[0,1439], rf=3, range_size=0 MiB
	[workload: 0ops/s(r:0,w:1), 1-1B/op, key=[0,200000]
	number of mutation events=0, number of assertion events=0
sample7: pass
----------------------------------
sample8: start running
configurations generated using seed 2207144605302255518
	cluster: region:US [zone=US_1(nodes=1,stores=5), zone=US_2(nodes=1,stores=5), zone=US_3(nodes=1,stores=5)]
store_disk_capacity=1099511627776 bytes, node_cpu_rate_capacity=0 cpu-ns/sec
	randomized ranges with placement_type=random, num_ranges=502, key=[0,1198], rf=3, range_size=0 MiB
	[workload: 0ops/s(r:0,w:1), 1-1B/op, key=[0,200000]
	number of mutation events=0, number of assertion events=0
sample8: pass
----------------------------------
sample9: start running
configurations generated using seed 5888461606762344739
	cluster: region:US [zone=US_1(nodes=1,stores=5), zone=US_2(nodes=1,stores=5), zone=US_3(nodes=1,stores=5)]
store_disk_capacity=1099511627776 bytes, node_cpu_rate_capacity=0 cpu-ns/sec
	randomized ranges with placement_type=random, num_ranges=865, key=[0,1427], rf=3, range_size=0 MiB
	[workload: 0ops/s(r:0,w:1), 1-1B/op, key=[0,200000]
	number of mutation events=0, number of assertion events=0
sample9: pass
----------------------------------
sample10: start running
configurations generated using seed 6738330972202035110
	cluster: region:US [zone=US_1(nodes=1,stores=5), zone=US_2(nodes=1,stores=5), zone=US_3(nodes=1,stores=5)]
store_disk_capacity=1099511627776 bytes, node_cpu_rate_capacity=0 cpu-ns/sec
	randomized ranges with placement_type=random, num_ranges=787, key=[0,1001], rf=3, range_size=0 MiB
	[workload: 0ops/s(r:0,w:1), 1-1B/op, key=[0,200000]
	number of mutation events=0, number of assertion events=0
sample10: pass
----------------------------------

clear
----

# We expect ranges to be randomly allocated across stores with a replication
# factor of 1.
rand_cluster cluster_gen_type=single_region
----

rand_ranges placement_type=random replication_factor=1
----

eval duration=20m num_iterations=3 verbose=(test_settings,config_gen)
----
test settings
	num_iterations=3 duration=20m0s
----------------------------------
generating cluster configurations using randomized option
	cluster_gen_type=single_region
generating ranges configurations using randomized option
	placement_type=random, range_gen_type=uniform, key_space=uniform, replication_factor=1, weightedRand=[]
generating load configurations using static option
	rw_ratio=0.00, rate=0.00, min_block=1, max_block=1, min_key=0, max_key=200000, skewed_access=false
generating events configurations using static option
generating settings configurations using static option
----------------------------------
sample1: start running
configurations generated using seed 1926012586526624009
	cluster: region:US [zone=US_1(nodes=1,stores=5), zone=US_2(nodes=1,stores=5), zone=US_3(nodes=1,stores=5)]
store_disk_capacity=1099511627776 bytes, node_cpu_rate_capacity=0 cpu-ns/sec
	randomized ranges with placement_type=random, num_ranges=305, key=[0,96760], rf=1, range_size=0 MiB
	[workload: 0ops/s(r:0,w:1), 1-1B/op, key=[0,200000]
	number of mutation events=0, number of assertion events=0
sample1: pass
----------------------------------
sample2: start running
configurations generated using seed 2643318057788968173
	cluster: region:US [zone=US_1(nodes=5,stores=1), zone=US_2(nodes=5,stores=1), zone=US_3(nodes=5,stores=1)]
store_disk_capacity=1099511627776 bytes, node_cpu_rate_capacity=0 cpu-ns/sec
	randomized ranges with placement_type=random, num_ranges=944, key=[0,150098], rf=1, range_size=0 MiB
	[workload: 0ops/s(r:0,w:1), 1-1B/op, key=[0,200000]
	number of mutation events=0, number of assertion events=0
sample2: pass
----------------------------------
sample3: start running
configurations generated using seed 6972490225919430754
	cluster: region:US [zone=US_1(nodes=5,stores=1), zone=US_2(nodes=5,stores=1), zone=US_3(nodes=5,stores=1)]
store_disk_capacity=1099511627776 bytes, node_cpu_rate_capacity=0 cpu-ns/sec
	randomized ranges with placement_type=random, num_ranges=479, key=[0,199954], rf=1, range_size=0 MiB
	[workload: 0ops/s(r:0,w:1), 1-1B/op, key=[0,200000]
	number of mutation events=0, number of assertion events=0
sample3: pass
----------------------------------
