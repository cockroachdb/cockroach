# In this test, we run the randomized testing framework with both the
# rand_ranges and rand_cluster options. We expect that the range_gen and
# cluster_gen configurations will change across iterations and runs.
#
# When a specific generator type is used, we expect the numbers generated to
# form a distribution. Due to limited sample size, it can be hard to observe the
# corresponding distribution pattern, but we can confirm that the parameters are
# set correctly and numbers generated look roughly accurate.
#
# Other parameters, such as replication factor and placement type should also be
# set and remain consistent across iterations.
rand_cluster cluster_gen_type=single_region
----

# We expect the placement of ranges across stores to be randomized with a
# replication factor of 3. range∈[1, 1000] should be generated with an uniform
# distribution pattern across iterations. The numbers generated are
# (305,944,479,487,285,611,271,502,865,787) - randomly distributed within [1,
# 1000]. keyspace∈[1000, 200000] should be generated with a zipf distribution
# pattern across iterations (1015,2357,1003,2171,1060,1000,1439,1198,1427.1001)
# - numbers close to 1000 are expected to occur frequently. configurations
# should be generated with an uniform distribution pattern across iterations.
rand_ranges placement_type=random replication_factor=3 range_gen_type=uniform keyspace_gen_type=zipf
----

eval duration=5m num_iterations=10 verbose=(test_settings,config_gen)
----
test settings
	num_iterations=10 duration=5m0s
----------------------------------
generating cluster configurations using randomized option
	cluster_gen_type=single_region
generating ranges configurations using randomized option
	placement_type=random, range_gen_type=uniform, key_space=zipf, replication_factor=3, weightedRand=[]
generating load configurations using static option
	rw_ratio=0.00, rate=0.00, min_block=1, max_block=1, min_key=1, max_key=200000, skewed_access=false
generating events configurations using static option
generating settings configurations using static option
----------------------------------
sample1: start running
configurations generated using seed 1926012586526624009
	loaded cluster with
 		region:US [zone=US_1(nodes=1,stores=5), zone=US_2(nodes=1,stores=5), zone=US_3(nodes=1,stores=5)]
	randomized ranges with placement_type=random, ranges=305, min_key=1, max_key=1015, replication_factor=3, bytes=0
	basic load with rw_ratio=0.00, rate=0.00, skewed_access=false, min_block_size=1, max_block_size=1, min_key=1, max_key=200000
	number of mutation events=0, number of assertion events=0
initial state at 2022-03-21 11:00:00:
	stores(15)=[s1n1=(replicas(38)),s2n1=(replicas(62)),s3n1=(replicas(87)),s4n1=(replicas(74)),s5n1=(replicas(98)),s6n2=(replicas(37)),s7n2=(replicas(111)),s8n2=(replicas(86)),s9n2=(replicas(61)),s10n2=(replicas(99)),s11n3=(replicas(25)),s12n3=(replicas(37)),s13n3=(replicas(25)),s14n3=(replicas(13)),s15n3=(replicas(62))]
topology:
US
  US_1
    └── [1]
  US_2
    └── [2]
  US_3
    └── [3]
no events were scheduled
sample1: failed assertion
  conformance unavailable=0 under=0 over=0 violating=0 lease-violating=0 lease-less-preferred=0 
  actual unavailable=1 under=1, over=0 violating=0 lease-violating=0 lease-less-preferred=0
unavailable:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3under replicated:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3
----------------------------------
sample2: start running
configurations generated using seed 2643318057788968173
	loaded cluster with
 		region:US [zone=US_1(nodes=5,stores=1), zone=US_2(nodes=5,stores=1), zone=US_3(nodes=5,stores=1)]
	randomized ranges with placement_type=random, ranges=944, min_key=1, max_key=1357, replication_factor=3, bytes=0
	basic load with rw_ratio=0.00, rate=0.00, skewed_access=false, min_block_size=1, max_block_size=1, min_key=1, max_key=200000
	number of mutation events=0, number of assertion events=0
initial state at 2022-03-21 11:00:00:
	stores(15)=[s1n1=(replicas(191)),s2n2=(replicas(154)),s3n3=(replicas(38)),s4n4=(replicas(77)),s5n5=(replicas(344)),s6n6=(replicas(268)),s7n7=(replicas(345)),s8n8=(replicas(76)),s9n9=(replicas(76)),s10n10=(replicas(191)),s11n11=(replicas(0)),s12n12=(replicas(344)),s13n13=(replicas(307)),s14n14=(replicas(153)),s15n15=(replicas(268))]
topology:
US
  US_1
    └── [1 2 3 4 5]
  US_2
    └── [6 7 8 9 10]
  US_3
    └── [11 12 13 14 15]
no events were scheduled
sample2: failed assertion
  conformance unavailable=0 under=0 over=0 violating=0 lease-violating=0 lease-less-preferred=0 
  actual unavailable=1 under=1, over=0 violating=0 lease-violating=0 lease-less-preferred=0
unavailable:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3under replicated:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3
----------------------------------
sample3: start running
configurations generated using seed 6972490225919430754
	loaded cluster with
 		region:US [zone=US_1(nodes=5,stores=1), zone=US_2(nodes=5,stores=1), zone=US_3(nodes=5,stores=1)]
	randomized ranges with placement_type=random, ranges=479, min_key=1, max_key=1003, replication_factor=3, bytes=0
	basic load with rw_ratio=0.00, rate=0.00, skewed_access=false, min_block_size=1, max_block_size=1, min_key=1, max_key=200000
	number of mutation events=0, number of assertion events=0
initial state at 2022-03-21 11:00:00:
	stores(15)=[s1n1=(replicas(80)),s2n2=(replicas(0)),s3n3=(replicas(120)),s4n4=(replicas(40)),s5n5=(replicas(80)),s6n6=(replicas(40)),s7n7=(replicas(180)),s8n8=(replicas(180)),s9n9=(replicas(160)),s10n10=(replicas(40)),s11n11=(replicas(180)),s12n12=(replicas(19)),s13n13=(replicas(39)),s14n14=(replicas(119)),s15n15=(replicas(160))]
topology:
US
  US_1
    └── [1 2 3 4 5]
  US_2
    └── [6 7 8 9 10]
  US_3
    └── [11 12 13 14 15]
no events were scheduled
sample3: failed assertion
  conformance unavailable=0 under=0 over=0 violating=0 lease-violating=0 lease-less-preferred=0 
  actual unavailable=1 under=1, over=0 violating=0 lease-violating=0 lease-less-preferred=0
unavailable:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3under replicated:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3
----------------------------------
sample4: start running
configurations generated using seed 8427801741804500990
	loaded cluster with
 		region:US [zone=US_1(nodes=1,stores=5), zone=US_2(nodes=1,stores=5), zone=US_3(nodes=1,stores=5)]
	randomized ranges with placement_type=random, ranges=487, min_key=1, max_key=2171, replication_factor=3, bytes=0
	basic load with rw_ratio=0.00, rate=0.00, skewed_access=false, min_block_size=1, max_block_size=1, min_key=1, max_key=200000
	number of mutation events=0, number of assertion events=0
initial state at 2022-03-21 11:00:00:
	stores(15)=[s1n1=(replicas(158)),s2n1=(replicas(20)),s3n1=(replicas(119)),s4n1=(replicas(99)),s5n1=(replicas(99)),s6n2=(replicas(118)),s7n2=(replicas(157)),s8n2=(replicas(118)),s9n2=(replicas(99)),s10n2=(replicas(119)),s11n3=(replicas(139)),s12n3=(replicas(0)),s13n3=(replicas(138)),s14n3=(replicas(0)),s15n3=(replicas(78))]
topology:
US
  US_1
    └── [1]
  US_2
    └── [2]
  US_3
    └── [3]
no events were scheduled
sample4: failed assertion
  conformance unavailable=0 under=0 over=0 violating=0 lease-violating=0 lease-less-preferred=0 
  actual unavailable=1 under=1, over=0 violating=0 lease-violating=0 lease-less-preferred=0
unavailable:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3under replicated:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3
----------------------------------
sample5: start running
configurations generated using seed 8063729658764635782
	loaded cluster with
 		region:US [zone=US_1(nodes=1,stores=5), zone=US_2(nodes=1,stores=5), zone=US_3(nodes=1,stores=5)]
	randomized ranges with placement_type=random, ranges=285, min_key=1, max_key=1060, replication_factor=3, bytes=0
	basic load with rw_ratio=0.00, rate=0.00, skewed_access=false, min_block_size=1, max_block_size=1, min_key=1, max_key=200000
	number of mutation events=0, number of assertion events=0
initial state at 2022-03-21 11:00:00:
	stores(15)=[s1n1=(replicas(99)),s2n1=(replicas(34)),s3n1=(replicas(34)),s4n1=(replicas(100)),s5n1=(replicas(67)),s6n2=(replicas(44)),s7n2=(replicas(55)),s8n2=(replicas(67)),s9n2=(replicas(33)),s10n2=(replicas(89)),s11n3=(replicas(23)),s12n3=(replicas(88)),s13n3=(replicas(11)),s14n3=(replicas(78)),s15n3=(replicas(33))]
topology:
US
  US_1
    └── [1]
  US_2
    └── [2]
  US_3
    └── [3]
no events were scheduled
sample5: failed assertion
  conformance unavailable=0 under=0 over=0 violating=0 lease-violating=0 lease-less-preferred=0 
  actual unavailable=1 under=1, over=0 violating=0 lease-violating=0 lease-less-preferred=0
unavailable:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3under replicated:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3
----------------------------------
sample6: start running
configurations generated using seed 3814222400681984302
	loaded cluster with
 		region:US [zone=US_1(nodes=1,stores=5), zone=US_2(nodes=1,stores=5), zone=US_3(nodes=1,stores=5)]
	randomized ranges with placement_type=random, ranges=611, min_key=1, max_key=1000, replication_factor=3, bytes=0
	basic load with rw_ratio=0.00, rate=0.00, skewed_access=false, min_block_size=1, max_block_size=1, min_key=1, max_key=200000
	number of mutation events=0, number of assertion events=0
initial state at 2022-03-21 11:00:00:
	stores(15)=[s1n1=(replicas(42)),s2n1=(replicas(171)),s3n1=(replicas(86)),s4n1=(replicas(171)),s5n1=(replicas(107)),s6n2=(replicas(170)),s7n2=(replicas(171)),s8n2=(replicas(42)),s9n2=(replicas(149)),s10n2=(replicas(0)),s11n3=(replicas(149)),s12n3=(replicas(170)),s13n3=(replicas(22)),s14n3=(replicas(192)),s15n3=(replicas(191))]
topology:
US
  US_1
    └── [1]
  US_2
    └── [2]
  US_3
    └── [3]
no events were scheduled
sample6: failed assertion
  conformance unavailable=0 under=0 over=0 violating=0 lease-violating=0 lease-less-preferred=0 
  actual unavailable=1 under=1, over=0 violating=0 lease-violating=0 lease-less-preferred=0
unavailable:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3under replicated:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3
----------------------------------
sample7: start running
configurations generated using seed 13013938835543503
	loaded cluster with
 		region:US [zone=US_1(nodes=1,stores=5), zone=US_2(nodes=1,stores=5), zone=US_3(nodes=1,stores=5)]
	randomized ranges with placement_type=random, ranges=271, min_key=1, max_key=1439, replication_factor=3, bytes=0
	basic load with rw_ratio=0.00, rate=0.00, skewed_access=false, min_block_size=1, max_block_size=1, min_key=1, max_key=200000
	number of mutation events=0, number of assertion events=0
initial state at 2022-03-21 11:00:00:
	stores(15)=[s1n1=(replicas(13)),s2n1=(replicas(104)),s3n1=(replicas(39)),s4n1=(replicas(26)),s5n1=(replicas(0)),s6n2=(replicas(103)),s7n2=(replicas(39)),s8n2=(replicas(12)),s9n2=(replicas(64)),s10n2=(replicas(51)),s11n3=(replicas(39)),s12n3=(replicas(52)),s13n3=(replicas(104)),s14n3=(replicas(116)),s15n3=(replicas(51))]
topology:
US
  US_1
    └── [1]
  US_2
    └── [2]
  US_3
    └── [3]
no events were scheduled
sample7: failed assertion
  conformance unavailable=0 under=0 over=0 violating=0 lease-violating=0 lease-less-preferred=0 
  actual unavailable=1 under=1, over=0 violating=0 lease-violating=0 lease-less-preferred=0
unavailable:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3under replicated:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3
----------------------------------
sample8: start running
configurations generated using seed 2207144605302255518
	loaded cluster with
 		region:US [zone=US_1(nodes=1,stores=5), zone=US_2(nodes=1,stores=5), zone=US_3(nodes=1,stores=5)]
	randomized ranges with placement_type=random, ranges=502, min_key=1, max_key=1198, replication_factor=3, bytes=0
	basic load with rw_ratio=0.00, rate=0.00, skewed_access=false, min_block_size=1, max_block_size=1, min_key=1, max_key=200000
	number of mutation events=0, number of assertion events=0
initial state at 2022-03-21 11:00:00:
	stores(15)=[s1n1=(replicas(40)),s2n1=(replicas(60)),s3n1=(replicas(178)),s4n1=(replicas(100)),s5n1=(replicas(99)),s6n2=(replicas(178)),s7n2=(replicas(59)),s8n2=(replicas(20)),s9n2=(replicas(158)),s10n2=(replicas(80)),s11n3=(replicas(60)),s12n3=(replicas(39)),s13n3=(replicas(138)),s14n3=(replicas(178)),s15n3=(replicas(119))]
topology:
US
  US_1
    └── [1]
  US_2
    └── [2]
  US_3
    └── [3]
no events were scheduled
sample8: failed assertion
  conformance unavailable=0 under=0 over=0 violating=0 lease-violating=0 lease-less-preferred=0 
  actual unavailable=1 under=1, over=0 violating=0 lease-violating=0 lease-less-preferred=0
unavailable:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3under replicated:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3
----------------------------------
sample9: start running
configurations generated using seed 5888461606762344739
	loaded cluster with
 		region:US [zone=US_1(nodes=1,stores=5), zone=US_2(nodes=1,stores=5), zone=US_3(nodes=1,stores=5)]
	randomized ranges with placement_type=random, ranges=865, min_key=1, max_key=1427, replication_factor=3, bytes=0
	basic load with rw_ratio=0.00, rate=0.00, skewed_access=false, min_block_size=1, max_block_size=1, min_key=1, max_key=200000
	number of mutation events=0, number of assertion events=0
initial state at 2022-03-21 11:00:00:
	stores(15)=[s1n1=(replicas(79)),s2n1=(replicas(199)),s3n1=(replicas(120)),s4n1=(replicas(120)),s5n1=(replicas(319)),s6n2=(replicas(40)),s7n2=(replicas(80)),s8n2=(replicas(0)),s9n2=(replicas(40)),s10n2=(replicas(240)),s11n3=(replicas(120)),s12n3=(replicas(360)),s13n3=(replicas(359)),s14n3=(replicas(199)),s15n3=(replicas(320))]
topology:
US
  US_1
    └── [1]
  US_2
    └── [2]
  US_3
    └── [3]
no events were scheduled
sample9: failed assertion
  conformance unavailable=0 under=0 over=0 violating=0 lease-violating=0 lease-less-preferred=0 
  actual unavailable=1 under=1, over=0 violating=0 lease-violating=0 lease-less-preferred=0
unavailable:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3under replicated:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3
----------------------------------
sample10: start running
configurations generated using seed 6738330972202035110
	loaded cluster with
 		region:US [zone=US_1(nodes=1,stores=5), zone=US_2(nodes=1,stores=5), zone=US_3(nodes=1,stores=5)]
	randomized ranges with placement_type=random, ranges=787, min_key=1, max_key=1001, replication_factor=3, bytes=0
	basic load with rw_ratio=0.00, rate=0.00, skewed_access=false, min_block_size=1, max_block_size=1, min_key=1, max_key=200000
	number of mutation events=0, number of assertion events=0
initial state at 2022-03-21 11:00:00:
	stores(15)=[s1n1=(replicas(0)),s2n1=(replicas(272)),s3n1=(replicas(242)),s4n1=(replicas(181)),s5n1=(replicas(152)),s6n2=(replicas(272)),s7n2=(replicas(91)),s8n2=(replicas(182)),s9n2=(replicas(0)),s10n2=(replicas(243)),s11n3=(replicas(182)),s12n3=(replicas(272)),s13n3=(replicas(90)),s14n3=(replicas(182)),s15n3=(replicas(0))]
topology:
US
  US_1
    └── [1]
  US_2
    └── [2]
  US_3
    └── [3]
no events were scheduled
sample10: failed assertion
  conformance unavailable=0 under=0 over=0 violating=0 lease-violating=0 lease-less-preferred=0 
  actual unavailable=1 under=1, over=0 violating=0 lease-violating=0 lease-less-preferred=0
unavailable:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3under replicated:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3
----------------------------------

clear
----

# We expect ranges to be randomly allocated across stores with a replication
# factor of 1.
rand_cluster cluster_gen_type=single_region
----

rand_ranges placement_type=random replication_factor=1
----

eval duration=20m num_iterations=3 verbose=(test_settings,config_gen)
----
test settings
	num_iterations=3 duration=20m0s
----------------------------------
generating cluster configurations using randomized option
	cluster_gen_type=single_region
generating ranges configurations using randomized option
	placement_type=random, range_gen_type=uniform, key_space=uniform, replication_factor=1, weightedRand=[]
generating load configurations using static option
	rw_ratio=0.00, rate=0.00, min_block=1, max_block=1, min_key=1, max_key=200000, skewed_access=false
generating events configurations using static option
generating settings configurations using static option
----------------------------------
sample1: start running
configurations generated using seed 1926012586526624009
	loaded cluster with
 		region:US [zone=US_1(nodes=1,stores=5), zone=US_2(nodes=1,stores=5), zone=US_3(nodes=1,stores=5)]
	randomized ranges with placement_type=random, ranges=305, min_key=1, max_key=96760, replication_factor=1, bytes=0
	basic load with rw_ratio=0.00, rate=0.00, skewed_access=false, min_block_size=1, max_block_size=1, min_key=1, max_key=200000
	number of mutation events=0, number of assertion events=0
initial state at 2022-03-21 11:00:00:
	stores(15)=[s1n1=(replicas(13)),s2n1=(replicas(20)),s3n1=(replicas(29)),s4n1=(replicas(25)),s5n1=(replicas(32)),s6n2=(replicas(12)),s7n2=(replicas(37)),s8n2=(replicas(28)),s9n2=(replicas(21)),s10n2=(replicas(33)),s11n3=(replicas(9)),s12n3=(replicas(13)),s13n3=(replicas(8)),s14n3=(replicas(5)),s15n3=(replicas(20))]
topology:
US
  US_1
    └── [1]
  US_2
    └── [2]
  US_3
    └── [3]
no events were scheduled
sample1: failed assertion
  conformance unavailable=0 under=0 over=0 violating=0 lease-violating=0 lease-less-preferred=0 
  actual unavailable=1 under=1, over=0 violating=0 lease-violating=0 lease-less-preferred=0
unavailable:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3under replicated:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3
----------------------------------
sample2: start running
configurations generated using seed 2643318057788968173
	loaded cluster with
 		region:US [zone=US_1(nodes=5,stores=1), zone=US_2(nodes=5,stores=1), zone=US_3(nodes=5,stores=1)]
	randomized ranges with placement_type=random, ranges=944, min_key=1, max_key=150098, replication_factor=1, bytes=0
	basic load with rw_ratio=0.00, rate=0.00, skewed_access=false, min_block_size=1, max_block_size=1, min_key=1, max_key=200000
	number of mutation events=0, number of assertion events=0
initial state at 2022-03-21 11:00:00:
	stores(15)=[s1n1=(replicas(64)),s2n2=(replicas(51)),s3n3=(replicas(12)),s4n4=(replicas(25)),s5n5=(replicas(115)),s6n6=(replicas(90)),s7n7=(replicas(114)),s8n8=(replicas(25)),s9n9=(replicas(26)),s10n10=(replicas(64)),s11n11=(replicas(0)),s12n12=(replicas(114)),s13n13=(replicas(103)),s14n14=(replicas(51)),s15n15=(replicas(90))]
topology:
US
  US_1
    └── [1 2 3 4 5]
  US_2
    └── [6 7 8 9 10]
  US_3
    └── [11 12 13 14 15]
no events were scheduled
sample2: failed assertion
  conformance unavailable=0 under=0 over=0 violating=0 lease-violating=0 lease-less-preferred=0 
  actual unavailable=1 under=1, over=0 violating=0 lease-violating=0 lease-less-preferred=0
unavailable:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3under replicated:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3
----------------------------------
sample3: start running
configurations generated using seed 6972490225919430754
	loaded cluster with
 		region:US [zone=US_1(nodes=5,stores=1), zone=US_2(nodes=5,stores=1), zone=US_3(nodes=5,stores=1)]
	randomized ranges with placement_type=random, ranges=479, min_key=1, max_key=199954, replication_factor=1, bytes=0
	basic load with rw_ratio=0.00, rate=0.00, skewed_access=false, min_block_size=1, max_block_size=1, min_key=1, max_key=200000
	number of mutation events=0, number of assertion events=0
initial state at 2022-03-21 11:00:00:
	stores(15)=[s1n1=(replicas(27)),s2n2=(replicas(1)),s3n3=(replicas(40)),s4n4=(replicas(13)),s5n5=(replicas(26)),s6n6=(replicas(13)),s7n7=(replicas(60)),s8n8=(replicas(60)),s9n9=(replicas(53)),s10n10=(replicas(14)),s11n11=(replicas(59)),s12n12=(replicas(6)),s13n13=(replicas(13)),s14n14=(replicas(40)),s15n15=(replicas(54))]
topology:
US
  US_1
    └── [1 2 3 4 5]
  US_2
    └── [6 7 8 9 10]
  US_3
    └── [11 12 13 14 15]
no events were scheduled
sample3: failed assertion
  conformance unavailable=0 under=0 over=0 violating=0 lease-violating=0 lease-less-preferred=0 
  actual unavailable=1 under=1, over=0 violating=0 lease-violating=0 lease-less-preferred=0
unavailable:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3under replicated:
  r1:000000000{0-1} [<no replicas>] applying ttl_seconds=0 num_voters=3
----------------------------------
