# ------------------------------------------------------------------------------
# Test basic operations.

reset term=1 index=5
----
mark:{Term:1 Index:5}, stable:5, admitted:[5 5 5 5]

append term=1 after=5 to=10
----
mark:{Term:1 Index:10}, stable:5, admitted:[5 5 5 5]

register term=1 index=7 pri=LowPri
----
mark:{Term:1 Index:10}, stable:5, admitted:[5 5 5 5]
LowPri: {Term:1 Index:7}

sync term=1 index=10
----
mark:{Term:1 Index:10}, stable:10, admitted:[6 10 10 10]
LowPri: {Term:1 Index:7}

admit term=1 index=6 pri=LowPri
----
mark:{Term:1 Index:10}, stable:10, admitted:[6 10 10 10]
LowPri: {Term:1 Index:7}

admit term=1 index=7 pri=LowPri
----
mark:{Term:1 Index:10}, stable:10, admitted:[10 10 10 10]

append term=1 after=10 to=12
----
mark:{Term:1 Index:12}, stable:10, admitted:[10 10 10 10]

register term=1 index=11 pri=LowPri
----
mark:{Term:1 Index:12}, stable:10, admitted:[10 10 10 10]
LowPri: {Term:1 Index:11}

register term=1 index=12 pri=HighPri
----
mark:{Term:1 Index:12}, stable:10, admitted:[10 10 10 10]
LowPri: {Term:1 Index:11}
HighPri: {Term:1 Index:12}

append term=2 after=5 to=10
----
mark:{Term:2 Index:10}, stable:5, admitted:[5 5 5 5]

# ------------------------------------------------------------------------------
# Test stable index advancement racing with admission.

reset term=1 index=1
----
mark:{Term:1 Index:1}, stable:1, admitted:[1 1 1 1]

append term=1 after=1 to=10
----
mark:{Term:1 Index:10}, stable:1, admitted:[1 1 1 1]

register term=1 index=5 pri=HighPri
----
mark:{Term:1 Index:10}, stable:1, admitted:[1 1 1 1]
HighPri: {Term:1 Index:5}

admit term=1 index=5 pri=HighPri
----
mark:{Term:1 Index:10}, stable:1, admitted:[1 1 1 1]

sync term=1 index=10
----
mark:{Term:1 Index:10}, stable:10, admitted:[10 10 10 10]

# ------------------------------------------------------------------------------
# Same race but sync completes first.

reset term=1 index=1
----
mark:{Term:1 Index:1}, stable:1, admitted:[1 1 1 1]

append term=1 after=1 to=10
----
mark:{Term:1 Index:10}, stable:1, admitted:[1 1 1 1]

register term=1 index=5 pri=HighPri
----
mark:{Term:1 Index:10}, stable:1, admitted:[1 1 1 1]
HighPri: {Term:1 Index:5}

sync term=1 index=10
----
mark:{Term:1 Index:10}, stable:10, admitted:[10 10 10 4]
HighPri: {Term:1 Index:5}

admit term=1 index=5 pri=HighPri
----
mark:{Term:1 Index:10}, stable:10, admitted:[10 10 10 10]
