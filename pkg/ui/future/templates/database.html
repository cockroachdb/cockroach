
{{ template "layout-start" .}}


<nav class="breadcrumbs" aria-label="Breadcrumbs">
  <ul>
    <li class="<h1>"><a href="/future/databases">Databases</a></li>
    <li class="<h2>">Database: {{ .Data.DatabaseName }}</li>
  </ul>
</nav>

<div role=tablist aria-label="Database">
  <button role=tab aria-controls=tables aria-selected=true>Tables</button>
  <button role=tab aria-controls=grants>Grants</button>
</div>


<div id=tables role=tabpanel>
  <form class="box flex-row" method="get">
    <div>
      <label for=search>Search:</label>
      <input type="text" name=search id=search placeholder="Search tables" value="{{ .Data.SearchFilter }}">
    </div>
    <div>
      <label for=nodeId>Nodes:</label>
      <select id=nodeId name=nodeId onchange="this.form.submit()">
        <option value="" {{ if eq .Data.SelectedNode 0 }}selected{{ end }}>All</option>
        {{ range $region, $nodes := .Data.NodesByRegion }}
        <optgroup label="{{ $region }}">
          {{ range $node := $nodes }}
          <option value="{{ $node.NodeID }}" {{ if eq (printf "%d" $.Data.SelectedNode) $node.NodeID }}selected{{ end }}>n{{ $node.NodeID }} ({{ $node.Address }})</option>
          {{ end }}
        </optgroup>
        {{ end }}
      </select>
    </div>
    <div class="flex-grow:2"></div>
    <div class="flex-column justify-content:end">
      <button type="submit">Apply Filters</button>
    </div>
  </form>

  <div x-data="tableSort()" style="overflow-x: auto;">
    <table id="table-data">
      <thead>
        <tr>
          <th @click="sort('name', 0)" style="cursor: pointer;">
            Name <span x-text="getSortIndicator('name')"></span>
          </th>
          <th @click="sort('size', 1)" style="cursor: pointer;">
            Replication Size <span x-text="getSortIndicator('size')"></span>
          </th>
          <th @click="sort('ranges', 2)" style="cursor: pointer;">
            Ranges <span x-text="getSortIndicator('ranges')"></span>
          </th>
          <th @click="sort('columns', 3)" style="cursor: pointer;">
            Columns <span x-text="getSortIndicator('columns')"></span>
          </th>
          <th @click="sort('indexes', 4)" style="cursor: pointer;">
            Indexes <span x-text="getSortIndicator('indexes')"></span>
          </th>
          <th @click="sort('livedata', 5)" style="cursor: pointer;">
            % of Live data <span x-text="getSortIndicator('livedata')"></span>
          </th>
          <th @click="sort('autostats', 6)" style="cursor: pointer;">
            Table auto stats enabled <span x-text="getSortIndicator('autostats')"></span>
          </th>
          <th @click="sort('statsupdated', 7)" style="cursor: pointer;">
            Stats last updated <span x-text="getSortIndicator('statsupdated')"></span>
          </th>
        </tr>
      </thead>
      <tbody>
        {{ if eq (len .Data.Tables) 0 }}
        <tr>
          <td colspan="8" style="text-align: center; padding: 2rem;">
            {{ if .Data.SearchFilter }}
              No tables found matching "{{ .Data.SearchFilter }}"
            {{ else }}
              No tables found in this database
            {{ end }}
          </td>
        </tr>
        {{ end }}
        {{ range .Data.Tables }}
        <tr>
          <td><a href="/future/tables/{{ .TableID }}">{{ .SchemaName }}.{{ .TableName }}</a></td>
          <td data-sort="{{ .ReplicationSizeBytes }}">{{ formatBytes .ReplicationSizeBytes }}</td>
          <td>{{ .RangeCount }}</td>
          <td>{{ .ColumnCount }}</td>
          <td>{{ .IndexCount }}</td>
          <td data-sort="{{ if .PercentLiveData }}{{ .PercentLiveData }}{{ else }}0{{ end }}">
            {{ if .PercentLiveData }}
              {{ formatPercent .PercentLiveData }}
              <br>
              <small>{{ formatBytes .TotalLiveDataBytes }} live / {{ formatBytes .TotalDataBytes }} total</small>
            {{ else }}
              N/A
            {{ end }}
          </td>
          <td data-sort="{{ if .AutoStatsEnabled }}1{{ else }}0{{ end }}">
            {{ if .AutoStatsEnabled }}
              <chip class="ok">Enabled</chip>
            {{ else }}
              <chip class="warn">Disabled</chip>
            {{ end }}
          </td>
          <td data-sort="{{ if .StatsLastUpdated }}{{ .StatsLastUpdated.Unix }}{{ else }}0{{ end }}">
            {{ if .StatsLastUpdated }}
              {{ .StatsLastUpdated.Format "Jan 02, 2006 at 15:04:05 UTC" }}
            {{ else }}
              Never
            {{ end }}
          </td>
        </tr>
        {{ end }}
      </tbody>
    </table>
    <div class="flex-row" style="justify-content: space-between; align-items: center; margin-top: 1rem;">
      <div>
        <span x-text="paginationInfo"></span>
      </div>
      <div style="display: flex; gap: 0.5rem; align-items: center;">
        <button
          @click="prevPage()"
          :disabled="currentPage === 1"
          type="button">
          ← Previous
        </button>
        <span>Page <span x-text="currentPage"></span> of <span x-text="totalPages"></span></span>
        <button
          @click="nextPage()"
          :disabled="currentPage === totalPages"
          type="button">
          Next →
        </button>
      </div>
    </div>
  </div>
</div>

<div id=grants role=tabpanel hidden>
  <table>
    <thead>
      <tr>
        <th>Grantee</th>
        <th>Privileges</th>
      </tr>
    </thead>
    <tbody>
      {{ if eq (len .Data.Grants) 0 }}
      <tr>
        <td colspan="2" style="text-align: center; padding: 2rem;">
          No grants found for this database
        </td>
      </tr>
      {{ end }}
      {{ range .Data.Grants }}
      <tr>
        <td>{{ .Grantee }}</td>
        <td>{{ join .Privileges ", " }}</td>
      </tr>
      {{ end }}
    </tbody>
  </table>
</div>
{{ template "layout-end" .}}
