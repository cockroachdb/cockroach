// Copyright 2018 The Cockroach Authors.
//
// Use of this software is governed by the Business Source License
// included in the file licenses/BSL.txt.
//
// As of the Change Date specified in that file, in accordance with
// the Business Source License, use of this software will be governed
// by the Apache License, Version 2.0, included in the file
// licenses/APL.txt.

// metric.proto requires proto2 to import io.prometheus.client.MetricType.
syntax = "proto2";
package cockroach.util.metric;
option go_package = "metric";

import "gogoproto/gogo.proto";
import "io/prometheus/client/metrics.proto";

// metric.LabelPair is a proxy for io.prometheus.client.LabelPair.
// io.prometheus.client.LabelPair doesn't support gogoproto.marshaler
// and gogoproto.unmarshaler which are required by gRPC. metric.LabelPair
// stores information that is similarly structured, supports the requisite
// gogoproto options, and is convertible to io.prometheus.client.LabelPair
// to satisfy PrometheusExportable's GetLabels method.
message LabelPair {
  optional string name  = 1;
  optional string value = 2;
}

// DisplayUnit describes how the metric's units should be displayed in charts.
enum Unit {
  // UNSET expresses that the metric's DisplayUnit wasn't explicitly set.
  UNSET = 0;
  // BYTES expresses that the metric's measurement is in bytes.
  BYTES = 1;
  // CONST expresses that the metric's measurement is a constant value.
  CONST = 2;
  // COUNT expresses that the metric's measurement is a count.
  COUNT = 3;
  // NANOSECONDS expresses that the metric's measurement is in nanoseconds.
  NANOSECONDS = 4;
  // PERCENT expresses that the metric's measurement is a percentage value.
  PERCENT = 5;
  // SECONDS expresses that the metric's measurement is in seconds.
  SECONDS = 6;
  // TIMESTAMP_NS expresses that the metric's measurement is a time since the
  // Unix epoch in nanoseconds.
  TIMESTAMP_NS = 7;
  // TIMESTAMP_SEC expresses that the metric's measurement is a time since the
  // Unix epoch in seconds.
  TIMESTAMP_SEC = 8;
}

// ValueRange indicates the range of values for a metric.
message ValueRange {
  optional string lowerBound = 1;
  optional string upperBound = 2;
  required Unit unit = 3;
}

// IndicatorInfo holds information on how to derive an indicator
// for a metric. It is embedded within the metadata field for a
// metric.
message IndicatorInfo {
  // aggregationInfo will contain free-form text on how to
  // perform aggregation over the metric to create an indicator.
  // This will likely need to be updated to some structured language
  // in the future.
  required string aggregationInfo = 1 [(gogoproto.nullable) = false];
  // implementationDetails will outline details on how the metric has
  // been implemented.
  required string implementationDetails = 2 [(gogoproto.nullable) = false];
  // limits will define the *possible* value range for the metric.
  optional ValueRange limits = 3 [(gogoproto.nullable) = false];
  // expected will define the *reasonable* value range for the metric.
  // expected and limits ValueRanges can be used in conjunction to get
  // an idea of the spectrum of acceptable and normal values for that metric.
  optional ValueRange expected = 4 [(gogoproto.nullable) = false];
}

// Metadata holds metadata about a metric. It must be embedded in
// each metric object. It's used to export information about the
// metric to Prometheus and for Admin UI charts.
message Metadata {
  required string name = 1 [(gogoproto.nullable) = false];
  required string help = 2 [(gogoproto.nullable) = false];
  required string measurement = 3 [(gogoproto.nullable) = false];
  required Unit unit = 4 [(gogoproto.nullable) = false];
  optional io.prometheus.client.MetricType metricType = 5 [(gogoproto.nullable) = false];
  repeated LabelPair labels = 6;
  optional IndicatorInfo indicatorInfo = 7 [(gogoproto.nullable) = false];
}
