# Explore the effects of the delta term. Set up an initial elastic limit of 5%
# and further below, a set-point of 25% to observe how we quickly we're able to
# increase the limit. We'll simulate two workloads under different
# delta values.
#
# (This is not to determine the right tuning parameters; that has to happen
# with actual experiments, this should hopefully help understand effects of the
# delta term.)
init limit=5%
----

params delta=0.1%
----
target-p99       = 1ms
min-util         = 5.00%
max-util         = 75.00%
inactive-util    = 22.50%
adjustment-delta = 0.10%
factor           = 2.00
inactive-factor  = 0.25

# Start a workload from scratch, increasing at 1% per tick.
tick
p99=1ms ticks=1 util-fraction=0.0
p99=1ms ticks=1 util-fraction=+0.01
----

auto set-point=25% ticks=400
----

params delta=1%
----
target-p99       = 1ms
min-util         = 5.00%
max-util         = 75.00%
inactive-util    = 22.50%
adjustment-delta = 1.00%
factor           = 2.00
inactive-factor  = 0.25

# Start a workload from scratch, increasing at 1% per tick.
tick
p99=1ms ticks=1 util-fraction=0.0
p99=1ms ticks=1 util-fraction=+0.01
----

auto set-point=25% ticks=400
----

# Observe that we're able to reach the set-point faster with a higher delta
# (right half), but it make for a more unstable controller (higher variation
# around the set point).
plot width=70 height=20
----
----
 1189 ┤                                                         ╭╮
 1157 ┤                                                         ││
 1125 ┤                                                         ││
 1093 ┤                                                         ││
 1060 ┤                                             ╭╮          ││      ╭╮
 1028 ┤             ╭╮            ╭╮                │╰╮         ││╭╮    ││
  996 ┼─────────────────────────────────────────────────────────────────────
  964 ┤│          ││││││      ││││││  ╭╮│ ╰╮  ││    │ │││  │╰╮╭╮│╰╯│╭╮  ││
  931 ┤│          ││││││╭╮  ╭╮││││││ ╭╯││  ╰──╯│ ╭╮ │ ╰╯│  │ ││││  │││  ││ ╭
  899 ┤│          ││││││││ ╭╯││││╰╯╰╮│ ││      │ │╰╮│   │╭╮│ ╰╯││  ││╰╮ ││╭╯
  867 ┤│        ╭╮│││││╰╯╰╮│ ││╰╯   ││ ││      ╰─╯ ││   ││││   ││  ╰╯ │╭╯││
  835 ┤│       ╭╯││││││   ╰╯ ╰╯     ││ ││          ││   ││││   ││     ╰╯ ││
  802 ┤│       │ ││││╰╯             ││ ││          ││   ╰╯││   ╰╯        ││
  770 ┤│   ╭─╮ │ ││╰╯               ╰╯ ││          ││     ╰╯             ││
  738 ┤│ ╭╮│ │ │ ││                    ╰╯          ╰╯                    ││
  706 ┤│ │││ ╰╮│ ╰╯                                                      ╰╯
  673 ┤│ │││  ││
  641 ┤│ │││  ││
  609 ┤╰─╯││  ╰╯
  577 ┤   ││
  544 ┤   ╰╯
                           p99 scheduler latencies (μs)


 26.4 ┤                                  ╭╮                     ╭╮
 25.1 ┤                                  ││                  ╭╮╮││   ╭╮
 23.7 ┤                                  │╰╮   ╭╮ ╭╮╭╮   ╭╮╭╮│╰╮││ ╭╭╯│   ╭─
 22.4 ┤                                  │ │ ╭╮││ ╭╮││   ╭╮╭╮│ │││╭─╯╯╰╮╮ ╭─
 21.1 ┤                      ╭─────╮╭────╮ │ │││╰─│││╰╮╭╮│││││ ╰╯││╯   ╰╮╭│
 19.8 ┤               ╭╮ ╭───╯     ╰╯    │ │╭╯╰╯ ╭╯││╰││╰╯╰╯││   ││     ╰─╯
 18.5 ┤           ╭───╯╰─╯               │ ││   ╭╯ ╰╯ ╰╯    ╰╯   ╰╯     ╰╯
 17.2 ┤          ╭╯                      │ ╰╯  ╭╯     ╰╯
 15.8 ┤        ╭─╯                       │     │
 14.5 ┤       ╭│                         │     │
 13.2 ┤      ╭╭╯                         │    ╭╯
 11.9 ┤     ╭╯│                          │    │
 10.6 ┤    ╭╯╭╯                          │   ╭╯
  9.2 ┤   ╭╯ │                           │   │
  7.9 ┤ ╭─╯ ╭╯                           │  ╭╯
  6.6 ┤╭╯  ╭╯                            │  │
  5.3 ┼╯   │                             │ ╭╯
  4.0 ┤   ╭╯                             │╭╯
  2.6 ┤  ╭╯                              ││
  1.3 ┤╭─╯                               ╰╯
 -0.0 ┼╯
                       elastic cpu utilization and limit (%)
----
----

# vim:ft=sh
