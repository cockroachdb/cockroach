# Simple tryGet calls.
init tier0=1 tier1=0
----
cpuTTG canBurst noBurst
tier0  0        1
tier1  0        0

try-get tier=tier1 v=1
----
kvtier1: tryGet(1) returned false

try-get tier=tier0 v=1
----
kvtier0: tryGet(1) returned true
cpuTTG canBurst noBurst
tier0  -1       0
tier1  -1       -1

try-get tier=tier0 v=1
----
kvtier0: tryGet(1) returned false

# More simple tryGet calls. This time, tier1 work is admitted.
init tier0=2 tier1=1
----
cpuTTG canBurst noBurst
tier0  -1       2
tier1  -1       1

continue-grant-chain tier=tier0
----
kvtier0: continueGrantChain

try-get tier=tier1 v=1
----
kvtier1: tryGet(1) returned true
cpuTTG canBurst noBurst
tier0  -2       1
tier1  -2       0

try-get tier=tier1 v=1
----
kvtier1: tryGet(1) returned false

try-get tier=tier0 v=1
----
kvtier0: tryGet(1) returned true
cpuTTG canBurst noBurst
tier0  -3       0
tier1  -3       -1

try-get tier=tier0 v=1
----
kvtier0: tryGet(1) returned false

# returnGrant adds tokens to the buckets, when a positive count is used.
init tier0=1 tier1=1
----
cpuTTG canBurst noBurst
tier0  -3       1
tier1  -3       1

return-grant tier=tier0 v=1
----
kvtier0: returnGrant(1)
cpuTTG canBurst noBurst
tier0  -2       2
tier1  -2       2

try-get tier=tier0 v=1
----
kvtier0: tryGet(1) returned true
cpuTTG canBurst noBurst
tier0  -3       1
tier1  -3       1

try-get tier=tier1 v=1
----
kvtier1: tryGet(1) returned true
cpuTTG canBurst noBurst
tier0  -4       0
tier1  -4       0

# Simple tookWithoutPermission test.
init tier0=3 tier1=3
----
cpuTTG canBurst noBurst
tier0  -4       3
tier1  -4       3

took-without-permission tier=tier1 v=3
----
kvtier1: tookWithoutPermission(3)
cpuTTG canBurst noBurst
tier0  -7       0
tier1  -7       0

try-get tier=tier0 v=1
----
kvtier0: tryGet(1) returned false

try-get tier=tier1 v=1
----
kvtier1: tryGet(1) returned false

# Test granting. Single tier0 request is admitted.
init tier0=0 tier1=0 tier0waiter=2 tier1waiter=1
----

return-grant tier=tier0 v=2
----
kvtier0: returnGrant(2)
kvtier0: granted in chain 0, and returning 2

# Test granting. Two tier1 requests are admitted.
init tier0=-1 tier1=-1 tier1waiter=1
----
cpuTTG canBurst noBurst
tier0  -7       -1
tier1  -7       -1

return-grant tier=tier0 v=3
----
kvtier0: returnGrant(3)
kvtier1: granted in chain 0, and returning 1
kvtier1: granted in chain 0, and returning 1
cpuTTG canBurst noBurst
tier0  -6       0
tier1  -6       0

# Simple tryGet calls, with burst this time.
init tier0burst=1 tier0=0 tier1burst=0 tier1=0
----
cpuTTG canBurst noBurst
tier0  1        0
tier1  0        0

try-get tier=tier0 v=1
----
kvtier0: tryGet(1) returned false

try-get tier=tier0 burst v=1
----
kvtier0: tryGet(1) returned true
cpuTTG canBurst noBurst
tier0  0        -1
tier1  -1       -1

try-get tier=tier0 burst v=1
----
kvtier0: tryGet(1) returned false

# Test granting, with burst. Only tier1 burst has enough tokens to grant. So grant.
init tier0burst=-1 tier0=-1 tier1burst=0 tier1=-1 tier1waiter=1 tier1burstwaiter
----
cpuTTG canBurst noBurst
tier0  -1       -1
tier1  0        -1

return-grant tier=tier0 v=1
----
kvtier0: returnGrant(1)
kvtier1: granted in chain 0, and returning 1

# Test granting, with burst. Only tier1 no-burst has enough tokens to grant. So no grant.
init tier0burst=-1 tier0=-1 tier1burst=-1 tier1=0 tier1waiter=1 tier1burstwaiter
----
cpuTTG canBurst noBurst
tier0  -1       -1
tier1  -1       0

return-grant tier=tier0 v=1
----
kvtier0: returnGrant(1)
cpuTTG canBurst noBurst
tier0  0        0
tier1  0        1
