init
----

# First call initializes.
update flushed=1000 ingested=0 admitted=10 write-accounted=500 ingested-accounted=0
----
interval state: {intWorkCount:0 intL0WriteBytes:0 intL0IngestedBytes:0 intLSMWriteAndIngestedBytes:0 intL0WriteAccountedBytes:0 intIngestedAccountedBytes:0 intWriteLinearModel:{multiplier:0 constant:0} intIngestedLinearModel:{multiplier:0 constant:0} intDiskBWLinearModel:{multiplier:0 constant:0} intBypassedWorkCount:0 intL0WriteBypassedAccountedBytes:0 intIngestedBypassedAccountedBytes:0 intL0IgnoredIngestedBytes:0}
at-admission-tokens: 1
write-tokens: int: 0.00x+0 smoothed: 1.75x+1 per-work-accounted: 1
ingest-tokens: int: 0.00x+0 smoothed: 0.75x+1 per-work-accounted: 1
disk-bw-tokens: int: 0.00x+0 smoothed: 1.75x+1 per-work-accounted: 1

# Writes account for ~1/2 of what is written, reflecting what can happen with
# application to the state machine. No ingests.
update flushed=1000 ingested=0 admitted=10 write-accounted=500 ingested-accounted=0
----
interval state: {intWorkCount:10 intL0WriteBytes:1000 intL0IngestedBytes:0 intLSMWriteAndIngestedBytes:1000 intL0WriteAccountedBytes:500 intIngestedAccountedBytes:0 intWriteLinearModel:{multiplier:1.98 constant:1} intIngestedLinearModel:{multiplier:0 constant:0} intDiskBWLinearModel:{multiplier:1.98 constant:1} intBypassedWorkCount:0 intL0WriteBypassedAccountedBytes:0 intIngestedBypassedAccountedBytes:0 intL0IgnoredIngestedBytes:0}
at-admission-tokens: 50
write-tokens: int: 1.98x+1 smoothed: 1.86x+1 per-work-accounted: 25
ingest-tokens: int: 0.00x+0 smoothed: 0.75x+1 per-work-accounted: 1
disk-bw-tokens: int: 1.98x+1 smoothed: 1.86x+1 per-work-accounted: 25

# Same as previous, except some of these are bypassed. Will not affect the model.
update flushed=1000 ingested=0 admitted=10 write-accounted=500 ingested-accounted=0 bypassed-count=4 bypassed-write=300 bypassed-ingested=0
----
interval state: {intWorkCount:10 intL0WriteBytes:1000 intL0IngestedBytes:0 intLSMWriteAndIngestedBytes:1000 intL0WriteAccountedBytes:500 intIngestedAccountedBytes:0 intWriteLinearModel:{multiplier:1.98 constant:1} intIngestedLinearModel:{multiplier:0 constant:0} intDiskBWLinearModel:{multiplier:1.98 constant:1} intBypassedWorkCount:4 intL0WriteBypassedAccountedBytes:300 intIngestedBypassedAccountedBytes:0 intL0IgnoredIngestedBytes:0}
at-admission-tokens: 75
write-tokens: int: 1.98x+1 smoothed: 1.92x+1 per-work-accounted: 37
ingest-tokens: int: 0.00x+0 smoothed: 0.75x+1 per-work-accounted: 1
disk-bw-tokens: int: 1.98x+1 smoothed: 1.92x+1 per-work-accounted: 37

# Ingestion also happens. Bumps up the at-admission-tokens since at that time
# we can't differentiate between writes and ingests. The constants in the
# linear models stays 1, since we can fit effectively using the multipliers.
# This means a mix of regular writes and sstable ingests (say index
# backfills), will not effect the cost attributed to regular writes. The
# ingest model will be fit based on accounted bytes of 40000, and actual bytes
# (ingested into L0) of 1000, hence the 0,25 multiplier. The disk-bw model
# uses all the incoming bytes including other-levels-ingested, so the observed
# bytes are 1000+1000+9000=11000, and the accounted bytes are 500+4000=4500,
# hence the multiplier of 2.44x.
update flushed=1000 ingested=1000 other-levels-ingested=9000 admitted=10 write-accounted=500 ingested-accounted=4000 bypassed-count=2 bypassed-write=0 bypassed-ingested=2000
----
interval state: {intWorkCount:10 intL0WriteBytes:1000 intL0IngestedBytes:1000 intLSMWriteAndIngestedBytes:11000 intL0WriteAccountedBytes:500 intIngestedAccountedBytes:4000 intWriteLinearModel:{multiplier:1.98 constant:1} intIngestedLinearModel:{multiplier:0.2475 constant:1} intDiskBWLinearModel:{multiplier:2.442222222222222 constant:1} intBypassedWorkCount:2 intL0WriteBypassedAccountedBytes:0 intIngestedBypassedAccountedBytes:2000 intL0IgnoredIngestedBytes:0}
at-admission-tokens: 137
write-tokens: int: 1.98x+1 smoothed: 1.95x+1 per-work-accounted: 43
ingest-tokens: int: 0.25x+1 smoothed: 0.50x+1 per-work-accounted: 200
disk-bw-tokens: int: 2.44x+1 smoothed: 2.18x+1 per-work-accounted: 243

# No ingestion into L0 observed by LSM, though ingested-accounted is non-zero
# -- this updates the model since all these ingested bytes have gone to levels
# lower than L0. For the disk-bw model, the observed bytes re 1000+500=1500,
# and the accounted bytes are 450+500=950, hence the multiplier of 1.57.
update flushed=1000 ingested=0 other-levels-ingested=500 admitted=10 write-accounted=450 ingested-accounted=500
----
interval state: {intWorkCount:10 intL0WriteBytes:1000 intL0IngestedBytes:0 intLSMWriteAndIngestedBytes:1500 intL0WriteAccountedBytes:450 intIngestedAccountedBytes:500 intWriteLinearModel:{multiplier:2.2 constant:1} intIngestedLinearModel:{multiplier:0.001 constant:1} intDiskBWLinearModel:{multiplier:1.568421052631579 constant:1} intBypassedWorkCount:0 intL0WriteBypassedAccountedBytes:0 intIngestedBypassedAccountedBytes:0 intL0IgnoredIngestedBytes:0}
at-admission-tokens: 118
write-tokens: int: 2.20x+1 smoothed: 2.08x+1 per-work-accounted: 44
ingest-tokens: int: 0.00x+1 smoothed: 0.25x+1 per-work-accounted: 125
disk-bw-tokens: int: 1.57x+1 smoothed: 1.88x+1 per-work-accounted: 169

# Large amount of ingestion. Bumps up at-admission-tokens.
update flushed=1000 ingested=1000000 other-levels-ingested=2000000 admitted=10 write-accounted=450 ingested-accounted=2000000
----
interval state: {intWorkCount:10 intL0WriteBytes:1000 intL0IngestedBytes:1000000 intLSMWriteAndIngestedBytes:3001000 intL0WriteAccountedBytes:450 intIngestedAccountedBytes:2000000 intWriteLinearModel:{multiplier:2.2 constant:1} intIngestedLinearModel:{multiplier:0.499995 constant:1} intDiskBWLinearModel:{multiplier:1.5001574645704716 constant:1} intBypassedWorkCount:0 intL0WriteBypassedAccountedBytes:0 intIngestedBypassedAccountedBytes:0 intL0IgnoredIngestedBytes:0}
at-admission-tokens: 50109
write-tokens: int: 2.20x+1 smoothed: 2.14x+1 per-work-accounted: 44
ingest-tokens: int: 0.50x+1 smoothed: 0.37x+1 per-work-accounted: 100062
disk-bw-tokens: int: 1.50x+1 smoothed: 1.69x+1 per-work-accounted: 100107

# Large number of bytes ingested into L0, but only 2000 are not to be ignored.
# So we can fit a reasonable model.
update flushed=0 ingested=1000000 admitted=10 write-accounted=0 ingested-accounted=2000 ignore-ingested-into-L0=998000
----
interval state: {intWorkCount:10 intL0WriteBytes:0 intL0IngestedBytes:1000000 intLSMWriteAndIngestedBytes:1000000 intL0WriteAccountedBytes:0 intIngestedAccountedBytes:2000 intWriteLinearModel:{multiplier:0 constant:0} intIngestedLinearModel:{multiplier:0.995 constant:1} intDiskBWLinearModel:{multiplier:0.995 constant:1} intBypassedWorkCount:0 intL0WriteBypassedAccountedBytes:0 intIngestedBypassedAccountedBytes:0 intL0IgnoredIngestedBytes:998000}
at-admission-tokens: 25154
write-tokens: int: 0.00x+0 smoothed: 2.14x+1 per-work-accounted: 44
ingest-tokens: int: 0.99x+1 smoothed: 0.68x+1 per-work-accounted: 50131
disk-bw-tokens: int: 0.99x+1 smoothed: 1.34x+1 per-work-accounted: 50153

# Repeat of the previous.
update flushed=0 ingested=1000000 admitted=10 write-accounted=0 ingested-accounted=2000 ignore-ingested-into-L0=998000
----
interval state: {intWorkCount:10 intL0WriteBytes:0 intL0IngestedBytes:1000000 intLSMWriteAndIngestedBytes:1000000 intL0WriteAccountedBytes:0 intIngestedAccountedBytes:2000 intWriteLinearModel:{multiplier:0 constant:0} intIngestedLinearModel:{multiplier:0.995 constant:1} intDiskBWLinearModel:{multiplier:0.995 constant:1} intBypassedWorkCount:0 intL0WriteBypassedAccountedBytes:0 intIngestedBypassedAccountedBytes:0 intL0IgnoredIngestedBytes:998000}
at-admission-tokens: 12677
write-tokens: int: 0.00x+0 smoothed: 2.14x+1 per-work-accounted: 44
ingest-tokens: int: 0.99x+1 smoothed: 0.84x+1 per-work-accounted: 25165
disk-bw-tokens: int: 0.99x+1 smoothed: 1.17x+1 per-work-accounted: 25176
