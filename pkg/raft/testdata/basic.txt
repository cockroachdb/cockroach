log-level none
----
ok

add-nodes 3 voters=(1,2,3) index=10 async-storage-writes=true
----
ok

campaign 1
----
ok

stabilize
----
ok

log-level debug
----
ok

propose 1 prop_1
----
ok

# Have two entries inflight entries to hit the scenario optimized
# in https://github.com/cockroachdb/cockroach/pull/139609 (term
# check can't rely on empty unstable log's term).

propose 1 prop_2
----
ok

stabilize 1
----
> 1 handling Ready
  Ready MustSync=true:
  Entries:
  1/12 EntryNormal "prop_1"
  1/13 EntryNormal "prop_2"
  Messages:
  1->2 MsgApp Term:1 Log:1/11 Commit:11 Entries:[1/12 EntryNormal "prop_1"]
  1->3 MsgApp Term:1 Log:1/11 Commit:11 Entries:[1/12 EntryNormal "prop_1"]
  1->2 MsgApp Term:1 Log:1/12 Commit:11 Entries:[1/13 EntryNormal "prop_2"]
  1->3 MsgApp Term:1 Log:1/12 Commit:11 Entries:[1/13 EntryNormal "prop_2"]
  1->AppendThread MsgStorageAppend Term:0 Log:1/13 Entries:[
    1/12 EntryNormal "prop_1"
    1/13 EntryNormal "prop_2"
  ] Responses:[
    1->1 MsgAppResp Term:1 Log:0/12 Commit:11
    1->1 MsgAppResp Term:1 Log:0/13 Commit:11
    AppendThread->1 MsgStorageAppendResp Term:0 Log:1/13
  ]
> 1 processing append thread
  Processing:
  1->AppendThread MsgStorageAppend Term:0 Log:1/13 Entries:[
    1/12 EntryNormal "prop_1"
    1/13 EntryNormal "prop_2"
  ]
  Responses:
  1->1 MsgAppResp Term:1 Log:0/12 Commit:11
  1->1 MsgAppResp Term:1 Log:0/13 Commit:11
  AppendThread->1 MsgStorageAppendResp Term:0 Log:1/13
> 1 receiving messages
  1->1 MsgAppResp Term:1 Log:0/12 Commit:11
  1->1 MsgAppResp Term:1 Log:0/13 Commit:11
  AppendThread->1 MsgStorageAppendResp Term:0 Log:1/13

stabilize 2
----
> 2 receiving messages
  1->2 MsgApp Term:1 Log:1/11 Commit:11 Entries:[1/12 EntryNormal "prop_1"]
  1->2 MsgApp Term:1 Log:1/12 Commit:11 Entries:[1/13 EntryNormal "prop_2"]
> 2 handling Ready
  Ready MustSync=true:
  Entries:
  1/12 EntryNormal "prop_1"
  1/13 EntryNormal "prop_2"
  Messages:
  2->AppendThread MsgStorageAppend Term:0 Log:1/13 Entries:[
    1/12 EntryNormal "prop_1"
    1/13 EntryNormal "prop_2"
  ] Responses:[
    2->1 MsgAppResp Term:1 Log:0/12 Commit:11
    2->1 MsgAppResp Term:1 Log:0/13 Commit:11
    AppendThread->2 MsgStorageAppendResp Term:0 Log:1/13
  ]
> 2 processing append thread
  Processing:
  2->AppendThread MsgStorageAppend Term:0 Log:1/13 Entries:[
    1/12 EntryNormal "prop_1"
    1/13 EntryNormal "prop_2"
  ]
  Responses:
  2->1 MsgAppResp Term:1 Log:0/12 Commit:11
  2->1 MsgAppResp Term:1 Log:0/13 Commit:11
  AppendThread->2 MsgStorageAppendResp Term:0 Log:1/13
> 2 receiving messages
  AppendThread->2 MsgStorageAppendResp Term:0 Log:1/13

stabilize 1
----
> 1 receiving messages
  2->1 MsgAppResp Term:1 Log:0/12 Commit:11
  DEBUG called Term(12)
  2->1 MsgAppResp Term:1 Log:0/13 Commit:11
> 1 handling Ready
  Ready MustSync=true:
  HardState Term:1 Vote:1 Commit:13 Lead:1 LeadEpoch:1
  CommittedEntries:
  1/12 EntryNormal "prop_1"
  1/13 EntryNormal "prop_2"
  Messages:
  1->2 MsgApp Term:1 Log:1/13 Commit:12
  1->3 MsgApp Term:1 Log:1/13 Commit:12
  1->2 MsgApp Term:1 Log:1/13 Commit:13
  1->3 MsgApp Term:1 Log:1/13 Commit:13
  1->AppendThread MsgStorageAppend Term:1 Log:0/0 Commit:13 Vote:1 Lead:1 LeadEpoch:1
  1->ApplyThread MsgStorageApply Term:0 Log:0/0 Entries:[
    1/12 EntryNormal "prop_1"
    1/13 EntryNormal "prop_2"
  ] Responses:[
    ApplyThread->1 MsgStorageApplyResp Term:0 Log:0/0 Entries:[
      1/12 EntryNormal "prop_1"
      1/13 EntryNormal "prop_2"
    ]
  ]
> 1 processing append thread
  Processing:
  1->AppendThread MsgStorageAppend Term:1 Log:0/0 Commit:13 Vote:1 Lead:1 LeadEpoch:1
  Responses:
> 1 processing apply thread
  Processing:
  1->ApplyThread MsgStorageApply Term:0 Log:0/0 Entries:[
    1/12 EntryNormal "prop_1"
    1/13 EntryNormal "prop_2"
  ]
  Responses:
  ApplyThread->1 MsgStorageApplyResp Term:0 Log:0/0 Entries:[
    1/12 EntryNormal "prop_1"
    1/13 EntryNormal "prop_2"
  ]
> 1 receiving messages
  ApplyThread->1 MsgStorageApplyResp Term:0 Log:0/0 Entries:[
    1/12 EntryNormal "prop_1"
    1/13 EntryNormal "prop_2"
  ]

stabilize
----
> 2 receiving messages
  1->2 MsgApp Term:1 Log:1/13 Commit:12
  1->2 MsgApp Term:1 Log:1/13 Commit:13
> 3 receiving messages
  1->3 MsgApp Term:1 Log:1/11 Commit:11 Entries:[1/12 EntryNormal "prop_1"]
  1->3 MsgApp Term:1 Log:1/12 Commit:11 Entries:[1/13 EntryNormal "prop_2"]
  1->3 MsgApp Term:1 Log:1/13 Commit:12
  1->3 MsgApp Term:1 Log:1/13 Commit:13
> 2 handling Ready
  Ready MustSync=true:
  HardState Term:1 Vote:1 Commit:13 Lead:1 LeadEpoch:1
  CommittedEntries:
  1/12 EntryNormal "prop_1"
  1/13 EntryNormal "prop_2"
  Messages:
  2->AppendThread MsgStorageAppend Term:1 Log:0/0 Commit:13 Vote:1 Lead:1 LeadEpoch:1 Responses:[
    2->1 MsgAppResp Term:1 Log:0/13 Commit:12
    2->1 MsgAppResp Term:1 Log:0/13 Commit:13
  ]
  2->ApplyThread MsgStorageApply Term:0 Log:0/0 Entries:[
    1/12 EntryNormal "prop_1"
    1/13 EntryNormal "prop_2"
  ] Responses:[
    ApplyThread->2 MsgStorageApplyResp Term:0 Log:0/0 Entries:[
      1/12 EntryNormal "prop_1"
      1/13 EntryNormal "prop_2"
    ]
  ]
> 3 handling Ready
  Ready MustSync=true:
  HardState Term:1 Vote:1 Commit:13 Lead:1 LeadEpoch:1
  Entries:
  1/12 EntryNormal "prop_1"
  1/13 EntryNormal "prop_2"
  Messages:
  3->AppendThread MsgStorageAppend Term:1 Log:1/13 Commit:13 Vote:1 Lead:1 LeadEpoch:1 Entries:[
    1/12 EntryNormal "prop_1"
    1/13 EntryNormal "prop_2"
  ] Responses:[
    3->1 MsgAppResp Term:1 Log:0/12 Commit:11
    3->1 MsgAppResp Term:1 Log:0/13 Commit:11
    3->1 MsgAppResp Term:1 Log:0/13 Commit:12
    3->1 MsgAppResp Term:1 Log:0/13 Commit:13
    AppendThread->3 MsgStorageAppendResp Term:0 Log:1/13
  ]
> 2 processing append thread
  Processing:
  2->AppendThread MsgStorageAppend Term:1 Log:0/0 Commit:13 Vote:1 Lead:1 LeadEpoch:1
  Responses:
  2->1 MsgAppResp Term:1 Log:0/13 Commit:12
  2->1 MsgAppResp Term:1 Log:0/13 Commit:13
> 3 processing append thread
  Processing:
  3->AppendThread MsgStorageAppend Term:1 Log:1/13 Commit:13 Vote:1 Lead:1 LeadEpoch:1 Entries:[
    1/12 EntryNormal "prop_1"
    1/13 EntryNormal "prop_2"
  ]
  Responses:
  3->1 MsgAppResp Term:1 Log:0/12 Commit:11
  3->1 MsgAppResp Term:1 Log:0/13 Commit:11
  3->1 MsgAppResp Term:1 Log:0/13 Commit:12
  3->1 MsgAppResp Term:1 Log:0/13 Commit:13
  AppendThread->3 MsgStorageAppendResp Term:0 Log:1/13
> 2 processing apply thread
  Processing:
  2->ApplyThread MsgStorageApply Term:0 Log:0/0 Entries:[
    1/12 EntryNormal "prop_1"
    1/13 EntryNormal "prop_2"
  ]
  Responses:
  ApplyThread->2 MsgStorageApplyResp Term:0 Log:0/0 Entries:[
    1/12 EntryNormal "prop_1"
    1/13 EntryNormal "prop_2"
  ]
> 1 receiving messages
  2->1 MsgAppResp Term:1 Log:0/13 Commit:12
  2->1 MsgAppResp Term:1 Log:0/13 Commit:13
  3->1 MsgAppResp Term:1 Log:0/12 Commit:11
  3->1 MsgAppResp Term:1 Log:0/13 Commit:11
  3->1 MsgAppResp Term:1 Log:0/13 Commit:12
  3->1 MsgAppResp Term:1 Log:0/13 Commit:13
> 2 receiving messages
  ApplyThread->2 MsgStorageApplyResp Term:0 Log:0/0 Entries:[
    1/12 EntryNormal "prop_1"
    1/13 EntryNormal "prop_2"
  ]
> 3 receiving messages
  AppendThread->3 MsgStorageAppendResp Term:0 Log:1/13
> 3 handling Ready
  Ready MustSync=false:
  CommittedEntries:
  1/12 EntryNormal "prop_1"
  1/13 EntryNormal "prop_2"
  Messages:
  3->ApplyThread MsgStorageApply Term:0 Log:0/0 Entries:[
    1/12 EntryNormal "prop_1"
    1/13 EntryNormal "prop_2"
  ] Responses:[
    ApplyThread->3 MsgStorageApplyResp Term:0 Log:0/0 Entries:[
      1/12 EntryNormal "prop_1"
      1/13 EntryNormal "prop_2"
    ]
  ]
> 3 processing apply thread
  Processing:
  3->ApplyThread MsgStorageApply Term:0 Log:0/0 Entries:[
    1/12 EntryNormal "prop_1"
    1/13 EntryNormal "prop_2"
  ]
  Responses:
  ApplyThread->3 MsgStorageApplyResp Term:0 Log:0/0 Entries:[
    1/12 EntryNormal "prop_1"
    1/13 EntryNormal "prop_2"
  ]
> 3 receiving messages
  ApplyThread->3 MsgStorageApplyResp Term:0 Log:0/0 Entries:[
    1/12 EntryNormal "prop_1"
    1/13 EntryNormal "prop_2"
  ]
