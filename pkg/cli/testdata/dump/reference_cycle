# Test dumping in the presence of cycles.
# This used to crash before with stack overflow due to an infinite loop before:
# https://github.com/cockroachdb/cockroach/pull/20255

sql
CREATE DATABASE d;
CREATE TABLE d.t (
	PRIMARY KEY (id),
	FOREIGN KEY (next_id) REFERENCES d.t(id),
	id INT,
	next_id INT
);
INSERT INTO d.t VALUES (
	1,
	NULL
);
----
INSERT 1

dump d t
----
----
CREATE TABLE t (
	id INT NOT NULL,
	next_id INT NULL,
	CONSTRAINT "primary" PRIMARY KEY (id ASC),
	CONSTRAINT fk_next_id_ref_t FOREIGN KEY (next_id) REFERENCES t (id),
	INDEX t_auto_index_fk_next_id_ref_t (next_id ASC),
	FAMILY "primary" (id, next_id)
);

INSERT INTO t (id, next_id) VALUES
	(1, NULL);
----
----
