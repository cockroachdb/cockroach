// Copyright 2022 The Cockroach Authors.
//
// Use of this software is governed by the Business Source License
// included in the file licenses/BSL.txt.
//
// As of the Change Date specified in that file, in accordance with
// the Business Source License, use of this software will be governed
// by the Apache License, Version 2.0, included in the file
// licenses/APL.txt.

syntax = "proto3";
package cockroach.cloud.externalconn.connectionpb;
option go_package = "connectionpb";

import "gogoproto/gogo.proto";
import "cloud/cloudpb/external_storage.proto";

// ConnectionProvider lists all the supported providers that can be represented
// by an External Connection.
enum ConnectionProvider {
  Unknown = 0;

  // ExternalStorage providers.
  nodelocal = 1;

  // KMS providers.
  gs_kms = 2;

  // Sink providers.
  kafka = 3;
}

// ConnectionType is the type of the External Connection object.
enum ConnectionType {
  option (gogoproto.goproto_enum_prefix) = false;

  UNSPECIFIED = 0 [(gogoproto.enumvalue_customname) = "TypeUnspecified"];
  STORAGE = 1 [(gogoproto.enumvalue_customname) = "TypeStorage"];
  KMS = 2 [(gogoproto.enumvalue_customname) = "TypeKMS"];
}

// ConnectionsDetails is the byte representation of the resource represented by
// an External Connection object.
message ConnectionDetails {
  ConnectionProvider provider = 1;

  oneof details {
    NodelocalConnectionDetails nodelocal = 2;
    GCSKMSConnectionDetails gcs_kms = 3 [(gogoproto.customname) = "GCSKMS"];
    KafkaConnectionDetails kafka = 4;
  }
}

// NodelocalConnectionDetails encapsulates the information required by an
// External Connection object to represent/dial a nodelocal URI.
message NodelocalConnectionDetails {
  // Cfg is the ExternalStorage configuration that represents a `nodelocal`
  // connection.
  cloudpb.LocalFileConfig cfg = 1 [(gogoproto.nullable) = false];
}

// GCSKMSConnectionDetails encapsulates the information required by an External
// Connection object to represent/dial a google cloud KMS URI.
message GCSKMSConnectionDetails {
  string uri = 1 [(gogoproto.customname) = "URI"];
}

// KafkaConnectionDetails encapsulates the information required by an External
// Connection object to represent/dial a kafka sink.
message KafkaConnectionDetails {
  string uri = 1 [(gogoproto.customname) = "URI"];
}
