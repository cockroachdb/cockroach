role node
  :start export p=$((26257+$pbase)) h=$((8080+$pbase)); \
         export TMPDIR=/tmp; \
         echo "postgresql://root@localhost:$p/?sslmode=disable">pgurl; \
		 $COCKROACH start \\
		  --join=$peers --listen-addr=localhost:$p --http-addr=localhost:$h --insecure \\
		  --background --pid-file=pid
  :init $COCKROACH init --url $(cat pgurl)
  :quit $COCKROACH quit --url $(cat pgurl)
  :reset kill $(cat pid) && sleep 1 && kill -9 $(cat pid) || true; rm -rf cockroach-data
  cleanup if test -e pid; then kill $(cat pid) && sleep 1 && kill -9 $(cat pid) || true; fi; \
          mkdir -p cockroach-data/logs; \
		  touch cockroach-data/logs/cockroach.log
  spotlight tail -F cockroach-data/logs/cockroach.log | \\
		  stdbuf -oL grep -v 'server is not accepting clients'
  signal   warning event at ^W(?P<ts_log>)\s+\d+\s+\S+\s+(?P<event>.*)$
  signal   error event at  ^E(?P<ts_log>)\s+\d+\s+\S+\s+(?P<event>.*)$
  signal   fatal event at  ^F(?P<ts_log>)\s+\d+\s+\S+\s+(?P<event>.*)$
end
