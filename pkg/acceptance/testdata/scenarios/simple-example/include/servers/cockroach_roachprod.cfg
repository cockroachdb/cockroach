role node
  :start export HOME=$ROACHPROD_HOME/.. TMPDIR=/tmp; \\
         $ROACHPROD pgurl $CLUSTER:$nodei --external | sed "s/'//g" >pgurl && \\
         echo $CLUSTER:$nodei >roachprod_target && \\
         $ROACHPROD start $CLUSTER:$nodei
  :init true
  :reset HOME=$ROACHPROD_HOME/.. $ROACHPROD wipe $CLUSTER:$nodei
  :quit  export HOME=$ROACHPROD_HOME/.. TMPDIR=/tmp; \\
         $ROACHPROD run $CLUSTER:$nodei "./cockroach quit --insecure --host=localhost"
  cleanup export HOME=$ROACHPROD_HOME/..; \
		  if test -e wiped; then \
            $ROACHPROD stop $CLUSTER:$nodei; \
            $ROACHPROD get $CLUSTER:$nodei logs || true; \
		  else \
		    $ROACHPROD wipe $CLUSTER; \
			touch wiped; \
		  fi
  spotlight HOME=$ROACHPROD_HOME/.. $ROACHPROD run $CLUSTER:$nodei "tail -F logs/cockroach.log" | \\
		  stdbuf -oL grep '^[WEF]' | \\
		  stdbuf -oL grep -v 'server is not accepting clients'
  signal   warning event at ^W(?P<ts_log>)\s+\d+\s+\S+\s+(?P<event>.*)$
  signal   error event at  ^E(?P<ts_log>)\s+\d+\s+\S+\s+(?P<event>.*)$
  signal   fatal event at  ^F(?P<ts_log>)\s+\d+\s+\S+\s+(?P<event>.*)$
end
