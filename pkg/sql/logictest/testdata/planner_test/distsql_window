# LogicTest: 5node-dist

statement ok
CREATE TABLE data (a INT, b INT, c FLOAT, d DECIMAL, PRIMARY KEY (a, b, c, d))

# Prevent the merge queue from immediately discarding our splits.
statement ok
SET CLUSTER SETTING kv.range_merge.queue_enabled = false;

# Split into ten parts.
statement ok
ALTER TABLE data SPLIT AT SELECT i FROM generate_series(1, 9) AS g(i)

# Relocate the ten parts to the five nodes.
statement ok
ALTER TABLE data EXPERIMENTAL_RELOCATE
  SELECT ARRAY[i%5+1], i FROM generate_series(0, 9) AS g(i)

# Verify data placement.
query TTTI colnames
SELECT start_key, end_key, replicas, lease_holder FROM [SHOW EXPERIMENTAL_RANGES FROM TABLE data]
----
start_key  end_key  replicas  lease_holder
NULL       /1       {1}       1
/1         /2       {2}       2
/2         /3       {3}       3
/3         /4       {4}       4
/4         /5       {5}       5
/5         /6       {1}       1
/6         /7       {2}       2
/7         /8       {3}       3
/8         /9       {4}       4
/9         NULL     {5}       5

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a) OVER () FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJys0z9r8zAQBvD9_RTmmd6CjCz_6eApa4Y2JWnpUDyo1pEaEslIMm0J_u4l9pA6JEXFHaXz4_txnA7QRtG93JND-QIBhhQMGRhyMBSoGFpranLO2OMnY2CpPlAmDI1uO3-8rhhqYwnlAb7xO0KJR_m6ozVJRZYnYFDkZbMb2rS22Uv7uVDSSzBsWqldGcVcRFKrSETGv5EFw6rzZbQQqHoG0_lTL-flllCKnl3xnBidNlaRJTUhVP0F8XOjlXkny4spd_N0938hbq4y0glDhI9FhIyFi5inswaThovSIFEa82yWKAsXZUGiLOb5LFEeLsqDRHnMiz9b5wuiNbnWaEdna335z8lx3UltaXwbznS2pgdr6qHNeFwNueFCkfNjVYyHpR5KA_B7WPwYvp2Ek_NwOqdzNieczwkXvwpX_b-vAAAA__9Mf79x

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a) OVER (PARTITION BY b ORDER BY c) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy8lcFv2j4Ux--_v8J6p1Y_R4mdQGlOWbUdOAwqyjRVUw4ufipINI4co62q-N8noBKDdX6WDBwT--P33ucr2W_QGI0j9YIdlD9AAAcJHHLgUACHHtQcWmtm2HXGbrbsgKH-BWXGYdG0K7f5XXOYGYtQvoFbuCVCCVP1tMQJKo02zYCDRqcWy22Z1i5elH2ttHIKODy0qulKlqSCqUYzwYybowUO45UrWSV4JXmVQ73mYFbuveK-0NMrm6tufliiklCvaw6dU88IpVjzf3S-P2fVGKvRoj44aXvK8WzfF402P9GmvcOq958m0-F0OB6xu8eSVRuVD9--XlXiml2NJ5-_TNjdI6vy_6-Phtk3Kk_b6Mgkpk1FdrTz49r5QW0RHq8IiTcVSSovFLA4WcD98wYswyXLIMkySfMLSZYnk3xzXsl5uOQ8SHKepMWFJOcnkzw4r-QiXHIRJLlI0t6FJBcnk3x7uffggzYm2LWm6TDots82g6B-xt3UnVnZGd5bM9uW2X2Ot9z2PtXYud3q-8ew2S1tGgyHixi4HwMPYmCR-WlxTGd_0tIPSy8sDn1nx3QeE5YfJsLyw0RYfpgIi5iZCKuICasXo9sPE7r9MKHbDxO6iZkJ3f0Y3Tcxuv0wodsPE7r9MKGbmJnQPYjRfRuj2w8Tuv0wodsPE7qJmamb_6-Hw-u7Xv_3OwAA___UrghU

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a) OVER (PARTITION BY b ORDER BY c) FROM data ORDER BY d]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy8lV9v2jAUxd_3KaL71KqOgh2nf_KUVdsDD4MKmKZq4iHFVkGiceQYbVXFd58IRTQp-Hpy4BGS43NyflfXb1AoIQf5i6wg_Q0UCDAgEAMBDgQSmBIotZrJqlJ688pW0Bd_Ie0RWBTlymz-nhKYKS0hfQOzMEsJKUzyp6UcyVxIHfWAgJAmXyxrm1IvXnL9monc5EBgXOZFlQZhRIO8EAENlJlLDQSGK5MGGSUZJxkjWQzTNQG1Mu-me6-n12CeV_OmS_3-lEBl8mcJKV2TI-H356wKpYXUUjROqk9pf96vRSHUH6mjpOn68HU06U_6w0Fw_5gG2abJ8c8fFxm9DC6Go2_fR8H9Y5Dxq8vWx-yDsqNBD8QYK22kjmir4YxdfeyPHTWLHVo51EntcLCYgQpVGdGkVeFhe96wp-4TRV0mKqJhxM43U7Szmbo-7UwhPe9minYyU8wdKnOCysIoPh9U1hnUm9NCRXreQWWdQI3docZOUOMw4ueDGncG9fa0UJGed1DjTqByd6jcCSoPo-R8UHlnUO9OCxXpeQeVd36lHzAbyapURSWdbuvepjUpnuW24kqt9Ew-aDWrbbY_h7WuvmOErMz26fuPfrF9tAnoLk58xLc-YuqVm3K7mrbVvY9q1hD32mJmFcd259gqptd2a-6D2i5GUNvFCGoktlduDHViLRzp-9oH9Y0PLLsYgWUXI7CQ2F65MVi31r7v7LDufGBRry2KqBFciBrhhSX3i45uUvsqpcgupV7LlH7apv8Fza7GoNnVGDQkuV90FNqnldqEliDQ7Du1DW26_vIvAAD__5RQHrM=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a) OVER (PARTITION BY b ORDER BY c), avg(a) OVER (PARTITION BY b) FROM data ORDER BY d]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy8lk9vm0AQxe_9FGhOibII7x-SmBOJWlU-1I5st1VUcSBmFVtyWLRgtVHk716BYzkQskO1FMkXjN--x_uNBr9AqhI5jZ9kDsEvoECAAQEOBAQQ8CEikGm1knmudPmTg2CS_IFgRGCTZrui_DoisFJaQvACxabYSghgGT9s5VzGidTeCAgksog328om05unWD-HSVzEQGCRxWkeOK5HnThNHOqoYi01EJjtisAJKSk_goSMhByiPQG1K159T3YPz846ztd1o1BAtI8I5EX8KCGge_JB_tM5u1TpRGqZ1E6qTmk-4c9NmqjfUnt-3fXuZr6cLCezqXN7HzhhWeTi-7ezkJ47Z7P55y9z5_beCf2LcyBw8-PrWcjOG491isw-jNwSaKF0IbVHG3WH_OJtmS01nvx4h4raCqpMWluaKldlHvUbfbbbi5o97T5htMuEedT12KAzRnubscuhZgwp_ThjtK8ZY90hs06QmevxQSGz3iBfDQUZKf0ImfUFmXeHzDtB5q4nBoXMe4N8PRRkpPQjZN4XZNEdsugEWbiePyhk0Rvk8VCQkdKPkMX_-EvQ4jeXeabSXHZ624_KCmXyKA9952qnV_JOq1Vlc7icVbrqtZTIvDjcfb2YpIdbZcDuYt9GfG0jpla5qTCraVM9eqtmNfGoKWZGMTc7c6OYXpqthQ1qsxhBbRYjqJHYVrkx1L6xcKTvSxvUVzawzGIEllmMwEJiW-XGYF0b-x6bYY1tYFGrLYqoEVyIGuGFJbeLjm5S8yqlyC6lVsuUvtum_wTNrMagmdUYNCS5XXQU2ruVWofmI9DMO7UJLdp_-hsAAP__Fn8vSQ==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a) OVER w1 AS sum_a, avg(b) OVER w2 FROM data WINDOW w1 AS (PARTITION BY b ORDER BY c), w2 AS (PARTITION BY a, d) ORDER BY sum_a ]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzMlt9L40oUx9_vXxHOk-KUZCZJf-Qpyr1c-rBWqruLLH2IzaAFzZQkZVek__uS1OKmqfNNmdlS8MFaP_nmnPkczrxRplJ5nbzIgqIfxImRIEY-MQqIUUgzRstczWVRqLz6lw0wTn9R5DFaZMtVWf15xmiucknRG5WL8llSRHfJw7OcyiSVuesRo1SWyeK5jlnmi5ckf43TpEyI0e0yyYrI6bncSbLU4Y4qn2ROjCarMnJizmJR__is-j2g2ZqRWpXv0R-JD6_OU1I8NbNin2brGaOiTB4lRXzNPinh4zmrTOWpzGXaeFL9lN0ivy-yVP2UuRs2U28up3fju_Hk2rm6j5y46uft1y9nMT93zibTf_-bOlf3ThxcnB9YTMjifqMe8Zfq4Z62oPo9GF1--_8sFrtFfLyd_-nb7cm-VXlZJe-0MuYXDRU-DQs6tGJfI-qEvd24Vj21dIW307f98WEjnncfDt5lOFzec8Wxx4Nb06l_EuNhrx7O7Y8HUGY7Hn0r4yG6-yk6-Sl6rn9sP4W18xychJ_26uHCvp9Ama2fAyt--t399Dv56ffc4Nh--tbOc3gSftqrh_v2_QTKbP0cWvEz6O5n0MnPoOeGx_YzsHaeo5Pw0149PLDvJ1Bm6-fI-vV3T9hUFkuVFbLTzdarWiXTR7npa6FW-Vze5Gpex2w-TmquvsSksig3375_GGebr6oX7A73TWDuGdGBET3U01xLCxN4YAJzcFyADo3okZ4Wu7T3J-03YG8X9rUwOOtACwuujw5N5kMPg_kAyWA-AA16BmgwH32T-dDDYD70MJoPQIP5ADSYj4HW0qFe0qHJfIxMDNfDwHCQDAwHtFnVaAPoFwhaAXoa7QCwvNASADjaAgAHmvPWFmmoyoVedK5fI-DMeWuPHKI6oIHrKBvIjnDDypHurR16kO56Gumup6HuAEe6Axzp3lqkTd37QPfWTjlI99ZOOUh3PY10B9lId4AbVo50b-3Tg3TX00h3PQ11BzjSHeBI99ZWbd61Pb3uorVbtLrP1v_8DgAA__8EX2bn

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a) OVER w1 AS sum_a, avg(b) OVER w2, rank() OVER w1 AS rnk, row_number() OVER w3 AS rnumber, max(a) OVER w3, min(b) OVER w2 FROM data WINDOW w1 AS (PARTITION BY b ORDER BY c), w2 AS (PARTITION BY a, d), w3 AS (PARTITION BY a, c ORDER BY b, d) ORDER BY rnk, rnumber ]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzMmFFv4kYUhd_7K6z7xCqDzIxtEvw0ibqqUBVYOdluVxWqvPFog5S1kW3Urlb89woTmpqQOabXgF9WC87HmePxOXPhB6VZYibxN1NQ-AdJEqRIkEeCfBIU0EzQIs8eTFFk-fpPNsA4-ZvCgaB5uliW67dngh6y3FD4g8p5-WQopPv4y5OJTJyY3B2QoMSU8fypklnk829x_l0ncRmToLtFnBah03elE6eJI52sfDQ5CZouy9DRUmglnv9VQnvV_32arQRly_J5AS-6X747j3HxWFfUAc1WM0FFGX81FMqVeMPIy-cs0yxPTG6S2idVn7Jr9dM8TbK_TO4GddUP19H9-H48nTg3n0NHr6_efbztafnO6U2jn99Hzs1nRw8v3pGg6Hrya-_V-4eZvBJ6VPOpjuRTDqxGq3UIuv7tl55Wa3O340lPB__DzmXNjncsO_Z9q9YhKJp--nPy8fbmfbS7T0KPqj28vf69p_29F-vOXyz5b1ras-C7LC9N7qqdu6-9C6H9i53AeEL7QgdCD98UDxrcz31381_Fvbd1kvWzhauCnQ3Yv4RhbQmyeaXIJpXiyr6rzlMqsrWnc9jpUmnPp5QdKJUW7dj37XSlAkK1LRV5lFJRzROtGiVa9V3vPIlWrT0al51OdHs-pepAolu0Y9-30yUahGqbaHWURHvNE-01SrTXd_3zJNpr7dG46nSi2_MpvQ4kukU79n07XaJBqLaJ9o6SaL95ov1Gifb7bnCeRPutPRqjTie6PZ_S70CiW7Rj37fTJRqEapto_-hf5feIR6ZYZGlhGn1DH6zvt0m-ms3mFNkyfzAf8uyhktm8nFZc9VUjMUW5ufr8YpxuLq0X2By-5MBSsWiWtgLa0k5z4CsOLD0WzdJWQFtZaRY84sDSZ9EsbQW0vV168F-6Dg92Yd8KB3blwAqroV16yOkUOwxyDZRBNAHN0kadcsnpFDsMcm2HUacAmqWNOuWK0yl2GOTaDqNOATRLG3XKyJpsObAnW746OA9pFQkOIBYN0om00akNcJ46HDjAOcKi0bEPTkA0cwCcp44aQr46Qg-pCECDnAIalQTCeeqoJqR9fJAB6An7AIF6gjVAABollTdCIJynDnuCNUUAGiWVN0cgnKcOe4I1SgAaJZU3TCCcpw57wj5PKDBPKNY8oVjzBKBBUpE2yBrCeeqoJxRrngA0SCqgUU8gnKcOf8VgzROARr8l8OYJhPPUUU8o-zyhwDyhDpsnZquf_gkAAP__ZU8jyg==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT min(d) OVER w1, sum(a) OVER w2, avg(b) OVER w3 FROM data WINDOW w1 AS (PARTITION BY b ORDER BY c), w2 AS (ORDER BY c), w3 AS (PARTITION BY a, d) ORDER BY a, b ]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzElV1v2jwYhs_fXxE9R1Q1SvwRPnLkVu80cVCogG2qphykxCpINEaO0VZV_PeJpBsjLX6CAuMEEcLl5_aVW84rZDpVw-RZ5RB9BwoEGBDgQEAAgRBiAiujZyrPtdn-pQQG6U-IAgKLbLW2259jAjNtFESvYBd2qSCCafK4VGOVpMr4ARBIlU0Wy2LMyiyeE_Mi08QmQGCySrI88to-9ZIs9ain7VwZIDBa28iTgkhKJPv9yYjkxXcB8YaAXtu3DLvRjy_ePMnn-0NlB-JNTCC3yZOCiG7Igb3s1lln2qTKqHRvpWKV6m6_LbJU_1DGD_en3t-Mp4PpYDT0bh8iT3aAwN1g2JL0ymuNxv9_Gnu3D57sXl9VNrMLys4UlFYeyuTLXUuy2rH4wVjOodSpp0dkHwjcfP3ckvzwbHHM7Ik2djuZVeogrokMr_-0rCwXPzgz3JtJ63ef1um-T9s-u1j76clK1Tlv-1l97ayWdtb2-cW0s5Np755XO6-vndfSztu-uJh2fjLtvfNqF_W1i1raRdsPL6ZdnEx7_9-9Yj-IMVb5Sme5qgT-eOVguxGVPqly17lem5m6N3pWjCkvRwVXnMKpym159-1ikJW3tgHrw50mcK8JTINGNHPTtEoHf9MIzJww34ODKsydsHDDwglTZHTYpCduGOmJG0Z6gsRGeoLQyKPuNOlJt4lvN4z4dsOIbyQ24huhEWW9Jr77TXy7YcS3G0Z8I7ER3wiNnYPvjtFjhNN3x-gxxhEaUY7QiHMsOSIdwzFv7jdIlY43__0KAAD__41HldU=
