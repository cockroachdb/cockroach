# LogicTest: 5node-dist

statement ok
CREATE TABLE data (a INT, b INT, c FLOAT, d DECIMAL, PRIMARY KEY (a, b, c, d))

# Prevent the merge queue from immediately discarding our splits.
statement ok
SET CLUSTER SETTING kv.range_merge.queue_enabled = false;

# Split into ten parts.
statement ok
ALTER TABLE data SPLIT AT SELECT i FROM generate_series(1, 9) AS g(i)

# Relocate the ten parts to the five nodes.
statement ok
ALTER TABLE data EXPERIMENTAL_RELOCATE
  SELECT ARRAY[i%5+1], i FROM generate_series(0, 9) AS g(i)

# Verify data placement.
query TTTI colnames
SELECT start_key, end_key, replicas, lease_holder FROM [SHOW EXPERIMENTAL_RANGES FROM TABLE data]
----
start_key  end_key  replicas  lease_holder
NULL       /1       {1}       1
/1         /2       {2}       2
/2         /3       {3}       3
/3         /4       {4}       4
/4         /5       {5}       5
/5         /6       {1}       1
/6         /7       {2}       2
/7         /8       {3}       3
/8         /9       {4}       4
/9         NULL     {5}       5

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a) OVER () FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJyskjFvqzAUhff3K9CZ3pOMjA28gSlrhvdSpa06VAwuvkqREhvZRm0V8d-rwJASJYiKjr6Xj_Pp6hxhrKb_6kAexTMEGCQYUjBkYMhRMjTOVuS9dadPBmCt31EkDLVp2nAalwyVdYTiiFCHPaHAg3rZ05aUJscTMGgKqt73MY2rD8p9rLQKCgwxF5EyOhKRDa_kwLBpQxGtBMqOwbbhHOKD2hEK0bEbIuf81linyZEeZZfdFdWn2mj7Ro7nY8_7x3-_V-LPTQ050hDz7yEm78FFzOWii8j5KnJaRcY8XaSSzldJp1XSmGeLVLL5Ktm0Shbz_Mcqe0VlS76xxtNFda__OTlVmvSOhv5727qK7pyt-pjhuem5fqDJh2Erhsfa9Kte8CssJuG_Izi5hOWS5HQJnC2B82_BZffrMwAA__-i97OW

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a) OVER (PARTITION BY b ORDER BY c) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy8lcFu2kAQhu99CmtOibqWvWtDiE9u1B44FCJKVUWVDxt2FJCIF60XtVHEu1dAJApNZywt-Gjsb2f-75eWV6itwZF-xgaKnyBBgAIBGQjIQUAPKgErZ2fYNNZtP9kDQ_MbilTAol6t_fbnSsDMOoTiFfzCLxEKmOrHJU5QG3RJCgIMer1Y7sas3OJZu5fSaK9BQJzISNcmkpH1c3QgYLz2RVRKUSpRZlBtBNi1fxt1mPD4Es11Mz8-u1RQbSoBjddPCIXciP-sfDhnXVtn0KE5Oml3ymmoH4va2F_okt7x1PtPk-lwOhyPoruHIiq3Dr99_3pVyuvoajz5_GUS3T1EZfbx-iTMYVF13kVHNrarRKYnX74_OzuaLdv3KsleExknqqNm5dma7V-2WdXerqLtqjjJOrKrzmb35rJ2s_Z2M9puFid5R3azs9kdXNZu3t5uTtvN46TXkd38bHZvu7vz31ljgs3K1g22utHTbRA0T7hP3di1m-G9s7PdmP3jeMftrk6Djd-_fXsY1vtX2wXbw3kI3A-BByGwTGlantLp37SiYUXC8th3ekpnIWXRMFMWDTNl0TBTFpOZKSsPKasXopuGGd00zOimYUY3k5nR3Q_RfROim4YZ3TTM6KZhRjeTmdE9CNF9G6KbhhndNMzopmFGN5OZu_n_-eMgfVebD38CAAD__5Sp_Go=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a) OVER (PARTITION BY b ORDER BY c) FROM data ORDER BY d]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy8lV9v2jAUxd_3KaL71KqOgv-EQp6yanvgYVBRpqmaeEixVZBojByjrar47hOhiCYF30wOPEJyfE7O7-r6DXIt1TB7UQUkv4ECAQYEOBAQQCCGKYGV0TNVFNpsX9kJBvIvJB0Ci3y1ttu_pwRm2ihI3sAu7FJBApPsaanGKpPKRB0gIJXNFsvSZmUWL5l5TWVmMyAQRjTIchnQQNu5MkBgtLZJkFKSCpIyknKYbgjotX13O5g8vQbzrJhXjy_fnxIobPasIKEbciL14Zx1ro1URsnKSeUp9e_6tcil_qNMFFdd77-OJ4PJYDQM7h6TIN1W-PDzx1VKr4Or0fjb93Fw9xik4ua69jGHoOxk0CMxHrSxykS0Vm3Kbj72x06a8QatHOukdDhazFCHehXRuFbhcXtRsafNR4k6RymiYcQuN0y0tWHqnneYkIL3w0RbGSbWnCZz02RhxC9Hk7VG8_a8NJGC9zRZKzR5c5rcTZOHkbgcTd4azd55aSIF72nyVmiK5jSFm6YIo_hyNEVrNPvnpYkUvKcpWr-2j5iNVbHSeaEa3cidbWtKPqtdxYVem5m6N3pW2ux-jkpdeZ1IVdjd0_cfg3z3aBuwuTj2Efd8xNQrNxVuNa2rOx_VrCLu1MXMKeZuZ-4U067bWvigdosR1G4xghqJ7ZUbQx07C0f67vqgvvWB5RYjsNxiBBYS2ys3Bqvn7LvvhtX3gUW9tiiiRnAhaoQXltwvOrpJ3auUIruUei1T-mmb_hc0txqD5lZj0JDkftFRaJ9WahVajEBz79Q6tOnmy78AAAD__1MrEtg=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a) OVER (PARTITION BY b ORDER BY c), avg(a) OVER (PARTITION BY b) FROM data ORDER BY d]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy8lU9vm0AQxe_9FGhOsbII7x8cmxOJWlU-1I4ct1VUcSBmFVtyWGvBaqPI370Cx3IgZIdqKVIuBL99j_cbzb5AqhI5i59kBsEvoECAAQEOBAQQ8CEisNNqJbNM6eInR8E0-QPBkMAm3e3z4t8RgZXSEoIXyDf5VkIAy_hhKxcyTqT2hkAgkXm82ZY2O715ivVzmMR5DARcjzpxmjjUUflaaiAw3-eBE1JS_AkSMhJyiA4E1D5_NTz7PDw76zhbVx1CAdEhIpDl8aOEgB7IB8HP5-xTpROpZVI5qTyl_mk_N2mifkvt-VXX2-vFcrqczmfOzX3ghEWDd9-_XYR04FzMF5-_LJybeyf0LwdA4PrH14uQDWqfdY7MPozcEOhO6Vxqj9Z6Dvnl2zIbajz78RYVNRVUmjS2NFOu2nnUr_XZbC8q9rT9aFHjaHnU9Vivw0U7G65RX8OFtH0aLtrVcLH2dJmZLnM93itd1hndq77oIm2f6LKu6PL2dLmZLnc90Std3hndcV90kbZPdHlXdEV7usJMV7ie3ytd0RndSV90kbZPdMX_uPYb_BYy26k0k61u9GFRoUwe5bHvTO31St5qtSptjo_zUlfeQInM8uPb14dpenxVBGwv9m3EYxsxtcpNhVlN6-rhWzWriId1MTOKudmZG8V0ZLYWNqjNYgS1WYygRmJb5cZQ-8bCkb5HNqivbGCZxQgssxiBhcS2yo3BGhv7nphhTWxgUastiqgRXIga4YUlt4uOblLzKqXILqVWy5S-26b_BM2sxqCZ1Rg0JLlddBTau5VaheYj0Mw7tQ4tOnz6GwAA__-zzCNu

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a) OVER w1 AS sum_a, avg(b) OVER w2 FROM data WINDOW w1 AS (PARTITION BY b ORDER BY c), w2 AS (PARTITION BY a, d) ORDER BY sum_a ]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzMlt9L40oUx9_vXxHOk-KUZCbpz6co93Lpw1qp7i6y9CE2gxY0U5KUXZH-70tSi5umnm9KZkvBB2v95DvnzOdw8kaJifV19KIzGv0gSYIUCfJJUECCujQTtEzNXGeZSYt_2QDj-BeNPEGLZLnKiz_PBM1Nqmn0Rvkif9Y0orvo4VlPdRTr1PVIUKzzaPFcxizTxUuUvoZxlEckqONKJ0piRzomf9IpCZqs8pETShGq8scXxe8BzdaCzCp_z_yIenh1nqLsqRoS-jRbzwRlefSoaSTX4pOzfzxnlZg01qmOK08qn7Jb3fdFEpufOnW71dSby-nd-G48uXau7kdOWDTy9uuXs1CeO2eT6b__TZ2reycMLs4PLKYrwl6lHvWX6pEeW1B5DkGX3_4_C9VuER-n8z893Z7sW5PmRfJOK0N5UVHh07CgQSv2NaJM2NuNa9MxS1d5O33bH9-txMvmUyHZqXBlx1XHngtpzaPeScyFvXqktD8XwJXtXPSszIVqLqbixVQd1z-2mMraRfZPQkx79UhlX0zgylbMvhUx_eZi-ryYfscNji2mb-0iBychpr16pG9fTODKVsyBFTGD5mIGvJhBx-0eW8zA2kUOT0JMe_XIwL6YwJWtmEPrr7h7wqY6W5ok043eXr2iVTp-1Ju-ZmaVzvVNauZlzObjpOTK95VYZ_nm2_cP42TzVXHA5nCvDSy9VnTQih7wtGRp1Qbut4EluC5Ad1vRQ55Wu7T3J-1XYG8X9lkY3HXAwkry0d0288HDYD5AMpgPQIOeARrMR6_NfPAwmA8eRvMBaDAfgAbz0WctHfCSDtrMx7CN4TwMDAfJwHBAt6sabQB-gaAVwNNoB4DlhZYAwNEWADjQXNa2SEVVqXjRJb9GwJ3L2h45RHVAA9dRNpAd4S0rR7rXduhBuvM00p2noe4AR7oDHOleW6RV3XtA99pOOUj32k45SHeeRrqDbKQ7wFtWjnSv7dODdOdppDtPQ90BjnQHONK9tlWr79oer7uq7RZW99n6n98BAAD__-9ZWww=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a) OVER w1 AS sum_a, avg(b) OVER w2, rank() OVER w1 AS rnk, row_number() OVER w3 AS rnumber, max(a) OVER w3, min(b) OVER w2 FROM data WINDOW w1 AS (PARTITION BY b ORDER BY c), w2 AS (PARTITION BY a, d), w3 AS (PARTITION BY a, c ORDER BY b, d) ORDER BY rnk, rnumber ]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzMmF9v4kYUxd_7Kaz7xCqDzIxt_j0NUVcVqoCVN9vtqkKVF482SAlGtlEbRXz3ChOampA50GvAL6sF58eZ4_E5c-GZFklsxtGjyaj_B0kSpEiQR4J8EhTQVNAyTWYmy5J08ydbYBj_Tf2WoPliuco3b08FzZLUUP-Z8nn-YKhPd9H3BxOaKDap2yJBscmj-UMhs0znj1H6pOMoj0hQ05VOtIgd6ST5vUlJ0GSV9x0thVbi5V8ltFf836fpWlCyyl-UXwW_Pzn3UXZfltIBTddTQVke_TDUl2vxjoPXz1ktkjQ2qYlLn1R8yr7Hr_NFnPxlUjcoq34ahHfDu-Fk7Nx-6zt6c_Xzl1FDyw9OYxL-_DF0br85un3zgQSFg_GvjTfvn2ayK3Sv5FOdyadsWY0W6xA0-O2XhlYbc6PhuKGD_2GnU7LjncuOfd-KdQgKJ1__HH8Z3X4M9_dJ6F6xh6PB7w3tH7xYdv5qyX_X0oEFf07S3KSu2rv72rsR2r_ZC4wntC90IHT7XfHgiPt56G7-q3jwto6TZrJ0VbC3AYeX0C4tQR7fJdLaJa5suuo6bSIreyzbtW6T6nxKWYM2qdCOfd8u1yYgTbs2kWdpE3V8lJU9yqrpeteJsqrsmejUOsrV-ZSqBlGu0I593y4XZZCmXZTVWaLsHR9lzx5lr-n614myV9kz0a11lKvzKb0aRLlCO_Z9u1yUQZp2UfbOEmX_-Cj79ij7TTe4TpT9yp6JXq2jXJ1P6dcgyhXase_b5aIM0rSLsn_2r-sHxEOTLZNFZo76Ft7a3G8T_zDbzcmSVTozn9JkVshsX04KrvhWEZss3159eTFcbC9tFng83OHAUrFolrYC2tJOc-AuB5Yei2ZpK6CtrDQL7nFg6bNolrYC2t4-3fovXYZb-7BvhQO7cmCFVdsu3eZ0ih0GuQbKIJqAZmmjTulwOsUOg1zbYdQpgGZpo07pcjrFDoNc22HUKYBmaaNO6VmTLVv2ZMs3B-cprSLBAcSiQTqRNjq1Ac5ThwMHOEdYNDr2wQmIZg6A89RRQ8g3R-gpFQFokFNAo5JAOE8d1YS0jw8yAD1hHyBQT7AGCECjpPJGCITz1GFPsKYIQKOk8uYIhPPUYU-wRglAo6TyhgmE89RhT9jnCQXmCcWaJxRrngA0SCrSBllDOE8d9YRizROABkkFNOoJhPPU4a8YrHkC0Oi3BN48gXCeOuoJZZ8nFJgn1GnzxHT90z8BAAD__76XF-8=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT min(d) OVER w1, sum(a) OVER w2, avg(b) OVER w3 FROM data WINDOW w1 AS (PARTITION BY b ORDER BY c), w2 AS (ORDER BY c), w3 AS (PARTITION BY a, d) ORDER BY a, b ]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzElV1v2jwYhs_fXxE9R1QYJf4IHzlyq3eaOChUlG2qphykxCpINEaO0VZV_PeJpBsjLX6CAuMEEcLl-_GVW84rZDpVo-RZ5RB9BwoEGBDgQEAAgRBiAiujZyrPtdn-pQSG6U-IAgKLbLW2259jAjNtFESvYBd2qSCCafK4VBOVpMr4ARBIlU0WyyJmZRbPiXmRaWITINDxqZdkqUc9befKAIHx2kaeFERSItnvT0YkL74LiDcE9Nq-he8yH1-8eZLP99NkF-JNTCC3yZOCiG7IgU3s1lln2qTKqHRvpWKV6ja_LbJU_1DGD_dT764n0-F0OB55Nw-RJ7tA4HY4akl65bXGk_8_TbybB0_22leVzewGZWcalFaexv2X25ZktcfiB8dyhlKnnj6RAyBw_fVzS_LD2eKY7Htt7DaZVeog2kSG7T8tK8vFD2aGe5m0fumps_Q-7fjsYrWnJ2tT97y1Z_V9M7dv1vH5xXyzk_nundc3r--bu33zji8u5pufzHf_vL5Ffd_C7Vt0_PBivsXJfA_-3Wv0gzEmKl_pLFeVgT9eOdhuRKVPqtx1rtdmpu6MnhUx5eW44IoDN1W5Le--XQyz8tZ2wPpwtwncbwLToBHN3DSt0sHfNAIzJ8z34KAKcycs3LBwwhSJDpv0xA0jPXHDSE-QsZGeIDTyqLtNetJr4tsNI77dMOIbGRvxjdCIsn4T34Mmvt0w4tsNI76RsRHfCI2dg--O0WOE03fH6DHGERpRjtCIc2xyRDqGY97cb5AqHW_--xUAAP__cfeJ-g==
