# LogicTest: 5node-dist

statement ok
CREATE TABLE data (a INT PRIMARY KEY)

# Prevent the merge queue from immediately discarding our splits.
statement ok
SET CLUSTER SETTING kv.range_merge.queue_enabled = false;

# Split into ten parts.
statement ok
ALTER TABLE data SPLIT AT SELECT i FROM generate_series(1, 9) AS g(i)

# Relocate the ten parts to the five nodes.
statement ok
ALTER TABLE data TESTING_RELOCATE
  SELECT ARRAY[i%5+1], i FROM generate_series(0, 9) AS g(i)

statement ok
INSERT INTO data SELECT generate_series(0, 9)

# Correlated SRF
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT a, generate_series(a, a + 1) FROM data ORDER BY 1, 2]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJykk8GOmzAQhu99CmtOrWJkbGBb-cQ1l-0qya1ClYtHCRXBaOxIrSLevQocUtqA2HD0jL_5P2k0V2icxVdzRg_6G0jgoIBDAhxS4JBBwaElV6L3jm5fBmBrf4GOOVRNewm3csGhdISgrxCqUCNoOJgfNe7QWCQRAweLwVR1H9NSdTb0O7cmGOAQCclMY5lkLpyQoOg4uEu4j_bBHBG07PhE_D3VkUVCO87L5QaK7oHjG7mfWIY9BpGNkSM2SCbgd49Uof-YS85yyTZMaq23r4cvnyY11aTmA4O9o4AkXv4T5rnaAIezCeWJ1dhoJicTk1GiXL4XObsXISOhntiMWi6g5gVUJJInBJLlAsm8QBKJ9AmBdLlAOi-QRiJbeRwPBHboW9d4HGVPTY5vl4P2iMOleXehEt_IlX3M8Pzac33Bog9DVw6PbdO3esG_YTkLqxEc_wurWfjzPJys0U7XwNka-OVdcNF9-BMAAP__i07oqg==

# Order by primary key
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT a, generate_series(a, a + 1) FROM data ORDER BY 1]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJykkk1r4zAQhu_7K8x72iUysvyxFJ18zSUNaW7FFNUaUpfEMpICLcH_vcQ-pC6JceOjZvTM-zDMCbXRtFIHcpDPEGCIwZCAIQVDhoKhsaYk54w9f-mBpf6AjBiqujn6c7lgKI0lyBN85fcEia163dOGlCbLIzBo8qradzGNrQ7KfuZaeQWGkItA1ToQgfFvZFG0DOboL6OdVzuCFC27EX9JNVaTJT3My8UCRXvFcW3NO5X-iTzPhsiOarLK04sjW5H7mwsW5CJYBEJKuVxtH_7d1IwHmmL6lsTolrgIeXzHnuLpAvG4QBzy5A6BZLpAMi6QhDy9QyCdLpCOC6Qhz2ae6hWBDbnG1I4G2bcmR-c7Jr2j_u6dOdqS1taUXUz_fOy4rqDJ-b4r-sey7lqd4HdYjML_B3D0E47nJCdz4HQOnP0KLto_XwEAAP__rYqwcg==

# Order by SRF
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT a, generate_series(a, a + 1) FROM data ORDER BY 2]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJykk00Lm0AQhu_9FTKnlqysu2pa9uQ1lzQkuRUpW3dILYkrsyu0BP97iR5Sg4qNx_145n1geO9QWYN7fUMH6hsIYCCBQQwMEmCQQs6gJlugc5YeX3pgZ36DihiUVd34x3XOoLCEoO7gS39FUHDWP654RG2QeAQMDHpdXruYmsqbpj-Z0V4Dg5CLQFcmEIH1P5EgbxnYxj9HO68vCEq0bCL-mdpUlgwSmkFi3o4IHsj-wsKf0PN06HfBCkl7_O6QSnQfM8GCTASbQCildvvzl0-TjnLSccTgZMkj8e0wPZObyfHxYLxYvgExuwEuQi7f2IFcLiDnBWTI4zcE4uUC8bxAHPLkDYFkuUAyL5CEPF1ZgxGBI7raVg5f6jA-OXrUBM0F-04521CBB7JFF9Mfv3Zcd2HQ-f5V9Idd1T11gv_CYhaWAzh6heUs_HkejtdoJ2vgdA28_S84bz_8DQAA__89GuN-

# Filter on ProjectSet node
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT a, b FROM (SELECT a, generate_series(1, 3) AS b FROM data) WHERE a < 4 AND b = 3]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJykk8GK2zAQhu99CjGnFGRkSXYpgkIKpZBLGtLcWlNUa0hdHMtIMuwS_O5L7F0Sh8R445ul8af_0zA6QmUNrvUBPahfwIGCAAoSKCRAIYWMQu1sjt5bd_qlB1bmCVRMoajqJpy2Mwq5dQjqCKEIJYKCnf5b4ha1QcdioGAw6KLsYmpXHLR7XhodNFCIGCe6MoQTG_6hg6ylYJtwPtoHvUdQvKV34s-pTWWdQYdmkJi1NwQ3zv7HPPzEwNKh3x4rdDrgH4-uQL_gSqnVeveZEvn69REofC_KgE6RxZKT300cy5wkb2Xydf2NLJaCfLlA7t1LDO7Fp7eVj7aV8YiJBxorpguIcQERMfmAgJwuIMcFZMSSBwSS6QLJuEASsXTmbN8Q2KKvbeXxasZvnxyfZh_NHvuH4m3jctw4m3cx_fJHx3UbBn3oq7xfrKqu1AlewnwU_jSA42tYzEmWc-BkDpy-C87aDy8BAAD__xE8vYE=

# Multiple SRFs with different lengths
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT a, generate_series(1, 2), generate_series(1, 4) FROM data WHERE a < 2 ORDER BY 1, 2, 3]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJyckjFPwzAQhXd-RXUsoLpK7HRAnrJ2KVXbDUXIxE8lKI2jsyuBqvx31ARRAk0EbPH5vnvv8nykylkszR6e9ANJEqQoE1Szy-G941O5a1rYV9KxoKKqD-FUzgTljkH6SKEIJUjT1jyVWMNYcBSTIItgirIdXXOxN_yWWhMMCZpFkrJGkDuE8zgfzA6kZSMGJM9Kji0Ytq-RyillzQVfK3YvyMMGIVJ9ZIcKbAIePbiAv5Fa68Vyeycm6uPrlsRI1_yza2gbNbjNBaMbxwEcJT_2EqmaijSZkqC9CfnzpESlJ8P_MOmpyt_HJkdji-QsktH1P6K7ILuGr13l0VMcmhyfcoXdoXsH3h04x4pd3sp0x_uWawsWPnS3sjssqvaqNfgVlqOw6sHxd1iNwvNxOPmT7ay5eg8AAP__F-oxJQ==
