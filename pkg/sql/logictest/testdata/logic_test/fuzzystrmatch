statement ok
CREATE TABLE fuzzystrmatch_table(
  id int primary key,
  a text,
  b text
)

statement ok
INSERT INTO fuzzystrmatch_table VALUES
  (1, 'apple', 'banana'),
  (2, '', 'pear'),
  (3, '', ''),
  (4, null, 'a'),
  (5, 'a', null),
  (6, null, null),
  (7, 'apple', 'apple'),
  (8, 'a', 'abcd'),
  (9, '', ''),
  (10, '', 'abc'),
  (11, 'xyz', ''),
  (12, 'extensive', 'exhaustive'),
  (13, '', 'a')

statement error levenshtein argument exceeds maximum length of 255 characters
SELECT levenshtein(lpad('', 256, 'x'), '')

statement error levenshtein argument exceeds maximum length of 255 characters
SELECT levenshtein(lpad('', 256, 'x'), '', 2, 3, 4)

query TTII
SELECT a, b, levenshtein(a, b), levenshtein(a, b, 2, 3, 4) FROM fuzzystrmatch_table ORDER BY id
----
apple  banana  5     18
路      pear    4     8
             1     4
NULL   a       NULL  NULL
a      NULL    NULL  NULL
NULL   NULL    NULL  NULL
apple  apple   0     0
a      abcd    3     6
路      路       0     0
路      abc     3     6
xyz    路       3     9
extensive  exhaustive  4     14
      a       1     4

statement error levenshtein_less_equal argument exceeds maximum length of 255 characters
SELECT levenshtein_less_equal(lpad('', 256, 'x'), '', 4)

statement error levenshtein_less_equal argument exceeds maximum length of 255 characters
SELECT levenshtein_less_equal(lpad('', 256, 'x'), '', 4, 2, 3, 4)

statement error levenshtein_less_equal argument exceeds maximum length of 255 characters
SELECT levenshtein_less_equal(repeat('', 256), '', 4)

statement error levenshtein_less_equal argument exceeds maximum length of 255 characters
SELECT levenshtein_less_equal('', repeat('', 256), 4)

query TTII
SELECT a, b, levenshtein_less_equal(a, b, 3), levenshtein_less_equal(a, b, 2, 3, 4, 12) FROM fuzzystrmatch_table ORDER BY id
----
apple  banana  4     13
路      pear    4     8
             1     4
NULL   a       NULL  NULL
a      NULL    NULL  NULL
NULL   NULL    NULL  NULL
apple  apple   0     0
a      abcd    3     6
路      路       0     0
路      abc     3     6
xyz    路       3     9
extensive  exhaustive  4     13
      a       1     4

# Test cases from PostgreSQL
query I
SELECT levenshtein_less_equal('extensive', 'exhaustive', 2)
----
3

query I
SELECT levenshtein_less_equal('extensive', 'exhaustive', 4)
----
4

# Test negative max distance (should behave like regular levenshtein)
query I
SELECT levenshtein_less_equal('extensive', 'exhaustive', -1)
----
4

query T
SELECT soundex('hello world!')
----
H464

query TTI
SELECT soundex('Anne'), soundex('Ann'), difference('Anne', 'Ann');
----
A500 A500 4

query TTI
SELECT soundex('Anne'), soundex('Andrew'), difference('Anne', 'Andrew');
----
A500 A536 2

query TTI
SELECT soundex('Anne'), soundex('Margaret'), difference('Anne', 'Margaret');
----
A500 M626 0

query TTTI
SELECT soundex('Anne'), soundex(NULL), difference('Anne', NULL), difference(NULL, 'Bob');
----
A500  NULL  NULL  NULL

query TT
SELECT metaphone('GUMBO', 4), metaphone(NULL, 4);
----
KM  NULL

query TTT
SELECT metaphone('Night', 4), metaphone('Knight', 4), metaphone('Knives', 4);
----
NFT NFT NFS

# Double Metaphone

query T
SELECT dmetaphone('gumbo');
----
KMP

query TT
SELECT dmetaphone('Richard'), dmetaphone_alt('Richard');
----
RXRT  RKRT

query TT
SELECT dmetaphone('Smith'), dmetaphone_alt('Smith');
----
SM0  XMT

query TT
SELECT dmetaphone('Schmidt'), dmetaphone_alt('Schmidt');
----
XMT  SMT

query T
SELECT dmetaphone('');
----
路

query TT
SELECT dmetaphone(NULL), dmetaphone_alt(NULL);
----
NULL  NULL

query TT
SELECT dmetaphone('Jose'), dmetaphone_alt('Jose');
----
HS  HS

query TT
SELECT dmetaphone('danger'), dmetaphone_alt('danger');
----
TNJR  TNKR

query TT
SELECT dmetaphone('filipowicz'), dmetaphone_alt('filipowicz');
----
FLPT  FLPF

query TT
SELECT dmetaphone('knight'), dmetaphone_alt('knight');
----
NT  NT

# Daitch-Mokotoff Soundex

query T
SELECT daitch_mokotoff('George');
----
{595000}

query T
SELECT daitch_mokotoff('John');
----
{160000,460000}

query T
SELECT daitch_mokotoff('Augsburg');
----
{054795}

query T
SELECT daitch_mokotoff('Breuer');
----
{791900}

query T
SELECT daitch_mokotoff('Halberstadt');
----
{587433,587943}

query T
SELECT daitch_mokotoff('Chernowitz');
----
{496740,596740}

query T
SELECT daitch_mokotoff('');
----
NULL

query T
SELECT daitch_mokotoff(NULL);
----
NULL

# Non-ASCII / UTF-8 inputs

query T
SELECT daitch_mokotoff('M眉ller');
----
{689000}

query T
SELECT daitch_mokotoff('Sch盲fer');
----
{479000}

query T
SELECT daitch_mokotoff('Straburg');
----
{294795}

query T
SELECT daitch_mokotoff('regon');
----
{095600}

query T
SELECT daitch_mokotoff('gszczu');
----
{540000,564000}

query T
SELECT daitch_mokotoff('brzczy');
----
{744000,746400,794400,794640}

query T
SELECT daitch_mokotoff('牛amas');
----
{364000,464000}

query T
SELECT daitch_mokotoff('amas');
----
{364000,464000}

query T
SELECT daitch_mokotoff('ZBEK');
----
{467500,475000}
