statement ok
SET experimental_enable_enums = true

statement ok
CREATE TYPE typ AS enum()

# Ensure user must exist for set owner.
statement error pq: role/user fake_user does not exist
ALTER TYPE typ OWNER TO fake_user

# Ensure user the current user is a member of the role we're setting to.
statement error pq: must be member of role testuser
ALTER TYPE typ OWNER TO testuser

# Ensure the new owner has to be an owner alter the owner.
user testuser

statement error pq: must be owner of type typ
ALTER TYPE typ OWNER TO testuser

user root

statement ok
GRANT testuser TO root

# Test set owner for a type in the public schema.
statement ok
ALTER TYPE typ OWNER TO testuser

user testuser

statement ok
SET experimental_enable_user_defined_schemas = true

statement ok
CREATE SCHEMA s

user root

# testuser2 does not have owner/create privilege on schema s.
statement ok
CREATE USER testuser2

statement ok
CREATE TYPE s.typ AS enum()

statement ok
GRANT testuser2 TO root

# Ensure the new owner has create privilege on the schema.
statement error pq: user testuser2 does not have CREATE privilege on schema s
ALTER TYPE s.typ OWNER TO testuser2

statement ok
GRANT testuser TO root

# testuser satisfies all the conditions to become the new owner.
statement ok
ALTER TYPE s.typ OWNER TO testuser

statement ok
GRANT testuser TO testuser2

user testuser2

# Even though testuser2 is a member of testuser, testuser2 cannot alter the
# owner without being the explicit owner.
statement error pq: must be owner of type typ
ALTER TYPE s.typ OWNER TO testuser2

user testuser

# Ensure testuser is owner by dropping the type.
statement ok
DROP TYPE s.typ
