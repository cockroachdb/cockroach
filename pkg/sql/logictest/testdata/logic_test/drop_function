# Regression test for #114677 - it should be possible to drop a function with
# a UDT parameter
subtest udt_parameter

statement ok
CREATE TYPE t114677 AS (x INT, y INT);
CREATE TYPE t114677_2 AS (a INT, b INT);

# Create an overload with a composite type that has the same signature to verify
# that the correct overload is dropped.
statement ok
CREATE FUNCTION f114677(v t114677) RETURNS INT LANGUAGE SQL AS $$ SELECT 0; $$;
CREATE FUNCTION f114677(v t114677_2) RETURNS INT LANGUAGE SQL AS $$ SELECT 1; $$;

query T nosort
SELECT create_statement FROM [SHOW CREATE FUNCTION f114677] ORDER BY create_statement;
----
CREATE FUNCTION public.f114677(IN v T114677)
  RETURNS INT8
  VOLATILE
  NOT LEAKPROOF
  CALLED ON NULL INPUT
  LANGUAGE SQL
  AS $$
  SELECT 0;
$$
CREATE FUNCTION public.f114677(IN v T114677_2)
  RETURNS INT8
  VOLATILE
  NOT LEAKPROOF
  CALLED ON NULL INPUT
  LANGUAGE SQL
  AS $$
  SELECT 1;
$$

statement error pgcode XXUUU pq: function name \"f114677\" is not unique
DROP FUNCTION f114677;

statement ok
DROP FUNCTION f114677(t114677);

query T
SELECT create_statement FROM [SHOW CREATE FUNCTION f114677];
----
CREATE FUNCTION public.f114677(IN v T114677_2)
  RETURNS INT8
  VOLATILE
  NOT LEAKPROOF
  CALLED ON NULL INPUT
  LANGUAGE SQL
  AS $$
  SELECT 1;
$$

statement ok
DROP FUNCTION f114677;

statement error pgcode 42883 unknown function: f114677\(\)
SHOW CREATE FUNCTION f114677;
