# LogicTest: local local-opt local-parallel-stmts fakedist fakedist-opt fakedist-metadata

subtest defaults

query T
SHOW default_int_size
----
8

query TTTTT
EXPLAIN (VERBOSE) SELECT 1::INT
----
render         ·         ·  (int8)  int8=CONST
 │             render 0  1  ·       ·
 └── emptyrow  ·         ·  ()      ·


subtest set_int4

statement ok
SET default_int_size='4'

query T
SHOW default_int_size
----
4

query TTTTT
EXPLAIN (VERBOSE) SELECT 1::INT
----
render         ·         ·  (int4)  int4=CONST
 │             render 0  1  ·       ·
 └── emptyrow  ·         ·  ()      ·

statement ok
CREATE TABLE i4 (i4 INT)

query TT
SHOW CREATE TABLE i4
----
i4  CREATE TABLE i4 (
    i4 INT4 NULL,
    FAMILY "primary" (i4, rowid)
)

subtest set_int8

statement ok
SET default_int_size='8'

query T
SHOW default_int_size
----
8

query TTTTT
EXPLAIN (VERBOSE) SELECT 1::INT
----
render         ·         ·  (int8)  int8=CONST
 │             render 0  1  ·       ·
 └── emptyrow  ·         ·  ()      ·

statement ok
CREATE TABLE i8 (i8 INT)

query TT
SHOW CREATE TABLE i8
----
i8  CREATE TABLE i8 (
    i8 INT8 NULL,
    FAMILY "primary" (i8, rowid)
)

# https://github.com/cockroachdb/cockroach/issues/32846
subtest issue_32846

statement ok
SET default_int_size='8'

# Parsing and evaluation are async, so the setting won't take
# effect until the next statement is evaluated.
query TTTTT
SET default_int_size='4'; EXPLAIN (VERBOSE) SELECT 1::INT
----
render         ·         ·  (int8)  int8=CONST
 │             render 0  1  ·       ·
 └── emptyrow  ·         ·  ()      ·

query T
SHOW default_int_size
----
4

query TTTTT
EXPLAIN (VERBOSE) SELECT 1::INT
----
render         ·         ·  (int4)  int4=CONST
 │             render 0  1  ·       ·
 └── emptyrow  ·         ·  ()      ·

subtest set_bad_value

statement error pq: only 4 or 8 are supported by default_int_size
SET default_int_size='2'
