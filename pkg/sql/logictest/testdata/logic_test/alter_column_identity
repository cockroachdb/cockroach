# Ensure ALTER COLUMN <col> SET GENERATED ALWAYS works

statement ok
CREATE TABLE t_seq1 (id SERIAL PRIMARY KEY, b int GENERATED BY DEFAULT AS IDENTITY);

statement ok
INSERT INTO t_seq1 (b) VALUES(33);

statement ok
ALTER TABLE t_seq1 ALTER COLUMN b SET GENERATED ALWAYS;

statement error pq: cannot insert into column "b"
INSERT INTO t_seq1 (b) VALUES(44);

statement ok
INSERT INTO t_seq1 DEFAULT VALUES;

query I
SELECT b from t_seq1 ORDER BY b;
----
1
33

query T
select identity_generation from information_schema.columns where table_name = 't_seq1' and column_name='b';
----
ALWAYS

# Ensure ALTER COLUMN <col> SET GENERATED BY DEFAULT works

statement ok
CREATE TABLE t_seq2 (id SERIAL PRIMARY KEY, b int GENERATED ALWAYS AS IDENTITY);

statement error pq: cannot insert into column "b"
INSERT INTO t_seq2 (b) VALUES(44);

statement ok
ALTER TABLE t_seq2 ALTER COLUMN b SET GENERATED BY DEFAULT;

statement ok
INSERT INTO t_seq2 (b) VALUES(44);

statement ok
INSERT INTO t_seq2 DEFAULT VALUES;

query I
SELECT b from t_seq2 ORDER BY b;
----
1
44

query T
select identity_generation from information_schema.columns where table_name = 't_seq2' and column_name='b';
----
BY DEFAULT

# Ensure ALTER COLUMN <col> SET GENERATED (ALWAYS/BY DEFAULT)
# errors if not an identity

statement ok
CREATE TABLE t_seq3 (id SERIAL PRIMARY KEY, b int);

statement error pq: column "b" of relation "t_seq3" is not an identity column
ALTER TABLE t_seq3 ALTER COLUMN b SET GENERATED ALWAYS;

statement error pq: column "b" of relation "t_seq3" is not an identity column
ALTER TABLE t_seq3 ALTER COLUMN b SET GENERATED BY DEFAULT;
