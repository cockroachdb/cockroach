# LogicTest: 5node

statement ok
CREATE TABLE t (k INT PRIMARY KEY, v INT, w INT, INDEX v(v))

# Split the index into 5 parts. We expect numbers in the range 1 to 1000.
statement ok
ALTER INDEX t@v SPLIT AT SELECT (i * 100)::int FROM GENERATE_SERIES(1, 4) AS g(i)

# Relocate the five parts to the five nodes.
statement ok
ALTER INDEX t@v TESTING_RELOCATE
  SELECT ARRAY[i+1], (i * 100)::int FROM GENERATE_SERIES(0, 4) AS g(i)

query TTITI colnames
SHOW TESTING_RANGES FROM INDEX t@v
----
Start Key  End Key  Range ID  Replicas  Lease Holder
NULL       /100     1         {1}       1
/100       /200     2         {2}       2
/200       /300     3         {3}       3
/300       /400     4         {4}       4
/400       NULL     5         {5}       5

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT * FROM t WHERE v > 100]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJy8lE9r8kAQxu_vp5DnPC_kn9buKVd70CK9lRzS7CApuht2N8VS_O4lbqFRdFMRctyd-c1vnst8QWnJy3LHFuIVMQgJCCkIGQhTFITG6Iqt1aZr8cBC7iEiQq2a1vlvV7stQ6BV2kg2LEGQ7Mp629WLQ0GotGGI39al_q-bszaCbt3P0IJgXblhiPRAPXHcE18Y-1K-bXnNpWRzMhwfuQNh1ToxyWNcc8W3uJ50rS6pFkryfvKuayUmjal3pfnsyylPKE-vrpCcrJCMGHfANUbcdMS4A64x4mYjxh1wjRE3Cq-wZttoZflPVyHqjgrLDfsLZHVrKn42ujpq_HN15I4fkq3z1Uf_WChf6hbsw3EQTsJwEoSjEzg-h9MgnIXN2T3maRCehc2ze8wPQXgeNs9vMheHf98BAAD__wWfReA=

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT * FROM t WHERE v > 100 ORDER BY v]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJy8lE1r6kAUhvf3V8i7vedCvvTaWWVrF1qku5JFmjlIis6EmUmxlPz3YqZQIzpWhCzn4znP-27OJ5SWvCx3bCFeEIOQgJCCkIEwRUFojK7YWm0OXzywkHuIiFCrpnX-2tVuyxDQRrJhCYJkV9bbfm6e_EXRFYRKG4b4-b3U_3Qz-Ft0BN2677kFwbpywxBpR0fu-Mh9Zuxz-brlNZeSzTDIe-5AWLVOTPKY8gSXdPEtukddq3O2hZK8n7zpWolJY-pdaT5O_JSnFyMkgwjJuI2v6MZonI7b-IpujMbZuI2v6MZoHIUjrNk2Wln-1YaIDguG5Yb9QrK6NRU_GV31Gn9c9Vx_Idk6__rgDwvlnw4Bj-E4CCdhOAnC0QCOT-E0CGdhc3aPeRqEZ2Hz7B7z_yA8D5vnN5mL7s9XAAAA___MzUhW

# Here we care about ordering by v, but v is not otherwise used.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT w FROM t WHERE v > 100 ORDER BY v]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJy8lLFOwzAQhneeovpXjJQ4aSmespahRRUbyhDiUxXU2pHtoCKUd0eNkUhQcamqZrTvvvvuX-4TSktaFjuyEC-IwcDBkIAhBcMUOUNtdEnWanNo8cBC7iEihkrVjfPfrnJbgoA2kgxJMEhyRbXt5mb8FnmbM5TaEMRP91Lf6XrQm7cMunHfc3MG64oNQSQt67njnvvI2OfidUtrKiSZ4SLvmQPDqnFiksUs4_hLF5-je9SVOmZbKEn7yZuulJjUptoV5qPnT0J-PvDzceOe0F09bjJu3BO6q8dNx417Qnf1uFHYvyZba2XpX1chOhwVkhvyR8jqxpT0ZHTZafxz1XHdhyTrfPXBPxbKlw4L9uE4CPMwzINwNIDj33AShNOwOb3EPA3Cs7B5don5PgjPw-b5Wea8vfkKAAD__60QReI=

# The single join reader should be on node 5, and doesn't need to output v.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT w FROM t WHERE v > 400 ORDER BY v]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJyUkT1PwzAQhnd-RfTORooTsXjqGoYWVWwog4lPlVHqs2wHFVX57yjxQIpIgPE-nvexzlc4NrTXZ4pQL5AQeEAr4AN3FCOHqZ2XGnOBKgWs80Oa2q1Ax4Ggrkg29QSFPd-zh4ChpG0_L40CPKQvJCZ9Iqh6FItYuR37rF97OpI2FG7C8b5LEDgMSRU7iTWX_I_rka37SdU4Q5fija1ThQ_2rMPHQl6vyqsb-S_3O1L07CL96YTl2AqQOVH-o8hD6OgpcDdrcnmYublhKKY8rXPRuDyaHriE5SZcbcPVJlx-g9vx7jMAAP__PQzTow==
