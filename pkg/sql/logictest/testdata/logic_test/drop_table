# LogicTest: local

statement ok
CREATE TABLE a (id INT PRIMARY KEY)

statement ok
CREATE TABLE b (id INT PRIMARY KEY)

query T
SHOW TABLES FROM test
----
a
b

statement ok
INSERT INTO a VALUES (3),(7),(2)

query I rowsort
SELECT * FROM a
----
2
3
7

statement ok
DROP TABLE a

query TT
SELECT status, running_status FROM [SHOW JOBS] WHERE job_type = 'SCHEMA CHANGE'
----
running  waiting for GC TTL

query T
SHOW TABLES FROM test
----
b

statement error pgcode 42P01 relation "a" does not exist
SELECT * FROM a

statement error pq: \[53 AS a\]: table is being dropped
SELECT * FROM [53 AS a]

statement error pgcode 42P01 relation "a" does not exist
DROP TABLE a

statement ok
DROP TABLE IF EXISTS a

statement ok
CREATE TABLE a (id INT PRIMARY KEY)

query I
SELECT * FROM a
----

# Ensure that DROP TABLE cascade on interleaved parents actually deletes dependent objects.
statement ok
CREATE TABLE t (x INT PRIMARY KEY);
CREATE TABLE t2 (x INT, y INT, PRIMARY KEY (x, y)) INTERLEAVE IN PARENT t (x);
CREATE TABLE t3 (x INT, y INT, z INT, PRIMARY KEY (x, y, z)) INTERLEAVE IN PARENT t2 (x, y);
CREATE TABLE t4 (x INT, y INT, z INT, w INT, PRIMARY KEY (x, y, z, w)) INTERLEAVE IN PARENT t3 (x, y, z);
CREATE TABLE t5 (x INT, y INT, z INT, FAMILY (x, y, z));
CREATE INDEX i ON t5 (x, y, z) INTERLEAVE IN PARENT t2 (x, y)

statement ok
DROP TABLE t2 CASCADE

statement ok
SHOW CREATE t

# t2, t3, t4, t5@i should be deleted, while t and t5 should be still there.
statement error pq: relation "t2" does not exist
SHOW CREATE t2

statement error pq: relation "t3" does not exist
SHOW CREATE t3

statement error pq: relation "t4" does not exist
SHOW CREATE t4

query TT
SHOW CREATE t5
----
t5  CREATE TABLE t5 (
    x INT8 NULL,
    y INT8 NULL,
    z INT8 NULL,
    FAMILY fam_0_x_y_z_rowid (x, y, z, rowid)
)
