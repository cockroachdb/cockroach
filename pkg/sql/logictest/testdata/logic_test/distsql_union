# LogicTest: 5node-distsql 5node-distsql-disk

statement ok
CREATE TABLE xyz (
  x INT,
  y INT,
  z TEXT
)

statement ok
INSERT INTO xyz VALUES
  (1, 1, NULL),
  (2, 1, 'a'),
  (3, 1, 'b'),
  (4, 2, 'b'),
  (5, 2, 'c')

statement ok
ALTER TABLE xyz SPLIT AT VALUES (2), (3), (4), (5)

statement ok
ALTER TABLE xyz TESTING_RELOCATE VALUES
  (ARRAY[1], 1),
  (ARRAY[2], 2),
  (ARRAY[3], 3),
  (ARRAY[4], 4),
  (ARRAY[5], 5)

query TTITI colnames
SELECT * FROM [SHOW TESTING_RANGES FROM TABLE xyz]
----
Start Key  End Key  Range ID  Replicas  Lease Holder
NULL       /2       1         {1}       1
/2         /3       2         {2}       2
/3         /4       3         {3}       3
/4         /5       4         {4}       4
/5         NULL     5         {5}       5

# Simple UNION ALL and UNION. (The ORDER BY applies to the UNION, not the last select.)
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT x FROM xyz UNION ALL SELECT x FROM xyz ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzElU-PokAQxe_7KTZ13d7EavAfJ69edOPObcKBoSuGRGnS3SQ6xu8-AQ6ORquHEODIn997r7teUhfItaJNciQL0TsgCJAgIAABIQiYQiygMDola7WpfmmAtTpBNBGQ5UXpqtexgFQbgugCLnMHggjeko8D7ShRZECAIpdkh9qkMNkxMefV6fwJArali36vEOKrAF26m551yZ4gwqsY3FO28fyvjXu0W-Gfl-LBOOI3TW0UGVLPRJ8k2Oi_urj795V3eOeNI7RjGE_ZxrPbAHsVlyNMaBhP2caz10vsJh6MMKFhPGUbz14vsZt4OMKEhvGUbTx7vcReF-yObKFzSz_acJNqQZLaU7NQrS5NSv-MTmub5nFbc_ULRdY1X2XzsM6bT1XA7zCycMDDkoXDOxgf4aALHPJnRj73lKXnPDxj4QUPz7scetEFXrIwem4M-ZKhr2V8zTzRsVPPkC8aTj3R-arhzIPzXfNl58vmo_m24dITne-bnHhwvnGe7JIv3CMdX399BQAA__9E1reF

query I
SELECT x FROM xyz UNION ALL SELECT x FROM xyz ORDER BY x
----
1
1
2
2
3
3
4
4
5
5

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT x FROM xyz UNION SELECT x FROM xyz ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzElUGPmzAUhO_9FdW71od9Nux2OeXQy1661ba3igPFTyukBCPbSEkj_nsFHFKi5HkjBziCMzMZ5pN8hNpo-l7syEH2GxAESBCgQEACAlLIBTTWlOScsf1PRsGL3kP2IKCqm9b3r3MBpbEE2RF85bcEGfwq_mzpjQpNFgRo8kW1HUIaW-0Ke9jsD39BwGvrs88bhLwTYFp_8nO-eCfIsBMfz_xWOV_VpZ8GMu7yFvc7NVKzNkquup9M29pYTZb0xDXv7pGf3tLup7H-_GNu8MtV88eJOa4AYCAzEsBlGqlZG00BlCtsFMiM3GiZRmrWRtON1AobBTIjN1qmkZq10XSjZIWNApmRGy3TSM3a6Pple8H9jVxjakdnl-5l54f-Mib9TuPN7UxrS_phTTnEjI-vg254ocn58RTHh5d6POr_4P9iZMXJRIznYsmKFZ-sYpITVpzyySkrlpJXP7LqJ178FFP6Kyt-5pOfY5IxwFgIsijKkMcMA5xhFGjIk4YB1JBnLRTOs4YB2DCKNuRxwwBvGAWc5IGTAeDkbcDl3ad_AQAA__-LyfKF

query I
SELECT x FROM xyz UNION SELECT x FROM xyz ORDER BY x
----
1
2
3
4
5

# UNION with no overlap.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT x FROM xyz WHERE x < 3 UNION SELECT x FROM xyz WHERE x >= 3 ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzMlkFr3DAQhe_9Fctcq8OO7E0aQWEPpbCXpKS5tT641hAMjmUkGZIG__di-5B6yY7qygYfLe2bN2_fd9Ar1EbTbf5EDtQPQBAgQUACAlIQcIBMQGNNQc4Z2_9kFJz0M6i9gLJuWt8fZwIKYwnUK_jSVwQKHvJfFd1TrsmCAE0-L6vBpLHlU25fjs8vv0HA17LyZNXuiLuf7X6fFLtEKXW6fQABd63vLyDrBJjWv3k5nz8SKOzEv-_zpXS-rAs_XYaZLudM_8-09HlG3GTVuOnF6W9D29pYTZb0ZGrWLeF_mJPuu7H-_J8-4seLw68mw3Fj5Ab2iSR3nbQR5C4dd0qu3Fi5gX0iy10nbUS5S8edlptsrNzAPpHlrpM2otyl407LTTdWbmCfyHLXSRtR7tJxLz8o3pl-T64xtaOzh8X7k_f9g4P0I42vE2daW9A3a4rBZvy8G3TDgSbnx1scP071eNUv-LcYWXE6EeO5WLLihHdOYpxTVnzgnQ-sWEpefcWqr3nxdUzoT6z4hne-iXHGAGMhyKIoQx4zDHCGUaAhTxoGUEOetZA5zxoGYMMo2pDHDQO8YRRwkgdOBoCT84DLug9_AgAA___KeT5X

query I
SELECT x FROM xyz WHERE x < 3 UNION SELECT x FROM xyz WHERE x >= 3 ORDER BY x
----
1
2
3
4
5

# UNION with partial overlap.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT x FROM xyz WHERE x <= 4 UNION SELECT x FROM xyz WHERE x > 1 ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzMlkFr3DAQhe_9Fctcq8OO7E0aQWEPpbCXpKS5tT641hAMG8tIMiQN_u_F9iH1kh1lLRt8tLRv3rx930GvUBlNt_kTOVC_AEGABAEJCEhBwA4yAbU1BTlnbPeTQXDQz6C2Asqqbnx3nAkojCVQr-BLfyRQ8JD_OdI95ZosCNDk8_LYm9S2fMrty_755S8I-F4ePVm12ePmd7PdJsXXTaqUOtw-gIC7xnc3kLUCTOPfzJzPHwkUtuLjC30rnS-rwo-3YabLS6ZPjEsb_HDaZNG06dnpb0ObylhNlvRoatbO4b-7JN1PY_3pH73Hz2eHX42G49rIDSwUSe4ycaeTO3faMblybeUGFoosd5m408udO-243GRt5QYWiix3mbjTy5077bjcdG3lBhaKLHeZuNPLnTvt-QfFO9PvydWmcnTysHh_8rZ7cJB-pOF14kxjC_phTdHbDJ93va4_0OT8cIvDx6EarroF_xcjK05HYjwVS1ac8M5JjHPKine8844VS8mrr1j1NS--jgn9hRXf8M43Mc4YYCwEWRRlyGOGAc4wCjTkScMAasizFjLnWcMAbBhFG_K4YYA3jAJO8sDJAHDyMuCy9tO_AAAA__86-T5S

query I
SELECT x FROM xyz WHERE x <= 4 UNION SELECT x FROM xyz WHERE x > 1 ORDER BY x
----
1
2
3
4
5

# UNION ALL with swapped column orders.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT x, y FROM xyz UNION ALL SELECT y, x from xyz]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzElL1qwzAUhfc-RTnzLURy0h9PXrMkJXQrHlTrEgyJZSQZkga_e4k8pAlJqSsXj_r5_PlcxDmgMpoXassO6TsECBKEBIQpCDPkhNqagp0z9nilA-Z6h3RCKKu68cftnFAYy0gP8KXfMFK8qY8Nr1hptiBo9qrcBElty62y-2y3_wRh2fj0PhOUSeQtwTT-9Enn1ZqRipb-SSspEze18qb2ZGsqYzVb1meuvL3yYwvzYOqLa9fFyZlYjDPmIbU9xizHSTuktkfaZJy0Q2p7pJ2Ok3ZI7R8L44p2xa42leNfNcLkWCis19y1jzONLfjVmiJouuUycGFDs_PdqewW8yochbl8h0UMLH-EhTijJ5d0EqOexsCzGPgxBn6KgZ9j4JeoV9LvjeXt3VcAAAD__41Qv_4=

query II rowsort
SELECT x, y FROM xyz UNION ALL SELECT y, x from xyz
----
1 1
1 1
1 2
1 3
2 1
2 4
2 5
3 1
4 2
5 2

# UNION ALL and UNION with different ORDER BY types.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) UNION ALL (SELECT x FROM xyz ORDER BY z) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzMlkFvm0AQhe_9FdVcs5U8C9guJ19zSaq0t4oD9Y4iS44X7a6lpBH_vQIqpaRhZq0spUcDj2_evseun-FkDd3UD-Sh_A4ICjQoyEBBDgoKqBQ0zu7Je-u6RwbBtXmEcqXgcGrOobtcKdhbR1A-QziEI0EJ3-ofR7qj2pADBYZCfTj2kMYdHmr3tHt8-gkKbs-h_LhDtdNQtQrsOby80of6nqDEVsVjv1oXXhN3-iqOpCdJLwDrDDkyfxOq9o1xbuwn24yf_T3H5BDZJXYvXeVsEpv_s1Uu_odVXr_bLl5NvnyzzMul5cPo5Ztib0dsXGYHELAJd4DEBmM_vjkNjj8-vUyCAjZhgokNxiY4p8FxgtkyCQrYhAkmNhib4JwGxwnmyyQoYBMmmNhgbIJzGpz-C_MG6Y58Y0-eok7YVXdAk7mn4UD39uz29MXZfY8Zft72uv6CIR-Guzj8uD4Nt7oB_xQjK9YjMb4Wa1a85skZK855cc6KC37sghVvePKaFW958uY94i0fVcHP_ZlvyUqoCV8yoSfItwy1AOd7JqSNfNFQaBryVZOc811D4RtBvm2Sc75uuBXgQuEEOF84LRRO84UTnGthWxMKp_nCSbsiXzgtFE5ftrdV7YdfAQAA__-6tMF9

query I
(SELECT x FROM xyz ORDER BY y) UNION ALL (SELECT x FROM xyz ORDER BY z) ORDER BY x
----
1
1
2
2
3
3
4
4
5
5

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) UNION (SELECT x FROM xyz ORDER BY z) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzMlkFvm0AQhe_9FdVcs5W8sxjbnHzoJZekSnurOFAYRUgOi5ZFShr5v1c2lVwozGABdY8G3rzZt9-O9x0Km9FD8kIVRN9BgwIEBQYUBKBgDbGC0tmUqsq60yeN4D57hWilIC_K2p8exwpS6wiid_C5PxBE8C35caAnSjJyoCAjn-SHs0np8pfEve1f336CgsfaRx_3Wu0R4qMCW_tLyconzwSRPqrxtl-t813HPd6Nc8JrnD7nlc-L1He89GB1M1j9UtS6jBxlf_cfH3taeLCfbNn-9vcqB5sIrlnitXtoBm3X_2wPw0X3cPM_7OF2RBN10ddGbwdXh7CbvJn6bvi0r1rV9W2mjGA745QRnCZOmZnjG3vAl4wvXDS-9gHH29An2M5In-A0kb6Z4xtL35LxhYvG16bP3IY-wXZG-gSnifTNHN9Y-paML1w0vjZ9wW3oE2xnpE9wmkjfzPGNpW_J-MJF4xu-WvdUf6KqtEVFndttf-XV6dZL2TM1V-TK1i6lL86mZ5vm5-NZd36QUeWbt7r5cV80r04N_inWrBh5MbJi0xLrrtiw4i0vDljxmm97zYpDXhyy4g3f9mbKmreseMe3veO3KhAoERiTIOMp0wJmehJnmgdNS0vnUdMCa5qHTeBF87TpjWDO86a3gpwnTsqdRw5XwmzhkUMBOeSRE3JHnjg0gjmPHArIIY-ckDvyxKEw35BHDgXkkEdOyp0nDoUhh8KUE5AzPHLS_xlPnBGGnBGGnICc4ZHr5h4fP_wKAAD__3-YlTs=

query I
(SELECT x FROM xyz ORDER BY y) UNION (SELECT x FROM xyz ORDER BY z) ORDER BY x
----
1
2
3
4
5

# UNION ALL with conflicting numbers of ORDER BY columns.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) UNION ALL (SELECT x FROM xyz ORDER BY y, z) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzElkGPmzAQhe_9FdVc40oZA0nKietedqttbxUHGo9WkbIxsh1pt6v89ypQaZttmHHAEscAj89v3sPOGxysofvmmTyUPwFBgQYFGSjIQUEBtYLW2S15b935kV5wZ16gXCrYHdpjOF-uFWytIyjfIOzCnqCEH82vPT1SY8iBAkOh2e07SOt2z417rV5ef4OCh2MoP1eoKg31SYE9hvdX-tA8EZR4UvHY79aFj8RKL-JIepD0DrDOkCPzP6E-XVnOvf1i28tn_65jcBHZLXZvnrKqskFynmDQqsoW0cBiwrw7UKqZryY7x8Xgy9fzvFwaIUaPb4i9uWDjPPuBgE24H6Q2GP8pjvM44VPU82QpYBNmmdpgfJbjPE7IMpsnSwGbMMvUBuOzHOdxQpb5PFkK2IRZpjYYn-U4j4n-7lwBPpJv7cFT1Em8PB_kZJ6oP_i9PbotfXN222H6nw-drrtgyIf-LvY_7g79rfMC_xUjK9YXYvwo1qx4xZMzVpzz4pwVF_yyC1a85skrVrzhyesp4g0fVcGv-yvfkqVQE75kQk-QbxlqAc73TEgb-aKh0DTkqyY557uGwjeCfNsk53zdcCPAhcIJcL5wWiic5gsnONfCtiYUTvOFk3ZFvnBaKJy-bW-rT5_-BAAA___KYcxq

query I
(SELECT x FROM xyz ORDER BY y) UNION ALL (SELECT x FROM xyz ORDER BY y, z) ORDER BY x
----
1
1
2
2
3
3
4
4
5
5

# Only one distinct processor should be used in the single node UNION case.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) VALUES (1), (2) UNION VALUES (2), (3)]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzEjz9LxTAUxXc_RTmTQoa2OmUScXmLioOLZCjJ5RmsScm9AeGR7y4vGZ4VK4iDY87N7_w5IERHd9MbMfQzBhiFJUVLzDEdpfZh596hewUflixH2SjYmAj6APEyEzSepjkTQ8GRTH6uflfdTXc-dvYlh1e-gCkKMcvJg2XaE3Rf1D_nnOxziMlRIrdKMOWbJreexQcr6y7Xw2b-8Judj8RLDExfemwtMwrk9tTGcMzJ0kOKtsa0533lquCIpV3H9tiFeqoFP8PDX-DxR_hyBffFlLOPAAAA__9xete1

query I rowsort
VALUES (1), (2) UNION VALUES (2), (3)
----
1
2
3

# Basic INTERSECT ALL case -- should return every row.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz) INTERSECT ALL (SELECT y FROM xyz) ORDER BY y]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUlkFv2jAUx-_7FNU7bZonYQNtiTSJ47pDO3W7TTmkxININEaOkcoqvvsEqcYSJ--P5R3CrZT87Ofn3-OfVypNru-zZ11R8pMkCVIkaEyCJiRoSqmgjTULXVXGHh6pgbv8hZKRoKLcbN3h36mghbGakldyhVtrSuhH9rTWjzrLtSVBuXZZsT5usrHFc2Z385fdbxL0sHXJ1VxRuhdktu5tvdMyT7urVVatmkvMJaX7VFDlsqWmRO7FIOtSvXWd1tmWxuba6ryxUnog0SMdh_uSVauvpijbZ1vrX-79XH74bIvl6vjX3yPK1hFP5Y9D2vrdWNfedS4_9i4-OaM3Xcd-W7SjgnvzyWzaXezce9rYWw7GFznQulRvXRfoMWhrnMdqMHcmB1qX6q3rAl0CbY1zaTyYO5MDrUv11nWBLoG2xrk0GcydyYHWpXrrukCXQFv_37tax-KPutqYstJnvYmNDo3R-VLXja7M1i70N2sWx23qjw9H7hjcua5c_a2qP9yV9VeHAs-Hb2JgKaPoaRQ942kZ0DMVBt_EwK2ehdLTKHrG06pNj_6lxw141IbHLDzhb2vCwkryW09j5oOHwXzwMJoPQIP5ADSYj-uY-eBhMB88jOYD0GA-AA3m44a19JaX9DZmPmYxhvMwMJyHkeGABoYDGiVASGz6v6QhuRlKwxAISs5gHGguvRRpqCoVL7rkYwSYLr0cCVEd0MB1QCPZEQ5sRzjS3cvQIN15GunO01B3gCPdAY5094K0qfs10N3LlCDdvUwJ0p2nke48DXUHONId4Eh3L0-DdOdppDtPQ90BjnQHONLdS9Xmu_aI11152cLqnu7f_QkAAP__jUMURA==

query I
(SELECT y FROM xyz) INTERSECT ALL (SELECT y FROM xyz) ORDER BY y
----
1
1
1
2
2

# INTERSECT ALL with MergeJoiner.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz ORDER BY y) INTERSECT ALL (SELECT y FROM xyz ORDER BY y)]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUl0Fv2k4Qxe__TxHN6V9lK7FrQxpLlbimUpMq7a3ywcFTsERYtF6k0IjvXoGlEkw8D2srY24B--c3M563L7zSwuZ8nz1zSclP0qTIkKKIFMWkaEipoqWzEy5L67a3VMBd_kLJQFGxWK789utU0cQ6puSVfOHnTAn9yJ7m_MhZzo4U5eyzYr4TWbriOXPr8cv6Nyl6WPnkamwo3SiyK79_XumzKVOiN-p0ze_W-brcWF__ldE1mT35tL6aZeWsjlK62Zdi2pTyj9qP-tN-3FjK_jnW5ew4Py4h3cIn3PVOV1_ZTfmLLRb11ub8y_8_1tcfPrtiOqv-bOx138cwrI93Kry3H-3y4N4m7dGBtj6Dg4Bmlw7qpv2oP-3HjaVcsoPMGbYYaHa5xd20H_Wn_bixlEve4ugMWww0u9zibtqP-tN-3FjKJW9xfIYtBppdbnE37Uf9aT9uLOWStxj8zHnkcmkXJZ_0H_dgWz7nU66GUtqVm_A3Zyc7merjw47bfZFz6auruvpwt6gubQt8C-s6rN_C8QGs28F6EEQPQ2gTpG2AthEnHskTj1pM3LSDaxNvSw9DaBOkbYB2LE4cvK6hCJuR_L5GIn0jwzch9pJhZC9Ag5nJNLIXoIH2J3Hit_LEb0PsJcPIXoAGKy7TyF6ABtpazhB0FB-dpocJZEAEHR2nrTJIpmEIARy1LuMwhgCO1I8O1cPBx2DwR6dqG68AGpkF4WhjZRzZBeFIXY4U9NrkSNEgU3RQqAAa-iUsVgAO_RIWLFpOFg2iRQdlC6ChX8LSBeDQL2H5YoLyxcj5YkC-mKB8ATTyC8JR62H5gnCkLueLAfligvIF0MgvCEcbG5YvCEfq7fIl3fz3JwAA___YeTHS

query I rowsort
(SELECT y FROM xyz ORDER BY y) INTERSECT ALL (SELECT y FROM xyz ORDER BY y)
----
1
1
1
2
2

# INTERSECT ALL with no overlap.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz WHERE x < 2) INTERSECT ALL (SELECT x FROM xyz WHERE x >= 2) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUlk1vm0AQhu_9FdacWnUrsYDzgRTJp6rpIanS3FoOxGxtJIe1FpDiRv7vFRDJBex5vdpw4BYCz84weSYvr5TrVN0lz6qg6BdJEuSToIAEhSRoTrGgrdFLVRTa1I-0wG36QpEnKMu3VVn_Oha01EZR9EplVm4URfSYPG3Ug0pSZUhQqsok2zRFtiZ7Tsxu8bL7S4K-ZptSmWi2kLPflecFy5kfRdHt3SMJuq_K-gbFe0G6Kt9qHUo87WbrpFh3j2-ejwUVZbJSFMm9GL1ndfPOTfsnmz6cU-XapMqotHNSXJPokSNv_i0p1t91lvdffKP-lB8X8tONyVbr5qeTr3hoP7CZ-U9tyn7Vhfx88vDwjNkce-23Q490cKe_6G1_ikdrzzu15QQXYJyeR14AOe0FADN3WwB_ghKO0_PIEvrTlhDM3E3CYIISjtPzyBIG05YQzNxNwnCCEo7T88gShtOWEMz8_b5Hjxz-oIqtzgt11temVw9GpSvVDrrQlVmqH0YvmzLt5X3DNd8YqSrK9q7fXtzm7a26wfPhSxdYSid67kRf87S0mJlvB1-6wL2Z2dJzJ_qap_0-7f1PBx3Y68MBC4f8XytkYV_ypecu-8HDYD94GO0HoMF-ABrsx4XLfvAw2A8eRvsBaLAfgAb7cclaesVLeuWyH9cuhvMwMJyHkeGABoYDGiWATWwO_5Pa5KYtDUPAKjmtcaC5HKRIR1Xp86JLPkaA6XKQIzaqAxq4DmgkO8KB7QhHug8y1Ep3nka68zTUHeBId4Aj3QdB2tX9Aug-yBQr3QeZYqU7TyPdeRrqDnCkO8CR7oM8tdKdp5HuPA11BzjSHeBI90Gqdr-1PV53f5AtrO7x_sO_AAAA__8v81_z

query I
(SELECT x FROM xyz WHERE x < 2) INTERSECT ALL (SELECT x FROM xyz WHERE x >= 2) ORDER BY x
----


# INTERSECT ALL with some overlap.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz WHERE x < 3) INTERSECT ALL (SELECT y FROM xyz WHERE x >= 1) ORDER BY y]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUlk9vm0wQxu_vp0BzeqtuJRZw_iBF4lQ1PThVmlvLgZitjeSw1gJS3MjfvbKJ6gLOPF5tOHCLY347s5Pf5OGFSp2refakKop_kCRBAQkKSVBEgmaUCtoYvVBVpc3-kRa4zZ8p9gUV5aap979OBS20URS_UF3Ua0UxPWSPa3WvslwZEpSrOivWhyIbUzxlZps8b3-ToM_FulYm9hLp_Wx8P1x4YRzHt_MHEnTX1LGXBJTuBOmmfq11LPG49VZZteoen0hKd6mgqs6WimK5E6P3rG48-a5NB282fTynKbXJlVF556R0T6JHTtz8S1atvuqi7F98rX7V_yfyw40plqvDT3-vKHtXPLYf2sz8uzZ1v2oiP755eHTGbE5d-_XQEx3M9Se96U_xZO1Zp7ac4AKM0_PICyCnvQBg5m4LEExQwnF6HlnCYNoSgpm7SRhOUMJxeh5ZwnDaEoKZu0kYTVDCcXoeWcJo2hKCmb_f--iJw-9VtdFlpc562_T3g1H5UrWDrnRjFuqb0YtDmfbj3YE7vGPkqqrbb4P2w23ZfrVv8Hz40gWW0omeOdHXPC0tZhbYwZcucG9mtvTMib7m6aBP-__SYQf2-3DIwhH_14pYOJB86ZnLfvAw2A8eRvsBaLAfgAb7ceGyHzwM9oOH0X4AGuwHoMF-XLKWXvGSXrnsx7WL4TwMDOdhZDiggeGARglgE5vD_6Q2uWlLwxCwSk5rHGguBynSUVUGvOiSjxFguhzkiI3qgAauAxrJjnBgO8KR7oMMtdKdp5HuPA11BzjSHeBI90GQdnW_ALoPMsVK90GmWOnO00h3noa6AxzpDnCk-yBPrXTnaaQ7T0PdAY50BzjSfZCq3Xdtn9c9GGQLq3u6--9PAAAA__8P8l_9

query I
(SELECT y FROM xyz WHERE x < 3) INTERSECT ALL (SELECT y FROM xyz WHERE x >= 1) ORDER BY y
----
1
1

# INTERSECT ALL with swapped column orders.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT x, y FROM xyz INTERSECT ALL SELECT y, x from xyz]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzclkFr20AQhe_9FWFOLWzBK8luLSj42PSQlNBb0UGxtrbA0YpdCeIG__ciqcG17M6zGAWMj2vp232z-sDvhQqbmbv0yXiKf5ImRQEpCklRRIqmlCgqnV0a761rXumA2-yZ4omivCjrqvk5UbS0zlD8QlVebQzF9CN93JgHk2bGkaLMVGm-aQ8pXf6Uuu3iefubFN3XVXyz0GoRULJTZOvq75b7nR63N-vUrw93eUUSRb5KV4ZivVNvlC5QCy1NF_w33X6rurAuM85kB5slDYleOTHi19Svv9m86E-4Mb-q923AD19cvlq_LriPsZ8jFMxxIuSd_WjL_rgnD44ODtYXLd-Y6caXT1-JfMFFOzBmuvEdCK7EgfCiHRgz3fgOhFfiQHTRDoyZbnwHoitxANS9B-NLW3hzVtOYNEOYbGW6S_G2dkvz3dlle0y3vG-59r80M77qngbd4rboHjUBz4dnEngugbUot57ytB5wZcEweCaB5xJYi3L3ruyIDvr05F865O87ZGF9eGeTPh1JBOdhIDgPA8F5GAkOaCD4VCI4DwPBeRgIzsNIcEADwWcSwT9JFOVhoCgPA0V5GCkKaKDoZ4miPAwU5WGgKA8jRQENFJ1LFNWingBoICmggaWARpoiHHUFWVmQtQVZXRD2BVlh0KLGoI8qwyBbeRrZytPIVp6GtgIc2TqkLB1_syFtaSiNbB3UlwbjyNaj8sDamuze_QkAAP__OIEoJA==

query II rowsort
SELECT x, y FROM xyz INTERSECT ALL SELECT y, x from xyz
----
1 1

# INTERSECT ALL with different ORDER BY types.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) INTERSECT ALL (SELECT x FROM xyz ORDER BY z) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUmEFv2kAQhe_9FdGcWmUrZdcGEqRKHJsekirtreLg4G1AIl60NlLSiP9eGVdysPE8D0a43Ar486wf_d4ueaPExfYuerYpjX-RJkWGFAWkKCRFA5oqWnk3s2nqfH5JAdzGLzS-UrRIVussf3uqaOa8pfEbZYtsaWlMP6PHpX2wUWw9KYptFi2W2yErv3iO_Ovk5fUPKbpfZ-OLiVYTQ9ONIrfOylumWfRkaaw3qv3YH85n1YkTc1lOqowpycfXi3mUzitofn25FCNZijSBoDGB4P9JIGxcSnmfdeJ8bL2Nd-40zUl0yZ7n-Rql829ukVSfaWl_Zx8n-tMXv3iab__V-Ijl8gedk9SXjTcftshm32P_u-meFdy5z25VTXHv7NHObN2Pm2DsKd08cgJt3ew1gbBxKWfo5iFJtnbT9OMHGHtKP46cQFs_ek0gbFzKGfpxSJKt_Qj68QOMPaUfR06grR-9JhA2LuUM_TgkydZ-hP34Acae0o8jJ9DWj14TCBuXcoZ-HJLkQb999tz8waYrl6S21S-bqzwYGz_ZIujUrf3Mfvduth1TvLzfcts3Yptmxae6eHGbFB_lC3wP6yqs38PhDqxlsNad6FEX2gSd6BueNmziAZ94IEjcyOBK4lJ61IWuJC6lb3g6ZBMf8IkPWHjIf9dD_rsGeo1Y-pqHr7u4ycPITUADN3kauQlo4OYN34ZXoA5rZSqxE9BIT4QDPwGOBEU4MFTXKnU3eAOC5zsVSKpr7bI7PATDa_Ui2gV5Gm6DAEf7II_DjRDgwDbNd6seguBr7SrSjaehbgBHuvE41A3gSDd-Z9Fga9G1khXpxpesASVrJCVbP3yJSlaMA90AjnRDODp48iVrQMmaWslKdAM00g3hQDeAI90QDnQz_AZjwAZj-PMr0M3wJWtAyRpJydaHi0pWjCPdRCUrxpFufMkaULJGcoCv_5cTneDFONJNdIYX40g3foMJwAYT8H8Sqeo23Xz4GwAA___8RzSn

query I
(SELECT x FROM xyz ORDER BY y) INTERSECT ALL (SELECT x FROM xyz ORDER BY z) ORDER BY x
----
1
2
3
4
5

# INTERSECT ALL with different numbers of ORDER BY columns.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) INTERSECT ALL (SELECT x FROM xyz ORDER BY y, z) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUmMFu2kwUhff_U0R39VeZSpmxgQSpkpdNF0mVdlexcPA0IBEGjY2UNMq7V8aVHGy4x9c2IHYF_PmOD_3ODHmjpUvsXfxsUxr_Ik2KDCkKSFFIigY0UbTybmrT1Pn8kgK4TV5ofKVovlyts_ztiaKp85bGb5TNs4WlMf2MHxf2wcaJ9aQosVk8X2yGrPz8Ofav0cvrH1J0v87GF5FWkaHJuyK3zspbpln8ZGms31XzsT-cz6oTI3NZTqqMKcnH14tZnM4qaH59uRQjWYo4ARUFe0MIeghBRUFfQYR7l1PeZ710PrHeJlt3muQkumTHM32N09k3N19Wn2thf2f_R_rTFz9_mm3-tfcRy-UPOqepL_fefNggm12P_e-mO1Zw5z67VTXFnbNHW7P1aRQFY4-paN8JNFe0XQgHU1Sft6Jt0mysqDmNJmDsMTXpO4HmmrQL4WCamPPWpE2ajTUJTqMJGHtMTfpOoLkm7UI4mCbBeWvSJs3GmoSn0QSMPaYmfSfQXJN2IRxMk_C8NWmTZqvfRTtu_mDTlVumttGvnqs8GJs82SLo1K391H73broZU7y833CbNxKbZsWnunhxuyw-yhf4EdZVWH-Ewy1Yy2CtO9GjLrQJOtE3PG3YxAM-8UCQuJHBlcSl9KgLXUlcSt_wdMgmPuATH7DwkP-uh_x3DfQasfQ1D193cZOHkZuABm7yNHIT0MDNG74Nr0Ad1spUYiegkZ4IB34CHAmKcGCorlXqdvAGBM93KpBU19ple3gIhtfqRbQL8jTcBgGO9kEehxshwIFtmu9WPQTB19pVpBtPQ90AjnTjcagbwJFu_M6iwdaiayUr0o0vWQNK1khKtn74EpWsGAe6ARzphnB08ORL1oCSNbWSlegGaKQbwoFuAEe6IRzoZvgNxoANxvDnV6Cb4UvWgJI1kpKtDxeVrBhHuolKVowj3fiSNaBkjeQAX_8vJzrBi3Gkm-gML8aRbvwGE4ANJuD_JFLVbfL-398AAAD__zCzO68=

query I
(SELECT x FROM xyz ORDER BY y) INTERSECT ALL (SELECT x FROM xyz ORDER BY y, z) ORDER BY x
----
1
2
3
4
5

# INTERSECT ALL with compatible ORDER BY columns that are not in the final result.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz ORDER BY z) INTERSECT ALL (SELECT y FROM xyz ORDER BY z)]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUl0Fv2kAUhO_9FdE7tepWYtcLaSxV4tj0kFRpbxUHB2_BEvGi3UUKjfjvlbFUgsFvYm1l4FbAn-ft-I2neaHS5uYuezKe0l8kSZAiQQkJ0iRoSBNBS2enxnvrqktq4DZ_pnQgqCiXq1B9PRE0tc5Q-kKhCAtDKf3MHhfmwWS5cSQoNyErFluRpSueMrceP6__kKD7VUivxkqME5psBNlV2N3Sh2xmKJUb8XbZH9aFpuJYffynJBsyO_JxfTXP_LyBVtfvRlFdRvl_DiTn44BuHWV3n1VpXW6cyffuNKlIdMmR83zN_PybLcrmmRbmd3g_lh--uGI23_6r9Yi78YcR4x-Z7c5-ssvmKY8Kj_aE5WmyA2T7zE5vDiTn44BuHeUCs6NOs8JAts8V7s2B5Hwc0K2jXOAKJ6dZYSDb5wr35kByPg7o1lEucIX1aVYYyPa5wr05kJyPA7p1lAtcYfDnzIPxS1t686b_ZQ-q2U0-M7UX3q7c1Hx3drqVqT_eb7ntF7nxof5V1h9uy_qnasDXsGzC8jWs92DZDZaDKHoYQ6sobQW0Fet4wjuedHBcdYMbjnelhzG0itJWQFuzjoPHNWRhNeKf14ilr3n4OiZePIziBWjgGU-jeAEaaH9mHb_hHb-JiRcPo3gBGqw4T6N4ARpoS75D0Kv44G2630AKVNDB67RTB_E0LCGAo6PzOKwhgCP1g5fqvvEaGH_wVu2SFUCjsCAcbSyPo7ggHKnzlYIeG18pEnSKjCoVQMO8xNUKwGFe4opF8s0iQbXIqG4BNMxLXLsAHOYlrl9UVL8ovl8U6BcV1S-ARnlBODp6XL8gHKnz_aJAv6iofgE0ygvC0cbG9QvCkXq3fpls3v0NAAD__7kXNGk=

query I rowsort
(SELECT y FROM xyz ORDER BY z) INTERSECT ALL (SELECT y FROM xyz ORDER BY z)
----
1
1
1
2
2

# Basic EXCEPT ALL case.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz) EXCEPT ALL (SELECT x AS y FROM xyz) ORDER BY y]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUlkFv2kwQhu_fr4jm9FXdSuzahGCpEsemh6RKe6t8cPAWLBEvWhspNOK_V-BI1F4zL6t1JbiF4Gd2dvJMXr9RaXL9kL3oipKfJEmQIkERCYpJ0JhSQWtr5rqqjN0_0gD3-SslI0FFud7U-1-ngubGakreqC7qlaaEfmTPK_2ks1xbEpTrOitWh0PWtnjJ7Hb2uv1Ngh43dXIzU5TuBJlN_V7vWOZ5e7PMqmW7xExSuksFVXW20JTInfhHfcmgvtTJvo51NqWxubY6b1VK9yR6pOdyX7Jq-dUUZfduK_2r_n8mP3y2xWJ5-OnkFY_tRz5j_W5s3T11Jj-eLB6fMZu-a78X7engwXwy6-4Ue88et86WF-rxkH0N6bG8bo_BWMM8Vhfq0pB9DemSum6XwFjDXIou1KUh-xrSpei6XQJjDXMpvlCXhuxrSJfi63YJjHW4d7We4k-6Wpuy0me9iY32g9H5QjeDrszGzvU3a-aHY5qPjwfuENy5rurmW9V8uC-br_YNng9PQmApg-hxED3laekxM-UHT0Lgzsx86XEQPeVp1aVHf9NRCx514YiFY_6vFbOwkvzR45D94GGwHzyM9gPQYD8ADfbjNmQ_eBjsBw-j_QA02A9Ag_2YsJbe8ZLehezHNMRwHgaG8zAyHNDAcECjBPCJTfc_qU9u-tIwBLyS0xsHmksnRVqqSsWLLvkYAaZLJ0d8VAc0cB3QSHaEA9sRjnR3MtRLd55GuvM01B3gSHeAI92dIG3rfgt0dzLFS3cnU7x052mkO09D3QGOdAc40t3JUy_deRrpztNQd4Aj3QGOdHdStf2uPeJ1V062sLqnu__-BAAA__8jDhQ_

query I
(SELECT y FROM xyz) EXCEPT ALL (SELECT x AS y FROM xyz) ORDER BY y
----
1
1
2

# EXCEPT ALL with MergeJoiner.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz ORDER BY y) EXCEPT ALL (SELECT y FROM xyz ORDER BY y)]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUl0Fv2k4Qxe__TxHN6V9lK7FrQxpLlbimUpMq7a3ywcFTsERYtF6k0IjvXoGlEkw8D2srY24B--c3M563L7zSwuZ8nz1zSclP0qTIkKKIFMWkaEipoqWzEy5L67a3VMBd_kLJQFGxWK789utU0cQ6puSVfOHnTAn9yJ7m_MhZzo4U5eyzYr4TWbriOXPr8cv6Nyl6WPnkamwo3SiyK79_XumzKVOiN-p0ze_W-brcWF__ldE1mT35tL6aZeWsjlK62Zdi2pTyj9qP-tN-3FjK_jnW5ew4Py4h3cIn3PVOV1_ZTfmLLRb11ub8y_8_1tcfPrtiOqv-bOx138cwrI93Kry3H-3y4N4m7dGBtj6Dg4Bmlw7qpv2oP-3HjaVcsoPMGbYYaHa5xd20H_Wn_bixlEve4ugMWww0u9zibtqP-tN-3FjKJW9xfIYtBppdbnE37Uf9aT9uLOWStxj8zHnkcmkXJZ_0H_dgWz7nU66GUtqVm_A3Zyc7merjw47bfZFz6auruvpwt6gubQt8C-s6rN_C8QGs28F6EEQPQ2gTpG2AthEnHskTj1pM3LSDaxNvSw9DaBOkbYB2LE4cvK6hCJuR_L5GIn0jwzch9pJhZC9Ag5nJNLIXoIH2J3Hit_LEb0PsJcPIXoAGKy7TyF6ABtpazhB0FB-dpocJZEAEHR2nrTJIpmEIARy1LuMwhgCO1I8O1cPBx2DwR6dqG68AGpkF4WhjZRzZBeFIXY4U9NrkSNEgU3RQqAAa-iUsVgAO_RIWLFpOFg2iRQdlC6ChX8LSBeDQL2H5YoLyxcj5YkC-mKB8ATTyC8JR62H5gnCkLueLAfligvIF0MgvCEcbG5YvCEfq7fIl3fz3JwAA___YeTHS

query I rowsort
(SELECT y FROM xyz ORDER BY y) EXCEPT ALL (SELECT y FROM xyz ORDER BY y)
----


# EXCEPT ALL with no overlap.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz WHERE x < 2) EXCEPT ALL (SELECT x FROM xyz WHERE x >= 2) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUlk1vm0AQhu_9FdacWnUrsYDzgRTJp6rpIanS3FoOxGxtJIe1FpDiRv7vFRDJBex5vdpw4BYCz84weSYvr5TrVN0lz6qg6BdJEuSToIAEhSRoTrGgrdFLVRTa1I-0wG36QpEnKMu3VVn_Oha01EZR9EplVm4URfSYPG3Ug0pSZUhQqsok2zRFtiZ7Tsxu8bL7S4K-ZptSmWi2kLPflecFy5kfRdHt3SMJuq_K-gbFe0G6Kt9qHUo87WbrpFh3j2-ejwUVZbJSFMm9GL1ndfPOTfsnmz6cU-XapMqotHNSXJPokSNv_i0p1t91lvdffKP-lB8X8tONyVbr5qeTr3hoP7CZ-U9tyn7Vhfx88vDwjNkce-23Q490cKe_6G1_ikdrzzu15QQXYJyeR14AOe0FADN3WwB_ghKO0_PIEvrTlhDM3E3CYIISjtPzyBIG05YQzNxNwnCCEo7T88gShtOWEMz8_b5Hjxz-oIqtzgt11temVw9GpSvVDrrQlVmqH0YvmzLt5X3DNd8YqSrK9q7fXtzm7a26wfPhSxdYSid67kRf87S0mJlvB1-6wL2Z2dJzJ_qap_0-7f1PBx3Y68MBC4f8XytkYV_ypecu-8HDYD94GO0HoMF-ABrsx4XLfvAw2A8eRvsBaLAfgAb7cclaesVLeuWyH9cuhvMwMJyHkeGABoYDGiWATWwO_5Pa5KYtDUPAKjmtcaC5HKRIR1Xp86JLPkaA6XKQIzaqAxq4DmgkO8KB7QhHug8y1Ep3nka68zTUHeBId4Aj3QdB2tX9Aug-yBQr3QeZYqU7TyPdeRrqDnCkO8CR7oM8tdKdp5HuPA11BzjSHeBI90Gqdr-1PV53f5AtrO7x_sO_AAAA__8v81_z

query I
(SELECT x FROM xyz WHERE x < 2) EXCEPT ALL (SELECT x FROM xyz WHERE x >= 2) ORDER BY x
----
1

# EXCEPT ALL with some overlap.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz WHERE x >= 1) EXCEPT ALL (SELECT y FROM xyz WHERE x < 3) ORDER BY y]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUlk9vm0wQxu_vp0BzeqtuJRZw_iBF4lQ1PThVmlvLgZitjeSw1gJS3MjfvbKJ6gLOPF5tOHCLY347s5Pf5OGFSp2refakKop_kCRBAQkKSVBEgmaUCtoYvVBVpc3-kRa4zZ8p9gUV5aap979OBS20URS_UF3Ua0UxPWSPa3WvslwZEpSrOivWhyIbUzxlZps8b3-ToM_FulYm9hLp_Wx8P1Q3nozj-Hb-QILumjr2koDSnSDd1K_FjjUet94qq1bd8xNJ6S4VVNXZUlEsd2L0phde-K49B2_2fDynKbXJlVF556R0T6JHTlz8S1atvuqi7N97rX7V_yfyw40plqvDT3-vKHtXPLYf2oz8uzZ1v2oiP755eHTGbE5d-_XQEx3M9Se96U_xZO1Zp7ac4gKM0_S4CyCnvQBg5G4LEExRwnGaHlfCYNoSgpG7SRhOUcJxmh5XwnDaEoKRu0kYTVHCcZoeV8Jo2hKCkb_f--iJw-9VtdFlpc562_T3g1H5UrWDrnRjFuqb0YtDmfbj3YE7vGPkqqrbb4P2w23ZfrVv8Hz40gWW0omeOdHXPC0tZhbYwZcucG9mtvTMib7m6aBP-__SYQf2-3DIwhH_14pYOJB86ZnLfvAw2A8eRvsBaLAfgAb7ceGyHzwM9oOH0X4AGuwHoMF-XLKWXvGSXrnsx7WL4TwMDOdhZDiggeGARglgE5vD_6Q2uWlLwxCwSk5rHGguBynSUVUGvOiSjxFguhzkiI3qgAauAxrJjnBgO8KR7oMMtdKdp5HuPA11BzjSHeBI90GQdnW_ALoPMsVK90GmWOnO00h3noa6AxzpDnCk-yBPrXTnaaQ7T0PdAY50BzjSfZCq3Xdtn9c9GGQLq3u6--9PAAAA___IwV_9

query I
(SELECT y FROM xyz WHERE x >= 1) EXCEPT ALL (SELECT y FROM xyz WHERE x < 3) ORDER BY y
----
1
2
2

# EXCEPT ALL with swapped column orders.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT x, y FROM xyz EXCEPT ALL SELECT y, x from xyz]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzclkFr20AQhe_9FWFOLWzBK8luLSj42PSQlNBb0UGxtrbA0YpdCeIG__ciqcG17M6zGAWMj2vp232z-sDvhQqbmbv0yXiKf5ImRQEpCklRRIqmlCgqnV0a761rXumA2-yZ4omivCjrqvk5UbS0zlD8QlVebQzF9CN93JgHk2bGkaLMVGm-aQ8pXf6Uuu3iefubFN3XVXyz0GoRULJTZOvq75b7nR63N-vUrw93eUUSRb5KV4ZivVNvlC5QCy1NF_w33X6rurAuM85kB5slDYleOTHi19Svv9m86E-4Mb-q923AD19cvlq_LriPsZ8jFMxxIuSd_WjL_rgnD44ODtYXLd-Y6caXT1-JfMFFOzBmuvEdCK7EgfCiHRgz3fgOhFfiQHTRDoyZbnwHoitxANS9B-NLW3hzVtOYNEOYbGW6S_G2dkvz3dlle0y3vG-59r80M77qngbd4rboHjUBz4dnEngugbUot57ytB5wZcEweCaB5xJYi3L3ruyIDvr05F865O87ZGF9eGeTPh1JBOdhIDgPA8F5GAkOaCD4VCI4DwPBeRgIzsNIcEADwWcSwT9JFOVhoCgPA0V5GCkKaKDoZ4miPAwU5WGgKA8jRQENFJ1LFNWingBoICmggaWARpoiHHUFWVmQtQVZXRD2BVlh0KLGoI8qwyBbeRrZytPIVp6GtgIc2TqkLB1_syFtaSiNbB3UlwbjyNaj8sDamuze_QkAAP__OIEoJA==

query II rowsort
SELECT x, y FROM xyz EXCEPT ALL SELECT y, x from xyz
----
2 1
3 1
4 2
5 2

# EXCEPT ALL with different ORDER BY types.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) EXCEPT ALL (SELECT y AS x FROM xyz ORDER BY z) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUmEFv2kAQhe_9FdGcWmUrZdcGEqRKHJsekirtreLg4G1AIl60NlLSiP9eGVdysPE8D0a43Ar486wf_d4ueaPExfYuerYpjX-RJkWGFAWkKCRFA5oqWnk3s2nqfH5JAdzGLzS-UrRIVussf3uqaOa8pfEbZYtsaWlMP6PHpX2wUWw9KYptFi2W2yErv3iO_Ovk5fUPKbpfZ-OLiVYTQ9ONIrfOylumWfRkaaw3qv3YH85n1YkTc1lOqowpycfXi3mUzitofn25FCNZiigBoyZBYwLB_5NA2LiU8j7rxPnYehvv3Gmak-iSPc_zNUrn39wiqT7T0v7OPk70py9-8TTf_qvxEcvlDzonqS8bbz5skc2-x_530z0ruHOf3aqa4t7Zo53Zuh83wdhTunnMBARu9ppA2LiUM3TzkCRbu2n68QOMPaUfx0xA4EevCYSNSzlDPw5JsrUfQT9-gLGn9OOYCQj86DWBsHEpZ-jHIUm29iPsxw8w9pR-HDMBgR-9JhA2LuUM_TgkyYN---y5-YNNVy5JbatfNld5MDZ-skXQqVv7mf3u3Ww7pnh5v-W2b8Q2zYpPdfHiNik-yhf4HtZVWL-Hwx1Yy2CtO9GjLrQJOtE3PG3YxAM-8UCQuJHBlcSl9KgLXUlcSt_wdMgmPuATH7DwkP-uh_x3DfQasfQ1D193cZOHkZuABm7yNHIT0MDNG74Nr0Ad1spUYiegkZ4IB34CHAmKcGCorlXqbvAGBM93KpBU19pld3gIhtfqRbQL8jTcBgGO9kEehxshwIFtmu9WPQTB19pVpBtPQ90AjnTjcagbwJFu_M6iwdaiayUr0o0vWQNK1khKtn74EpWsGAe6ARzphnB08ORL1oCSNbWSlegGaKQbwoFuAEe6IRzoZvgNxoANxvDnV6Cb4UvWgJI1kpKtDxeVrBhHuolKVowj3fiSNaBkjeQAX_8vJzrBi3Gkm-gML8aRbvwGE4ANJuD_JFLVbbr58DcAAP__fYM0rA==

query I
(SELECT x FROM xyz ORDER BY y) EXCEPT ALL (SELECT y AS x FROM xyz ORDER BY z) ORDER BY x
----
3
4
5

# EXCEPT ALL with different numbers of ORDER BY columns.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) EXCEPT ALL (SELECT x FROM xyz ORDER BY y, z) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUmMFu2kwUhff_U0R39VeZSpmxgQSpkpdNF0mVdlexcPA0IBEGjY2UNMq7V8aVHGy4x9c2IHYF_PmOD_3ODHmjpUvsXfxsUxr_Ik2KDCkKSFFIigY0UbTybmrT1Pn8kgK4TV5ofKVovlyts_ztiaKp85bGb5TNs4WlMf2MHxf2wcaJ9aQosVk8X2yGrPz8Ofav0cvrH1J0v87GF5FWkaHJuyK3zspbpln8ZGms31XzsT-cz6oTI3NZTqqMKcnH14tZnM4qaH59uRQjWYo4ARUFe0MIeghBRUFfQYR7l1PeZ710PrHeJlt3muQkumTHM32N09k3N19Wn2thf2f_R_rTFz9_mm3-tfcRy-UPOqepL_fefNggm12P_e-mO1Zw5z67VTXFnbNHW7P1aRQFY4-paN8JNFe0XQgHU1Sft6Jt0mysqDmNJmDsMTXpO4HmmrQL4WCamPPWpE2ajTUJTqMJGHtMTfpOoLkm7UI4mCbBeWvSJs3GmoSn0QSMPaYmfSfQXJN2IRxMk_C8NWmTZqvfRTtu_mDTlVumttGvnqs8GJs82SLo1K391H73broZU7y833CbNxKbZsWnunhxuyw-yhf4EdZVWH-Ewy1Yy2CtO9GjLrQJOtE3PG3YxAM-8UCQuJHBlcSl9KgLXUlcSt_wdMgmPuATH7DwkP-uh_x3DfQasfQ1D193cZOHkZuABm7yNHIT0MDNG74Nr0Ad1spUYiegkZ4IB34CHAmKcGCorlXqdvAGBM93KpBU19ple3gIhtfqRbQL8jTcBgGO9kEehxshwIFtmu9WPQTB19pVpBtPQ90AjnTjcagbwJFu_M6iwdaiayUr0o0vWQNK1khKtn74EpWsGAe6ARzphnB08ORL1oCSNbWSlegGaKQbwoFuAEe6IRzoZvgNxoANxvDnV6Cb4UvWgJI1kpKtDxeVrBhHuolKVowj3fiSNaBkjeQAX_8vJzrBi3Gkm-gML8aRbvwGE4ANJuD_JFLVbfL-398AAAD__zCzO68=

query I
(SELECT x FROM xyz ORDER BY y) EXCEPT ALL (SELECT x FROM xyz ORDER BY y, z) ORDER BY x
----


# EXCEPT ALL with compatible ORDER BY columns that are not in the final result.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz ORDER BY z) EXCEPT ALL (SELECT y FROM xyz ORDER BY z)]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUl0Fv2kAUhO_9FdE7tepWYtcLaSxV4tj0kFRpbxUHB2_BEvGi3UUKjfjvlbFUgsFvYm1l4FbAn-ft-I2neaHS5uYuezKe0l8kSZAiQQkJ0iRoSBNBS2enxnvrqktq4DZ_pnQgqCiXq1B9PRE0tc5Q-kKhCAtDKf3MHhfmwWS5cSQoNyErFluRpSueMrceP6__kKD7VUivxkqME5psBNlV2N3Sh2xmKJUb8XbZH9aFpuJYffynJBsyO_JxfTXP_LyBVtfvRlFdRvl_DiTn44BuHWV3n1VpXW6cyffuNKlIdMmR83zN_PybLcrmmRbmd3g_lh--uGI23_6r9Yi78YcR4x-Z7c5-ssvmKY8Kj_aE5WmyA2T7zE5vDiTn44BuHeUCs6NOs8JAts8V7s2B5Hwc0K2jXOAKJ6dZYSDb5wr35kByPg7o1lEucIX1aVYYyPa5wr05kJyPA7p1lAtcYfDnzIPxS1t686b_ZQ-q2U0-M7UX3q7c1Hx3drqVqT_eb7ntF7nxof5V1h9uy_qnasDXsGzC8jWs92DZDZaDKHoYQ6sobQW0Fet4wjuedHBcdYMbjnelhzG0itJWQFuzjoPHNWRhNeKf14ilr3n4OiZePIziBWjgGU-jeAEaaH9mHb_hHb-JiRcPo3gBGqw4T6N4ARpoS75D0Kv44G2630AKVNDB67RTB_E0LCGAo6PzOKwhgCP1g5fqvvEaGH_wVu2SFUCjsCAcbSyPo7ggHKnzlYIeG18pEnSKjCoVQMO8xNUKwGFe4opF8s0iQbXIqG4BNMxLXLsAHOYlrl9UVL8ovl8U6BcV1S-ARnlBODp6XL8gHKnz_aJAv6iofgE0ygvC0cbG9QvCkXq3fpls3v0NAAD__7kXNGk=

query I rowsort
(SELECT y FROM xyz ORDER BY z) EXCEPT ALL (SELECT y FROM xyz ORDER BY z)
----

