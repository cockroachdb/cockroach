statement ok
CREATE DATABASE d;
GRANT CREATE ON DATABASE d TO testuser

# By default, testuser should have ALL privileges on a sequences it creates.
user testuser

statement ok
USE d;

statement ok
CREATE SEQUENCE testuser_s;

query TTTTT colnames
SHOW GRANTS ON testuser_s;
----
database_name  schema_name  table_name  grantee   privilege_type
d              public       testuser_s  admin     ALL
d              public       testuser_s  root      ALL
d              public       testuser_s  testuser  ALL

statement ok
ALTER DEFAULT PRIVILEGES REVOKE ALL ON SEQUENCES FROM testuser;

statement ok
CREATE SEQUENCE testuser_s2;

query TTTTT colnames
SHOW GRANTS ON testuser_s2
----
database_name  schema_name  table_name   grantee   privilege_type
d              public       testuser_s2  admin     ALL
d              public       testuser_s2  root      ALL
d              public       testuser_s2  testuser  CREATE

user root

statement ok
USE d;

statement ok
CREATE USER testuser2

statement ok
ALTER DEFAULT PRIVILEGES GRANT ALL ON SEQUENCES TO testuser, testuser2

statement ok
CREATE SEQUENCE s

query TTTTT colnames
SHOW GRANTS ON s
----
database_name  schema_name  table_name  grantee    privilege_type
d              public       s           admin      ALL
d              public       s           root       ALL
d              public       s           testuser   ALL
d              public       s           testuser2  ALL

# Sequence DEFAULT PRIVILEGES should be separate from tables.
statement ok
CREATE TABLE t()

query TTTTT colnames
SHOW GRANTS ON t
----
database_name  schema_name  table_name  grantee   privilege_type
d              public       t           admin     ALL
d              public       t           root      ALL
d              public       t           testuser  ALL


statement ok
ALTER DEFAULT PRIVILEGES REVOKE SELECT ON SEQUENCES FROM testuser, testuser2

statement ok
CREATE SEQUENCE s2

query TTTTT colnames
SHOW GRANTS ON s2
----
database_name  schema_name  table_name  grantee    privilege_type
d              public       s2          admin      ALL
d              public       s2          root       ALL
d              public       s2          testuser   CREATE
d              public       s2          testuser   DELETE
d              public       s2          testuser   DROP
d              public       s2          testuser   GRANT
d              public       s2          testuser   INSERT
d              public       s2          testuser   UPDATE
d              public       s2          testuser   ZONECONFIG
d              public       s2          testuser2  CREATE
d              public       s2          testuser2  DELETE
d              public       s2          testuser2  DROP
d              public       s2          testuser2  GRANT
d              public       s2          testuser2  INSERT
d              public       s2          testuser2  UPDATE
d              public       s2          testuser2  ZONECONFIG

statement ok
ALTER DEFAULT PRIVILEGES REVOKE ALL ON SEQUENCES FROM testuser, testuser2

statement ok
CREATE SEQUENCE s3

query TTTTT colnames
SHOW GRANTS ON s3
----
database_name  schema_name  table_name  grantee   privilege_type
d              public       s3          admin     ALL
d              public       s3          root      ALL
d              public       s3          testuser  CREATE

statement ok
GRANT CREATE ON DATABASE d TO testuser

user testuser
statement ok
USE d

statement ok
ALTER DEFAULT PRIVILEGES FOR ROLE testuser REVOKE ALL ON SEQUENCES FROM testuser, testuser2

statement ok
CREATE SEQUENCE s4

# testuser still has CREATE due to "inheriting" it from the parent database.
query TTTTT colnames
SHOW GRANTS ON s4
----
database_name  schema_name  table_name  grantee   privilege_type
d              public       s4          admin     ALL
d              public       s4          root      ALL
d              public       s4          testuser  CREATE

user root
statement ok
USE d

statement ok
GRANT testuser TO root

statement ok
ALTER DEFAULT PRIVILEGES FOR ROLE testuser REVOKE ALL ON SEQUENCES FROM testuser, testuser2

user testuser
statement ok
USE d

statement ok
CREATE SEQUENCE s5

# testuser still has CREATE due to "inheriting" it from the parent database.
query TTTTT colnames
SHOW GRANTS ON s5
----
database_name  schema_name  table_name  grantee   privilege_type
d              public       s5          admin     ALL
d              public       s5          root      ALL
d              public       s5          testuser  CREATE
