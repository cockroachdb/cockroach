# LogicTest: default parallel-stmts distsql

# -0 and 0 should not be possible in a unique index.

statement ok
CREATE TABLE p (f float primary key)

statement ok
INSERT INTO p VALUES ('NaN'::float), ('Inf'::float), ('-Inf'::float), ('0'::float), (1), (-1)

# -0 and 0 should both equate to zero with or without an index.

statement error duplicate key value
INSERT INTO p VALUES ('-0'::float)

# Verify that lookups for NaN use indices when possible:
# - `WHERE f IS NaN` should perform a point lookup.
# - `WHERE f = 'NaN'` should also perform a point lookup.
# - `WHERE isnan(f)` is a function so it can't perform a point lookup.

query ITTT
EXPLAIN SELECT * FROM p WHERE f IS NaN
----
0  scan  ·      ·
0  ·     table  p@primary
0  ·     spans  /NaN-/-Inf

query ITTT
EXPLAIN SELECT * FROM p WHERE f = 'NaN'
----
0  scan  ·      ·
0  ·     table  p@primary
0  ·     spans  /NaN-/-Inf

query ITTT
EXPLAIN SELECT * FROM p WHERE isnan(f)
----
0  scan  ·      ·
0  ·     table  p@primary
0  ·     spans  ALL

query R
SELECT * FROM p WHERE f = 'NaN'
----
NaN

query RBBB
SELECT f, f IS NaN, f = 'NaN', isnan(f) FROM p ORDER BY 1
----
NaN   true   true   true
-Inf  false  false  false
-1    false  false  false
0     false  false  false
1     false  false  false
+Inf  false  false  false

query RB rowsort
select f, f > 'NaN' from p where f > 'NaN' ORDER BY f
----
-Inf  true
-1    true
0     true
1     true
+Inf  true

statement ok
CREATE TABLE i (f float)

statement ok
INSERT INTO i VALUES (0), ('-0'::float)

query R rowsort
SELECT * FROM i WHERE f = 0
----
-0
0

statement ok
CREATE INDEX ON i (f)

query R rowsort
SELECT * FROM i WHERE f = 0
----
-0
0

statement error duplicate key value
CREATE UNIQUE INDEX ON i (f)
