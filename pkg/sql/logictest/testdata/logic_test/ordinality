# LogicTest: local local-opt fakedist fakedist-opt fakedist-metadata

query TI colnames
SELECT * FROM (VALUES ('a'), ('b')) WITH ORDINALITY AS x(name, i)
----
name i
a 1
b 2

query I colnames
SELECT ordinality FROM (VALUES ('a'), ('b')) WITH ORDINALITY
----
ordinality
1
2

statement ok
CREATE TABLE foo (x CHAR PRIMARY KEY); INSERT INTO foo(x) VALUES ('a'), ('b')

query TI
SELECT * FROM foo WITH ORDINALITY
----
a 1
b 2

query TI
SELECT * FROM foo WITH ORDINALITY LIMIT 1
----
a 1

query I
SELECT max(ordinality) FROM foo WITH ORDINALITY
----
2

query TITI rowsort
SELECT * FROM foo WITH ORDINALITY AS a, foo WITH ORDINALITY AS b
----
a 1 a 1
a 1 b 2
b 2 a 1
b 2 b 2

query TI
SELECT * FROM (SELECT x||x FROM foo) WITH ORDINALITY
----
aa 1
bb 2

query TII
SELECT * FROM (SELECT x, ordinality*2 FROM foo WITH ORDINALITY AS a) JOIN foo WITH ORDINALITY AS b USING(x)
----
a 2 1
b 4 2

statement ok
INSERT INTO foo(x) VALUES ('c')

query TI
SELECT * FROM foo WITH ORDINALITY WHERE x > 'a'
----
b 2
c 3

query TI
SELECT * FROM foo WITH ORDINALITY WHERE ordinality > 1 ORDER BY ordinality DESC
----
c 3
b 2

query TI
SELECT * FROM (SELECT * FROM foo WHERE x > 'a') WITH ORDINALITY
----
b 1
c 2

query B
SELECT ordinality = row_number() OVER () FROM foo WITH ORDINALITY
----
true
true
true

# Regression test for #33659
statement ok
TABLE [SHOW ZONE CONFIGURATIONS] WITH ORDINALITY

query T
SELECT url FROM [EXPLAIN ANALYZE SELECT * FROM foo WITH ORDINALITY AS a, foo WITH ORDINALITY AS b]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJykUsFu1DAQvfMV1pyNNk6yAnyKeqIgsahwQzm46-nWIomjGUd0Ve1n8QN8GXJc1N3Qhg29RPLze35v3uQeOm_xk2mRQX8DBbWEnvwWmT1FKBEu7R3oTILr-iFEuJaw9YSg7yG40CBo-GquG7xCY5FWGUiwGIxrxmd7cq2hfXXjPUj40puOtXgNEsj_YEForBYFSOBgmkYE16IW6tdPBgnX-4B_KG-VuID6IMEP4TEHB7ND0Oogz8-6Ies607iwX6nTqDOJ8ixGes4_X-J_3FX-8q7KhV0V_9lVcXZXb9RcV-Wz_o-2Q-fJIqE98ayj8l-UJ4Z4b_j2g3cd0qo8HWIzBC0qJatcxm8pq7WsIqfBmyAmI47Y8ZzFOlVPbnf7FzuBx_R3RaJz8IRWsLOoxUgDCa25Ey22nvZiYLTxhxMf3cXDjXX8_QHPZla7XrLaK-Ted4zTip98OYu9ot1h2hP7gbb4mfx2tEnHzagbAYsc0q1Kh8suXcWAx2I1Ky5PxGoqzmfFxbxzscA5n4rLWfF64lwfXv0OAAD__5s5yd8=
