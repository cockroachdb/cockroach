# test MODIFYCLUSTERSETTING
user testuser

statement error pq: only users with either MODIFYCLUSTERSETTING or VIEWCLUSTERSETTING system privileges are allowed to read crdb_internal.cluster_settings
SELECT * FROM crdb_internal.cluster_settings;

user root

statement ok
GRANT SYSTEM MODIFYCLUSTERSETTING TO testuser

user testuser

statement ok
SELECT * FROM crdb_internal.cluster_settings;

user root

query TTTT
SELECT * FROM system.privileges
----
testuser  /global/  {MODIFYCLUSTERSETTING}  {}

statement ok
REVOKE SYSTEM MODIFYCLUSTERSETTING FROM testuser

user testuser

statement error pq: only users with either MODIFYCLUSTERSETTING or VIEWCLUSTERSETTING system privileges are allowed to read crdb_internal.cluster_settings
SELECT * FROM crdb_internal.cluster_settings;

user root

query TTTT
SELECT * FROM system.privileges
----

# test VIEWCLUSTERSETTING
user testuser

statement error pq: only users with either MODIFYCLUSTERSETTING or VIEWCLUSTERSETTING system privileges are allowed to read crdb_internal.cluster_settings
SELECT * FROM crdb_internal.cluster_settings;

user root

statement ok
GRANT SYSTEM VIEWCLUSTERSETTING TO testuser

user testuser

statement ok
SELECT * FROM crdb_internal.cluster_settings;

user root

query TTTT
SELECT * FROM system.privileges
----
testuser  /global/  {VIEWCLUSTERSETTING}  {}

statement ok
REVOKE SYSTEM VIEWCLUSTERSETTING FROM testuser

user testuser

statement error pq: only users with either MODIFYCLUSTERSETTING or VIEWCLUSTERSETTING system privileges are allowed to read crdb_internal.cluster_settings
SELECT * FROM crdb_internal.cluster_settings;

user root

query TTTT
SELECT * FROM system.privileges
----

# test VIEWACTIVITY
user testuser

statement error pq: user testuser does not have VIEWACTIVITY or VIEWACTIVITYREDACTED privilege
SELECT * FROM crdb_internal.node_statement_statistics;

user root

statement ok
GRANT SYSTEM VIEWACTIVITY TO testuser

user testuser

statement ok
SELECT * FROM crdb_internal.node_statement_statistics;

user root 

query TTTT
SELECT * FROM system.privileges
----
testuser /global/ {VIEWACTIVITY} {}

statement ok
REVOKE SYSTEM VIEWACTIVITY FROM testuser

user testuser

statement error pq: user testuser does not have VIEWACTIVITY or VIEWACTIVITYREDACTED privilege
SELECT * FROM crdb_internal.node_statement_statistics;

user root

query TTTT
SELECT * FROM system.privileges
----

# test VIEWACTIVITYREDACTED
user testuser

statement error pq: user testuser does not have VIEWACTIVITY or VIEWACTIVITYREDACTED privilege
SELECT * FROM crdb_internal.node_statement_statistics;

user root

statement ok
GRANT SYSTEM VIEWACTIVITYREDACTED TO testuser

user testuser

statement ok
SELECT * FROM crdb_internal.node_statement_statistics;

user root 

query TTTT
SELECT * FROM system.privileges
----
testuser /global/ {VIEWACTIVITYREDACTED} {}

statement ok
REVOKE SYSTEM VIEWACTIVITYREDACTED FROM testuser

user testuser

statement error pq: user testuser does not have VIEWACTIVITY or VIEWACTIVITYREDACTED privilege
SELECT * FROM crdb_internal.node_statement_statistics;

user root

query TTTT
SELECT * FROM system.privileges
----