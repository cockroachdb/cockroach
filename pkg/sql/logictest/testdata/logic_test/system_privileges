user testuser

statement error pq: user testuser does not have MODIFYCLUSTERSETTING privilege on Global
SELECT * FROM crdb_internal.cluster_settings;

user root

statement ok
CREATE USER testuser2

statement ok
GRANT SYSTEM MODIFYCLUSTERSETTING TO testuser

user testuser

statement ok
SELECT * FROM crdb_internal.cluster_settings;

# Without grant option, testuser should not be able to grant to others.
statement error pq: user testuser missing WITH GRANT OPTION privilege on MODIFYCLUSTERSETTING
GRANT SYSTEM MODIFYCLUSTERSETTING TO testuser2

user root

query TTTT
SELECT * FROM system.privileges ORDER BY 1, 2
----
testuser  /global/  {MODIFYCLUSTERSETTING}  {}

statement ok
REVOKE SYSTEM MODIFYCLUSTERSETTING FROM testuser

user testuser

statement error pq: user testuser does not have MODIFYCLUSTERSETTING privilege on Global
SELECT * FROM crdb_internal.cluster_settings;

user root

query TTTT
SELECT * FROM system.privileges ORDER BY 1, 2
----

user root

statement ok
GRANT SYSTEM MODIFYCLUSTERSETTING TO testuser

statement ok
GRANT SYSTEM MODIFYCLUSTERSETTING TO testuser WITH GRANT OPTION

user testuser

statement ok
GRANT SYSTEM MODIFYCLUSTERSETTING TO root

user root

query TTTT
SELECT * FROM system.privileges ORDER BY 1, 2
----
root      /global/  {MODIFYCLUSTERSETTING}  {}
testuser  /global/  {MODIFYCLUSTERSETTING}  {MODIFYCLUSTERSETTING}

statement ok
REVOKE GRANT OPTION FOR SYSTEM MODIFYCLUSTERSETTING FROM testuser

query TTTT
SELECT * FROM system.privileges ORDER BY 1, 2
----
root      /global/  {MODIFYCLUSTERSETTING}  {}
testuser  /global/  {MODIFYCLUSTERSETTING}  {}

statement ok
REVOKE SYSTEM MODIFYCLUSTERSETTING FROM testuser

query TTTT
SELECT * FROM system.privileges ORDER BY 1, 2
----
root  /global/  {MODIFYCLUSTERSETTING}  {}

statement ok
GRANT SYSTEM MODIFYCLUSTERSETTING TO testuser WITH GRANT OPTION

query TTTT
SELECT * FROM system.privileges ORDER BY 1, 2
----
root      /global/  {MODIFYCLUSTERSETTING}  {}
testuser  /global/  {MODIFYCLUSTERSETTING}  {MODIFYCLUSTERSETTING}

statement ok
REVOKE SYSTEM MODIFYCLUSTERSETTING FROM testuser

query TTTT
SELECT * FROM system.privileges ORDER BY 1, 2
----
root  /global/  {MODIFYCLUSTERSETTING}  {}
