query TTTTTT rowsort
SHOW DATABASES
----
defaultdb  root  NULL  NULL  {}  NULL
postgres   root  NULL  NULL  {}  NULL
system     node  NULL  NULL  {}  NULL
test       root  NULL  NULL  {}  NULL

# The test expectations are different on tenants because of
# descriptor_id_sq, tenant, tenant_usage, and span_configurations.
skipif config 3node-tenant-default-configs
skipif config local-mixed-22.2-23.1
query TTTTT
SELECT schema_name, table_name, type, owner, locality FROM [SHOW TABLES FROM system] ORDER BY 2
----
public  comments                         table     node  NULL
public  database_role_settings           table     node  NULL
public  descriptor                       table     node  NULL
public  descriptor_id_seq                sequence  node  NULL
public  eventlog                         table     node  NULL
public  external_connections             table     node  NULL
public  job_info                         table     node  NULL
public  jobs                             table     node  NULL
public  join_tokens                      table     node  NULL
public  lease                            table     node  NULL
public  locations                        table     node  NULL
public  migrations                       table     node  NULL
public  namespace                        table     node  NULL
public  privileges                       table     node  NULL
public  protected_ts_meta                table     node  NULL
public  protected_ts_records             table     node  NULL
public  rangelog                         table     node  NULL
public  replication_constraint_stats     table     node  NULL
public  replication_critical_localities  table     node  NULL
public  replication_stats                table     node  NULL
public  reports_meta                     table     node  NULL
public  role_id_seq                      sequence  node  NULL
public  role_members                     table     node  NULL
public  role_options                     table     node  NULL
public  scheduled_jobs                   table     node  NULL
public  settings                         table     node  NULL
public  span_configurations              table     node  NULL
public  span_stats_buckets               table     node  NULL
public  span_stats_samples               table     node  NULL
public  span_stats_tenant_boundaries     table     node  NULL
public  span_stats_unique_keys           table     node  NULL
public  sql_instances                    table     node  NULL
public  sqlliveness                      table     node  NULL
public  statement_activity               table     node  NULL
public  statement_bundle_chunks          table     node  NULL
public  statement_diagnostics            table     node  NULL
public  statement_diagnostics_requests   table     node  NULL
public  statement_statistics             table     node  NULL
public  table_statistics                 table     node  NULL
public  task_payloads                    table     node  NULL
public  tenant_id_seq                    sequence  node  NULL
public  tenant_settings                  table     node  NULL
public  tenant_tasks                     table     node  NULL
public  tenant_usage                     table     node  NULL
public  tenants                          table     node  NULL
public  transaction_activity             table     node  NULL
public  transaction_statistics           table     node  NULL
public  ui                               table     node  NULL
public  users                            table     node  NULL
public  web_sessions                     table     node  NULL
public  zones                            table     node  NULL

onlyif config 3node-tenant-default-configs
query TTTTT
SELECT schema_name, table_name, type, owner, locality FROM [SHOW TABLES FROM system] ORDER BY 2
----
public  comments                         table     node  NULL
public  database_role_settings           table     node  NULL
public  descriptor                       table     node  NULL
public  descriptor_id_seq                sequence  node  NULL
public  eventlog                         table     node  NULL
public  external_connections             table     node  NULL
public  job_info                         table     node  NULL
public  jobs                             table     node  NULL
public  join_tokens                      table     node  NULL
public  lease                            table     node  NULL
public  locations                        table     node  NULL
public  migrations                       table     node  NULL
public  namespace                        table     node  NULL
public  privileges                       table     node  NULL
public  protected_ts_meta                table     node  NULL
public  protected_ts_records             table     node  NULL
public  rangelog                         table     node  NULL
public  replication_constraint_stats     table     node  NULL
public  replication_critical_localities  table     node  NULL
public  replication_stats                table     node  NULL
public  reports_meta                     table     node  NULL
public  role_id_seq                      sequence  node  NULL
public  role_members                     table     node  NULL
public  role_options                     table     node  NULL
public  scheduled_jobs                   table     node  NULL
public  settings                         table     node  NULL
public  span_count                       table     node  NULL
public  span_stats_buckets               table     node  NULL
public  span_stats_samples               table     node  NULL
public  span_stats_tenant_boundaries     table     node  NULL
public  span_stats_unique_keys           table     node  NULL
public  sql_instances                    table     node  NULL
public  sqlliveness                      table     node  NULL
public  statement_activity               table     node  NULL
public  statement_bundle_chunks          table     node  NULL
public  statement_diagnostics            table     node  NULL
public  statement_diagnostics_requests   table     node  NULL
public  statement_statistics             table     node  NULL
public  table_statistics                 table     node  NULL
public  transaction_activity             table     node  NULL
public  transaction_statistics           table     node  NULL
public  ui                               table     node  NULL
public  users                            table     node  NULL
public  web_sessions                     table     node  NULL
public  zones                            table     node  NULL


# The test expectations are different on tenants because of
# descriptor_id_sq, tenant, tenant_usage, and span_configurations.
skipif config 3node-tenant-default-configs
skipif config local-mixed-22.2-23.1
query I rowsort
SELECT id FROM system.descriptor ORDER BY 1
----
1
3
4
5
6
7
8
11
12
13
14
15
19
20
21
23
24
25
26
27
28
30
31
32
33
34
35
36
37
39
40
41
42
43
44
45
46
47
48
50
51
52
53
54
55
56
57
58
59
60
61
62
100
101
102
103
104
105

onlyif config 3node-tenant-default-configs
query I rowsort
SELECT id FROM system.descriptor ORDER BY 1
----
1
3
4
5
6
7
11
12
13
14
15
19
20
21
23
24
25
26
27
28
30
31
32
33
34
35
36
37
39
40
41
42
43
44
46
48
50
51
52
53
54
55
56
57
58
59
100
101
102
103
104
105

# Verify we can read ID on its own (see #58614).
query I
SELECT id FROM system.descriptor WHERE id=1
----
1

query I
SELECT id FROM (VALUES(1)) AS v(a) INNER LOOKUP JOIN system.descriptor on id=a
----
1

# Verify we can read "protobuf" columns.
query I
SELECT length(descriptor) * (id - 1) FROM system.descriptor WHERE id = 1
----
0


query TTBTTTB rowsort
SHOW COLUMNS FROM system.descriptor
----
id          INT8   false  NULL  ·  {primary}  false
descriptor  BYTES  true   NULL  ·  {primary}  false

query TTBTTTB rowsort
SHOW COLUMNS FROM system.users
----
username        STRING  false  NULL   ·  {primary,users_user_id_idx}  false
hashedPassword  BYTES   true   NULL   ·  {primary}                    false
isRole          BOOL    false  false  ·  {primary}                    false
user_id         OID     false  NULL   ·  {primary,users_user_id_idx}  false

query TTBTTTB rowsort
SHOW COLUMNS FROM system.zones
----
id      INT8   false  NULL  ·  {primary}  false
config  BYTES  true   NULL  ·  {primary}  false

skipif config local-mixed-22.2-23.1
query TTBTTTB rowsort
SHOW COLUMNS FROM system.lease
----
descID       INT8       false  NULL  ·  {primary}  false
version      INT8       false  NULL  ·  {primary}  false
nodeID       INT8       false  NULL  ·  {primary}  false
expiration   TIMESTAMP  false  NULL  ·  {primary}  false
crdb_region  BYTES      false  NULL  ·  {primary}  false

onlyif config local-mixed-22.2-23.1
query TTBTTTB rowsort
SHOW COLUMNS FROM system.lease
----
descID      INT8       false  NULL  ·  {primary}  false
version     INT8       false  NULL  ·  {primary}  false
nodeID      INT8       false  NULL  ·  {primary}  false
expiration  TIMESTAMP  false  NULL  ·  {primary}  false

query TTBTTTB rowsort
SHOW COLUMNS FROM system.eventlog
----
timestamp    TIMESTAMP  false  NULL       ·  {primary}  false
eventType    STRING     false  NULL       ·  {primary}  false
targetID     INT8       false  NULL       ·  {primary}  false
reportingID  INT8       false  NULL       ·  {primary}  false
info         STRING     true   NULL       ·  {primary}  false
uniqueID     BYTES      false  uuid_v4()  ·  {primary}  false

query TTBTTTB rowsort
SHOW COLUMNS FROM system.rangelog
----
timestamp     TIMESTAMP  false  NULL            ·  {primary}  false
rangeID       INT8       false  NULL            ·  {primary}  false
storeID       INT8       false  NULL            ·  {primary}  false
eventType     STRING     false  NULL            ·  {primary}  false
otherRangeID  INT8       true   NULL            ·  {primary}  false
info          STRING     true   NULL            ·  {primary}  false
uniqueID      INT8       false  unique_rowid()  ·  {primary}  false

query TTBTTTB rowsort
SHOW COLUMNS FROM system.ui
----
key          STRING     false  NULL  ·  {primary}  false
value        BYTES      true   NULL  ·  {primary}  false
lastUpdated  TIMESTAMP  false  NULL  ·  {primary}  false

skipif config local-mixed-22.2-23.1
query TTBTTTB rowsort
SHOW COLUMNS FROM system.jobs
----
id                 INT8       false  unique_rowid()  ·  {jobs_created_by_type_created_by_id_idx,jobs_job_type_idx,jobs_run_stats_idx,jobs_status_created_idx,primary}  false
status             STRING     false  NULL            ·  {jobs_created_by_type_created_by_id_idx,jobs_run_stats_idx,jobs_status_created_idx,primary}                    false
created            TIMESTAMP  false  now()           ·  {jobs_run_stats_idx,jobs_status_created_idx,primary}                                                           false
payload            BYTES      true   NULL            ·  {primary}                                                                                                      false
progress           BYTES      true   NULL            ·  {primary}                                                                                                      false
created_by_type    STRING     true   NULL            ·  {jobs_created_by_type_created_by_id_idx,primary}                                                               false
created_by_id      INT8       true   NULL            ·  {jobs_created_by_type_created_by_id_idx,primary}                                                               false
claim_session_id   BYTES      true   NULL            ·  {jobs_run_stats_idx,primary}                                                                                   false
claim_instance_id  INT8       true   NULL            ·  {jobs_run_stats_idx,primary}                                                                                   false
num_runs           INT8       true   NULL            ·  {jobs_run_stats_idx,primary}                                                                                   false
last_run           TIMESTAMP  true   NULL            ·  {jobs_run_stats_idx,primary}                                                                                   false
job_type           STRING     true   NULL            ·  {jobs_job_type_idx,primary}                                                                                    false

onlyif config local-mixed-22.2-23.1
query TTBTTTB rowsort
SHOW COLUMNS FROM system.jobs
----
id                 INT8       false  unique_rowid()  ·  {jobs_created_by_type_created_by_id_idx,jobs_run_stats_idx,jobs_status_created_idx,primary}  false
status             STRING     false  NULL            ·  {jobs_created_by_type_created_by_id_idx,jobs_run_stats_idx,jobs_status_created_idx,primary}  false
created            TIMESTAMP  false  now()           ·  {jobs_run_stats_idx,jobs_status_created_idx,primary}                                         false
payload            BYTES      false  NULL            ·  {primary}                                                                                    false
progress           BYTES      true   NULL            ·  {primary}                                                                                    false
created_by_type    STRING     true   NULL            ·  {jobs_created_by_type_created_by_id_idx,primary}                                             false
created_by_id      INT8       true   NULL            ·  {jobs_created_by_type_created_by_id_idx,primary}                                             false
claim_session_id   BYTES      true   NULL            ·  {jobs_run_stats_idx,primary}                                                                 false
claim_instance_id  INT8       true   NULL            ·  {jobs_run_stats_idx,primary}                                                                 false
num_runs           INT8       true   NULL            ·  {jobs_run_stats_idx,primary}                                                                 false
last_run           TIMESTAMP  true   NULL            ·  {jobs_run_stats_idx,primary}                                                                 false

query TTBTTTB rowsort
SHOW COLUMNS FROM system.settings
----
name         STRING     false  NULL   ·  {primary}  false
value        STRING     false  NULL   ·  {primary}  false
lastUpdated  TIMESTAMP  false  now()  ·  {primary}  false
valueType    STRING     true   NULL   ·  {primary}  false

skipif config local-mixed-22.2-23.1
query TTBTTTB rowsort
SHOW COLUMNS FROM system.role_members
----
role       STRING  false  NULL  ·  {primary,role_members_member_id_idx,role_members_member_idx,role_members_role_id_idx,role_members_role_id_member_id_key,role_members_role_idx}  false
member     STRING  false  NULL  ·  {primary,role_members_member_id_idx,role_members_member_idx,role_members_role_id_idx,role_members_role_id_member_id_key,role_members_role_idx}  false
isAdmin    BOOL    false  NULL  ·  {primary}                                                                                                                                       false
role_id    OID     false  NULL  ·  {primary,role_members_role_id_idx,role_members_role_id_member_id_key}                                                                           false
member_id  OID     false  NULL  ·  {primary,role_members_member_id_idx,role_members_role_id_member_id_key}                                                                         false

onlyif config local-mixed-22.2-23.1
query TTBTTTB rowsort
SHOW COLUMNS FROM system.role_members
----
role     STRING  false  NULL  ·  {primary,role_members_member_idx,role_members_role_idx}  false
member   STRING  false  NULL  ·  {primary,role_members_member_idx,role_members_role_idx}  false
isAdmin  BOOL    false  NULL  ·  {primary}                                                false

# Verify default privileges on system tables.
query TTTB rowsort
SHOW GRANTS ON DATABASE system
----
system  admin  CONNECT  true
system  root   CONNECT  true

# The test expectations are different on tenants because of
# descriptor_id_sq, tenant, tenant_usage, and span_configurations.
skipif config 3node-tenant-default-configs
skipif config local-mixed-22.2-23.1
query TTTTTB rowsort
SHOW GRANTS ON system.*
----
system  public  comments                         admin   DELETE  true
system  public  comments                         admin   INSERT  true
system  public  comments                         admin   SELECT  true
system  public  comments                         admin   UPDATE  true
system  public  comments                         public  SELECT  false
system  public  comments                         root    DELETE  true
system  public  comments                         root    INSERT  true
system  public  comments                         root    SELECT  true
system  public  comments                         root    UPDATE  true
system  public  database_role_settings           admin   DELETE  true
system  public  database_role_settings           admin   INSERT  true
system  public  database_role_settings           admin   SELECT  true
system  public  database_role_settings           admin   UPDATE  true
system  public  database_role_settings           root    DELETE  true
system  public  database_role_settings           root    INSERT  true
system  public  database_role_settings           root    SELECT  true
system  public  database_role_settings           root    UPDATE  true
system  public  descriptor                       admin   SELECT  true
system  public  descriptor                       root    SELECT  true
system  public  descriptor_id_seq                admin   SELECT  true
system  public  descriptor_id_seq                root    SELECT  true
system  public  eventlog                         admin   DELETE  true
system  public  eventlog                         admin   INSERT  true
system  public  eventlog                         admin   SELECT  true
system  public  eventlog                         admin   UPDATE  true
system  public  eventlog                         root    DELETE  true
system  public  eventlog                         root    INSERT  true
system  public  eventlog                         root    SELECT  true
system  public  eventlog                         root    UPDATE  true
system  public  external_connections             admin   DELETE  true
system  public  external_connections             admin   INSERT  true
system  public  external_connections             admin   SELECT  true
system  public  external_connections             admin   UPDATE  true
system  public  external_connections             root    DELETE  true
system  public  external_connections             root    INSERT  true
system  public  external_connections             root    SELECT  true
system  public  external_connections             root    UPDATE  true
system  public  job_info                         admin   DELETE  true
system  public  job_info                         admin   INSERT  true
system  public  job_info                         admin   SELECT  true
system  public  job_info                         admin   UPDATE  true
system  public  job_info                         root    DELETE  true
system  public  job_info                         root    INSERT  true
system  public  job_info                         root    SELECT  true
system  public  job_info                         root    UPDATE  true
system  public  jobs                             admin   DELETE  true
system  public  jobs                             admin   INSERT  true
system  public  jobs                             admin   SELECT  true
system  public  jobs                             admin   UPDATE  true
system  public  jobs                             root    DELETE  true
system  public  jobs                             root    INSERT  true
system  public  jobs                             root    SELECT  true
system  public  jobs                             root    UPDATE  true
system  public  join_tokens                      admin   DELETE  true
system  public  join_tokens                      admin   INSERT  true
system  public  join_tokens                      admin   SELECT  true
system  public  join_tokens                      admin   UPDATE  true
system  public  join_tokens                      root    DELETE  true
system  public  join_tokens                      root    INSERT  true
system  public  join_tokens                      root    SELECT  true
system  public  join_tokens                      root    UPDATE  true
system  public  lease                            admin   DELETE  true
system  public  lease                            admin   INSERT  true
system  public  lease                            admin   SELECT  true
system  public  lease                            admin   UPDATE  true
system  public  lease                            root    DELETE  true
system  public  lease                            root    INSERT  true
system  public  lease                            root    SELECT  true
system  public  lease                            root    UPDATE  true
system  public  locations                        admin   DELETE  true
system  public  locations                        admin   INSERT  true
system  public  locations                        admin   SELECT  true
system  public  locations                        admin   UPDATE  true
system  public  locations                        root    DELETE  true
system  public  locations                        root    INSERT  true
system  public  locations                        root    SELECT  true
system  public  locations                        root    UPDATE  true
system  public  migrations                       admin   DELETE  true
system  public  migrations                       admin   INSERT  true
system  public  migrations                       admin   SELECT  true
system  public  migrations                       admin   UPDATE  true
system  public  migrations                       root    DELETE  true
system  public  migrations                       root    INSERT  true
system  public  migrations                       root    SELECT  true
system  public  migrations                       root    UPDATE  true
system  public  namespace                        admin   SELECT  true
system  public  namespace                        root    SELECT  true
system  public  privileges                       admin   DELETE  true
system  public  privileges                       admin   INSERT  true
system  public  privileges                       admin   SELECT  true
system  public  privileges                       admin   UPDATE  true
system  public  privileges                       root    DELETE  true
system  public  privileges                       root    INSERT  true
system  public  privileges                       root    SELECT  true
system  public  privileges                       root    UPDATE  true
system  public  protected_ts_meta                admin   SELECT  true
system  public  protected_ts_meta                root    SELECT  true
system  public  protected_ts_records             admin   SELECT  true
system  public  protected_ts_records             root    SELECT  true
system  public  rangelog                         admin   DELETE  true
system  public  rangelog                         admin   INSERT  true
system  public  rangelog                         admin   SELECT  true
system  public  rangelog                         admin   UPDATE  true
system  public  rangelog                         root    DELETE  true
system  public  rangelog                         root    INSERT  true
system  public  rangelog                         root    SELECT  true
system  public  rangelog                         root    UPDATE  true
system  public  replication_constraint_stats     admin   DELETE  true
system  public  replication_constraint_stats     admin   INSERT  true
system  public  replication_constraint_stats     admin   SELECT  true
system  public  replication_constraint_stats     admin   UPDATE  true
system  public  replication_constraint_stats     root    DELETE  true
system  public  replication_constraint_stats     root    INSERT  true
system  public  replication_constraint_stats     root    SELECT  true
system  public  replication_constraint_stats     root    UPDATE  true
system  public  replication_critical_localities  admin   DELETE  true
system  public  replication_critical_localities  admin   INSERT  true
system  public  replication_critical_localities  admin   SELECT  true
system  public  replication_critical_localities  admin   UPDATE  true
system  public  replication_critical_localities  root    DELETE  true
system  public  replication_critical_localities  root    INSERT  true
system  public  replication_critical_localities  root    SELECT  true
system  public  replication_critical_localities  root    UPDATE  true
system  public  replication_stats                admin   DELETE  true
system  public  replication_stats                admin   INSERT  true
system  public  replication_stats                admin   SELECT  true
system  public  replication_stats                admin   UPDATE  true
system  public  replication_stats                root    DELETE  true
system  public  replication_stats                root    INSERT  true
system  public  replication_stats                root    SELECT  true
system  public  replication_stats                root    UPDATE  true
system  public  reports_meta                     admin   DELETE  true
system  public  reports_meta                     admin   INSERT  true
system  public  reports_meta                     admin   SELECT  true
system  public  reports_meta                     admin   UPDATE  true
system  public  reports_meta                     root    DELETE  true
system  public  reports_meta                     root    INSERT  true
system  public  reports_meta                     root    SELECT  true
system  public  reports_meta                     root    UPDATE  true
system  public  role_id_seq                      admin   SELECT  true
system  public  role_id_seq                      admin   UPDATE  true
system  public  role_id_seq                      admin   USAGE   true
system  public  role_id_seq                      root    SELECT  true
system  public  role_id_seq                      root    UPDATE  true
system  public  role_id_seq                      root    USAGE   true
system  public  role_members                     admin   DELETE  true
system  public  role_members                     admin   INSERT  true
system  public  role_members                     admin   SELECT  true
system  public  role_members                     admin   UPDATE  true
system  public  role_members                     root    DELETE  true
system  public  role_members                     root    INSERT  true
system  public  role_members                     root    SELECT  true
system  public  role_members                     root    UPDATE  true
system  public  role_options                     admin   DELETE  true
system  public  role_options                     admin   INSERT  true
system  public  role_options                     admin   SELECT  true
system  public  role_options                     admin   UPDATE  true
system  public  role_options                     root    DELETE  true
system  public  role_options                     root    INSERT  true
system  public  role_options                     root    SELECT  true
system  public  role_options                     root    UPDATE  true
system  public  scheduled_jobs                   admin   DELETE  true
system  public  scheduled_jobs                   admin   INSERT  true
system  public  scheduled_jobs                   admin   SELECT  true
system  public  scheduled_jobs                   admin   UPDATE  true
system  public  scheduled_jobs                   root    DELETE  true
system  public  scheduled_jobs                   root    INSERT  true
system  public  scheduled_jobs                   root    SELECT  true
system  public  scheduled_jobs                   root    UPDATE  true
system  public  settings                         admin   DELETE  true
system  public  settings                         admin   INSERT  true
system  public  settings                         admin   SELECT  true
system  public  settings                         admin   UPDATE  true
system  public  settings                         root    DELETE  true
system  public  settings                         root    INSERT  true
system  public  settings                         root    SELECT  true
system  public  settings                         root    UPDATE  true
system  public  span_configurations              admin   DELETE  true
system  public  span_configurations              admin   INSERT  true
system  public  span_configurations              admin   SELECT  true
system  public  span_configurations              admin   UPDATE  true
system  public  span_configurations              root    DELETE  true
system  public  span_configurations              root    INSERT  true
system  public  span_configurations              root    SELECT  true
system  public  span_configurations              root    UPDATE  true
system  public  span_stats_buckets               admin   DELETE  true
system  public  span_stats_buckets               admin   INSERT  true
system  public  span_stats_buckets               admin   SELECT  true
system  public  span_stats_buckets               admin   UPDATE  true
system  public  span_stats_buckets               root    DELETE  true
system  public  span_stats_buckets               root    INSERT  true
system  public  span_stats_buckets               root    SELECT  true
system  public  span_stats_buckets               root    UPDATE  true
system  public  span_stats_samples               admin   DELETE  true
system  public  span_stats_samples               admin   INSERT  true
system  public  span_stats_samples               admin   SELECT  true
system  public  span_stats_samples               admin   UPDATE  true
system  public  span_stats_samples               root    DELETE  true
system  public  span_stats_samples               root    INSERT  true
system  public  span_stats_samples               root    SELECT  true
system  public  span_stats_samples               root    UPDATE  true
system  public  span_stats_tenant_boundaries     admin   DELETE  true
system  public  span_stats_tenant_boundaries     admin   INSERT  true
system  public  span_stats_tenant_boundaries     admin   SELECT  true
system  public  span_stats_tenant_boundaries     admin   UPDATE  true
system  public  span_stats_tenant_boundaries     root    DELETE  true
system  public  span_stats_tenant_boundaries     root    INSERT  true
system  public  span_stats_tenant_boundaries     root    SELECT  true
system  public  span_stats_tenant_boundaries     root    UPDATE  true
system  public  span_stats_unique_keys           admin   DELETE  true
system  public  span_stats_unique_keys           admin   INSERT  true
system  public  span_stats_unique_keys           admin   SELECT  true
system  public  span_stats_unique_keys           admin   UPDATE  true
system  public  span_stats_unique_keys           root    DELETE  true
system  public  span_stats_unique_keys           root    INSERT  true
system  public  span_stats_unique_keys           root    SELECT  true
system  public  span_stats_unique_keys           root    UPDATE  true
system  public  sql_instances                    admin   DELETE  true
system  public  sql_instances                    admin   INSERT  true
system  public  sql_instances                    admin   SELECT  true
system  public  sql_instances                    admin   UPDATE  true
system  public  sql_instances                    root    DELETE  true
system  public  sql_instances                    root    INSERT  true
system  public  sql_instances                    root    SELECT  true
system  public  sql_instances                    root    UPDATE  true
system  public  sqlliveness                      admin   DELETE  true
system  public  sqlliveness                      admin   INSERT  true
system  public  sqlliveness                      admin   SELECT  true
system  public  sqlliveness                      admin   UPDATE  true
system  public  sqlliveness                      root    DELETE  true
system  public  sqlliveness                      root    INSERT  true
system  public  sqlliveness                      root    SELECT  true
system  public  sqlliveness                      root    UPDATE  true
system  public  statement_activity               admin   SELECT  true
system  public  statement_activity               root    SELECT  true
system  public  statement_bundle_chunks          admin   DELETE  true
system  public  statement_bundle_chunks          admin   INSERT  true
system  public  statement_bundle_chunks          admin   SELECT  true
system  public  statement_bundle_chunks          admin   UPDATE  true
system  public  statement_bundle_chunks          root    DELETE  true
system  public  statement_bundle_chunks          root    INSERT  true
system  public  statement_bundle_chunks          root    SELECT  true
system  public  statement_bundle_chunks          root    UPDATE  true
system  public  statement_diagnostics            admin   DELETE  true
system  public  statement_diagnostics            admin   INSERT  true
system  public  statement_diagnostics            admin   SELECT  true
system  public  statement_diagnostics            admin   UPDATE  true
system  public  statement_diagnostics            root    DELETE  true
system  public  statement_diagnostics            root    INSERT  true
system  public  statement_diagnostics            root    SELECT  true
system  public  statement_diagnostics            root    UPDATE  true
system  public  statement_diagnostics_requests   admin   DELETE  true
system  public  statement_diagnostics_requests   admin   INSERT  true
system  public  statement_diagnostics_requests   admin   SELECT  true
system  public  statement_diagnostics_requests   admin   UPDATE  true
system  public  statement_diagnostics_requests   root    DELETE  true
system  public  statement_diagnostics_requests   root    INSERT  true
system  public  statement_diagnostics_requests   root    SELECT  true
system  public  statement_diagnostics_requests   root    UPDATE  true
system  public  statement_statistics             admin   SELECT  true
system  public  statement_statistics             root    SELECT  true
system  public  table_statistics                 admin   DELETE  true
system  public  table_statistics                 admin   INSERT  true
system  public  table_statistics                 admin   SELECT  true
system  public  table_statistics                 admin   UPDATE  true
system  public  table_statistics                 root    DELETE  true
system  public  table_statistics                 root    INSERT  true
system  public  table_statistics                 root    SELECT  true
system  public  table_statistics                 root    UPDATE  true
system  public  task_payloads                    admin   DELETE  true
system  public  task_payloads                    admin   INSERT  true
system  public  task_payloads                    admin   SELECT  true
system  public  task_payloads                    admin   UPDATE  true
system  public  task_payloads                    root    DELETE  true
system  public  task_payloads                    root    INSERT  true
system  public  task_payloads                    root    SELECT  true
system  public  task_payloads                    root    UPDATE  true
system  public  tenant_id_seq                    admin   SELECT  true
system  public  tenant_id_seq                    root    SELECT  true
system  public  tenant_settings                  admin   DELETE  true
system  public  tenant_settings                  admin   INSERT  true
system  public  tenant_settings                  admin   SELECT  true
system  public  tenant_settings                  admin   UPDATE  true
system  public  tenant_settings                  root    DELETE  true
system  public  tenant_settings                  root    INSERT  true
system  public  tenant_settings                  root    SELECT  true
system  public  tenant_settings                  root    UPDATE  true
system  public  tenant_tasks                     admin   DELETE  true
system  public  tenant_tasks                     admin   INSERT  true
system  public  tenant_tasks                     admin   SELECT  true
system  public  tenant_tasks                     admin   UPDATE  true
system  public  tenant_tasks                     root    DELETE  true
system  public  tenant_tasks                     root    INSERT  true
system  public  tenant_tasks                     root    SELECT  true
system  public  tenant_tasks                     root    UPDATE  true
system  public  tenant_usage                     admin   DELETE  true
system  public  tenant_usage                     admin   INSERT  true
system  public  tenant_usage                     admin   SELECT  true
system  public  tenant_usage                     admin   UPDATE  true
system  public  tenant_usage                     root    DELETE  true
system  public  tenant_usage                     root    INSERT  true
system  public  tenant_usage                     root    SELECT  true
system  public  tenant_usage                     root    UPDATE  true
system  public  tenants                          admin   SELECT  true
system  public  tenants                          root    SELECT  true
system  public  transaction_activity             admin   SELECT  true
system  public  transaction_activity             root    SELECT  true
system  public  transaction_statistics           admin   SELECT  true
system  public  transaction_statistics           root    SELECT  true
system  public  ui                               admin   DELETE  true
system  public  ui                               admin   INSERT  true
system  public  ui                               admin   SELECT  true
system  public  ui                               admin   UPDATE  true
system  public  ui                               root    DELETE  true
system  public  ui                               root    INSERT  true
system  public  ui                               root    SELECT  true
system  public  ui                               root    UPDATE  true
system  public  users                            admin   DELETE  true
system  public  users                            admin   INSERT  true
system  public  users                            admin   SELECT  true
system  public  users                            admin   UPDATE  true
system  public  users                            root    DELETE  true
system  public  users                            root    INSERT  true
system  public  users                            root    SELECT  true
system  public  users                            root    UPDATE  true
system  public  web_sessions                     admin   DELETE  true
system  public  web_sessions                     admin   INSERT  true
system  public  web_sessions                     admin   SELECT  true
system  public  web_sessions                     admin   UPDATE  true
system  public  web_sessions                     root    DELETE  true
system  public  web_sessions                     root    INSERT  true
system  public  web_sessions                     root    SELECT  true
system  public  web_sessions                     root    UPDATE  true
system  public  zones                            admin   DELETE  true
system  public  zones                            admin   INSERT  true
system  public  zones                            admin   SELECT  true
system  public  zones                            admin   UPDATE  true
system  public  zones                            root    DELETE  true
system  public  zones                            root    INSERT  true
system  public  zones                            root    SELECT  true
system  public  zones                            root    UPDATE  true

onlyif config 3node-tenant-default-configs
query TTTTTB rowsort
SHOW GRANTS ON system.*
----
system  public  comments                         admin   DELETE  true
system  public  comments                         admin   INSERT  true
system  public  comments                         admin   SELECT  true
system  public  comments                         admin   UPDATE  true
system  public  comments                         public  SELECT  false
system  public  comments                         root    DELETE  true
system  public  comments                         root    INSERT  true
system  public  comments                         root    SELECT  true
system  public  comments                         root    UPDATE  true
system  public  database_role_settings           admin   DELETE  true
system  public  database_role_settings           admin   INSERT  true
system  public  database_role_settings           admin   SELECT  true
system  public  database_role_settings           admin   UPDATE  true
system  public  database_role_settings           root    DELETE  true
system  public  database_role_settings           root    INSERT  true
system  public  database_role_settings           root    SELECT  true
system  public  database_role_settings           root    UPDATE  true
system  public  descriptor                       admin   SELECT  true
system  public  descriptor                       root    SELECT  true
system  public  descriptor_id_seq                admin   SELECT  true
system  public  descriptor_id_seq                root    SELECT  true
system  public  eventlog                         admin   DELETE  true
system  public  eventlog                         admin   INSERT  true
system  public  eventlog                         admin   SELECT  true
system  public  eventlog                         admin   UPDATE  true
system  public  eventlog                         root    DELETE  true
system  public  eventlog                         root    INSERT  true
system  public  eventlog                         root    SELECT  true
system  public  eventlog                         root    UPDATE  true
system  public  external_connections             admin   DELETE  true
system  public  external_connections             admin   INSERT  true
system  public  external_connections             admin   SELECT  true
system  public  external_connections             admin   UPDATE  true
system  public  external_connections             root    DELETE  true
system  public  external_connections             root    INSERT  true
system  public  external_connections             root    SELECT  true
system  public  external_connections             root    UPDATE  true
system  public  job_info                         admin   DELETE  true
system  public  job_info                         admin   INSERT  true
system  public  job_info                         admin   SELECT  true
system  public  job_info                         admin   UPDATE  true
system  public  job_info                         root    DELETE  true
system  public  job_info                         root    INSERT  true
system  public  job_info                         root    SELECT  true
system  public  job_info                         root    UPDATE  true
system  public  jobs                             admin   DELETE  true
system  public  jobs                             admin   INSERT  true
system  public  jobs                             admin   SELECT  true
system  public  jobs                             admin   UPDATE  true
system  public  jobs                             root    DELETE  true
system  public  jobs                             root    INSERT  true
system  public  jobs                             root    SELECT  true
system  public  jobs                             root    UPDATE  true
system  public  join_tokens                      admin   DELETE  true
system  public  join_tokens                      admin   INSERT  true
system  public  join_tokens                      admin   SELECT  true
system  public  join_tokens                      admin   UPDATE  true
system  public  join_tokens                      root    DELETE  true
system  public  join_tokens                      root    INSERT  true
system  public  join_tokens                      root    SELECT  true
system  public  join_tokens                      root    UPDATE  true
system  public  lease                            admin   DELETE  true
system  public  lease                            admin   INSERT  true
system  public  lease                            admin   SELECT  true
system  public  lease                            admin   UPDATE  true
system  public  lease                            root    DELETE  true
system  public  lease                            root    INSERT  true
system  public  lease                            root    SELECT  true
system  public  lease                            root    UPDATE  true
system  public  locations                        admin   DELETE  true
system  public  locations                        admin   INSERT  true
system  public  locations                        admin   SELECT  true
system  public  locations                        admin   UPDATE  true
system  public  locations                        root    DELETE  true
system  public  locations                        root    INSERT  true
system  public  locations                        root    SELECT  true
system  public  locations                        root    UPDATE  true
system  public  migrations                       admin   DELETE  true
system  public  migrations                       admin   INSERT  true
system  public  migrations                       admin   SELECT  true
system  public  migrations                       admin   UPDATE  true
system  public  migrations                       root    DELETE  true
system  public  migrations                       root    INSERT  true
system  public  migrations                       root    SELECT  true
system  public  migrations                       root    UPDATE  true
system  public  namespace                        admin   SELECT  true
system  public  namespace                        root    SELECT  true
system  public  privileges                       admin   DELETE  true
system  public  privileges                       admin   INSERT  true
system  public  privileges                       admin   SELECT  true
system  public  privileges                       admin   UPDATE  true
system  public  privileges                       root    DELETE  true
system  public  privileges                       root    INSERT  true
system  public  privileges                       root    SELECT  true
system  public  privileges                       root    UPDATE  true
system  public  protected_ts_meta                admin   SELECT  true
system  public  protected_ts_meta                root    SELECT  true
system  public  protected_ts_records             admin   SELECT  true
system  public  protected_ts_records             root    SELECT  true
system  public  rangelog                         admin   DELETE  true
system  public  rangelog                         admin   INSERT  true
system  public  rangelog                         admin   SELECT  true
system  public  rangelog                         admin   UPDATE  true
system  public  rangelog                         root    DELETE  true
system  public  rangelog                         root    INSERT  true
system  public  rangelog                         root    SELECT  true
system  public  rangelog                         root    UPDATE  true
system  public  replication_constraint_stats     admin   DELETE  true
system  public  replication_constraint_stats     admin   INSERT  true
system  public  replication_constraint_stats     admin   SELECT  true
system  public  replication_constraint_stats     admin   UPDATE  true
system  public  replication_constraint_stats     root    DELETE  true
system  public  replication_constraint_stats     root    INSERT  true
system  public  replication_constraint_stats     root    SELECT  true
system  public  replication_constraint_stats     root    UPDATE  true
system  public  replication_critical_localities  admin   DELETE  true
system  public  replication_critical_localities  admin   INSERT  true
system  public  replication_critical_localities  admin   SELECT  true
system  public  replication_critical_localities  admin   UPDATE  true
system  public  replication_critical_localities  root    DELETE  true
system  public  replication_critical_localities  root    INSERT  true
system  public  replication_critical_localities  root    SELECT  true
system  public  replication_critical_localities  root    UPDATE  true
system  public  replication_stats                admin   DELETE  true
system  public  replication_stats                admin   INSERT  true
system  public  replication_stats                admin   SELECT  true
system  public  replication_stats                admin   UPDATE  true
system  public  replication_stats                root    DELETE  true
system  public  replication_stats                root    INSERT  true
system  public  replication_stats                root    SELECT  true
system  public  replication_stats                root    UPDATE  true
system  public  reports_meta                     admin   DELETE  true
system  public  reports_meta                     admin   INSERT  true
system  public  reports_meta                     admin   SELECT  true
system  public  reports_meta                     admin   UPDATE  true
system  public  reports_meta                     root    DELETE  true
system  public  reports_meta                     root    INSERT  true
system  public  reports_meta                     root    SELECT  true
system  public  reports_meta                     root    UPDATE  true
system  public  role_id_seq                      admin   SELECT  true
system  public  role_id_seq                      admin   UPDATE  true
system  public  role_id_seq                      admin   USAGE   true
system  public  role_id_seq                      root    SELECT  true
system  public  role_id_seq                      root    UPDATE  true
system  public  role_id_seq                      root    USAGE   true
system  public  role_members                     admin   DELETE  true
system  public  role_members                     admin   INSERT  true
system  public  role_members                     admin   SELECT  true
system  public  role_members                     admin   UPDATE  true
system  public  role_members                     root    DELETE  true
system  public  role_members                     root    INSERT  true
system  public  role_members                     root    SELECT  true
system  public  role_members                     root    UPDATE  true
system  public  role_options                     admin   DELETE  true
system  public  role_options                     admin   INSERT  true
system  public  role_options                     admin   SELECT  true
system  public  role_options                     admin   UPDATE  true
system  public  role_options                     root    DELETE  true
system  public  role_options                     root    INSERT  true
system  public  role_options                     root    SELECT  true
system  public  role_options                     root    UPDATE  true
system  public  scheduled_jobs                   admin   DELETE  true
system  public  scheduled_jobs                   admin   INSERT  true
system  public  scheduled_jobs                   admin   SELECT  true
system  public  scheduled_jobs                   admin   UPDATE  true
system  public  scheduled_jobs                   root    DELETE  true
system  public  scheduled_jobs                   root    INSERT  true
system  public  scheduled_jobs                   root    SELECT  true
system  public  scheduled_jobs                   root    UPDATE  true
system  public  settings                         admin   DELETE  true
system  public  settings                         admin   INSERT  true
system  public  settings                         admin   SELECT  true
system  public  settings                         admin   UPDATE  true
system  public  settings                         root    DELETE  true
system  public  settings                         root    INSERT  true
system  public  settings                         root    SELECT  true
system  public  settings                         root    UPDATE  true
system  public  span_count                       admin   DELETE  true
system  public  span_count                       admin   INSERT  true
system  public  span_count                       admin   SELECT  true
system  public  span_count                       admin   UPDATE  true
system  public  span_count                       root    DELETE  true
system  public  span_count                       root    INSERT  true
system  public  span_count                       root    SELECT  true
system  public  span_count                       root    UPDATE  true
system  public  span_stats_buckets               admin   DELETE  true
system  public  span_stats_buckets               admin   INSERT  true
system  public  span_stats_buckets               admin   SELECT  true
system  public  span_stats_buckets               admin   UPDATE  true
system  public  span_stats_buckets               root    DELETE  true
system  public  span_stats_buckets               root    INSERT  true
system  public  span_stats_buckets               root    SELECT  true
system  public  span_stats_buckets               root    UPDATE  true
system  public  span_stats_samples               admin   DELETE  true
system  public  span_stats_samples               admin   INSERT  true
system  public  span_stats_samples               admin   SELECT  true
system  public  span_stats_samples               admin   UPDATE  true
system  public  span_stats_samples               root    DELETE  true
system  public  span_stats_samples               root    INSERT  true
system  public  span_stats_samples               root    SELECT  true
system  public  span_stats_samples               root    UPDATE  true
system  public  span_stats_tenant_boundaries     admin   DELETE  true
system  public  span_stats_tenant_boundaries     admin   INSERT  true
system  public  span_stats_tenant_boundaries     admin   SELECT  true
system  public  span_stats_tenant_boundaries     admin   UPDATE  true
system  public  span_stats_tenant_boundaries     root    DELETE  true
system  public  span_stats_tenant_boundaries     root    INSERT  true
system  public  span_stats_tenant_boundaries     root    SELECT  true
system  public  span_stats_tenant_boundaries     root    UPDATE  true
system  public  span_stats_unique_keys           admin   DELETE  true
system  public  span_stats_unique_keys           admin   INSERT  true
system  public  span_stats_unique_keys           admin   SELECT  true
system  public  span_stats_unique_keys           admin   UPDATE  true
system  public  span_stats_unique_keys           root    DELETE  true
system  public  span_stats_unique_keys           root    INSERT  true
system  public  span_stats_unique_keys           root    SELECT  true
system  public  span_stats_unique_keys           root    UPDATE  true
system  public  sql_instances                    admin   DELETE  true
system  public  sql_instances                    admin   INSERT  true
system  public  sql_instances                    admin   SELECT  true
system  public  sql_instances                    admin   UPDATE  true
system  public  sql_instances                    root    DELETE  true
system  public  sql_instances                    root    INSERT  true
system  public  sql_instances                    root    SELECT  true
system  public  sql_instances                    root    UPDATE  true
system  public  sqlliveness                      admin   DELETE  true
system  public  sqlliveness                      admin   INSERT  true
system  public  sqlliveness                      admin   SELECT  true
system  public  sqlliveness                      admin   UPDATE  true
system  public  sqlliveness                      root    DELETE  true
system  public  sqlliveness                      root    INSERT  true
system  public  sqlliveness                      root    SELECT  true
system  public  sqlliveness                      root    UPDATE  true
system  public  statement_activity               admin   SELECT  true
system  public  statement_activity               root    SELECT  true
system  public  statement_bundle_chunks          admin   DELETE  true
system  public  statement_bundle_chunks          admin   INSERT  true
system  public  statement_bundle_chunks          admin   SELECT  true
system  public  statement_bundle_chunks          admin   UPDATE  true
system  public  statement_bundle_chunks          root    DELETE  true
system  public  statement_bundle_chunks          root    INSERT  true
system  public  statement_bundle_chunks          root    SELECT  true
system  public  statement_bundle_chunks          root    UPDATE  true
system  public  statement_diagnostics            admin   DELETE  true
system  public  statement_diagnostics            admin   INSERT  true
system  public  statement_diagnostics            admin   SELECT  true
system  public  statement_diagnostics            admin   UPDATE  true
system  public  statement_diagnostics            root    DELETE  true
system  public  statement_diagnostics            root    INSERT  true
system  public  statement_diagnostics            root    SELECT  true
system  public  statement_diagnostics            root    UPDATE  true
system  public  statement_diagnostics_requests   admin   DELETE  true
system  public  statement_diagnostics_requests   admin   INSERT  true
system  public  statement_diagnostics_requests   admin   SELECT  true
system  public  statement_diagnostics_requests   admin   UPDATE  true
system  public  statement_diagnostics_requests   root    DELETE  true
system  public  statement_diagnostics_requests   root    INSERT  true
system  public  statement_diagnostics_requests   root    SELECT  true
system  public  statement_diagnostics_requests   root    UPDATE  true
system  public  statement_statistics             admin   SELECT  true
system  public  statement_statistics             root    SELECT  true
system  public  table_statistics                 admin   DELETE  true
system  public  table_statistics                 admin   INSERT  true
system  public  table_statistics                 admin   SELECT  true
system  public  table_statistics                 admin   UPDATE  true
system  public  table_statistics                 root    DELETE  true
system  public  table_statistics                 root    INSERT  true
system  public  table_statistics                 root    SELECT  true
system  public  table_statistics                 root    UPDATE  true
system  public  transaction_activity             admin   SELECT  true
system  public  transaction_activity             root    SELECT  true
system  public  transaction_statistics           admin   SELECT  true
system  public  transaction_statistics           root    SELECT  true
system  public  ui                               admin   DELETE  true
system  public  ui                               admin   INSERT  true
system  public  ui                               admin   SELECT  true
system  public  ui                               admin   UPDATE  true
system  public  ui                               root    DELETE  true
system  public  ui                               root    INSERT  true
system  public  ui                               root    SELECT  true
system  public  ui                               root    UPDATE  true
system  public  users                            admin   DELETE  true
system  public  users                            admin   INSERT  true
system  public  users                            admin   SELECT  true
system  public  users                            admin   UPDATE  true
system  public  users                            root    DELETE  true
system  public  users                            root    INSERT  true
system  public  users                            root    SELECT  true
system  public  users                            root    UPDATE  true
system  public  web_sessions                     admin   DELETE  true
system  public  web_sessions                     admin   INSERT  true
system  public  web_sessions                     admin   SELECT  true
system  public  web_sessions                     admin   UPDATE  true
system  public  web_sessions                     root    DELETE  true
system  public  web_sessions                     root    INSERT  true
system  public  web_sessions                     root    SELECT  true
system  public  web_sessions                     root    UPDATE  true
system  public  zones                            admin   DELETE  true
system  public  zones                            admin   INSERT  true
system  public  zones                            admin   SELECT  true
system  public  zones                            admin   UPDATE  true
system  public  zones                            root    DELETE  true
system  public  zones                            root    INSERT  true
system  public  zones                            root    SELECT  true
system  public  zones                            root    UPDATE  true


statement error user root does not have DROP privilege on database system
ALTER DATABASE system RENAME TO not_system

statement error user root does not have DROP privilege on database system
DROP DATABASE system

statement error user root does not have DROP privilege on relation users
DROP TABLE system.users

statement error pq: cannot GRANT on system object
GRANT ALL ON DATABASE system TO testuser

statement error pq: cannot GRANT on system object
GRANT CREATE ON DATABASE system TO testuser

statement error pq: cannot GRANT on system object
GRANT CREATE ON DATABASE system TO testuser

statement error pq: cannot GRANT on system object
GRANT ALL ON system.namespace TO testuser

statement error pq: cannot GRANT on system object
GRANT SELECT, INSERT ON system.namespace TO testuser

statement error pq: cannot GRANT on system object
GRANT SELECT ON system.namespace TO testuser

statement error pq: cannot GRANT on system object
GRANT SELECT ON system.descriptor TO testuser

# Superusers must have exactly the allowed privileges.
statement error pq: cannot GRANT on system object
GRANT ALL ON DATABASE system TO root

statement error pq: cannot GRANT on system object
GRANT CREATE ON DATABASE system TO root

statement error pq: cannot GRANT on system object
GRANT ALL ON system.namespace TO root

statement error pq: cannot GRANT on system object
GRANT DELETE, INSERT ON system.descriptor TO root

statement error pq: cannot GRANT on system object
GRANT ALL ON system.descriptor TO root

statement error pq: cannot REVOKE on system object
REVOKE CREATE ON DATABASE system FROM root

statement error pq: cannot REVOKE on system object
REVOKE CREATE ON system.namespace FROM root

statement error pq: cannot REVOKE on system object
REVOKE ALL ON system.namespace FROM root

statement error pq: cannot REVOKE on system object
REVOKE SELECT ON system.namespace FROM root

statement error pq: cannot GRANT on system object
GRANT ALL ON DATABASE system TO admin

statement error pq: cannot GRANT on system object
GRANT CREATE ON DATABASE system TO admin

statement error pq: cannot REVOKE on system object
REVOKE CREATE ON DATABASE system FROM admin

statement error pq: cannot GRANT on system object
GRANT ALL ON system.namespace TO admin

statement error pq: cannot GRANT on system object
GRANT DELETE, INSERT ON system.descriptor TO admin

statement error pq: cannot GRANT on system object
GRANT ALL ON system.descriptor TO admin

statement error pq: cannot REVOKE on system object
REVOKE CREATE ON system.descriptor FROM admin

statement error pq: cannot REVOKE on system object
REVOKE CREATE ON DATABASE system FROM admin

statement error pq: cannot REVOKE on system object
REVOKE CREATE ON system.namespace FROM admin

statement error pq: cannot REVOKE on system object
REVOKE ALL ON system.namespace FROM admin

statement error pq: cannot REVOKE on system object
REVOKE SELECT ON system.namespace FROM admin

# Some tables (we test system.lease here) used to allow multiple privilege sets for
# backwards compatibility, and superusers were allowed very wide privileges.
# We make sure this is no longer the case.
statement error pq: cannot GRANT on system object
GRANT ALL ON system.lease TO testuser

statement error pq: cannot GRANT on system object
GRANT CREATE on system.lease to root

statement error pq: cannot GRANT on system object
GRANT CREATE on system.lease to admin

statement error pq: cannot GRANT on system object
GRANT CREATE on system.lease to testuser

statement error pq: cannot GRANT on system object
GRANT ALL ON system.lease TO root

statement error pq: cannot GRANT on system object
GRANT ALL ON system.lease TO admin

statement error pq: cannot GRANT on system object
GRANT ALL ON system.lease TO testuser

# NB: the "order by" is necessary or this test is flaky under DistSQL.
# This is somewhat surprising.
# With probabilistic test tenant creation, we have to filter out
# kv.range_merge.queue_enabled, since it will only be set in cases
# where a test tenant is not allocated.
query T
SELECT name
FROM system.settings
WHERE name NOT LIKE 'sql.defaults%'
AND name NOT LIKE 'sql.distsql%'
AND name NOT LIKE 'sql.testing%'
AND name NOT LIKE 'sql.stats%'
AND name != 'kv.range_merge.queue_enabled'
ORDER BY name
----
cluster.secret
diagnostics.reporting.enabled
sql.crdb_internal.table_row_statistics.as_of_time
version

onlyif config 3node-tenant-default-configs
query T
SELECT name
FROM system.settings
WHERE name NOT LIKE 'sql.defaults%'
AND name NOT LIKE 'sql.distsql%'
AND name NOT LIKE 'sql.testing%'
AND name NOT LIKE 'sql.stats%'
ORDER BY name
----
cluster.secret
diagnostics.reporting.enabled
sql.crdb_internal.table_row_statistics.as_of_time
version

statement ok
INSERT INTO system.settings (name, value) VALUES ('somesetting', 'somevalue')

# Have to exclude kv.range_merge.queue_enabled as it is not accessible
# to tenants.
query TT
SELECT name, value
FROM system.settings
WHERE name NOT LIKE 'sql.defaults%'
AND name NOT LIKE 'sql.distsql%'
AND name NOT LIKE 'sql.testing%'
AND name NOT LIKE 'sql.stats%'
AND name NOT IN ('version', 'cluster.secret', 'kv.range_merge.queue_enabled')
ORDER BY name
----
diagnostics.reporting.enabled                      true
somesetting                                        somevalue
sql.crdb_internal.table_row_statistics.as_of_time  -1µs

onlyif config 3node-tenant-default-configs
query TT
SELECT name, value
FROM system.settings
WHERE name NOT LIKE 'sql.defaults%'
AND name NOT LIKE 'sql.distsql%'
AND name NOT LIKE 'sql.testing%'
AND name NOT LIKE 'sql.stats%'
AND name NOT IN ('version', 'cluster.secret')
ORDER BY name
----
diagnostics.reporting.enabled                      true
somesetting                                        somevalue
sql.crdb_internal.table_row_statistics.as_of_time  -1µs

user testuser

statement error user testuser does not have SELECT privilege on relation settings
select name from system.settings

statement error user testuser does not have INSERT privilege on relation settings
UPSERT INTO system.settings (name, value) VALUES ('somesetting', 'somevalueother')

user root

skipif config local-mixed-22.2-23.1
query TTBOO
SELECT * from system.role_members
----
admin  root  true  2  1

statement ok
SET DATABASE = "";

query T
SELECT username FROM system.users WHERE username = 'root'
----
root

statement ok
SET DATABASE = test

# system is a database, not a schema.
query error relation ".system.users" does not exist
SELECT username FROM "".system.users WHERE username = 'root'

# Verify that tenant_usage has a reduced TTL.
skipif config 3node-tenant-default-configs
query T
SELECT raw_config_sql FROM [ SHOW ZONE CONFIGURATION FOR TABLE system.tenant_usage ]
----
ALTER TABLE system.public.tenant_usage CONFIGURE ZONE USING
  range_min_bytes = 134217728,
  range_max_bytes = 536870912,
  gc.ttlseconds = 7200,
  num_replicas = 5,
  constraints = '[]',
  lease_preferences = '[]'
