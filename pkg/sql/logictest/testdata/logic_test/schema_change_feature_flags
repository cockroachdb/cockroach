# Test all feature flags when set to off in SQL package.
statement ok
SET CLUSTER SETTING feature.schemachange.enabled = FALSE;

# Test CREATE DATABASE.
statement error pq: feature CREATE DATABASE is part of the schema change category, which was disabled by the database administrator
CREATE DATABASE d;

# Test CREATE TABLE.
statement error pq: feature CREATE TABLE is part of the schema change category, which was disabled by the database administrator
CREATE TABLE t();

# Test CREATE SCHEMA.
statement error pq: feature CREATE SCHEMA is part of the schema change category, which was disabled by the database administrator
CREATE SCHEMA s;

# Test CREATE TYPE.
statement ok
SET CLUSTER SETTING feature.schemachange.enabled = TRUE;
CREATE SCHEMA s;
SET CLUSTER SETTING feature.schemachange.enabled = FALSE

statement error pq: feature CREATE TYPE is part of the schema change category, which was disabled by the database administrator
CREATE TYPE s.typ AS ENUM ()

# Test CREATE VIEW.
statement error pq: feature CREATE VIEW is part of the schema change category, which was disabled by the database administrator
CREATE VIEW public.bar (x) AS SELECT 1 AS x

# Test CREATE SEQUENCE.
statement error pq: feature CREATE SEQUENCE is part of the schema change category, which was disabled by the database administrator
CREATE SEQUENCE seq

# Test CREATE INDEX.
statement ok
SET CLUSTER SETTING feature.schemachange.enabled = TRUE;
CREATE TABLE t1(a INT8, b INT8);
SET CLUSTER SETTING feature.schemachange.enabled = FALSE

statement error pq: feature CREATE INDEX is part of the schema change category, which was disabled by the database administrator
CREATE INDEX on t1 (a, b)

# Test ALTER DATABASE OWNER.
statement ok
SET CLUSTER SETTING feature.schemachange.enabled = TRUE;
CREATE DATABASE d;
SET CLUSTER SETTING feature.schemachange.enabled = FALSE

statement error pq: feature ALTER DATABASE is part of the schema change category, which was disabled by the database administrator
ALTER DATABASE d OWNER TO testuser

# Test ALTER DATABASE ADD REGION.
statement error pq: feature ALTER DATABASE is part of the schema change category, which was disabled by the database administrator
ALTER DATABASE d ADD REGION "us-west-1"

# Test ALTER DATABASE DROP REGION.
statement error pq: feature ALTER DATABASE is part of the schema change category, which was disabled by the database administrator
ALTER DATABASE d DROP REGION "us-west-1"

# Test ALTER DATABASE SURVIVE.
statement error pq: feature ALTER DATABASE is part of the schema change category, which was disabled by the database administrator
ALTER DATABASE d SURVIVE REGION FAILURE

# Test RENAME DATABASE.
statement error pq: feature ALTER DATABASE is part of the schema change category, which was disabled by the database administrator
ALTER DATABASE d RENAME TO r

# Test REPARENT DATABASE
statement error pq: feature REPARENT DATABASE is part of the schema change category, which was disabled by the database administrator
ALTER DATABASE d CONVERT TO SCHEMA WITH PARENT test

statement ok
SET CLUSTER SETTING feature.schemachange.enabled = TRUE;
CREATE TABLE t();
SET CLUSTER SETTING feature.schemachange.enabled = FALSE

# TODO(angelaw): Test ALTER TABLE UNSPLIT ALL did not throw error.
# statement error pq: feature ALTER TABLE is part of the schema change category, which was disabled by the database administrator
# ALTER TABLE t UNSPLIT ALL

# Test ALTER TABLE.
statement error pq: feature ALTER TABLE is part of the schema change category, which was disabled by the database administrator
ALTER TABLE t ADD COLUMN a STRING

# Test RENAME TABLE.
statement error pq: feature ALTER TABLE is part of the schema change category, which was disabled by the database administrator
ALTER TABLE t RENAME TO r

# Test ALTER TABLE SET SCHEMA.
statement error pq: feature ALTER TABLE is part of the schema change category, which was disabled by the database administrator
ALTER TABLE t SET SCHEMA s

# Test ALTER TABLE SET REGIONAL AFFINITY.
statement error pq: feature ALTER TABLE is part of the schema change category, which was disabled by the database administrator
ALTER TABLE t SET REGIONAL AFFINITY TO NONE

statement ok
SET CLUSTER SETTING feature.schemachange.enabled = TRUE;
CREATE INDEX i on t1 (a, b);
SET CLUSTER SETTING feature.schemachange.enabled = FALSE;

# TODO(angelaw) — gets ALTER TABLE error instead of RENAME COLUMN. Test RENAME COLUMN.
# statement error pq: feature RENAME COLUMN is part of the schema change category, which was disabled by the database administrator
# ALTER TABLE t1 RENAME COLUMN a to c

# TODO(angelaw) — does not throw error here: Test ALTER INDEX.
# statement error pq: feature ALTER INDEX is part of the schema change category, which was disabled by the database administrator
# ALTER INDEX t1@i CONFIGURE ZONE DISCARD

# TODO(angelaw) — does not throw error here: Test ALTER INDEX.
# statement error pq: feature ALTER INDEX is part of the schema change category, which was disabled by the database administrator
# ALTER INDEX t1@i SPLIT AT VALUES(1)

# Test RENAME INDEX
statement error pq: feature RENAME INDEX is part of the schema change category, which was disabled by the database administrator
ALTER INDEX t1@i RENAME TO r

# Test RENAME SCHEMA.
statement error pq: feature ALTER SCHEMA is part of the schema change category, which was disabled by the database administrator
ALTER SCHEMA s RENAME TO r

# Test ALTER SCHEMA.
statement error pq: feature ALTER SCHEMA is part of the schema change category, which was disabled by the database administrator
ALTER SCHEMA s OWNER TO testuser

# Test ALTER TYPE.
statement ok
SET CLUSTER SETTING feature.schemachange.enabled = TRUE;
CREATE TYPE s.typ AS ENUM ();
SET CLUSTER SETTING feature.schemachange.enabled = FALSE

statement error pq: feature ALTER TYPE is part of the schema change category, which was disabled by the database administrator
ALTER TYPE s.typ ADD VALUE 'hi'

# Test ALTER SEQUENCE.
statement ok
SET CLUSTER SETTING feature.schemachange.enabled = TRUE;
CREATE SEQUENCE seq;
SET CLUSTER SETTING feature.schemachange.enabled = FALSE

# TODO(angelaw): This one returns error for ALTER TABLE and not ALTER SEQUENCE
# statement error pq: feature ALTER SEQUENCE is part of the schema change category, which was disabled by the database administrator
# ALTER SEQUENCE seq RENAME TO something

# TODO(angelaw): This one returns error for ALTER TABLE and not ALTER SEQUENCE
# statement error pq: feature ALTER SEQUENCE is part of the schema change category, which was disabled by the database administrator
# ALTER SEQUENCE seq SET SCHEMA s

statement error pq: feature ALTER SEQUENCE is part of the schema change category, which was disabled by the database administrator
ALTER SEQUENCE seq NO CYCLE

# Test REASSIGN OWNED BY.
statement error pq: feature REASSIGN OWNED BY is part of the schema change category, which was disabled by the database administrator
REASSIGN OWNED BY root TO testuser

# Test DROP OWNED BY.
statement error pq: feature DROP OWNED BY is part of the schema change category, which was disabled by the database administrator
DROP OWNED BY testuser

# Test DROP DATABASE.
statement error pq: feature DROP DATABASE is part of the schema change category, which was disabled by the database administrator
DROP DATABASE d

# TODO(angelaw): Returns DROP DATABASE error. Test DROP SCHEMA.
# statement error pq: feature DROP SCHEMA is part of the schema change category, which was disabled by the database administrator
# DROP SCHEMA s

# Test DROP TYPE.
statement error pq: feature DROP TYPE is part of the schema change category, which was disabled by the database administrator
DROP TYPE s.typ

# Test DROP TABLE.
statement error pq: feature DROP TABLE is part of the schema change category, which was disabled by the database administrator
DROP TABLE t

# Test DROP SEQUENCE.
statement error pq: feature DROP SEQUENCE is part of the schema change category, which was disabled by the database administrator
DROP SEQUENCE seq

# Test DROP VIEW.
statement ok
SET CLUSTER SETTING feature.schemachange.enabled = TRUE;
CREATE VIEW public.bar (x) AS SELECT 1 AS x;
SET CLUSTER SETTING feature.schemachange.enabled = FALSE

statement error pq: feature DROP VIEW is part of the schema change category, which was disabled by the database administrator
DROP VIEW public.bar

# Test DROP INDEX.
statement error pq: feature DROP INDEX is part of the schema change category, which was disabled by the database administrator
DROP INDEX t1@i

# Reset feature flag to true so that test objects can be dropped.
statement ok
SET CLUSTER SETTING feature.schemachange.enabled = TRUE
