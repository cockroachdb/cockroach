# LogicTest: 5node-dist-vec

# Regression test for #39317.

statement ok
CREATE TABLE l (a INT PRIMARY KEY, b INT)

statement ok
CREATE TABLE r (a INT PRIMARY KEY, b INT)

statement ok
INSERT INTO l VALUES (1, 10), (2, 20), (3, 30)

statement ok
INSERT INTO r VALUES (2, 200), (3, 300), (4, 400)

statement ok
ALTER TABLE l SPLIT AT VALUES (2), (3)

statement ok
ALTER TABLE r SPLIT AT VALUES (2), (3)

statement ok
ALTER TABLE l EXPERIMENTAL_RELOCATE VALUES (ARRAY[1], 1), (ARRAY[2], 2), (ARRAY[3], 3)

statement ok
ALTER TABLE r EXPERIMENTAL_RELOCATE VALUES (ARRAY[1], 2), (ARRAY[2], 3), (ARRAY[3], 1)

query TTTI colnames
SELECT start_key, end_key, replicas, lease_holder from [SHOW EXPERIMENTAL_RANGES FROM TABLE l] ORDER BY lease_holder
----
start_key  end_key  replicas  lease_holder
NULL       /2       {1}       1
/2         /3       {2}       2
/3         NULL     {3}       3

query TTTI colnames
SELECT start_key, end_key, replicas, lease_holder from [SHOW EXPERIMENTAL_RANGES FROM TABLE r] ORDER BY lease_holder
----
start_key  end_key  replicas  lease_holder
/2         /3       {1}       1
/3         NULL     {2}       2
NULL       /2       {3}       3

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT * FROM l LEFT OUTER JOIN r USING(a) WHERE a = 2]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzEk9Fr2z4Qx99_f4W430uyqdhyvBdBwWNzN5fU7myXDYof1PiWGFzJk2RYCPnfh-1C5iwJCRv0zZLu87373p03YH7UwCEL5-GHnLS6Jjdpckcew2_38_dRTCYfoyzPvsyn5CXkzRBQk3l4k5PbJIqJJg9ZFH8iEzElXz-HaUgEuSZeARSkKjEWz2iAPwIDCh4UFBqtFmiM0t31pg-Kyp_AXQqVbFrbXRcUFkoj8A3YytYIHHLxVGOKokTtdFolWlHVvXSjq2eh14EGClkjpOHE8a4cz_kfii0F1doX2Z3a05qshFmNdQIGxbagYKxYInBvS4-Ut9NppdIlaizHSpW0tJK2S39B7AHXd6iXeKsqidqZjbl83SAfBpE85GHajwMo1PjdTgL2dnqtq-Vq-AQKSWs5CRgNPBr4e33ZeZ79tefjXmJ1pRrHH1HH6vBHdbDzV8M9vBr1v10NdrS811kN71VX40BxKZpGSYNnDdvt7GG5xKGBRrV6gfdaLfo0wzHpub7XJRo7vPrDIZL9U_-_ng-z0zDbh93fYW8Es33YOwm_G8HuPjy7wPMfmU_D7DTsX-S52P73KwAA__-qRQVA

query III
SELECT * FROM l LEFT OUTER JOIN r USING(a) WHERE a = 2
----
2 20 200

# Test that LEFT SEMI merge join outputs batches only with the columns from the
# left side.
query II rowsort
SELECT * FROM l WHERE EXISTS(SELECT * FROM r WHERE r.a=l.a)
----
2  20
3  30
