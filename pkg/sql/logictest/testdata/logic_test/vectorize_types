# LogicTest: local-vec

# Check that all types supported by the vectorized engine can be read correctly.
statement ok
CREATE TABLE all_types (
    _bool        BOOL,
    _bytes       BYTES,
    _date        DATE,
    _decimal     DECIMAL,
    _int2        INT2,
    _int4        INT4,
    _int         INT8,
    _oid         OID,
    _float       FLOAT8,
    _string      STRING,
    _uuid        UUID,
    _timestamp   TIMESTAMP,
    _timestamptz TIMESTAMPTZ
)

statement ok
INSERT
  INTO all_types
VALUES (
        NULL,
        NULL,
        NULL,
        NULL,
        NULL,
        NULL,
        NULL,
        NULL,
        NULL,
        NULL,
        NULL,
        NULL,
        NULL
       ),
       (
       false,
       '123',
       '2019-10-22',
       1.23,
       123,
       123,
       123,
       123,
       1.23,
       '123',
       '63616665-6630-3064-6465-616462656562',
       '1-1-18 1:00:00.001',
       '1-1-18 1:00:00.001-8'
       )

query BTTRIIIORTTTT
SELECT * FROM all_types ORDER BY 1
----
NULL   NULL  NULL                             NULL  NULL  NULL  NULL  NULL  NULL  NULL  NULL                                  NULL                                 NULL
false  123   2019-10-22 00:00:00 +0000 +0000  1.23  123   123   123   123   1.23  123   63616665-6630-3064-6465-616462656562  2001-01-18 01:00:00.001 +0000 +0000  2001-01-18 09:00:00.001 +0000 UTC

statement ok
CREATE TABLE skip_unneeded_cols (
  _id UUID,
  _id2 INT8,
  _float FLOAT8,
  _unsupported1 INT ARRAY,
  _bool BOOL,
  _unsupported2 INT ARRAY,
  _bool2 BOOL,
  PRIMARY KEY(_id, _id2)
)

statement ok
INSERT INTO skip_unneeded_cols VALUES ('63616665-6630-3064-6465-616462656562', 1, '1.2', NULL, true, NULL, false)

statement ok
SET vectorize=experimental_always

statement error pq: unable to vectorize execution plan: unhandled type int\[\]
SELECT _unsupported1 FROM skip_unneeded_cols

query IBB
SELECT _id2, _bool, _bool2 FROM skip_unneeded_cols
----
1 true false

statement ok
RESET vectorize

# This query uses a builtin that returns currently unsupported type
# (TimestampTZ). We're only interested in not getting an error. See #42871.
statement ok
SELECT experimental_strptime(_string, _string) IS NULL FROM all_types

statement ok
CREATE TABLE unsupported_type (id INT PRIMARY KEY, unsupported INT ARRAY)

statement ok
INSERT INTO unsupported_type (id) SELECT * FROM generate_series(1, 2000)

statement ok
SET vectorize=experimental_always

# This query makes sure that CFetcher when reading from a table with an
# unhandled type (that isn't needed) is reset correctly between batches.
statement ok
SELECT id FROM unsupported_type LIMIT 1 OFFSET 1100

statement ok
RESET vectorize
