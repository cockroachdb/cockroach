statement ok
CREATE TABLE geo_table(
  id int primary key,
  geog geography(geometry, 4326),
  geom geometry(point),
  orphan geography,
  FAMILY f (orphan)
)

statement ok
INSERT INTO geo_table VALUES
  (1, 'POINT(1.0 1.0)', 'POINT(2.0 2.0)', 'POINT(3.0 3.0)'),
  (2, 'LINESTRING(1.0 1.0, 2.0 2.0)', 'POINT(1.0 1.0)', 'POINT(3.0 3.0)')

statement error SRID 4004 does not match column SRID 4326
INSERT INTO geo_table (id, geog) VALUES
  (3, 'SRID=4004;POINT(1.0 2.0)')

statement error type LineString does not match column type Point
INSERT INTO geo_table (id, geom) VALUES
  (3, 'SRID=4004;LINESTRING(0.0 0.0, 1.0 2.0)')

query ITTT rowsort
SELECT * FROM geo_table
----
1  0101000020E6100000000000000000F03F000000000000F03F                                          010100000000000000000000400000000000000040  0101000020E610000000000000000008400000000000000840
2  0102000020E610000002000000000000000000F03F000000000000F03F00000000000000400000000000000040  0101000000000000000000F03F000000000000F03F  0101000020E610000000000000000008400000000000000840

query T rowsort
SELECT orphan FROM geo_table
----
0101000020E610000000000000000008400000000000000840
0101000020E610000000000000000008400000000000000840

query TTBTTTB rowsort
SHOW COLUMNS FROM geo_table
----
id      INT8                      false  NULL  路  {primary}  false
geog    GEOGRAPHY(GEOMETRY,4326)  true   NULL  路  {}         false
geom    GEOMETRY(POINT)           true   NULL  路  {}         false
orphan  GEOGRAPHY                 true   NULL  路  {}         false

statement error column bad_pk is of type geography and thus is not indexable
CREATE TABLE bad_geog_table(bad_pk geography primary key)

statement error column bad_pk is of type geometry and thus is not indexable
CREATE TABLE bad_geom_table(bad_pk geometry primary key)

statement error column geog is of type geography and thus is not indexable
CREATE INDEX geog_idx ON geo_table(geog)

statement error column geom is of type geometry and thus is not indexable
CREATE INDEX geom_idx ON geo_table(geom)

statement ok
CREATE INVERTED INDEX geog_idx ON geo_table(geog)

statement ok
CREATE INVERTED INDEX geom_idx ON geo_table(geom)

statement ok
INSERT INTO geo_table VALUES
  (3, 'POINT(1.0 1.0)', 'POINT(2.0 2.0)', 'POINT(3.0 3.0)')

query ITTT rowsort
SELECT * FROM geo_table
----
1  0101000020E6100000000000000000F03F000000000000F03F                                          010100000000000000000000400000000000000040  0101000020E610000000000000000008400000000000000840
2  0102000020E610000002000000000000000000F03F000000000000F03F00000000000000400000000000000040  0101000000000000000000F03F000000000000F03F  0101000020E610000000000000000008400000000000000840
3  0101000020E6100000000000000000F03F000000000000F03F                                          010100000000000000000000400000000000000040  0101000020E610000000000000000008400000000000000840

statement ok
CREATE TABLE geo_array_table(id int, geog geography array, geom geometry array)

statement ok
INSERT INTO geo_array_table VALUES (
  1,
  array['POINT(1.0 1.0)'::geography, 'LINESTRING(2.0 2.0, 3.0 3.0)'::geography],
  array['POINT(1.0 1.0)'::geometry, 'LINESTRING(2.0 2.0, 3.0 3.0)'::geometry]
)

query ITT
SELECT * FROM geo_array_table
----
1  {0101000020E6100000000000000000F03F000000000000F03F,0102000020E6100000020000000000000000000040000000000000004000000000000008400000000000000840}  {0101000000000000000000F03F000000000000F03F,0102000000020000000000000000000040000000000000004000000000000008400000000000000840}

query TT
SELECT NULL::geometry, NULL::geography
----
NULL  NULL

query T
SELECT ST_AsText(p) FROM (VALUES
  (ST_Point(1, 2)),
  (ST_Point(3, 4))
) tbl(p)
----
POINT (1 2)
POINT (3 4)

subtest cast_test

query T
SELECT ST_AsEWKT(geom) FROM (VALUES
  ('SRID=4326;POINT(1.0 2.0)'::geometry::geometry(point, 4326)),
  ('SRID=4326;POINT(1.0 2.0)'::geometry::geometry(geometry, 4326)),
  ('SRID=4326;POINT(1.0 2.0)'::geography::geometry)
) t(geom)
----
SRID=4326;POINT (1 2)
SRID=4326;POINT (1 2)
SRID=4326;POINT (1 2)

query T
SELECT ST_AsEWKT(geog) FROM (VALUES
  ('POINT(1.0 2.0)'::geography::geography(point, 4326)),
  ('POINT(1.0 2.0)'::geometry::geography(point, 4326)),
  ('SRID=4004;POINT(1.0 2.0)'::geometry::geography(point, 4004)),
  ('SRID=4004;POINT(1.0 2.0)'::geometry::geography),
  ('SRID=4004;POINT(1.0 2.0)'::geography::geography(point, 4004)),
  ('SRID=4004;POINT(1.0 2.0)'::geography::geography(geometry, 4004)),
  ('POINT(1.0 2.0)'::geometry::geography),
  ('POINT(1.0 2.0)'::geometry::geography(geometry, 4326))
) t(geog)
----
SRID=4326;POINT (1 2)
SRID=4326;POINT (1 2)
SRID=4004;POINT (1 2)
SRID=4004;POINT (1 2)
SRID=4004;POINT (1 2)
SRID=4004;POINT (1 2)
SRID=4326;POINT (1 2)
SRID=4326;POINT (1 2)

statement error SRID 4004 does not match column SRID 4326
SELECT 'SRID=4004;POINT(2.0 3.0)'::geometry::geography(point, 4326)

statement error SRID 4326 does not match column SRID 4004
SELECT 'SRID=4326;POINT(2.0 3.0)'::geometry::geography(point, 4004)

statement error SRID 4326 does not match column SRID 4004
SELECT 'SRID=4326;POINT(2.0 3.0)'::geography::geography(point, 4004)

statement error SRID 4004 does not match column SRID 4326
SELECT 'SRID=4004;POINT(2.0 3.0)'::geometry::geometry(point, 4326)

statement error SRID 4004 does not match column SRID 4326
SELECT 'SRID=4004;POINT(2.0 3.0)'::geography::geometry(point, 4326)

statement error SRID 4326 does not match column SRID 4004
SELECT 'POINT(1.0 2.0)'::geometry::geography(geometry, 4004)

statement error type Point does not match column type LineString
SELECT 'SRID=4004;POINT(2.0 3.0)'::geometry::geometry(linestring)

statement error type Point does not match column type LineString
SELECT 'SRID=4004;POINT(2.0 3.0)'::geometry::geography(linestring)

statement error type Point does not match column type LineString
SELECT 'SRID=4004;POINT(2.0 3.0)'::geography::geography(linestring)

statement error type Point does not match column type LineString
SELECT 'SRID=4004;POINT(2.0 3.0)'::geography::geometry(linestring)

subtest parse_and_unparse

statement ok
CREATE TABLE parse_test (
  id SERIAL PRIMARY KEY,
  geom GEOMETRY,
  geog GEOGRAPHY
)

# These values cannot be inserted into the database due to mismatching SRIDs.
query TT
SELECT
  ST_AsEWKT(geom),
  ST_AsEWKT(geog)
FROM ( VALUES
  (ST_GeometryFromText('SRID=4326;POINT(1.0 2.0)', 4004), ST_GeographyFromText('SRID=4326;POINT(1.0 2.0)', 4004)),
  (ST_GeomFromText('SRID=4326;POINT(1.0 2.0)', 4004), ST_GeogFromText('SRID=4326;POINT(1.0 2.0)', 4004)),
  (ST_GeometryFromText('SRID=4326;POINT(1.0 2.0)'), ST_GeographyFromText('POINT(1.0 2.0)', 4004)),
  (ST_GeomFromEWKT('SRID=4004;POINT(1.0 2.0)'), ST_GeogFromEWKT('SRID=4004;POINT(1.0 2.0)')),
  (ST_GeomFromWKB(decode('0101000000000000000000F03F000000000000F03F', 'hex'), 4004), ST_GeogFromWKB(decode('0101000000000000000000F03F000000000000F03F', 'hex'), 4004))
) t(geom, geog)
----
SRID=4004;POINT (1 2)  SRID=4004;POINT (1 2)
SRID=4004;POINT (1 2)  SRID=4004;POINT (1 2)
SRID=4326;POINT (1 2)  SRID=4004;POINT (1 2)
SRID=4004;POINT (1 2)  SRID=4004;POINT (1 2)
SRID=4004;POINT (1 1)  SRID=4004;POINT (1 1)


statement ok
INSERT INTO parse_test (geom, geog) VALUES
  (ST_GeomFromText('POINT(1.0 2.0)'), ST_GeogFromText('POINT(1.0 2.0)')),
  (ST_GeomFromText('SRID=4326;POINT(1.0 2.0)'), ST_GeogFromText('SRID=4326;POINT(1.0 2.0)')),
  (ST_GeometryFromText('SRID=4004;POINT(1.0 2.0)'), ST_GeographyFromText('POINT(1.0 2.0)')),
  (ST_GeomFromGeoJSON('{"type":"Feature","geometry":{"type":"Point","coordinates":[1,2]},"properties":null}'), ST_GeogFromGeoJSON('{"type":"Feature","geometry":{"type":"Point","coordinates":[1,2]},"properties":null}')),
  (ST_GeomFromGeoJSON('{"type":"Feature","geometry":{"type":"Point","coordinates":[1,2]},"properties":null}'::jsonb), ST_GeogFromGeoJSON('{"type":"Feature","geometry":{"type":"Point","coordinates":[1,2]},"properties":null}'::jsonb)),
  (ST_GeomFromWKB(decode('0101000000000000000000F03F000000000000F03F', 'hex')), ST_GeogFromWKB(decode('0101000000000000000000F03F000000000000F03F', 'hex'))),
  (ST_GeomFromEWKB(decode('0101000000000000000000F03F000000000000F03F', 'hex')), ST_GeogFromEWKB(decode('0101000000000000000000F03F000000000000F03F', 'hex'))),
  (st_geomfromgeojson('null':::jsonb), st_geogfromgeojson('null':::jsonb))

query BB
SELECT
  st_geomfromwkb(decode('0101000000000000000000F03F000000000000F03F', 'hex')) = st_wkbtosql(decode('0101000000000000000000F03F000000000000F03F', 'hex')),
  st_geomfromtext('POINT(1.0 2.0)') = st_wkttosql('POINT(1.0 2.0)')
----
true  true

query TTTTTTTT
SELECT
  ST_AsText(geom),
  ST_AsEWKT(geom),
  ST_AsBinary(geom),
  ST_AsBinary(geom, 'ndr'),
  ST_AsBinary(geom, 'xdr'),
  ST_AsEWKB(geom),
  ST_AsKML(geom),
  ST_AsGeoJSON(geom)
FROM parse_test ORDER BY id ASC
----
POINT (1 2)                                    POINT (1 2)                                                                           [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  [0 0 0 0 1 63 240 0 0 0 0 0 0 64 0 0 0 0 0 0 0]  [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  <?xml version="1.0" encoding="UTF-8"?>
<Point><coordinates>1,2</coordinates></Point>  {"type":"Feature","geometry":{"type":"Point","coordinates":[1,2]},"properties":null}
POINT (1 2)                                    SRID=4326;POINT (1 2)                                                                 [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  [0 0 0 0 1 63 240 0 0 0 0 0 0 64 0 0 0 0 0 0 0]  [1 1 0 0 32 230 16 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  <?xml version="1.0" encoding="UTF-8"?>
<Point><coordinates>1,2</coordinates></Point>  {"type":"Feature","geometry":{"type":"Point","coordinates":[1,2]},"properties":null}
POINT (1 2)                                    SRID=4004;POINT (1 2)                                                                 [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  [0 0 0 0 1 63 240 0 0 0 0 0 0 64 0 0 0 0 0 0 0]  [1 1 0 0 32 164 15 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  <?xml version="1.0" encoding="UTF-8"?>
<Point><coordinates>1,2</coordinates></Point>  {"type":"Feature","geometry":{"type":"Point","coordinates":[1,2]},"properties":null}
POINT (1 2)                                    POINT (1 2)                                                                           [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  [0 0 0 0 1 63 240 0 0 0 0 0 0 64 0 0 0 0 0 0 0]  [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  <?xml version="1.0" encoding="UTF-8"?>
<Point><coordinates>1,2</coordinates></Point>  {"type":"Feature","geometry":{"type":"Point","coordinates":[1,2]},"properties":null}
POINT (1 2)                                    POINT (1 2)                                                                           [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  [0 0 0 0 1 63 240 0 0 0 0 0 0 64 0 0 0 0 0 0 0]  [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  <?xml version="1.0" encoding="UTF-8"?>
<Point><coordinates>1,2</coordinates></Point>  {"type":"Feature","geometry":{"type":"Point","coordinates":[1,2]},"properties":null}
POINT (1 1)                                    POINT (1 1)                                                                           [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 240 63]  [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 240 63]  [0 0 0 0 1 63 240 0 0 0 0 0 0 63 240 0 0 0 0 0 0]  [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 240 63]  <?xml version="1.0" encoding="UTF-8"?>
<Point><coordinates>1,1</coordinates></Point>  {"type":"Feature","geometry":{"type":"Point","coordinates":[1,1]},"properties":null}
POINT (1 1)                                    POINT (1 1)                                                                           [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 240 63]  [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 240 63]  [0 0 0 0 1 63 240 0 0 0 0 0 0 63 240 0 0 0 0 0 0]  [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 240 63]  <?xml version="1.0" encoding="UTF-8"?>
<Point><coordinates>1,1</coordinates></Point>  {"type":"Feature","geometry":{"type":"Point","coordinates":[1,1]},"properties":null}
NULL                                           NULL                                                                                  NULL  NULL  NULL  NULL  NULL  NULL

query TTTT
SELECT
  ST_AsHexWKB(geom),
  ST_AsHexEWKB(geom),
  ST_AsHexEWKB(geom, 'ndr'),
  ST_AsHexEWKB(geom, 'xdr')
FROM parse_test ORDER BY id ASC
----
0101000000000000000000F03F0000000000000040  0101000000000000000000F03F0000000000000040          0101000000000000000000F03F0000000000000040          00000000013FF00000000000004000000000000000
0101000000000000000000F03F0000000000000040  0101000020E6100000000000000000F03F0000000000000040  0101000020E6100000000000000000F03F0000000000000040  0020000001000010E63FF00000000000004000000000000000
0101000000000000000000F03F0000000000000040  0101000020A40F0000000000000000F03F0000000000000040  0101000020A40F0000000000000000F03F0000000000000040  002000000100000FA43FF00000000000004000000000000000
0101000000000000000000F03F0000000000000040  0101000000000000000000F03F0000000000000040          0101000000000000000000F03F0000000000000040          00000000013FF00000000000004000000000000000
0101000000000000000000F03F0000000000000040  0101000000000000000000F03F0000000000000040          0101000000000000000000F03F0000000000000040          00000000013FF00000000000004000000000000000
0101000000000000000000F03F000000000000F03F  0101000000000000000000F03F000000000000F03F          0101000000000000000000F03F000000000000F03F          00000000013FF00000000000003FF0000000000000
0101000000000000000000F03F000000000000F03F  0101000000000000000000F03F000000000000F03F          0101000000000000000000F03F000000000000F03F          00000000013FF00000000000003FF0000000000000
NULL                                        NULL                                                NULL                                                NULL

query TTTTTTTT
SELECT
  ST_AsText(geog),
  ST_AsEWKT(geog),
  ST_AsBinary(geog),
  ST_AsBinary(geog, 'ndr'),
  ST_AsBinary(geog, 'xdr'),
  ST_AsEWKB(geog),
  ST_AsKML(geog),
  ST_AsGeoJSON(geog)
FROM parse_test ORDER BY id ASC
----
POINT (1 2)                                    SRID=4326;POINT (1 2)                                                                 [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  [0 0 0 0 1 63 240 0 0 0 0 0 0 64 0 0 0 0 0 0 0]  [1 1 0 0 32 230 16 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  <?xml version="1.0" encoding="UTF-8"?>
<Point><coordinates>1,2</coordinates></Point>  {"type":"Feature","geometry":{"type":"Point","coordinates":[1,2]},"properties":null}
POINT (1 2)                                    SRID=4326;POINT (1 2)                                                                 [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  [0 0 0 0 1 63 240 0 0 0 0 0 0 64 0 0 0 0 0 0 0]  [1 1 0 0 32 230 16 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  <?xml version="1.0" encoding="UTF-8"?>
<Point><coordinates>1,2</coordinates></Point>  {"type":"Feature","geometry":{"type":"Point","coordinates":[1,2]},"properties":null}
POINT (1 2)                                    SRID=4326;POINT (1 2)                                                                 [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  [0 0 0 0 1 63 240 0 0 0 0 0 0 64 0 0 0 0 0 0 0]  [1 1 0 0 32 230 16 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  <?xml version="1.0" encoding="UTF-8"?>
<Point><coordinates>1,2</coordinates></Point>  {"type":"Feature","geometry":{"type":"Point","coordinates":[1,2]},"properties":null}
POINT (1 2)                                    SRID=4326;POINT (1 2)                                                                 [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  [0 0 0 0 1 63 240 0 0 0 0 0 0 64 0 0 0 0 0 0 0]  [1 1 0 0 32 230 16 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  <?xml version="1.0" encoding="UTF-8"?>
<Point><coordinates>1,2</coordinates></Point>  {"type":"Feature","geometry":{"type":"Point","coordinates":[1,2]},"properties":null}
POINT (1 2)                                    SRID=4326;POINT (1 2)                                                                 [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  [0 0 0 0 1 63 240 0 0 0 0 0 0 64 0 0 0 0 0 0 0]  [1 1 0 0 32 230 16 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64]  <?xml version="1.0" encoding="UTF-8"?>
<Point><coordinates>1,2</coordinates></Point>  {"type":"Feature","geometry":{"type":"Point","coordinates":[1,2]},"properties":null}
POINT (1 1)                                    SRID=4326;POINT (1 1)                                                                 [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 240 63]  [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 240 63]  [0 0 0 0 1 63 240 0 0 0 0 0 0 63 240 0 0 0 0 0 0]  [1 1 0 0 32 230 16 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 240 63]  <?xml version="1.0" encoding="UTF-8"?>
<Point><coordinates>1,1</coordinates></Point>  {"type":"Feature","geometry":{"type":"Point","coordinates":[1,1]},"properties":null}
POINT (1 1)                                    SRID=4326;POINT (1 1)                                                                 [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 240 63]  [1 1 0 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 240 63]  [0 0 0 0 1 63 240 0 0 0 0 0 0 63 240 0 0 0 0 0 0]  [1 1 0 0 32 230 16 0 0 0 0 0 0 0 0 240 63 0 0 0 0 0 0 240 63]  <?xml version="1.0" encoding="UTF-8"?>
<Point><coordinates>1,1</coordinates></Point>  {"type":"Feature","geometry":{"type":"Point","coordinates":[1,1]},"properties":null}
NULL                                           NULL                                                                                  NULL  NULL  NULL  NULL  NULL  NULL

query TTTT
SELECT
  ST_AsHexWKB(geog),
  ST_AsHexEWKB(geog),
  ST_AsHexEWKB(geog, 'ndr'),
  ST_AsHexEWKB(geog, 'xdr')
FROM parse_test ORDER BY id ASC
----
0101000000000000000000F03F0000000000000040  0101000020E6100000000000000000F03F0000000000000040  0101000020E6100000000000000000F03F0000000000000040  0020000001000010E63FF00000000000004000000000000000
0101000000000000000000F03F0000000000000040  0101000020E6100000000000000000F03F0000000000000040  0101000020E6100000000000000000F03F0000000000000040  0020000001000010E63FF00000000000004000000000000000
0101000000000000000000F03F0000000000000040  0101000020E6100000000000000000F03F0000000000000040  0101000020E6100000000000000000F03F0000000000000040  0020000001000010E63FF00000000000004000000000000000
0101000000000000000000F03F0000000000000040  0101000020E6100000000000000000F03F0000000000000040  0101000020E6100000000000000000F03F0000000000000040  0020000001000010E63FF00000000000004000000000000000
0101000000000000000000F03F0000000000000040  0101000020E6100000000000000000F03F0000000000000040  0101000020E6100000000000000000F03F0000000000000040  0020000001000010E63FF00000000000004000000000000000
0101000000000000000000F03F000000000000F03F  0101000020E6100000000000000000F03F000000000000F03F  0101000020E6100000000000000000F03F000000000000F03F  0020000001000010E63FF00000000000003FF0000000000000
0101000000000000000000F03F000000000000F03F  0101000020E6100000000000000000F03F000000000000F03F  0101000020E6100000000000000000F03F000000000000F03F  0020000001000010E63FF00000000000003FF0000000000000
NULL                                        NULL                                                NULL                                                NULL

query TTTTTTTT
SELECT
  ST_PointFromText('POINT(1.0 1.0)'),
  ST_PointFromText('POINT(1.0 1.0)', 4326),
  ST_PointFromText('LINESTRING(1.0 1.0, 2.0 2.0)'),
  ST_PointFromText('LINESTRING(1.0 1.0, 2.0 2.0)', 4326),
  ST_PointFromWKB(ST_AsBinary('POINT(1.0 1.0)'::geometry)),
  ST_PointFromWKB(ST_AsBinary('POINT(1.0 1.0)'::geometry), 4326),
  ST_PointFromWKB(ST_AsBinary('LINESTRING(1.0 1.0, 2.0 2.0)'::geometry)),
  ST_PointFromWKB(ST_AsBinary('LINESTRING(1.0 1.0, 2.0 2.0)'::geometry), 4326)
----
0101000000000000000000F03F000000000000F03F  0101000020E6100000000000000000F03F000000000000F03F  NULL  NULL  0101000000000000000000F03F000000000000F03F  0101000020E6100000000000000000F03F000000000000F03F  NULL  NULL

subtest geom_operators

statement ok
CREATE TABLE geom_operators_test (
  dsc TEXT PRIMARY KEY,
  geom GEOMETRY
)

statement ok
INSERT INTO geom_operators_test VALUES
  ('NULL', NULL),
  ('Square (left)', 'POLYGON((-1.0 0.0, 0.0 0.0, 0.0 1.0, -1.0 1.0, -1.0 0.0))'),
  ('Point middle of Left Square', 'POINT(-0.5 0.5)'),
  ('Square (right)', 'POLYGON((0.0 0.0, 1.0 0.0, 1.0 1.0, 0.0 1.0, 0.0 0.0))'),
  ('Point middle of Right Square', 'POINT(0.5 0.5)'),
  ('Square overlapping left and right square', 'POLYGON((-0.1 0.0, 1.0 0.0, 1.0 1.0, -0.1 1.0, -0.1 0.0))'),
  ('Line going through left and right square', 'LINESTRING(-0.5 0.5, 0.5 0.5)'),
  ('Faraway point', 'POINT(5.0 5.0)'),
  ('Empty LineString', 'LINESTRING EMPTY'),
  ('Empty GeometryCollection', 'GEOMETRYCOLLECTION EMPTY')
  -- ('Partially Empty GeometryCollection', 'GEOMETRYCOLLECTION ( LINESTRING EMPTY, POINT (0.0 0.0) )'): omitted, see: #49209

# Unary operators
query TRRRR
SELECT
  a.dsc,
  ST_Area(a.geom),
  ST_Area2D(a.geom),
  ST_Length(a.geom),
  ST_Perimeter(a.geom)
FROM geom_operators_test a
ORDER BY a.dsc
----
Empty GeometryCollection                  0     0     0     0
Empty LineString                          0     0     0     0
Faraway point                             0     0     0     0
Line going through left and right square  0     0     1     0
NULL                                      NULL  NULL  NULL  NULL
Point middle of Left Square               0     0     0     0
Point middle of Right Square              0     0     0     0
Square (left)                             1     1     0     4
Square (right)                            1     1     0     4
Square overlapping left and right square  1.1   1.1   0     4.2

query TT
SELECT
  a.dsc,
  ST_AsEWKT(ST_Centroid(a.geom))
FROM geom_operators_test a
ORDER BY a.dsc
----
Empty GeometryCollection                  POINT EMPTY
Empty LineString                          POINT EMPTY
Faraway point                             POINT (5 5)
Line going through left and right square  POINT (0 0.5)
NULL                                      NULL
Point middle of Left Square               POINT (-0.5 0.5)
Point middle of Right Square              POINT (0.5 0.5)
Square (left)                             POINT (-0.5 0.5)
Square (right)                            POINT (0.5 0.5)
Square overlapping left and right square  POINT (0.4499999999999999 0.5)

# Functions which take in strings as input as well.
query TT
SELECT
  dsc,
  ST_AsEWKT(ST_Centroid(ewkt))
FROM [SELECT dsc, ST_AsEWKT(a.geom) ewkt FROM geom_operators_test a]
ORDER BY dsc ASC
----
Empty GeometryCollection                  POINT EMPTY
Empty LineString                          POINT EMPTY
Faraway point                             POINT (5 5)
Line going through left and right square  POINT (0 0.5)
NULL                                      NULL
Point middle of Left Square               POINT (-0.5 0.5)
Point middle of Right Square              POINT (0.5 0.5)
Square (left)                             POINT (-0.5 0.5)
Square (right)                            POINT (0.5 0.5)
Square overlapping left and right square  POINT (0.4499999999999999 0.5)

# Binary operators
query TTRR
SELECT
  a.dsc,
  b.dsc,
  ST_Distance(a.geom, b.geom),
  ST_MaxDistance(a.geom, b.geom)
FROM geom_operators_test a
JOIN geom_operators_test b ON (1=1)
ORDER BY a.dsc, b.dsc
----
Empty GeometryCollection                  Empty GeometryCollection                  NULL              NULL
Empty GeometryCollection                  Empty LineString                          NULL              NULL
Empty GeometryCollection                  Faraway point                             NULL              NULL
Empty GeometryCollection                  Line going through left and right square  NULL              NULL
Empty GeometryCollection                  NULL                                      NULL              NULL
Empty GeometryCollection                  Point middle of Left Square               NULL              NULL
Empty GeometryCollection                  Point middle of Right Square              NULL              NULL
Empty GeometryCollection                  Square (left)                             NULL              NULL
Empty GeometryCollection                  Square (right)                            NULL              NULL
Empty GeometryCollection                  Square overlapping left and right square  NULL              NULL
Empty LineString                          Empty GeometryCollection                  NULL              NULL
Empty LineString                          Empty LineString                          NULL              NULL
Empty LineString                          Faraway point                             NULL              NULL
Empty LineString                          Line going through left and right square  NULL              NULL
Empty LineString                          NULL                                      NULL              NULL
Empty LineString                          Point middle of Left Square               NULL              NULL
Empty LineString                          Point middle of Right Square              NULL              NULL
Empty LineString                          Square (left)                             NULL              NULL
Empty LineString                          Square (right)                            NULL              NULL
Empty LineString                          Square overlapping left and right square  NULL              NULL
Faraway point                             Empty GeometryCollection                  NULL              NULL
Faraway point                             Empty LineString                          NULL              NULL
Faraway point                             Faraway point                             0                 0
Faraway point                             Line going through left and right square  6.36396103067893  7.10633520177595
Faraway point                             NULL                                      NULL              NULL
Faraway point                             Point middle of Left Square               7.10633520177595  7.10633520177595
Faraway point                             Point middle of Right Square              6.36396103067893  6.36396103067893
Faraway point                             Square (left)                             6.40312423743285  7.81024967590665
Faraway point                             Square (right)                            5.65685424949238  7.07106781186548
Faraway point                             Square overlapping left and right square  5.65685424949238  7.14212853426764
Line going through left and right square  Empty GeometryCollection                  NULL              NULL
Line going through left and right square  Empty LineString                          NULL              NULL
Line going through left and right square  Faraway point                             6.36396103067893  7.10633520177595
Line going through left and right square  Line going through left and right square  0                 1
Line going through left and right square  NULL                                      NULL              NULL
Line going through left and right square  Point middle of Left Square               0                 1
Line going through left and right square  Point middle of Right Square              0                 1
Line going through left and right square  Square (left)                             0                 1.58113883008419
Line going through left and right square  Square (right)                            0                 1.58113883008419
Line going through left and right square  Square overlapping left and right square  0                 1.58113883008419
NULL                                      Empty GeometryCollection                  NULL              NULL
NULL                                      Empty LineString                          NULL              NULL
NULL                                      Faraway point                             NULL              NULL
NULL                                      Line going through left and right square  NULL              NULL
NULL                                      NULL                                      NULL              NULL
NULL                                      Point middle of Left Square               NULL              NULL
NULL                                      Point middle of Right Square              NULL              NULL
NULL                                      Square (left)                             NULL              NULL
NULL                                      Square (right)                            NULL              NULL
NULL                                      Square overlapping left and right square  NULL              NULL
Point middle of Left Square               Empty GeometryCollection                  NULL              NULL
Point middle of Left Square               Empty LineString                          NULL              NULL
Point middle of Left Square               Faraway point                             7.10633520177595  7.10633520177595
Point middle of Left Square               Line going through left and right square  0                 1
Point middle of Left Square               NULL                                      NULL              NULL
Point middle of Left Square               Point middle of Left Square               0                 0
Point middle of Left Square               Point middle of Right Square              1                 1
Point middle of Left Square               Square (left)                             0                 0.707106781186548
Point middle of Left Square               Square (right)                            0.5               1.58113883008419
Point middle of Left Square               Square overlapping left and right square  0.4               1.58113883008419
Point middle of Right Square              Empty GeometryCollection                  NULL              NULL
Point middle of Right Square              Empty LineString                          NULL              NULL
Point middle of Right Square              Faraway point                             6.36396103067893  6.36396103067893
Point middle of Right Square              Line going through left and right square  0                 1
Point middle of Right Square              NULL                                      NULL              NULL
Point middle of Right Square              Point middle of Left Square               1                 1
Point middle of Right Square              Point middle of Right Square              0                 0
Point middle of Right Square              Square (left)                             0.5               1.58113883008419
Point middle of Right Square              Square (right)                            0                 0.707106781186548
Point middle of Right Square              Square overlapping left and right square  0                 0.781024967590665
Square (left)                             Empty GeometryCollection                  NULL              NULL
Square (left)                             Empty LineString                          NULL              NULL
Square (left)                             Faraway point                             6.40312423743285  7.81024967590665
Square (left)                             Line going through left and right square  0                 1.58113883008419
Square (left)                             NULL                                      NULL              NULL
Square (left)                             Point middle of Left Square               0                 0.707106781186548
Square (left)                             Point middle of Right Square              0.5               1.58113883008419
Square (left)                             Square (left)                             0                 1.4142135623731
Square (left)                             Square (right)                            0                 2.23606797749979
Square (left)                             Square overlapping left and right square  0                 2.23606797749979
Square (right)                            Empty GeometryCollection                  NULL              NULL
Square (right)                            Empty LineString                          NULL              NULL
Square (right)                            Faraway point                             5.65685424949238  7.07106781186548
Square (right)                            Line going through left and right square  0                 1.58113883008419
Square (right)                            NULL                                      NULL              NULL
Square (right)                            Point middle of Left Square               0.5               1.58113883008419
Square (right)                            Point middle of Right Square              0                 0.707106781186548
Square (right)                            Square (left)                             0                 2.23606797749979
Square (right)                            Square (right)                            0                 1.4142135623731
Square (right)                            Square overlapping left and right square  0                 1.48660687473185
Square overlapping left and right square  Empty GeometryCollection                  NULL              NULL
Square overlapping left and right square  Empty LineString                          NULL              NULL
Square overlapping left and right square  Faraway point                             5.65685424949238  7.14212853426764
Square overlapping left and right square  Line going through left and right square  0                 1.58113883008419
Square overlapping left and right square  NULL                                      NULL              NULL
Square overlapping left and right square  Point middle of Left Square               0.4               1.58113883008419
Square overlapping left and right square  Point middle of Right Square              0                 0.781024967590665
Square overlapping left and right square  Square (left)                             0                 2.23606797749979
Square overlapping left and right square  Square (right)                            0                 1.48660687473185
Square overlapping left and right square  Square overlapping left and right square  0                 1.48660687473185

# Binary predicates
query TTBBBBBBBBBB
SELECT
  a.dsc,
  b.dsc,
  ST_Covers(a.geom, b.geom),
  ST_CoveredBy(a.geom, b.geom),
  ST_Contains(a.geom, b.geom),
  ST_ContainsProperly(a.geom, b.geom),
  ST_Crosses(a.geom, b.geom),
  ST_Equals(a.geom, b.geom),
  ST_Intersects(a.geom, b.geom),
  ST_Overlaps(a.geom, b.geom),
  ST_Touches(a.geom, b.geom),
  ST_Within(a.geom, b.geom)
FROM geom_operators_test a
JOIN geom_operators_test b ON (1=1)
ORDER BY a.dsc, b.dsc
----
Empty GeometryCollection                  Empty GeometryCollection                  false  false  false  false  false  true   false  false  false  false
Empty GeometryCollection                  Empty LineString                          false  false  false  false  false  true   false  false  false  false
Empty GeometryCollection                  Faraway point                             false  false  false  false  false  false  false  false  false  false
Empty GeometryCollection                  Line going through left and right square  false  false  false  false  false  false  false  false  false  false
Empty GeometryCollection                  NULL                                      NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL
Empty GeometryCollection                  Point middle of Left Square               false  false  false  false  false  false  false  false  false  false
Empty GeometryCollection                  Point middle of Right Square              false  false  false  false  false  false  false  false  false  false
Empty GeometryCollection                  Square (left)                             false  false  false  false  false  false  false  false  false  false
Empty GeometryCollection                  Square (right)                            false  false  false  false  false  false  false  false  false  false
Empty GeometryCollection                  Square overlapping left and right square  false  false  false  false  false  false  false  false  false  false
Empty LineString                          Empty GeometryCollection                  false  false  false  false  false  true   false  false  false  false
Empty LineString                          Empty LineString                          false  false  false  false  false  true   false  false  false  false
Empty LineString                          Faraway point                             false  false  false  false  false  false  false  false  false  false
Empty LineString                          Line going through left and right square  false  false  false  false  false  false  false  false  false  false
Empty LineString                          NULL                                      NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL
Empty LineString                          Point middle of Left Square               false  false  false  false  false  false  false  false  false  false
Empty LineString                          Point middle of Right Square              false  false  false  false  false  false  false  false  false  false
Empty LineString                          Square (left)                             false  false  false  false  false  false  false  false  false  false
Empty LineString                          Square (right)                            false  false  false  false  false  false  false  false  false  false
Empty LineString                          Square overlapping left and right square  false  false  false  false  false  false  false  false  false  false
Faraway point                             Empty GeometryCollection                  false  false  false  false  false  false  false  false  false  false
Faraway point                             Empty LineString                          false  false  false  false  false  false  false  false  false  false
Faraway point                             Faraway point                             true   true   true   true   false  true   true   false  false  true
Faraway point                             Line going through left and right square  false  false  false  false  false  false  false  false  false  false
Faraway point                             NULL                                      NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL
Faraway point                             Point middle of Left Square               false  false  false  false  false  false  false  false  false  false
Faraway point                             Point middle of Right Square              false  false  false  false  false  false  false  false  false  false
Faraway point                             Square (left)                             false  false  false  false  false  false  false  false  false  false
Faraway point                             Square (right)                            false  false  false  false  false  false  false  false  false  false
Faraway point                             Square overlapping left and right square  false  false  false  false  false  false  false  false  false  false
Line going through left and right square  Empty GeometryCollection                  false  false  false  false  false  false  false  false  false  false
Line going through left and right square  Empty LineString                          false  false  false  false  false  false  false  false  false  false
Line going through left and right square  Faraway point                             false  false  false  false  false  false  false  false  false  false
Line going through left and right square  Line going through left and right square  true   true   true   false  false  true   true   false  false  true
Line going through left and right square  NULL                                      NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL
Line going through left and right square  Point middle of Left Square               true   false  false  false  false  false  true   false  true   false
Line going through left and right square  Point middle of Right Square              true   false  false  false  false  false  true   false  true   false
Line going through left and right square  Square (left)                             false  false  false  false  true   false  true   false  false  false
Line going through left and right square  Square (right)                            false  false  false  false  true   false  true   false  false  false
Line going through left and right square  Square overlapping left and right square  false  false  false  false  true   false  true   false  false  false
NULL                                      Empty GeometryCollection                  NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL
NULL                                      Empty LineString                          NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL
NULL                                      Faraway point                             NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL
NULL                                      Line going through left and right square  NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL
NULL                                      NULL                                      NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL
NULL                                      Point middle of Left Square               NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL
NULL                                      Point middle of Right Square              NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL
NULL                                      Square (left)                             NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL
NULL                                      Square (right)                            NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL
NULL                                      Square overlapping left and right square  NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL
Point middle of Left Square               Empty GeometryCollection                  false  false  false  false  false  false  false  false  false  false
Point middle of Left Square               Empty LineString                          false  false  false  false  false  false  false  false  false  false
Point middle of Left Square               Faraway point                             false  false  false  false  false  false  false  false  false  false
Point middle of Left Square               Line going through left and right square  false  true   false  false  false  false  true   false  true   false
Point middle of Left Square               NULL                                      NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL
Point middle of Left Square               Point middle of Left Square               true   true   true   true   false  true   true   false  false  true
Point middle of Left Square               Point middle of Right Square              false  false  false  false  false  false  false  false  false  false
Point middle of Left Square               Square (left)                             false  true   false  false  false  false  true   false  false  true
Point middle of Left Square               Square (right)                            false  false  false  false  false  false  false  false  false  false
Point middle of Left Square               Square overlapping left and right square  false  false  false  false  false  false  false  false  false  false
Point middle of Right Square              Empty GeometryCollection                  false  false  false  false  false  false  false  false  false  false
Point middle of Right Square              Empty LineString                          false  false  false  false  false  false  false  false  false  false
Point middle of Right Square              Faraway point                             false  false  false  false  false  false  false  false  false  false
Point middle of Right Square              Line going through left and right square  false  true   false  false  false  false  true   false  true   false
Point middle of Right Square              NULL                                      NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL
Point middle of Right Square              Point middle of Left Square               false  false  false  false  false  false  false  false  false  false
Point middle of Right Square              Point middle of Right Square              true   true   true   true   false  true   true   false  false  true
Point middle of Right Square              Square (left)                             false  false  false  false  false  false  false  false  false  false
Point middle of Right Square              Square (right)                            false  true   false  false  false  false  true   false  false  true
Point middle of Right Square              Square overlapping left and right square  false  true   false  false  false  false  true   false  false  true
Square (left)                             Empty GeometryCollection                  false  false  false  false  false  false  false  false  false  false
Square (left)                             Empty LineString                          false  false  false  false  false  false  false  false  false  false
Square (left)                             Faraway point                             false  false  false  false  false  false  false  false  false  false
Square (left)                             Line going through left and right square  false  false  false  false  true   false  true   false  false  false
Square (left)                             NULL                                      NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL
Square (left)                             Point middle of Left Square               true   false  true   true   false  false  true   false  false  false
Square (left)                             Point middle of Right Square              false  false  false  false  false  false  false  false  false  false
Square (left)                             Square (left)                             true   true   true   false  false  true   true   false  false  true
Square (left)                             Square (right)                            false  false  false  false  false  false  true   false  true   false
Square (left)                             Square overlapping left and right square  false  false  false  false  false  false  true   true   false  false
Square (right)                            Empty GeometryCollection                  false  false  false  false  false  false  false  false  false  false
Square (right)                            Empty LineString                          false  false  false  false  false  false  false  false  false  false
Square (right)                            Faraway point                             false  false  false  false  false  false  false  false  false  false
Square (right)                            Line going through left and right square  false  false  false  false  true   false  true   false  false  false
Square (right)                            NULL                                      NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL
Square (right)                            Point middle of Left Square               false  false  false  false  false  false  false  false  false  false
Square (right)                            Point middle of Right Square              true   false  true   true   false  false  true   false  false  false
Square (right)                            Square (left)                             false  false  false  false  false  false  true   false  true   false
Square (right)                            Square (right)                            true   true   true   false  false  true   true   false  false  true
Square (right)                            Square overlapping left and right square  false  true   false  false  false  false  true   false  false  true
Square overlapping left and right square  Empty GeometryCollection                  false  false  false  false  false  false  false  false  false  false
Square overlapping left and right square  Empty LineString                          false  false  false  false  false  false  false  false  false  false
Square overlapping left and right square  Faraway point                             false  false  false  false  false  false  false  false  false  false
Square overlapping left and right square  Line going through left and right square  false  false  false  false  true   false  true   false  false  false
Square overlapping left and right square  NULL                                      NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL   NULL
Square overlapping left and right square  Point middle of Left Square               false  false  false  false  false  false  false  false  false  false
Square overlapping left and right square  Point middle of Right Square              true   false  true   true   false  false  true   false  false  false
Square overlapping left and right square  Square (left)                             false  false  false  false  false  false  true   true   false  false
Square overlapping left and right square  Square (right)                            true   false  true   false  false  false  true   false  false  false
Square overlapping left and right square  Square overlapping left and right square  true   true   true   false  false  true   true   false  false  true

# DWithin
query TTBB
SELECT
  a.dsc,
  b.dsc,
  ST_DWithin(a.geom, b.geom, 1),
  ST_DFullyWithin(a.geom, b.geom, 1)
FROM geom_operators_test a
JOIN geom_operators_test b ON (1=1)
ORDER BY a.dsc, b.dsc
----
Empty GeometryCollection                  Empty GeometryCollection                  false  false
Empty GeometryCollection                  Empty LineString                          false  false
Empty GeometryCollection                  Faraway point                             false  false
Empty GeometryCollection                  Line going through left and right square  false  false
Empty GeometryCollection                  NULL                                      NULL   NULL
Empty GeometryCollection                  Point middle of Left Square               false  false
Empty GeometryCollection                  Point middle of Right Square              false  false
Empty GeometryCollection                  Square (left)                             false  false
Empty GeometryCollection                  Square (right)                            false  false
Empty GeometryCollection                  Square overlapping left and right square  false  false
Empty LineString                          Empty GeometryCollection                  false  false
Empty LineString                          Empty LineString                          false  false
Empty LineString                          Faraway point                             false  false
Empty LineString                          Line going through left and right square  false  false
Empty LineString                          NULL                                      NULL   NULL
Empty LineString                          Point middle of Left Square               false  false
Empty LineString                          Point middle of Right Square              false  false
Empty LineString                          Square (left)                             false  false
Empty LineString                          Square (right)                            false  false
Empty LineString                          Square overlapping left and right square  false  false
Faraway point                             Empty GeometryCollection                  false  false
Faraway point                             Empty LineString                          false  false
Faraway point                             Faraway point                             true   true
Faraway point                             Line going through left and right square  false  false
Faraway point                             NULL                                      NULL   NULL
Faraway point                             Point middle of Left Square               false  false
Faraway point                             Point middle of Right Square              false  false
Faraway point                             Square (left)                             false  false
Faraway point                             Square (right)                            false  false
Faraway point                             Square overlapping left and right square  false  false
Line going through left and right square  Empty GeometryCollection                  false  false
Line going through left and right square  Empty LineString                          false  false
Line going through left and right square  Faraway point                             false  false
Line going through left and right square  Line going through left and right square  true   true
Line going through left and right square  NULL                                      NULL   NULL
Line going through left and right square  Point middle of Left Square               true   true
Line going through left and right square  Point middle of Right Square              true   true
Line going through left and right square  Square (left)                             true   false
Line going through left and right square  Square (right)                            true   false
Line going through left and right square  Square overlapping left and right square  true   false
NULL                                      Empty GeometryCollection                  NULL   NULL
NULL                                      Empty LineString                          NULL   NULL
NULL                                      Faraway point                             NULL   NULL
NULL                                      Line going through left and right square  NULL   NULL
NULL                                      NULL                                      NULL   NULL
NULL                                      Point middle of Left Square               NULL   NULL
NULL                                      Point middle of Right Square              NULL   NULL
NULL                                      Square (left)                             NULL   NULL
NULL                                      Square (right)                            NULL   NULL
NULL                                      Square overlapping left and right square  NULL   NULL
Point middle of Left Square               Empty GeometryCollection                  false  false
Point middle of Left Square               Empty LineString                          false  false
Point middle of Left Square               Faraway point                             false  false
Point middle of Left Square               Line going through left and right square  true   true
Point middle of Left Square               NULL                                      NULL   NULL
Point middle of Left Square               Point middle of Left Square               true   true
Point middle of Left Square               Point middle of Right Square              true   true
Point middle of Left Square               Square (left)                             true   true
Point middle of Left Square               Square (right)                            true   false
Point middle of Left Square               Square overlapping left and right square  true   false
Point middle of Right Square              Empty GeometryCollection                  false  false
Point middle of Right Square              Empty LineString                          false  false
Point middle of Right Square              Faraway point                             false  false
Point middle of Right Square              Line going through left and right square  true   true
Point middle of Right Square              NULL                                      NULL   NULL
Point middle of Right Square              Point middle of Left Square               true   true
Point middle of Right Square              Point middle of Right Square              true   true
Point middle of Right Square              Square (left)                             true   false
Point middle of Right Square              Square (right)                            true   true
Point middle of Right Square              Square overlapping left and right square  true   true
Square (left)                             Empty GeometryCollection                  false  false
Square (left)                             Empty LineString                          false  false
Square (left)                             Faraway point                             false  false
Square (left)                             Line going through left and right square  true   false
Square (left)                             NULL                                      NULL   NULL
Square (left)                             Point middle of Left Square               true   true
Square (left)                             Point middle of Right Square              true   false
Square (left)                             Square (left)                             true   false
Square (left)                             Square (right)                            true   false
Square (left)                             Square overlapping left and right square  true   false
Square (right)                            Empty GeometryCollection                  false  false
Square (right)                            Empty LineString                          false  false
Square (right)                            Faraway point                             false  false
Square (right)                            Line going through left and right square  true   false
Square (right)                            NULL                                      NULL   NULL
Square (right)                            Point middle of Left Square               true   false
Square (right)                            Point middle of Right Square              true   true
Square (right)                            Square (left)                             true   false
Square (right)                            Square (right)                            true   false
Square (right)                            Square overlapping left and right square  true   false
Square overlapping left and right square  Empty GeometryCollection                  false  false
Square overlapping left and right square  Empty LineString                          false  false
Square overlapping left and right square  Faraway point                             false  false
Square overlapping left and right square  Line going through left and right square  true   false
Square overlapping left and right square  NULL                                      NULL   NULL
Square overlapping left and right square  Point middle of Left Square               true   false
Square overlapping left and right square  Point middle of Right Square              true   true
Square overlapping left and right square  Square (left)                             true   false
Square overlapping left and right square  Square (right)                            true   false
Square overlapping left and right square  Square overlapping left and right square  true   false

# DE-9IM relations
query TTTB
SELECT
  a.dsc,
  b.dsc,
  ST_Relate(a.geom, b.geom),
  ST_Relate(a.geom, b.geom, 'T**FF*FF*')
FROM geom_operators_test a
JOIN geom_operators_test b ON (1=1)
ORDER BY a.dsc, b.dsc
----
Empty GeometryCollection                  Empty GeometryCollection                  FFFFFFFF2  false
Empty GeometryCollection                  Empty LineString                          FFFFFFFF2  false
Empty GeometryCollection                  Faraway point                             FFFFFF0F2  false
Empty GeometryCollection                  Line going through left and right square  FFFFFF102  false
Empty GeometryCollection                  NULL                                      NULL       NULL
Empty GeometryCollection                  Point middle of Left Square               FFFFFF0F2  false
Empty GeometryCollection                  Point middle of Right Square              FFFFFF0F2  false
Empty GeometryCollection                  Square (left)                             FFFFFF212  false
Empty GeometryCollection                  Square (right)                            FFFFFF212  false
Empty GeometryCollection                  Square overlapping left and right square  FFFFFF212  false
Empty LineString                          Empty GeometryCollection                  FFFFFFFF2  false
Empty LineString                          Empty LineString                          FFFFFFFF2  false
Empty LineString                          Faraway point                             FFFFFF0F2  false
Empty LineString                          Line going through left and right square  FFFFFF102  false
Empty LineString                          NULL                                      NULL       NULL
Empty LineString                          Point middle of Left Square               FFFFFF0F2  false
Empty LineString                          Point middle of Right Square              FFFFFF0F2  false
Empty LineString                          Square (left)                             FFFFFF212  false
Empty LineString                          Square (right)                            FFFFFF212  false
Empty LineString                          Square overlapping left and right square  FFFFFF212  false
Faraway point                             Empty GeometryCollection                  FF0FFFFF2  false
Faraway point                             Empty LineString                          FF0FFFFF2  false
Faraway point                             Faraway point                             0FFFFFFF2  true
Faraway point                             Line going through left and right square  FF0FFF102  false
Faraway point                             NULL                                      NULL       NULL
Faraway point                             Point middle of Left Square               FF0FFF0F2  false
Faraway point                             Point middle of Right Square              FF0FFF0F2  false
Faraway point                             Square (left)                             FF0FFF212  false
Faraway point                             Square (right)                            FF0FFF212  false
Faraway point                             Square overlapping left and right square  FF0FFF212  false
Line going through left and right square  Empty GeometryCollection                  FF1FF0FF2  false
Line going through left and right square  Empty LineString                          FF1FF0FF2  false
Line going through left and right square  Faraway point                             FF1FF00F2  false
Line going through left and right square  Line going through left and right square  1FFF0FFF2  false
Line going through left and right square  NULL                                      NULL       NULL
Line going through left and right square  Point middle of Left Square               FF10F0FF2  false
Line going through left and right square  Point middle of Right Square              FF10F0FF2  false
Line going through left and right square  Square (left)                             1010F0212  false
Line going through left and right square  Square (right)                            1010F0212  false
Line going through left and right square  Square overlapping left and right square  1010F0212  false
NULL                                      Empty GeometryCollection                  NULL       NULL
NULL                                      Empty LineString                          NULL       NULL
NULL                                      Faraway point                             NULL       NULL
NULL                                      Line going through left and right square  NULL       NULL
NULL                                      NULL                                      NULL       NULL
NULL                                      Point middle of Left Square               NULL       NULL
NULL                                      Point middle of Right Square              NULL       NULL
NULL                                      Square (left)                             NULL       NULL
NULL                                      Square (right)                            NULL       NULL
NULL                                      Square overlapping left and right square  NULL       NULL
Point middle of Left Square               Empty GeometryCollection                  FF0FFFFF2  false
Point middle of Left Square               Empty LineString                          FF0FFFFF2  false
Point middle of Left Square               Faraway point                             FF0FFF0F2  false
Point middle of Left Square               Line going through left and right square  F0FFFF102  false
Point middle of Left Square               NULL                                      NULL       NULL
Point middle of Left Square               Point middle of Left Square               0FFFFFFF2  true
Point middle of Left Square               Point middle of Right Square              FF0FFF0F2  false
Point middle of Left Square               Square (left)                             0FFFFF212  false
Point middle of Left Square               Square (right)                            FF0FFF212  false
Point middle of Left Square               Square overlapping left and right square  FF0FFF212  false
Point middle of Right Square              Empty GeometryCollection                  FF0FFFFF2  false
Point middle of Right Square              Empty LineString                          FF0FFFFF2  false
Point middle of Right Square              Faraway point                             FF0FFF0F2  false
Point middle of Right Square              Line going through left and right square  F0FFFF102  false
Point middle of Right Square              NULL                                      NULL       NULL
Point middle of Right Square              Point middle of Left Square               FF0FFF0F2  false
Point middle of Right Square              Point middle of Right Square              0FFFFFFF2  true
Point middle of Right Square              Square (left)                             FF0FFF212  false
Point middle of Right Square              Square (right)                            0FFFFF212  false
Point middle of Right Square              Square overlapping left and right square  0FFFFF212  false
Square (left)                             Empty GeometryCollection                  FF2FF1FF2  false
Square (left)                             Empty LineString                          FF2FF1FF2  false
Square (left)                             Faraway point                             FF2FF10F2  false
Square (left)                             Line going through left and right square  1020F1102  false
Square (left)                             NULL                                      NULL       NULL
Square (left)                             Point middle of Left Square               0F2FF1FF2  true
Square (left)                             Point middle of Right Square              FF2FF10F2  false
Square (left)                             Square (left)                             2FFF1FFF2  false
Square (left)                             Square (right)                            FF2F11212  false
Square (left)                             Square overlapping left and right square  212111212  false
Square (right)                            Empty GeometryCollection                  FF2FF1FF2  false
Square (right)                            Empty LineString                          FF2FF1FF2  false
Square (right)                            Faraway point                             FF2FF10F2  false
Square (right)                            Line going through left and right square  1020F1102  false
Square (right)                            NULL                                      NULL       NULL
Square (right)                            Point middle of Left Square               FF2FF10F2  false
Square (right)                            Point middle of Right Square              0F2FF1FF2  true
Square (right)                            Square (left)                             FF2F11212  false
Square (right)                            Square (right)                            2FFF1FFF2  false
Square (right)                            Square overlapping left and right square  2FF11F212  false
Square overlapping left and right square  Empty GeometryCollection                  FF2FF1FF2  false
Square overlapping left and right square  Empty LineString                          FF2FF1FF2  false
Square overlapping left and right square  Faraway point                             FF2FF10F2  false
Square overlapping left and right square  Line going through left and right square  1020F1102  false
Square overlapping left and right square  NULL                                      NULL       NULL
Square overlapping left and right square  Point middle of Left Square               FF2FF10F2  false
Square overlapping left and right square  Point middle of Right Square              0F2FF1FF2  true
Square overlapping left and right square  Square (left)                             212111212  false
Square overlapping left and right square  Square (right)                            212F11FF2  false
Square overlapping left and right square  Square overlapping left and right square  2FFF1FFF2  false

# basic metadata
query TTIIITTT
SELECT
  a.dsc,
  ST_GeometryType(a.geom),
  ST_NDims(a.geom),
  ST_NPoints(a.geom),
  ST_NumGeometries(a.geom),
  ST_GeometryN(a.geom, 0),
  ST_GeometryN(a.geom, 1),
  ST_GeometryN(a.geom, 2)
FROM geom_operators_test a
ORDER BY a.dsc
----
Empty GeometryCollection                  ST_GeometryCollection  0     0     0     NULL  NULL                                                                                                                                                                                        NULL
Empty LineString                          ST_LineString          2     0     0     NULL  010200000000000000                                                                                                                                                                          NULL
Faraway point                             ST_Point               2     1     1     NULL  010100000000000000000014400000000000001440                                                                                                                                                  NULL
Line going through left and right square  ST_LineString          2     2     1     NULL  010200000002000000000000000000E0BF000000000000E03F000000000000E03F000000000000E03F                                                                                                          NULL
NULL                                      NULL                   NULL  NULL  NULL  NULL  NULL                                                                                                                                                                                        NULL
Point middle of Left Square               ST_Point               2     1     1     NULL  0101000000000000000000E0BF000000000000E03F                                                                                                                                                  NULL
Point middle of Right Square              ST_Point               2     1     1     NULL  0101000000000000000000E03F000000000000E03F                                                                                                                                                  NULL
Square (left)                             ST_Polygon             2     5     1     NULL  01030000000100000005000000000000000000F0BF0000000000000000000000000000000000000000000000000000000000000000000000000000F03F000000000000F0BF000000000000F03F000000000000F0BF0000000000000000  NULL
Square (right)                            ST_Polygon             2     5     1     NULL  0103000000010000000500000000000000000000000000000000000000000000000000F03F0000000000000000000000000000F03F000000000000F03F0000000000000000000000000000F03F00000000000000000000000000000000  NULL
Square overlapping left and right square  ST_Polygon             2     5     1     NULL  010300000001000000050000009A9999999999B9BF0000000000000000000000000000F03F0000000000000000000000000000F03F000000000000F03F9A9999999999B9BF000000000000F03F9A9999999999B9BF0000000000000000  NULL

# Point specific operations
query RR
SELECT
  ST_X(a.geom),
  ST_Y(a.geom)
FROM (VALUES
  ('POINT(1.0 2.0)'::geometry),
  ('POINT(33.0 66.0)'::geometry)
--  ('0101000000000000000000F87F000000000000F87F'::geometry) -- POINT EMPTY -- blocked on https://github.com/twpayne/go-geom/pull/159
) a(geom)
----
1   2
33  66

statement error argument to ST_X\(\) must have shape POINT
SELECT ST_X('LINESTRING(0.0 0.0, 1.0 1.0)')

statement error argument to ST_Y\(\) must have shape POINT
SELECT ST_Y('LINESTRING(0.0 0.0, 1.0 1.0)')

# LineString specific operations
query TTITTTTT
SELECT
  ST_AsEWKT(ST_StartPoint(a.geom)),
  ST_AsEWKT(ST_EndPoint(a.geom)),
  ST_NumPoints(a.geom),
  ST_AsEWKT(ST_PointN(a.geom, 0)),
  ST_AsEWKT(ST_PointN(a.geom, 1)),
  ST_AsEWKT(ST_PointN(a.geom, 2)),
  ST_AsEWKT(ST_PointN(a.geom, 3)),
  ST_AsEWKT(ST_PointN(a.geom, 4))
FROM (VALUES
  ('LINESTRING EMPTY'::geometry),
  ('LINESTRING (0.0 0.0, 1.0 1.0, 2.0 2.0)'::geometry),
  ('SRID=4326;LINESTRING (0.0 0.0, 1.0 1.0, 2.0 2.0)'::geometry),
  ('MULTILINESTRING ((0.0 0.0, 1.0 1.0, 2.0 2.0), (3.0 3.0, 4.0 4.0))'::geometry)
) a(geom)
----
NULL                   NULL                   0     NULL  NULL                   NULL                   NULL                   NULL
POINT (0 0)            POINT (2 2)            3     NULL  POINT (0 0)            POINT (1 1)            POINT (2 2)            NULL
SRID=4326;POINT (0 0)  SRID=4326;POINT (2 2)  3     NULL  SRID=4326;POINT (0 0)  SRID=4326;POINT (1 1)  SRID=4326;POINT (2 2)  NULL
NULL                   NULL                   NULL  NULL  NULL                   NULL                   NULL                   NULL

# Polygon specific operations
query IIITTTT
SELECT
  ST_NRings(a.geom),
  ST_NumInteriorRing(a.geom),
  ST_NumInteriorRings(a.geom),
  ST_AsEWKT(ST_ExteriorRing(a.geom)),
  ST_AsEWKT(ST_InteriorRingN(a.geom, 0)),
  ST_AsEWKT(ST_InteriorRingN(a.geom, 1)),
  ST_AsEWKT(ST_InteriorRingN(a.geom, 2))
FROM (VALUES
  ('POLYGON EMPTY'::geometry),
  ('POLYGON((0 0,1 0, 1 1, 0 0))'::geometry),
  ('POLYGON((0 0,1 0, 1 1, 0 0),(0.1 0.1,0.9 0.1, 0.9 0.9, 0.1 0.1))'::geometry),
  ('SRID=4326;POLYGON((0 0,1 0, 1 1, 0 0),(0.1 0.1,0.9 0.1, 0.9 0.9, 0.1 0.1))'::geometry),
  ('LINESTRING EMPTY'::geometry)
) a(geom)
----
0  0     0     LINESTRING EMPTY                           NULL  NULL                                                       NULL
1  0     0     LINESTRING (0 0, 1 0, 1 1, 0 0)            NULL  NULL                                                       NULL
2  1     1     LINESTRING (0 0, 1 0, 1 1, 0 0)            NULL  LINESTRING (0.1 0.1, 0.9 0.1, 0.9 0.9, 0.1 0.1)            NULL
2  1     1     SRID=4326;LINESTRING (0 0, 1 0, 1 1, 0 0)  NULL  SRID=4326;LINESTRING (0.1 0.1, 0.9 0.1, 0.9 0.9, 0.1 0.1)  NULL
0  NULL  NULL  NULL                                       NULL  NULL                                                       NULL

# Multi-Geometry related operations.
query ITTT
SELECT
  ST_NumGeometries(a.geom),
  ST_AsEWKT(ST_GeometryN(a.geom, 0)),
  ST_AsEWKT(ST_GeometryN(a.geom, 1)),
  ST_AsEWKT(ST_GeometryN(a.geom, 2))
FROM (VALUES
  ('MULTIPOINT EMPTY'::geometry),
  ('MULTILINESTRING EMPTY'::geometry),
  ('MULTIPOLYGON EMPTY'::geometry),
  ('MULTIPOINT((0 0), (1 1), (2 2))'::geometry),
  ('SRID=4326;MULTIPOINT((0 0), (1 1), (2 2))'::geometry),
  ('MULTILINESTRING((0 0, 1 1), (2 2, 3 3))'::geometry),
  ('SRID=4326;MULTILINESTRING((0 0, 1 1), (2 2, 3 3))'::geometry),
  ('MULTIPOLYGON(((0 0,1 0, 1 1, 0 0)),((0.1 0.1,0.9 0.1, 0.9 0.9, 0.1 0.1)))'::geometry),
  ('SRID=4326;MULTIPOLYGON(((0 0,1 0, 1 1, 0 0)),((0.1 0.1,0.9 0.1, 0.9 0.9, 0.1 0.1)))'::geometry),
  ('GEOMETRYCOLLECTION (POINT (40 10),LINESTRING (10 10, 20 20, 10 40),POLYGON ((40 40, 20 45, 45 30, 40 40)))'::geometry),
  ('SRID=4326;GEOMETRYCOLLECTION (POINT (40 10),LINESTRING (10 10, 20 20, 10 40),POLYGON ((40 40, 20 45, 45 30, 40 40)))'::geometry)
) a(geom)
----
0  NULL  NULL                                      NULL
0  NULL  NULL                                      NULL
0  NULL  NULL                                      NULL
3  NULL  POINT (0 0)                               POINT (1 1)
3  NULL  SRID=4326;POINT (0 0)                     SRID=4326;POINT (1 1)
2  NULL  LINESTRING (0 0, 1 1)                     LINESTRING (2 2, 3 3)
2  NULL  SRID=4326;LINESTRING (0 0, 1 1)           SRID=4326;LINESTRING (2 2, 3 3)
2  NULL  POLYGON ((0 0, 1 0, 1 1, 0 0))            POLYGON ((0.1 0.1, 0.9 0.1, 0.9 0.9, 0.1 0.1))
2  NULL  SRID=4326;POLYGON ((0 0, 1 0, 1 1, 0 0))  SRID=4326;POLYGON ((0.1 0.1, 0.9 0.1, 0.9 0.9, 0.1 0.1))
3  NULL  POINT (40 10)                             LINESTRING (10 10, 20 20, 10 40)
3  NULL  SRID=4326;POINT (40 10)                   SRID=4326;LINESTRING (10 10, 20 20, 10 40)

subtest geog_operators

statement ok
CREATE TABLE geog_operators_test AS SELECT dsc, geom::geography AS geog FROM geom_operators_test

# Unary operators
query TRRRRRRRRR
SELECT
  a.dsc,
  ST_Area(a.geog), ST_Area(a.geog, false), ST_Area(a.geog, true),
  ST_Length(a.geog), ST_Length(a.geog, false), ST_Length(a.geog, true),
  ST_Perimeter(a.geog), ST_Perimeter(a.geog, false), ST_Perimeter(a.geog, true)
FROM geog_operators_test a
ORDER BY a.dsc
----
Empty GeometryCollection                  0                     0                     0                     0                 0                 0                 0                 0                 0
Empty LineString                          0                     0                     0                     0                 0                 0                 0                 0                 0
Faraway point                             0                     0                     0                     0                 0                 0                 0                 0                 0
Line going through left and right square  0                     0                     0                     111315.280354463  111190.845659241  111315.280354463  0                 0                 0
NULL                                      NULL                  NULL                  NULL                  NULL              NULL              NULL              NULL              NULL              NULL
Point middle of Left Square               0                     0                     0                     0                 0                 0                 0                 0                 0
Point middle of Right Square              0                     0                     0                     0                 0                 0                 0                 0                 0
Square (left)                             1.23087783614695e+10  1.23640317985177e+10  1.23087783614695e+10  0                 0                 0                 443770.917248302  444763.382959477  443770.917248302
Square (right)                            1.23087783614695e+10  1.23640317985177e+10  1.23087783614695e+10  0                 0                 0                 443770.917248302  444763.382959477  443770.917248302
Square overlapping left and right square  1.35397288423019e+10  1.36005074605892e+10  1.35397288423019e+10  0                 0                 0                 466033.131162169  467000.705209206  466033.131162169

# Binary operators
query TTRRR
SELECT
  a.dsc,
  b.dsc,
  ST_Distance(a.geog, b.geog), ST_Distance(a.geog, b.geog, false), ST_Distance(a.geog, b.geog, true)
FROM geog_operators_test a
JOIN geog_operators_test b ON (1=1)
ORDER BY a.dsc, b.dsc
----
Empty GeometryCollection                  Empty GeometryCollection                  NULL              NULL              NULL
Empty GeometryCollection                  Empty LineString                          NULL              NULL              NULL
Empty GeometryCollection                  Faraway point                             NULL              NULL              NULL
Empty GeometryCollection                  Line going through left and right square  NULL              NULL              NULL
Empty GeometryCollection                  NULL                                      NULL              NULL              NULL
Empty GeometryCollection                  Point middle of Left Square               NULL              NULL              NULL
Empty GeometryCollection                  Point middle of Right Square              NULL              NULL              NULL
Empty GeometryCollection                  Square (left)                             NULL              NULL              NULL
Empty GeometryCollection                  Square (right)                            NULL              NULL              NULL
Empty GeometryCollection                  Square overlapping left and right square  NULL              NULL              NULL
Empty LineString                          Empty GeometryCollection                  NULL              NULL              NULL
Empty LineString                          Empty LineString                          NULL              NULL              NULL
Empty LineString                          Faraway point                             NULL              NULL              NULL
Empty LineString                          Line going through left and right square  NULL              NULL              NULL
Empty LineString                          NULL                                      NULL              NULL              NULL
Empty LineString                          Point middle of Left Square               NULL              NULL              NULL
Empty LineString                          Point middle of Right Square              NULL              NULL              NULL
Empty LineString                          Square (left)                             NULL              NULL              NULL
Empty LineString                          Square (right)                            NULL              NULL              NULL
Empty LineString                          Square overlapping left and right square  NULL              NULL              NULL
Faraway point                             Empty GeometryCollection                  NULL              NULL              NULL
Faraway point                             Empty LineString                          NULL              NULL              NULL
Faraway point                             Faraway point                             0                 0                 0
Faraway point                             Line going through left and right square  705577.648328755  707142.162247235  705577.648328755
Faraway point                             NULL                                      NULL              NULL              NULL
Faraway point                             Point middle of Left Square               788297.405265007  789521.780520966  788297.405265007
Faraway point                             Point middle of Right Square              705577.648328755  707142.162247235  705577.648328755
Faraway point                             Square (left)                             710260.975395327  711311.966664979  710260.975395327
Faraway point                             Square (right)                            627129.502610754  628519.033787529  627129.502610754
Faraway point                             Square overlapping left and right square  627129.502610754  628519.033787529  627129.502610754
Line going through left and right square  Empty GeometryCollection                  NULL              NULL              NULL
Line going through left and right square  Empty LineString                          NULL              NULL              NULL
Line going through left and right square  Faraway point                             705577.648328755  707142.162247235  705577.648328755
Line going through left and right square  Line going through left and right square  0                 0                 0
Line going through left and right square  NULL                                      NULL              NULL              NULL
Line going through left and right square  Point middle of Left Square               0                 0                 0
Line going through left and right square  Point middle of Right Square              0                 0                 0
Line going through left and right square  Square (left)                             0                 0                 0
Line going through left and right square  Square (right)                            0                 0                 0
Line going through left and right square  Square overlapping left and right square  0                 0                 0
NULL                                      Empty GeometryCollection                  NULL              NULL              NULL
NULL                                      Empty LineString                          NULL              NULL              NULL
NULL                                      Faraway point                             NULL              NULL              NULL
NULL                                      Line going through left and right square  NULL              NULL              NULL
NULL                                      NULL                                      NULL              NULL              NULL
NULL                                      Point middle of Left Square               NULL              NULL              NULL
NULL                                      Point middle of Right Square              NULL              NULL              NULL
NULL                                      Square (left)                             NULL              NULL              NULL
NULL                                      Square (right)                            NULL              NULL              NULL
NULL                                      Square overlapping left and right square  NULL              NULL              NULL
Point middle of Left Square               Empty GeometryCollection                  NULL              NULL              NULL
Point middle of Left Square               Empty LineString                          NULL              NULL              NULL
Point middle of Left Square               Faraway point                             788297.405265007  789521.780520966  788297.405265007
Point middle of Left Square               Line going through left and right square  0                 0                 0
Point middle of Left Square               NULL                                      NULL              NULL              NULL
Point middle of Left Square               Point middle of Left Square               0                 0                 0
Point middle of Left Square               Point middle of Right Square              111315.280354463  111190.845659241  111315.280354463
Point middle of Left Square               Square (left)                             0                 0                 0
Point middle of Left Square               Square (right)                            55657.6401772334  55595.4228296203  55657.6401772334
Point middle of Left Square               Square overlapping left and right square  44526.1121572803  44476.338279173   44526.1121572803
Point middle of Right Square              Empty GeometryCollection                  NULL              NULL              NULL
Point middle of Right Square              Empty LineString                          NULL              NULL              NULL
Point middle of Right Square              Faraway point                             705577.648328755  707142.162247235  705577.648328755
Point middle of Right Square              Line going through left and right square  0                 0                 0
Point middle of Right Square              NULL                                      NULL              NULL              NULL
Point middle of Right Square              Point middle of Left Square               111315.280354463  111190.845659241  111315.280354463
Point middle of Right Square              Point middle of Right Square              0                 0                 0
Point middle of Right Square              Square (left)                             55657.6401772334  55595.4228296203  55657.6401772334
Point middle of Right Square              Square (right)                            0                 0                 0
Point middle of Right Square              Square overlapping left and right square  0                 0                 0
Square (left)                             Empty GeometryCollection                  NULL              NULL              NULL
Square (left)                             Empty LineString                          NULL              NULL              NULL
Square (left)                             Faraway point                             710260.975395327  711311.966664979  710260.975395327
Square (left)                             Line going through left and right square  0                 0                 0
Square (left)                             NULL                                      NULL              NULL              NULL
Square (left)                             Point middle of Left Square               0                 0                 0
Square (left)                             Point middle of Right Square              55657.6401772334  55595.4228296203  55657.6401772334
Square (left)                             Square (left)                             0                 0                 0
Square (left)                             Square (right)                            0                 0                 0
Square (left)                             Square overlapping left and right square  0                 0                 0
Square (right)                            Empty GeometryCollection                  NULL              NULL              NULL
Square (right)                            Empty LineString                          NULL              NULL              NULL
Square (right)                            Faraway point                             627129.502610754  628519.033787529  627129.502610754
Square (right)                            Line going through left and right square  0                 0                 0
Square (right)                            NULL                                      NULL              NULL              NULL
Square (right)                            Point middle of Left Square               55657.6401772334  55595.4228296203  55657.6401772334
Square (right)                            Point middle of Right Square              0                 0                 0
Square (right)                            Square (left)                             0                 0                 0
Square (right)                            Square (right)                            0                 0                 0
Square (right)                            Square overlapping left and right square  0                 0                 0
Square overlapping left and right square  Empty GeometryCollection                  NULL              NULL              NULL
Square overlapping left and right square  Empty LineString                          NULL              NULL              NULL
Square overlapping left and right square  Faraway point                             627129.502610754  628519.033787529  627129.502610754
Square overlapping left and right square  Line going through left and right square  0                 0                 0
Square overlapping left and right square  NULL                                      NULL              NULL              NULL
Square overlapping left and right square  Point middle of Left Square               44526.1121572803  44476.338279173   44526.1121572803
Square overlapping left and right square  Point middle of Right Square              0                 0                 0
Square overlapping left and right square  Square (left)                             0                 0                 0
Square overlapping left and right square  Square (right)                            0                 0                 0
Square overlapping left and right square  Square overlapping left and right square  0                 0                 0

# Binary predicates
query TTBBB
SELECT
  a.dsc,
  b.dsc,
  ST_Covers(a.geog, b.geog),
  ST_CoveredBy(a.geog, b.geog),
  ST_Intersects(a.geog, b.geog)
FROM geog_operators_test a
JOIN geog_operators_test b ON (1=1)
ORDER BY a.dsc, b.dsc
----
Empty GeometryCollection                  Empty GeometryCollection                  false  false  false
Empty GeometryCollection                  Empty LineString                          false  false  false
Empty GeometryCollection                  Faraway point                             false  false  false
Empty GeometryCollection                  Line going through left and right square  false  false  false
Empty GeometryCollection                  NULL                                      NULL   NULL   NULL
Empty GeometryCollection                  Point middle of Left Square               false  false  false
Empty GeometryCollection                  Point middle of Right Square              false  false  false
Empty GeometryCollection                  Square (left)                             false  false  false
Empty GeometryCollection                  Square (right)                            false  false  false
Empty GeometryCollection                  Square overlapping left and right square  false  false  false
Empty LineString                          Empty GeometryCollection                  false  false  false
Empty LineString                          Empty LineString                          false  false  false
Empty LineString                          Faraway point                             false  false  false
Empty LineString                          Line going through left and right square  false  false  false
Empty LineString                          NULL                                      NULL   NULL   NULL
Empty LineString                          Point middle of Left Square               false  false  false
Empty LineString                          Point middle of Right Square              false  false  false
Empty LineString                          Square (left)                             false  false  false
Empty LineString                          Square (right)                            false  false  false
Empty LineString                          Square overlapping left and right square  false  false  false
Faraway point                             Empty GeometryCollection                  false  false  false
Faraway point                             Empty LineString                          false  false  false
Faraway point                             Faraway point                             true   true   true
Faraway point                             Line going through left and right square  false  false  false
Faraway point                             NULL                                      NULL   NULL   NULL
Faraway point                             Point middle of Left Square               false  false  false
Faraway point                             Point middle of Right Square              false  false  false
Faraway point                             Square (left)                             false  false  false
Faraway point                             Square (right)                            false  false  false
Faraway point                             Square overlapping left and right square  false  false  false
Line going through left and right square  Empty GeometryCollection                  false  false  false
Line going through left and right square  Empty LineString                          false  false  false
Line going through left and right square  Faraway point                             false  false  false
Line going through left and right square  Line going through left and right square  true   true   true
Line going through left and right square  NULL                                      NULL   NULL   NULL
Line going through left and right square  Point middle of Left Square               true   false  true
Line going through left and right square  Point middle of Right Square              true   false  true
Line going through left and right square  Square (left)                             false  false  true
Line going through left and right square  Square (right)                            false  false  true
Line going through left and right square  Square overlapping left and right square  false  false  true
NULL                                      Empty GeometryCollection                  NULL   NULL   NULL
NULL                                      Empty LineString                          NULL   NULL   NULL
NULL                                      Faraway point                             NULL   NULL   NULL
NULL                                      Line going through left and right square  NULL   NULL   NULL
NULL                                      NULL                                      NULL   NULL   NULL
NULL                                      Point middle of Left Square               NULL   NULL   NULL
NULL                                      Point middle of Right Square              NULL   NULL   NULL
NULL                                      Square (left)                             NULL   NULL   NULL
NULL                                      Square (right)                            NULL   NULL   NULL
NULL                                      Square overlapping left and right square  NULL   NULL   NULL
Point middle of Left Square               Empty GeometryCollection                  false  false  false
Point middle of Left Square               Empty LineString                          false  false  false
Point middle of Left Square               Faraway point                             false  false  false
Point middle of Left Square               Line going through left and right square  false  true   true
Point middle of Left Square               NULL                                      NULL   NULL   NULL
Point middle of Left Square               Point middle of Left Square               true   true   true
Point middle of Left Square               Point middle of Right Square              false  false  false
Point middle of Left Square               Square (left)                             false  true   true
Point middle of Left Square               Square (right)                            false  false  false
Point middle of Left Square               Square overlapping left and right square  false  false  false
Point middle of Right Square              Empty GeometryCollection                  false  false  false
Point middle of Right Square              Empty LineString                          false  false  false
Point middle of Right Square              Faraway point                             false  false  false
Point middle of Right Square              Line going through left and right square  false  true   true
Point middle of Right Square              NULL                                      NULL   NULL   NULL
Point middle of Right Square              Point middle of Left Square               false  false  false
Point middle of Right Square              Point middle of Right Square              true   true   true
Point middle of Right Square              Square (left)                             false  false  false
Point middle of Right Square              Square (right)                            false  true   true
Point middle of Right Square              Square overlapping left and right square  false  true   true
Square (left)                             Empty GeometryCollection                  false  false  false
Square (left)                             Empty LineString                          false  false  false
Square (left)                             Faraway point                             false  false  false
Square (left)                             Line going through left and right square  false  false  true
Square (left)                             NULL                                      NULL   NULL   NULL
Square (left)                             Point middle of Left Square               true   false  true
Square (left)                             Point middle of Right Square              false  false  false
Square (left)                             Square (left)                             true   true   true
Square (left)                             Square (right)                            false  false  true
Square (left)                             Square overlapping left and right square  false  false  true
Square (right)                            Empty GeometryCollection                  false  false  false
Square (right)                            Empty LineString                          false  false  false
Square (right)                            Faraway point                             false  false  false
Square (right)                            Line going through left and right square  false  false  true
Square (right)                            NULL                                      NULL   NULL   NULL
Square (right)                            Point middle of Left Square               false  false  false
Square (right)                            Point middle of Right Square              true   false  true
Square (right)                            Square (left)                             false  false  true
Square (right)                            Square (right)                            true   true   true
Square (right)                            Square overlapping left and right square  false  false  true
Square overlapping left and right square  Empty GeometryCollection                  false  false  false
Square overlapping left and right square  Empty LineString                          false  false  false
Square overlapping left and right square  Faraway point                             false  false  false
Square overlapping left and right square  Line going through left and right square  false  false  true
Square overlapping left and right square  NULL                                      NULL   NULL   NULL
Square overlapping left and right square  Point middle of Left Square               false  false  false
Square overlapping left and right square  Point middle of Right Square              true   false  true
Square overlapping left and right square  Square (left)                             false  false  true
Square overlapping left and right square  Square (right)                            false  false  true
Square overlapping left and right square  Square overlapping left and right square  true   true   true

# DWithin
query TTBBB
SELECT
  a.dsc,
  b.dsc,
  ST_DWithin(a.geog, b.geog, 70558),
  ST_DWithin(a.geog, b.geog, 70558, false),
  ST_DWithin(a.geog, b.geog, 70558, true)
FROM geog_operators_test a
JOIN geog_operators_test b ON (1=1)
ORDER BY a.dsc, b.dsc
----
Empty GeometryCollection                  Empty GeometryCollection                  false  false  false
Empty GeometryCollection                  Empty LineString                          false  false  false
Empty GeometryCollection                  Faraway point                             false  false  false
Empty GeometryCollection                  Line going through left and right square  false  false  false
Empty GeometryCollection                  NULL                                      NULL   NULL   NULL
Empty GeometryCollection                  Point middle of Left Square               false  false  false
Empty GeometryCollection                  Point middle of Right Square              false  false  false
Empty GeometryCollection                  Square (left)                             false  false  false
Empty GeometryCollection                  Square (right)                            false  false  false
Empty GeometryCollection                  Square overlapping left and right square  false  false  false
Empty LineString                          Empty GeometryCollection                  false  false  false
Empty LineString                          Empty LineString                          false  false  false
Empty LineString                          Faraway point                             false  false  false
Empty LineString                          Line going through left and right square  false  false  false
Empty LineString                          NULL                                      NULL   NULL   NULL
Empty LineString                          Point middle of Left Square               false  false  false
Empty LineString                          Point middle of Right Square              false  false  false
Empty LineString                          Square (left)                             false  false  false
Empty LineString                          Square (right)                            false  false  false
Empty LineString                          Square overlapping left and right square  false  false  false
Faraway point                             Empty GeometryCollection                  false  false  false
Faraway point                             Empty LineString                          false  false  false
Faraway point                             Faraway point                             true   true   true
Faraway point                             Line going through left and right square  false  false  false
Faraway point                             NULL                                      NULL   NULL   NULL
Faraway point                             Point middle of Left Square               false  false  false
Faraway point                             Point middle of Right Square              false  false  false
Faraway point                             Square (left)                             false  false  false
Faraway point                             Square (right)                            false  false  false
Faraway point                             Square overlapping left and right square  false  false  false
Line going through left and right square  Empty GeometryCollection                  false  false  false
Line going through left and right square  Empty LineString                          false  false  false
Line going through left and right square  Faraway point                             false  false  false
Line going through left and right square  Line going through left and right square  true   true   true
Line going through left and right square  NULL                                      NULL   NULL   NULL
Line going through left and right square  Point middle of Left Square               true   true   true
Line going through left and right square  Point middle of Right Square              true   true   true
Line going through left and right square  Square (left)                             true   true   true
Line going through left and right square  Square (right)                            true   true   true
Line going through left and right square  Square overlapping left and right square  true   true   true
NULL                                      Empty GeometryCollection                  NULL   NULL   NULL
NULL                                      Empty LineString                          NULL   NULL   NULL
NULL                                      Faraway point                             NULL   NULL   NULL
NULL                                      Line going through left and right square  NULL   NULL   NULL
NULL                                      NULL                                      NULL   NULL   NULL
NULL                                      Point middle of Left Square               NULL   NULL   NULL
NULL                                      Point middle of Right Square              NULL   NULL   NULL
NULL                                      Square (left)                             NULL   NULL   NULL
NULL                                      Square (right)                            NULL   NULL   NULL
NULL                                      Square overlapping left and right square  NULL   NULL   NULL
Point middle of Left Square               Empty GeometryCollection                  false  false  false
Point middle of Left Square               Empty LineString                          false  false  false
Point middle of Left Square               Faraway point                             false  false  false
Point middle of Left Square               Line going through left and right square  true   true   true
Point middle of Left Square               NULL                                      NULL   NULL   NULL
Point middle of Left Square               Point middle of Left Square               true   true   true
Point middle of Left Square               Point middle of Right Square              false  false  false
Point middle of Left Square               Square (left)                             true   true   true
Point middle of Left Square               Square (right)                            true   true   true
Point middle of Left Square               Square overlapping left and right square  true   true   true
Point middle of Right Square              Empty GeometryCollection                  false  false  false
Point middle of Right Square              Empty LineString                          false  false  false
Point middle of Right Square              Faraway point                             false  false  false
Point middle of Right Square              Line going through left and right square  true   true   true
Point middle of Right Square              NULL                                      NULL   NULL   NULL
Point middle of Right Square              Point middle of Left Square               false  false  false
Point middle of Right Square              Point middle of Right Square              true   true   true
Point middle of Right Square              Square (left)                             true   true   true
Point middle of Right Square              Square (right)                            true   true   true
Point middle of Right Square              Square overlapping left and right square  true   true   true
Square (left)                             Empty GeometryCollection                  false  false  false
Square (left)                             Empty LineString                          false  false  false
Square (left)                             Faraway point                             false  false  false
Square (left)                             Line going through left and right square  true   true   true
Square (left)                             NULL                                      NULL   NULL   NULL
Square (left)                             Point middle of Left Square               true   true   true
Square (left)                             Point middle of Right Square              true   true   true
Square (left)                             Square (left)                             true   true   true
Square (left)                             Square (right)                            true   true   true
Square (left)                             Square overlapping left and right square  true   true   true
Square (right)                            Empty GeometryCollection                  false  false  false
Square (right)                            Empty LineString                          false  false  false
Square (right)                            Faraway point                             false  false  false
Square (right)                            Line going through left and right square  true   true   true
Square (right)                            NULL                                      NULL   NULL   NULL
Square (right)                            Point middle of Left Square               true   true   true
Square (right)                            Point middle of Right Square              true   true   true
Square (right)                            Square (left)                             true   true   true
Square (right)                            Square (right)                            true   true   true
Square (right)                            Square overlapping left and right square  true   true   true
Square overlapping left and right square  Empty GeometryCollection                  false  false  false
Square overlapping left and right square  Empty LineString                          false  false  false
Square overlapping left and right square  Faraway point                             false  false  false
Square overlapping left and right square  Line going through left and right square  true   true   true
Square overlapping left and right square  NULL                                      NULL   NULL   NULL
Square overlapping left and right square  Point middle of Left Square               true   true   true
Square overlapping left and right square  Point middle of Right Square              true   true   true
Square overlapping left and right square  Square (left)                             true   true   true
Square overlapping left and right square  Square (right)                            true   true   true
Square overlapping left and right square  Square overlapping left and right square  true   true   true

# ST_Segmentize
query TTT
SELECT
  dsc,
  ST_AsText(ST_Segmentize(geog, 100000)),
  ST_AsText(ST_Segmentize(geog, 50000))
FROM geog_operators_test
ORDER BY dsc
----
Empty GeometryCollection                  GEOMETRYCOLLECTION EMPTY                                                                                                                                    GEOMETRYCOLLECTION EMPTY
Empty LineString                          LINESTRING EMPTY                                                                                                                                            LINESTRING EMPTY
Faraway point                             POINT (5 5)                                                                                                                                                 POINT (5 5)
Line going through left and right square  LINESTRING (-0.5 0.5, -0.00000000000000009939611878359099 0.5000190382262164, 0.5 0.5)                                                                      LINESTRING (-0.5 0.5, -0.25000000036247944 0.500014278647005, -0.00000000000000009939611878359099 0.5000190382262164, 0.2500000003624792 0.5000142786470051, 0.5 0.5)
NULL                                      NULL                                                                                                                                                        NULL
Point middle of Left Square               POINT (-0.5 0.5)                                                                                                                                            POINT (-0.5 0.5)
Point middle of Right Square              POINT (0.5 0.5)                                                                                                                                             POINT (0.5 0.5)
Square (left)                             POLYGON ((-1 0, -0.5000000000000001 0, 0 0, 0 0.5, 0 1, -0.4999999999999998 1.0000380706528733, -1 1, -0.9999999999999998 0.5000000000000001, -1 0))        POLYGON ((-1 0, -0.7499999999999998 0, -0.5000000000000001 0, -0.2499999999999997 0, 0 0, 0 0.25, 0 0.5, 0 0.75, 0 1, -0.2499999985501929 1.0000285529443267, -0.4999999999999998 1.0000380706528733, -0.7500000014498067 1.0000285529443265, -1 1, -1 0.7499999999999998, -0.9999999999999998 0.5000000000000001, -0.9999999999999998 0.25, -1 0))
Square (right)                            POLYGON ((0 0, 0.5 0, 1 0, 1 0.4999999999999999, 1 1, 0.5 1.0000380706528733, 0 1, 0 0.5000000000000001, 0 0))                                              POLYGON ((0 0, 0.25 0, 0.5 0, 0.75 0, 1 0, 0.9999999999999998 0.25, 1 0.4999999999999999, 0.9999999999999998 0.7499999999999999, 1 1, 0.750000001449807 1.0000285529443267, 0.5 1.0000380706528733, 0.2499999985501931 1.0000285529443267, 0 1, 0 0.7499999999999998, 0 0.5000000000000001, 0 0.2499999999999997, 0 0))
Square overlapping left and right square  POLYGON ((-0.1 0, 0.44999999999999996 0, 1 0, 1 0.4999999999999999, 1 1, 0.44999999999999996 1.0000460657968335, -0.1 1, -0.1 0.5000000000000001, -0.1 0))  POLYGON ((-0.1 0, 0.17500000000000007 0, 0.44999999999999996 0, 0.7249999999999999 0, 1 0, 0.9999999999999998 0.25, 1 0.4999999999999999, 0.9999999999999998 0.7499999999999999, 1 1, 0.7250000019297163 1.0000345492812595, 0.44999999999999996 1.0000460657968335, 0.17499999807028374 1.0000345492812592, -0.1 1, -0.1 0.75, -0.1 0.5000000000000001, -0.10000000000000002 0.2499999999999997, -0.1 0))

query T
SELECT ST_AsText(ST_Segmentize('MULTIPOINT (0 0, 1 1)'::geography, -1))
----
MULTIPOINT (0 0, 1 1)

statement error st_segmentize\(\): maximum segment length must be positive
SELECT ST_Segmentize('POLYGON((0.0 0.0, 1.0 0.0, 1.0 1.0, 0.0 1.0, 0.0 0.0))'::geography, 0)

subtest pg_extension

statement ok
CREATE TABLE pg_extension_test (
  a geography(point, 4326),
  b geometry(linestring, 3857),
  c geometry,
  d geography
)

query TTTTIIT rowsort
SELECT * FROM pg_extension.geography_columns WHERE f_table_name = 'pg_extension_test'
----
test  public  pg_extension_test  a  2     4326  POINT
test  public  pg_extension_test  d  NULL  0     GEOMETRY

query TTTTIIT rowsort
SELECT * FROM pg_extension.geometry_columns WHERE f_table_name = 'pg_extension_test'
----
test  public  pg_extension_test  b  2  3857  LINESTRING
test  public  pg_extension_test  c  2  0     GEOMETRY

query TTTTIIT rowsort
SELECT * FROM geography_columns WHERE f_table_name = 'pg_extension_test'
----
test  public  pg_extension_test  a  2     4326  POINT
test  public  pg_extension_test  d  NULL  0     GEOMETRY

query TTTTIIT rowsort
SELECT * FROM geometry_columns WHERE f_table_name = 'pg_extension_test'
----
test  public  pg_extension_test  b  2  3857  LINESTRING
test  public  pg_extension_test  c  2  0     GEOMETRY

statement error not yet implemented
SELECT * FROM pg_extension.spatial_ref_sys ORDER BY srid ASC

subtest st_srid

statement ok
CREATE TABLE geo_st_srid(
  id int primary key,
  geog geography(geometry),
  geom geometry(point)
)

statement ok
INSERT INTO geo_st_srid VALUES
  (1, ST_GeogFromText('SRID=4004;POINT(1.0 2.0)'), ST_GeomFromText('POINT(5.0 5.0)', 0)),
  (2, ST_GeogFromText('SRID=4326;POINT(1.0 2.0)'), ST_GeomFromText('POINT(5.0 5.0)', 4326)),
  (3, ST_SetSRID(ST_GeogFromText('SRID=4326;POINT(1.0 2.0)'), 4004), ST_SetSRID(ST_GeomFromText('POINT(5.0 5.0)', 4326), 3857))

query III
SELECT
  id,
  st_srid(geog),
  st_srid(geom)
FROM geo_st_srid
ORDER BY id
----
1  4004  0
2  4326  4326
3  4004  3857
