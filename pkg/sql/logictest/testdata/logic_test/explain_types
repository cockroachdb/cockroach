# LogicTest: default distsql

statement ok
CREATE TABLE t (
  k INT PRIMARY KEY,
  v INT
)

query ITTTTT colnames
EXPLAIN (TYPES) INSERT INTO t VALUES (1, 2)
----
Level  Type     Field          Description       Columns                     Ordering
0      insert   (empty)        (empty)           ()                          (empty)
0      (empty)  into           t(k, v)           (empty)                     (empty)
1      values   (empty)        (empty)           (column1 int, column2 int)  (empty)
1      (empty)  size           2 columns, 1 row  (empty)                     (empty)
1      (empty)  row 0, expr 0  (1)[int]          (empty)                     (empty)
1      (empty)  row 0, expr 1  (2)[int]          (empty)                     (empty)

statement ok
INSERT INTO t VALUES (1, 2)

query ITTTTT
EXPLAIN (TYPES) SELECT 42
----
0  render   (empty)   (empty)    ("42" int)  ="42"
0  (empty)  render 0  (42)[int]  (empty)     (empty)
1  nullrow  (empty)   (empty)    ()          (empty)

query ITTTTT
EXPLAIN (TYPES) SELECT * FROM t
----
0  scan     (empty)  (empty)    (k int, v int)  (empty)
0  (empty)  table    t@primary  (empty)         (empty)
0  (empty)  spans    ALL        (empty)         (empty)

query ITTTTT
EXPLAIN (TYPES,SYMVARS) SELECT k FROM t
----
0  render   (empty)   (empty)    (k int)                  (empty)
0  (empty)  render 0  (@1)[int]  (empty)                  (empty)
1  scan     (empty)   (empty)    (k int, v[omitted] int)  (empty)
1  (empty)  table     t@primary  (empty)                  (empty)
1  (empty)  spans     ALL        (empty)                  (empty)

query ITTTTT
EXPLAIN (TYPES,QUALIFY) SELECT k FROM t
----
0  render   (empty)   (empty)          (k int)                  (empty)
0  (empty)  render 0  (test.t.k)[int]  (empty)                  (empty)
1  scan     (empty)   (empty)          (k int, v[omitted] int)  (empty)
1  (empty)  table     t@primary        (empty)                  (empty)
1  (empty)  spans     ALL              (empty)                  (empty)

query ITTTTT
EXPLAIN (TYPES,NOEXPAND) SELECT * FROM t WHERE v > 123
----
0  render   (empty)   (empty)                        (k int, v int)  (empty)
0  (empty)  render 0  (k)[int]                       (empty)         (empty)
0  (empty)  render 1  (v)[int]                       (empty)         (empty)
1  scan     (empty)   (empty)                        (k int, v int)  (empty)
1  (empty)  table     t@primary                      (empty)         (empty)
1  (empty)  filter    ((v)[int] > (123)[int])[bool]  (empty)         (empty)

query ITTTTT
EXPLAIN (TYPES) SELECT * FROM t WHERE v > 123
----
0  scan     (empty)  (empty)                        (k int, v int)  (empty)
0  (empty)  table    t@primary                      (empty)         (empty)
0  (empty)  spans    ALL                            (empty)         (empty)
0  (empty)  filter   ((v)[int] > (123)[int])[bool]  (empty)         (empty)

query ITTTTT
EXPLAIN (TYPES) VALUES (1, 2, 3), (4, 5, 6)
----
0  values   (empty)        (empty)            (column1 int, column2 int, column3 int)  (empty)
0  (empty)  size           3 columns, 2 rows  (empty)                                  (empty)
0  (empty)  row 0, expr 0  (1)[int]           (empty)                                  (empty)
0  (empty)  row 0, expr 1  (2)[int]           (empty)                                  (empty)
0  (empty)  row 0, expr 2  (3)[int]           (empty)                                  (empty)
0  (empty)  row 1, expr 0  (4)[int]           (empty)                                  (empty)
0  (empty)  row 1, expr 1  (5)[int]           (empty)                                  (empty)
0  (empty)  row 1, expr 2  (6)[int]           (empty)                                  (empty)

query ITTTTT
EXPLAIN (TYPES,NOEXPAND) SELECT 2*COUNT(k) as z, v FROM t WHERE v>123 GROUP BY v HAVING v<2 AND COUNT(k)>1
----
0  render   (empty)      (empty)                                                                    (z int, v int)                                  (empty)
0  (empty)  render 0     ((2)[int] * ("count(k)")[int])[int]                                        (empty)                                         (empty)
0  (empty)  render 1     (v)[int]                                                                   (empty)                                         (empty)
1  filter   (empty)      (empty)                                                                    (v int, "count(k)" int, "count(k)" int, v int)  (empty)
1  (empty)  filter       (("count(k)")[int] > (1)[int])[bool]                                       (empty)                                         (empty)
2  group    (empty)      (empty)                                                                    (v int, "count(k)" int, "count(k)" int, v int)  (empty)
2  (empty)  aggregate 0  (v)[int]                                                                   (empty)                                         (empty)
2  (empty)  aggregate 1  (count((k)[int]))[int]                                                     (empty)                                         (empty)
2  (empty)  aggregate 2  (count((k)[int]))[int]                                                     (empty)                                         (empty)
2  (empty)  aggregate 3  (v)[int]                                                                   (empty)                                         (empty)
3  render   (empty)      (empty)                                                                    (v int, k int)                                  (empty)
3  (empty)  render 0     (v)[int]                                                                   (empty)                                         (empty)
3  (empty)  render 1     (k)[int]                                                                   (empty)                                         (empty)
4  scan     (empty)      (empty)                                                                    (k int, v int)                                  (empty)
4  (empty)  table        t@primary                                                                  (empty)                                         (empty)
4  (empty)  filter       ((((v)[int] > (123)[int])[bool]) AND (((v)[int] < (2)[int])[bool]))[bool]  (empty)                                         (empty)


query ITTTTT
EXPLAIN (TYPES) SELECT 2*COUNT(k) as z, v FROM t WHERE v>123 GROUP BY v HAVING v<2 AND COUNT(k)>1
----
0  render   (empty)      (empty)                               (z int, v int)                                  (empty)
0  (empty)  render 0     ((2)[int] * ("count(k)")[int])[int]   (empty)                                         (empty)
0  (empty)  render 1     (v)[int]                              (empty)                                         (empty)
1  filter   (empty)      (empty)                               (v int, "count(k)" int, "count(k)" int, v int)  (empty)
1  (empty)  filter       (("count(k)")[int] > (1)[int])[bool]  (empty)                                         (empty)
2  group    (empty)      (empty)                               (v int, "count(k)" int, "count(k)" int, v int)  (empty)
2  (empty)  aggregate 0  (v)[int]                              (empty)                                         (empty)
2  (empty)  aggregate 1  (count((k)[int]))[int]                (empty)                                         (empty)
2  (empty)  aggregate 2  (count((k)[int]))[int]                (empty)                                         (empty)
2  (empty)  aggregate 3  (v)[int]                              (empty)                                         (empty)
3  render   (empty)      (empty)                               (v int, k int)                                  (empty)
3  (empty)  render 0     (v)[int]                              (empty)                                         (empty)
3  (empty)  render 1     (k)[int]                              (empty)                                         (empty)
4  empty    (empty)      (empty)                               ()                                              (empty)

query ITTTTT
EXPLAIN (TYPES,NOEXPAND) DELETE FROM t WHERE v > 1
----
0  delete   (empty)   (empty)                      ()              (empty)
0  (empty)  from      t                            (empty)         (empty)
1  render   (empty)   (empty)                      (k int)         (empty)
1  (empty)  render 0  (k)[int]                     (empty)         (empty)
2  scan     (empty)   (empty)                      (k int, v int)  (empty)
2  (empty)  table     t@primary                    (empty)         (empty)
2  (empty)  filter    ((v)[int] > (1)[int])[bool]  (empty)         (empty)

query ITTTTT
EXPLAIN (TYPES) DELETE FROM t WHERE v > 1
----
0  delete   (empty)   (empty)                      ()              (empty)
0  (empty)  from      t                            (empty)         (empty)
1  render   (empty)   (empty)                      (k int)         (empty)
1  (empty)  render 0  (k)[int]                     (empty)         (empty)
2  scan     (empty)   (empty)                      (k int, v int)  (empty)
2  (empty)  table     t@primary                    (empty)         (empty)
2  (empty)  spans     ALL                          (empty)         (empty)
2  (empty)  filter    ((v)[int] > (1)[int])[bool]  (empty)         (empty)

query ITTTTT
EXPLAIN (TYPES) UPDATE t SET v = k + 1 WHERE v > 123
----
0  update   (empty)   (empty)                        ()                           (empty)
0  (empty)  table     t                              (empty)                      (empty)
0  (empty)  set       v                              (empty)                      (empty)
1  render   (empty)   (empty)                        (k int, v int, "k + 1" int)  (empty)
1  (empty)  render 0  (k)[int]                       (empty)                      (empty)
1  (empty)  render 1  (v)[int]                       (empty)                      (empty)
1  (empty)  render 2  ((k)[int] + (1)[int])[int]     (empty)                      (empty)
2  scan     (empty)   (empty)                        (k int, v int)               (empty)
2  (empty)  table     t@primary                      (empty)                      (empty)
2  (empty)  spans     ALL                            (empty)                      (empty)
2  (empty)  filter    ((v)[int] > (123)[int])[bool]  (empty)                      (empty)

query ITTTTT
EXPLAIN (TYPES,NOEXPAND) UPDATE t SET v = k + 1 WHERE v > 123
----
0  update   (empty)   (empty)                        ()                           (empty)
0  (empty)  table     t                              (empty)                      (empty)
0  (empty)  set       v                              (empty)                      (empty)
1  render   (empty)   (empty)                        (k int, v int, "k + 1" int)  (empty)
1  (empty)  render 0  (k)[int]                       (empty)                      (empty)
1  (empty)  render 1  (v)[int]                       (empty)                      (empty)
1  (empty)  render 2  ((k)[int] + (1)[int])[int]     (empty)                      (empty)
2  scan     (empty)   (empty)                        (k int, v int)               (empty)
2  (empty)  table     t@primary                      (empty)                      (empty)
2  (empty)  filter    ((v)[int] > (123)[int])[bool]  (empty)                      (empty)

query ITTTTT
EXPLAIN (TYPES) VALUES (1) UNION VALUES (2)
----
0  union    (empty)        (empty)          (column1 int)  (empty)
1  values   (empty)        (empty)          (column1 int)  (empty)
1  (empty)  size           1 column, 1 row  (empty)        (empty)
1  (empty)  row 0, expr 0  (1)[int]         (empty)        (empty)
1  values   (empty)        (empty)          (column1 int)  (empty)
1  (empty)  size           1 column, 1 row  (empty)        (empty)
1  (empty)  row 0, expr 0  (2)[int]         (empty)        (empty)

query ITTTTT
EXPLAIN (TYPES) SELECT DISTINCT k FROM t
----
0  distinct  (empty)   (empty)    (k int)                  +k,unique
0  (empty)   key       k          (empty)                  (empty)
1  render    (empty)   (empty)    (k int)                  +k,unique
1  (empty)   render 0  (k)[int]   (empty)                  (empty)
2  scan      (empty)   (empty)    (k int, v[omitted] int)  +k,unique
2  (empty)   table     t@primary  (empty)                  (empty)
2  (empty)   spans     ALL        (empty)                  (empty)

query ITTTTT
EXPLAIN (TYPES,NOEXPAND) SELECT DISTINCT k FROM t
----
0  distinct  (empty)   (empty)    (k int)                  (empty)
1  render    (empty)   (empty)    (k int)                  (empty)
1  (empty)   render 0  (k)[int]   (empty)                  (empty)
2  scan      (empty)   (empty)    (k int, v[omitted] int)  (empty)
2  (empty)   table     t@primary  (empty)                  (empty)

query ITTTTT
EXPLAIN (TYPES) SELECT v FROM t ORDER BY v
----
0  sort     (empty)   (empty)    (v int)                  +v
0  (empty)  order     +v         (empty)                  (empty)
1  render   (empty)   (empty)    (v int)                  (empty)
1  (empty)  render 0  (v)[int]   (empty)                  (empty)
2  scan     (empty)   (empty)    (k[omitted] int, v int)  (empty)
2  (empty)  table     t@primary  (empty)                  (empty)
2  (empty)  spans     ALL        (empty)                  (empty)

query ITTTTT
EXPLAIN (TYPES,NOEXPAND) SELECT v FROM t ORDER BY v
----
0  nosort   (empty)   (empty)    (v int)                  (empty)
0  (empty)  order     +v         (empty)                  (empty)
1  render   (empty)   (empty)    (v int)                  (empty)
1  (empty)  render 0  (v)[int]   (empty)                  (empty)
2  scan     (empty)   (empty)    (k[omitted] int, v int)  (empty)
2  (empty)  table     t@primary  (empty)                  (empty)

query ITTTTT
EXPLAIN (TYPES) SELECT v FROM t LIMIT 1
----
0  limit    (empty)   (empty)    (v int)                  (empty)
0  (empty)  count     (1)[int]   (empty)                  (empty)
1  render   (empty)   (empty)    (v int)                  (empty)
1  (empty)  render 0  (v)[int]   (empty)                  (empty)
2  scan     (empty)   (empty)    (k[omitted] int, v int)  (empty)
2  (empty)  table     t@primary  (empty)                  (empty)
2  (empty)  spans     ALL        (empty)                  (empty)
2  (empty)  limit     1          (empty)                  (empty)

query ITTTTT
EXPLAIN (TYPES,NOEXPAND) SELECT v FROM t LIMIT 1
----
0  limit    (empty)   (empty)    (v int)                  (empty)
0  (empty)  count     (1)[int]   (empty)                  (empty)
1  render   (empty)   (empty)    (v int)                  (empty)
1  (empty)  render 0  (v)[int]   (empty)                  (empty)
2  scan     (empty)   (empty)    (k[omitted] int, v int)  (empty)
2  (empty)  table     t@primary  (empty)                  (empty)

statement ok
CREATE TABLE tt (x INT, y INT, INDEX a(x), INDEX b(y))

query ITTTTT
EXPLAIN (TYPES) SELECT * FROM tt WHERE x < 10 AND y > 10
----
0  render      (empty)   (empty)                       (x int, y int)                                       (empty)
0  (empty)     render 0  (x)[int]                      (empty)                                              (empty)
0  (empty)     render 1  (y)[int]                      (empty)                                              (empty)
1  index-join  (empty)   (empty)                       (x int, y int, rowid[hidden,omitted] int)            (empty)
2  scan        (empty)   (empty)                       (x[omitted] int, y[omitted] int, rowid[hidden] int)  (empty)
2  (empty)     table     tt@a                          (empty)                                              (empty)
2  (empty)     spans     /#-/10                        (empty)                                              (empty)
2  scan        (empty)   (empty)                       (x int, y int, rowid[hidden,omitted] int)            (empty)
2  (empty)     table     tt@primary                    (empty)                                              (empty)
2  (empty)     filter    ((y)[int] > (10)[int])[bool]  (empty)                                              (empty)

query ITTTTT
EXPLAIN (TYPES,NOEXPAND) SELECT * FROM tt WHERE x < 10 AND y > 10
----
0  render   (empty)   (empty)                                                                    (x int, y int)                             (empty)
0  (empty)  render 0  (x)[int]                                                                   (empty)                                    (empty)
0  (empty)  render 1  (y)[int]                                                                   (empty)                                    (empty)
1  scan     (empty)   (empty)                                                                    (x int, y int, rowid[hidden,omitted] int)  (empty)
1  (empty)  table     tt@primary                                                                 (empty)                                    (empty)
1  (empty)  filter    ((((x)[int] < (10)[int])[bool]) AND (((y)[int] > (10)[int])[bool]))[bool]  (empty)                                    (empty)

query ITTTTT
EXPLAIN (TYPES) SELECT $1 + 2 AS a
----
0  render   (empty)   (empty)                      (a int)  =a
0  (empty)  render 0  (($1)[int] + (2)[int])[int]  (empty)  (empty)
1  nullrow  (empty)   (empty)                      ()       (empty)

query ITTTTT
EXPLAIN (TYPES,NONORMALIZE) SELECT ABS(2-3) AS a
----
0  render   (empty)   (empty)                (a int)  =a
0  (empty)  render 0  (abs((-1)[int]))[int]  (empty)  (empty)
1  nullrow  (empty)   (empty)                ()       (empty)

query ITTTTT
EXPLAIN (TYPES) SELECT ABS(2-3) AS a
----
0  render   (empty)   (empty)   (a int)  =a
0  (empty)  render 0  (1)[int]  (empty)  (empty)
1  nullrow  (empty)   (empty)   ()       (empty)

# Check array subscripts (#13811)
query ITTTTT
EXPLAIN (TYPES) SELECT x[1] FROM (SELECT ARRAY[1,2,3] AS x)
----
0  render   (empty)   (empty)                                     ("x[1]" int)  (empty)
0  (empty)  render 0  ((x)[int[]][(1)[int]])[int]                 (empty)       (empty)
1  render   (empty)   (empty)                                     (x int[])     =x
1  (empty)  render 0  (ARRAY[(1)[int],(2)[int],(3)[int]])[int[]]  (empty)       (empty)
2  nullrow  (empty)   (empty)                                     ()            (empty)
