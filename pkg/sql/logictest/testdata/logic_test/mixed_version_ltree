# LogicTest: cockroach-go-testserver-25.2 cockroach-go-testserver-25.3

# Sanity check that LTREE type is only allowed to be used once the cluster is
# upgraded to 25.4.

statement error pgcode 42704 type \"ltree\" does not exist
CREATE TABLE l (lt LTREE);

statement error pgcode 42704 type \"ltree\" does not exist
CREATE TABLE la (lta LTREE[]);

statement error pgcode 42704 type \"ltree\" does not exist
SELECT 'A.B'::LTREE

statement error pgcode 42704 type \"ltree\" does not exist
SELECT ARRAY['A', 'A.B']::LTREE[]

upgrade 0

statement error pgcode 0A000 ltree not supported until version 25.4
CREATE TABLE l (lt LTREE);

statement error pgcode 0A000 ltree not supported until version 25.4
CREATE TABLE la (lta LTREE[]);

statement error pgcode 0A000 ltree not supported until version 25.4
SELECT 'A.B'::LTREE

statement error pgcode 0A000 ltree\[\] not supported until version 25.4
SELECT ARRAY['A', 'A.B']::LTREE[]

upgrade 1

upgrade 2

statement ok
SET CLUSTER SETTING version = crdb_internal.node_executable_version()

statement ok
CREATE TABLE l (lt LTREE);

statement ok
CREATE TABLE la (lta LTREE[]);

statement ok
SELECT 'A.B'::LTREE

statement ok
SELECT ARRAY['A', 'A.B']::LTREE[]
