# LogicTest: local

statement ok
SET CLUSTER SETTING kv.closed_timestamp.target_duration='10ms'

statement ok
LISTEN foo

statement ok
LISTEN bar

# Duplicate listens do nothing.
statement ok
LISTEN foo

statement ok
NOTIFY foo; SELECT pg_sleep(1)

query T notificationtrace
SELECT 1
----
Asynchronous notification "foo" received from server with node ID 1.

statement ok
NOTIFY foo, 'bar'; SELECT pg_sleep(1)

query T notificationtrace
SELECT 1
----
Asynchronous notification "foo" with payload "bar" received from server with node ID 1.

statement ok
NOTIFY foo; NOTIFY foo, 'bar'; SELECT pg_sleep(1)

query T notificationtrace
----
Asynchronous notification "foo" received from server with node ID 1.
Asynchronous notification "foo" with payload "bar" received from server with node ID 1.

statement ok
NOTIFY bar, 'hello mate"\n foosfoo'; SELECT pg_sleep(1)

query T notificationtrace
SELECT 1
----
Asynchronous notification "bar" with payload "hello mate\"\\n foosfoo" received from server with node ID 1.

statement ok
UNLISTEN foo

# We're not listening on foo - no notification.
query T notificationtrace
NOTIFY foo
----

statement ok
NOTIFY bar; SELECT pg_sleep(1)

query T notificationtrace
SELECT 1
----
Asynchronous notification "bar" received from server with node ID 1.

statement ok
UNLISTEN *

statement ok
NOTIFY bar

statement ok
LISTEN foo

statement ok
NOTIFY foo, 'only foo, no bar'; SELECT pg_sleep(1)

query T notificationtrace
----
Asynchronous notification "foo" with payload "only foo, no bar" received from server with node ID 1.

