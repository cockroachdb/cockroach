# test we store various types with precision correctly.
subtest interval_type_storage

statement ok
CREATE TABLE interval_duration_type (
  id INTEGER PRIMARY KEY,
  regular INTERVAL,
  regular_precision INTERVAL(3),
  second INTERVAL SECOND,
  second_precision INTERVAL SECOND(3),
  minute INTERVAL MINUTE,
  minute_to_second_precision INTERVAL MINUTE TO SECOND(3)
)

statement ok
INSERT INTO interval_duration_type (id, regular, regular_precision, second, second_precision, minute, minute_to_second_precision) VALUES
  (1, '12:34:56.123456', '12:34:56.123456', '12:34:56.123456', '12:34:56.123456', '12:34:56.123456', '12:34:56.123456'),
  (2, '12:56.123456', '12:56.123456', '12:56.123456', '12:56.123456', '12:56.123456', '12:56.123456'),
  (3, '366 12:34:56.123456', '366 12:34:56.123456', '366 12:34:56.123456', '366 12:34:56.123456', '366 12:34:56.123456', '366 12:34:56.123456')

query ITTTTTT
select * from interval_duration_type order by id asc
----
1  12:34:56.123456           12:34:56.123           12:34:56.123456           12:34:56.123           12:34:00           12:34:56.123
2  12:56:07.40736            12:56:07.407           12:56:07.40736            12:56:07.407           12:56:00           12:56:07.407
3  366 days 12:34:56.123456  366 days 12:34:56.123  366 days 12:34:56.123456  366 days 12:34:56.123  366 days 12:34:00  366 days 12:34:56.123

subtest interval_extract_tests

query R
SELECT extract('second', interval '10:55:01.456')
----
1.456

query R
SELECT extract(minute from interval '10:55:01.456')
----
55

# tests various typmods of intervals
# matches subset of tests in src/test/regress/expected/interval.out
subtest interval_postgres_duration_type_tests

# oversize leading field is ok
query T
SELECT interval '999' second
----
00:16:39

query T
SELECT interval '999' minute
----
16:39:00

query T
SELECT interval '999' hour
----
999:00:00

query T
SELECT interval '999' day
----
999 days

query T
SELECT interval '999' month
----
83 years 3 mons

# test SQL-spec syntaxes for restricted field sets

query T
SELECT interval '1' year
----
1 year

query T
SELECT interval '2' month
----
2 mons

query T
SELECT interval '3' day
----
3 days

query T
SELECT interval '4' hour
----
04:00:00

query T
SELECT interval '5' minute
----
00:05:00

query T
SELECT interval '6' second
----
00:00:06

query T
SELECT interval '1' year to month
----
1 mon

query T
SELECT interval '1-2' year to month
----
1 year 2 mons

# TODO(#43079): fix this
#query T
#SELECT interval '1 2' day to hour
#----
#1 day 02:00:00

query T
SELECT interval '1 2:03' day to hour
----
1 day 02:00:00

query T
SELECT interval '1 2:03:04' day to hour
----
1 day 02:00:00

query error could not parse "1 2" as type interval
SELECT interval '1 2' day to minute

query T
SELECT interval '1 2:03' day to minute
----
1 day 02:03:00

query T
SELECT interval '1 2:03:04' day to minute
----
1 day 02:03:00

query error could not parse "1 2" as type interval
SELECT interval '1 2' day to second

query T
SELECT interval '1 2:03' day to second
----
1 day 02:03:00

query T
SELECT interval '1 2:03:04' day to second
----
1 day 02:03:04

query error could not parse "1 2" as type interval
SELECT interval '1 2' hour to minute

query T
SELECT interval '1 2:03' hour to minute
----
1 day 02:03:00

query T
SELECT interval '1 2:03:04' hour to minute
----
1 day 02:03:00

query error could not parse "1 2" as type interval
SELECT interval '1 2' hour to second

query T
SELECT interval '1 2:03' hour to second
----
1 day 02:03:00

query T
SELECT interval '1 2:03:04' hour to second
----
1 day 02:03:04

query error could not parse "1 2" as type interval
SELECT interval '1 2' minute to second

query T
SELECT interval '1 2:03' minute to second
----
1 day 02:03:00

# TODO(#43074): above should be 1 day 00:02:03

query T
SELECT interval '1 2:03:04' minute to second
----
1 day 02:03:04

query T
SELECT interval '1 +2:03' minute to second
----
1 day 02:03:00

# TODO(#43074): above should be 1 day 00:02:03

query T
SELECT interval '1 +2:03:04' minute to second
----
1 day 02:03:04

query T
SELECT interval '1 -2:03' minute to second
----
1 day -02:03:00

# TODO(#43074): above should be 1 day -00:02:03

query T
SELECT interval '1 -2:03:04' minute to second
----
1 day -02:03:04

# TODO(#43079): fix this
#query T
#SELECT interval '123 11' day to hour
#----
#123 days 11:00:00

query error could not parse "123 11" as type interval
SELECT interval '123 11' day

query error could not parse "123 11" as type interval
SELECT interval '123 11'

# not ok, redundant hh:mm fields
query error could not parse "123 2:03 -2:04" as type interval
SELECT interval '123 2:03 -2:04'

# test syntaxes for restricted precision
query T
SELECT interval(0) '1 day 01:23:45.6789'
----
1 day 01:23:46

query T
SELECT interval(2) '1 day 01:23:45.6789'
----
1 day 01:23:45.68

query T
SELECT interval '12:34.5678' minute to second(2)
----
12:34:34.07

# TODO(#43074): above should be 00:12:34.57

query T
SELECT interval '1.234' second
----
00:00:01.234

query T
SELECT interval '1.234' second(2)
----
00:00:01.23

query error could not parse "1 2.345" as type interval
SELECT interval '1 2.345' day to second(2)

query T
SELECT interval '1 2:03' day to second(2)
----
1 day 02:03:00

query T
SELECT interval '1 2:03.4567' day to second(2)
----
1 day 02:03:27.4

# TODO(#43074): 1 day 00:02:03.46

query T
SELECT interval '1 2:03:04.5678' day to second(2)
----
1 day 02:03:04.57

query error could not parse "1 2.345" as type interval
SELECT interval '1 2.345' hour to second(2)

query T
SELECT interval '1 2:03.45678' hour to second(2)
----
1 day 02:03:27.41

# TODO(#43074): 1 day 00:02:03.57

query T
SELECT interval '1 2:03:04.5678' hour to second(2)
----
1 day 02:03:04.57

query error could not parse "1 2.3456" as type interval
SELECT interval '1 2.3456' minute to second(2)

query T
SELECT interval '1 2:03.5678' minute to second(2)
----
1 day 02:03:34.07

# TODO(#43074): 1 day 00:02:03.57

query T
SELECT interval '1 2:03:04.5678' minute to second(2)
----
1 day 02:03:04.57
