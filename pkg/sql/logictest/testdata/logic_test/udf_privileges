statement ok
CREATE USER tester

statement ok
CREATE SCHEMA test;

statement ok
GRANT USAGE ON SCHEMA test TO tester;

statement ok
CREATE FUNCTION test.my_add(a INT, b INT) RETURNS INT IMMUTABLE LEAKPROOF LANGUAGE SQL AS 'SELECT a + b';

statement ok
REVOKE EXECUTE ON FUNCTION test.my_add FROM public

statement ok
SELECT test.my_add(1,2)

statement ok
SET ROLE tester

statement error pgcode 42501 user tester does not have EXECUTE privilege on function my_add
SELECT test.my_add(1,2)

statement error pgcode 42501 user tester does not have EXECUTE privilege on function my_add
SELECT * FROM (VALUES (1), (2)) AS v(i) WHERE i = test.my_add(1,2)

statement ok
SET ROLE root

statement ok
GRANT EXECUTE ON FUNCTION test.my_add TO public

statement ok
SET ROLE tester

statement ok
SELECT test.my_add(1,2)

# TODO(#107561): Resetting the role is necessary due to a bug in the logic test
# infrastructure.
statement ok
SET ROLE root
