statement ok
CREATE TABLE tbl (
  ttz TIMESTAMPTZ,
  ival INTERVAL
);
INSERT INTO tbl VALUES
  ('2020-08-25 15:16:17.123456', '1 day 15:16:17.123456'::interval)

query T noticetrace
SET LOCAL TIME ZONE +6
----
WARNING: SET LOCAL can only be used in transaction blocks

statement ok
SET intervalstyle_enabled = 'on'

# Set TIME ZONE local to the transaction, but IntervalStyle globally.
statement ok
BEGIN;
SET LOCAL TIME ZONE 'America/Los_Angeles';
SET IntervalStyle = 'iso_8601'

query T
SHOW TIME ZONE
----
America/Los_Angeles

query T
SHOW INTERVALSTYLE
----
iso_8601

query TT 
SELECT * FROM tbl
----
2020-08-25 08:16:17.123456 -0700 PDT  P1DT15H16M17.123456S

# Rollback and ensure the values are correct.
# NOTE: we do not rollback set like Postgres does (see #69396)
statement ok
ROLLBACK

query T
SHOW TIME ZONE
----
UTC

query T
SHOW INTERVALSTYLE
----
iso_8601

query TT 
SELECT * FROM tbl
----
2020-08-25 15:16:17.123456 +0000 +0000  P1DT15H16M17.123456S

# Do the same thing but this time commit, checking the settings are the same
# before we do the SET.
statement ok
BEGIN;

query T
SHOW TIME ZONE
----
UTC

query T
SHOW INTERVALSTYLE
----
iso_8601

query TT 
SELECT * FROM tbl
----
2020-08-25 15:16:17.123456 +0000 +0000  P1DT15H16M17.123456S

statement ok
SET LOCAL TIME ZONE 'America/New_York';
SET IntervalStyle = 'postgres'

query T
SHOW TIME ZONE
----
America/New_York

query T
SHOW INTERVALSTYLE
----
postgres

query TT 
SELECT * FROM tbl
----
2020-08-25 11:16:17.123456 -0400 EDT  1 day 15:16:17.123456

statement ok
COMMIT

query T
SHOW TIME ZONE
----
UTC

query T
SHOW INTERVALSTYLE
----
postgres

query TT 
SELECT * FROM tbl
----
2020-08-25 15:16:17.123456 +0000 +0000  1 day 15:16:17.123456

# Now try commit/rollback in an aborted transaction.
statement ok
BEGIN;
SET LOCAL IntervalStyle = 'sql_standard'

query T
SHOW INTERVALSTYLE
----
sql_standard

query TT 
SELECT * FROM tbl
----
2020-08-25 15:16:17.123456 +0000 +0000  1 15:16:17.123456

statement error at or near "bad": syntax error
BAD SYNTAX

statement error current transaction is aborted, commands ignored until end of transaction block
SET LOCAL IntervalStyle = 'postgres'

statement ok
ROLLBACK

query T
SHOW INTERVALSTYLE
----
postgres

query TT 
SELECT * FROM tbl
----
2020-08-25 15:16:17.123456 +0000 +0000  1 day 15:16:17.123456

statement ok
BEGIN;
SET LOCAL IntervalStyle = 'sql_standard'

query T
SHOW INTERVALSTYLE
----
sql_standard

query TT 
SELECT * FROM tbl
----
2020-08-25 15:16:17.123456 +0000 +0000  1 15:16:17.123456

statement error at or near "bad": syntax error
BAD SYNTAX

statement error current transaction is aborted, commands ignored until end of transaction block
SET LOCAL IntervalStyle = 'postgres'

statement ok
COMMIT

query T
SHOW INTERVALSTYLE
----
postgres

query TT 
SELECT * FROM tbl
----
2020-08-25 15:16:17.123456 +0000 +0000  1 day 15:16:17.123456
