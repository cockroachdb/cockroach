import file=tpce_schema
----

import file=tpce_stats_c5000
----

# TPC-E consists of 12 transactions with varying numbers of queries.

# --------------------------------------------------
# T1
# Broker-Volume
# Emulates a brokerage house’s “up-to-the-minute" internal business processing.
# An example of a Broker-Volume Transaction would be a manager generating a
# report on the current performance potential of various brokers.
# --------------------------------------------------

# Q1
#
# TODO:
#   1. The project under the groupby could be eliminated if the explorer
#      supported norm rules.
#
opt
SELECT b_name, sum(tr_qty * tr_bid_price)::FLOAT8
FROM sector, industry, company, security, trade_request, broker
WHERE tr_b_id = b_id
 AND s_symb = tr_s_symb
 AND co_id = s_co_id
 AND in_id = co_in_id
 AND sc_id = in_sc_id
 AND b_name = ANY ARRAY[
                    'Broker1', 'Broker2', 'Broker3', 'Broker4', 'Broker5',
                    'Broker6', 'Broker7', 'Broker8', 'Broker9', 'Broker10',
                    'Broker11', 'Broker12', 'Broker13', 'Broker14', 'Broker15',
                    'Broker16', 'Broker17', 'Broker18', 'Broker19', 'Broker20',
                    'Broker21', 'Broker22', 'Broker23', 'Broker24', 'Broker25',
                    'Broker26', 'Broker27', 'Broker28', 'Broker29', 'Broker30'
                  ]
 AND sc_name = 'Energy'
GROUP BY b_name
ORDER BY 2 DESC
----
sort
 ├── columns: b_name:44!null sum:50!null
 ├── immutable
 ├── key: (44)
 ├── fd: (44)-->(50)
 ├── ordering: -50
 └── project
      ├── columns: sum:50!null b_name:44!null
      ├── immutable
      ├── key: (44)
      ├── fd: (44)-->(50)
      ├── group-by
      │    ├── columns: b_name:44!null sum:49!null
      │    ├── grouping columns: b_name:44!null
      │    ├── immutable
      │    ├── key: (44)
      │    ├── fd: (44)-->(49)
      │    ├── project
      │    │    ├── columns: column48:48!null b_name:44!null
      │    │    ├── immutable
      │    │    ├── inner-join (hash)
      │    │    │    ├── columns: sc_id:1!null sc_name:2!null in_id:4!null in_sc_id:6!null co_id:8!null co_in_id:11!null s_symb:18!null s_co_id:23!null tr_s_symb:37!null tr_qty:38!null tr_bid_price:39!null tr_b_id:40!null b_id:42!null b_name:44!null
      │    │    │    ├── multiplicity: left-rows(zero-or-one), right-rows(zero-or-more)
      │    │    │    ├── fd: ()-->(1,2,6), (8)-->(11), (18)-->(23), (42)-->(44), (44)-->(42), (40)==(42), (42)==(40), (18)==(37), (37)==(18), (8)==(23), (23)==(8), (4)==(11), (11)==(4), (1)==(6), (6)==(1)
      │    │    │    ├── inner-join (lookup company)
      │    │    │    │    ├── columns: co_id:8!null co_in_id:11!null s_symb:18!null s_co_id:23!null tr_s_symb:37!null tr_qty:38!null tr_bid_price:39!null tr_b_id:40!null b_id:42!null b_name:44!null
      │    │    │    │    ├── key columns: [23] = [8]
      │    │    │    │    ├── lookup columns are key
      │    │    │    │    ├── fd: (8)-->(11), (18)-->(23), (42)-->(44), (44)-->(42), (40)==(42), (42)==(40), (18)==(37), (37)==(18), (8)==(23), (23)==(8)
      │    │    │    │    ├── inner-join (lookup security)
      │    │    │    │    │    ├── columns: s_symb:18!null s_co_id:23!null tr_s_symb:37!null tr_qty:38!null tr_bid_price:39!null tr_b_id:40!null b_id:42!null b_name:44!null
      │    │    │    │    │    ├── key columns: [37] = [18]
      │    │    │    │    │    ├── lookup columns are key
      │    │    │    │    │    ├── fd: (18)-->(23), (42)-->(44), (44)-->(42), (40)==(42), (42)==(40), (18)==(37), (37)==(18)
      │    │    │    │    │    ├── inner-join (hash)
      │    │    │    │    │    │    ├── columns: tr_s_symb:37!null tr_qty:38!null tr_bid_price:39!null tr_b_id:40!null b_id:42!null b_name:44!null
      │    │    │    │    │    │    ├── multiplicity: left-rows(zero-or-one), right-rows(zero-or-more)
      │    │    │    │    │    │    ├── fd: (42)-->(44), (44)-->(42), (40)==(42), (42)==(40)
      │    │    │    │    │    │    ├── scan trade_request@secondary
      │    │    │    │    │    │    │    └── columns: tr_s_symb:37!null tr_qty:38!null tr_bid_price:39!null tr_b_id:40!null
      │    │    │    │    │    │    ├── select
      │    │    │    │    │    │    │    ├── columns: b_id:42!null b_name:44!null
      │    │    │    │    │    │    │    ├── cardinality: [0 - 30]
      │    │    │    │    │    │    │    ├── key: (42)
      │    │    │    │    │    │    │    ├── fd: (42)-->(44), (44)-->(42)
      │    │    │    │    │    │    │    ├── scan broker@secondary
      │    │    │    │    │    │    │    │    ├── columns: b_id:42!null b_name:44!null
      │    │    │    │    │    │    │    │    ├── key: (42)
      │    │    │    │    │    │    │    │    └── fd: (42)-->(44), (44)-->(42)
      │    │    │    │    │    │    │    └── filters
      │    │    │    │    │    │    │         └── b_name:44 IN ('Broker1', 'Broker10', 'Broker11', 'Broker12', 'Broker13', 'Broker14', 'Broker15', 'Broker16', 'Broker17', 'Broker18', 'Broker19', 'Broker2', 'Broker20', 'Broker21', 'Broker22', 'Broker23', 'Broker24', 'Broker25', 'Broker26', 'Broker27', 'Broker28', 'Broker29', 'Broker3', 'Broker30', 'Broker4', 'Broker5', 'Broker6', 'Broker7', 'Broker8', 'Broker9') [outer=(44), constraints=(/44: [/'Broker1' - /'Broker1'] [/'Broker10' - /'Broker10'] [/'Broker11' - /'Broker11'] [/'Broker12' - /'Broker12'] [/'Broker13' - /'Broker13'] [/'Broker14' - /'Broker14'] [/'Broker15' - /'Broker15'] [/'Broker16' - /'Broker16'] [/'Broker17' - /'Broker17'] [/'Broker18' - /'Broker18'] [/'Broker19' - /'Broker19'] [/'Broker2' - /'Broker2'] [/'Broker20' - /'Broker20'] [/'Broker21' - /'Broker21'] [/'Broker22' - /'Broker22'] [/'Broker23' - /'Broker23'] [/'Broker24' - /'Broker24'] [/'Broker25' - /'Broker25'] [/'Broker26' - /'Broker26'] [/'Broker27' - /'Broker27'] [/'Broker28' - /'Broker28'] [/'Broker29' - /'Broker29'] [/'Broker3' - /'Broker3'] [/'Broker30' - /'Broker30'] [/'Broker4' - /'Broker4'] [/'Broker5' - /'Broker5'] [/'Broker6' - /'Broker6'] [/'Broker7' - /'Broker7'] [/'Broker8' - /'Broker8'] [/'Broker9' - /'Broker9']; tight)]
      │    │    │    │    │    │    └── filters
      │    │    │    │    │    │         └── tr_b_id:40 = b_id:42 [outer=(40,42), constraints=(/40: (/NULL - ]; /42: (/NULL - ]), fd=(40)==(42), (42)==(40)]
      │    │    │    │    │    └── filters (true)
      │    │    │    │    └── filters (true)
      │    │    │    ├── inner-join (hash)
      │    │    │    │    ├── columns: sc_id:1!null sc_name:2!null in_id:4!null in_sc_id:6!null
      │    │    │    │    ├── multiplicity: left-rows(zero-or-one), right-rows(zero-or-more)
      │    │    │    │    ├── key: (4)
      │    │    │    │    ├── fd: ()-->(1,2,6), (1)==(6), (6)==(1)
      │    │    │    │    ├── scan industry
      │    │    │    │    │    ├── columns: in_id:4!null in_sc_id:6!null
      │    │    │    │    │    ├── key: (4)
      │    │    │    │    │    └── fd: (4)-->(6)
      │    │    │    │    ├── scan sector@secondary
      │    │    │    │    │    ├── columns: sc_id:1!null sc_name:2!null
      │    │    │    │    │    ├── constraint: /2: [/'Energy' - /'Energy']
      │    │    │    │    │    ├── cardinality: [0 - 1]
      │    │    │    │    │    ├── key: ()
      │    │    │    │    │    └── fd: ()-->(1,2)
      │    │    │    │    └── filters
      │    │    │    │         └── sc_id:1 = in_sc_id:6 [outer=(1,6), constraints=(/1: (/NULL - ]; /6: (/NULL - ]), fd=(1)==(6), (6)==(1)]
      │    │    │    └── filters
      │    │    │         └── in_id:4 = co_in_id:11 [outer=(4,11), constraints=(/4: (/NULL - ]; /11: (/NULL - ]), fd=(4)==(11), (11)==(4)]
      │    │    └── projections
      │    │         └── tr_qty:38::INT8 * tr_bid_price:39::DECIMAL [as=column48:48, outer=(38,39), immutable]
      │    └── aggregations
      │         └── sum [as=sum:49, outer=(48)]
      │              └── column48:48
      └── projections
           └── sum:49::FLOAT8 [as=sum:50, outer=(49), immutable]

# --------------------------------------------------
# T2
# Customer-Position
# Emulates the process of retrieving the customer’s profile and summarizing
# their overall standing based on current market values for all assets. This is
# representative of the work performed when a customer asks the question “What
# am I worth today?”
# --------------------------------------------------

# Q1
opt
SELECT c_id
  FROM customer
 WHERE c_tax_id = ''
----
project
 ├── columns: c_id:1!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(1)
 └── scan customer@secondary
      ├── columns: c_id:1!null c_tax_id:2!null
      ├── constraint: /2: [/'' - /'']
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1,2)

# Q2
opt
SELECT c_id,
       c_st_id,
       c_l_name,
       c_f_name,
       c_m_name,
       c_gndr,
       c_tier,
       c_dob,
       c_ad_id,
       c_ctry_1,
       c_area_1,
       c_local_1,
       c_ext_1,
       c_ctry_2,
       c_area_2,
       c_local_2,
       c_ext_2,
       c_ctry_3,
       c_area_3,
       c_local_3,
       c_ext_3,
       c_email_1,
       c_email_2
  FROM customer
 WHERE c_id = 0
----
scan customer
 ├── columns: c_id:1!null c_st_id:3!null c_l_name:4!null c_f_name:5!null c_m_name:6 c_gndr:7 c_tier:8!null c_dob:9!null c_ad_id:10!null c_ctry_1:11 c_area_1:12 c_local_1:13 c_ext_1:14 c_ctry_2:15 c_area_2:16 c_local_2:17 c_ext_2:18 c_ctry_3:19 c_area_3:20 c_local_3:21 c_ext_3:22 c_email_1:23 c_email_2:24
 ├── constraint: /1: [/0 - /0]
 ├── cardinality: [0 - 1]
 ├── key: ()
 └── fd: ()-->(1,3-24)

# Q3
opt
   SELECT ca_id,
          ca_bal::FLOAT8,
          IFNULL((sum(hs_qty * lt_price)), 0)::FLOAT8
     FROM customer_account
LEFT JOIN holding_summary ON hs_ca_id = ca_id
     JOIN last_trade ON lt_s_symb = hs_s_symb
    WHERE ca_c_id = 0
 GROUP BY ca_id, ca_bal
 ORDER BY 3 ASC
    LIMIT 10
----
limit
 ├── columns: ca_id:1!null ca_bal:20!null coalesce:21
 ├── internal-ordering: +21
 ├── cardinality: [0 - 10]
 ├── immutable
 ├── key: (1)
 ├── fd: (1)-->(20,21)
 ├── ordering: +21
 ├── sort
 │    ├── columns: ca_id:1!null ca_bal:20!null coalesce:21
 │    ├── immutable
 │    ├── key: (1)
 │    ├── fd: (1)-->(20,21)
 │    ├── ordering: +21
 │    ├── limit hint: 10.00
 │    └── project
 │         ├── columns: ca_bal:20!null coalesce:21 ca_id:1!null
 │         ├── immutable
 │         ├── key: (1)
 │         ├── fd: (1)-->(20,21)
 │         ├── group-by
 │         │    ├── columns: ca_id:1!null customer_account.ca_bal:6!null sum:19!null
 │         │    ├── grouping columns: ca_id:1!null
 │         │    ├── internal-ordering: +1
 │         │    ├── immutable
 │         │    ├── key: (1)
 │         │    ├── fd: (1)-->(6,19)
 │         │    ├── project
 │         │    │    ├── columns: column18:18!null ca_id:1!null customer_account.ca_bal:6!null
 │         │    │    ├── immutable
 │         │    │    ├── fd: (1)-->(6)
 │         │    │    ├── ordering: +1
 │         │    │    ├── inner-join (lookup last_trade)
 │         │    │    │    ├── columns: ca_id:1!null ca_c_id:3!null customer_account.ca_bal:6!null hs_ca_id:8!null hs_s_symb:9!null hs_qty:10!null lt_s_symb:12!null lt_price:14!null
 │         │    │    │    ├── key columns: [9] = [12]
 │         │    │    │    ├── lookup columns are key
 │         │    │    │    ├── key: (8,12)
 │         │    │    │    ├── fd: ()-->(3), (1)-->(6), (8,9)-->(10), (1)==(8), (8)==(1), (12)-->(14), (9)==(12), (12)==(9)
 │         │    │    │    ├── ordering: +(1|8) opt(3) [actual: +1]
 │         │    │    │    ├── inner-join (lookup holding_summary)
 │         │    │    │    │    ├── columns: ca_id:1!null ca_c_id:3!null customer_account.ca_bal:6!null hs_ca_id:8!null hs_s_symb:9!null hs_qty:10!null
 │         │    │    │    │    ├── key columns: [1] = [8]
 │         │    │    │    │    ├── key: (8,9)
 │         │    │    │    │    ├── fd: ()-->(3), (1)-->(6), (8,9)-->(10), (1)==(8), (8)==(1)
 │         │    │    │    │    ├── ordering: +(1|8) opt(3) [actual: +1]
 │         │    │    │    │    ├── select
 │         │    │    │    │    │    ├── columns: ca_id:1!null ca_c_id:3!null customer_account.ca_bal:6!null
 │         │    │    │    │    │    ├── key: (1)
 │         │    │    │    │    │    ├── fd: ()-->(3), (1)-->(6)
 │         │    │    │    │    │    ├── ordering: +1 opt(3) [actual: +1]
 │         │    │    │    │    │    ├── scan customer_account
 │         │    │    │    │    │    │    ├── columns: ca_id:1!null ca_c_id:3!null customer_account.ca_bal:6!null
 │         │    │    │    │    │    │    ├── check constraint expressions
 │         │    │    │    │    │    │    │    └── ca_tax_st:5 IN (0, 1, 2) [outer=(5), constraints=(/5: [/0 - /0] [/1 - /1] [/2 - /2]; tight)]
 │         │    │    │    │    │    │    ├── key: (1)
 │         │    │    │    │    │    │    ├── fd: (1)-->(3,6)
 │         │    │    │    │    │    │    └── ordering: +1
 │         │    │    │    │    │    └── filters
 │         │    │    │    │    │         └── ca_c_id:3 = 0 [outer=(3), constraints=(/3: [/0 - /0]; tight), fd=()-->(3)]
 │         │    │    │    │    └── filters (true)
 │         │    │    │    └── filters (true)
 │         │    │    └── projections
 │         │    │         └── hs_qty:10::INT8 * lt_price:14::DECIMAL [as=column18:18, outer=(10,14), immutable]
 │         │    └── aggregations
 │         │         ├── sum [as=sum:19, outer=(18)]
 │         │         │    └── column18:18
 │         │         └── const-agg [as=customer_account.ca_bal:6, outer=(6)]
 │         │              └── customer_account.ca_bal:6
 │         └── projections
 │              ├── customer_account.ca_bal:6::FLOAT8 [as=ca_bal:20, outer=(6), immutable]
 │              └── COALESCE(sum:19, 0)::FLOAT8 [as=coalesce:21, outer=(19), immutable]
 └── 10

# Q4
opt
SELECT t_id, t_s_symb, t_qty, st_name, th_dts
FROM (
          SELECT t_id, t_s_symb, t_qty
            FROM trade
           WHERE t_ca_id = 0
        ORDER BY t_dts DESC
           LIMIT 10
     ) AS t,
     trade_history,
     status_type
WHERE th_t_id = t_id AND st_id = th_st_id
ORDER BY th_dts DESC
LIMIT 30
----
project
 ├── columns: t_id:1!null t_s_symb:6!null t_qty:7!null st_name:22!null th_dts:18!null
 ├── cardinality: [0 - 30]
 ├── fd: (1)-->(6,7)
 ├── ordering: -18
 └── limit
      ├── columns: t_id:1!null t_dts:2!null t_s_symb:6!null t_qty:7!null t_ca_id:9!null th_t_id:17!null th_dts:18!null th_st_id:19!null st_id:21!null st_name:22!null
      ├── internal-ordering: -18 opt(9)
      ├── cardinality: [0 - 30]
      ├── key: (17,21)
      ├── fd: ()-->(9), (1)-->(2,6,7), (17,19)-->(18), (21)-->(22), (19)==(21), (21)==(19), (1)==(17), (17)==(1)
      ├── ordering: -18 opt(9) [actual: -18]
      ├── inner-join (lookup status_type)
      │    ├── columns: t_id:1!null t_dts:2!null t_s_symb:6!null t_qty:7!null t_ca_id:9!null th_t_id:17!null th_dts:18!null th_st_id:19!null st_id:21!null st_name:22!null
      │    ├── key columns: [19] = [21]
      │    ├── lookup columns are key
      │    ├── key: (17,21)
      │    ├── fd: ()-->(9), (1)-->(2,6,7), (17,19)-->(18), (21)-->(22), (19)==(21), (21)==(19), (1)==(17), (17)==(1)
      │    ├── ordering: -18 opt(9) [actual: -18]
      │    ├── limit hint: 30.00
      │    ├── sort
      │    │    ├── columns: t_id:1!null t_dts:2!null t_s_symb:6!null t_qty:7!null t_ca_id:9!null th_t_id:17!null th_dts:18!null th_st_id:19!null
      │    │    ├── key: (17,19)
      │    │    ├── fd: ()-->(9), (1)-->(2,6,7), (17,19)-->(18), (1)==(17), (17)==(1)
      │    │    ├── ordering: -18 opt(9) [actual: -18]
      │    │    └── inner-join (lookup trade_history)
      │    │         ├── columns: t_id:1!null t_dts:2!null t_s_symb:6!null t_qty:7!null t_ca_id:9!null th_t_id:17!null th_dts:18!null th_st_id:19!null
      │    │         ├── key columns: [1] = [17]
      │    │         ├── key: (17,19)
      │    │         ├── fd: ()-->(9), (1)-->(2,6,7), (17,19)-->(18), (1)==(17), (17)==(1)
      │    │         ├── scan trade@secondary
      │    │         │    ├── columns: t_id:1!null t_dts:2!null t_s_symb:6!null t_qty:7!null t_ca_id:9!null
      │    │         │    ├── constraint: /9/-2/1: [/0 - /0]
      │    │         │    ├── limit: 10
      │    │         │    ├── key: (1)
      │    │         │    └── fd: ()-->(9), (1)-->(2,6,7)
      │    │         └── filters (true)
      │    └── filters (true)
      └── 30

# --------------------------------------------------
# T3
# Market-Feed
# Emulates the process of tracking the current market activity. This is
# representative of the brokerage house processing the “ticker-tape” from the
# market exchange.
# --------------------------------------------------

# Q1
opt
UPDATE last_trade
   SET lt_price = '100.00':::FLOAT8::DECIMAL,
       lt_vol = lt_vol + 20,
       lt_dts = '2020-06-17 22:27:42.148484+00:00'::TIMESTAMP
 WHERE lt_s_symb = 'SYMB'
----
update last_trade
 ├── columns: <none>
 ├── fetch columns: lt_s_symb:7 lt_dts:8 last_trade.lt_price:9 lt_open_price:10 lt_vol:11
 ├── update-mapping:
 │    ├── lt_dts_new:15 => lt_dts:2
 │    ├── lt_price:16 => last_trade.lt_price:3
 │    └── lt_vol_new:14 => lt_vol:5
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── project
      ├── columns: lt_price:16!null lt_vol_new:14!null lt_dts_new:15!null lt_s_symb:7!null lt_dts:8!null last_trade.lt_price:9!null lt_open_price:10!null lt_vol:11!null
      ├── cardinality: [0 - 1]
      ├── immutable
      ├── key: ()
      ├── fd: ()-->(7-11,14-16)
      ├── scan last_trade
      │    ├── columns: lt_s_symb:7!null lt_dts:8!null last_trade.lt_price:9!null lt_open_price:10!null lt_vol:11!null
      │    ├── constraint: /7: [/'SYMB' - /'SYMB']
      │    ├── cardinality: [0 - 1]
      │    ├── key: ()
      │    └── fd: ()-->(7-11)
      └── projections
           ├── 1E+2 [as=lt_price:16]
           ├── lt_vol:11 + 20 [as=lt_vol_new:14, outer=(11), immutable]
           └── '2020-06-17 22:27:42.148484' [as=lt_dts_new:15]

# Q2
opt
SELECT tr_t_id, tr_bid_price::FLOAT8, tr_tt_id, tr_qty
  FROM trade_request
 WHERE tr_s_symb = 'SYMB'
   AND (
        (tr_tt_id = 'Stop-Loss' AND tr_bid_price >= '100.00':::FLOAT8::DECIMAL)
        OR (tr_tt_id = 'Limit-Sell' AND tr_bid_price <= '100.00':::FLOAT8::DECIMAL)
        OR (tr_tt_id = 'Limit-Buy' AND tr_bid_price >= '100.00':::FLOAT8::DECIMAL)
       )
----
project
 ├── columns: tr_t_id:1!null tr_bid_price:8!null tr_tt_id:2!null tr_qty:4!null
 ├── immutable
 ├── key: (1)
 ├── fd: (1)-->(2,4,8)
 ├── select
 │    ├── columns: tr_t_id:1!null tr_tt_id:2!null tr_s_symb:3!null tr_qty:4!null trade_request.tr_bid_price:5!null
 │    ├── immutable
 │    ├── key: (1)
 │    ├── fd: ()-->(3), (1)-->(2,4,5)
 │    ├── index-join trade_request
 │    │    ├── columns: tr_t_id:1!null tr_tt_id:2!null tr_s_symb:3!null tr_qty:4!null trade_request.tr_bid_price:5!null
 │    │    ├── key: (1)
 │    │    ├── fd: ()-->(3), (1)-->(2,4,5)
 │    │    └── scan trade_request@secondary
 │    │         ├── columns: tr_t_id:1!null tr_s_symb:3!null tr_qty:4!null trade_request.tr_bid_price:5!null
 │    │         ├── constraint: /3/6/1: [/'SYMB' - /'SYMB']
 │    │         ├── key: (1)
 │    │         └── fd: ()-->(3), (1)-->(4,5)
 │    └── filters
 │         └── (((tr_tt_id:2 = 'Stop-Loss') AND (trade_request.tr_bid_price:5 >= 1E+2)) OR ((tr_tt_id:2 = 'Limit-Sell') AND (trade_request.tr_bid_price:5 <= 1E+2))) OR ((tr_tt_id:2 = 'Limit-Buy') AND (trade_request.tr_bid_price:5 >= 1E+2)) [outer=(2,5), immutable, constraints=(/2: [/'Limit-Buy' - /'Limit-Buy'] [/'Limit-Sell' - /'Limit-Sell'] [/'Stop-Loss' - /'Stop-Loss']; /5: (/NULL - ])]
 └── projections
      └── trade_request.tr_bid_price:5::FLOAT8 [as=tr_bid_price:8, outer=(5), immutable]

# Q3
opt
UPDATE trade
   SET t_dts = '2020-06-15 22:27:42.148484+00:00'::TIMESTAMP, t_st_id = 'SBMT'
 WHERE t_id = 0
----
update trade
 ├── columns: <none>
 ├── fetch columns: t_id:17 t_dts:18 trade.t_st_id:19 t_tt_id:20 t_is_cash:21 t_s_symb:22 t_qty:23 t_bid_price:24 t_ca_id:25 t_exec_name:26 t_trade_price:27 t_chrg:28 t_comm:29 t_tax:30 t_lifo:31
 ├── update-mapping:
 │    ├── t_dts_new:33 => t_dts:2
 │    └── t_st_id_new:34 => trade.t_st_id:3
 ├── input binding: &1
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 ├── project
 │    ├── columns: t_dts_new:33!null t_st_id_new:34!null t_id:17!null t_dts:18!null trade.t_st_id:19!null t_tt_id:20!null t_is_cash:21!null t_s_symb:22!null t_qty:23!null t_bid_price:24 t_ca_id:25!null t_exec_name:26!null t_trade_price:27 t_chrg:28!null t_comm:29!null t_tax:30!null t_lifo:31!null
 │    ├── cardinality: [0 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(17-31,33,34)
 │    ├── scan trade
 │    │    ├── columns: t_id:17!null t_dts:18!null trade.t_st_id:19!null t_tt_id:20!null t_is_cash:21!null t_s_symb:22!null t_qty:23!null t_bid_price:24 t_ca_id:25!null t_exec_name:26!null t_trade_price:27 t_chrg:28!null t_comm:29!null t_tax:30!null t_lifo:31!null
 │    │    ├── constraint: /17: [/0 - /0]
 │    │    ├── cardinality: [0 - 1]
 │    │    ├── key: ()
 │    │    └── fd: ()-->(17-31)
 │    └── projections
 │         ├── '2020-06-15 22:27:42.148484' [as=t_dts_new:33]
 │         └── 'SBMT' [as=t_st_id_new:34]
 └── f-k-checks
      └── f-k-checks-item: trade(t_st_id) -> status_type(st_id)
           └── anti-join (lookup status_type)
                ├── columns: t_st_id:40!null
                ├── key columns: [40] = [41]
                ├── lookup columns are key
                ├── cardinality: [0 - 1]
                ├── key: ()
                ├── fd: ()-->(40)
                ├── with-scan &1
                │    ├── columns: t_st_id:40!null
                │    ├── mapping:
                │    │    └──  t_st_id_new:34 => t_st_id:40
                │    ├── cardinality: [0 - 1]
                │    ├── key: ()
                │    └── fd: ()-->(40)
                └── filters (true)

# Q4
opt
DELETE FROM trade_request WHERE tr_t_id = 0
----
delete trade_request
 ├── columns: <none>
 ├── fetch columns: tr_t_id:8 tr_s_symb:10 tr_b_id:13
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── scan trade_request
      ├── columns: tr_t_id:8!null tr_s_symb:10!null tr_b_id:13!null
      ├── constraint: /8: [/0 - /0]
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(8,10,13)

# Q5
opt
INSERT INTO trade_history (th_t_id, th_dts, th_st_id)
VALUES (0, '2020-06-17 22:27:42.148484+00:00'::TIMESTAMP, 'SBMT')
----
insert trade_history
 ├── columns: <none>
 ├── insert-mapping:
 │    ├── column1:5 => trade_history.th_t_id:1
 │    ├── column2:6 => th_dts:2
 │    └── column3:7 => trade_history.th_st_id:3
 ├── input binding: &1
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 ├── values
 │    ├── columns: column1:5!null column2:6!null column3:7!null
 │    ├── cardinality: [1 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(5-7)
 │    └── (0, '2020-06-17 22:27:42.148484', 'SBMT')
 └── f-k-checks
      ├── f-k-checks-item: trade_history(th_t_id) -> trade(t_id)
      │    └── anti-join (lookup trade)
      │         ├── columns: th_t_id:8!null
      │         ├── key columns: [8] = [9]
      │         ├── lookup columns are key
      │         ├── cardinality: [0 - 1]
      │         ├── key: ()
      │         ├── fd: ()-->(8)
      │         ├── with-scan &1
      │         │    ├── columns: th_t_id:8!null
      │         │    ├── mapping:
      │         │    │    └──  column1:5 => th_t_id:8
      │         │    ├── cardinality: [1 - 1]
      │         │    ├── key: ()
      │         │    └── fd: ()-->(8)
      │         └── filters (true)
      └── f-k-checks-item: trade_history(th_st_id) -> status_type(st_id)
           └── anti-join (lookup status_type)
                ├── columns: th_st_id:25!null
                ├── key columns: [25] = [26]
                ├── lookup columns are key
                ├── cardinality: [0 - 1]
                ├── key: ()
                ├── fd: ()-->(25)
                ├── with-scan &1
                │    ├── columns: th_st_id:25!null
                │    ├── mapping:
                │    │    └──  column3:7 => th_st_id:25
                │    ├── cardinality: [1 - 1]
                │    ├── key: ()
                │    └── fd: ()-->(25)
                └── filters (true)

# --------------------------------------------------
# T4
# Market-Watch
# Emulates the process of monitoring the overall performance of the market by
# allowing a customer to track the current daily trend (up or down) of a
# collection of securities. The collection of securities being monitored may be
# based upon a customer’s current holdings, a customer’s watch list of
# prospective securities, or a particular industry.
# --------------------------------------------------

# Q1
opt
SELECT wi_s_symb
  FROM watch_item, watch_list
 WHERE wi_wl_id = wl_id AND wl_c_id = 0
----
project
 ├── columns: wi_s_symb:2!null
 └── inner-join (lookup watch_item)
      ├── columns: wi_wl_id:1!null wi_s_symb:2!null wl_id:4!null wl_c_id:5!null
      ├── key columns: [4] = [1]
      ├── key: (2,4)
      ├── fd: ()-->(5), (1)==(4), (4)==(1)
      ├── select
      │    ├── columns: wl_id:4!null wl_c_id:5!null
      │    ├── key: (4)
      │    ├── fd: ()-->(5)
      │    ├── scan watch_list
      │    │    ├── columns: wl_id:4!null wl_c_id:5!null
      │    │    ├── key: (4)
      │    │    └── fd: (4)-->(5)
      │    └── filters
      │         └── wl_c_id:5 = 0 [outer=(5), constraints=(/5: [/0 - /0]; tight), fd=()-->(5)]
      └── filters (true)

# Q2
opt
SELECT
  s_symb
FROM
  industry,
  company,
  security
WHERE
  in_name = 'Software' AND
  co_in_id = in_id AND
  co_id >= 1 AND
  co_id <= 5000 AND
  s_co_id = co_id
----
project
 ├── columns: s_symb:15!null
 ├── key: (15)
 └── inner-join (lookup industry)
      ├── columns: in_id:1!null in_name:2!null co_id:5!null co_in_id:8!null s_symb:15!null s_co_id:20!null
      ├── key columns: [8] = [1]
      ├── lookup columns are key
      ├── key: (15)
      ├── fd: ()-->(2), (5)-->(8), (15)-->(20), (5)==(20), (20)==(5), (1)==(8), (8)==(1)
      ├── inner-join (lookup security@secondary)
      │    ├── columns: co_id:5!null co_in_id:8!null s_symb:15!null s_co_id:20!null
      │    ├── key columns: [5] = [20]
      │    ├── key: (15)
      │    ├── fd: (5)-->(8), (15)-->(20), (5)==(20), (20)==(5)
      │    ├── scan company
      │    │    ├── columns: co_id:5!null co_in_id:8!null
      │    │    ├── constraint: /5: [/1 - /5000]
      │    │    ├── cardinality: [0 - 5000]
      │    │    ├── key: (5)
      │    │    └── fd: (5)-->(8)
      │    └── filters
      │         └── (s_co_id:20 >= 1) AND (s_co_id:20 <= 5000) [outer=(20), constraints=(/20: [/1 - /5000]; tight)]
      └── filters
           └── in_name:2 = 'Software' [outer=(2), constraints=(/2: [/'Software' - /'Software']; tight), fd=()-->(2)]

# Q3
opt
SELECT hs_s_symb FROM holding_summary WHERE hs_ca_id = 0
----
project
 ├── columns: hs_s_symb:2!null
 ├── key: (2)
 └── scan holding_summary
      ├── columns: hs_ca_id:1!null hs_s_symb:2!null
      ├── constraint: /1/2: [/0 - /0]
      ├── key: (2)
      └── fd: ()-->(1)

# Q4
opt
SELECT lt_price FROM last_trade WHERE lt_s_symb = 'SYMB'
----
project
 ├── columns: lt_price:3!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(3)
 └── scan last_trade
      ├── columns: lt_s_symb:1!null lt_price:3!null
      ├── constraint: /1: [/'SYMB' - /'SYMB']
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1,3)

# Q5
opt
SELECT s_num_out FROM security WHERE s_symb = 'SYMB'
----
project
 ├── columns: s_num_out:7!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(7)
 └── scan security
      ├── columns: s_symb:1!null s_num_out:7!null
      ├── constraint: /1: [/'SYMB' - /'SYMB']
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1,7)

# Q6
opt
SELECT dm_close
  FROM daily_market
 WHERE dm_s_symb = 'SYMB' AND
       dm_date = '2020-06-17'::DATE
----
project
 ├── columns: dm_close:3!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(3)
 └── scan daily_market
      ├── columns: dm_date:1!null dm_s_symb:2!null dm_close:3!null
      ├── constraint: /1/2: [/'2020-06-17'/'SYMB' - /'2020-06-17'/'SYMB']
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1-3)

# --------------------------------------------------
# T5
# Security-Detail
# Emulates the process of accessing detailed information on a particular
# security. This is representative of a customer doing research on a security
# prior to making a decision about whether or not to execute a trade.
# --------------------------------------------------

# Q1 Version 1
opt
SELECT s_name,
      co_id,
      co_name,
      co_sp_rate,
      co_ceo,
      co_desc,
      co_open_date,
      co_st_id,
      ca.ad_line1,
      ca.ad_line2,
      zca.zc_town,
      zca.zc_div,
      ca.ad_zc_code,
      ca.ad_ctry,
      s_num_out,
      s_start_date,
      s_exch_date,
      s_pe::FLOAT8,
      s_52wk_high::FLOAT8,
      s_52wk_high_date,
      s_52wk_low::FLOAT8,
      s_52wk_low_date,
      s_dividend::FLOAT8,
      s_yield::FLOAT8,
      zea.zc_div,
      ea.ad_ctry,
      ea.ad_line1,
      ea.ad_line2,
      zea.zc_town,
      ea.ad_zc_code,
      ex_close,
      ex_desc,
      ex_name,
      ex_num_symb,
      ex_open
 FROM security,
      company,
      address AS ca,
      zip_code AS zca,
      exchange,
      address AS ea,
      zip_code AS zea
WHERE s_symb = 'SYMB' AND
      co_id = s_co_id AND
      ca.ad_id = co_ad_id and
      ea.ad_id = ex_ad_id and
      ex_id = s_ex_id and
      ca.ad_zc_code = zca.zc_code and
      ea.ad_zc_code =zea.zc_code
----
project
 ├── columns: s_name:4!null co_id:18!null co_name:20!null co_sp_rate:22!null co_ceo:23!null co_desc:25!null co_open_date:26!null co_st_id:19!null ad_line1:29 ad_line2:30 zc_town:35!null zc_div:36!null ad_zc_code:31!null ad_ctry:32 s_num_out:7!null s_start_date:8!null s_exch_date:9!null s_pe:56!null s_52wk_high:57!null s_52wk_high_date:12!null s_52wk_low:58!null s_52wk_low_date:14!null s_dividend:59!null s_yield:60!null zc_div:54!null ad_ctry:50 ad_line1:47 ad_line2:48 zc_town:53!null ad_zc_code:49!null ex_close:42!null ex_desc:43 ex_name:39!null ex_num_symb:40!null ex_open:41!null
 ├── cardinality: [0 - 1]
 ├── immutable
 ├── key: ()
 ├── fd: ()-->(4,7-9,12,14,18-20,22,23,25,26,29-32,35,36,39-43,47-50,53,54,56-60)
 ├── inner-join (lookup zip_code [as=zca])
 │    ├── columns: s_symb:1!null s_name:4!null s_ex_id:5!null s_co_id:6!null s_num_out:7!null s_start_date:8!null s_exch_date:9!null security.s_pe:10!null security.s_52wk_high:11!null s_52wk_high_date:12!null security.s_52wk_low:13!null s_52wk_low_date:14!null security.s_dividend:15!null security.s_yield:16!null co_id:18!null co_st_id:19!null co_name:20!null co_sp_rate:22!null co_ceo:23!null co_ad_id:24!null co_desc:25!null co_open_date:26!null ca.ad_id:28!null ca.ad_line1:29 ca.ad_line2:30 ca.ad_zc_code:31!null ca.ad_ctry:32 zca.zc_code:34!null zca.zc_town:35!null zca.zc_div:36!null ex_id:38!null ex_name:39!null ex_num_symb:40!null ex_open:41!null ex_close:42!null ex_desc:43 ex_ad_id:44!null ea.ad_id:46!null ea.ad_line1:47 ea.ad_line2:48 ea.ad_zc_code:49!null ea.ad_ctry:50 zea.zc_code:52!null zea.zc_town:53!null zea.zc_div:54!null
 │    ├── key columns: [31] = [34]
 │    ├── lookup columns are key
 │    ├── cardinality: [0 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(1,4-16,18-20,22-26,28-32,34-36,38-44,46-50,52-54), (24)==(28), (28)==(24), (6)==(18), (18)==(6), (31)==(34), (49)==(52), (52)==(49), (44)==(46), (46)==(44), (5)==(38), (38)==(5), (34)==(31)
 │    ├── inner-join (lookup address [as=ca])
 │    │    ├── columns: s_symb:1!null s_name:4!null s_ex_id:5!null s_co_id:6!null s_num_out:7!null s_start_date:8!null s_exch_date:9!null security.s_pe:10!null security.s_52wk_high:11!null s_52wk_high_date:12!null security.s_52wk_low:13!null s_52wk_low_date:14!null security.s_dividend:15!null security.s_yield:16!null co_id:18!null co_st_id:19!null co_name:20!null co_sp_rate:22!null co_ceo:23!null co_ad_id:24!null co_desc:25!null co_open_date:26!null ca.ad_id:28!null ca.ad_line1:29 ca.ad_line2:30 ca.ad_zc_code:31!null ca.ad_ctry:32 ex_id:38!null ex_name:39!null ex_num_symb:40!null ex_open:41!null ex_close:42!null ex_desc:43 ex_ad_id:44!null ea.ad_id:46!null ea.ad_line1:47 ea.ad_line2:48 ea.ad_zc_code:49!null ea.ad_ctry:50 zea.zc_code:52!null zea.zc_town:53!null zea.zc_div:54!null
 │    │    ├── key columns: [24] = [28]
 │    │    ├── lookup columns are key
 │    │    ├── cardinality: [0 - 1]
 │    │    ├── key: ()
 │    │    ├── fd: ()-->(1,4-16,18-20,22-26,28-32,38-44,46-50,52-54), (46)==(44), (5)==(38), (38)==(5), (49)==(52), (6)==(18), (18)==(6), (52)==(49), (24)==(28), (28)==(24), (44)==(46)
 │    │    ├── inner-join (lookup company)
 │    │    │    ├── columns: s_symb:1!null s_name:4!null s_ex_id:5!null s_co_id:6!null s_num_out:7!null s_start_date:8!null s_exch_date:9!null security.s_pe:10!null security.s_52wk_high:11!null s_52wk_high_date:12!null security.s_52wk_low:13!null s_52wk_low_date:14!null security.s_dividend:15!null security.s_yield:16!null co_id:18!null co_st_id:19!null co_name:20!null co_sp_rate:22!null co_ceo:23!null co_ad_id:24!null co_desc:25!null co_open_date:26!null ex_id:38!null ex_name:39!null ex_num_symb:40!null ex_open:41!null ex_close:42!null ex_desc:43 ex_ad_id:44!null ea.ad_id:46!null ea.ad_line1:47 ea.ad_line2:48 ea.ad_zc_code:49!null ea.ad_ctry:50 zea.zc_code:52!null zea.zc_town:53!null zea.zc_div:54!null
 │    │    │    ├── key columns: [6] = [18]
 │    │    │    ├── lookup columns are key
 │    │    │    ├── cardinality: [0 - 1]
 │    │    │    ├── key: ()
 │    │    │    ├── fd: ()-->(1,4-16,18-20,22-26,38-44,46-50,52-54), (44)==(46), (46)==(44), (5)==(38), (38)==(5), (49)==(52), (6)==(18), (18)==(6), (52)==(49)
 │    │    │    ├── inner-join (lookup zip_code [as=zea])
 │    │    │    │    ├── columns: s_symb:1!null s_name:4!null s_ex_id:5!null s_co_id:6!null s_num_out:7!null s_start_date:8!null s_exch_date:9!null security.s_pe:10!null security.s_52wk_high:11!null s_52wk_high_date:12!null security.s_52wk_low:13!null s_52wk_low_date:14!null security.s_dividend:15!null security.s_yield:16!null ex_id:38!null ex_name:39!null ex_num_symb:40!null ex_open:41!null ex_close:42!null ex_desc:43 ex_ad_id:44!null ea.ad_id:46!null ea.ad_line1:47 ea.ad_line2:48 ea.ad_zc_code:49!null ea.ad_ctry:50 zea.zc_code:52!null zea.zc_town:53!null zea.zc_div:54!null
 │    │    │    │    ├── key columns: [49] = [52]
 │    │    │    │    ├── lookup columns are key
 │    │    │    │    ├── cardinality: [0 - 1]
 │    │    │    │    ├── key: ()
 │    │    │    │    ├── fd: ()-->(1,4-16,38-44,46-50,52-54), (52)==(49), (44)==(46), (46)==(44), (5)==(38), (38)==(5), (49)==(52)
 │    │    │    │    ├── inner-join (lookup address [as=ea])
 │    │    │    │    │    ├── columns: s_symb:1!null s_name:4!null s_ex_id:5!null s_co_id:6!null s_num_out:7!null s_start_date:8!null s_exch_date:9!null security.s_pe:10!null security.s_52wk_high:11!null s_52wk_high_date:12!null security.s_52wk_low:13!null s_52wk_low_date:14!null security.s_dividend:15!null security.s_yield:16!null ex_id:38!null ex_name:39!null ex_num_symb:40!null ex_open:41!null ex_close:42!null ex_desc:43 ex_ad_id:44!null ea.ad_id:46!null ea.ad_line1:47 ea.ad_line2:48 ea.ad_zc_code:49!null ea.ad_ctry:50
 │    │    │    │    │    ├── key columns: [44] = [46]
 │    │    │    │    │    ├── lookup columns are key
 │    │    │    │    │    ├── cardinality: [0 - 1]
 │    │    │    │    │    ├── key: ()
 │    │    │    │    │    ├── fd: ()-->(1,4-16,38-44,46-50), (46)==(44), (5)==(38), (38)==(5), (44)==(46)
 │    │    │    │    │    ├── inner-join (lookup exchange)
 │    │    │    │    │    │    ├── columns: s_symb:1!null s_name:4!null s_ex_id:5!null s_co_id:6!null s_num_out:7!null s_start_date:8!null s_exch_date:9!null security.s_pe:10!null security.s_52wk_high:11!null s_52wk_high_date:12!null security.s_52wk_low:13!null s_52wk_low_date:14!null security.s_dividend:15!null security.s_yield:16!null ex_id:38!null ex_name:39!null ex_num_symb:40!null ex_open:41!null ex_close:42!null ex_desc:43 ex_ad_id:44!null
 │    │    │    │    │    │    ├── key columns: [5] = [38]
 │    │    │    │    │    │    ├── lookup columns are key
 │    │    │    │    │    │    ├── cardinality: [0 - 1]
 │    │    │    │    │    │    ├── key: ()
 │    │    │    │    │    │    ├── fd: ()-->(1,4-16,38-44), (38)==(5), (5)==(38)
 │    │    │    │    │    │    ├── scan security
 │    │    │    │    │    │    │    ├── columns: s_symb:1!null s_name:4!null s_ex_id:5!null s_co_id:6!null s_num_out:7!null s_start_date:8!null s_exch_date:9!null security.s_pe:10!null security.s_52wk_high:11!null s_52wk_high_date:12!null security.s_52wk_low:13!null s_52wk_low_date:14!null security.s_dividend:15!null security.s_yield:16!null
 │    │    │    │    │    │    │    ├── constraint: /1: [/'SYMB' - /'SYMB']
 │    │    │    │    │    │    │    ├── cardinality: [0 - 1]
 │    │    │    │    │    │    │    ├── key: ()
 │    │    │    │    │    │    │    └── fd: ()-->(1,4-16)
 │    │    │    │    │    │    └── filters (true)
 │    │    │    │    │    └── filters (true)
 │    │    │    │    └── filters (true)
 │    │    │    └── filters (true)
 │    │    └── filters (true)
 │    └── filters (true)
 └── projections
      ├── security.s_pe:10::FLOAT8 [as=s_pe:56, outer=(10), immutable]
      ├── security.s_52wk_high:11::FLOAT8 [as=s_52wk_high:57, outer=(11), immutable]
      ├── security.s_52wk_low:13::FLOAT8 [as=s_52wk_low:58, outer=(13), immutable]
      ├── security.s_dividend:15::FLOAT8 [as=s_dividend:59, outer=(15), immutable]
      └── security.s_yield:16::FLOAT8 [as=s_yield:60, outer=(16), immutable]

# Q2
opt
SELECT co_name, in_name
  FROM company_competitor, company, industry
 WHERE cp_co_id = 0 AND co_id = cp_comp_co_id AND in_id = cp_in_id
 LIMIT 3
----
project
 ├── columns: co_name:7!null in_name:16!null
 ├── cardinality: [0 - 3]
 └── inner-join (lookup industry)
      ├── columns: cp_co_id:1!null cp_comp_co_id:2!null cp_in_id:3!null co_id:5!null co_name:7!null in_id:15!null in_name:16!null
      ├── key columns: [3] = [15]
      ├── lookup columns are key
      ├── cardinality: [0 - 3]
      ├── key: (5,15)
      ├── fd: ()-->(1), (5)-->(7), (7)-->(5), (2)==(5), (5)==(2), (15)-->(16), (3)==(15), (15)==(3)
      ├── inner-join (lookup company)
      │    ├── columns: cp_co_id:1!null cp_comp_co_id:2!null cp_in_id:3!null co_id:5!null co_name:7!null
      │    ├── key columns: [2] = [5]
      │    ├── lookup columns are key
      │    ├── cardinality: [0 - 3]
      │    ├── key: (3,5)
      │    ├── fd: ()-->(1), (5)-->(7), (7)-->(5), (2)==(5), (5)==(2)
      │    ├── scan company_competitor
      │    │    ├── columns: cp_co_id:1!null cp_comp_co_id:2!null cp_in_id:3!null
      │    │    ├── constraint: /1/2/3: [/0 - /0]
      │    │    ├── limit: 3
      │    │    ├── key: (2,3)
      │    │    └── fd: ()-->(1)
      │    └── filters (true)
      └── filters (true)

# Q3
opt
  SELECT fi_year,
         fi_qtr,
         fi_qtr_start_date,
         fi_revenue::FLOAT8,
         fi_net_earn::FLOAT8,
         fi_basic_eps::FLOAT8,
         fi_dilut_eps::FLOAT8,
         fi_margin::FLOAT8,
         fi_inventory::FLOAT8,
         fi_assets::FLOAT8,
         fi_liability::FLOAT8,
         fi_out_basic,
         fi_out_dilut
    FROM financial
   WHERE fi_co_id = 0
ORDER BY fi_year ASC, fi_qtr ASC
   LIMIT 20
----
project
 ├── columns: fi_year:2!null fi_qtr:3!null fi_qtr_start_date:4!null fi_revenue:16!null fi_net_earn:17!null fi_basic_eps:18!null fi_dilut_eps:19!null fi_margin:20!null fi_inventory:21!null fi_assets:22!null fi_liability:23!null fi_out_basic:13!null fi_out_dilut:14!null
 ├── cardinality: [0 - 20]
 ├── immutable
 ├── key: (2,3)
 ├── fd: (2,3)-->(4,13,14,16-23)
 ├── ordering: +2,+3
 ├── scan financial
 │    ├── columns: fi_co_id:1!null fi_year:2!null fi_qtr:3!null fi_qtr_start_date:4!null financial.fi_revenue:5!null financial.fi_net_earn:6!null financial.fi_basic_eps:7!null financial.fi_dilut_eps:8!null financial.fi_margin:9!null financial.fi_inventory:10!null financial.fi_assets:11!null financial.fi_liability:12!null fi_out_basic:13!null fi_out_dilut:14!null
 │    ├── constraint: /1/2/3: [/0 - /0]
 │    ├── limit: 20
 │    ├── key: (2,3)
 │    ├── fd: ()-->(1), (2,3)-->(4-14)
 │    └── ordering: +2,+3 opt(1) [actual: +2,+3]
 └── projections
      ├── financial.fi_revenue:5::FLOAT8 [as=fi_revenue:16, outer=(5), immutable]
      ├── financial.fi_net_earn:6::FLOAT8 [as=fi_net_earn:17, outer=(6), immutable]
      ├── financial.fi_basic_eps:7::FLOAT8 [as=fi_basic_eps:18, outer=(7), immutable]
      ├── financial.fi_dilut_eps:8::FLOAT8 [as=fi_dilut_eps:19, outer=(8), immutable]
      ├── financial.fi_margin:9::FLOAT8 [as=fi_margin:20, outer=(9), immutable]
      ├── financial.fi_inventory:10::FLOAT8 [as=fi_inventory:21, outer=(10), immutable]
      ├── financial.fi_assets:11::FLOAT8 [as=fi_assets:22, outer=(11), immutable]
      └── financial.fi_liability:12::FLOAT8 [as=fi_liability:23, outer=(12), immutable]

# Q4
opt
  SELECT dm_date, dm_close::FLOAT8, dm_high::FLOAT8, dm_low::FLOAT8, dm_vol
    FROM daily_market
   WHERE dm_s_symb = 'SYMB' AND dm_date >= '2020-06-17'::DATE
ORDER BY dm_date ASC
   LIMIT 10
----
project
 ├── columns: dm_date:1!null dm_close:8!null dm_high:9!null dm_low:10!null dm_vol:6!null
 ├── cardinality: [0 - 10]
 ├── immutable
 ├── key: (1)
 ├── fd: (1)-->(6,8-10)
 ├── ordering: +1
 ├── scan daily_market@secondary
 │    ├── columns: dm_date:1!null dm_s_symb:2!null daily_market.dm_close:3!null daily_market.dm_high:4!null daily_market.dm_low:5!null dm_vol:6!null
 │    ├── constraint: /2/1: [/'SYMB'/'2020-06-17' - /'SYMB']
 │    ├── limit: 10
 │    ├── key: (1)
 │    ├── fd: ()-->(2), (1)-->(3-6)
 │    └── ordering: +1 opt(2) [actual: +1]
 └── projections
      ├── daily_market.dm_close:3::FLOAT8 [as=dm_close:8, outer=(3), immutable]
      ├── daily_market.dm_high:4::FLOAT8 [as=dm_high:9, outer=(4), immutable]
      └── daily_market.dm_low:5::FLOAT8 [as=dm_low:10, outer=(5), immutable]

# Q5
opt
SELECT lt_price::FLOAT8, lt_open_price::FLOAT8, lt_vol
  FROM last_trade
 WHERE lt_s_symb = 'SYMB'
----
project
 ├── columns: lt_price:7!null lt_open_price:8!null lt_vol:5!null
 ├── cardinality: [0 - 1]
 ├── immutable
 ├── key: ()
 ├── fd: ()-->(5,7,8)
 ├── scan last_trade
 │    ├── columns: lt_s_symb:1!null last_trade.lt_price:3!null last_trade.lt_open_price:4!null lt_vol:5!null
 │    ├── constraint: /1: [/'SYMB' - /'SYMB']
 │    ├── cardinality: [0 - 1]
 │    ├── key: ()
 │    └── fd: ()-->(1,3-5)
 └── projections
      ├── last_trade.lt_price:3::FLOAT8 [as=lt_price:7, outer=(3), immutable]
      └── last_trade.lt_open_price:4::FLOAT8 [as=lt_open_price:8, outer=(4), immutable]

# Q6
opt
SELECT ni_dts, ni_source, ni_author, ni_item
  FROM news_xref, news_item
 WHERE ni_id = nx_ni_id AND nx_co_id = 0
 LIMIT 2
----
project
 ├── columns: ni_dts:8!null ni_source:9!null ni_author:10 ni_item:7!null
 ├── cardinality: [0 - 2]
 └── inner-join (lookup news_item)
      ├── columns: nx_ni_id:1!null nx_co_id:2!null ni_id:4!null ni_item:7!null ni_dts:8!null ni_source:9!null ni_author:10
      ├── key columns: [1] = [4]
      ├── lookup columns are key
      ├── cardinality: [0 - 2]
      ├── key: (4)
      ├── fd: ()-->(2), (4)-->(7-10), (1)==(4), (4)==(1)
      ├── limit
      │    ├── columns: nx_ni_id:1!null nx_co_id:2!null
      │    ├── cardinality: [0 - 2]
      │    ├── key: (1)
      │    ├── fd: ()-->(2)
      │    ├── select
      │    │    ├── columns: nx_ni_id:1!null nx_co_id:2!null
      │    │    ├── key: (1)
      │    │    ├── fd: ()-->(2)
      │    │    ├── limit hint: 2.00
      │    │    ├── scan news_xref
      │    │    │    ├── columns: nx_ni_id:1!null nx_co_id:2!null
      │    │    │    └── key: (1,2)
      │    │    └── filters
      │    │         └── nx_co_id:2 = 0 [outer=(2), constraints=(/2: [/0 - /0]; tight), fd=()-->(2)]
      │    └── 2
      └── filters (true)

# Q7
opt
SELECT ni_dts, ni_source, ni_author, ni_headline, ni_summary
  FROM news_xref, news_item
 WHERE ni_id = nx_ni_id AND nx_co_id = 0
 LIMIT 2
----
project
 ├── columns: ni_dts:8!null ni_source:9!null ni_author:10 ni_headline:5!null ni_summary:6!null
 ├── cardinality: [0 - 2]
 └── inner-join (lookup news_item)
      ├── columns: nx_ni_id:1!null nx_co_id:2!null ni_id:4!null ni_headline:5!null ni_summary:6!null ni_dts:8!null ni_source:9!null ni_author:10
      ├── key columns: [1] = [4]
      ├── lookup columns are key
      ├── cardinality: [0 - 2]
      ├── key: (4)
      ├── fd: ()-->(2), (4)-->(5,6,8-10), (1)==(4), (4)==(1)
      ├── limit
      │    ├── columns: nx_ni_id:1!null nx_co_id:2!null
      │    ├── cardinality: [0 - 2]
      │    ├── key: (1)
      │    ├── fd: ()-->(2)
      │    ├── select
      │    │    ├── columns: nx_ni_id:1!null nx_co_id:2!null
      │    │    ├── key: (1)
      │    │    ├── fd: ()-->(2)
      │    │    ├── limit hint: 2.00
      │    │    ├── scan news_xref
      │    │    │    ├── columns: nx_ni_id:1!null nx_co_id:2!null
      │    │    │    └── key: (1,2)
      │    │    └── filters
      │    │         └── nx_co_id:2 = 0 [outer=(2), constraints=(/2: [/0 - /0]; tight), fd=()-->(2)]
      │    └── 2
      └── filters (true)

# --------------------------------------------------
# T6
# Trade-Lookup
# Emulates information retrieval by either a customer or a broker to satisfy
# their questions regarding a set of trades. The various sets of trades are
# chosen such that the work is representative of:
#   * performing general market analysis
#   * reviewing trades for a period of time prior to the most recent account
#     statement
#   * analyzing past performance of a particular security
#   * analyzing the history of a particular customer holding
# --------------------------------------------------

# Q1
opt
SELECT t_bid_price::FLOAT8,
       t_exec_name,
       t_is_cash,
       tt_is_mrkt,
       t_trade_price::FLOAT8
  FROM trade, trade_type
 WHERE t_id = 0 AND t_tt_id = tt_id
----
project
 ├── columns: t_bid_price:22 t_exec_name:10!null t_is_cash:5!null tt_is_mrkt:20!null t_trade_price:23
 ├── cardinality: [0 - 1]
 ├── immutable
 ├── key: ()
 ├── fd: ()-->(5,10,20,22,23)
 ├── inner-join (lookup trade_type)
 │    ├── columns: t_id:1!null t_tt_id:4!null t_is_cash:5!null trade.t_bid_price:8 t_exec_name:10!null trade.t_trade_price:11 tt_id:17!null tt_is_mrkt:20!null
 │    ├── key columns: [4] = [17]
 │    ├── lookup columns are key
 │    ├── cardinality: [0 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(1,4,5,8,10,11,17,20), (17)==(4), (4)==(17)
 │    ├── scan trade
 │    │    ├── columns: t_id:1!null t_tt_id:4!null t_is_cash:5!null trade.t_bid_price:8 t_exec_name:10!null trade.t_trade_price:11
 │    │    ├── constraint: /1: [/0 - /0]
 │    │    ├── cardinality: [0 - 1]
 │    │    ├── key: ()
 │    │    └── fd: ()-->(1,4,5,8,10,11)
 │    └── filters (true)
 └── projections
      ├── trade.t_bid_price:8::FLOAT8 [as=t_bid_price:22, outer=(8), immutable]
      └── trade.t_trade_price:11::FLOAT8 [as=t_trade_price:23, outer=(11), immutable]

# Q2
opt
SELECT se_amt::FLOAT8, se_cash_due_date, se_cash_type
  FROM settlement
 WHERE se_t_id = 0
----
project
 ├── columns: se_amt:6!null se_cash_due_date:3!null se_cash_type:2!null
 ├── cardinality: [0 - 1]
 ├── immutable
 ├── key: ()
 ├── fd: ()-->(2,3,6)
 ├── scan settlement
 │    ├── columns: se_t_id:1!null se_cash_type:2!null se_cash_due_date:3!null settlement.se_amt:4!null
 │    ├── constraint: /1: [/0 - /0]
 │    ├── cardinality: [0 - 1]
 │    ├── key: ()
 │    └── fd: ()-->(1-4)
 └── projections
      └── settlement.se_amt:4::FLOAT8 [as=se_amt:6, outer=(4), immutable]

# Q3
opt
SELECT ct_amt::FLOAT8, ct_dts, ct_name FROM cash_transaction WHERE ct_t_id = 0
----
project
 ├── columns: ct_amt:6!null ct_dts:2!null ct_name:4
 ├── cardinality: [0 - 1]
 ├── immutable
 ├── key: ()
 ├── fd: ()-->(2,4,6)
 ├── scan cash_transaction
 │    ├── columns: ct_t_id:1!null ct_dts:2!null cash_transaction.ct_amt:3!null ct_name:4
 │    ├── constraint: /1: [/0 - /0]
 │    ├── cardinality: [0 - 1]
 │    ├── key: ()
 │    └── fd: ()-->(1-4)
 └── projections
      └── cash_transaction.ct_amt:3::FLOAT8 [as=ct_amt:6, outer=(3), immutable]

# Q4
opt
  SELECT th_dts, th_st_id
    FROM trade_history
   WHERE th_t_id = 0
ORDER BY th_dts
   LIMIT 3
----
project
 ├── columns: th_dts:2!null th_st_id:3!null
 ├── cardinality: [0 - 3]
 ├── key: (3)
 ├── fd: (3)-->(2)
 ├── ordering: +2
 └── limit
      ├── columns: th_t_id:1!null th_dts:2!null th_st_id:3!null
      ├── internal-ordering: +2 opt(1)
      ├── cardinality: [0 - 3]
      ├── key: (3)
      ├── fd: ()-->(1), (3)-->(2)
      ├── ordering: +2 opt(1) [actual: +2]
      ├── sort
      │    ├── columns: th_t_id:1!null th_dts:2!null th_st_id:3!null
      │    ├── key: (3)
      │    ├── fd: ()-->(1), (3)-->(2)
      │    ├── ordering: +2 opt(1) [actual: +2]
      │    ├── limit hint: 3.00
      │    └── scan trade_history
      │         ├── columns: th_t_id:1!null th_dts:2!null th_st_id:3!null
      │         ├── constraint: /1/3: [/0 - /0]
      │         ├── key: (3)
      │         └── fd: ()-->(1), (3)-->(2)
      └── 3

# Q5
opt
  SELECT t_id,
         t_bid_price::FLOAT8,
         t_exec_name,
         t_is_cash,
         t_trade_price::FLOAT8
    FROM trade
   WHERE t_ca_id = 0 AND
         t_dts >= '2020-06-15 22:27:42.148484+00:00'::TIMESTAMP AND
         t_dts <= '2020-06-17 22:27:42.148484+00:00'::TIMESTAMP
ORDER BY t_dts ASC
   LIMIT 20
----
project
 ├── columns: t_id:1!null t_bid_price:17 t_exec_name:10!null t_is_cash:5!null t_trade_price:18  [hidden: t_dts:2!null]
 ├── cardinality: [0 - 20]
 ├── immutable
 ├── key: (1)
 ├── fd: (1)-->(2,5,10,17,18)
 ├── ordering: +2
 ├── scan trade@secondary,rev
 │    ├── columns: t_id:1!null t_dts:2!null t_is_cash:5!null trade.t_bid_price:8 t_ca_id:9!null t_exec_name:10!null trade.t_trade_price:11
 │    ├── constraint: /9/-2/1: [/0/'2020-06-17 22:27:42.148484' - /0/'2020-06-15 22:27:42.148484']
 │    ├── limit: 20(rev)
 │    ├── key: (1)
 │    ├── fd: ()-->(9), (1)-->(2,5,8,10,11)
 │    └── ordering: +2 opt(9) [actual: +2]
 └── projections
      ├── trade.t_bid_price:8::FLOAT8 [as=t_bid_price:17, outer=(8), immutable]
      └── trade.t_trade_price:11::FLOAT8 [as=t_trade_price:18, outer=(11), immutable]

# Q6
opt
SELECT se_amt, se_cash_due_date, se_cash_type
  FROM settlement
 WHERE se_t_id = 0
----
project
 ├── columns: se_amt:4!null se_cash_due_date:3!null se_cash_type:2!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(2-4)
 └── scan settlement
      ├── columns: se_t_id:1!null se_cash_type:2!null se_cash_due_date:3!null se_amt:4!null
      ├── constraint: /1: [/0 - /0]
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1-4)

# Q7
opt
SELECT ct_amt, ct_dts, ct_name
  FROM cash_transaction
 WHERE ct_t_id = 0
----
project
 ├── columns: ct_amt:3!null ct_dts:2!null ct_name:4
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(2-4)
 └── scan cash_transaction
      ├── columns: ct_t_id:1!null ct_dts:2!null ct_amt:3!null ct_name:4
      ├── constraint: /1: [/0 - /0]
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1-4)

# Q8
opt
  SELECT t_id,
         t_ca_id,
         t_exec_name,
         t_is_cash,
         t_trade_price::FLOAT8,
         t_qty,
         t_dts,
         t_tt_id
    FROM trade
   WHERE t_s_symb = 'SYMB' AND
         t_dts >= '2020-06-15 22:27:42.148484+00:00'::TIMESTAMP AND
         t_dts <= '2020-06-17 22:27:42.148484+00:00'::TIMESTAMP
ORDER BY t_dts ASC
   LIMIT 20
----
project
 ├── columns: t_id:1!null t_ca_id:9!null t_exec_name:10!null t_is_cash:5!null t_trade_price:17 t_qty:7!null t_dts:2!null t_tt_id:4!null
 ├── cardinality: [0 - 20]
 ├── immutable
 ├── key: (1)
 ├── fd: (1)-->(2,4,5,7,9,10,17)
 ├── ordering: +2
 ├── scan trade@secondary
 │    ├── columns: t_id:1!null t_dts:2!null t_tt_id:4!null t_is_cash:5!null t_s_symb:6!null t_qty:7!null t_ca_id:9!null t_exec_name:10!null trade.t_trade_price:11
 │    ├── constraint: /6/2/1: [/'SYMB'/'2020-06-15 22:27:42.148484' - /'SYMB'/'2020-06-17 22:27:42.148484']
 │    ├── limit: 20
 │    ├── key: (1)
 │    ├── fd: ()-->(6), (1)-->(2,4,5,7,9-11)
 │    └── ordering: +2 opt(6) [actual: +2]
 └── projections
      └── trade.t_trade_price:11::FLOAT8 [as=t_trade_price:17, outer=(11), immutable]

# Q9
opt
  SELECT t_id
    FROM trade
   WHERE t_ca_id = 0 AND t_dts >= '2020-06-15 22:27:42.148484+00:00'::TIMESTAMP
ORDER BY t_dts ASC
   LIMIT 1
----
project
 ├── columns: t_id:1!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(1)
 └── scan trade@secondary,rev
      ├── columns: t_id:1!null t_dts:2!null t_ca_id:9!null
      ├── constraint: /9/-2/1: [/0 - /0/'2020-06-15 22:27:42.148484']
      ├── limit: 1(rev)
      ├── key: ()
      └── fd: ()-->(1,2,9)

# Q10
#
# TODO:
#   1. Allow limit push-down for semi-joins. Or normalize semi-joins to
#      inner-joins.
#   2. Adding explorer support for norm rules would allow the projects to be
#      merged and the limit to be pushed down.
#
opt
SELECT hh_h_t_id, hh_t_id, hh_before_qty, hh_after_qty
  FROM holding_history
 WHERE hh_h_t_id IN (SELECT hh_h_t_id FROM holding_history WHERE hh_t_id = 0)
 LIMIT 20
----
limit
 ├── columns: hh_h_t_id:1!null hh_t_id:2!null hh_before_qty:3!null hh_after_qty:4!null
 ├── cardinality: [0 - 20]
 ├── key: (1,2)
 ├── fd: (1,2)-->(3,4)
 ├── project
 │    ├── columns: hh_h_t_id:1!null hh_t_id:2!null hh_before_qty:3!null hh_after_qty:4!null
 │    ├── key: (1,2)
 │    ├── fd: (1,2)-->(3,4)
 │    ├── limit hint: 20.00
 │    └── project
 │         ├── columns: hh_h_t_id:1!null hh_t_id:2!null hh_before_qty:3!null hh_after_qty:4!null hh_h_t_id:6!null
 │         ├── key: (2,6)
 │         ├── fd: (1,2)-->(3,4), (1)==(6), (6)==(1)
 │         ├── limit hint: 20.00
 │         └── inner-join (lookup holding_history)
 │              ├── columns: hh_h_t_id:1!null hh_t_id:2!null hh_before_qty:3!null hh_after_qty:4!null hh_h_t_id:6!null hh_t_id:7!null
 │              ├── key columns: [6] = [1]
 │              ├── key: (2,6)
 │              ├── fd: ()-->(7), (1,2)-->(3,4), (1)==(6), (6)==(1)
 │              ├── limit hint: 20.00
 │              ├── select
 │              │    ├── columns: hh_h_t_id:6!null hh_t_id:7!null
 │              │    ├── key: (6)
 │              │    ├── fd: ()-->(7)
 │              │    ├── scan holding_history
 │              │    │    ├── columns: hh_h_t_id:6!null hh_t_id:7!null
 │              │    │    └── key: (6,7)
 │              │    └── filters
 │              │         └── hh_t_id:7 = 0 [outer=(7), constraints=(/7: [/0 - /0]; tight), fd=()-->(7)]
 │              └── filters (true)
 └── 20

# --------------------------------------------------
# T7
# Trade-Order
# Emulates the process of buying or selling a security by a Customer, Broker, or
# authorized third-party. If the person executing the trade order is not the
# account owner, the Transaction will verify that the person has the appropriate
# authorization to perform the trade order. The Transaction allows the person
# trading to execute buys at the current market price, sells at the current
# market price, or limit buys and sells at a requested price. The Transaction
# also provides an estimate of the financial impact of the proposed trade by
# providing profit/loss data, tax implications, and anticipated commission fees.
# This allows the trader to evaluate the desirability of the proposed security
# trade before either submitting or canceling the trade.
# --------------------------------------------------

# Q1
opt
SELECT ca_name, ca_b_id, ca_c_id, ca_tax_st
  FROM customer_account
 WHERE ca_id = 0
----
project
 ├── columns: ca_name:4 ca_b_id:2!null ca_c_id:3!null ca_tax_st:5!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(2-5)
 └── scan customer_account
      ├── columns: ca_id:1!null ca_b_id:2!null ca_c_id:3!null ca_name:4 ca_tax_st:5!null
      ├── constraint: /1: [/0 - /0]
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1-5)

# Q2
opt
SELECT c_f_name, c_l_name, c_tier, c_tax_id
  FROM customer
 WHERE c_id = 0
----
project
 ├── columns: c_f_name:5!null c_l_name:4!null c_tier:8!null c_tax_id:2!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(2,4,5,8)
 └── scan customer
      ├── columns: c_id:1!null c_tax_id:2!null c_l_name:4!null c_f_name:5!null c_tier:8!null
      ├── constraint: /1: [/0 - /0]
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1,2,4,5,8)

# Q3
opt
SELECT b_name FROM broker WHERE b_id = 0
----
project
 ├── columns: b_name:3!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(3)
 └── scan broker
      ├── columns: b_id:1!null b_name:3!null
      ├── constraint: /1: [/0 - /0]
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1,3)

# Q4
opt
SELECT ap_acl
  FROM account_permission
 WHERE ap_ca_id = 0
   AND ap_f_name = 'first'
   AND ap_l_name = 'name'
   AND ap_tax_id = ''
----
project
 ├── columns: ap_acl:2!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(2)
 └── select
      ├── columns: ap_ca_id:1!null ap_acl:2!null ap_tax_id:3!null ap_l_name:4!null ap_f_name:5!null
      ├── cardinality: [0 - 1]
      ├── key: ()
      ├── fd: ()-->(1-5)
      ├── scan account_permission
      │    ├── columns: ap_ca_id:1!null ap_acl:2!null ap_tax_id:3!null ap_l_name:4!null ap_f_name:5!null
      │    ├── constraint: /1/3: [/0/'' - /0/'']
      │    ├── cardinality: [0 - 1]
      │    ├── key: ()
      │    └── fd: ()-->(1-5)
      └── filters
           ├── ap_f_name:5 = 'first' [outer=(5), constraints=(/5: [/'first' - /'first']; tight), fd=()-->(5)]
           └── ap_l_name:4 = 'name' [outer=(4), constraints=(/4: [/'name' - /'name']; tight), fd=()-->(4)]

# Q5
opt
SELECT co_id FROM company WHERE co_name = 'company'
----
project
 ├── columns: co_id:1!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(1)
 └── scan company@secondary
      ├── columns: co_id:1!null co_name:3!null
      ├── constraint: /3: [/'company' - /'company']
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1,3)

# Q6
opt
SELECT s_ex_id, s_name, s_symb
  FROM security
 WHERE s_co_id = 0 AND s_issue = 'COMMON'
----
project
 ├── columns: s_ex_id:5!null s_name:4!null s_symb:1!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(1,4,5)
 └── scan security@secondary
      ├── columns: s_symb:1!null s_issue:2!null s_name:4!null s_ex_id:5!null s_co_id:6!null
      ├── constraint: /6/2: [/0/'COMMON' - /0/'COMMON']
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1,2,4-6)

# Q7
opt
SELECT s_co_id, s_ex_id, s_name FROM security WHERE s_symb = 'SYMB'
----
project
 ├── columns: s_co_id:6!null s_ex_id:5!null s_name:4!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(4-6)
 └── scan security
      ├── columns: s_symb:1!null s_name:4!null s_ex_id:5!null s_co_id:6!null
      ├── constraint: /1: [/'SYMB' - /'SYMB']
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1,4-6)

# Q8
opt
SELECT co_name FROM company WHERE co_id = 0
----
project
 ├── columns: co_name:3!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(3)
 └── scan company
      ├── columns: co_id:1!null co_name:3!null
      ├── constraint: /1: [/0 - /0]
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1,3)

# Q9
opt
SELECT lt_price::FLOAT8 FROM last_trade WHERE lt_s_symb = 'SYMB'
----
project
 ├── columns: lt_price:7!null
 ├── cardinality: [0 - 1]
 ├── immutable
 ├── key: ()
 ├── fd: ()-->(7)
 ├── scan last_trade
 │    ├── columns: lt_s_symb:1!null last_trade.lt_price:3!null
 │    ├── constraint: /1: [/'SYMB' - /'SYMB']
 │    ├── cardinality: [0 - 1]
 │    ├── key: ()
 │    └── fd: ()-->(1,3)
 └── projections
      └── last_trade.lt_price:3::FLOAT8 [as=lt_price:7, outer=(3), immutable]

# Q10
opt
SELECT tt_is_mrkt, tt_is_sell
  FROM trade_type
 WHERE tt_id = 'TMB'
----
project
 ├── columns: tt_is_mrkt:4!null tt_is_sell:3!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(3,4)
 └── scan trade_type
      ├── columns: tt_id:1!null tt_is_sell:3!null tt_is_mrkt:4!null
      ├── constraint: /1: [/'TMB' - /'TMB']
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1,3,4)

# Q11
opt
SELECT hs_qty
  FROM holding_summary
 WHERE hs_ca_id = 0 AND hs_s_symb = 'SYMB'
----
project
 ├── columns: hs_qty:3!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(3)
 └── scan holding_summary
      ├── columns: hs_ca_id:1!null hs_s_symb:2!null hs_qty:3!null
      ├── constraint: /1/2: [/0/'SYMB' - /0/'SYMB']
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1-3)

# Q12
opt
  SELECT h_qty, h_price::FLOAT8
    FROM holding
   WHERE h_ca_id = 0 AND h_s_symb = 'SYMB'
ORDER BY h_dts DESC
----
project
 ├── columns: h_qty:6!null h_price:8!null  [hidden: h_dts:4!null]
 ├── immutable
 ├── ordering: -4
 ├── scan holding@secondary,rev
 │    ├── columns: h_ca_id:2!null h_s_symb:3!null h_dts:4!null holding.h_price:5!null h_qty:6!null
 │    ├── constraint: /2/3/4/1: [/0/'SYMB' - /0/'SYMB']
 │    ├── fd: ()-->(2,3)
 │    └── ordering: -4 opt(2,3) [actual: -4]
 └── projections
      └── holding.h_price:5::FLOAT8 [as=h_price:8, outer=(5), immutable]

# Q13
opt
  SELECT h_qty, h_price::FLOAT8
    FROM holding
   WHERE h_ca_id = 0 AND h_s_symb = 'SYMB'
ORDER BY h_dts ASC
----
project
 ├── columns: h_qty:6!null h_price:8!null  [hidden: h_dts:4!null]
 ├── immutable
 ├── ordering: +4
 ├── scan holding@secondary
 │    ├── columns: h_ca_id:2!null h_s_symb:3!null h_dts:4!null holding.h_price:5!null h_qty:6!null
 │    ├── constraint: /2/3/4/1: [/0/'SYMB' - /0/'SYMB']
 │    ├── fd: ()-->(2,3)
 │    └── ordering: +4 opt(2,3) [actual: +4]
 └── projections
      └── holding.h_price:5::FLOAT8 [as=h_price:8, outer=(5), immutable]

# Q14
opt
SELECT sum(tx_rate)::FLOAT8
  FROM taxrate
 WHERE tx_id IN (SELECT cx_tx_id FROM customer_taxrate WHERE cx_c_id = 0)
----
project
 ├── columns: sum:9
 ├── cardinality: [1 - 1]
 ├── immutable
 ├── key: ()
 ├── fd: ()-->(9)
 ├── scalar-group-by
 │    ├── columns: sum:8
 │    ├── cardinality: [1 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(8)
 │    ├── semi-join (lookup customer_taxrate)
 │    │    ├── columns: tx_id:1!null tx_rate:3!null
 │    │    ├── key columns: [1 10] = [5 6]
 │    │    ├── lookup columns are key
 │    │    ├── key: (1)
 │    │    ├── fd: (1)-->(3)
 │    │    ├── project
 │    │    │    ├── columns: "lookup_join_const_col_@6":10!null tx_id:1!null tx_rate:3!null
 │    │    │    ├── key: (1)
 │    │    │    ├── fd: ()-->(10), (1)-->(3)
 │    │    │    ├── scan taxrate
 │    │    │    │    ├── columns: tx_id:1!null tx_rate:3!null
 │    │    │    │    ├── check constraint expressions
 │    │    │    │    │    └── tx_rate:3 >= 0 [outer=(3), immutable, constraints=(/3: [/0 - ]; tight)]
 │    │    │    │    ├── key: (1)
 │    │    │    │    └── fd: (1)-->(3)
 │    │    │    └── projections
 │    │    │         └── 0 [as="lookup_join_const_col_@6":10]
 │    │    └── filters (true)
 │    └── aggregations
 │         └── sum [as=sum:8, outer=(3)]
 │              └── tx_rate:3
 └── projections
      └── sum:8::FLOAT8 [as=sum:9, outer=(8), immutable]

# Q15
opt
SELECT cr_rate::FLOAT8
  FROM commission_rate
 WHERE cr_c_tier = 1
   AND cr_tt_id = 'TMB'
   AND cr_ex_id = 'NYSE'
   AND cr_from_qty <= 10
   AND cr_to_qty >= 10
----
project
 ├── columns: cr_rate:8!null
 ├── immutable
 ├── select
 │    ├── columns: cr_c_tier:1!null cr_tt_id:2!null cr_ex_id:3!null cr_from_qty:4!null cr_to_qty:5!null commission_rate.cr_rate:6!null
 │    ├── key: (4)
 │    ├── fd: ()-->(1-3), (4)-->(5,6)
 │    ├── scan commission_rate
 │    │    ├── columns: cr_c_tier:1!null cr_tt_id:2!null cr_ex_id:3!null cr_from_qty:4!null cr_to_qty:5!null commission_rate.cr_rate:6!null
 │    │    ├── constraint: /1/2/3/4: [/1/'TMB'/'NYSE'/0 - /1/'TMB'/'NYSE'/10]
 │    │    ├── cardinality: [0 - 11]
 │    │    ├── key: (4)
 │    │    └── fd: ()-->(1-3), (4)-->(5,6)
 │    └── filters
 │         └── cr_to_qty:5 >= 10 [outer=(5), constraints=(/5: [/10 - ]; tight)]
 └── projections
      └── commission_rate.cr_rate:6::FLOAT8 [as=cr_rate:8, outer=(6), immutable]

# Q16
opt
SELECT ch_chrg::FLOAT8
  FROM charge
 WHERE ch_c_tier = 1 AND ch_tt_id = 'TMB'
----
project
 ├── columns: ch_chrg:5!null
 ├── cardinality: [0 - 1]
 ├── immutable
 ├── key: ()
 ├── fd: ()-->(5)
 ├── scan charge
 │    ├── columns: ch_tt_id:1!null ch_c_tier:2!null charge.ch_chrg:3!null
 │    ├── constraint: /1/2: [/'TMB'/1 - /'TMB'/1]
 │    ├── cardinality: [0 - 1]
 │    ├── key: ()
 │    └── fd: ()-->(1-3)
 └── projections
      └── charge.ch_chrg:3::FLOAT8 [as=ch_chrg:5, outer=(3), immutable]

# Q17
opt
SELECT ca_bal::FLOAT8 FROM customer_account WHERE ca_id = 0
----
project
 ├── columns: ca_bal:8!null
 ├── cardinality: [0 - 1]
 ├── immutable
 ├── key: ()
 ├── fd: ()-->(8)
 ├── scan customer_account
 │    ├── columns: ca_id:1!null customer_account.ca_bal:6!null
 │    ├── constraint: /1: [/0 - /0]
 │    ├── cardinality: [0 - 1]
 │    ├── key: ()
 │    └── fd: ()-->(1,6)
 └── projections
      └── customer_account.ca_bal:6::FLOAT8 [as=ca_bal:8, outer=(6), immutable]

# Q18
opt
SELECT sum(hs_qty * lt_price)::FLOAT8
  FROM holding_summary, last_trade
 WHERE hs_ca_id = 0 AND lt_s_symb = hs_s_symb
----
project
 ├── columns: sum:13
 ├── cardinality: [1 - 1]
 ├── immutable
 ├── key: ()
 ├── fd: ()-->(13)
 ├── scalar-group-by
 │    ├── columns: sum:12
 │    ├── cardinality: [1 - 1]
 │    ├── immutable
 │    ├── key: ()
 │    ├── fd: ()-->(12)
 │    ├── project
 │    │    ├── columns: column11:11!null
 │    │    ├── immutable
 │    │    ├── inner-join (lookup last_trade)
 │    │    │    ├── columns: hs_ca_id:1!null hs_s_symb:2!null hs_qty:3!null lt_s_symb:5!null lt_price:7!null
 │    │    │    ├── key columns: [2] = [5]
 │    │    │    ├── lookup columns are key
 │    │    │    ├── key: (5)
 │    │    │    ├── fd: ()-->(1), (2)-->(3), (5)-->(7), (2)==(5), (5)==(2)
 │    │    │    ├── scan holding_summary
 │    │    │    │    ├── columns: hs_ca_id:1!null hs_s_symb:2!null hs_qty:3!null
 │    │    │    │    ├── constraint: /1/2: [/0 - /0]
 │    │    │    │    ├── key: (2)
 │    │    │    │    └── fd: ()-->(1), (2)-->(3)
 │    │    │    └── filters (true)
 │    │    └── projections
 │    │         └── hs_qty:3::INT8 * lt_price:7::DECIMAL [as=column11:11, outer=(3,7), immutable]
 │    └── aggregations
 │         └── sum [as=sum:12, outer=(11)]
 │              └── column11:11
 └── projections
      └── sum:12::FLOAT8 [as=sum:13, outer=(12), immutable]

# Q19
opt
INSERT
INTO trade (
              t_id,
              t_dts,
              t_st_id,
              t_tt_id,
              t_is_cash,
              t_s_symb,
              t_qty,
              t_bid_price,
              t_ca_id,
              t_exec_name,
              t_trade_price,
              t_chrg,
              t_comm,
              t_tax,
              t_lifo
           )
VALUES (
          0,
          '2020-06-17 22:27:42.148484+00:00'::TIMESTAMP,
          'SBMT',
          'TMB',
          True,
          'SYMB',
          10,
          '100.00':::FLOAT8::DECIMAL,
          0,
          'Name',
          NULL,
          '1.00':::FLOAT8::DECIMAL,
          '0.00':::FLOAT8::DECIMAL,
          0,
          True
       )
----
insert trade
 ├── columns: <none>
 ├── insert-mapping:
 │    ├── column1:17 => t_id:1
 │    ├── column2:18 => t_dts:2
 │    ├── column3:19 => trade.t_st_id:3
 │    ├── column4:20 => trade.t_tt_id:4
 │    ├── column5:21 => t_is_cash:5
 │    ├── column6:22 => trade.t_s_symb:6
 │    ├── column7:23 => t_qty:7
 │    ├── t_bid_price:32 => trade.t_bid_price:8
 │    ├── column9:25 => trade.t_ca_id:9
 │    ├── column10:26 => t_exec_name:10
 │    ├── t_trade_price:33 => trade.t_trade_price:11
 │    ├── t_chrg:34 => trade.t_chrg:12
 │    ├── t_comm:35 => trade.t_comm:13
 │    ├── t_tax:36 => trade.t_tax:14
 │    └── column15:31 => t_lifo:15
 ├── check columns: check1:37 check2:38 check3:39 check4:40 check5:41
 ├── input binding: &1
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 ├── values
 │    ├── columns: column1:17!null column2:18!null column3:19!null column4:20!null column5:21!null column6:22!null column7:23!null column9:25!null column10:26!null column15:31!null t_bid_price:32!null t_trade_price:33 t_chrg:34!null t_comm:35!null t_tax:36!null check1:37!null check2:38!null check3:39!null check4:40!null check5:41!null
 │    ├── cardinality: [1 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(17-23,25,26,31-41)
 │    └── (0, '2020-06-17 22:27:42.148484', 'SBMT', 'TMB', true, 'SYMB', 10, 0, 'Name', true, 1E+2, NULL, 1, 0, 0, true, true, true, true, true)
 └── f-k-checks
      ├── f-k-checks-item: trade(t_st_id) -> status_type(st_id)
      │    └── anti-join (lookup status_type)
      │         ├── columns: t_st_id:42!null
      │         ├── key columns: [42] = [43]
      │         ├── lookup columns are key
      │         ├── cardinality: [0 - 1]
      │         ├── key: ()
      │         ├── fd: ()-->(42)
      │         ├── with-scan &1
      │         │    ├── columns: t_st_id:42!null
      │         │    ├── mapping:
      │         │    │    └──  column3:19 => t_st_id:42
      │         │    ├── cardinality: [1 - 1]
      │         │    ├── key: ()
      │         │    └── fd: ()-->(42)
      │         └── filters (true)
      ├── f-k-checks-item: trade(t_tt_id) -> trade_type(tt_id)
      │    └── anti-join (lookup trade_type)
      │         ├── columns: t_tt_id:46!null
      │         ├── key columns: [46] = [47]
      │         ├── lookup columns are key
      │         ├── cardinality: [0 - 1]
      │         ├── key: ()
      │         ├── fd: ()-->(46)
      │         ├── with-scan &1
      │         │    ├── columns: t_tt_id:46!null
      │         │    ├── mapping:
      │         │    │    └──  column4:20 => t_tt_id:46
      │         │    ├── cardinality: [1 - 1]
      │         │    ├── key: ()
      │         │    └── fd: ()-->(46)
      │         └── filters (true)
      ├── f-k-checks-item: trade(t_s_symb) -> security(s_symb)
      │    └── anti-join (lookup security)
      │         ├── columns: t_s_symb:52!null
      │         ├── key columns: [52] = [53]
      │         ├── lookup columns are key
      │         ├── cardinality: [0 - 1]
      │         ├── key: ()
      │         ├── fd: ()-->(52)
      │         ├── with-scan &1
      │         │    ├── columns: t_s_symb:52!null
      │         │    ├── mapping:
      │         │    │    └──  column6:22 => t_s_symb:52
      │         │    ├── cardinality: [1 - 1]
      │         │    ├── key: ()
      │         │    └── fd: ()-->(52)
      │         └── filters (true)
      └── f-k-checks-item: trade(t_ca_id) -> customer_account(ca_id)
           └── anti-join (lookup customer_account)
                ├── columns: t_ca_id:70!null
                ├── key columns: [70] = [71]
                ├── lookup columns are key
                ├── cardinality: [0 - 1]
                ├── key: ()
                ├── fd: ()-->(70)
                ├── with-scan &1
                │    ├── columns: t_ca_id:70!null
                │    ├── mapping:
                │    │    └──  column9:25 => t_ca_id:70
                │    ├── cardinality: [1 - 1]
                │    ├── key: ()
                │    └── fd: ()-->(70)
                └── filters (true)

# Q20
opt
INSERT INTO trade_request (tr_t_id, tr_tt_id, tr_s_symb, tr_qty, tr_bid_price, tr_b_id)
VALUES (0, 'TMB', 'SYMB', 10, '100.00':::FLOAT8::DECIMAL, 0)
----
insert trade_request
 ├── columns: <none>
 ├── insert-mapping:
 │    ├── column1:8 => trade_request.tr_t_id:1
 │    ├── column2:9 => trade_request.tr_tt_id:2
 │    ├── column3:10 => trade_request.tr_s_symb:3
 │    ├── column4:11 => tr_qty:4
 │    ├── tr_bid_price:14 => trade_request.tr_bid_price:5
 │    └── column6:13 => trade_request.tr_b_id:6
 ├── check columns: check1:15 check2:16
 ├── input binding: &1
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 ├── values
 │    ├── columns: column1:8!null column2:9!null column3:10!null column4:11!null column6:13!null tr_bid_price:14!null check1:15!null check2:16!null
 │    ├── cardinality: [1 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(8-11,13-16)
 │    └── (0, 'TMB', 'SYMB', 10, 0, 1E+2, true, true)
 └── f-k-checks
      ├── f-k-checks-item: trade_request(tr_t_id) -> trade(t_id)
      │    └── anti-join (lookup trade)
      │         ├── columns: tr_t_id:17!null
      │         ├── key columns: [17] = [18]
      │         ├── lookup columns are key
      │         ├── cardinality: [0 - 1]
      │         ├── key: ()
      │         ├── fd: ()-->(17)
      │         ├── with-scan &1
      │         │    ├── columns: tr_t_id:17!null
      │         │    ├── mapping:
      │         │    │    └──  column1:8 => tr_t_id:17
      │         │    ├── cardinality: [1 - 1]
      │         │    ├── key: ()
      │         │    └── fd: ()-->(17)
      │         └── filters (true)
      ├── f-k-checks-item: trade_request(tr_tt_id) -> trade_type(tt_id)
      │    └── anti-join (lookup trade_type)
      │         ├── columns: tr_tt_id:34!null
      │         ├── key columns: [34] = [35]
      │         ├── lookup columns are key
      │         ├── cardinality: [0 - 1]
      │         ├── key: ()
      │         ├── fd: ()-->(34)
      │         ├── with-scan &1
      │         │    ├── columns: tr_tt_id:34!null
      │         │    ├── mapping:
      │         │    │    └──  column2:9 => tr_tt_id:34
      │         │    ├── cardinality: [1 - 1]
      │         │    ├── key: ()
      │         │    └── fd: ()-->(34)
      │         └── filters (true)
      ├── f-k-checks-item: trade_request(tr_s_symb) -> security(s_symb)
      │    └── anti-join (lookup security)
      │         ├── columns: tr_s_symb:40!null
      │         ├── key columns: [40] = [41]
      │         ├── lookup columns are key
      │         ├── cardinality: [0 - 1]
      │         ├── key: ()
      │         ├── fd: ()-->(40)
      │         ├── with-scan &1
      │         │    ├── columns: tr_s_symb:40!null
      │         │    ├── mapping:
      │         │    │    └──  column3:10 => tr_s_symb:40
      │         │    ├── cardinality: [1 - 1]
      │         │    ├── key: ()
      │         │    └── fd: ()-->(40)
      │         └── filters (true)
      └── f-k-checks-item: trade_request(tr_b_id) -> broker(b_id)
           └── anti-join (lookup broker)
                ├── columns: tr_b_id:58!null
                ├── key columns: [58] = [59]
                ├── lookup columns are key
                ├── cardinality: [0 - 1]
                ├── key: ()
                ├── fd: ()-->(58)
                ├── with-scan &1
                │    ├── columns: tr_b_id:58!null
                │    ├── mapping:
                │    │    └──  column6:13 => tr_b_id:58
                │    ├── cardinality: [1 - 1]
                │    ├── key: ()
                │    └── fd: ()-->(58)
                └── filters (true)

# Q21
opt
INSERT INTO trade_history (th_t_id, th_dts, th_st_id)
VALUES (0, '2020-06-15 22:27:42.148484+00:00'::TIMESTAMP, 'SBMT')
----
insert trade_history
 ├── columns: <none>
 ├── insert-mapping:
 │    ├── column1:5 => trade_history.th_t_id:1
 │    ├── column2:6 => th_dts:2
 │    └── column3:7 => trade_history.th_st_id:3
 ├── input binding: &1
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 ├── values
 │    ├── columns: column1:5!null column2:6!null column3:7!null
 │    ├── cardinality: [1 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(5-7)
 │    └── (0, '2020-06-15 22:27:42.148484', 'SBMT')
 └── f-k-checks
      ├── f-k-checks-item: trade_history(th_t_id) -> trade(t_id)
      │    └── anti-join (lookup trade)
      │         ├── columns: th_t_id:8!null
      │         ├── key columns: [8] = [9]
      │         ├── lookup columns are key
      │         ├── cardinality: [0 - 1]
      │         ├── key: ()
      │         ├── fd: ()-->(8)
      │         ├── with-scan &1
      │         │    ├── columns: th_t_id:8!null
      │         │    ├── mapping:
      │         │    │    └──  column1:5 => th_t_id:8
      │         │    ├── cardinality: [1 - 1]
      │         │    ├── key: ()
      │         │    └── fd: ()-->(8)
      │         └── filters (true)
      └── f-k-checks-item: trade_history(th_st_id) -> status_type(st_id)
           └── anti-join (lookup status_type)
                ├── columns: th_st_id:25!null
                ├── key columns: [25] = [26]
                ├── lookup columns are key
                ├── cardinality: [0 - 1]
                ├── key: ()
                ├── fd: ()-->(25)
                ├── with-scan &1
                │    ├── columns: th_st_id:25!null
                │    ├── mapping:
                │    │    └──  column3:7 => th_st_id:25
                │    ├── cardinality: [1 - 1]
                │    ├── key: ()
                │    └── fd: ()-->(25)
                └── filters (true)

# --------------------------------------------------
# T8
# Trade-Result
# Emulates the process of completing a stock market trade. This is
# representative of a brokerage house receiving from the market exchange the
# final confirmation and price for the trade. The customer’s holdings are
# updated to reflect that the trade has completed. Estimates generated when the
# trade was ordered for the broker commission and other similar quantities are
# replaced with the actual numbers and historical information about the trade is
# recorded for later reference.
# --------------------------------------------------

# Q1
opt
SELECT t_ca_id, t_tt_id, t_s_symb, t_qty, t_chrg::FLOAT8, t_lifo, t_is_cash
  FROM trade
 WHERE t_id = 0
----
project
 ├── columns: t_ca_id:9!null t_tt_id:4!null t_s_symb:6!null t_qty:7!null t_chrg:17!null t_lifo:15!null t_is_cash:5!null
 ├── cardinality: [0 - 1]
 ├── immutable
 ├── key: ()
 ├── fd: ()-->(4-7,9,15,17)
 ├── scan trade
 │    ├── columns: t_id:1!null t_tt_id:4!null t_is_cash:5!null t_s_symb:6!null t_qty:7!null t_ca_id:9!null trade.t_chrg:12!null t_lifo:15!null
 │    ├── constraint: /1: [/0 - /0]
 │    ├── cardinality: [0 - 1]
 │    ├── key: ()
 │    └── fd: ()-->(1,4-7,9,12,15)
 └── projections
      └── trade.t_chrg:12::FLOAT8 [as=t_chrg:17, outer=(12), immutable]

# Q2
opt
SELECT tt_name, tt_is_sell, tt_is_mrkt
  FROM trade_type
 WHERE tt_id = 'TMB'
----
project
 ├── columns: tt_name:2!null tt_is_sell:3!null tt_is_mrkt:4!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(2-4)
 └── scan trade_type
      ├── columns: tt_id:1!null tt_name:2!null tt_is_sell:3!null tt_is_mrkt:4!null
      ├── constraint: /1: [/'TMB' - /'TMB']
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1-4)

# Q3
opt
SELECT hs_qty
  FROM holding_summary
 WHERE hs_ca_id = 0 AND hs_s_symb = 'SYMB'
----
project
 ├── columns: hs_qty:3!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(3)
 └── scan holding_summary
      ├── columns: hs_ca_id:1!null hs_s_symb:2!null hs_qty:3!null
      ├── constraint: /1/2: [/0/'SYMB' - /0/'SYMB']
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1-3)

# Q4
opt
SELECT ca_b_id, ca_c_id, ca_tax_st FROM customer_account WHERE ca_id = 0
----
project
 ├── columns: ca_b_id:2!null ca_c_id:3!null ca_tax_st:5!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(2,3,5)
 └── scan customer_account
      ├── columns: ca_id:1!null ca_b_id:2!null ca_c_id:3!null ca_tax_st:5!null
      ├── constraint: /1: [/0 - /0]
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1-3,5)

# Q5
opt
INSERT INTO holding_summary (hs_ca_id, hs_s_symb, hs_qty) VALUES (0, 'SYMB', 10)
----
insert holding_summary
 ├── columns: <none>
 ├── insert-mapping:
 │    ├── column1:5 => holding_summary.hs_ca_id:1
 │    ├── column2:6 => holding_summary.hs_s_symb:2
 │    └── column3:7 => hs_qty:3
 ├── input binding: &1
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 ├── values
 │    ├── columns: column1:5!null column2:6!null column3:7!null
 │    ├── cardinality: [1 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(5-7)
 │    └── (0, 'SYMB', 10)
 └── f-k-checks
      ├── f-k-checks-item: holding_summary(hs_ca_id) -> customer_account(ca_id)
      │    └── anti-join (lookup customer_account)
      │         ├── columns: hs_ca_id:8!null
      │         ├── key columns: [8] = [9]
      │         ├── lookup columns are key
      │         ├── cardinality: [0 - 1]
      │         ├── key: ()
      │         ├── fd: ()-->(8)
      │         ├── with-scan &1
      │         │    ├── columns: hs_ca_id:8!null
      │         │    ├── mapping:
      │         │    │    └──  column1:5 => hs_ca_id:8
      │         │    ├── cardinality: [1 - 1]
      │         │    ├── key: ()
      │         │    └── fd: ()-->(8)
      │         └── filters (true)
      └── f-k-checks-item: holding_summary(hs_s_symb) -> security(s_symb)
           └── anti-join (lookup security)
                ├── columns: hs_s_symb:16!null
                ├── key columns: [16] = [17]
                ├── lookup columns are key
                ├── cardinality: [0 - 1]
                ├── key: ()
                ├── fd: ()-->(16)
                ├── with-scan &1
                │    ├── columns: hs_s_symb:16!null
                │    ├── mapping:
                │    │    └──  column2:6 => hs_s_symb:16
                │    ├── cardinality: [1 - 1]
                │    ├── key: ()
                │    └── fd: ()-->(16)
                └── filters (true)

# Q6
opt
UPDATE holding_summary
   SET hs_qty = hs_qty + 10
 WHERE hs_ca_id = 0 AND hs_s_symb = 'SYMB'
----
update holding_summary
 ├── columns: <none>
 ├── fetch columns: hs_ca_id:5 hs_s_symb:6 hs_qty:7
 ├── update-mapping:
 │    └── hs_qty_new:9 => hs_qty:3
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── project
      ├── columns: hs_qty_new:9!null hs_ca_id:5!null hs_s_symb:6!null hs_qty:7!null
      ├── cardinality: [0 - 1]
      ├── immutable
      ├── key: ()
      ├── fd: ()-->(5-7,9)
      ├── scan holding_summary
      │    ├── columns: hs_ca_id:5!null hs_s_symb:6!null hs_qty:7!null
      │    ├── constraint: /5/6: [/0/'SYMB' - /0/'SYMB']
      │    ├── cardinality: [0 - 1]
      │    ├── key: ()
      │    └── fd: ()-->(5-7)
      └── projections
           └── hs_qty:7::INT8 + 10 [as=hs_qty_new:9, outer=(7), immutable]

# Q7
opt
  SELECT h_t_id, h_qty, h_price::FLOAT8
    FROM holding
   WHERE h_ca_id = 0 AND h_s_symb = 'SYMB'
ORDER BY h_dts DESC
----
project
 ├── columns: h_t_id:1!null h_qty:6!null h_price:8!null  [hidden: h_dts:4!null]
 ├── immutable
 ├── key: (1)
 ├── fd: (1)-->(4,6,8)
 ├── ordering: -4
 ├── scan holding@secondary,rev
 │    ├── columns: h_t_id:1!null h_ca_id:2!null h_s_symb:3!null h_dts:4!null holding.h_price:5!null h_qty:6!null
 │    ├── constraint: /2/3/4/1: [/0/'SYMB' - /0/'SYMB']
 │    ├── key: (1)
 │    ├── fd: ()-->(2,3), (1)-->(4-6)
 │    └── ordering: -4 opt(2,3) [actual: -4]
 └── projections
      └── holding.h_price:5::FLOAT8 [as=h_price:8, outer=(5), immutable]

# Q8
opt
  SELECT h_t_id, h_qty, h_price::FLOAT8
    FROM holding
   WHERE h_ca_id = 0 AND h_s_symb = 'SYMB'
ORDER BY h_dts ASC
----
project
 ├── columns: h_t_id:1!null h_qty:6!null h_price:8!null  [hidden: h_dts:4!null]
 ├── immutable
 ├── key: (1)
 ├── fd: (1)-->(4,6,8)
 ├── ordering: +4
 ├── scan holding@secondary
 │    ├── columns: h_t_id:1!null h_ca_id:2!null h_s_symb:3!null h_dts:4!null holding.h_price:5!null h_qty:6!null
 │    ├── constraint: /2/3/4/1: [/0/'SYMB' - /0/'SYMB']
 │    ├── key: (1)
 │    ├── fd: ()-->(2,3), (1)-->(4-6)
 │    └── ordering: +4 opt(2,3) [actual: +4]
 └── projections
      └── holding.h_price:5::FLOAT8 [as=h_price:8, outer=(5), immutable]

# Q9
opt
INSERT INTO holding_history (hh_h_t_id, hh_t_id, hh_before_qty, hh_after_qty)
VALUES (0, 0, 0, 10)
----
insert holding_history
 ├── columns: <none>
 ├── insert-mapping:
 │    ├── column1:6 => holding_history.hh_h_t_id:1
 │    ├── column2:7 => holding_history.hh_t_id:2
 │    ├── column3:8 => hh_before_qty:3
 │    └── column4:9 => hh_after_qty:4
 ├── input binding: &1
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 ├── values
 │    ├── columns: column1:6!null column2:7!null column3:8!null column4:9!null
 │    ├── cardinality: [1 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(6-9)
 │    └── (0, 0, 0, 10)
 └── f-k-checks
      ├── f-k-checks-item: holding_history(hh_h_t_id) -> trade(t_id)
      │    └── anti-join (lookup trade)
      │         ├── columns: hh_h_t_id:10!null
      │         ├── key columns: [10] = [11]
      │         ├── lookup columns are key
      │         ├── cardinality: [0 - 1]
      │         ├── key: ()
      │         ├── fd: ()-->(10)
      │         ├── with-scan &1
      │         │    ├── columns: hh_h_t_id:10!null
      │         │    ├── mapping:
      │         │    │    └──  column1:6 => hh_h_t_id:10
      │         │    ├── cardinality: [1 - 1]
      │         │    ├── key: ()
      │         │    └── fd: ()-->(10)
      │         └── filters (true)
      └── f-k-checks-item: holding_history(hh_t_id) -> trade(t_id)
           └── anti-join (lookup trade)
                ├── columns: hh_t_id:27!null
                ├── key columns: [27] = [28]
                ├── lookup columns are key
                ├── cardinality: [0 - 1]
                ├── key: ()
                ├── fd: ()-->(27)
                ├── with-scan &1
                │    ├── columns: hh_t_id:27!null
                │    ├── mapping:
                │    │    └──  column2:7 => hh_t_id:27
                │    ├── cardinality: [1 - 1]
                │    ├── key: ()
                │    └── fd: ()-->(27)
                └── filters (true)

# Q10
opt
UPDATE holding SET h_qty = h_qty + 10 WHERE h_t_id = 0
----
update holding
 ├── columns: <none>
 ├── fetch columns: h_t_id:8 h_ca_id:9 h_s_symb:10 h_dts:11 h_price:12 h_qty:13
 ├── update-mapping:
 │    └── h_qty_new:15 => h_qty:6
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── project
      ├── columns: h_qty_new:15!null h_t_id:8!null h_ca_id:9!null h_s_symb:10!null h_dts:11!null h_price:12!null h_qty:13!null
      ├── cardinality: [0 - 1]
      ├── immutable
      ├── key: ()
      ├── fd: ()-->(8-13,15)
      ├── scan holding
      │    ├── columns: h_t_id:8!null h_ca_id:9!null h_s_symb:10!null h_dts:11!null h_price:12!null h_qty:13!null
      │    ├── constraint: /8: [/0 - /0]
      │    ├── cardinality: [0 - 1]
      │    ├── key: ()
      │    └── fd: ()-->(8-13)
      └── projections
           └── h_qty:13::INT8 + 10 [as=h_qty_new:15, outer=(13), immutable]

# Q11
opt
DELETE FROM holding WHERE h_t_id = 0
----
delete holding
 ├── columns: <none>
 ├── fetch columns: h_t_id:8 h_ca_id:9 h_s_symb:10 h_dts:11
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── scan holding
      ├── columns: h_t_id:8!null h_ca_id:9!null h_s_symb:10!null h_dts:11!null
      ├── constraint: /8: [/0 - /0]
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(8-11)

# Q12
opt
INSERT INTO holding (h_t_id, h_ca_id, h_s_symb, h_dts, h_price, h_qty)
VALUES (
          0,
          0,
          'SYMB',
          '2020-06-17 22:27:42.148484+00:00'::TIMESTAMP,
          '100.00':::FLOAT8::DECIMAL, 10
       )
----
insert holding
 ├── columns: <none>
 ├── insert-mapping:
 │    ├── column1:8 => holding.h_t_id:1
 │    ├── column2:9 => holding.h_ca_id:2
 │    ├── column3:10 => holding.h_s_symb:3
 │    ├── column4:11 => h_dts:4
 │    ├── h_price:14 => holding.h_price:5
 │    └── column6:13 => h_qty:6
 ├── check columns: check1:15
 ├── input binding: &1
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 ├── values
 │    ├── columns: column1:8!null column2:9!null column3:10!null column4:11!null column6:13!null h_price:14!null check1:15!null
 │    ├── cardinality: [1 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(8-11,13-15)
 │    └── (0, 0, 'SYMB', '2020-06-17 22:27:42.148484', 10, 1E+2, true)
 └── f-k-checks
      ├── f-k-checks-item: holding(h_t_id) -> trade(t_id)
      │    └── anti-join (lookup trade)
      │         ├── columns: h_t_id:16!null
      │         ├── key columns: [16] = [17]
      │         ├── lookup columns are key
      │         ├── cardinality: [0 - 1]
      │         ├── key: ()
      │         ├── fd: ()-->(16)
      │         ├── with-scan &1
      │         │    ├── columns: h_t_id:16!null
      │         │    ├── mapping:
      │         │    │    └──  column1:8 => h_t_id:16
      │         │    ├── cardinality: [1 - 1]
      │         │    ├── key: ()
      │         │    └── fd: ()-->(16)
      │         └── filters (true)
      └── f-k-checks-item: holding(h_ca_id,h_s_symb) -> holding_summary(hs_ca_id,hs_s_symb)
           └── anti-join (lookup holding_summary)
                ├── columns: h_ca_id:33!null h_s_symb:34!null
                ├── key columns: [33 34] = [35 36]
                ├── lookup columns are key
                ├── cardinality: [0 - 1]
                ├── key: ()
                ├── fd: ()-->(33,34)
                ├── with-scan &1
                │    ├── columns: h_ca_id:33!null h_s_symb:34!null
                │    ├── mapping:
                │    │    ├──  column2:9 => h_ca_id:33
                │    │    └──  column3:10 => h_s_symb:34
                │    ├── cardinality: [1 - 1]
                │    ├── key: ()
                │    └── fd: ()-->(33,34)
                └── filters (true)

# Q13
opt
DELETE FROM holding_summary WHERE hs_ca_id = 0 AND hs_s_symb = 'SYMB'
----
delete holding_summary
 ├── columns: <none>
 ├── fetch columns: holding_summary.hs_ca_id:5 holding_summary.hs_s_symb:6
 ├── input binding: &1
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 ├── scan holding_summary
 │    ├── columns: holding_summary.hs_ca_id:5!null holding_summary.hs_s_symb:6!null
 │    ├── constraint: /5/6: [/0/'SYMB' - /0/'SYMB']
 │    ├── cardinality: [0 - 1]
 │    ├── key: ()
 │    └── fd: ()-->(5,6)
 └── f-k-checks
      └── f-k-checks-item: holding(h_ca_id,h_s_symb) -> holding_summary(hs_ca_id,hs_s_symb)
           └── semi-join (lookup holding@secondary)
                ├── columns: hs_ca_id:9!null hs_s_symb:10!null
                ├── key columns: [9 10] = [12 13]
                ├── cardinality: [0 - 1]
                ├── key: ()
                ├── fd: ()-->(9,10)
                ├── with-scan &1
                │    ├── columns: hs_ca_id:9!null hs_s_symb:10!null
                │    ├── mapping:
                │    │    ├──  holding_summary.hs_ca_id:5 => hs_ca_id:9
                │    │    └──  holding_summary.hs_s_symb:6 => hs_s_symb:10
                │    ├── cardinality: [0 - 1]
                │    ├── key: ()
                │    └── fd: ()-->(9,10)
                └── filters (true)

# Q14
opt
INSERT INTO holding_summary (hs_ca_id, hs_s_symb, hs_qty)
VALUES (0, 'SYMB', 10)
----
insert holding_summary
 ├── columns: <none>
 ├── insert-mapping:
 │    ├── column1:5 => holding_summary.hs_ca_id:1
 │    ├── column2:6 => holding_summary.hs_s_symb:2
 │    └── column3:7 => hs_qty:3
 ├── input binding: &1
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 ├── values
 │    ├── columns: column1:5!null column2:6!null column3:7!null
 │    ├── cardinality: [1 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(5-7)
 │    └── (0, 'SYMB', 10)
 └── f-k-checks
      ├── f-k-checks-item: holding_summary(hs_ca_id) -> customer_account(ca_id)
      │    └── anti-join (lookup customer_account)
      │         ├── columns: hs_ca_id:8!null
      │         ├── key columns: [8] = [9]
      │         ├── lookup columns are key
      │         ├── cardinality: [0 - 1]
      │         ├── key: ()
      │         ├── fd: ()-->(8)
      │         ├── with-scan &1
      │         │    ├── columns: hs_ca_id:8!null
      │         │    ├── mapping:
      │         │    │    └──  column1:5 => hs_ca_id:8
      │         │    ├── cardinality: [1 - 1]
      │         │    ├── key: ()
      │         │    └── fd: ()-->(8)
      │         └── filters (true)
      └── f-k-checks-item: holding_summary(hs_s_symb) -> security(s_symb)
           └── anti-join (lookup security)
                ├── columns: hs_s_symb:16!null
                ├── key columns: [16] = [17]
                ├── lookup columns are key
                ├── cardinality: [0 - 1]
                ├── key: ()
                ├── fd: ()-->(16)
                ├── with-scan &1
                │    ├── columns: hs_s_symb:16!null
                │    ├── mapping:
                │    │    └──  column2:6 => hs_s_symb:16
                │    ├── cardinality: [1 - 1]
                │    ├── key: ()
                │    └── fd: ()-->(16)
                └── filters (true)


# Q15
opt
UPDATE holding_summary
SET hs_qty = hs_qty + 10
WHERE hs_ca_id = 0 and hs_s_symb = 'SYMB'
----
update holding_summary
 ├── columns: <none>
 ├── fetch columns: hs_ca_id:5 hs_s_symb:6 hs_qty:7
 ├── update-mapping:
 │    └── hs_qty_new:9 => hs_qty:3
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── project
      ├── columns: hs_qty_new:9!null hs_ca_id:5!null hs_s_symb:6!null hs_qty:7!null
      ├── cardinality: [0 - 1]
      ├── immutable
      ├── key: ()
      ├── fd: ()-->(5-7,9)
      ├── scan holding_summary
      │    ├── columns: hs_ca_id:5!null hs_s_symb:6!null hs_qty:7!null
      │    ├── constraint: /5/6: [/0/'SYMB' - /0/'SYMB']
      │    ├── cardinality: [0 - 1]
      │    ├── key: ()
      │    └── fd: ()-->(5-7)
      └── projections
           └── hs_qty:7::INT8 + 10 [as=hs_qty_new:9, outer=(7), immutable]

# Q16
opt
INSERT INTO
HOLDING_HISTORY (hh_h_t_id, hh_t_id, hh_before_qty, hh_after_qty)
VALUES (0, 0, 0, 10)
----
insert holding_history
 ├── columns: <none>
 ├── insert-mapping:
 │    ├── column1:6 => holding_history.hh_h_t_id:1
 │    ├── column2:7 => holding_history.hh_t_id:2
 │    ├── column3:8 => hh_before_qty:3
 │    └── column4:9 => hh_after_qty:4
 ├── input binding: &1
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 ├── values
 │    ├── columns: column1:6!null column2:7!null column3:8!null column4:9!null
 │    ├── cardinality: [1 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(6-9)
 │    └── (0, 0, 0, 10)
 └── f-k-checks
      ├── f-k-checks-item: holding_history(hh_h_t_id) -> trade(t_id)
      │    └── anti-join (lookup trade)
      │         ├── columns: hh_h_t_id:10!null
      │         ├── key columns: [10] = [11]
      │         ├── lookup columns are key
      │         ├── cardinality: [0 - 1]
      │         ├── key: ()
      │         ├── fd: ()-->(10)
      │         ├── with-scan &1
      │         │    ├── columns: hh_h_t_id:10!null
      │         │    ├── mapping:
      │         │    │    └──  column1:6 => hh_h_t_id:10
      │         │    ├── cardinality: [1 - 1]
      │         │    ├── key: ()
      │         │    └── fd: ()-->(10)
      │         └── filters (true)
      └── f-k-checks-item: holding_history(hh_t_id) -> trade(t_id)
           └── anti-join (lookup trade)
                ├── columns: hh_t_id:27!null
                ├── key columns: [27] = [28]
                ├── lookup columns are key
                ├── cardinality: [0 - 1]
                ├── key: ()
                ├── fd: ()-->(27)
                ├── with-scan &1
                │    ├── columns: hh_t_id:27!null
                │    ├── mapping:
                │    │    └──  column2:7 => hh_t_id:27
                │    ├── cardinality: [1 - 1]
                │    ├── key: ()
                │    └── fd: ()-->(27)
                └── filters (true)

# Q17
#
# TODO:
#   1. The projects under the scalar-group-by can be merged and removed.
#
opt
SELECT sum(tx_rate)::FLOAT8
  FROM taxrate
 WHERE tx_id IN (SELECT cx_tx_id FROM customer_taxrate WHERE cx_c_id = 0)
----
project
 ├── columns: sum:9
 ├── cardinality: [1 - 1]
 ├── immutable
 ├── key: ()
 ├── fd: ()-->(9)
 ├── scalar-group-by
 │    ├── columns: sum:8
 │    ├── cardinality: [1 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(8)
 │    ├── semi-join (lookup customer_taxrate)
 │    │    ├── columns: tx_id:1!null tx_rate:3!null
 │    │    ├── key columns: [1 10] = [5 6]
 │    │    ├── lookup columns are key
 │    │    ├── key: (1)
 │    │    ├── fd: (1)-->(3)
 │    │    ├── project
 │    │    │    ├── columns: "lookup_join_const_col_@6":10!null tx_id:1!null tx_rate:3!null
 │    │    │    ├── key: (1)
 │    │    │    ├── fd: ()-->(10), (1)-->(3)
 │    │    │    ├── scan taxrate
 │    │    │    │    ├── columns: tx_id:1!null tx_rate:3!null
 │    │    │    │    ├── check constraint expressions
 │    │    │    │    │    └── tx_rate:3 >= 0 [outer=(3), immutable, constraints=(/3: [/0 - ]; tight)]
 │    │    │    │    ├── key: (1)
 │    │    │    │    └── fd: (1)-->(3)
 │    │    │    └── projections
 │    │    │         └── 0 [as="lookup_join_const_col_@6":10]
 │    │    └── filters (true)
 │    └── aggregations
 │         └── sum [as=sum:8, outer=(3)]
 │              └── tx_rate:3
 └── projections
      └── sum:8::FLOAT8 [as=sum:9, outer=(8), immutable]

# Q18
opt
UPDATE trade SET t_tax = '0.00':::FLOAT8::DECIMAL WHERE t_id = 0
----
update trade
 ├── columns: <none>
 ├── fetch columns: t_id:17 t_dts:18 t_st_id:19 t_tt_id:20 t_is_cash:21 t_s_symb:22 t_qty:23 t_bid_price:24 t_ca_id:25 t_exec_name:26 t_trade_price:27 t_chrg:28 t_comm:29 trade.t_tax:30 t_lifo:31
 ├── update-mapping:
 │    └── t_tax:34 => trade.t_tax:14
 ├── check columns: check5:39
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── project
      ├── columns: check5:39!null t_tax:34!null t_id:17!null t_dts:18!null t_st_id:19!null t_tt_id:20!null t_is_cash:21!null t_s_symb:22!null t_qty:23!null t_bid_price:24 t_ca_id:25!null t_exec_name:26!null t_trade_price:27 t_chrg:28!null t_comm:29!null trade.t_tax:30!null t_lifo:31!null
      ├── cardinality: [0 - 1]
      ├── key: ()
      ├── fd: ()-->(17-31,34,39)
      ├── scan trade
      │    ├── columns: t_id:17!null t_dts:18!null t_st_id:19!null t_tt_id:20!null t_is_cash:21!null t_s_symb:22!null t_qty:23!null t_bid_price:24 t_ca_id:25!null t_exec_name:26!null t_trade_price:27 t_chrg:28!null t_comm:29!null trade.t_tax:30!null t_lifo:31!null
      │    ├── constraint: /17: [/0 - /0]
      │    ├── cardinality: [0 - 1]
      │    ├── key: ()
      │    └── fd: ()-->(17-31)
      └── projections
           ├── true [as=check5:39]
           └── 0 [as=t_tax:34]

# Q19
opt
SELECT s_ex_id, s_name FROM security WHERE s_symb = 'SYMB'
----
project
 ├── columns: s_ex_id:5!null s_name:4!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(4,5)
 └── scan security
      ├── columns: s_symb:1!null s_name:4!null s_ex_id:5!null
      ├── constraint: /1: [/'SYMB' - /'SYMB']
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1,4,5)

# Q20
opt
SELECT c_tier FROM customer WHERE c_id = 0
----
project
 ├── columns: c_tier:8!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(8)
 └── scan customer
      ├── columns: c_id:1!null c_tier:8!null
      ├── constraint: /1: [/0 - /0]
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1,8)

# Q21
opt
SELECT cr_rate::FLOAT8
  FROM commission_rate
 WHERE cr_c_tier = 1
   AND cr_tt_id = 'TMB'
   AND cr_ex_id = 'NYSE'
   AND cr_from_qty <= 20
   AND cr_to_qty >= 10
 LIMIT 1
----
project
 ├── columns: cr_rate:8!null
 ├── cardinality: [0 - 1]
 ├── immutable
 ├── key: ()
 ├── fd: ()-->(8)
 ├── limit
 │    ├── columns: cr_c_tier:1!null cr_tt_id:2!null cr_ex_id:3!null cr_from_qty:4!null cr_to_qty:5!null commission_rate.cr_rate:6!null
 │    ├── cardinality: [0 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(1-6)
 │    ├── select
 │    │    ├── columns: cr_c_tier:1!null cr_tt_id:2!null cr_ex_id:3!null cr_from_qty:4!null cr_to_qty:5!null commission_rate.cr_rate:6!null
 │    │    ├── key: (4)
 │    │    ├── fd: ()-->(1-3), (4)-->(5,6)
 │    │    ├── limit hint: 1.00
 │    │    ├── scan commission_rate
 │    │    │    ├── columns: cr_c_tier:1!null cr_tt_id:2!null cr_ex_id:3!null cr_from_qty:4!null cr_to_qty:5!null commission_rate.cr_rate:6!null
 │    │    │    ├── constraint: /1/2/3/4: [/1/'TMB'/'NYSE'/0 - /1/'TMB'/'NYSE'/20]
 │    │    │    ├── cardinality: [0 - 21]
 │    │    │    ├── key: (4)
 │    │    │    ├── fd: ()-->(1-3), (4)-->(5,6)
 │    │    │    └── limit hint: 4.00
 │    │    └── filters
 │    │         └── cr_to_qty:5 >= 10 [outer=(5), constraints=(/5: [/10 - ]; tight)]
 │    └── 1
 └── projections
      └── commission_rate.cr_rate:6::FLOAT8 [as=cr_rate:8, outer=(6), immutable]

# Q22
opt
UPDATE trade
   SET t_comm = '0.00':::FLOAT8::DECIMAL,
       t_dts = '2020-06-17 22:27:42.148484+00:00'::TIMESTAMP,
       t_st_id = 'SBMT',
       t_trade_price = '100.00':::FLOAT8::DECIMAL
 WHERE t_id = 0
----
update trade
 ├── columns: <none>
 ├── fetch columns: t_id:17 t_dts:18 trade.t_st_id:19 t_tt_id:20 t_is_cash:21 t_s_symb:22 t_qty:23 t_bid_price:24 t_ca_id:25 t_exec_name:26 trade.t_trade_price:27 t_chrg:28 trade.t_comm:29 t_tax:30 t_lifo:31
 ├── update-mapping:
 │    ├── t_dts_new:34 => t_dts:2
 │    ├── t_st_id_new:35 => trade.t_st_id:3
 │    ├── t_trade_price:37 => trade.t_trade_price:11
 │    └── t_comm:38 => trade.t_comm:13
 ├── check columns: check4:42
 ├── input binding: &1
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 ├── project
 │    ├── columns: check4:42!null t_comm:38!null t_trade_price:37!null t_dts_new:34!null t_st_id_new:35!null t_id:17!null t_dts:18!null trade.t_st_id:19!null t_tt_id:20!null t_is_cash:21!null t_s_symb:22!null t_qty:23!null t_bid_price:24 t_ca_id:25!null t_exec_name:26!null trade.t_trade_price:27 t_chrg:28!null trade.t_comm:29!null t_tax:30!null t_lifo:31!null
 │    ├── cardinality: [0 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(17-31,34,35,37,38,42)
 │    ├── scan trade
 │    │    ├── columns: t_id:17!null t_dts:18!null trade.t_st_id:19!null t_tt_id:20!null t_is_cash:21!null t_s_symb:22!null t_qty:23!null t_bid_price:24 t_ca_id:25!null t_exec_name:26!null trade.t_trade_price:27 t_chrg:28!null trade.t_comm:29!null t_tax:30!null t_lifo:31!null
 │    │    ├── constraint: /17: [/0 - /0]
 │    │    ├── cardinality: [0 - 1]
 │    │    ├── key: ()
 │    │    └── fd: ()-->(17-31)
 │    └── projections
 │         ├── true [as=check4:42]
 │         ├── 0 [as=t_comm:38]
 │         ├── 1E+2 [as=t_trade_price:37]
 │         ├── '2020-06-17 22:27:42.148484' [as=t_dts_new:34]
 │         └── 'SBMT' [as=t_st_id_new:35]
 └── f-k-checks
      └── f-k-checks-item: trade(t_st_id) -> status_type(st_id)
           └── anti-join (lookup status_type)
                ├── columns: t_st_id:44!null
                ├── key columns: [44] = [45]
                ├── lookup columns are key
                ├── cardinality: [0 - 1]
                ├── key: ()
                ├── fd: ()-->(44)
                ├── with-scan &1
                │    ├── columns: t_st_id:44!null
                │    ├── mapping:
                │    │    └──  t_st_id_new:35 => t_st_id:44
                │    ├── cardinality: [0 - 1]
                │    ├── key: ()
                │    └── fd: ()-->(44)
                └── filters (true)

# Q23
opt
INSERT INTO trade_history (th_t_id, th_dts, th_st_id)
VALUES (0, '2020-06-17 22:27:42.148484+00:00'::TIMESTAMP, 'SBMT')
----
insert trade_history
 ├── columns: <none>
 ├── insert-mapping:
 │    ├── column1:5 => trade_history.th_t_id:1
 │    ├── column2:6 => th_dts:2
 │    └── column3:7 => trade_history.th_st_id:3
 ├── input binding: &1
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 ├── values
 │    ├── columns: column1:5!null column2:6!null column3:7!null
 │    ├── cardinality: [1 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(5-7)
 │    └── (0, '2020-06-17 22:27:42.148484', 'SBMT')
 └── f-k-checks
      ├── f-k-checks-item: trade_history(th_t_id) -> trade(t_id)
      │    └── anti-join (lookup trade)
      │         ├── columns: th_t_id:8!null
      │         ├── key columns: [8] = [9]
      │         ├── lookup columns are key
      │         ├── cardinality: [0 - 1]
      │         ├── key: ()
      │         ├── fd: ()-->(8)
      │         ├── with-scan &1
      │         │    ├── columns: th_t_id:8!null
      │         │    ├── mapping:
      │         │    │    └──  column1:5 => th_t_id:8
      │         │    ├── cardinality: [1 - 1]
      │         │    ├── key: ()
      │         │    └── fd: ()-->(8)
      │         └── filters (true)
      └── f-k-checks-item: trade_history(th_st_id) -> status_type(st_id)
           └── anti-join (lookup status_type)
                ├── columns: th_st_id:25!null
                ├── key columns: [25] = [26]
                ├── lookup columns are key
                ├── cardinality: [0 - 1]
                ├── key: ()
                ├── fd: ()-->(25)
                ├── with-scan &1
                │    ├── columns: th_st_id:25!null
                │    ├── mapping:
                │    │    └──  column3:7 => th_st_id:25
                │    ├── cardinality: [1 - 1]
                │    ├── key: ()
                │    └── fd: ()-->(25)
                └── filters (true)

# Q24
opt
UPDATE broker
   SET b_comm_total = b_comm_total + '0.00':::FLOAT8::DECIMAL,
       b_num_trades = b_num_trades + 1
 WHERE b_id = 0
----
update broker
 ├── columns: <none>
 ├── fetch columns: b_id:7 b_st_id:8 b_name:9 b_num_trades:10 broker.b_comm_total:11
 ├── update-mapping:
 │    ├── b_num_trades_new:14 => b_num_trades:4
 │    └── b_comm_total:15 => broker.b_comm_total:5
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── project
      ├── columns: b_comm_total:15 b_num_trades_new:14!null b_id:7!null b_st_id:8!null b_name:9!null b_num_trades:10!null broker.b_comm_total:11!null
      ├── cardinality: [0 - 1]
      ├── immutable
      ├── key: ()
      ├── fd: ()-->(7-11,14,15)
      ├── scan broker
      │    ├── columns: b_id:7!null b_st_id:8!null b_name:9!null b_num_trades:10!null broker.b_comm_total:11!null
      │    ├── constraint: /7: [/0 - /0]
      │    ├── cardinality: [0 - 1]
      │    ├── key: ()
      │    └── fd: ()-->(7-11)
      └── projections
           ├── crdb_internal.round_decimal_values(broker.b_comm_total:11::DECIMAL, 2) [as=b_comm_total:15, outer=(11), immutable]
           └── b_num_trades:10 + 1 [as=b_num_trades_new:14, outer=(10), immutable]

# Q25
opt
INSERT INTO settlement (se_t_id, se_cash_type, se_cash_due_date, se_amt)
VALUES (0, 'Cash Account', '2020-06-19'::DATE, '100.00':::FLOAT8::DECIMAL)
----
insert settlement
 ├── columns: <none>
 ├── insert-mapping:
 │    ├── column1:6 => settlement.se_t_id:1
 │    ├── column2:7 => se_cash_type:2
 │    ├── column3:8 => se_cash_due_date:3
 │    └── se_amt:10 => settlement.se_amt:4
 ├── input binding: &1
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 ├── values
 │    ├── columns: column1:6!null column2:7!null column3:8!null se_amt:10!null
 │    ├── cardinality: [1 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(6-8,10)
 │    └── (0, 'Cash Account', '2020-06-19', 1E+2)
 └── f-k-checks
      └── f-k-checks-item: settlement(se_t_id) -> trade(t_id)
           └── anti-join (lookup trade)
                ├── columns: se_t_id:11!null
                ├── key columns: [11] = [12]
                ├── lookup columns are key
                ├── cardinality: [0 - 1]
                ├── key: ()
                ├── fd: ()-->(11)
                ├── with-scan &1
                │    ├── columns: se_t_id:11!null
                │    ├── mapping:
                │    │    └──  column1:6 => se_t_id:11
                │    ├── cardinality: [1 - 1]
                │    ├── key: ()
                │    └── fd: ()-->(11)
                └── filters (true)

# Q26
opt
   UPDATE customer_account
      SET ca_bal = ca_bal + '100.00':::FLOAT8::DECIMAL
    WHERE ca_id = 0
RETURNING ca_bal::FLOAT8
----
project
 ├── columns: ca_bal:18!null
 ├── cardinality: [0 - 1]
 ├── volatile, mutations
 ├── key: ()
 ├── fd: ()-->(18)
 ├── update customer_account
 │    ├── columns: ca_id:1!null customer_account.ca_bal:6!null
 │    ├── fetch columns: ca_id:8 ca_b_id:9 ca_c_id:10 ca_name:11 ca_tax_st:12 customer_account.ca_bal:13
 │    ├── update-mapping:
 │    │    └── ca_bal:16 => customer_account.ca_bal:6
 │    ├── cardinality: [0 - 1]
 │    ├── volatile, mutations
 │    ├── key: ()
 │    ├── fd: ()-->(1,6)
 │    └── project
 │         ├── columns: ca_bal:16 ca_id:8!null ca_b_id:9!null ca_c_id:10!null ca_name:11 ca_tax_st:12!null customer_account.ca_bal:13!null
 │         ├── cardinality: [0 - 1]
 │         ├── immutable
 │         ├── key: ()
 │         ├── fd: ()-->(8-13,16)
 │         ├── scan customer_account
 │         │    ├── columns: ca_id:8!null ca_b_id:9!null ca_c_id:10!null ca_name:11 ca_tax_st:12!null customer_account.ca_bal:13!null
 │         │    ├── constraint: /8: [/0 - /0]
 │         │    ├── cardinality: [0 - 1]
 │         │    ├── key: ()
 │         │    └── fd: ()-->(8-13)
 │         └── projections
 │              └── crdb_internal.round_decimal_values(customer_account.ca_bal:13::DECIMAL + 1E+2, 2) [as=ca_bal:16, outer=(13), immutable]
 └── projections
      └── customer_account.ca_bal:6::FLOAT8 [as=ca_bal:18, outer=(6), immutable]

# Q27
opt
INSERT INTO cash_transaction (ct_t_id, ct_dts, ct_amt, ct_name)
VALUES (
        0,
        '2020-06-18 22:27:42.148484+00:00'::TIMESTAMP,
        '100.00':::FLOAT8::DECIMAL,
        concat_ws(' ', 'Market Buy', 10:::INT4::STRING, 'shares of', 'SYMB')
       )
----
insert cash_transaction
 ├── columns: <none>
 ├── insert-mapping:
 │    ├── column1:6 => cash_transaction.ct_t_id:1
 │    ├── column2:7 => ct_dts:2
 │    ├── ct_amt:10 => cash_transaction.ct_amt:3
 │    └── column4:9 => ct_name:4
 ├── input binding: &1
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 ├── values
 │    ├── columns: column1:6!null column2:7!null column4:9!null ct_amt:10!null
 │    ├── cardinality: [1 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(6,7,9,10)
 │    └── (0, '2020-06-18 22:27:42.148484', 'Market Buy 10 shares of SYMB', 1E+2)
 └── f-k-checks
      └── f-k-checks-item: cash_transaction(ct_t_id) -> trade(t_id)
           └── anti-join (lookup trade)
                ├── columns: ct_t_id:11!null
                ├── key columns: [11] = [12]
                ├── lookup columns are key
                ├── cardinality: [0 - 1]
                ├── key: ()
                ├── fd: ()-->(11)
                ├── with-scan &1
                │    ├── columns: ct_t_id:11!null
                │    ├── mapping:
                │    │    └──  column1:6 => ct_t_id:11
                │    ├── cardinality: [1 - 1]
                │    ├── key: ()
                │    └── fd: ()-->(11)
                └── filters (true)

# Q28
opt
SELECT ca_bal::FLOAT8 FROM customer_account WHERE ca_id = 0
----
project
 ├── columns: ca_bal:8!null
 ├── cardinality: [0 - 1]
 ├── immutable
 ├── key: ()
 ├── fd: ()-->(8)
 ├── scan customer_account
 │    ├── columns: ca_id:1!null customer_account.ca_bal:6!null
 │    ├── constraint: /1: [/0 - /0]
 │    ├── cardinality: [0 - 1]
 │    ├── key: ()
 │    └── fd: ()-->(1,6)
 └── projections
      └── customer_account.ca_bal:6::FLOAT8 [as=ca_bal:8, outer=(6), immutable]

# --------------------------------------------------
# T9
# Trade-Status
# Emulates the process of providing an update on the status of a particular set
# of trades. It is representative of a customer reviewing a summary of the
# recent trading activity for one of their accounts.
# --------------------------------------------------

# Q1 Version 1
opt
  SELECT t_id,
         t_dts,
         st_name,
         tt_name,
         t_s_symb,
         t_qty,
         t_exec_name,
         t_chrg::FLOAT8,
         s_name,
         ex_name
    FROM trade, status_type, trade_type, security, exchange
   WHERE t_ca_id = 0
     AND st_id = t_st_id
     AND tt_id = t_tt_id
     AND s_symb = t_s_symb
     AND ex_id = s_ex_id
ORDER BY t_dts DESC
   LIMIT 50
----
project
 ├── columns: t_id:1!null t_dts:2!null st_name:18!null tt_name:21!null t_s_symb:6!null t_qty:7!null t_exec_name:10!null t_chrg:50!null s_name:28!null ex_name:43!null
 ├── cardinality: [0 - 50]
 ├── immutable
 ├── key: (1)
 ├── fd: (1)-->(2,6,7,10,18,21,28,43,50), (6)-->(28,43)
 ├── ordering: -2
 ├── inner-join (lookup exchange)
 │    ├── columns: t_id:1!null t_dts:2!null t_st_id:3!null t_tt_id:4!null t_s_symb:6!null t_qty:7!null t_ca_id:9!null t_exec_name:10!null trade.t_chrg:12!null st_id:17!null st_name:18!null tt_id:20!null tt_name:21!null s_symb:25!null s_name:28!null s_ex_id:29!null ex_id:42!null ex_name:43!null
 │    ├── key columns: [29] = [42]
 │    ├── lookup columns are key
 │    ├── cardinality: [0 - 50]
 │    ├── key: (1)
 │    ├── fd: ()-->(9), (1)-->(2-4,6,7,10,12), (17)-->(18), (3)==(17), (17)==(3), (20)-->(21), (4)==(20), (20)==(4), (25)-->(28,29), (42)-->(43), (29)==(42), (42)==(29), (6)==(25), (25)==(6)
 │    ├── ordering: -2 opt(9) [actual: -2]
 │    ├── inner-join (lookup security)
 │    │    ├── columns: t_id:1!null t_dts:2!null t_st_id:3!null t_tt_id:4!null t_s_symb:6!null t_qty:7!null t_ca_id:9!null t_exec_name:10!null trade.t_chrg:12!null st_id:17!null st_name:18!null tt_id:20!null tt_name:21!null s_symb:25!null s_name:28!null s_ex_id:29!null
 │    │    ├── key columns: [6] = [25]
 │    │    ├── lookup columns are key
 │    │    ├── cardinality: [0 - 50]
 │    │    ├── key: (1)
 │    │    ├── fd: ()-->(9), (17)-->(18), (20)-->(21), (1)-->(2-4,6,7,10,12), (25)-->(28,29), (6)==(25), (25)==(6), (4)==(20), (20)==(4), (3)==(17), (17)==(3)
 │    │    ├── ordering: -2 opt(9) [actual: -2]
 │    │    ├── inner-join (lookup status_type)
 │    │    │    ├── columns: t_id:1!null t_dts:2!null t_st_id:3!null t_tt_id:4!null t_s_symb:6!null t_qty:7!null t_ca_id:9!null t_exec_name:10!null trade.t_chrg:12!null st_id:17!null st_name:18!null tt_id:20!null tt_name:21!null
 │    │    │    ├── key columns: [3] = [17]
 │    │    │    ├── lookup columns are key
 │    │    │    ├── cardinality: [0 - 50]
 │    │    │    ├── key: (1)
 │    │    │    ├── fd: ()-->(9), (1)-->(2-4,6,7,10,12), (17)-->(18), (3)==(17), (17)==(3), (20)-->(21), (4)==(20), (20)==(4)
 │    │    │    ├── ordering: -2 opt(9) [actual: -2]
 │    │    │    ├── inner-join (lookup trade_type)
 │    │    │    │    ├── columns: t_id:1!null t_dts:2!null t_st_id:3!null t_tt_id:4!null t_s_symb:6!null t_qty:7!null t_ca_id:9!null t_exec_name:10!null trade.t_chrg:12!null tt_id:20!null tt_name:21!null
 │    │    │    │    ├── key columns: [4] = [20]
 │    │    │    │    ├── lookup columns are key
 │    │    │    │    ├── cardinality: [0 - 50]
 │    │    │    │    ├── key: (1)
 │    │    │    │    ├── fd: ()-->(9), (1)-->(2-4,6,7,10,12), (20)-->(21), (4)==(20), (20)==(4)
 │    │    │    │    ├── ordering: -2 opt(9) [actual: -2]
 │    │    │    │    ├── scan trade@secondary
 │    │    │    │    │    ├── columns: t_id:1!null t_dts:2!null t_st_id:3!null t_tt_id:4!null t_s_symb:6!null t_qty:7!null t_ca_id:9!null t_exec_name:10!null trade.t_chrg:12!null
 │    │    │    │    │    ├── constraint: /9/-2/1: [/0 - /0]
 │    │    │    │    │    ├── limit: 50
 │    │    │    │    │    ├── key: (1)
 │    │    │    │    │    ├── fd: ()-->(9), (1)-->(2-4,6,7,10,12)
 │    │    │    │    │    └── ordering: -2 opt(9) [actual: -2]
 │    │    │    │    └── filters (true)
 │    │    │    └── filters (true)
 │    │    └── filters (true)
 │    └── filters (true)
 └── projections
      └── trade.t_chrg:12::FLOAT8 [as=t_chrg:50, outer=(12), immutable]

# Q2
opt
SELECT c_l_name, c_f_name, b_name
  FROM customer_account, customer, broker
 WHERE ca_id = 0 AND c_id = ca_c_id AND b_id = ca_b_id
----
project
 ├── columns: c_l_name:11!null c_f_name:12!null b_name:35!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(11,12,35)
 └── inner-join (lookup broker)
      ├── columns: ca_id:1!null ca_b_id:2!null ca_c_id:3!null c_id:8!null c_l_name:11!null c_f_name:12!null b_id:33!null b_name:35!null
      ├── key columns: [2] = [33]
      ├── lookup columns are key
      ├── cardinality: [0 - 1]
      ├── key: ()
      ├── fd: ()-->(1-3,8,11,12,33,35), (3)==(8), (2)==(33), (33)==(2), (8)==(3)
      ├── inner-join (lookup customer)
      │    ├── columns: ca_id:1!null ca_b_id:2!null ca_c_id:3!null c_id:8!null c_l_name:11!null c_f_name:12!null
      │    ├── key columns: [3] = [8]
      │    ├── lookup columns are key
      │    ├── cardinality: [0 - 1]
      │    ├── key: ()
      │    ├── fd: ()-->(1-3,8,11,12), (8)==(3), (3)==(8)
      │    ├── scan customer_account
      │    │    ├── columns: ca_id:1!null ca_b_id:2!null ca_c_id:3!null
      │    │    ├── constraint: /1: [/0 - /0]
      │    │    ├── cardinality: [0 - 1]
      │    │    ├── key: ()
      │    │    └── fd: ()-->(1-3)
      │    └── filters (true)
      └── filters (true)

# --------------------------------------------------
# T10
# Trade-Update
# Emulates the process of making minor corrections or updates to a set of
# trades. This is analogous to a customer or broker reviewing a set of trades,
# and discovering that some minor editorial corrections are required. The
# various sets of trades are chosen such that the work is representative of:
#   * reviewing general market trends
#   * reviewing trades for a period of time prior to the most recent account
#     statement
#   * reviewing past performance of a particular security
# --------------------------------------------------

# Q1
opt
SELECT t_exec_name FROM trade WHERE t_id = 0
----
project
 ├── columns: t_exec_name:10!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(10)
 └── scan trade
      ├── columns: t_id:1!null t_exec_name:10!null
      ├── constraint: /1: [/0 - /0]
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1,10)

# Q2
opt
UPDATE trade
   SET t_exec_name = IF(
                    t_exec_name LIKE '% X %',
                    replace(t_exec_name, ' X ', ' '),
                    replace(t_exec_name, ' ', ' X ')
                   )
 WHERE t_id = 0
----
update trade
 ├── columns: <none>
 ├── fetch columns: t_id:17 t_dts:18 t_st_id:19 t_tt_id:20 t_is_cash:21 t_s_symb:22 t_qty:23 t_bid_price:24 t_ca_id:25 t_exec_name:26 t_trade_price:27 t_chrg:28 t_comm:29 t_tax:30 t_lifo:31
 ├── update-mapping:
 │    └── t_exec_name_new:33 => t_exec_name:10
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── project
      ├── columns: t_exec_name_new:33 t_id:17!null t_dts:18!null t_st_id:19!null t_tt_id:20!null t_is_cash:21!null t_s_symb:22!null t_qty:23!null t_bid_price:24 t_ca_id:25!null t_exec_name:26!null t_trade_price:27 t_chrg:28!null t_comm:29!null t_tax:30!null t_lifo:31!null
      ├── cardinality: [0 - 1]
      ├── immutable
      ├── key: ()
      ├── fd: ()-->(17-31,33)
      ├── scan trade
      │    ├── columns: t_id:17!null t_dts:18!null t_st_id:19!null t_tt_id:20!null t_is_cash:21!null t_s_symb:22!null t_qty:23!null t_bid_price:24 t_ca_id:25!null t_exec_name:26!null t_trade_price:27 t_chrg:28!null t_comm:29!null t_tax:30!null t_lifo:31!null
      │    ├── constraint: /17: [/0 - /0]
      │    ├── cardinality: [0 - 1]
      │    ├── key: ()
      │    └── fd: ()-->(17-31)
      └── projections
           └── CASE t_exec_name:26 LIKE '% X %' WHEN true THEN replace(t_exec_name:26, ' X ', ' ') ELSE replace(t_exec_name:26, ' ', ' X ') END [as=t_exec_name_new:33, outer=(26), immutable]

# Q3
opt
SELECT t_bid_price::FLOAT8,
       t_exec_name,
       t_is_cash,
       tt_is_mrkt,
       t_trade_price::FLOAT8
  FROM trade, trade_type
 WHERE t_id = 0 AND t_tt_id = tt_id
----
project
 ├── columns: t_bid_price:22 t_exec_name:10!null t_is_cash:5!null tt_is_mrkt:20!null t_trade_price:23
 ├── cardinality: [0 - 1]
 ├── immutable
 ├── key: ()
 ├── fd: ()-->(5,10,20,22,23)
 ├── inner-join (lookup trade_type)
 │    ├── columns: t_id:1!null t_tt_id:4!null t_is_cash:5!null trade.t_bid_price:8 t_exec_name:10!null trade.t_trade_price:11 tt_id:17!null tt_is_mrkt:20!null
 │    ├── key columns: [4] = [17]
 │    ├── lookup columns are key
 │    ├── cardinality: [0 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(1,4,5,8,10,11,17,20), (17)==(4), (4)==(17)
 │    ├── scan trade
 │    │    ├── columns: t_id:1!null t_tt_id:4!null t_is_cash:5!null trade.t_bid_price:8 t_exec_name:10!null trade.t_trade_price:11
 │    │    ├── constraint: /1: [/0 - /0]
 │    │    ├── cardinality: [0 - 1]
 │    │    ├── key: ()
 │    │    └── fd: ()-->(1,4,5,8,10,11)
 │    └── filters (true)
 └── projections
      ├── trade.t_bid_price:8::FLOAT8 [as=t_bid_price:22, outer=(8), immutable]
      └── trade.t_trade_price:11::FLOAT8 [as=t_trade_price:23, outer=(11), immutable]

# Q4
opt
SELECT se_amt::FLOAT8, se_cash_due_date, se_cash_type
  FROM settlement
 WHERE se_t_id = 0
----
project
 ├── columns: se_amt:6!null se_cash_due_date:3!null se_cash_type:2!null
 ├── cardinality: [0 - 1]
 ├── immutable
 ├── key: ()
 ├── fd: ()-->(2,3,6)
 ├── scan settlement
 │    ├── columns: se_t_id:1!null se_cash_type:2!null se_cash_due_date:3!null settlement.se_amt:4!null
 │    ├── constraint: /1: [/0 - /0]
 │    ├── cardinality: [0 - 1]
 │    ├── key: ()
 │    └── fd: ()-->(1-4)
 └── projections
      └── settlement.se_amt:4::FLOAT8 [as=se_amt:6, outer=(4), immutable]

# Q5
opt
SELECT ct_amt::FLOAT8, ct_dts, ct_name FROM cash_transaction WHERE ct_t_id = 0
----
project
 ├── columns: ct_amt:6!null ct_dts:2!null ct_name:4
 ├── cardinality: [0 - 1]
 ├── immutable
 ├── key: ()
 ├── fd: ()-->(2,4,6)
 ├── scan cash_transaction
 │    ├── columns: ct_t_id:1!null ct_dts:2!null cash_transaction.ct_amt:3!null ct_name:4
 │    ├── constraint: /1: [/0 - /0]
 │    ├── cardinality: [0 - 1]
 │    ├── key: ()
 │    └── fd: ()-->(1-4)
 └── projections
      └── cash_transaction.ct_amt:3::FLOAT8 [as=ct_amt:6, outer=(3), immutable]

# Q6
opt
  SELECT th_dts, th_st_id
    FROM trade_history
   WHERE th_t_id = 0
ORDER BY th_dts
   LIMIT 3
----
project
 ├── columns: th_dts:2!null th_st_id:3!null
 ├── cardinality: [0 - 3]
 ├── key: (3)
 ├── fd: (3)-->(2)
 ├── ordering: +2
 └── limit
      ├── columns: th_t_id:1!null th_dts:2!null th_st_id:3!null
      ├── internal-ordering: +2 opt(1)
      ├── cardinality: [0 - 3]
      ├── key: (3)
      ├── fd: ()-->(1), (3)-->(2)
      ├── ordering: +2 opt(1) [actual: +2]
      ├── sort
      │    ├── columns: th_t_id:1!null th_dts:2!null th_st_id:3!null
      │    ├── key: (3)
      │    ├── fd: ()-->(1), (3)-->(2)
      │    ├── ordering: +2 opt(1) [actual: +2]
      │    ├── limit hint: 3.00
      │    └── scan trade_history
      │         ├── columns: th_t_id:1!null th_dts:2!null th_st_id:3!null
      │         ├── constraint: /1/3: [/0 - /0]
      │         ├── key: (3)
      │         └── fd: ()-->(1), (3)-->(2)
      └── 3

# Q7
opt
  SELECT t_id,
         t_bid_price::FLOAT8,
         t_exec_name,
         t_is_cash,
         t_trade_price::FLOAT8
    FROM trade
   WHERE t_ca_id = 0 AND
         t_dts >= '2020-06-15 22:27:42.148484+00:00'::TIMESTAMP AND
         t_dts <= '2020-06-17 22:27:42.148484+00:00'::TIMESTAMP
ORDER BY t_dts ASC
   LIMIT 20
----
project
 ├── columns: t_id:1!null t_bid_price:17 t_exec_name:10!null t_is_cash:5!null t_trade_price:18  [hidden: t_dts:2!null]
 ├── cardinality: [0 - 20]
 ├── immutable
 ├── key: (1)
 ├── fd: (1)-->(2,5,10,17,18)
 ├── ordering: +2
 ├── scan trade@secondary,rev
 │    ├── columns: t_id:1!null t_dts:2!null t_is_cash:5!null trade.t_bid_price:8 t_ca_id:9!null t_exec_name:10!null trade.t_trade_price:11
 │    ├── constraint: /9/-2/1: [/0/'2020-06-17 22:27:42.148484' - /0/'2020-06-15 22:27:42.148484']
 │    ├── limit: 20(rev)
 │    ├── key: (1)
 │    ├── fd: ()-->(9), (1)-->(2,5,8,10,11)
 │    └── ordering: +2 opt(9) [actual: +2]
 └── projections
      ├── trade.t_bid_price:8::FLOAT8 [as=t_bid_price:17, outer=(8), immutable]
      └── trade.t_trade_price:11::FLOAT8 [as=t_trade_price:18, outer=(11), immutable]

# Q8
opt
UPDATE settlement
   SET se_cash_type = IF(
                        True,
                        IF(
                            se_cash_type = 'Cash Account',
                            'Cash',
                            'Cash Account'
                        ),
                        IF(
                            se_cash_type = 'Margin Account',
                            'Margin',
                            'Margin Account'
                        )
                    )
 WHERE se_t_id = 0
----
update settlement
 ├── columns: <none>
 ├── fetch columns: se_t_id:6 se_cash_type:7 se_cash_due_date:8 se_amt:9
 ├── update-mapping:
 │    └── se_cash_type_new:11 => se_cash_type:2
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── project
      ├── columns: se_cash_type_new:11!null se_t_id:6!null se_cash_type:7!null se_cash_due_date:8!null se_amt:9!null
      ├── cardinality: [0 - 1]
      ├── key: ()
      ├── fd: ()-->(6-9,11)
      ├── scan settlement
      │    ├── columns: se_t_id:6!null se_cash_type:7!null se_cash_due_date:8!null se_amt:9!null
      │    ├── constraint: /6: [/0 - /0]
      │    ├── cardinality: [0 - 1]
      │    ├── key: ()
      │    └── fd: ()-->(6-9)
      └── projections
           └── CASE se_cash_type:7 = 'Cash Account' WHEN true THEN 'Cash' ELSE 'Cash Account' END [as=se_cash_type_new:11, outer=(7)]


# Q9
opt
  SELECT th_dts, th_st_id
    FROM trade_history
   WHERE th_t_id = 0
ORDER BY th_dts
   LIMIT 3
----
project
 ├── columns: th_dts:2!null th_st_id:3!null
 ├── cardinality: [0 - 3]
 ├── key: (3)
 ├── fd: (3)-->(2)
 ├── ordering: +2
 └── limit
      ├── columns: th_t_id:1!null th_dts:2!null th_st_id:3!null
      ├── internal-ordering: +2 opt(1)
      ├── cardinality: [0 - 3]
      ├── key: (3)
      ├── fd: ()-->(1), (3)-->(2)
      ├── ordering: +2 opt(1) [actual: +2]
      ├── sort
      │    ├── columns: th_t_id:1!null th_dts:2!null th_st_id:3!null
      │    ├── key: (3)
      │    ├── fd: ()-->(1), (3)-->(2)
      │    ├── ordering: +2 opt(1) [actual: +2]
      │    ├── limit hint: 3.00
      │    └── scan trade_history
      │         ├── columns: th_t_id:1!null th_dts:2!null th_st_id:3!null
      │         ├── constraint: /1/3: [/0 - /0]
      │         ├── key: (3)
      │         └── fd: ()-->(1), (3)-->(2)
      └── 3

# Q10 Version 1
#
# TODO:
#   1. The limit can be pushed into the joins because the filters on the foreign
#      key column imply the filters on the referenced column.
#
opt
  SELECT t_id,
         t_ca_id,
         t_exec_name,
         t_is_cash,
         t_trade_price::FLOAT8,
         t_qty,
         s_name,
         t_dts,
         t_tt_id,
         tt_name
    FROM trade, trade_type, security
   WHERE t_s_symb = 'SYMB'
     AND t_dts >= '2020-06-15 22:27:42.148484+00:00'::TIMESTAMP
     AND t_dts <= '2020-06-17 22:27:42.148484+00:00'::TIMESTAMP
     AND tt_id = t_tt_id
     AND s_symb = t_s_symb
ORDER BY t_dts ASC
   LIMIT 20
----
project
 ├── columns: t_id:1!null t_ca_id:9!null t_exec_name:10!null t_is_cash:5!null t_trade_price:39 t_qty:7!null s_name:25!null t_dts:2!null t_tt_id:4!null tt_name:18!null
 ├── cardinality: [0 - 20]
 ├── immutable
 ├── key: (1)
 ├── fd: ()-->(25), (1)-->(2,4,5,7,9,10,18,39), (4)-->(18)
 ├── ordering: +2 opt(25) [actual: +2]
 ├── limit
 │    ├── columns: t_id:1!null t_dts:2!null t_tt_id:4!null t_is_cash:5!null t_s_symb:6!null t_qty:7!null t_ca_id:9!null t_exec_name:10!null trade.t_trade_price:11 tt_id:17!null tt_name:18!null s_symb:22!null s_name:25!null
 │    ├── internal-ordering: +2 opt(6,22,25)
 │    ├── cardinality: [0 - 20]
 │    ├── key: (1)
 │    ├── fd: ()-->(6,22,25), (1)-->(2,4,5,7,9-11), (17)-->(18), (4)==(17), (17)==(4)
 │    ├── ordering: +2 opt(6,22,25) [actual: +2]
 │    ├── sort
 │    │    ├── columns: t_id:1!null t_dts:2!null t_tt_id:4!null t_is_cash:5!null t_s_symb:6!null t_qty:7!null t_ca_id:9!null t_exec_name:10!null trade.t_trade_price:11 tt_id:17!null tt_name:18!null s_symb:22!null s_name:25!null
 │    │    ├── key: (1)
 │    │    ├── fd: ()-->(6,22,25), (1)-->(2,4,5,7,9-11), (17)-->(18), (4)==(17), (17)==(4)
 │    │    ├── ordering: +2 opt(6,22,25) [actual: +2]
 │    │    ├── limit hint: 20.00
 │    │    └── inner-join (cross)
 │    │         ├── columns: t_id:1!null t_dts:2!null t_tt_id:4!null t_is_cash:5!null t_s_symb:6!null t_qty:7!null t_ca_id:9!null t_exec_name:10!null trade.t_trade_price:11 tt_id:17!null tt_name:18!null s_symb:22!null s_name:25!null
 │    │         ├── multiplicity: left-rows(zero-or-one), right-rows(zero-or-more)
 │    │         ├── key: (1)
 │    │         ├── fd: ()-->(6,22,25), (1)-->(2,4,5,7,9-11), (17)-->(18), (4)==(17), (17)==(4)
 │    │         ├── inner-join (lookup trade_type)
 │    │         │    ├── columns: t_id:1!null t_dts:2!null t_tt_id:4!null t_is_cash:5!null t_s_symb:6!null t_qty:7!null t_ca_id:9!null t_exec_name:10!null trade.t_trade_price:11 tt_id:17!null tt_name:18!null
 │    │         │    ├── key columns: [4] = [17]
 │    │         │    ├── lookup columns are key
 │    │         │    ├── key: (1)
 │    │         │    ├── fd: ()-->(6), (1)-->(2,4,5,7,9-11), (17)-->(18), (4)==(17), (17)==(4)
 │    │         │    ├── scan trade@secondary
 │    │         │    │    ├── columns: t_id:1!null t_dts:2!null t_tt_id:4!null t_is_cash:5!null t_s_symb:6!null t_qty:7!null t_ca_id:9!null t_exec_name:10!null trade.t_trade_price:11
 │    │         │    │    ├── constraint: /6/2/1: [/'SYMB'/'2020-06-15 22:27:42.148484' - /'SYMB'/'2020-06-17 22:27:42.148484']
 │    │         │    │    ├── key: (1)
 │    │         │    │    └── fd: ()-->(6), (1)-->(2,4,5,7,9-11)
 │    │         │    └── filters (true)
 │    │         ├── scan security
 │    │         │    ├── columns: s_symb:22!null s_name:25!null
 │    │         │    ├── constraint: /22: [/'SYMB' - /'SYMB']
 │    │         │    ├── cardinality: [0 - 1]
 │    │         │    ├── key: ()
 │    │         │    └── fd: ()-->(22,25)
 │    │         └── filters (true)
 │    └── 20
 └── projections
      └── trade.t_trade_price:11::FLOAT8 [as=t_trade_price:39, outer=(11), immutable]

# Q11
opt
UPDATE cash_transaction
   SET ct_name = concat_ws(
                ' ',
                'TMB',
                10:::INT4::STRING,
                IF(ct_name LIKE '% shares of %', 'Shares of', 'shares of'),
                'SYMB'
               )
 WHERE ct_t_id = 0
----
update cash_transaction
 ├── columns: <none>
 ├── fetch columns: ct_t_id:6 ct_dts:7 ct_amt:8 ct_name:9
 ├── update-mapping:
 │    └── ct_name_new:11 => ct_name:4
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── project
      ├── columns: ct_name_new:11 ct_t_id:6!null ct_dts:7!null ct_amt:8!null ct_name:9
      ├── cardinality: [0 - 1]
      ├── immutable
      ├── key: ()
      ├── fd: ()-->(6-9,11)
      ├── scan cash_transaction
      │    ├── columns: ct_t_id:6!null ct_dts:7!null ct_amt:8!null ct_name:9
      │    ├── constraint: /6: [/0 - /0]
      │    ├── cardinality: [0 - 1]
      │    ├── key: ()
      │    └── fd: ()-->(6-9)
      └── projections
           └── concat_ws(' ', 'TMB', '10', CASE ct_name:9 LIKE '% shares of %' WHEN true THEN 'Shares of' ELSE 'shares of' END, 'SYMB') [as=ct_name_new:11, outer=(9), immutable]

# --------------------------------------------------
# T11
# Data-Maintenance
# Emulates the periodic modifications to data that is mainly static and used for
# reference. This is analogous to updating data that seldom changes.
# --------------------------------------------------

# Q1
opt
SELECT ap_acl
  FROM account_permission
 WHERE ap_ca_id = 0
 ORDER BY ap_acl DESC
 LIMIT 1
----
project
 ├── columns: ap_acl:2!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(2)
 └── limit
      ├── columns: ap_ca_id:1!null ap_acl:2!null
      ├── internal-ordering: -2 opt(1)
      ├── cardinality: [0 - 1]
      ├── key: ()
      ├── fd: ()-->(1,2)
      ├── sort
      │    ├── columns: ap_ca_id:1!null ap_acl:2!null
      │    ├── fd: ()-->(1)
      │    ├── ordering: -2 opt(1) [actual: -2]
      │    ├── limit hint: 1.00
      │    └── scan account_permission
      │         ├── columns: ap_ca_id:1!null ap_acl:2!null
      │         ├── constraint: /1/3: [/0 - /0]
      │         └── fd: ()-->(1)
      └── 1

# Q2
opt
UPDATE account_permission SET ap_acl = '0011' WHERE ap_ca_id = 0 AND ap_acl = NULL
----
update account_permission
 ├── columns: <none>
 ├── fetch columns: ap_ca_id:7 ap_acl:8 ap_tax_id:9 ap_l_name:10 ap_f_name:11
 ├── update-mapping:
 │    └── ap_acl_new:13 => ap_acl:2
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── values
      ├── columns: ap_ca_id:7!null ap_acl:8!null ap_tax_id:9!null ap_l_name:10!null ap_f_name:11!null ap_acl_new:13!null
      ├── cardinality: [0 - 0]
      ├── key: ()
      └── fd: ()-->(7-11,13)

# Q3
opt
SELECT ad_line2, ad_id
  FROM address, customer
 WHERE ad_id = c_ad_id AND c_id = 0
----
project
 ├── columns: ad_line2:3 ad_id:1!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(1,3)
 └── inner-join (lookup address)
      ├── columns: ad_id:1!null ad_line2:3 c_id:7!null c_ad_id:16!null
      ├── key columns: [16] = [1]
      ├── lookup columns are key
      ├── cardinality: [0 - 1]
      ├── key: ()
      ├── fd: ()-->(1,3,7,16), (16)==(1), (1)==(16)
      ├── scan customer
      │    ├── columns: c_id:7!null c_ad_id:16!null
      │    ├── constraint: /7: [/0 - /0]
      │    ├── cardinality: [0 - 1]
      │    ├── key: ()
      │    └── fd: ()-->(7,16)
      └── filters (true)

# Q4
opt
SELECT ad_line2, ad_id
  FROM address, company
 WHERE ad_id = co_ad_id AND co_id = 0
----
project
 ├── columns: ad_line2:3 ad_id:1!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(1,3)
 └── inner-join (lookup address)
      ├── columns: ad_id:1!null ad_line2:3 co_id:7!null co_ad_id:13!null
      ├── key columns: [13] = [1]
      ├── lookup columns are key
      ├── cardinality: [0 - 1]
      ├── key: ()
      ├── fd: ()-->(1,3,7,13), (13)==(1), (1)==(13)
      ├── scan company
      │    ├── columns: co_id:7!null co_ad_id:13!null
      │    ├── constraint: /7: [/0 - /0]
      │    ├── cardinality: [0 - 1]
      │    ├── key: ()
      │    └── fd: ()-->(7,13)
      └── filters (true)

# Q5
opt
UPDATE address SET ad_line2 = '' WHERE ad_id = 0
----
update address
 ├── columns: <none>
 ├── fetch columns: ad_id:7 ad_line1:8 ad_line2:9 ad_zc_code:10 ad_ctry:11
 ├── update-mapping:
 │    └── ad_line2_new:13 => ad_line2:3
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── project
      ├── columns: ad_line2_new:13!null ad_id:7!null ad_line1:8 ad_line2:9 ad_zc_code:10!null ad_ctry:11
      ├── cardinality: [0 - 1]
      ├── key: ()
      ├── fd: ()-->(7-11,13)
      ├── scan address
      │    ├── columns: ad_id:7!null ad_line1:8 ad_line2:9 ad_zc_code:10!null ad_ctry:11
      │    ├── constraint: /7: [/0 - /0]
      │    ├── cardinality: [0 - 1]
      │    ├── key: ()
      │    └── fd: ()-->(7-11)
      └── projections
           └── '' [as=ad_line2_new:13]

# Q6
opt
SELECT co_sp_rate FROM company WHERE co_id = 0
----
project
 ├── columns: co_sp_rate:5!null
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(5)
 └── scan company
      ├── columns: co_id:1!null co_sp_rate:5!null
      ├── constraint: /1: [/0 - /0]
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1,5)

# Q7
opt
UPDATE company SET co_sp_rate = 'AAA' WHERE co_id = 0
----
update company
 ├── columns: <none>
 ├── fetch columns: co_id:11 co_st_id:12 co_name:13 co_in_id:14 co_sp_rate:15 co_ceo:16 co_ad_id:17 co_desc:18 co_open_date:19
 ├── update-mapping:
 │    └── co_sp_rate_new:21 => co_sp_rate:5
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── project
      ├── columns: co_sp_rate_new:21!null co_id:11!null co_st_id:12!null co_name:13!null co_in_id:14!null co_sp_rate:15!null co_ceo:16!null co_ad_id:17!null co_desc:18!null co_open_date:19!null
      ├── cardinality: [0 - 1]
      ├── key: ()
      ├── fd: ()-->(11-19,21)
      ├── scan company
      │    ├── columns: co_id:11!null co_st_id:12!null co_name:13!null co_in_id:14!null co_sp_rate:15!null co_ceo:16!null co_ad_id:17!null co_desc:18!null co_open_date:19!null
      │    ├── constraint: /11: [/0 - /0]
      │    ├── cardinality: [0 - 1]
      │    ├── key: ()
      │    └── fd: ()-->(11-19)
      └── projections
           └── 'AAA' [as=co_sp_rate_new:21]

# Q8
opt
SELECT c_email_2 FROM customer WHERE c_id = 0
----
project
 ├── columns: c_email_2:24
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(24)
 └── scan customer
      ├── columns: c_id:1!null c_email_2:24
      ├── constraint: /1: [/0 - /0]
      ├── cardinality: [0 - 1]
      ├── key: ()
      └── fd: ()-->(1,24)

# Q9
opt
UPDATE customer SET c_email_2 = '' WHERE c_id = 0
----
update customer
 ├── columns: <none>
 ├── fetch columns: c_id:26 c_tax_id:27 c_st_id:28 c_l_name:29 c_f_name:30 c_m_name:31 c_gndr:32 c_tier:33 c_dob:34 c_ad_id:35 c_ctry_1:36 c_area_1:37 c_local_1:38 c_ext_1:39 c_ctry_2:40 c_area_2:41 c_local_2:42 c_ext_2:43 c_ctry_3:44 c_area_3:45 c_local_3:46 c_ext_3:47 c_email_1:48 c_email_2:49
 ├── update-mapping:
 │    └── c_email_2_new:51 => c_email_2:24
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── project
      ├── columns: c_email_2_new:51!null c_id:26!null c_tax_id:27!null c_st_id:28!null c_l_name:29!null c_f_name:30!null c_m_name:31 c_gndr:32 c_tier:33!null c_dob:34!null c_ad_id:35!null c_ctry_1:36 c_area_1:37 c_local_1:38 c_ext_1:39 c_ctry_2:40 c_area_2:41 c_local_2:42 c_ext_2:43 c_ctry_3:44 c_area_3:45 c_local_3:46 c_ext_3:47 c_email_1:48 c_email_2:49
      ├── cardinality: [0 - 1]
      ├── key: ()
      ├── fd: ()-->(26-49,51)
      ├── scan customer
      │    ├── columns: c_id:26!null c_tax_id:27!null c_st_id:28!null c_l_name:29!null c_f_name:30!null c_m_name:31 c_gndr:32 c_tier:33!null c_dob:34!null c_ad_id:35!null c_ctry_1:36 c_area_1:37 c_local_1:38 c_ext_1:39 c_ctry_2:40 c_area_2:41 c_local_2:42 c_ext_2:43 c_ctry_3:44 c_area_3:45 c_local_3:46 c_ext_3:47 c_email_1:48 c_email_2:49
      │    ├── constraint: /26: [/0 - /0]
      │    ├── cardinality: [0 - 1]
      │    ├── key: ()
      │    └── fd: ()-->(26-49)
      └── projections
           └── '' [as=c_email_2_new:51]

# Q10
opt
SELECT cx_tx_id
  FROM customer_taxrate
 WHERE cx_c_id = 0 AND (cx_tx_id LIKE 'US%' OR cx_tx_id LIKE 'CN%')
----
project
 ├── columns: cx_tx_id:1!null
 ├── key: (1)
 └── select
      ├── columns: cx_tx_id:1!null cx_c_id:2!null
      ├── key: (1)
      ├── fd: ()-->(2)
      ├── scan customer_taxrate
      │    ├── columns: cx_tx_id:1!null cx_c_id:2!null
      │    ├── constraint: /1/2
      │    │    ├── [/'CN'/0 - /'CO')
      │    │    └── [/'US'/0 - /'UT')
      │    └── key: (1,2)
      └── filters
           └── cx_c_id:2 = 0 [outer=(2), constraints=(/2: [/0 - /0]; tight), fd=()-->(2)]

# Q11
opt
UPDATE customer_taxrate
   SET cx_tx_id = 'US12'
 where cx_c_id = 0 and cx_tx_id = 'US13'
----
update customer_taxrate
 ├── columns: <none>
 ├── fetch columns: customer_taxrate.cx_tx_id:4 cx_c_id:5
 ├── update-mapping:
 │    └── cx_tx_id_new:7 => customer_taxrate.cx_tx_id:1
 ├── input binding: &1
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 ├── project
 │    ├── columns: cx_tx_id_new:7!null customer_taxrate.cx_tx_id:4!null cx_c_id:5!null
 │    ├── cardinality: [0 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(4,5,7)
 │    ├── scan customer_taxrate
 │    │    ├── columns: customer_taxrate.cx_tx_id:4!null cx_c_id:5!null
 │    │    ├── constraint: /4/5: [/'US13'/0 - /'US13'/0]
 │    │    ├── cardinality: [0 - 1]
 │    │    ├── key: ()
 │    │    └── fd: ()-->(4,5)
 │    └── projections
 │         └── 'US12' [as=cx_tx_id_new:7]
 └── f-k-checks
      └── f-k-checks-item: customer_taxrate(cx_tx_id) -> taxrate(tx_id)
           └── anti-join (lookup taxrate)
                ├── columns: cx_tx_id:8!null
                ├── key columns: [8] = [9]
                ├── lookup columns are key
                ├── cardinality: [0 - 1]
                ├── key: ()
                ├── fd: ()-->(8)
                ├── with-scan &1
                │    ├── columns: cx_tx_id:8!null
                │    ├── mapping:
                │    │    └──  cx_tx_id_new:7 => cx_tx_id:8
                │    ├── cardinality: [0 - 1]
                │    ├── key: ()
                │    └── fd: ()-->(8)
                └── filters (true)

# Q12
opt
UPDATE daily_market
   SET dm_vol = dm_vol + 1
 WHERE dm_s_symb = 'SYMB' AND substring (dm_date::CHAR(8),1,2) = 'Thursday'
----
update daily_market
 ├── columns: <none>
 ├── fetch columns: dm_date:8 dm_s_symb:9 dm_close:10 dm_high:11 dm_low:12 dm_vol:13
 ├── update-mapping:
 │    └── dm_vol_new:15 => dm_vol:6
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── project
      ├── columns: dm_vol_new:15!null dm_date:8!null dm_s_symb:9!null dm_close:10!null dm_high:11!null dm_low:12!null dm_vol:13!null
      ├── immutable
      ├── key: (8)
      ├── fd: ()-->(9), (8)-->(10-13), (13)-->(15)
      ├── select
      │    ├── columns: dm_date:8!null dm_s_symb:9!null dm_close:10!null dm_high:11!null dm_low:12!null dm_vol:13!null
      │    ├── immutable
      │    ├── key: (8)
      │    ├── fd: ()-->(9), (8)-->(10-13)
      │    ├── scan daily_market@secondary
      │    │    ├── columns: dm_date:8!null dm_s_symb:9!null dm_close:10!null dm_high:11!null dm_low:12!null dm_vol:13!null
      │    │    ├── constraint: /9/8: [/'SYMB' - /'SYMB']
      │    │    ├── key: (8)
      │    │    └── fd: ()-->(9), (8)-->(10-13)
      │    └── filters
      │         └── substring(dm_date:8::CHAR(8), 1, 2) = 'Thursday' [outer=(8), immutable]
      └── projections
           └── dm_vol:13 + 1 [as=dm_vol_new:15, outer=(13), immutable]

# Q13
opt
UPDATE
  exchange
SET
  ex_desc = IF(
      (
        SELECT count(*)
        FROM exchange
        WHERE ex_desc LIKE '%LAST UPDATED%'
      ) = 0,
      concat(
        ex_desc::STRING,
        ' LAST UPDATED ',
        current_timestamp::STRING
      ),
      concat(
        substring(
          ex_desc,
          1,
          char_length(ex_desc)-char_length(current_timestamp::STRING)
        ),
        current_timestamp::STRING
      )
  )
----
update exchange
 ├── columns: <none>
 ├── fetch columns: ex_id:9 ex_name:10 ex_num_symb:11 ex_open:12 ex_close:13 ex_desc:14 ex_ad_id:15
 ├── update-mapping:
 │    └── ex_desc_new:26 => ex_desc:6
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── project
      ├── columns: ex_desc_new:26 ex_id:9!null ex_name:10!null ex_num_symb:11!null ex_open:12!null ex_close:13!null ex_desc:14 ex_ad_id:15!null
      ├── immutable
      ├── key: (9)
      ├── fd: (9)-->(10-15), (14)-->(26)
      ├── scan exchange
      │    ├── columns: ex_id:9!null ex_name:10!null ex_num_symb:11!null ex_open:12!null ex_close:13!null ex_desc:14 ex_ad_id:15!null
      │    ├── key: (9)
      │    └── fd: (9)-->(10-15)
      └── projections
           └── case [as=ex_desc_new:26, outer=(14), immutable, subquery]
                ├── eq
                │    ├── subquery
                │    │    └── scalar-group-by
                │    │         ├── columns: count_rows:25!null
                │    │         ├── cardinality: [1 - 1]
                │    │         ├── key: ()
                │    │         ├── fd: ()-->(25)
                │    │         ├── select
                │    │         │    ├── columns: ex_desc:22!null
                │    │         │    ├── scan exchange
                │    │         │    │    └── columns: ex_desc:22
                │    │         │    └── filters
                │    │         │         └── ex_desc:22 LIKE '%LAST UPDATED%' [outer=(22), constraints=(/22: (/NULL - ])]
                │    │         └── aggregations
                │    │              └── count-rows [as=count_rows:25]
                │    └── 0
                ├── when
                │    ├── true
                │    └── concat(ex_desc:14::STRING, ' LAST UPDATED ', '2017-05-10 13:00:00+00:00')
                └── concat(substring(ex_desc:14, 1, char_length(ex_desc:14) - 25), '2017-05-10 13:00:00+00:00')

# Q14
opt
UPDATE
  financial
SET
  fi_qtr_start_date = IF(
      (
        SELECT count(*)
          FROM financial
         WHERE fi_co_id = 0 AND
               substring(fi_qtr_start_date::CHAR(8),7,2) = '01'
      ) > 0,
      fi_qtr_start_date + INTEGER '1',
      fi_qtr_start_date - INTEGER '1'
  )
WHERE fi_co_id = 0
----
update financial
 ├── columns: <none>
 ├── fetch columns: fi_co_id:16 fi_year:17 fi_qtr:18 fi_qtr_start_date:19 fi_revenue:20 fi_net_earn:21 fi_basic_eps:22 fi_dilut_eps:23 fi_margin:24 fi_inventory:25 fi_assets:26 fi_liability:27 fi_out_basic:28 fi_out_dilut:29
 ├── update-mapping:
 │    └── fi_qtr_start_date_new:47 => fi_qtr_start_date:4
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── project
      ├── columns: fi_qtr_start_date_new:47 fi_co_id:16!null fi_year:17!null fi_qtr:18!null fi_qtr_start_date:19!null fi_revenue:20!null fi_net_earn:21!null fi_basic_eps:22!null fi_dilut_eps:23!null fi_margin:24!null fi_inventory:25!null fi_assets:26!null fi_liability:27!null fi_out_basic:28!null fi_out_dilut:29!null
      ├── immutable
      ├── key: (17,18)
      ├── fd: ()-->(16), (17,18)-->(19-29), (19)-->(47)
      ├── scan financial
      │    ├── columns: fi_co_id:16!null fi_year:17!null fi_qtr:18!null fi_qtr_start_date:19!null fi_revenue:20!null fi_net_earn:21!null fi_basic_eps:22!null fi_dilut_eps:23!null fi_margin:24!null fi_inventory:25!null fi_assets:26!null fi_liability:27!null fi_out_basic:28!null fi_out_dilut:29!null
      │    ├── constraint: /16/17/18: [/0 - /0]
      │    ├── key: (17,18)
      │    └── fd: ()-->(16), (17,18)-->(19-29)
      └── projections
           └── case [as=fi_qtr_start_date_new:47, outer=(19), immutable, subquery]
                ├── gt
                │    ├── subquery
                │    │    └── scalar-group-by
                │    │         ├── columns: count_rows:46!null
                │    │         ├── cardinality: [1 - 1]
                │    │         ├── immutable
                │    │         ├── key: ()
                │    │         ├── fd: ()-->(46)
                │    │         ├── select
                │    │         │    ├── columns: fi_co_id:31!null fi_qtr_start_date:34!null
                │    │         │    ├── immutable
                │    │         │    ├── fd: ()-->(31)
                │    │         │    ├── scan financial
                │    │         │    │    ├── columns: fi_co_id:31!null fi_qtr_start_date:34!null
                │    │         │    │    ├── constraint: /31/32/33: [/0 - /0]
                │    │         │    │    └── fd: ()-->(31)
                │    │         │    └── filters
                │    │         │         └── substring(fi_qtr_start_date:34::CHAR(8), 7, 2) = '01' [outer=(34), immutable]
                │    │         └── aggregations
                │    │              └── count-rows [as=count_rows:46]
                │    └── 0
                ├── when
                │    ├── true
                │    └── fi_qtr_start_date:19 + 1
                └── fi_qtr_start_date:19 - 1

# Q15
opt
UPDATE
  news_item
SET
  ni_dts = ni_dts + INTERVAL '1 day'
WHERE
  ni_id = (
            SELECT
              nx_ni_id
            FROM
              news_xref
            WHERE
              nx_co_id = 0
          )
----
update news_item
 ├── columns: <none>
 ├── fetch columns: ni_id:9 ni_headline:10 ni_summary:11 ni_dts:13 ni_source:14 ni_author:15
 ├── update-mapping:
 │    └── ni_dts_new:20 => ni_dts:5
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── project
      ├── columns: ni_dts_new:20!null ni_id:9!null ni_headline:10!null ni_summary:11!null ni_dts:13!null ni_source:14!null ni_author:15
      ├── immutable
      ├── key: (9)
      ├── fd: (9)-->(10,11,13-15), (13)-->(20)
      ├── select
      │    ├── columns: ni_id:9!null ni_headline:10!null ni_summary:11!null ni_dts:13!null ni_source:14!null ni_author:15
      │    ├── key: (9)
      │    ├── fd: (9)-->(10,11,13-15)
      │    ├── scan news_item
      │    │    ├── columns: ni_id:9!null ni_headline:10!null ni_summary:11!null ni_dts:13!null ni_source:14!null ni_author:15
      │    │    ├── key: (9)
      │    │    └── fd: (9)-->(10,11,13-15)
      │    └── filters
      │         └── eq [outer=(9), subquery, constraints=(/9: (/NULL - ])]
      │              ├── ni_id:9
      │              └── subquery
      │                   └── max1-row
      │                        ├── columns: nx_ni_id:17!null
      │                        ├── error: "more than one row returned by a subquery used as an expression"
      │                        ├── cardinality: [0 - 1]
      │                        ├── key: ()
      │                        ├── fd: ()-->(17)
      │                        └── project
      │                             ├── columns: nx_ni_id:17!null
      │                             ├── key: (17)
      │                             └── select
      │                                  ├── columns: nx_ni_id:17!null nx_co_id:18!null
      │                                  ├── key: (17)
      │                                  ├── fd: ()-->(18)
      │                                  ├── scan news_xref
      │                                  │    ├── columns: nx_ni_id:17!null nx_co_id:18!null
      │                                  │    └── key: (17,18)
      │                                  └── filters
      │                                       └── nx_co_id:18 = 0 [outer=(18), constraints=(/18: [/0 - /0]; tight), fd=()-->(18)]
      └── projections
           └── ni_dts:13 + '1 day' [as=ni_dts_new:20, outer=(13), immutable]

# Q16
opt
UPDATE security
   SET s_exch_date = s_exch_date + INTEGER '1'
 WHERE s_symb = 'SYMB'
----
update security
 ├── columns: <none>
 ├── fetch columns: s_symb:18 s_issue:19 s_st_id:20 s_name:21 s_ex_id:22 s_co_id:23 s_num_out:24 s_start_date:25 s_exch_date:26 s_pe:27 s_52wk_high:28 s_52wk_high_date:29 s_52wk_low:30 s_52wk_low_date:31 s_dividend:32 s_yield:33
 ├── update-mapping:
 │    └── s_exch_date_new:35 => s_exch_date:9
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── project
      ├── columns: s_exch_date_new:35!null s_symb:18!null s_issue:19!null s_st_id:20!null s_name:21!null s_ex_id:22!null s_co_id:23!null s_num_out:24!null s_start_date:25!null s_exch_date:26!null s_pe:27!null s_52wk_high:28!null s_52wk_high_date:29!null s_52wk_low:30!null s_52wk_low_date:31!null s_dividend:32!null s_yield:33!null
      ├── cardinality: [0 - 1]
      ├── immutable
      ├── key: ()
      ├── fd: ()-->(18-33,35)
      ├── scan security
      │    ├── columns: s_symb:18!null s_issue:19!null s_st_id:20!null s_name:21!null s_ex_id:22!null s_co_id:23!null s_num_out:24!null s_start_date:25!null s_exch_date:26!null s_pe:27!null s_52wk_high:28!null s_52wk_high_date:29!null s_52wk_low:30!null s_52wk_low_date:31!null s_dividend:32!null s_yield:33!null
      │    ├── constraint: /18: [/'SYMB' - /'SYMB']
      │    ├── cardinality: [0 - 1]
      │    ├── key: ()
      │    └── fd: ()-->(18-33)
      └── projections
           └── s_exch_date:26 + 1 [as=s_exch_date_new:35, outer=(26), immutable]

# Q17
opt
UPDATE
  taxrate
SET
  tx_name = IF (
      (
        SELECT tx_name
        FROM taxrate
        WHERE tx_id = 'US12'
      ) LIKE '% Tax %',
      replace(tx_name, ' TAX ', ' tax '),
      replace(tx_name, ' tax ', ' Tax ')
  )
WHERE tx_id = 'US12'
----
update taxrate
 ├── columns: <none>
 ├── fetch columns: tx_id:5 tx_name:6 tx_rate:7
 ├── update-mapping:
 │    └── tx_name_new:13 => tx_name:2
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── project
      ├── columns: tx_name_new:13 tx_id:5!null tx_name:6!null tx_rate:7!null
      ├── cardinality: [0 - 1]
      ├── immutable
      ├── key: ()
      ├── fd: ()-->(5-7,13)
      ├── scan taxrate
      │    ├── columns: tx_id:5!null tx_name:6!null tx_rate:7!null
      │    ├── constraint: /5: [/'US12' - /'US12']
      │    ├── cardinality: [0 - 1]
      │    ├── key: ()
      │    └── fd: ()-->(5-7)
      └── projections
           └── case [as=tx_name_new:13, outer=(6), immutable, subquery]
                ├── like
                │    ├── subquery
                │    │    └── project
                │    │         ├── columns: tx_name:10!null
                │    │         ├── cardinality: [0 - 1]
                │    │         ├── key: ()
                │    │         ├── fd: ()-->(10)
                │    │         └── scan taxrate
                │    │              ├── columns: tx_id:9!null tx_name:10!null
                │    │              ├── constraint: /9: [/'US12' - /'US12']
                │    │              ├── cardinality: [0 - 1]
                │    │              ├── key: ()
                │    │              └── fd: ()-->(9,10)
                │    └── '% Tax %'
                ├── when
                │    ├── true
                │    └── replace(tx_name:6, ' TAX ', ' tax ')
                └── replace(tx_name:6, ' tax ', ' Tax ')

# Q18
opt
SELECT wi_s_symb
FROM (
  SELECT ORDINALITY AS rownum, wi_s_symb
  FROM watch_item, watch_list
  WITH ORDINALITY
  WHERE wl_c_id = 0 and wi_wl_id = wl_id
  ORDER BY wi_s_symb asc
)
WHERE rownum = (
     SELECT count(*)
     FROM watch_item, watch_list
     WHERE wl_c_id = 0 AND wi_wl_id = wl_id
)
----
project
 ├── columns: wi_s_symb:2!null
 └── inner-join (lookup watch_item)
      ├── columns: wi_wl_id:1!null wi_s_symb:2!null wl_id:4!null wl_c_id:5!null ordinality:7!null
      ├── key columns: [4] = [1]
      ├── key: (2,4)
      ├── fd: ()-->(5), (4)-->(7), (7)-->(4), (1)==(4), (4)==(1)
      ├── select
      │    ├── columns: wl_id:4!null wl_c_id:5!null ordinality:7!null
      │    ├── key: (4)
      │    ├── fd: ()-->(5), (4)-->(7), (7)-->(4)
      │    ├── ordinality
      │    │    ├── columns: wl_id:4!null wl_c_id:5!null ordinality:7!null
      │    │    ├── key: (4)
      │    │    ├── fd: (4)-->(5,7), (7)-->(4,5)
      │    │    └── scan watch_list
      │    │         ├── columns: wl_id:4!null wl_c_id:5!null
      │    │         ├── key: (4)
      │    │         └── fd: (4)-->(5)
      │    └── filters
      │         ├── wl_c_id:5 = 0 [outer=(5), constraints=(/5: [/0 - /0]; tight), fd=()-->(5)]
      │         └── eq [outer=(7), subquery, constraints=(/7: (/NULL - ])]
      │              ├── ordinality:7
      │              └── subquery
      │                   └── scalar-group-by
      │                        ├── columns: count_rows:14!null
      │                        ├── cardinality: [1 - 1]
      │                        ├── key: ()
      │                        ├── fd: ()-->(14)
      │                        ├── inner-join (lookup watch_item)
      │                        │    ├── columns: wi_wl_id:8!null wl_id:11!null wl_c_id:12!null
      │                        │    ├── key columns: [11] = [8]
      │                        │    ├── fd: ()-->(12), (8)==(11), (11)==(8)
      │                        │    ├── select
      │                        │    │    ├── columns: wl_id:11!null wl_c_id:12!null
      │                        │    │    ├── key: (11)
      │                        │    │    ├── fd: ()-->(12)
      │                        │    │    ├── scan watch_list
      │                        │    │    │    ├── columns: wl_id:11!null wl_c_id:12!null
      │                        │    │    │    ├── key: (11)
      │                        │    │    │    └── fd: (11)-->(12)
      │                        │    │    └── filters
      │                        │    │         └── wl_c_id:12 = 0 [outer=(12), constraints=(/12: [/0 - /0]; tight), fd=()-->(12)]
      │                        │    └── filters (true)
      │                        └── aggregations
      │                             └── count-rows [as=count_rows:14]
      └── filters (true)

# Q19
opt
SELECT s_symb
FROM security
WHERE
  s_symb > 'SYMB' AND
  s_symb NOT IN (
       SELECT wi_s_symb
       FROM watch_item, watch_list
       WHERE wl_c_id = 0 AND wi_wl_id = wl_id
  )
ORDER BY s_symb ASC
LIMIT 1
----
limit
 ├── columns: s_symb:1!null
 ├── internal-ordering: +1
 ├── cardinality: [0 - 1]
 ├── key: ()
 ├── fd: ()-->(1)
 ├── anti-join (merge)
 │    ├── columns: s_symb:1!null
 │    ├── left ordering: +1
 │    ├── right ordering: +19
 │    ├── key: (1)
 │    ├── ordering: +1
 │    ├── limit hint: 1.00
 │    ├── scan security
 │    │    ├── columns: s_symb:1!null
 │    │    ├── constraint: /1: [/e'SYMB\x00' - ]
 │    │    ├── key: (1)
 │    │    └── ordering: +1
 │    ├── sort
 │    │    ├── columns: wi_wl_id:18!null wi_s_symb:19!null wl_id:21!null wl_c_id:22!null
 │    │    ├── key: (19,21)
 │    │    ├── fd: ()-->(22), (18)==(21), (21)==(18)
 │    │    ├── ordering: +19 opt(22) [actual: +19]
 │    │    └── inner-join (lookup watch_item)
 │    │         ├── columns: wi_wl_id:18!null wi_s_symb:19!null wl_id:21!null wl_c_id:22!null
 │    │         ├── key columns: [21] = [18]
 │    │         ├── key: (19,21)
 │    │         ├── fd: ()-->(22), (18)==(21), (21)==(18)
 │    │         ├── select
 │    │         │    ├── columns: wl_id:21!null wl_c_id:22!null
 │    │         │    ├── key: (21)
 │    │         │    ├── fd: ()-->(22)
 │    │         │    ├── scan watch_list
 │    │         │    │    ├── columns: wl_id:21!null wl_c_id:22!null
 │    │         │    │    ├── key: (21)
 │    │         │    │    └── fd: (21)-->(22)
 │    │         │    └── filters
 │    │         │         └── wl_c_id:22 = 0 [outer=(22), constraints=(/22: [/0 - /0]; tight), fd=()-->(22)]
 │    │         └── filters
 │    │              └── wi_s_symb:19 > 'SYMB' [outer=(19), constraints=(/19: [/e'SYMB\x00' - ]; tight)]
 │    └── filters (true)
 └── 1

# Q20
opt
UPDATE watch_item
   SET wi_s_symb = 'SYMB'
  FROM watch_list
 WHERE wl_c_id = 0 and wi_wl_id = wl_id and wi_s_symb = 'SYMB'
----
update watch_item
 ├── columns: <none>
 ├── fetch columns: wi_wl_id:4 watch_item.wi_s_symb:5
 ├── update-mapping:
 │    └── wi_s_symb_new:10 => watch_item.wi_s_symb:2
 ├── input binding: &1
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 ├── project
 │    ├── columns: wi_s_symb_new:10!null wi_wl_id:4!null watch_item.wi_s_symb:5!null wl_id:7!null wl_c_id:8!null watch_list.crdb_internal_mvcc_timestamp:9
 │    ├── key: (7)
 │    ├── fd: ()-->(5,8,10), (7)-->(9), (4)==(7), (7)==(4)
 │    ├── inner-join (lookup watch_item)
 │    │    ├── columns: wi_wl_id:4!null watch_item.wi_s_symb:5!null wl_id:7!null wl_c_id:8!null watch_list.crdb_internal_mvcc_timestamp:9
 │    │    ├── key columns: [7 29] = [4 5]
 │    │    ├── lookup columns are key
 │    │    ├── key: (7)
 │    │    ├── fd: ()-->(5,8), (7)-->(9), (4)==(7), (7)==(4)
 │    │    ├── project
 │    │    │    ├── columns: "lookup_join_const_col_@5":29!null wl_id:7!null wl_c_id:8!null watch_list.crdb_internal_mvcc_timestamp:9
 │    │    │    ├── key: (7)
 │    │    │    ├── fd: ()-->(8,29), (7)-->(9)
 │    │    │    ├── select
 │    │    │    │    ├── columns: wl_id:7!null wl_c_id:8!null watch_list.crdb_internal_mvcc_timestamp:9
 │    │    │    │    ├── key: (7)
 │    │    │    │    ├── fd: ()-->(8), (7)-->(9)
 │    │    │    │    ├── scan watch_list
 │    │    │    │    │    ├── columns: wl_id:7!null wl_c_id:8!null watch_list.crdb_internal_mvcc_timestamp:9
 │    │    │    │    │    ├── key: (7)
 │    │    │    │    │    └── fd: (7)-->(8,9)
 │    │    │    │    └── filters
 │    │    │    │         └── wl_c_id:8 = 0 [outer=(8), constraints=(/8: [/0 - /0]; tight), fd=()-->(8)]
 │    │    │    └── projections
 │    │    │         └── 'SYMB' [as="lookup_join_const_col_@5":29]
 │    │    └── filters (true)
 │    └── projections
 │         └── 'SYMB' [as=wi_s_symb_new:10]
 └── f-k-checks
      └── f-k-checks-item: watch_item(wi_s_symb) -> security(s_symb)
           └── anti-join (lookup security)
                ├── columns: wi_s_symb:11!null
                ├── key columns: [11] = [12]
                ├── lookup columns are key
                ├── fd: ()-->(11)
                ├── with-scan &1
                │    ├── columns: wi_s_symb:11!null
                │    ├── mapping:
                │    │    └──  wi_s_symb_new:10 => wi_s_symb:11
                │    └── fd: ()-->(11)
                └── filters (true)

# --------------------------------------------------
# T12
# Trade-Cleanup
# Cancel any pending or submitted trades from the database.
# --------------------------------------------------

# Q1
opt
SELECT tr_t_id FROM trade_request ORDER BY tr_t_id
----
scan trade_request
 ├── columns: tr_t_id:1!null
 ├── check constraint expressions
 │    ├── tr_qty:4 > 0 [outer=(4), constraints=(/4: [/1 - ]; tight)]
 │    └── tr_bid_price:5 > 0 [outer=(5), immutable, constraints=(/5: (/0 - ]; tight)]
 ├── key: (1)
 └── ordering: +1

# Q2
opt
INSERT INTO trade_history (th_t_id, th_dts, th_st_id)
VALUES (0, '2020-06-17 22:27:42.148484+00:00'::TIMESTAMP, 'SBMT')
----
insert trade_history
 ├── columns: <none>
 ├── insert-mapping:
 │    ├── column1:5 => trade_history.th_t_id:1
 │    ├── column2:6 => th_dts:2
 │    └── column3:7 => trade_history.th_st_id:3
 ├── input binding: &1
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 ├── values
 │    ├── columns: column1:5!null column2:6!null column3:7!null
 │    ├── cardinality: [1 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(5-7)
 │    └── (0, '2020-06-17 22:27:42.148484', 'SBMT')
 └── f-k-checks
      ├── f-k-checks-item: trade_history(th_t_id) -> trade(t_id)
      │    └── anti-join (lookup trade)
      │         ├── columns: th_t_id:8!null
      │         ├── key columns: [8] = [9]
      │         ├── lookup columns are key
      │         ├── cardinality: [0 - 1]
      │         ├── key: ()
      │         ├── fd: ()-->(8)
      │         ├── with-scan &1
      │         │    ├── columns: th_t_id:8!null
      │         │    ├── mapping:
      │         │    │    └──  column1:5 => th_t_id:8
      │         │    ├── cardinality: [1 - 1]
      │         │    ├── key: ()
      │         │    └── fd: ()-->(8)
      │         └── filters (true)
      └── f-k-checks-item: trade_history(th_st_id) -> status_type(st_id)
           └── anti-join (lookup status_type)
                ├── columns: th_st_id:25!null
                ├── key columns: [25] = [26]
                ├── lookup columns are key
                ├── cardinality: [0 - 1]
                ├── key: ()
                ├── fd: ()-->(25)
                ├── with-scan &1
                │    ├── columns: th_st_id:25!null
                │    ├── mapping:
                │    │    └──  column3:7 => th_st_id:25
                │    ├── cardinality: [1 - 1]
                │    ├── key: ()
                │    └── fd: ()-->(25)
                └── filters (true)

# Q3
opt
UPDATE trade
SET t_st_id = 'SBMT', t_dts = '2020-06-17 22:27:42.148484+00:00'::TIMESTAMP
WHERE t_id = 0
----
update trade
 ├── columns: <none>
 ├── fetch columns: t_id:17 t_dts:18 trade.t_st_id:19 t_tt_id:20 t_is_cash:21 t_s_symb:22 t_qty:23 t_bid_price:24 t_ca_id:25 t_exec_name:26 t_trade_price:27 t_chrg:28 t_comm:29 t_tax:30 t_lifo:31
 ├── update-mapping:
 │    ├── t_dts_new:34 => t_dts:2
 │    └── t_st_id_new:33 => trade.t_st_id:3
 ├── input binding: &1
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 ├── project
 │    ├── columns: t_st_id_new:33!null t_dts_new:34!null t_id:17!null t_dts:18!null trade.t_st_id:19!null t_tt_id:20!null t_is_cash:21!null t_s_symb:22!null t_qty:23!null t_bid_price:24 t_ca_id:25!null t_exec_name:26!null t_trade_price:27 t_chrg:28!null t_comm:29!null t_tax:30!null t_lifo:31!null
 │    ├── cardinality: [0 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(17-31,33,34)
 │    ├── scan trade
 │    │    ├── columns: t_id:17!null t_dts:18!null trade.t_st_id:19!null t_tt_id:20!null t_is_cash:21!null t_s_symb:22!null t_qty:23!null t_bid_price:24 t_ca_id:25!null t_exec_name:26!null t_trade_price:27 t_chrg:28!null t_comm:29!null t_tax:30!null t_lifo:31!null
 │    │    ├── constraint: /17: [/0 - /0]
 │    │    ├── cardinality: [0 - 1]
 │    │    ├── key: ()
 │    │    └── fd: ()-->(17-31)
 │    └── projections
 │         ├── 'SBMT' [as=t_st_id_new:33]
 │         └── '2020-06-17 22:27:42.148484' [as=t_dts_new:34]
 └── f-k-checks
      └── f-k-checks-item: trade(t_st_id) -> status_type(st_id)
           └── anti-join (lookup status_type)
                ├── columns: t_st_id:40!null
                ├── key columns: [40] = [41]
                ├── lookup columns are key
                ├── cardinality: [0 - 1]
                ├── key: ()
                ├── fd: ()-->(40)
                ├── with-scan &1
                │    ├── columns: t_st_id:40!null
                │    ├── mapping:
                │    │    └──  t_st_id_new:33 => t_st_id:40
                │    ├── cardinality: [0 - 1]
                │    ├── key: ()
                │    └── fd: ()-->(40)
                └── filters (true)

# Q4
opt
DELETE FROM trade_request WHERE true
----
delete trade_request
 ├── columns: <none>
 ├── fetch columns: tr_t_id:8 tr_s_symb:10 tr_b_id:13
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 └── scan trade_request@secondary
      ├── columns: tr_t_id:8!null tr_s_symb:10!null tr_b_id:13!null
      ├── key: (8)
      └── fd: (8)-->(10,13)

# Q5
opt
SELECT t_id FROM trade WHERE t_id > 0 AND t_st_id = 'SBMT'
----
project
 ├── columns: t_id:1!null
 ├── key: (1)
 └── select
      ├── columns: t_id:1!null t_st_id:3!null
      ├── key: (1)
      ├── fd: ()-->(3)
      ├── scan trade@secondary
      │    ├── columns: t_id:1!null t_st_id:3!null
      │    ├── key: (1)
      │    └── fd: (1)-->(3)
      └── filters
           ├── t_id:1 > 0 [outer=(1), constraints=(/1: [/1 - ]; tight)]
           └── t_st_id:3 = 'SBMT' [outer=(3), constraints=(/3: [/'SBMT' - /'SBMT']; tight), fd=()-->(3)]

# Q6
opt
UPDATE trade
SET t_st_id = 'CNCL', t_dts = '2020-06-17 22:27:42.148484+00:00'::TIMESTAMP
WHERE t_id = 0
----
update trade
 ├── columns: <none>
 ├── fetch columns: t_id:17 t_dts:18 trade.t_st_id:19 t_tt_id:20 t_is_cash:21 t_s_symb:22 t_qty:23 t_bid_price:24 t_ca_id:25 t_exec_name:26 t_trade_price:27 t_chrg:28 t_comm:29 t_tax:30 t_lifo:31
 ├── update-mapping:
 │    ├── t_dts_new:34 => t_dts:2
 │    └── t_st_id_new:33 => trade.t_st_id:3
 ├── input binding: &1
 ├── cardinality: [0 - 0]
 ├── volatile, mutations
 ├── project
 │    ├── columns: t_st_id_new:33!null t_dts_new:34!null t_id:17!null t_dts:18!null trade.t_st_id:19!null t_tt_id:20!null t_is_cash:21!null t_s_symb:22!null t_qty:23!null t_bid_price:24 t_ca_id:25!null t_exec_name:26!null t_trade_price:27 t_chrg:28!null t_comm:29!null t_tax:30!null t_lifo:31!null
 │    ├── cardinality: [0 - 1]
 │    ├── key: ()
 │    ├── fd: ()-->(17-31,33,34)
 │    ├── scan trade
 │    │    ├── columns: t_id:17!null t_dts:18!null trade.t_st_id:19!null t_tt_id:20!null t_is_cash:21!null t_s_symb:22!null t_qty:23!null t_bid_price:24 t_ca_id:25!null t_exec_name:26!null t_trade_price:27 t_chrg:28!null t_comm:29!null t_tax:30!null t_lifo:31!null
 │    │    ├── constraint: /17: [/0 - /0]
 │    │    ├── cardinality: [0 - 1]
 │    │    ├── key: ()
 │    │    └── fd: ()-->(17-31)
 │    └── projections
 │         ├── 'CNCL' [as=t_st_id_new:33]
 │         └── '2020-06-17 22:27:42.148484' [as=t_dts_new:34]
 └── f-k-checks
      └── f-k-checks-item: trade(t_st_id) -> status_type(st_id)
           └── anti-join (lookup status_type)
                ├── columns: t_st_id:40!null
                ├── key columns: [40] = [41]
                ├── lookup columns are key
                ├── cardinality: [0 - 1]
                ├── key: ()
                ├── fd: ()-->(40)
                ├── with-scan &1
                │    ├── columns: t_st_id:40!null
                │    ├── mapping:
                │    │    └──  t_st_id_new:33 => t_st_id:40
                │    ├── cardinality: [0 - 1]
                │    ├── key: ()
                │    └── fd: ()-->(40)
                └── filters (true)
