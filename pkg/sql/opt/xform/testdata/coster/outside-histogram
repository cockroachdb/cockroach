# This file contains tests for queries that filter columns beyond the max/min
# values in their histograms. Each query is tested multiple times with different
# settings to show the effect those settings have on the plan.
#

exec-ddl
CREATE TABLE t (
  k INT PRIMARY KEY,
  i INT,
  s STRING,
  INDEX (i),
  INDEX (s)
)
----

exec-ddl
ALTER TABLE t INJECT STATISTICS '[
  {
    "columns": ["k"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 1000,
    "distinct_count": 1000,
    "null_count": 0,
    "avg_size": 2,
    "histo_col_type": "int",
    "histo_buckets": [
      {"num_eq": 0, "num_range": 0, "distinct_range": 0, "upper_bound": "0"},
      {"num_eq": 1, "num_range": 99, "distinct_range": 99, "upper_bound": "100"},
      {"num_eq": 1, "num_range": 199, "distinct_range": 199, "upper_bound": "200"},
      {"num_eq": 1, "num_range": 299, "distinct_range": 299, "upper_bound": "300"},
      {"num_eq": 1, "num_range": 399, "distinct_range": 399, "upper_bound": "400"}
    ]
  },
  {
    "columns": ["i"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 1000,
    "distinct_count": 44,
    "null_count": 0,
    "avg_size": 2,
    "histo_col_type": "int",
    "histo_buckets": [
      {"num_eq": 0, "num_range": 0, "distinct_range": 0, "upper_bound": "0"},
      {"num_eq": 10, "num_range": 90, "distinct_range": 10, "upper_bound": "100"},
      {"num_eq": 10, "num_range": 190, "distinct_range": 10, "upper_bound": "200"},
      {"num_eq": 20, "num_range": 280, "distinct_range": 10, "upper_bound": "300"},
      {"num_eq": 30, "num_range": 370, "distinct_range": 10, "upper_bound": "400"}
    ]
  },
  {
    "columns": ["s"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 1000,
    "distinct_count": 40,
    "null_count": 0,
    "avg_size": 3,
    "histo_col_type": "string",
    "histo_buckets": [
      {"num_eq": 0, "num_range": 0, "distinct_range": 0, "upper_bound": "apple"},
      {"num_eq": 100, "num_range": 100, "distinct_range": 10, "upper_bound": "banana"},
      {"num_eq": 100, "num_range": 100, "distinct_range": 10, "upper_bound": "cherry"},
      {"num_eq": 200, "num_range": 100, "distinct_range": 10, "upper_bound": "mango"},
      {"num_eq": 200, "num_range": 100, "distinct_range": 10, "upper_bound": "pineapple"}
    ]
  }
]'
----

# --------------------------------------------------
# Q1
# --------------------------------------------------

opt set=(optimizer_prefer_bounded_cardinality=false,optimizer_min_row_count=0)
SELECT * FROM t WHERE k IN (110, 120, 130, 140) AND i = 500
----
select
 ├── columns: k:1!null i:2!null s:3
 ├── cardinality: [0 - 4]
 ├── stats: [rows=0.0909092, distinct(1)=0.0909092, null(1)=0, distinct(2)=0.0909092, null(2)=0, distinct(1,2)=0.0909092, null(1,2)=0]
 │   histogram(1)=  0 0.022727 0 0.022727 0 0.022727 0 0.022727
 │                <---- 110 ------ 120 ------ 130 ------ 140 --
 │   histogram(2)=
 ├── cost: 24.21
 ├── key: (1)
 ├── fd: ()-->(2), (1)-->(3)
 ├── scan t
 │    ├── columns: k:1!null i:2 s:3
 │    ├── constraint: /1
 │    │    ├── [/110 - /110]
 │    │    ├── [/120 - /120]
 │    │    ├── [/130 - /130]
 │    │    └── [/140 - /140]
 │    ├── cardinality: [0 - 4]
 │    ├── stats: [rows=4, distinct(1)=4, null(1)=0]
 │    │   histogram(1)=  0   1   0   1   0   1   0   1
 │    │                <--- 110 --- 120 --- 130 --- 140
 │    ├── cost: 24.15
 │    ├── key: (1)
 │    └── fd: (1)-->(2,3)
 └── filters
      └── i:2 = 500 [outer=(2), constraints=(/2: [/500 - /500]; tight), fd=()-->(2)]

opt set=(optimizer_prefer_bounded_cardinality=true,optimizer_min_row_count=0)
SELECT * FROM t WHERE k IN (110, 120, 130, 140) AND i = 500
----
select
 ├── columns: k:1!null i:2!null s:3
 ├── cardinality: [0 - 4]
 ├── stats: [rows=0.0909092, distinct(1)=0.0909092, null(1)=0, distinct(2)=0.0909092, null(2)=0, distinct(1,2)=0.0909092, null(1,2)=0]
 │   histogram(1)=  0 0.022727 0 0.022727 0 0.022727 0 0.022727
 │                <---- 110 ------ 120 ------ 130 ------ 140 --
 │   histogram(2)=
 ├── cost: 24.21
 ├── key: (1)
 ├── fd: ()-->(2), (1)-->(3)
 ├── scan t
 │    ├── columns: k:1!null i:2 s:3
 │    ├── constraint: /1
 │    │    ├── [/110 - /110]
 │    │    ├── [/120 - /120]
 │    │    ├── [/130 - /130]
 │    │    └── [/140 - /140]
 │    ├── cardinality: [0 - 4]
 │    ├── stats: [rows=4, distinct(1)=4, null(1)=0]
 │    │   histogram(1)=  0   1   0   1   0   1   0   1
 │    │                <--- 110 --- 120 --- 130 --- 140
 │    ├── cost: 24.15
 │    ├── key: (1)
 │    └── fd: (1)-->(2,3)
 └── filters
      └── i:2 = 500 [outer=(2), constraints=(/2: [/500 - /500]; tight), fd=()-->(2)]

opt set=(optimizer_prefer_bounded_cardinality=false,optimizer_min_row_count=1)
SELECT * FROM t WHERE k IN (110, 120, 130, 140) AND i = 500
----
select
 ├── columns: k:1!null i:2!null s:3
 ├── cardinality: [0 - 4]
 ├── stats: [rows=1, distinct(1)=1, null(1)=0, distinct(2)=1, null(2)=0, distinct(1,2)=1, null(1,2)=0]
 │   histogram(1)=  0 0.25  0 0.25  0 0.25  0 0.25
 │                <--- 110 --- 120 --- 130 --- 140
 │   histogram(2)=
 ├── cost: 24.21
 ├── key: (1)
 ├── fd: ()-->(2), (1)-->(3)
 ├── scan t
 │    ├── columns: k:1!null i:2 s:3
 │    ├── constraint: /1
 │    │    ├── [/110 - /110]
 │    │    ├── [/120 - /120]
 │    │    ├── [/130 - /130]
 │    │    └── [/140 - /140]
 │    ├── cardinality: [0 - 4]
 │    ├── stats: [rows=4, distinct(1)=4, null(1)=0]
 │    │   histogram(1)=  0   1   0   1   0   1   0   1
 │    │                <--- 110 --- 120 --- 130 --- 140
 │    ├── cost: 24.15
 │    ├── key: (1)
 │    └── fd: (1)-->(2,3)
 └── filters
      └── i:2 = 500 [outer=(2), constraints=(/2: [/500 - /500]; tight), fd=()-->(2)]

# --------------------------------------------------
# Q2
# --------------------------------------------------

opt set=(optimizer_prefer_bounded_cardinality=false,optimizer_min_row_count=0)
SELECT * FROM t WHERE k IN (100, 110, 120, 130) AND i > 500
----
select
 ├── columns: k:1!null i:2!null s:3
 ├── cardinality: [0 - 4]
 ├── stats: [rows=0.0909092, distinct(1)=0.0909092, null(1)=0, distinct(2)=0.0909092, null(2)=0, distinct(1,2)=0.0909092, null(1,2)=0]
 │   histogram(1)=  0 0.022727 0 0.022727 0 0.022727 0 0.022727
 │                <---- 100 ------ 110 ------ 120 ------ 130 --
 │   histogram(2)=
 ├── cost: 24.21
 ├── key: (1)
 ├── fd: (1)-->(2,3)
 ├── scan t
 │    ├── columns: k:1!null i:2 s:3
 │    ├── constraint: /1
 │    │    ├── [/100 - /100]
 │    │    ├── [/110 - /110]
 │    │    ├── [/120 - /120]
 │    │    └── [/130 - /130]
 │    ├── cardinality: [0 - 4]
 │    ├── stats: [rows=4, distinct(1)=4, null(1)=0]
 │    │   histogram(1)=  0   1   0   1   0   1   0   1
 │    │                <--- 100 --- 110 --- 120 --- 130
 │    ├── cost: 24.15
 │    ├── key: (1)
 │    └── fd: (1)-->(2,3)
 └── filters
      └── i:2 > 500 [outer=(2), constraints=(/2: [/501 - ]; tight)]

opt set=(optimizer_prefer_bounded_cardinality=true,optimizer_min_row_count=0)
SELECT * FROM t WHERE k IN (100, 110, 120, 130) AND i > 500
----
select
 ├── columns: k:1!null i:2!null s:3
 ├── cardinality: [0 - 4]
 ├── stats: [rows=0.0909092, distinct(1)=0.0909092, null(1)=0, distinct(2)=0.0909092, null(2)=0, distinct(1,2)=0.0909092, null(1,2)=0]
 │   histogram(1)=  0 0.022727 0 0.022727 0 0.022727 0 0.022727
 │                <---- 100 ------ 110 ------ 120 ------ 130 --
 │   histogram(2)=
 ├── cost: 24.21
 ├── key: (1)
 ├── fd: (1)-->(2,3)
 ├── scan t
 │    ├── columns: k:1!null i:2 s:3
 │    ├── constraint: /1
 │    │    ├── [/100 - /100]
 │    │    ├── [/110 - /110]
 │    │    ├── [/120 - /120]
 │    │    └── [/130 - /130]
 │    ├── cardinality: [0 - 4]
 │    ├── stats: [rows=4, distinct(1)=4, null(1)=0]
 │    │   histogram(1)=  0   1   0   1   0   1   0   1
 │    │                <--- 100 --- 110 --- 120 --- 130
 │    ├── cost: 24.15
 │    ├── key: (1)
 │    └── fd: (1)-->(2,3)
 └── filters
      └── i:2 > 500 [outer=(2), constraints=(/2: [/501 - ]; tight)]

opt set=(optimizer_prefer_bounded_cardinality=false,optimizer_min_row_count=1)
SELECT * FROM t WHERE k IN (100, 110, 120, 130) AND i > 500
----
select
 ├── columns: k:1!null i:2!null s:3
 ├── cardinality: [0 - 4]
 ├── stats: [rows=1, distinct(1)=1, null(1)=0, distinct(2)=1, null(2)=0, distinct(1,2)=1, null(1,2)=0]
 │   histogram(1)=  0 0.25  0 0.25  0 0.25  0 0.25
 │                <--- 100 --- 110 --- 120 --- 130
 │   histogram(2)=
 ├── cost: 24.21
 ├── key: (1)
 ├── fd: (1)-->(2,3)
 ├── scan t
 │    ├── columns: k:1!null i:2 s:3
 │    ├── constraint: /1
 │    │    ├── [/100 - /100]
 │    │    ├── [/110 - /110]
 │    │    ├── [/120 - /120]
 │    │    └── [/130 - /130]
 │    ├── cardinality: [0 - 4]
 │    ├── stats: [rows=4, distinct(1)=4, null(1)=0]
 │    │   histogram(1)=  0   1   0   1   0   1   0   1
 │    │                <--- 100 --- 110 --- 120 --- 130
 │    ├── cost: 24.15
 │    ├── key: (1)
 │    └── fd: (1)-->(2,3)
 └── filters
      └── i:2 > 500 [outer=(2), constraints=(/2: [/501 - ]; tight)]

# --------------------------------------------------
# Q3
# --------------------------------------------------

opt set=(optimizer_prefer_bounded_cardinality=false,optimizer_min_row_count=0)
SELECT * FROM t WHERE k IN (410, 420, 430) AND i > 500
----
select
 ├── columns: k:1!null i:2!null s:3
 ├── cardinality: [0 - 3]
 ├── stats: [rows=0.0227274, distinct(1)=0.0227274, null(1)=0, distinct(2)=0.0227274, null(2)=0]
 │   histogram(1)=
 │   histogram(2)=
 ├── cost: 19.075
 ├── key: (1)
 ├── fd: (1)-->(2,3)
 ├── scan t
 │    ├── columns: k:1!null i:2 s:3
 │    ├── constraint: /1
 │    │    ├── [/410 - /410]
 │    │    ├── [/420 - /420]
 │    │    └── [/430 - /430]
 │    ├── cardinality: [0 - 3]
 │    ├── stats: [rows=1, distinct(1)=1, null(1)=0]
 │    │   histogram(1)=
 │    ├── cost: 19.045
 │    ├── key: (1)
 │    └── fd: (1)-->(2,3)
 └── filters
      └── i:2 > 500 [outer=(2), constraints=(/2: [/501 - ]; tight)]

opt set=(optimizer_prefer_bounded_cardinality=true,optimizer_min_row_count=0)
SELECT * FROM t WHERE k IN (410, 420, 430) AND i > 500
----
select
 ├── columns: k:1!null i:2!null s:3
 ├── cardinality: [0 - 3]
 ├── stats: [rows=0.0227274, distinct(1)=0.0227274, null(1)=0, distinct(2)=0.0227274, null(2)=0]
 │   histogram(1)=
 │   histogram(2)=
 ├── cost: 19.075
 ├── key: (1)
 ├── fd: (1)-->(2,3)
 ├── scan t
 │    ├── columns: k:1!null i:2 s:3
 │    ├── constraint: /1
 │    │    ├── [/410 - /410]
 │    │    ├── [/420 - /420]
 │    │    └── [/430 - /430]
 │    ├── cardinality: [0 - 3]
 │    ├── stats: [rows=1, distinct(1)=1, null(1)=0]
 │    │   histogram(1)=
 │    ├── cost: 19.045
 │    ├── key: (1)
 │    └── fd: (1)-->(2,3)
 └── filters
      └── i:2 > 500 [outer=(2), constraints=(/2: [/501 - ]; tight)]

opt set=(optimizer_prefer_bounded_cardinality=false,optimizer_min_row_count=1)
SELECT * FROM t WHERE k IN (410, 420, 430) AND i > 500
----
select
 ├── columns: k:1!null i:2!null s:3
 ├── cardinality: [0 - 3]
 ├── stats: [rows=1, distinct(1)=1, null(1)=0, distinct(2)=1, null(2)=0]
 │   histogram(1)=
 │   histogram(2)=
 ├── cost: 19.075
 ├── key: (1)
 ├── fd: (1)-->(2,3)
 ├── scan t
 │    ├── columns: k:1!null i:2 s:3
 │    ├── constraint: /1
 │    │    ├── [/410 - /410]
 │    │    ├── [/420 - /420]
 │    │    └── [/430 - /430]
 │    ├── cardinality: [0 - 3]
 │    ├── stats: [rows=1, distinct(1)=1, null(1)=0]
 │    │   histogram(1)=
 │    ├── cost: 19.045
 │    ├── key: (1)
 │    └── fd: (1)-->(2,3)
 └── filters
      └── i:2 > 500 [outer=(2), constraints=(/2: [/501 - ]; tight)]

# --------------------------------------------------
# Q4
# --------------------------------------------------

opt set=(optimizer_prefer_bounded_cardinality=false,optimizer_min_row_count=0)
SELECT * FROM t WHERE k IN (100, 110, 120, 130) AND i = 400 AND s < 'apple'
----
select
 ├── columns: k:1!null i:2!null s:3!null
 ├── cardinality: [0 - 4]
 ├── stats: [rows=0.0030001, distinct(1)=0.0030001, null(1)=0, distinct(2)=0.0030001, null(2)=0, distinct(3)=0.0030001, null(3)=0, distinct(2,3)=0.0030001, null(2,3)=0, distinct(1-3)=0.0030001, null(1-3)=0]
 │   histogram(1)=  0 0.00075002 0 0.00075002 0 0.00075002 0 0.00075002
 │                <----- 100 -------- 110 -------- 120 -------- 130 ---
 │   histogram(2)=  0 0.0030001
 │                <----- 400 --
 │   histogram(3)=
 ├── cost: 24.22
 ├── key: (1)
 ├── fd: ()-->(2), (1)-->(3)
 ├── scan t
 │    ├── columns: k:1!null i:2 s:3
 │    ├── constraint: /1
 │    │    ├── [/100 - /100]
 │    │    ├── [/110 - /110]
 │    │    ├── [/120 - /120]
 │    │    └── [/130 - /130]
 │    ├── cardinality: [0 - 4]
 │    ├── stats: [rows=4, distinct(1)=4, null(1)=0]
 │    │   histogram(1)=  0   1   0   1   0   1   0   1
 │    │                <--- 100 --- 110 --- 120 --- 130
 │    ├── cost: 24.15
 │    ├── key: (1)
 │    └── fd: (1)-->(2,3)
 └── filters
      ├── i:2 = 400 [outer=(2), constraints=(/2: [/400 - /400]; tight), fd=()-->(2)]
      └── s:3 < 'apple' [outer=(3), constraints=(/3: (/NULL - /'apple'); tight)]

opt set=(optimizer_prefer_bounded_cardinality=true,optimizer_min_row_count=0)
SELECT * FROM t WHERE k IN (100, 110, 120, 130) AND i = 400 AND s < 'apple'
----
select
 ├── columns: k:1!null i:2!null s:3!null
 ├── cardinality: [0 - 4]
 ├── stats: [rows=0.0030001, distinct(1)=0.0030001, null(1)=0, distinct(2)=0.0030001, null(2)=0, distinct(3)=0.0030001, null(3)=0, distinct(2,3)=0.0030001, null(2,3)=0, distinct(1-3)=0.0030001, null(1-3)=0]
 │   histogram(1)=  0 0.00075002 0 0.00075002 0 0.00075002 0 0.00075002
 │                <----- 100 -------- 110 -------- 120 -------- 130 ---
 │   histogram(2)=  0 0.0030001
 │                <----- 400 --
 │   histogram(3)=
 ├── cost: 24.22
 ├── key: (1)
 ├── fd: ()-->(2), (1)-->(3)
 ├── scan t
 │    ├── columns: k:1!null i:2 s:3
 │    ├── constraint: /1
 │    │    ├── [/100 - /100]
 │    │    ├── [/110 - /110]
 │    │    ├── [/120 - /120]
 │    │    └── [/130 - /130]
 │    ├── cardinality: [0 - 4]
 │    ├── stats: [rows=4, distinct(1)=4, null(1)=0]
 │    │   histogram(1)=  0   1   0   1   0   1   0   1
 │    │                <--- 100 --- 110 --- 120 --- 130
 │    ├── cost: 24.15
 │    ├── key: (1)
 │    └── fd: (1)-->(2,3)
 └── filters
      ├── i:2 = 400 [outer=(2), constraints=(/2: [/400 - /400]; tight), fd=()-->(2)]
      └── s:3 < 'apple' [outer=(3), constraints=(/3: (/NULL - /'apple'); tight)]

opt set=(optimizer_prefer_bounded_cardinality=false,optimizer_min_row_count=1)
SELECT * FROM t WHERE k IN (100, 110, 120, 130) AND i = 400 AND s < 'apple'
----
select
 ├── columns: k:1!null i:2!null s:3!null
 ├── cardinality: [0 - 4]
 ├── stats: [rows=1, distinct(1)=1, null(1)=0, distinct(2)=1, null(2)=0, distinct(3)=1, null(3)=0, distinct(2,3)=1, null(2,3)=0, distinct(1-3)=1, null(1-3)=0]
 │   histogram(1)=  0 0.25  0 0.25  0 0.25  0 0.25
 │                <--- 100 --- 110 --- 120 --- 130
 │   histogram(2)=  0   1
 │                <--- 400
 │   histogram(3)=
 ├── cost: 24.22
 ├── key: (1)
 ├── fd: ()-->(2), (1)-->(3)
 ├── scan t
 │    ├── columns: k:1!null i:2 s:3
 │    ├── constraint: /1
 │    │    ├── [/100 - /100]
 │    │    ├── [/110 - /110]
 │    │    ├── [/120 - /120]
 │    │    └── [/130 - /130]
 │    ├── cardinality: [0 - 4]
 │    ├── stats: [rows=4, distinct(1)=4, null(1)=0]
 │    │   histogram(1)=  0   1   0   1   0   1   0   1
 │    │                <--- 100 --- 110 --- 120 --- 130
 │    ├── cost: 24.15
 │    ├── key: (1)
 │    └── fd: (1)-->(2,3)
 └── filters
      ├── i:2 = 400 [outer=(2), constraints=(/2: [/400 - /400]; tight), fd=()-->(2)]
      └── s:3 < 'apple' [outer=(3), constraints=(/3: (/NULL - /'apple'); tight)]

# --------------------------------------------------
# Q5
# --------------------------------------------------

opt set=(enable_zigzag_join=false,optimizer_prefer_bounded_cardinality=false,optimizer_min_row_count=0)
SELECT * FROM t WHERE i = 400 AND s > 'z'
----
select
 ├── columns: k:1!null i:2!null s:3!null
 ├── stats: [rows=0.75, distinct(2)=0.75, null(2)=0, distinct(3)=0.75, null(3)=0, distinct(2,3)=0.75, null(2,3)=0]
 │   histogram(2)=  0 0.75
 │                <--- 400
 │   histogram(3)=
 ├── cost: 194.757501
 ├── key: (1)
 ├── fd: ()-->(2), (1)-->(3)
 ├── index-join t
 │    ├── columns: k:1!null i:2 s:3
 │    ├── stats: [rows=25]
 │    ├── cost: 194.477501
 │    ├── key: (1)
 │    ├── fd: (1)-->(2,3)
 │    └── scan t@t_s_idx
 │         ├── columns: k:1!null s:3!null
 │         ├── constraint: /3/1: [/e'z\x00' - ]
 │         ├── stats: [rows=25, distinct(3)=1, null(3)=0]
 │         │   histogram(3)=
 │         ├── cost: 43.6450001
 │         ├── key: (1)
 │         └── fd: (1)-->(3)
 └── filters
      └── i:2 = 400 [outer=(2), constraints=(/2: [/400 - /400]; tight), fd=()-->(2)]

opt set=(enable_zigzag_join=false,optimizer_prefer_bounded_cardinality=true,optimizer_min_row_count=0)
SELECT * FROM t WHERE i = 400 AND s > 'z'
----
select
 ├── columns: k:1!null i:2!null s:3!null
 ├── stats: [rows=0.75, distinct(2)=0.75, null(2)=0, distinct(3)=0.75, null(3)=0, distinct(2,3)=0.75, null(2,3)=0]
 │   histogram(2)=  0 0.75
 │                <--- 400
 │   histogram(3)=
 ├── cost: 194.757501
 ├── cost-flags: unbounded-cardinality
 ├── key: (1)
 ├── fd: ()-->(2), (1)-->(3)
 ├── index-join t
 │    ├── columns: k:1!null i:2 s:3
 │    ├── stats: [rows=25]
 │    ├── cost: 194.477501
 │    ├── cost-flags: unbounded-cardinality
 │    ├── key: (1)
 │    ├── fd: (1)-->(2,3)
 │    └── scan t@t_s_idx
 │         ├── columns: k:1!null s:3!null
 │         ├── constraint: /3/1: [/e'z\x00' - ]
 │         ├── stats: [rows=25, distinct(3)=1, null(3)=0]
 │         │   histogram(3)=
 │         ├── cost: 43.6450001
 │         ├── cost-flags: unbounded-cardinality
 │         ├── key: (1)
 │         └── fd: (1)-->(3)
 └── filters
      └── i:2 = 400 [outer=(2), constraints=(/2: [/400 - /400]; tight), fd=()-->(2)]

opt set=(enable_zigzag_join=false,optimizer_prefer_bounded_cardinality=false,optimizer_min_row_count=1)
SELECT * FROM t WHERE i = 400 AND s > 'z'
----
select
 ├── columns: k:1!null i:2!null s:3!null
 ├── stats: [rows=1, distinct(2)=1, null(2)=0, distinct(3)=1, null(3)=0, distinct(2,3)=1, null(2,3)=0]
 │   histogram(2)=  0   1
 │                <--- 400
 │   histogram(3)=
 ├── cost: 194.757501
 ├── key: (1)
 ├── fd: ()-->(2), (1)-->(3)
 ├── index-join t
 │    ├── columns: k:1!null i:2 s:3
 │    ├── stats: [rows=25]
 │    ├── cost: 194.477501
 │    ├── key: (1)
 │    ├── fd: (1)-->(2,3)
 │    └── scan t@t_s_idx
 │         ├── columns: k:1!null s:3!null
 │         ├── constraint: /3/1: [/e'z\x00' - ]
 │         ├── stats: [rows=25, distinct(3)=1, null(3)=0]
 │         │   histogram(3)=
 │         ├── cost: 43.6450001
 │         ├── key: (1)
 │         └── fd: (1)-->(3)
 └── filters
      └── i:2 = 400 [outer=(2), constraints=(/2: [/400 - /400]; tight), fd=()-->(2)]

# --------------------------------------------------
# Q6
# --------------------------------------------------

opt set=(optimizer_prefer_bounded_cardinality=false,optimizer_min_row_count=0)
SELECT * FROM t WHERE k = 100 AND i = 500 AND s = 'zzz'
----
select
 ├── columns: k:1!null i:2!null s:3!null
 ├── cardinality: [0 - 1]
 ├── stats: [rows=0.000568282, distinct(1)=0.000568282, null(1)=0, distinct(2)=0.000568282, null(2)=0, distinct(3)=0.000568282, null(3)=0]
 │   histogram(1)=  0 0.00056828
 │                <----- 100 ---
 │   histogram(2)=
 │   histogram(3)=
 ├── cost: 9.085
 ├── key: ()
 ├── fd: ()-->(1-3)
 ├── scan t
 │    ├── columns: k:1!null i:2 s:3
 │    ├── constraint: /1: [/100 - /100]
 │    ├── cardinality: [0 - 1]
 │    ├── stats: [rows=1, distinct(1)=1, null(1)=0]
 │    │   histogram(1)=  0   1
 │    │                <--- 100
 │    ├── cost: 9.045
 │    ├── key: ()
 │    └── fd: ()-->(1-3)
 └── filters
      ├── i:2 = 500 [outer=(2), constraints=(/2: [/500 - /500]; tight), fd=()-->(2)]
      └── s:3 = 'zzz' [outer=(3), constraints=(/3: [/'zzz' - /'zzz']; tight), fd=()-->(3)]

opt set=(optimizer_prefer_bounded_cardinality=true,optimizer_min_row_count=0)
SELECT * FROM t WHERE k = 100 AND i = 500 AND s = 'zzz'
----
select
 ├── columns: k:1!null i:2!null s:3!null
 ├── cardinality: [0 - 1]
 ├── stats: [rows=0.000568282, distinct(1)=0.000568282, null(1)=0, distinct(2)=0.000568282, null(2)=0, distinct(3)=0.000568282, null(3)=0]
 │   histogram(1)=  0 0.00056828
 │                <----- 100 ---
 │   histogram(2)=
 │   histogram(3)=
 ├── cost: 9.085
 ├── key: ()
 ├── fd: ()-->(1-3)
 ├── scan t
 │    ├── columns: k:1!null i:2 s:3
 │    ├── constraint: /1: [/100 - /100]
 │    ├── cardinality: [0 - 1]
 │    ├── stats: [rows=1, distinct(1)=1, null(1)=0]
 │    │   histogram(1)=  0   1
 │    │                <--- 100
 │    ├── cost: 9.045
 │    ├── key: ()
 │    └── fd: ()-->(1-3)
 └── filters
      ├── i:2 = 500 [outer=(2), constraints=(/2: [/500 - /500]; tight), fd=()-->(2)]
      └── s:3 = 'zzz' [outer=(3), constraints=(/3: [/'zzz' - /'zzz']; tight), fd=()-->(3)]

opt set=(optimizer_prefer_bounded_cardinality=false,optimizer_min_row_count=1)
SELECT * FROM t WHERE k = 100 AND i = 500 AND s = 'zzz'
----
select
 ├── columns: k:1!null i:2!null s:3!null
 ├── cardinality: [0 - 1]
 ├── stats: [rows=1, distinct(1)=1, null(1)=0, distinct(2)=1, null(2)=0, distinct(3)=1, null(3)=0]
 │   histogram(1)=  0   1
 │                <--- 100
 │   histogram(2)=
 │   histogram(3)=
 ├── cost: 9.085
 ├── key: ()
 ├── fd: ()-->(1-3)
 ├── scan t
 │    ├── columns: k:1!null i:2 s:3
 │    ├── constraint: /1: [/100 - /100]
 │    ├── cardinality: [0 - 1]
 │    ├── stats: [rows=1, distinct(1)=1, null(1)=0]
 │    │   histogram(1)=  0   1
 │    │                <--- 100
 │    ├── cost: 9.045
 │    ├── key: ()
 │    └── fd: ()-->(1-3)
 └── filters
      ├── i:2 = 500 [outer=(2), constraints=(/2: [/500 - /500]; tight), fd=()-->(2)]
      └── s:3 = 'zzz' [outer=(3), constraints=(/3: [/'zzz' - /'zzz']; tight), fd=()-->(3)]
