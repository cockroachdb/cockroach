# LogicTest: 5node

statement ok
CREATE TABLE xyz (
  x INT,
  y INT,
  z TEXT
)

statement ok
ALTER TABLE xyz SPLIT AT VALUES (2), (3), (4), (5)

statement ok
ALTER TABLE xyz EXPERIMENTAL_RELOCATE VALUES
  (ARRAY[1], 1),
  (ARRAY[2], 2),
  (ARRAY[3], 3),
  (ARRAY[4], 4),
  (ARRAY[5], 5)

query TTTI colnames
SELECT start_key, end_key, replicas, lease_holder from [SHOW RANGES FROM TABLE xyz]
----
start_key  end_key  replicas  lease_holder
NULL       /2       {1}       1
/2         /3       {2}       2
/3         /4       {3}       3
/4         /5       {4}       4
/5         NULL     {5}       5

subtest Union

# Simple UNION ALL and UNION. (The ORDER BY applies to the UNION, not the last select.)
query T
EXPLAIN (DISTSQL) SELECT x FROM xyz UNION ALL SELECT x FROM xyz ORDER BY x
----
distribution: full
vectorized: true
·
• sort
│ order: +x
│
└── • union all
    │
    ├── • scan
    │     missing stats
    │     table: xyz@primary
    │     spans: FULL SCAN
    │
    └── • scan
          missing stats
          table: xyz@primary
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJysVk2L2kAYvvdXDO-ppRPiTOJXTm67FgSrW7XQUnJIzbAIrpPORIgr_vdiguwq5p3JxzEZn3k-kRxB_9tCAONfT9OHyYx8fJwsV8sf009kOZ6Ov65IRr4t5t9JdnglP2eT-Yw8TKd3zuaLx_GCfPlNMqCwk7GYRS9CQ_AHGFDgQMEDCj5Q6EJIIVFyLbSW6vyTYw6YxBkEHQqbXbJPz69DCmupBARHSDfpVkAAq-jvVixEFAvldoBCLNJos81pssPrKFGbl0gdgMIyiXY6II57Zp7v04CMGIQnCnKfvl2v0-hZQMBOtJ6EbmsSeKmEN2apYqFEfM0J4emOyJl0ZOKy64jKuDtV7C-lSoVy2Y31Eftc6s2r6624tNQet7PnX9Ez-3aZRbsud1yv8sQqiOi1KIKXimgyMlZjZIYALiPr1R0Ztw-Y2wTsOa5fueUKIvotiuClIpq0zGu0bAjg0nK_bsuefcCeTcC-k_-jV2u5gohBiyJ4qYgmLXs1WjYEcGl5ULdl3z5g3ybgrlO54woShq1J4KUSmjTs12jYYP_S8LCNT4I79y-ETuROC0vlIQURP4siKC33ai2elFznNMXjPMflL2Kh0-KUFw-TXX6U9_8ezJqAOQr2rsCdW7CHgn2c2cdlM5y6i6L7OHWvCbiPgge47EGTxIYomDHDTPCRGeH4zBjHjTN8aAbnDF8a6xrg-NaMcHxsrGewjs_NZB3fGxsa4PjijHB8c7yDW-f45m6th6cP_wMAAP__BE4uGA==

query T
EXPLAIN (DISTSQL) SELECT x FROM xyz UNION SELECT x FROM xyz ORDER BY x
----
distribution: full
vectorized: true
·
• sort
│ order: +x
│
└── • union
    │
    ├── • scan
    │     missing stats
    │     table: xyz@primary
    │     spans: FULL SCAN
    │
    └── • scan
          missing stats
          table: xyz@primary
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyslk-P2jAQxe_9FNacWtUo2En4k9O2hUpIFLZApVYVh5RYq0hsTG0jwSK-e0U4pLDs2A45kvDm_fzmKfIB9N81JDD8-Tj-NJqQ94PRfDH_Pv5A5sPx8MuC7MjX2fQb2e1fyI_JaDq58Xw6Gwxn5PMvsgMKhczEJH0WGpLfwIACBwohUIiAQgxLChslV0JrqU5_OZSCUbaDpE0hLzZbc3q8pLCSSkByAJObtYAEFumftZiJNBMqaAOFTJg0X5c2u_3Lw0blz6naA4X5Ji10QlrByXm6NQl5YLA8UpBbU43XJn0SkLAjrYcQN4bAfRAGuTZ5sTIBu8oAMQjrGcTOBtGbBtXcbSFVJpTILqYujxgCdz9j7HPGuVRGqICz6_Ef35zfuZjP3HvCHHoS8FYQepfVA6LTIAT3gaja9Cprx7o6G3Rq1pW7x8hdYgxbQeS9Sw-IboMQ3AeiiprX3KWzQbfmLkP3GEOXGKNW-Z3326UHRK9BCO4DUUUd1tyls0Gv5i4j9xgjlxjjlvcmPRD6jSFwH4Qq5qjmHp0N-g1cB24YzITeyEKLq2vB7cnt03VBZE_ifLfQcqtW4lHJVWlz_jktdeWDTGhzfhuef4yK86sT4P9ihoo5LuaoOLoQs2txeI84QsUxjh3jZ7YcuoOq-7i4i4p7uLh3T2L9e8QM7xizlQxvGbMkzu7qGburaAxvGuta0PGusY5FjpfNxo63zabG68aZBR0vHG9bPi144yzsHC_ctXp5fPcvAAD__4tHN40=

# UNION with no overlap.
query T
EXPLAIN (DISTSQL) SELECT x FROM xyz WHERE x < 3 UNION SELECT x FROM xyz WHERE x >= 3 ORDER BY x
----
distribution: full
vectorized: true
·
• sort
│ order: +x
│
└── • union
    │
    ├── • filter
    │   │ filter: x < 3
    │   │
    │   └── • scan
    │         missing stats
    │         table: xyz@primary
    │         spans: FULL SCAN
    │
    └── • filter
        │ filter: x >= 3
        │
        └── • scan
              missing stats
              table: xyz@primary
              spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJysl99u2kwQxe-_p1jN1VfVyMyu-WepUtqGqEgppEDVVi0Xrr2KLBGbro1EEvHuFSDhQJOZXceX2D575uz8ZrN5hOLPEkIYfr-5fj8ai_8vR7P57Mv1GzEbXg8_zsVGXE0nn8Xm_kF8-zScDsVG_Fq32yoWSnwdjyZj7kP9TigxmV4Op-LDD7EBD7I80ePoThcQ_gQEDyR4oMCDADzowMKDlcljXRS52X3yuBeMkg2EbQ_SbLUud48XHsS50RA-QpmWSw0hzKPfSz3VUaKN3wYPEl1G6XJvs7l_uFiZ9C4y9-DBbBVlRSha_s55si5DcYGw2HqQr8tq-aKMbjWEuPXsS7hKl6U22vidU__D851PtSthGI7G8_6LxtLF-Gl2bC68qhUemfQxHz5wMb5MizLN4tKXZ8mJZJ16Bh1rg-6LBtW66yw3iTY6OVl1saVKUPYZey4ZZ7kptfEVni__9sX1-yfrowOhFoD6suUr5_lkijgi2m16Pl3SNxlf1YqPTH7nCWWMqwH6By_LCbU26NacUGnfQGnTP9XyA2d8mSKO_es1ja9DemwyvqoVH5n8zvgyxhVdsia-1ga9mvgq-wYqm_4Frf0dxg1fpohj__pN4-uQHpuMr2rFRya_M76McUWXqomvtUG_Jr6BfQMDm_51Ws7wMiUcuzdoGl6H7NhceFUrPDLpndFljCuygproWhsMGrjaP2Mw1cUqzwp9dsV_fuX27uqvk1t9-D-hyNcm1jcmj_c2h5-TvW7_INFFeXiLhx-j7PBqV-BTMZLiDi2WpFjRYkWKA1ockOLuiRjPxZ3XiLukuEeX3aM3TNLqPqke0OIBTQnTLGQg4yijMUMmONKgMR1DmjROTaOGzIggDRsyXUMaN2R4Qxo47DNymjhu52jkGLWkiZMMcZImTnInG02cZMZF0shJ5nSTrzre5KvON0kTJxniJHPEcW2jiZPMuEgaOdVm_iTRzDE7p2jkztWL7X9_AwAA__-dZI_i

# UNION with partial overlap.
query T
EXPLAIN (DISTSQL) SELECT x FROM xyz WHERE x <= 4 UNION SELECT x FROM xyz WHERE x > 1 ORDER BY x
----
distribution: full
vectorized: true
·
• sort
│ order: +x
│
└── • union
    │
    ├── • filter
    │   │ filter: x <= 4
    │   │
    │   └── • scan
    │         missing stats
    │         table: xyz@primary
    │         spans: FULL SCAN
    │
    └── • filter
        │ filter: x > 1
        │
        └── • scan
              missing stats
              table: xyz@primary
              spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJysl99u2kwQxe-_p1jN1VfVyMyuzR9LldI2REVKIQWqtmq5cPEqskRsujYSScS7VwYJAk1mdh1fYvvsmbPzm83mEYo_S4hg8P3m-v1wJP6_HE5n0y_Xb8R0cD34OBMbcTUZfxab-wfx7dNgMhAb8WvdbqvFOxGIr6PheMR9qQWK8eRyMBEffogNeJDliR7Fd7qA6CcgeCDBAwUeBOBBCHMPViZf6KLITfXJ404wTDYQtT1Is9W6rB7PPVjkRkP0CGVaLjVEMIt_L_VEx4k2fhs8SHQZp8udzeb-4WJl0rvY3IMH01WcFZFo-ZXzeF1G4gJhvvUgX5fH5YsyvtUQ4dazL-EqXZbaaOOHp_7755XPYVOiKBqOZr0XfaWL79Po2Fx2VSs7MuErdrj0gYvzZVqUabYofXkWnYgW1jMIrQ06Lxoc111nuUm00cnJqvMtVYKyz9h1yTjNTamNr_B8-bcvrt87WR8dELUg1JctXznPJ1PEgdFOw_PpEr7J9KpWemTiu08o43wcoH_wspxQa4NOzQmV9h2UNg1ULT9wxpcp4tDAbsP4OoTHJtOrWumRie-OL-N8pEvWxNfaoFsTX2XfQWXTwKC1u8O44csUcWhgr2F8HcJjk-lVrfTIxHfHl3E-0qVq4mtt0KuJb2DfwcCmgWHLGV6mhEP7-g3D6xAdm8uuamVHJrw7uozzkaygJrrWBv0GrvbPGEx0scqzQp9d8Z9fuV1d_XVyq_f_JxT52iz0jckXO5v9z_FOt3uQ6KLcv8X9j2G2f1UV-FSMpDikxZIUK1qsSHFAiwNS3DkR47k4fI24Q4q7dNldesMkre6R6j4t7tOUMM1CBjKOMhozZIIjDRrTMaRJ49Q0asiMCNKwIdM1pHFDhjekgcMeI6eJ43aORo5RS5o4yRAnaeIkd7LRxElmXCSNnGRON_mq402-6nyTNHGSIU4yRxzXNpo4yYyLpJFTbeZPEs0cs3OKRu5cPd_-9zcAAP__k7-P3A==

# UNION ALL with swapped column orders.
query T
EXPLAIN (DISTSQL) SELECT x, y FROM xyz UNION ALL SELECT y, x from xyz
----
distribution: full
vectorized: true
·
• union all
│
├── • scan
│     missing stats
│     table: xyz@primary
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: xyz@primary
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyslUGLm0Acxe_9FMP_1MKImRnNbjxlaVMQrNkmKRSKBxuHJZB17IyCbsh3LzG0u1mScUY96uTne773iAdQf_YQwOLnY_QQxujjl3C9WX-PPqH1Ilp83qAaowZ9XS2_obp5QT_icBmjhyj6d9xgVP8_Bgy5yHicPnMFwS8ggIECBgYYPMDgQ4KhkGLLlRLy9JNDC4RZDcEEwy4vqvJ0O8GwFZJDcIByV-45BLBJf-_5iqcZl-4EMGS8THf7VqZuXuaF3D2nsgEM6yLNVYAc96S8rMoAzSmeE0iOGERVviqoMn3iEJAj7ufCt3RB8JzedEFvungVFzLjkmeXspAcr_iMhSMKl1wGdUt7YqBd5dfUddq-kTa70Cbm6ROD9F3quKzPCix8TK19WOyAjLQD0mMH1DwDapIBc1yvTxcWPu6sfVh0QUfqgvbogplnwEwy8Jz238u6Cwsf99Y-LLpgI3XBenThmWfgmWTgO32asHAxs3Rh0YM3Ug_ewO_UlSevuCpErrjhkxMMPHvi5xdRopJb_ijFtpU5Xy5brr2RcVWeT-n5Iszbo7aitzAZAlMtzPQw08JkekFP3tOelp7qpf0h8HTIS99p4Zkevh8Cz4bYJvqNka6R6VfWiQ_aGekYmt-B65fWieu39t57cvzwNwAA__9z7TC5

# UNION ALL and UNION with different ORDER BY types.
query T
EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) UNION ALL (SELECT x FROM xyz ORDER BY z) ORDER BY x
----
distribution: full
vectorized: true
·
• sort
│ order: +x
│
└── • union all
    │
    ├── • scan
    │     missing stats
    │     table: xyz@primary
    │     spans: FULL SCAN
    │
    └── • scan
          missing stats
          table: xyz@primary
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJysVluL2kwYvv9-xfBerXwT4kziKVduuxYEq1u10FJykZphEVwnnYngAf97MUGssnlncrgzh2eeI5IT6D8bCGD043XyPJ6Sp5fxYrn4NmmRp8VoMvq8JHvyZT77SvaHI5nNX0Zz8uknObTI9-l4NiXPkwn64rF1-70HClsZi2n0LjQEv4ABBQ4UPKDgA4UOhBQSJVdCa6kur5wywDjeQ9CmsN4mu_RyO6SwkkpAcIJ0nW4EBLCMfm_EXESxUG4bKMQijdabjGZ_OA4TtX6P1AEoLJJoqwPiuBfm2S4NyJBBeKYgd-nteJ1GbwICdqbVJHQak8ALJdyYpYqFEvE9J4TnD0ROpSMTl91HVMTdLmN_IVUqlMserA_Z_4XevKre8kML7XE7e_4dPbNvl1m063LH9UpPrISIboMieKGIOiNjFUZmCOA6sm7VkXH7gLlNwJ7j-qVbLiGi16AIXiiiTsu8QsuGAK4t96q27NkH7NkE7DvZP3q5lkuI6DcogheKqNOyV6FlQwDXlvtVW_btA_ZtAu44pTsuIWHQmAReKKFOw36Fhg32rw0Pmvgk-OD8udCJ3GphqTykIOI3kQel5U6txKuSq4wmv5xluOxGLHSaP-X5xXibPcr6_xfM6oA5CvbuwO1HsIeCfZzZx2UznLqDons4dbcOuIeC-7jsfp3EBiiYMcNM8JEZ4fjMGMeNM3xoBucMXxrrGOD41oxwfGysa7COz81kHd8bGxjg-OKMcHxzvI1b5_jmHq2H5__-BgAA__96tDSb

query T
EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) UNION (SELECT x FROM xyz ORDER BY z) ORDER BY x
----
distribution: full
vectorized: true
·
• sort
│ order: +x
│
└── • union
    │
    ├── • scan
    │     missing stats
    │     table: xyz@primary
    │     spans: FULL SCAN
    │
    └── • scan
          missing stats
          table: xyz@primary
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyslkuP2jAUhff9FdZdDapRsJPwyGraQiUkClOgUquKRUqsUSQmobaReIj_XhEWKczMtZ1kxyPnns_nHkU-gfq7gQhGP58mn8ZT8jAcL5aL75MWeViMJqMvS7InX-ezb2R_OJLZfDiak8-_yKFFfkzHsyn60LFVft4DhSxPxDR-EQqi38CAAgcKPlAIgEIIKwpbma-FUrm8PHIqBONkD1GHQpptd_ry84rCOpcCohPoVG8ERLCM_2zEXMSJkF4HKCRCx-mmsNkfjo9bmb7E8gAUFts4UxFpexfn2U5H5JHB6kwh3-lyvNLxs4CInWk1hLAxBO6CMEyVTrO19thdBoiBX80gtDYI3jUo5-6yXCZCiuRm6uqMIXD7M4YuZ1zkUgvpcXY__uO787s385l9T5hFTzze9nznsjpAdBuE4C4QZZteZW1ZV2uDbsW6cvsYuU2MftsLnHfpANFrEIK7QJRR84q7tDboVdylbx-jbxNj0C7e8267dIDoNwjBXSDKqP2Ku7Q26FfcZWAfY2ATY9h23qQDwqAxBO6CUMYcVNyjtcGggevAGwZzobZ5psTdteDtyZ3LdUEkz-J6t1D5Tq7Fk8zXhc3166zQFT8kQunrv_71yzi7_nUB_F_MUDHHxRwVBzdidi_264gDVBzi2CF-ZsOhu6h6gIt7qLiPi_t1EhvUETO8Y8xUMrxlzJA4q9UzVqtoDG8a6xnQ8a6xrkGOl83EjrfNpMbrxpkBHS8c7xheLXjjDOwcL9y9enX-8C8AAP__pOo-EA==

# UNION ALL with conflicting numbers of ORDER BY columns.
query T
EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) UNION ALL (SELECT x FROM xyz ORDER BY y, z) ORDER BY x
----
distribution: full
vectorized: true
·
• sort
│ order: +x
│
└── • union all
    │
    ├── • scan
    │     missing stats
    │     table: xyz@primary
    │     spans: FULL SCAN
    │
    └── • scan
          missing stats
          table: xyz@primary
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJysVluL2kwYvv9-xfBerXwT4kziKVduuxYEq1u10FJykZphEVwnnYngAf97MUGssnlncricJM88R8QT6D8bCGD043XyPJ6Sp5fxYrn4NmmRp8VoMvq8JHvyZT77SvaHI5nNX0Zz8uknObTI9-l4NiXPkwn-ISXH1u24BwpbGYtp9C40BL-AAQUOFDyg4AOFDoQUEiVXQmupLp-cMsA43kPQprDeJrv08jiksJJKQHCCdJ1uBASwjH5vxFxEsVBuGyjEIo3Wm4xmfzgOE7V-j9QBKCySaKsD4rgX5tkuDciQQXimIHfp7XqdRm8CAnam1SR0GpPACyXcmKWKhRLxPSeE5w9ETqUjE5fdR1TE3S5jfyFVKpTLHqwP2f-F3ryq3vJLC-1xO3v-HT2zb5dZtOtyx_VKT6yEiG6DInihiDojYxVGZgjgOrJu1ZFx-4C5TcCe4_qlWy4hotegCF4ook7LvELLhgCuLfeqtuzZB-zZBOw72S96uZZLiOg3KIIXiqjTslehZUMA15b7VVv27QP2bQLuOKU7LiFh0JgEXiihTsN-hYYN9q8ND5r4S_DB_XOhE7nVwlJ5SEHEbyIPSsudWolXJVcZTX6cZbjsQSx0mr_l-WG8zV5l_f8LZnXAHAV7d-D2I9hDwT7O7OOyGU7dQdE9nLpbB9xDwX1cdr9OYgMUzJhhJvjIjHB8Zozjxhk-NINzhi-NdQxwfGtGOD421jVYx-dmso7vjQ0McHxxRji-Od7GrXN8c4_Ww_N_fwMAAP__3oE1YA==

# Only one distinct processor should be used in the single node UNION case.
query T
EXPLAIN (DISTSQL) VALUES (1), (2) UNION VALUES (2), (3)
----
distribution: full
vectorized: true
·
• union
│ estimated row count: 4
│
├── • values
│     size: 1 column, 2 rows
│
└── • values
      size: 1 column, 2 rows
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJysj0FLAzEQhe_-ijCnXQh0N_WUk5X2sFC21doiSA5LMtTFNamZBISy_12aBWvFCkWP82bevO_tgd46kDB7XM4nVc2yabV6WN3Nc7aZzNezFcvKnLNM5GxdV4v6UxUHdZwDB-sM1s0rEsgnKEFx2Hmnkcj5g7RPB5V5B1lwaO0uhoOsOGjnEeQeQhs6BAmbpotIowI4GAxN26WP1-yWZYLp52hfKAfVc3AxHL9QaLYIsuj5xUnlPycdA6J13qBHc5Kg-h9Ypi2F1uowEqc0N-VZgvKSrvdIO2cJv5Gc66Y4oNniUIdc9BqX3ukUM4yL5EuCQQrDVgxDZdMqAX41l38xi1_N4xNz0av-6iMAAP__nsboJg==

subtest Intersect

# Basic INTERSECT ALL and INTERSECT case -- should return every row.
query T
EXPLAIN (DISTSQL) (SELECT y FROM xyz) INTERSECT ALL (SELECT y FROM xyz) ORDER BY y
----
distribution: full
vectorized: true
·
• sort
│ order: +y
│
└── • intersect all
    │
    ├── • scan
    │     missing stats
    │     table: xyz@primary
    │     spans: FULL SCAN
    │
    └── • scan
          missing stats
          table: xyz@primary
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy8ll9v2jwUh-_fTxGdq1ZvUGIn4U-kSXQr05AYdISLTVMuUuIVJEoyJ0ilFd99SijrkoBPTIrvCuSxfzl-To9fIPm9AhcG3-9GN8OxdnU79Gbet9G1duUNRoNPM22rfZ5OvmpP2-drbTieDaZe9u3NaHT0icn0djDVPv7QtqDDOgrZOHhkCbg_gYAOFHSwQAcbdHDA1yHm0ZwlScSzR15yYBg-gWvqsFzHmzT72tdhHnEG7guky3TFwIVZcL9iUxaEjBsm6BCyNFiu8m2ets_9mC8fA54l8OJgnbhay8h2nmxSV-tT8Hc6RJv0dfm3Ve-32iJIFsX1-gT8na9DkgYPDFyy08-L6SiNSU_GfFtns454yDgLCyv5GYk9cuRdvwTJwmPpJDZI6URm25i5RXVAhxX7lV71yfUHvnxY5H_9fXVSevW317Jkqu9FPGXcIE65Uv-fXN-uUbZjFXld9EiIcdSKYoOa5Rof3d4pbE_qy0VqyGXQlmFdpAskgrYVB6UngyroA6KoD5D6H_qgfW4f0PrnS-ucr9Uy7IuIKBG0ozgoPRlUgYhUkYhI_Q8ids4V0ap_vlad87Vb-Vh-fxElgnYVB6UngyoQ0VIkIlL_g4jdc0W065-vXed8ndZFNJSI2VMak56MqUBCW5GESPUPEvbe43p6ZP0pS-JonbBaN08zqxkLH9j-DJJow-fsjkfzfJv9x0nO5deNkCXp_le6_zBc5z_l51of7jSBCWlEO43onpgmEjUjcnCnCVyqmSztNKJ7YpqWafNf2irAZhm2hLAt3tkWwpSIt3aa9IcYRvpDDGP9gdBIfyA00h_tJv0hhpH-EMNYfyA00h8IjfRHR2hpVyxpt0l_9JoYLoYRw8UwZjhCI4YjNDYBZMZm9T-pzNyUpdEhIDU5pXFEc1KZIgVVCRWLTsRjBDGdVOaIjOoIjbiO0JjsGI7YjuGY7pUZKqW7mMZ0F9Oo7giO6Y7gmO6VQVrUvY3oXpkpUrpXZoqU7mIa011Mo7ojOKY7gmO6V-aplO5iGtNdTKO6IzimO4JjulemavGubYp1p5XZItTd3_33JwAA__80IHd3

query T
EXPLAIN (DISTSQL) (SELECT y FROM xyz) INTERSECT (SELECT y FROM xyz) ORDER BY y
----
distribution: full
vectorized: true
·
• sort
│ order: +y
│
└── • intersect
    │
    ├── • scan
    │     missing stats
    │     table: xyz@primary
    │     spans: FULL SCAN
    │
    └── • scan
          missing stats
          table: xyz@primary
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy8mF1v4kYYhe_7K6y5SlQjMx98WaqUbUNVJBq2wEWrKhdemCZILKa2kcJG-e8V0KwTD37PTGxzlwCP5_hlzqMxzyz9d81CNvzz8_jT6M67uh3N5rM_xtfe1Ww4Hv4y9_ber9PJ797T_tu1N7qbD6ezw6vn3p1Mb4dT7-e_vD3z2SZe6rvoq05Z-DfjzGeC-Uwynynmsw6799k2iRc6TePk8JHnIzBaPrGw7bPVZrvLDi_f-2wRJ5qFzyxbZWvNQjaPvqz1VEdLnQRt5rOlzqLV-rjM0_7bzTZZfY2SQ4LZNtqkodcKDitPdlno3Qh2_-KzeJfll0-z6EGzkL_4H4vQqS2CcIlwu0qz1WaRBbwwgxteWCBnvuy9xyh9PPP5PIT8WIhOrSFUaYj8OrtNnCx1opfvrnS8SmlMgWaVR-g0FQFNKo_QrRDB_1DK36L0caazyTaQhUnN91sdvqn_p_GY-Wyt_8mubvj1T8nq4fH41_dtXn5bPZcdNouTTCeBNKb2Y-n1-xZjOzeR_y96JsRd3Iq3gWoXZ3x2-cG75bm9SLiFSALRCqSzzRxCdGsMIVxC5CrhDfrMOkS3QZ_x-mSCZlXmsxojoEmV-cwtQmWf8Qv5DOywV58ZU7P1mbDvsrDpsmwFylkoDiF6NYYQLiHyLosGhWIdotegUER9bUazKhNKjRHQpMqE4hahslDEhYQCdtirUIyp2QpF2ndZ2nRZtY6PRG5CcQjRrzGEcAmRd1k2KBTrEP0GhSLrazOaVZlQaoyAJlUmFLcIlYUiLyQUsMNehWJMzVYoyr7LyqbLnZazThwiDGqLIFwi5D1WDcrEOsSgQZmo-pqMZlUmkxojoEmVycQtQmWZqAvJBOywV5kYU_vIzzdnrj_V6TbepNrql5n2YWZ6-aBP30Ea75KF_pzEi-Myp38nR-74wlKn2eldefpntDm9dQj4FuYkLGhYFGH-FlbvYO4Gc1mFFrwSPahCyx5NS5LuVIE5GDlNC1GFlu1KdJ-mFblNuzTccYBFEe6ScI8uSI-EwT33SVhxeukBSXPQbE5LhYPFuaEVFzMAGqkB4MgNCAdyADiyA6flAvQAaOQHgCNBABwZAuGgLtwwzPsti0ZHK6aAG5rgtGR4FxSG1gy6ddozog0Wp03DBwA3VONUdpqGZadxWHaAo7LTOCq7MCzrUnZAo7IDHJUd4KjsCAc7XoBzKzo9GqqhcKPsglaNUODYTKsG3TptGtEHi9OmEeBEIwzVOJ35aRoe-mkcnvoBjo79NA7LbljWqew0DctO47DsNA7LDnC04-mzrARfuwQPyJwuu6RVI8FJWtKqAbcuadNIcKyQtGlkB-CGalzKDmhUdoCjsiMclB3g8CHfsKzTUz5Nw8d8GofP-TQOH_QBjnY8fZaV6Hujz7IF3Cw7rRoFTtKKVk3x1u9ffvgvAAD__zV_Boc=

# INTERSECT ALL and INTERSECT with MergeJoiner.
query T
EXPLAIN (DISTSQL) (SELECT y FROM xyz ORDER BY y) INTERSECT ALL (SELECT y FROM xyz ORDER BY y)
----
distribution: full
vectorized: true
·
• intersect all
│
├── • scan
│     missing stats
│     table: xyz@primary
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: xyz@primary
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzElkFv2jAYhu_7FdZ3aiWjYCfQEmkS3co0JAYdcNg05ZASryDRJIuD1LTiv08J0zoC-Ivn4d1K48d-_eWR8r6A_LEGHwZf7kY3wzG5uB3O5rPPo0tyMRuMBu_npCAfppNP5Kl4JpPp7WBK3n0lxSUZjueD6axccDMaIYuBQpxEYhw-Cgn-N2BAgQMFFyh4QKEDAYU0SxZCyiQrl7xUwDB6Ar9NYRWnm7z8d0BhkWQC_BfIV_lagA_z8H4tpiKMROa0gUIk8nC1ro55Kp77abZ6DLMCKMzSMJY-aTnlyZNN7pM-h2BLIdnkv7Z_3fW-IMtQLvf36zMItgEFmYcPAny2pX8Xs2M1Jj8Z83WfTZxkkchEtLdTUJLYkiN3_RjK5Uzkk9RhtTcyL1Lh76sDFNbie37RZ5dvs9XDsvrr99VZ7eqv13INrnUk8zhpJanDOvUBHD3b2zubNX_zrMGbd3jLcc-iqEbQruWg_GRQC5IyS5Ly5vPnTebvthzvLKJoBL2yHJSfDGpBFG5JFLf5_N0m8_da1Tfn34uiEfTaclB-MqgFUVxLonjN5-81mX-ndRZNNGL2rMbkJ2NakMT7D93oSKKpkGkSS9Go-bTLO4noQexmJJNNthB3WbKojtn9nFRc9RWPhMx3T_nuxzCuHlVzbw53TeCeCcyMcrOOmmYaI2N6cNcE7pnAzCh3bWQHNK_T7T9pVw27Spjtz6xdpz0TwdUwIrgaRgRXw5jgCI0I3jERXA0jgqthRHA1jAmO0IjgXRPBr0wUVcOIomoYUVQNY4oiNKLotYmiahhRVA0jiqphTFGERhTtmSjKjHoCQiOSIjRiKUJjmmI41hXMyoJZWzCrC4Z9wawwMKPGwA4qg5atahqzVU1jtqpp1FYEx2zVKUuHU9dpS7o0ZqtWX9LGMVsPyoPS1mD75mcAAAD__yJddcg=

query T
EXPLAIN (DISTSQL) (SELECT y FROM xyz ORDER BY y) INTERSECT (SELECT y FROM xyz ORDER BY y)
----
distribution: full
vectorized: true
·
• intersect
│
├── • scan
│     missing stats
│     table: xyz@primary
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: xyz@primary
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzEmMFu6kYUhvd9CuusEsnIzIwNxFKl3DZURaLhFli0qrLwxdMEiYtd20ghUd69wkh1Ysfn98R2ugvgz_P7ZL7DGZ4p_WdHPk3_-Dr_Mru1Lm5mq_Xq9_mldbGazqc_r62j9cty8Zv1eHyyFsub6dL66U_reGnNbtfT5ep0AX8h2bSPQn0bfNcp-X-RIJsk2aTIJpds8ujOpjiJNjpNo-R0yXMOzMJH8oc2bffxITu9fWfTJko0-c-UbbOdJp_WwbedXuog1IkzJJtCnQXbXb7M4_HpOk6234PkSDat4mCf-tbAOa28OGS-dS3p7sWm6JAVt0-z4F6TL17sj0XwOosgTSLcbNNsu99kjijV4FqUFiiYb0frIUgf3rm-CKE-FsLrNIRbG6K4z2EfJaFOdPjmTvldamNKVKsigtdXBFSpIsKoRQT7Qyl_DdKHlc4WsaNKlVofY-2_0v_LfE427fTf2cW1uPwx2d4_5H_9t83rH2vcbWVvo0EUO8orF-DdtSdv1hbNLRcNLHfkwFHGrcYgxKjDENIkROG56LHZNA4x6rHZiO5MR7WqazYdRkCVqms2ZhFaNxvxSc1GNndNNnFNDRzXWHiDEOMOQ0iTEIVrskfhG4cY9yi87M42VKs64TuMgCpVJ7xZhNbCy08SXjV3TTVxzR3k876Z8AYhJh2GkCYhCtdUj8I3DjHpUXjVnW2oVnXCdxgBVapOeLMIrYVXnyS829w1t4lr3sBYd4MIV51FkCYRCs_cHmVvHOKqR9nd7kxDtaqTvcMIqFJ1sptFaC27-z_8dvBOoqVO42if6ka_DAxPz6TDe32uURodko3-mkSbfJnzy0XO5W-EOs3On6rzi9n-_NEp4GtYsLDkYVmGxWvYfQMLM1jIVvRVG1qO2tBK8bRiaa8NLFotLYet6HEbWoHN4rLbFPy_PANYluERC4OHHvNqjni9JiwtBE9f8fQQ9IVKVzFxG9BIboQDuwGO9AY48ltUWqqJ4IBGhgMcKY5wsN0BjiQXlcb6dssivNJiOLwiuuB7DHp0vsmICdCNbzNiDPBKozGylaehrQBHtvI4tJXHoa2VJmtkK09DW3kc2gpwtGV5HNrKf8FIAYYofmwt4RVbJT-4gkeXfKeRHph7-U4jXYBXOo3R3MzTcHAGOJqceRyOzjyObJWVLmtiK6CRrQBHtiIcbVkeR7ZK_gtGTgDOT7IlvGorP8qiR-c7jQKnVAUOyGCOVvxQA-oOaGQrwoGtAEe2AhyedPmDMjrqgiN-u8XhYRfg6LQLfiNAu4b_glGodPwoW8Irtip-li0_-t3LD_8GAAD___KEBw0=

# INTERSECT ALL and INTERSECT with no overlap.
query T
EXPLAIN (DISTSQL) (SELECT x FROM xyz WHERE x < 2) INTERSECT ALL (SELECT x FROM xyz WHERE x >= 2) ORDER BY x
----
distribution: full
vectorized: true
·
• sort
│ order: +x
│
└── • intersect all
    │
    ├── • filter
    │   │ filter: x < 2
    │   │
    │   └── • scan
    │         missing stats
    │         table: xyz@primary
    │         spans: FULL SCAN
    │
    └── • filter
        │ filter: x >= 2
        │
        └── • scan
              missing stats
              table: xyz@primary
              spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzEmF2P2kYYhe_7K6z3alc1MjNjvixF2rQhChKFFJDaquXCgekuEsHUNhJktf-9MmSXtU3m-DWsuQsfz8zkeJ4zwz5S9N-SPOr--bn_vjewbj70xpPx7_1b62bc7Xd_nVhb6-No-Ju13X2z_vjUHXWtrfXPpl5XM0veWr3BpDsaJ1973-9DRL9LmOHoQ3dk_fKXtSWbVsFcD_yvOiLvbxJkkySbFNnkkk0Nmtq0DoOZjqIgTL7yuAd68y15dZsWq_UmTt6e2jQLQk3eI8WLeKnJo4n_ZalH2p_r0KmTTXMd-4vlfprt7tvdOlx89cMd2TRe-6vIs2pOMvNwE3vWnaDpk03BJj4OH8X-vSZPPNnFl_BxsYx1qEOnkZ7_8H4yzzEWz_N6g0k7M_FxrC8768GPHtID7Rd6XJzkLO51PuJyAalSAQmQ0OwyAbk_XNxxnM0qCOc61PPUSNOERF858T_85EcPYx0P147MZDzZrbWX9odsWup_45s7cfsuXNw_7P9VIPMGJ_NxEMY6dGQjm9TPPxy_WSC2U4l8H_TEIgZBLVg7qp7N-OT0rdT0grGtC-xqR9YcxRYfLOJlXzevIT4noUtGpEpFJEBGb6K-qFZ9UZH6IPNn9Ztl1ZfFd5YssrFUzXHZ7oFFvGys1jXcYyQkLhmRKhWRABm9iXuyWvdkRe6BzJ_da5V1TxXfWarIxnJr-2spzz2wiJeN1b6Ge4yExCUjUqUiEiCjN3FPVeueqsg9kPmze-2y7rnFd5ZbZGM1amzzwBJetlXnGuYx8hGXC0iVCkiAhN7EO7da79yKvAOZP3vXucRPzRPjj3S0DlaRLvQrsp5kpuf3-vAMomATzvTnMJjtpzm8HO65_RtzHcWHT8XhRW91-ChZ4GtYZGHxGnZTsOTBQpxFt86hpTqL7phpaUxcmRNXjMQFD84kzqVb59CZxLl0x0y7xsQb5sQbRrhpnrlpftZAr5aRbpvh9jlummHkJqCBm2YauQlo4GbH3IZ1UIe5MuXYCWikJ8KBnwBHgiIcGCpylZoOXoLgzZ0KJBW5dklP7oLJc_XCOgXNNDwGAY7OQTMOD0KAA9uEuVtFEwSfa1eWbmYa6gZwpJsZh7oBHOlmPlkEOFpErmRZuplLVoKSlZySzV--WCXLxoFuAEe6IRxdPM0lK0HJylzJcnQDNNIN4UA3gCPdEA50k-YDRoIDRprvr0A3aS5ZCUpWcko2v-VYJcvGkW6skmXjSDdzyUpQspJzgc8_ddYNno0j3Vh3eDaOdDMfMAocMMr8J5GsbtOnn_4PAAD__ygb0uo=

query T
EXPLAIN (DISTSQL) (SELECT x FROM xyz WHERE x < 2) INTERSECT (SELECT x FROM xyz WHERE x >= 2) ORDER BY x
----
distribution: full
vectorized: true
·
• sort
│ order: +x
│
└── • intersect
    │
    ├── • filter
    │   │ filter: x < 2
    │   │
    │   └── • scan
    │         missing stats
    │         table: xyz@primary
    │         spans: FULL SCAN
    │
    └── • filter
        │ filter: x >= 2
        │
        └── • scan
              missing stats
              table: xyz@primary
              spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy82Ftv4kYYBuD7_gprrhLVyMzBBCytlG3DapEobAGprdpcsDBNkFhMbSPBRvnvFbCJw8Hf62HGuQvg198h9iPwE0v_m7OItf_80v3Y6XlXd53haPh799q7Gra77V9H3tr7NOj_5q03370_PrcHbW_t_bOq1-XEE9depzdqD4bbw9Dh-sP2-P7grj3wfvnLWzOfLeKp7o2_6ZRFfzPOfCaYzyTzmWI-C9m9z5ZJPNFpGifbQ552gc50zaK6z2aL5Srbvn3vs0mcaBY9sWyWzTWL2Gj8da4HejzVSVBnPpvqbDyb78qsN99vl8ns2zjZMJ8Nl-NFGnm1YFu5v8oi75az-2efxassP32ajR80i_izX76FT7N5phOdBOFh_f372zr5WqIo6vRGzcLCwqTw29m5u-HlRcNzMP0ED69MCt_N0my2mGSBOJr8ZLI883XjPY7TxzPH502ElzUROm2iUdhEfp7VIk6mOtHTgzPtzlLYpkS7ylu4qaoFtKm8haZFC_5FXX4ep49DnfWXgTra1Giz1NEbAz92u8xnc_1vdnXLrz8ks4fH3V8l7q-WyRU2jJNMJ4E62drPxXjVS-zt3Ep-nPVMF724Fi-DsH685PP1D_XkBoiVMCwQtUAaEw6aeFWs4Zpwk-ldji8vGp-D-Y0RB4VzP3mFiJduolEh4tydoGhXRYg7bAFtqghxsxasEefvhDi4wl4QP9laacRFeUZEGUVkLVDGiIImXhW5cY2owfTc5fjyovE5mN8YUVA490tUiGjpJm4qRFS4EwztqghRhy2gTRUhataCNaLinRAFV9gLoidbK42oLM-ILKOIqu1-8pshCpp4VaTpGlGD6bnL8eVF43MwvzGioHDul6wQ0dJNNCtEVLoTDO2qCFGHLaBNFSFq1oI1ovKdEAVX2AuiJ1srjagqz4gqo0hYMyYUtPBqSMs1oQazc3fDy4uG52B6Y0BB4dwuVSGgpZtoVQiocqcX2lURoA5bQJsqAtSsBWtA1TsBCq6wF0BPtnbR89gzBQY6XcaLVJd61FrfLk1PH_T-n5DGq2SivyTxZFdm_7K_y-3emOo023_K9y86i_1H2wbfhjkZDumwIMOSDksyrOiwOg7zt-HGQZibhfmNTVpYpaVVWoF0SKatwrxpkxZWaWmVViDdIC9TEL4xCIvjcJMMt-gbpEWjUKf75rQpIUKFVoULEKdd4Q0Qp2XhgBZ-cpMdxoGJnL7cAE0gjWwCcYQTiCOdQBzxxE9uNROfQBoBBeJIKBBHRIE4MorTzvAWiNPSHMVPnOK0NaIOvkSA7y-AKkFbI4A1grZGAGsEbY0A1gjaGoG-f1lZA9LIGhBH1oA4sgbEkTXCyhqQRtaAOLIGxJE1II6sEbQ1AlgjaGsEsEbQ1khgjbSzRtLWSGCNBL-XgDWStkYCayRtjQTWSCtrQBpZA-LIGhBH1oA4skZaWQPSyBoQR9aAOLIGxJE1krZGAmskbY0E1kjaGgWsUXbWKNoaBaxRtDUKWKPA0xn0eIa2RgFrlJU1IA2f79hZA-LwCY-dNcrKGpBG1oA4sgbEkTUgjqxRtDUKWKNoaxSwRtHWhMCa0NCa--ef_g8AAP__HWJhhQ==

# INTERSECT ALL and INTERSECT with some overlap.
query T
EXPLAIN (DISTSQL) (SELECT y FROM xyz WHERE x < 3) INTERSECT ALL (SELECT y FROM xyz WHERE x >= 1) ORDER BY y
----
distribution: full
vectorized: true
·
• sort
│ order: +y
│
└── • intersect all
    │
    ├── • filter
    │   │ filter: x < 3
    │   │
    │   └── • scan
    │         missing stats
    │         table: xyz@primary
    │         spans: FULL SCAN
    │
    └── • filter
        │ filter: x >= 1
        │
        └── • scan
              missing stats
              table: xyz@primary
              spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzEmF1v4kYYhe_7K0bvVaIamZkxX5ZWYttltUgUtoDUVi0XXpgmSCx2bSOFRPnvlWEDsU3meAwxd8vH43n3eJ4zJk8U_bcil3p_fh187A_Zzaf-ZDr5fXDLbia9Qe_XKduyz-PRb-xh-8j--NIb99gD-2dTr8s5k7esP5z2xpPkax8HA4ioD4zfstH4U2_MfvmLbcmitb9QQ--7isj9mzhZJMgiSRY5ZFGDZhYFoT9XUeSHyVeedkB_8UBu3aLlOtjEydszi-Z-qMh9ongZrxS5NPW-rdRYeQsV2nWyaKFib7naLfOwfewG4fK7FyYTTAJvHbmsZicrjzaxy7rc6gqaPVvkb-LjClHs3Sly-bNVfIrPy1WsQhXajfQI-_eTpY7JuK7bH07bhymyIxyv-m3L7r3oPn3JLqfZ83FMYTLm67D4RdOSpdLiIK45k5dNy3lzzON1Nms_XKhQLVJXmiUk-sqJ_-sXL7qfqHgU2CIT-HQbKDdtFlm0Uv_GN11--yFc3t3v_nW8AW-m3zBJf-KHsQpt0cgm9fOb128WiO1UIj8uemKIoV_zA1vWsxmfXL6VWp4b7PECW9wWNVuWqQQwx2GTN69bCSZxXTgvWSovDgJ751Lg1ZYCr6gUQPovpdAsWwqi-DYTRXaZrNlOGSvBHIdd1rqulQZx8QvnJUvlxUFg72ylqNZKUZGVIP0XK1tlrZTFt5ksssuc2u4J19hKMMdhl7Wva6VBXPzCeclSeXEQ2DtbKau1UlZkJUj_xcp2WSud4tvMKbLLGrUyToIpDnusc10nDcLiF01LlkqLg7je2UinWiOdiowE6b8Y2bnET9oT1x-rKPDXkSr0a7WeZKYWd2p_DyJ_E87V19Cf75bZvxztuN0bCxXF-0_5_kV_vf8oGfA1zLMwfw07KViYwZyfRbfOoYU8i-7oaaFNXOoTlwaJczM4k7gp3TqHziRuSnf0tKNNvKFPvKGFm_qVm_p7DfRqaem2Hm6f46YeRm4CGripp5GbgAZudvRtWAd1mCtTEzsBjfREOPAT4EhQhANDea5S08ELELy-U4GkPNcu6cUdsHiuXoxOQT0Nj0GAo3NQj8ODEODANq7vVt4Ewefa1Ug3PQ11AzjSTY9D3QCOdNOfLBwcLTxXska66UtWgJIVJiWbf_gyKlljHOgGcKQbwtGDp75kBShZkStZE90AjXRDONAN4Eg3hAPdhP6AEeCAEfrnV6Cb0JesACUrTEo2v-WMStYYR7oZlawxjnTTl6wAJStMHuDzd93oCd4YR7oZPcMb40g3_QEjwQEj9X8Syeo2e_7p_wAAAP__PE7xoQ==

query T
EXPLAIN (DISTSQL) (SELECT y FROM xyz WHERE x < 3) INTERSECT (SELECT y FROM xyz WHERE x >= 1) ORDER BY y
----
distribution: full
vectorized: true
·
• sort
│ order: +y
│
└── • intersect
    │
    ├── • filter
    │   │ filter: x < 3
    │   │
    │   └── • scan
    │         missing stats
    │         table: xyz@primary
    │         spans: FULL SCAN
    │
    └── • filter
        │ filter: x >= 1
        │
        └── • scan
              missing stats
              table: xyz@primary
              spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy82F1v2lYcBvD7fQrrXCWakTkv5sVSJbqFqkgMOkDapi0XFM4SJIqZbaTQKN99AhocXvx_jn3s3DWEh_P0qf0T9TOL_1uygHX__NL_2Bs4N3e98WT8e__WuRl3-91fJ87W-TQa_uY8bb87f3zujrrOk_PPpl6XM0feOr3BpDsa796G3q4_OPzWGY7uuiPnl7-cLXPZKpzrwfSbjlnwN-PMZYK5TDKXKeYyn927bB2FMx3HYbR7y_M-0Js_saDussVqvUl2L9-7bBZGmgXPLFkkS80CNpl-XeqRns515NWZy-Y6mS6W-2Oett8762jxbRrtGozX01UcODVvd_JwkwROh7sdwe5fXBZukvSEOJk-aBbwF9e8xafFMtGRjjz_tMLh9d1R6TJBEPQGk9axRXYFkafC2yF4qUvIQktwMMXMkeZLqDwV7hZxsljNEk-czdDhZwekma9b53EaP155f1rCL1bCL7VEI7NE-jmbVRjNdaTnJ5-0_5TMmhJtlVZoVlUBLZVWaFlUcAu1_DyNH8c6Ga49dbbUZLvWwRsdP_b7zGVL_W9y0-G3H6LFw-P-T-nNlvnXaue5wsZhlOjIUxer_ZxtWt1gt2uT_PjUKy0GYS1ce379fOTr55-iynOIZgCaJ2qeLII76HEkrVEd7nmmKHkLWWgLDsaw4B1USGXlFfJuXKJRIe-8PFvRVlm8l1gBLZXFe74K1rzzd-IdXGGvvF-sZsy7MDdFmJAia54qwivocSSlWR2vOabgJW8hC23BwRgWvIIKqWyiQl6NSzQr5FWUZxvaKovXEiugpbJ4zVfBmlfxTryCK-yV14vVjHmV5qZIE1JUbf_0IDevoMeRlFZ1vOaYgpe8hSy0BQdjWPAKKqSyyQp5NS7RqpBXWZ5taKssXkusgJbK4jVfBWte5TvxCq6wV14vVjPmVZmbokxI8WtFcAUtjqC0q8M1xxC81CVkoSU4mMKCVlAhVU1VSKtxiXaFtKryXENbZdFaYgW0VBat-SpY06reiVZwhb3SerFaoee-Vw4Y6XgdrmJt9Ei3vhtNzx_04R8hDjfRTH-Jwtn-mMOPw31u_8Jcx8nht_zwQ291-NWu4NswJ8M-HRZkWNJhSYYVHVbnYf423DgJ83xh3rRJC6u0tEorkPbJtFWYt2zSwiotrdIKpBvkZQrCzRxhcR5ukeE2fYO0aRTqdG9Om-IjVGhVuABx2hXeAHFaFg5o4Rc32WkcmMjpyw3QBNLIJhBHOIE40gnEEU_84lbL4xNII6BAHAkF4ogoEEdGcdoZ3gZxWpqz-IVTnLZG1MGXCPD9BVAlaGsEsEbQ1ghgjaCtEcAaQVsj0PcvK2tAGlkD4sgaEEfWgDiyRlhZA9LIGhBH1oA4sgbEkTWCtkYAawRtjQDWCNoaCayRdtZI2hoJrJHg_0vAGklbI4E1krZGAmuklTUgjawBcWQNiCNrQBxZI62sAWlkDYgja0AcWQPiyBpJWyOBNZK2RgJrJG2NAtYoO2sUbY0C1ijaGgWsUeDpDHo8Q1ujgDXKyhqQhs937KwBcfiEx84aZWUNSCNrQBxZA-LIGhBH1ijaGgWsUbQ1ClijaGt8YI2f05r7l5_-DwAA__9zsYA8

# INTERSECT ALL and INTERSECT with swapped column orders.
query T
EXPLAIN (DISTSQL) SELECT x, y FROM xyz INTERSECT ALL SELECT y, x from xyz
----
distribution: full
vectorized: true
·
• intersect all
│
├── • scan
│     missing stats
│     table: xyz@primary
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: xyz@primary
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzEll2L2kAUhu_7K8K52oUJcfLhroGCS2upYHVrvCiUXGTNVAU3SWcimBX_e0ncrfWjczIdTS9j8sy8M-cB3w2In0vwofftcfDQHxo3H_vBJPg6uDWC3qD3YWKsiVEYn8ajL8a6eDH6w0lvHJS_PwwGb58UxFj__gQIJGnMhtEzE-B_BwoEbCDgAAEXCHgQEsh4OmVCpLz8ZFMB_XgNfovAIslWeflzSGCacgb-BvJFvmTgwyR6WrIxi2LGrRYQiFkeLZbVNuvipZvxxXPECyAQZFEifMO0yp1Hq9w3ujbpUgi3BNJV_rrDfuGnwphHYn64ZJeSrg3hNiQg8mjGwKdb8m9hPcWwrztrhbX_Gna_1CpJecw4iw8WC0sS--TMiT9HYh6wfJRZ9Gg6kyJj_qE8QGDJfuQ3VfDb93wxm789yK5hfz5H43xnwg9TM80s6h3fxNm93YO9aX0RaA0RLNu0nCt6qxC3rRz38ubSZs2lTZtr1x-HXWccjmm5V7RHIe6dctzL22M3a4_dtD1O_XE4dcbhmtWf1bXsUYh7rxz38vY4zdrjNG2PW38cbp1xeOYV3VEI21EMe3lz3GbNcf9n3zoTbcxEliaC1WpTrfJwLJ6x3WWJdMWn7JGn02qb3eOo4qo2EDOR797au4d-Ur2qBlAfbuvAHR2YauWmnpymCldG1eC2DtzRgalW7qMrO6HtY7r1J-3IYUcK08M7ax3Tro7gchgRXA4jgsthTHCERgT3dASXw4jgchgRXA5jgiM0InhbR_A7HUXlMKKoHEYUlcOYogiNKHqvo6gcRhSVw4iichhTFKERRTs6ilKtnoDQiKQIjViK0JimGI51Bb2yoNcW9OqCZl_QKwxUqzHQk8qgZKucxmyV05itchq1FcExW1XK0umtq7QlVRqzVakvKeOYrSflQWpruH33KwAA___e7YZe

query T
EXPLAIN (DISTSQL) SELECT x, y FROM xyz INTERSECT SELECT y, x from xyz
----
distribution: full
vectorized: true
·
• intersect
│
├── • scan
│     missing stats
│     table: xyz@primary
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: xyz@primary
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzEmFFv4kYUhd_7K6z7tCsNgpmxgViqlFU3VZFosg08VKry4IVpgsRiahsJNsp_rzBtndj4nhlsp4_gfMzxjc_HDM-U_rWmkG5-_zL9NLn1PnyezOaz36YfvdnN9OanubcX3sH7-f7uV29_-O5Nbuc397Pj-_9cPghv_99lErSJl-Y2-mZSCv8gSYIUCdIkyCdBAT0I2ibxwqRpnBz_5DkHJss9hQNBq812lx3ffhC0iBND4TNlq2xtKKR59HVt7k20NEl_QIKWJotW63yZ_eH79TZZfYuSAwmabaNNGnq9_nHlu10WetdKXEt6eBEU77JihTSLHg2F8kVcliJwTCHFtapNoVxSfF6l2WqzyPqyNIlzaxTY14P3FKVP55Eiir4sStBBFL82SvFRu02cLE1ilm8-LP-U2rDKYm5FiqCrFBYjK1IMG6QQFwX9JUqfZia72_Z1aV7zw9aEr2TwaTolQWvzZ_Yhv4mPPyarx6d_X9g1YNTulG_jXrzt66A8ibNrj9-sLe0dIC0c0Fe9vr7ERQ45hs45HGwEchQKkJ3byDrKsHMbyfY8YDG3Ohu1mMJiZHU2ckvR2EbyvW2k7JuobJqoe33_EiM45Bg553AwAshR1FB1bgTrKKPOjaDa66LF3OqM0GIKi5HVGcEtRWMjqPc2grZvorZpot_LzxPORnDIMXbO4WAEkKOooe7cCNZRxp0bQbfXRYu51RmhxRQWI6szgluKxkbQ720E376Jvk0Tg94lPnBIceWYwsEGIEVRQb9zG1hHuercBn57PbSYW50NWkxhMbI6G7ilaGwD___8_eJMtHuTbuNNaqx-nRgcb84sH81pWGm8SxbmSxIv8mVOL-9yLn9jadLsdFWfXkw2p0vHgK9hycKKh1UZlq9h_w0s3WCpGtFXTWg1bEJrzdOapYMmsGy0tBo0okdNaA0eFp99TMH_K3CAVRkesjC46RFfzSFfrzFLS8nTVzw9AF6oWMWl24BG5UY4aDfAUb0BjvotK0p1KTigUcMBjiqOcPC4AxyVXFbE-vaRRXhFMRxeKbrkHYNunZeMHIO68ZqRI4BXROPUVp6GbQU4aiuPw7byOGxrRbJObeVp2FYeh20FOHpkeRy2lf-CURJsovhtawmvtFXxG1dw64o3jQrAvpc3jfIBXjGN076Zp-HGGeBo58zjcOvM46itqmJZl7YCGrUV4KitCEePLI-jtir-C0aNAc7vZEt4ta38VhbdOm8aDU6pGhyQwT5a85saMHdAo7YiHLQV4KitAIcnXf6gjI664IjfbHF42AU4Ou2C3wjQU8N_wWg0On4rW8IrbdX8XrZ86w8vP_wdAAD__3KVI_s=

# INTERSECT ALL and INTERSECT with different ORDER BY types.
query T
EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) INTERSECT ALL (SELECT x FROM xyz ORDER BY z) ORDER BY x
----
distribution: full
vectorized: true
·
• sort
│ order: +x
│
└── • intersect all
    │
    ├── • scan
    │     missing stats
    │     table: xyz@primary
    │     spans: FULL SCAN
    │
    └── • scan
          missing stats
          table: xyz@primary
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy8ll9v2jAQwN_3KaJ7KppRYifhT6RJ7VamITHoCA-bJh5S4hUkSjInSNCq330iFLEQ4otJ6zco_p0vd7_r5RmSv0vwoPfzbnDTHxpXt31_4v8YNIwrvzfofZkYG-PrePTd2GyfjNH4tjc2Pv8ytg2jP5z0xv7uwM1gID381Dh-3gCBVRTyYfDIE_B-AwUCDAjYQMABAi5MCcQimvEkicTuyHMG9MMNeBaBxSpep7s_TwnMIsHBe4Z0kS45eDAJ7pd8zIOQC9MCAiFPg8Uyu2azfbqOxeIxEFsg4MfBKvGMprm7ebROPeOawvSFQLROX8Mfo95vjXmQzPPxsvNTAkkaPHDw6Au5LE1Xa5qsNM1jnPUqEiEXPMxFmu5I7MiZZ_0WJHOfp6PYpCcdmWxj7uUtAgJL_ie9uqaNT2LxMM8-lT768bFsler7kUi5MKl7WqmPpfGdCmU7V5HXoGeSGEbNKDaZdVrjs9e7uetpdbloBblM1jTtd5kChURbmhNlpYlqmAOqaQ6Q-h_moHXpHLDq_WVV-ms3TeddRFRItK05UVaaqAYRmSYRkfofRGxfKqJdvb92lf46zWwtv72ICol2NCfKShPVIKKtSUSk_gcRO5eK6FTvr1Olv27zXTRUSLOrNU1WmqYGCR1NEiLVP0jYfYvX0zPxxzyJo1XCK715Wrua8fCB73uQRGsx43cimmXX7L-OMi573Qh5ku5_Zfsv_VX2U9bX6nC7DkxpLdqtRXflNFWoGVWD23Xgk5qp0m4tuiun2Slt_U_bOdg6hW0p7MhvdqQwo_Kr3TrzIYeR-ZDD2HwgNDIfCI3MR6vOfMhhZD7kMDYfCI3MB0Ij89GWWtqRS9qpMx_dOobLYcRwOYwZjtCI4QiNbQCVtVn8T6qyN1VpdAkobU5lHNGcFrZITlXK5KJT-RpBTKeFPaKiOkIjriM0JjuGI7ZjOKZ7YYcq6S6nMd3lNKo7gmO6Izime2GR5nVvIboXdoqS7oWdoqS7nMZ0l9Oo7giO6Y7gmO6Ffaqku5zGdJfTqO4IjumO4Jjuha2af9e25Lqzwm6R6j59-fAvAAD__yMAfUs=

query T
EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) INTERSECT (SELECT x FROM xyz ORDER BY z) ORDER BY x
----
distribution: full
vectorized: true
·
• sort
│ order: +x
│
└── • intersect
    │
    ├── • scan
    │     missing stats
    │     table: xyz@primary
    │     spans: FULL SCAN
    │
    └── • scan
          missing stats
          table: xyz@primary
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy8mE1v6kYUhvf9FdZZJaoRzIz5slQptw1VkWi4BRatqix8YZogcTG1jQSJ8t8roJETBp93Jrazy4cfz-vDvI_GPFP674pCGvz5dfRleOdd3Q6ns-kfo2vvajoYDX6ZeTvv18n4d2-3f_LGk9vBxPv5L29_7Q3vZoPJ9HABd-HTdf7zjnxaxwt9F33XKYV_kyCfJPmkyKeAfGrTvU-bJJ7rNI2TwyXPR2C42FHY8mm53myzw5_vfZrHiabwmbJlttIU0iz6ttITHS100myRTwudRcvVcZnd_ulmkyy_R8mefJpuonUaeo3mYeXxNgu9G0H3Lz7F2yy_fZpFD5pC8eJ_LEK7sgjSJcLtMs2W63nWFGczMBbImW977zFKHy9cn4dQHwvRrjREUBgiv892HScLnejFuzsd71IYU6JZ5RHadUVAk8ojdEpE8D-U8rcofZzqbLxpqrNJzfYbHb4xwZfRiHxa6X-yqxtx_VOyfHg8_mSxzbsuO2waJ5lOmsqY2o-F9-9ZjO3SRP6_6YUQd3Ej3jSD1vmMLy7ff7e8sBeJsBBJUzaaytlmDiE6FYaQLiFylYgafWYdolOjz0R1MkGzKvJZhRHQpIp85hahtM_EJ_kM7LBXnxlTs_WZtO-ytOmyajQDZ6E4hOhWGEK6hMi7LGsUinWIbo1CkdW1Gc2qSCgVRkCTKhKKW4TSQpGfJBSww16FYkzNVijKvsvKpstB4_hK5CYUhxC9CkNIlxB5l1WNQrEO0atRKKq6NqNZFQmlwghoUkVCcYtQWijqk4QCdtirUIyp2QolsO9yYNPldsNZJw4R-pVFkC4R8h4HNcrEOkS_RpkE1TUZzapIJhVGQJMqkolbhNIyCT5JJmCHvcrEmNpHvr65cP-JTjfxOtVW38y0DjPTiwd9-gzSeJvM9dcknh-XOf06PnLHPyx0mp3-q06_DNenfx0CvoUFC0selueweAsH72DhBgtVhpaiFN0vQ6suTyuWbpeBBRg5T0tZhlatUnSPpwN2m3Z4uO0Ay3O4w8JdviBdFgbP3GPhQPBL91lagGYLXioCLC4MrbiYAdBIDQBHbkA4kAPAkR0ELxegB0AjPwAcCQLgyBAIB3URhmHeb1k0Ol4xZ7ihCcFLRnRAYXjNoEfnPSNbYHHeNKIPcEM1TmXnaVh2HodlBzgqO4-jskvDsi5lBzQqO8BR2QGOyo5wsOMlOLei06OhGg43yi551cgAHJt51aBH500je2Bx3jQSnGikoRqnMz9Pw0M_j8NTP8DRsZ_HYdkNyzqVnadh2Xkclp3HYdkBjnY8f5ZV4GNX4AVZ8GVXvGoUOEkrXjXg0RVvGgWOFYo3jWoD3FCNS9kBjcoOcFR2hIOyAxy-5BuWdXrL52n4ms_j8D2fx-GLPsDRjufPsgp9bvxZ9gw3y86rJgAn6YBXzfmj37_88F8AAAD__zvnDFs=

# INTERSECT ALL and INTERSECT with different numbers of ORDER BY columns.
query T
EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) INTERSECT ALL (SELECT x FROM xyz ORDER BY y, z) ORDER BY x
----
distribution: full
vectorized: true
·
• sort
│ order: +x
│
└── • intersect all
    │
    ├── • scan
    │     missing stats
    │     table: xyz@primary
    │     spans: FULL SCAN
    │
    └── • scan
          missing stats
          table: xyz@primary
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy8ll9v2jAQwN_3KaJ7KppRYifhT6RJ7VamITHoCA-bJh5S4hUkSjInSNCq330iFLEQ4otJ67em8c--3P2O8zMkf5fgQe_n3eCmPzSubvv-xP8xaBhXfm_Q-zIxNsbX8ei7sdk-GaPxbW9sfP5lbBtGfzjpjf3dgpvBQL6YGE-N4-MGCKyikA-DR56A9xsoEGBAwAYCDhBwYUogFtGMJ0kkdkueM6AfbsCzCCxW8Trd_XtKYBYJDt4zpIt0ycGDSXC_5GMehFyYFhAIeRosltkxm-3TdSwWj4HYAgE_DlaJZzTN3cmjdeoZ1xSmLwSidfq6_XHX-60xD5J5fr9s_ZRAkgYPHDz6Qi4L09UaJisN87jPehWJkAse5naa7khsyZlv_RYkc5-no9ikJxWZbGPu5UUCAkv-J726po1PYvEwz_4q_fTjZ9kq2fcjkXJhUvc0Ux9L93cqpO1cRl43PRPEMGpGscms0xyfPd7NHU-ry0UryGWypmm_SxcoBNrSHCgrDVRDH1BNfYDk_9AHrUv7gFWvL6tSX7tpOu8iokKgbc2BstJANYjINImI5P8gYvtSEe3q9bWr1NdpZmP57UVUCLSjOVBWGqgGEW1NIiL5P4jYuVREp3p9nSr1dZvvoqFCmF2tYbLSMDVI6GiSEMn-QcLuW1xPz-w_5kkcrRJe6eZp7XLGwwe-r0ESrcWM34lolh2zfxxlXHbdCHmS7t-y_UN_lb3K6lodbteBKa1Fu7XorpymCjmjanC7DnySM1XarUV35TQ7pa3_aTsHW6ewLYUd-cmOFGZUfrRbpz_kMNIfchjrD4RG-gOhkf5o1ekPOYz0hxzG-gOhkf5AaKQ_2lJLO3JJO3X6o1vHcDmMGC6HMcMRGjEcobEJoDI2i7-kKnNTlUaHgNLkVMYRzWlhiuRUpUwuOpWPEcR0WpgjKqojNOI6QmOyYzhiO4ZjuhdmqJLuchrTXU6juiM4pjuCY7oXBmle9xaie2GmKOlemClKustpTHc5jeqO4JjuCI7pXpinSrrLaUx3OY3qjuCY7giO6V6Yqvm7tiXXnRVmi1T36cuHfwEAAP__dYp-EA==

query T
EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) INTERSECT (SELECT x FROM xyz ORDER BY y, z) ORDER BY x
----
distribution: full
vectorized: true
·
• sort
│ order: +x
│
└── • intersect
    │
    ├── • scan
    │     missing stats
    │     table: xyz@primary
    │     spans: FULL SCAN
    │
    └── • scan
          missing stats
          table: xyz@primary
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy8mE9v6kYUxff9FNZdJaoRzIz5Z6lSXhuqItHwCixaVVn4wTRB4mFqGwkS5btXQCMnDL5nJrazC4l_nuPLnJ_Geab03xWFNPjz6-jL8M67uh1OZ9M_Rtfe1XQwGvwy83ber5Px795u_-SNJ7eDiffzX97-2hvezQaT6eEC9kLfe7rOP-7Ip3W80HfRd51S-DcJ8kmST4p8CsinNt37tEniuU7TODlc8nwEhosdhS2fluvNNjv8-t6neZxoCp8pW2YrTSHNom8rPdHRQifNFvm00Fm0XB2X2e2fbjbJ8nuU7Mmn6SZap6HXaB5WHm-z0LsRdP_iU7zN8tunWfSgKRQv_scitCuLIF0i3C7TbLmeZ01xNgNjgZz5tvceo_TxwvV5CPWxEO1KQwSFIfL7bNdxstCJXry70_EuhTElmlUeoV1XBDSpPEKnRAT_Qyl_i9LHqc7Gm6Y6m9Rsv9HhGxl8GY3Ip5X-J7u6Edc_JcuHx-NPFtu867LDpnGS6aSpjKn9WHj_nsXYLk3k_5teCHEXN-JNM2idz_ji8v13ywt7kQgLkTRlo6mcbeYQolNhCOkSIleJqNFn1iE6NfpMVCcTNKsin1UYAU2qyGduEUr7THySz8AOe_WZMTVbn0n7LkubLqtGM3AWikOIboUhpEuIvMuyRqFYh-jWKBRZXZvRrIqEUmEENKkiobhFKC0U-UlCATvsVSjG1GyFouy7rGy6HDSOr0RuQnEI0aswhHQJkXdZ1SgU6xC9GoWiqmszmlWRUCqMgCZVJBS3CKWFoj5JKGCHvQrFmJqtUAL7Lgc2XW43nHXiEKFfWQTpEiHvcVCjTKxD9GuUSVBdk9GsimRSYQQ0qSKZuEUoLZPgk2QCdtirTIypfeTfNxfuP9HpJl6n2uo_M63DzPTiQZ--gzTeJnP9NYnnx2VOH8dH7viLhU6z01_V6cNwffrTIeBbWLCw5GF5Dou3cPAOFm6wUGVoKUrR_TK06vK0Yul2GViAkfO0lGVo1SpF93g6YLdph4fbDrA8hzss3OUL0mVh8Mw9Fg4Ev3SfpQVotuClIsDiwtCKixkAjdQAcOQGhAM5ABzZQfByAXoANPIDwJEgAI4MgXBQF2EY5v2WRaPjFXOGG5oQvGREBxSG1wx6dN4zsgUW500j-gA3VONUdp6GZedxWHaAo7LzOCq7NCzrUnZAo7IDHJUd4KjsCAc7XoJzKzo9GqrhcKPskleNDMCxmVcNenTeNLIHFudNI8GJRhqqcTrz8zQ89PM4PPUDHB37eRyW3bCsU9l5Gpadx2HZeRyWHeBox_NnWQW-dgVekAVfdsWrRoGTtOJVAx5d8aZR4FiheNOoNsAN1biUHdCo7ABHZUc4KDvA4Uu-YVmnt3yehq_5PA7f83kcvugDHO14_iyr0PfGn2XPcLPsvGoCcJIOeNWcP_r9yw__BQAA__8-7g0g

# INTERSECT ALL and INTERSECT with compatible ORDER BY columns that are not in the final result.
query T
EXPLAIN (DISTSQL) (SELECT y FROM xyz ORDER BY z) INTERSECT ALL (SELECT y FROM xyz ORDER BY z)
----
distribution: full
vectorized: true
·
• intersect all
│
├── • scan
│     missing stats
│     table: xyz@primary
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: xyz@primary
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzElkFv2jAYhu_7FdZ3aiWjYCfQEmkS3co0JAYdcNg05ZASryDRJIuD1LTiv08J0zoC-Ivn4d1K48d-_eWR8r6A_LEGHwZf7kY3wzG5uB3O5rPPo0tyMRuMBu_npCAfppNP5Kl4JpPp7WBK3n0lz5dkOJ4PprNywc1ohCwGCnESiXH4KCT434ABBQ4UXKDgAYUOBBTSLFkIKZOsXPJSAcPoCfw2hVWcbvLy3wGFRZIJ8F8gX-VrAT7Mw_u1mIowEpnTBgqRyMPVujrmqXjup9nqMcwKoDBLw1j6pOWUJ082uU_6HIIthWST_9r-ddf7gixDudzfr88g2AYUZB4-CPDZlv5dzI7VmPxkzNd9NnGSRSIT0d5OQUliS47c9WMolzORT1KH1d7IvEiFv68OUFiL7_lFn12-zVYPy-qv31dntau_Xss1uNaRzOOklaQO69QHcPRsb-9s1vzNswZv3uEtxz2LohpBu5aD8pNBLUjKLEnKm8-fN5m_23K8s4iiEfTKclB-MqgFUbglUdzm83ebzN9rVd-cfy-KRtBry0H5yaAWRHEtieI1n7_XZP6d1lk00YjZsxqTn4xpQRLvP3SjI4mmQqZJLEWj5tMu7ySiB7GbkUw22ULcZcmiOmb3c1Jx1Vc8EjLfPeW7H8O4elTNvTncNYF7JjAzys06apppjIzpwV0TuGcCM6PctZEd0LxOt_-kXTXsKmG2P7N2nfZMBFfDiOBqGBFcDWOCIzQieMdEcDWMCK6GEcHVMCY4QiOCd00EvzJRVA0jiqphRFE1jCmK0Iii1yaKqmFEUTWMKKqGMUURGlG0Z6IoM-oJCI1IitCIpQiNaYrhWFcwKwtmbcGsLhj2BbPCwIwaAzuoDFq2qmnMVjWN2aqmUVsRHLNVpywdTl2nLenSmK1afUkbx2w9KA9KW4Ptm58BAAD__1VGdco=

query T
EXPLAIN (DISTSQL) (SELECT y FROM xyz ORDER BY z) INTERSECT ALL (SELECT y FROM xyz ORDER BY z)
----
distribution: full
vectorized: true
·
• intersect all
│
├── • scan
│     missing stats
│     table: xyz@primary
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: xyz@primary
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzElkFv2jAYhu_7FdZ3aiWjYCfQEmkS3co0JAYdcNg05ZASryDRJIuD1LTiv08J0zoC-Ivn4d1K48d-_eWR8r6A_LEGHwZf7kY3wzG5uB3O5rPPo0tyMRuMBu_npCAfppNP5Kl4JpPp7WBK3n0lz5dkOJ4PprNywc1ohCwGCnESiXH4KCT434ABBQ4UXKDgAYUOBBTSLFkIKZOsXPJSAcPoCfw2hVWcbvLy3wGFRZIJ8F8gX-VrAT7Mw_u1mIowEpnTBgqRyMPVujrmqXjup9nqMcwKoDBLw1j6pOWUJ082uU_6HIIthWST_9r-ddf7gixDudzfr88g2AYUZB4-CPDZlv5dzI7VmPxkzNd9NnGSRSIT0d5OQUliS47c9WMolzORT1KH1d7IvEiFv68OUFiL7_lFn12-zVYPy-qv31dntau_Xss1uNaRzOOklaQO69QHcPRsb-9s1vzNswZv3uEtxz2LohpBu5aD8pNBLUjKLEnKm8-fN5m_23K8s4iiEfTKclB-MqgFUbglUdzm83ebzN9rVd-cfy-KRtBry0H5yaAWRHEtieI1n7_XZP6d1lk00YjZsxqTn4xpQRLvP3SjI4mmQqZJLEWj5tMu7ySiB7GbkUw22ULcZcmiOmb3c1Jx1Vc8EjLfPeW7H8O4elTNvTncNYF7JjAzys06apppjIzpwV0TuGcCM6PctZEd0LxOt_-kXTXsKmG2P7N2nfZMBFfDiOBqGBFcDWOCIzQieMdEcDWMCK6GEcHVMCY4QiOCd00EvzJRVA0jiqphRFE1jCmK0Iii1yaKqmFEUTWMKKqGMUURGlG0Z6IoM-oJCI1IitCIpQiNaYrhWFcwKwtmbcGsLhj2BbPCwIwaAzuoDFq2qmnMVjWN2aqmUVsRHLNVpywdTl2nLenSmK1afUkbx2w9KA9KW4Ptm58BAAD__1VGdco=

# INTERSECT ALL and INTERSECT with a projection on the result.
query T
EXPLAIN (DISTSQL) SELECT x FROM ((SELECT x, y FROM xyz) INTERSECT ALL (SELECT x, y FROM xyz))
----
distribution: full
vectorized: true
·
• intersect all
│
├── • scan
│     missing stats
│     table: xyz@primary
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: xyz@primary
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzElkGPmkAYhu_9FeQ7aTIGZwB3JWmym9amJla34qFJw4GV6WriAmUwkd3sf2_Abqyo8zGdCEeEZ-adb57E9xXE7w24MPrxMLkfT43O57G38L5PuoY3mow-LYyd8WU--2Z0Ou_PxMj3P-3yl64xni5Gc694cT-ZGOc_6gKBKA75NHjmAtyfQIEAAwIWELCBgAM-gSSNl1yIOC0-eS2BcbgDt09gHSXbrPjZJ7CMUw7uK2TrbMPBhUXwuOFzHoQ8NftAIORZsN6U2-zyl7skXT8HaQ4EvCSIhGv0zGLn2TZzjTtK7hj4bwTibfZ3h8PCj7mxCsTqeMl3xCcgsuCJg0vfyP-FdVoIyy6GPSy1jeI05CkPjxbzCxL75MyJvwZi5fFslpi0cjuLPOHusT9AYMN_ZZ0yePdjun5avT8cxlCZweFwlsbhziSfxr04MalTHcPZve2jvWl9C2gNC0zWM60rSqsQd9BKXHYxbgPa0ka1ZfXvgtW5C6tn2ldURyHuTStx2cW4DajDGlXHqn8XVp27sHvlf9S11FGIe9tKXHYxbgPqWI2qY9e_C7vOXTi9K4qjEHbYQlh2MWwD2titdawzueZcJHEkeK0G1S9OxsMnvp-UiLfpkj-k8bLcZv84K7myAYRcZPu3bP8wjspX5fTrwwMdeKgDU63c1JHTVGFkVA0e6MBDHZhq5a6M7IRmVbr_L23JYUsK0-OZ9au0rSO4HEYEl8OI4HIYExyhEcEdHcHlMCK4HEYEl8OY4AiNCD7QEfxGR1E5jCgqhxFF5TCmKEIjit7qKCqHEUXlMKKoHMYURWhE0aGOolSrJyA0IilCI5YiNKYphmNdQa8s6LUFvbqg2Rf0CgPVagz0pDIo2SqnMVvlNGarnEZtRXDMVpWydDp1lbakSmO2KvUlZRyz9aQ8SG313z78CQAA__9Al4gH

query T
EXPLAIN (DISTSQL) SELECT x FROM ((SELECT x, y FROM xyz) INTERSECT (SELECT x, y FROM xyz))
----
distribution: full
vectorized: true
·
• intersect
│
├── • scan
│     missing stats
│     table: xyz@primary
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: xyz@primary
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzEmFFv4kYUhd_7K6z7lEiDYGZsIJYqZdVNVSSabAMPlao8eGGaILGY2kYKG-W_VxitnNj4nhlsZx_H5vOcucw5vuMXSv9bU0g3f3-ZfprcehefJ7P57K_ppTe7md78Nveevd_v7_70Li5-jIW3P1563n-_9Ca385v72eHG6R9ckqBNvDS30TeTUvgPSRKkSJAmQT4JCuhB0DaJFyZN4-Twk5ccmCyfKRwIWm22u-xw-UHQIk4MhS-UrbK1oZDm0de1uTfR0iT9AQlamixarfNpnvffr7fJ6luU7EnQbBtt0tDr9Q8z3-2y0LuW4lrRw6ugeJcVM6RZ9GgolK_iPBVBmyqUi4rPqzRbbRZZX5YqcWqOAvu6956i9Ok0UkjR50kJOpDi10opHrXbxMnSJGb57mH5U2rFKou6FSqCrlRYlKxQMWygQpwl9I8ofZqZ7G7b16V6zfdbE77Jg0_TKQlam3-zi3wRl78mq8enH4PCAbWLG7Vb4tu4F2_7OiiX4eTc43dzS_sAkBYB0Fe9vj4niBx0DNvVoVx0FP6XnUeRtZRh51Ek2wsBi7rVRVGLKixKVhdFbioaR5H80ChS9jZUNjbUvb5_Thw46Bi1q0O56Cg8qDqPA2spo87jQLVnRIu61cVBiyosSlYXB24qGseB-tA40PY21DY29Hv5McI5Dhx0jNvVoVx0FB7UnceBtZRx53Gg2zOiRd3q4qBFFRYlq4sDNxWN40B_aBz49jb0bWwY9M4JAwcVV22qUC4qCv_5nUeBtZSrzqPAb8-EFnWri4IWVViUrC4K3FQ0jgL_p32zOKHr3qTbeJMaqy8Sg8PKzPLRHCuVxrtkYb4k8SKf5ji8y7n8wtKk2fGuPg4mm-Otg8C3sGRhxcOqDMu3sP8Olm6wVI3oqya0GjahteZpzdJBE1g2mloNGtGjJrQGm8Vntyn4vwIHWJXhIQuDRY94aw55e41ZWkqevuLpAciFSqq4eBvQyNwIB-4GOLI3wJG_ZSVSXQwOaORwgCOLIxxsd4Ajk8tKsL7fsgivRAyHV4wu-YxBS-dDRo6B3fiYkSOAV4LGya08Dd0KcORWHodu5XHo1krIOrmVp6FbeRy6FeBoy_I4dCv_glESNFF821rCK25VfOMKlq74pFEB6Hv5pFE-wCtJ49Q38zRsnAGOOmceh60zjyO3qkrKurgV0MitAEduRTjasjyO3Kr4F4waA5zvZEt41a18K4uWzieNBqdUDQ7IoI_WfFMD6g5o5FaEA7cCHLkV4PCkyx-U0VEXHPGbTQ4PuwBHp13wjQDtGv4Fo1Hp-Fa2hFfcqvletrz0h9df_g8AAP__x5IlpA==

subtest Except

# Basic EXCEPT ALL and EXCEPT case.
query T
EXPLAIN (DISTSQL) (SELECT y FROM xyz) EXCEPT ALL (SELECT x AS y FROM xyz) ORDER BY y
----
distribution: full
vectorized: true
·
• sort
│ order: +y
│
└── • except all
    │
    ├── • scan
    │     missing stats
    │     table: xyz@primary
    │     spans: FULL SCAN
    │
    └── • scan
          missing stats
          table: xyz@primary
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy8lt9uokAUh-_3Kci5arNjYAbwD8kmdls3a-LWrnjRzYYLKrPVxAo7YKJtfPcNWLdF7BxGlLtS-GYOZ76fhxeI_87Bgd793eCqf6td3PTdsftzcKlduL1B73qsrbVvo-EPbbV-vtR699e9u7F2NRj8v73SrtzcM8PRTW-kff2lrYHAIgz4rf_EY3B-AwUCDAiYQMACAjZ4BCIRTngchyJ95CUD-sEKHIPAbBEtk_TfHoFJKDg4L5DMkjkHB8b-w5yPuB9woRtAIOCJP5tn26zWz91IzJ58kVbgRv4idrSGnu48XCaO1mXgbQiEy-R1-bdVH9ba1I-n-fW6FLyNRyBO_EcODt2Q48q0FcuklcpkH5b5ts5yEYqACx7kVvJSEnvkwLt-9-Opy5NhpNO9ExmvI-68kwcIzPmf5KJLL7-I2eM0--vD9357J1Ol9W4oEi50au-36fOH61slenaoHa-LHijiNmyEkc6M_QYf3N7ObU_Lm0VLmKWzhm6eJQIKhTaVCz1lCGi9IaB1hABp_i4EzWNDwMofLitzuGZDt85ioUKhLeVCT2khq9dCVoeFSPN3FraOtdAsf7hmmcO1Gtk0Pr2FCoW2lQs9pYVmvRaadViINH9nYftYC63yh2uVOVy7cRYHFcrsKJZ5SgOteg206jAQaf3OwM4pPkkPrD_icRQuYl7qa9NIG8aDR749gDhcigm_E-Ek22Z7Ocy47Csj4HGyvcu2F_3F9lZaYHm4VQWmtBJtV6I7cpoq9Iypwa0q8F7PVGm7Et2R02yfNt7TZg429mFTClvy07KkMKPyre0q-ZDDSD7kMJYPhEbygdBIPppV8iGHkXzIYSwfCI3kA6GRfLSklrblkrar5KNTxXA5jBguhzHDERoxHKGxCaAyNou_pCpzU5VGh4DS5FTGEc1pYYrkVKVMLjqVjxHEdFqYIyqqIzTiOkJjsmM4YjuGY7oXZqiS7nIa011Oo7ojOKY7gmO6FwZpXvcmonthpijpXpgpSrrLaUx3OY3qjuCY7giO6V6Yp0q6y2lMdzmN6o7gmO4IjulemKr5b21DrjsrzBap7t7m078AAAD__2ZMc04=

query T
EXPLAIN (DISTSQL) (SELECT y FROM xyz) EXCEPT (SELECT x AS y FROM xyz) ORDER BY y
----
distribution: full
vectorized: true
·
• sort
│ order: +y
│
└── • except
    │
    ├── • scan
    │     missing stats
    │     table: xyz@primary
    │     spans: FULL SCAN
    │
    └── • scan
          missing stats
          table: xyz@primary
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy8mF1v4kYYhe_7K6y5SlQjMzPmy1KlpBuqRqIhBS62qnLhhWmCxGJqGylslP9eYcp68eD3zMQ2d0mcx3P8MufRmDeW_LtiARt-fhzd3j84V3f309n0z9G1czUdjoafZs7O-W0y_sN53X27doafPw0fZ98vvTq305Pr48ndcOL8-pezYy5bRwv1EH5VCQv-Zpy5TDCXSeYyn7msw55ctomjuUqSKN7_y1sG3C9eWdB22XK92ab7Pz-5bB7FigVvLF2mK8UCNgu_rNREhQsVe23msoVKw-UqW-Z19-1mEy-_hvE-wXQTrpPAaXn7lcfbNHBuBHt6d1m0TfPbJ2n4rFjA392PRehYRuClEYRNhLtlki7X89TjhRloC-TMl53zEiYvZ_4_DyE_FqJTawi_NER-n-06ihcqVouTO2V3KY0p0KzyCJ2mIqBJ5RG6FSK4H0r5e5i8TFU63niyMKnZbqOCowBuRyPmspX6J7264de_xMvnl-wngz3es9le0yhOVexJbWQ_l96_bzCzc-P4_6ZnQjxErWjj-e3igM8uPzhZnptbhBtYxBMtT1qrzCJE1zqEqcxAiNwjvEGZGYfoNigzXp9J0KzKZFZjBDSpMpnZRagsM34JmYHtdZSZNjJTmQnzIguTIsuW51vbxCJEzzqEqU1AiLzIokGbGIfoNWgTUV-V0azKbFJjBDSpMpvYRahsE3EJm4DtdbSJNjJTm0jzIkuTIvut7E3IziYWIfrWIUxtAkLkRZYN2sQ4RL9Bm8j6qoxmVWaTGiOgSZXZxC5CZZvIS9gEbK-jTbSRmdrENy-yb1LkTsvaJRYRBpYRTE0CIuQl9hs0iXGIQYMm8eurMZpVmUlqjIAmVWYSuwiVTeJfwiRgex1Noo3sI1_ZnLn_RCWbaJ0oo29j2vuBqcWzOnwASbSN5-oxjubZModfxxmX_WGhkvRwVRx-uV8fLu0D_ghzEpY0LIow_xH2T2BuB3NZhRa8Ej2oQsseTUuS7lSBORg5TQtRhZbtSnSfpn1ym3ZpuGMBiyLcJeEeXZAeCYNn7pOwz-mlByTNAc1pqXBkFU0rNmYANFIDwJEbEA7kAHBkB07LBegB0MgPAEeCADgyBMJBXbhmmNMti0ZHK6aAa5rgtGR4FxSG1gx6dNozfAAWp00j2gDXVGNVdpqGZadxWHaAo7LTOCq70CxrU3ZAo7IDHJUd4KjsCAc7XtDnVoFOj5pqKFwru6BVI3xwbKZVgx6dNo0ARxJBm0b0Aa6pxurMT9Pw0E_j8NQPcHTsp3FYds2yVmWnaVh2Godlp3FYdoCjHU-fZSX42CV9li3gWtkleEUGR2FJqwY8uqRNIztgcdo0EpxKpKYam7IDGpUd4KjsCAdlBzh8ydcsa_WWT9PwNZ_G4Xs-jcMXfYCjHU-fZSX63OizbAHXy06rxgdHYZ9WTfHRn95_-i8AAP__7rUCXg==

# EXCEPT ALL and EXCEPT with MergeJoiner.
query T
EXPLAIN (DISTSQL) (SELECT y FROM xyz ORDER BY y) EXCEPT ALL (SELECT y FROM xyz ORDER BY y)
----
distribution: full
vectorized: true
·
• except all
│
├── • scan
│     missing stats
│     table: xyz@primary
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: xyz@primary
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy8lkFv2jAYhu_7FdZ3aiWjYCfQEmkSXcs0JFY64NBpyiElXkGiSRYHqWnFf58SprUE8BfPw7fS5LFff36kvK8gf63Ah8H93ehqeEvObobT2fTb6JycTQejwfWMFOTzZPyVPBcvZDy5GUzIp--kOCeD--vB3YxcjUbIm0AhTiJxGz4JCf4PYECBAwUXKHhAoQMBhTRL5kLKJCtfea2AYfQMfpvCMk7XefnvgMI8yQT4r5Av85UAH2bhw0pMRBiJzGkDhUjk4XJVbfNcvPTTbPkUZgVQmKZhLH3Scsqdx-vcJ30OwYZCss7_LP-26kNBFqFc7K7XZxBsAgoyDx8F-GxD_y1mx2pMfjTm2zrrOMkikYloZ6WgJLFXDpz1SygXU5GPU4fVbmRWpMJ_5w1QWImf-VmfnX_Mlo-L6q-_52a1c7-dyTU404HAt0krSR3WqZ_-4N7ezt6s-bWzBtfu8JbjnsRPjaBdy0H50aAWDGU2DOXNh8-bDN9tOd5JLNEIemE5KD8a1IIl3IYlbvPhu02G77WqT83_t0Qj6KXloPxoUAuWuDYs8ZoP32sy_E7rJI5oxOxZjcmPxrRgiGe7Dx2IMxEyTWIpGrWddnkgET2K7YBkss7m4i5L5tU225_jiqu-3JGQ-fYp3_4YxttHZcDmcNcE7pnAzCg366hppjEyrgd3TeCeCcyMctdGtkfzOt1-T7vqebtKmO3OrF2nPRPB1TAiuBpGBFfDmOAIjQjeMRFcDSOCq2FEcDWMCY7QiOBdE8EvTBRVw4iiahhRVA1jiiI0ouiliaJqGFFUDSOKqmFMUYRGFO2ZKMqMegJCI5IiNGIpQmOaYjjWFczKgllbMKsLhn3BrDAwo8bA9iqDlq1qGrNVTWO2qmnUVgTHbNUpS_t3ptOWdGnMVq2-pI1jtu6VB6WtwebD7wAAAP__fn1wWA==

query T
EXPLAIN (DISTSQL) (SELECT y FROM xyz ORDER BY y) EXCEPT (SELECT y FROM xyz ORDER BY y)
----
distribution: full
vectorized: true
·
• except
│
├── • scan
│     missing stats
│     table: xyz@primary
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: xyz@primary
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy8mNFu4kYUhu_7FNa5SiQjMzM2EEuVst1QNRINKXCxVZULL54mSCx2bSOFjfLuFUatN3Z8fk9sc7cBPs8_Z-c7nOGF0n-25NP0y_3s0-2ddXFzu1wt_5hdWhfL6Wz6eWUdrF8X89-t58N3a764mS6sX_60DpfW9Mvn6f0KfIps2kWhvgu-6ZT8v0iQTZJsUmSTSzZ59GBTnERrnaZRcvzISw7chs_kD23a7OJ9dnz5waZ1lGjyXyjbZFtNPq2Cr1u90EGoE2dINoU6CzbbfJnnw_frONl8C5ID2bSMg13qWwPnuPJ8n_nWtaSHV5uifVY8Ps2CR02-eLU_FsHrLII0iXCzSbPNbp05olSDa1FaoGC-HqynIH165_NFCPWxEF6nIdzaEMVz9rsoCXWiwzdPyp9SG1OiWhURvL4ioEoVEUYtItgfSvlbkD4tdTaPHVWq1OoQa_8_9z_NZmTTVv-dXVyLy5-TzeNT_q__z3j9nsbdlvUuGkSxo7zy7t9de_JmbdFccdFAcUcOHGXcZwxCjDoMIU1CFJKLHjtN4xCjHjuN6E5zVKu6TtNhBFSpuk5jFqF1pxHn6DSyuWiyiWhq4LjGthuEGHcYQpqEKESTPdreOMS4R9tld6qhWtXZ3mEEVKk6280itLZdnsN21Vw01UQ0d5CP-Wa2G4SYdBhCmoQoRFM92t44xKRH21V3qqFa1dneYQRUqTrbzSK0tl2dw3a3uWhuE9G8gbHrBhGuOosgTSIUkrk9mt44xFWPprvdaYZqVWd6hxFQpepMN4vQ2nT33L8XvBNnodM42qW60a8Bw-OGdPioTwVKo32y1vdJtM6XOf05z7n8hVCn2eldefrjdnd66xjwR1iwsOJhWYbFj7D7BhZmsJCt6Ks2tBy1oZXiacXSXhtYtFpaDlvR4za0AofFZY8p-P_yDGBZhkcsDDY95u0a8XpNWFoMefqKpwXoC5WuYuI2oJHcCAd2AxzpDXDkt6i0VBPBAY0MBzhSHOHguAMcSS4qjfXtkUV4pcVweEV0wfcYtHW-yYgx0I1vM2IC8EqjMbKVp6GtAEe28ji0lcehrZUma2QrT0NbeRzaCnB0ZHkc2sp_wUgBhigwtgreVskPrmDrku800gVzL99ppAfwSqcxmpt5Gg7OAEeTM4_D0ZnHka2y0mVNbAU0shXgyFaEoyPL48hWyX_ByAnA-Um2hFdt5UdZtHW-0ygwyiq-0yhwQ1b8UAPqDmhkK8KBrQBHtgIc3nT5izK66oIrfrvF4WUX4Oi2C34jQKeG_4JRqHT8KFvCK7YqfpYtb_3h9ad_AwAA__--BQGd

# EXCEPT ALL and EXCEPT with no overlap.
query T
EXPLAIN (DISTSQL) (SELECT x FROM xyz WHERE x < 2) EXCEPT ALL (SELECT x FROM xyz WHERE x >= 2) ORDER BY x
----
distribution: full
vectorized: true
·
• sort
│ order: +x
│
└── • except all
    │
    ├── • filter
    │   │ filter: x < 2
    │   │
    │   └── • scan
    │         missing stats
    │         table: xyz@primary
    │         spans: FULL SCAN
    │
    └── • filter
        │ filter: x >= 2
        │
        └── • scan
              missing stats
              table: xyz@primary
              spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzEmF1v2kgUhu_3V4zOVaI1MjNjvixVSrelKhIbsoC0Xe1y4cJsgkQxaxsJGuW_rwwNCZjO62OIuSsfz8zp6_OcGfJI8X8z8qn95a77vnMrrj52BsPBH91rcTVod9sfhmIlPvV7v4vV-rv483O73xYr8c-yWtVjoa5F-8uH9t1QvO924ffNuxTo9T-2--K3v8SKHJqHE3MbfDMx-X-TJIcUOaTJIY8cqtHIoUUUjk0ch1H6lccN0JmsyK86NJ0vlkn69sihcRgZ8h8pmSYzQz4Ng68z0zfBxERulRyamCSYzjbbrNbfbxbR9FsQrcmhwSKYx76ouOnOvWXiixtJoyeHwmXysnycBPeGfPnk5C_h03SWmMhEbm1__-376T67GH3f79wOmwf7viz1dS0egvhhf51NnS-1KU5tr-OR58tHF8pHgoDSvjlHQt5Pq3tZZzkPo4mJzGRvpVFKoq8c-S9-DuKHgUl6C1cdhDxcL4z_Sh5yaGb-Ta5u5PW7aHr_sPlXjsRrnMQHYZSYyFW1w5h-_en69RyZHYvjx6JHirgNK-HC1dXDgI9u39jbXjKaOkdPu6riarb1oIhdV9cvYD0noHMmpAslJEFEb-O9LNd7WYb3IPFn7-tFvVf5-0rlaStdcT22eKCIXVs1LiAeIyB5zoR0oYQkiOhtxFPliqfKEA8k_ixeo6h4On9f6Txt5VU2t1GeeKCIXVs1LyAeIyB5zoR0oYQkiOhtxNPliqfLEA8k_ixes6h4Xv6-8vK0Va3C1g6UsGuq1gW0Y8Qjz5ePLpSPBAG9jXReudJ5ZUgHEn-WrnWOn5dH1u-beBHOY5Prl2M1DcxM7s32AcThMhqbuygcb7bZvuxtuM0bExMn20_l9kVnvv0oLfA1LA9h-Rr29mDJg6U8iW6cQit9Et2y08qauLYnrhmJKx58kDiXbpxCHyTOpVt22rMmXrMnXrPCdfuzrtufNdCrYaWbdrh5ipt2GLkJaOCmnUZuAhq42bJPwyoYh5lhyrET0EhPhAM_AY4ERTgwVGZG6n7wCgRvn6lAUpmZLvube2DzzHhhnYJ2Gh6DAEfnoB2HByHAgW3SPltlHQSfma4s3ew01A3gSDc7DnUDONLNfrJIcLTIzJBl6WYfsgoMWcUZstnLF2vIsnGgG8CRbghHF0_7kFVgyKrMkOXoBmikG8KBbgBHuiEc6KbsB4wCB4yy31-Bbso-ZBUYsoozZLObs4YsG0e6sYYsG0e62YesAkNWcS7w2ZZj3eDZONKNdYdn40g3-wGjwQGj7X8SOdRt9PTL_wEAAP__Gz3Neg==

query T
EXPLAIN (DISTSQL) (SELECT x FROM xyz WHERE x < 2) EXCEPT (SELECT x FROM xyz WHERE x >= 2) ORDER BY x
----
distribution: full
vectorized: true
·
• sort
│ order: +x
│
└── • except
    │
    ├── • filter
    │   │ filter: x < 2
    │   │
    │   └── • scan
    │         missing stats
    │         table: xyz@primary
    │         spans: FULL SCAN
    │
    └── • filter
        │ filter: x >= 2
        │
        └── • scan
              missing stats
              table: xyz@primary
              spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy82F9v4kYUBfD3fgprnhLVyMwfE7C0UrYbVotEQwpI3arNAwvTBInF1DYSbJTvXgELDn98j4cZ8rYhHM-5d81PxC8s_W_CItb8-tD-2Lr3ru5avX7vj_a1d9Vrtpuf-t7C-9zt_O4tlj-8P780u01v4f0zr1bl0BPXXvPrp-ZDH75Xf1i9udO9a3a93_7yFsxn03ik7wffdcqivxlnPhPMZ5L5TDGfhezRZ7MkHuo0jZPVW17WgdZowaKqz8bT2Txbvfzos2GcaBa9sGycTTSLWH_wbaK7ejDSSVBlPhvpbDCerI9ZLH_czpLx90GyZD7rzQbTNPIqwerkzjyLvFvOHl99Fs-z_PJpNnjSLOKvfvkKn8eTTCc6CcL98zevr87ZrTCKotZ9v154rjA59-3o3N3s8qzZORh-dU-g6ZXJyXfjNBtPh1kgDkY_Gi3PfFt6z4P0-cT78xLheSVCpyVqhSXy68yncTLSiR7tXWl9lcKaEu0qr3BzqQpoU3mFukUF_6yWXwbpc09nnVmgDjbVX850tAXwY7vNfDbR_2ZXt_z6QzJ-el7_q8Snq2Fye_XiJNNJoI5W9muxXNUSSzu1j59XPdHiPq7EsyCsHm749Pn7dHIDwkoIFohKII39BiV2htUc-20yvMvp5VnTczC-ueDg5BxPfkHBS5eoXVBw7o5PtKsiwR1WQJsqEtysgrXg_D0EB7fXVvCjlZUWXJRHRJQxRFYCZSwoKLEz5MaxoAbDc5fTy7Om52B8c0HByTle4oKCli5xc0FBhTu-0K6KBHVYAW2qSFCzCtaCivcQFNxeW0GPVlZaUFkeEVnGEFVZ_6VvJigosTOk7lhQg-G5y-nlWdNzML65oODkHC95QUFLl6hfUFDpji-0qyJBHVZAmyoS1KyCtaDyPQQFt9dW0KOVlRZUlUdElTEkrBj7CSrsBGk49tNgdO5udnnW7BwMb64nODmHS11Qz9IlGhfUU7mjC-2qSE-HFdCmivQ0q2Ctp3oPPcHttdXzaGVnPYM9cUBXp7N4mupSj1erq43p0ZPe_A-k8TwZ6ockHq6P2fzYWefWL4x0mm1-yzc_tKabX60Kvg1zMqzosCDDkg5LMhzSYXUY5m_Dtb0wNwvzG5u0sEpLq7QC6ZBMW4V53SYtrNLSKq1AukbepiB8YxAWh-E6GW7QH5AGjUKV7s1pU0KECq0KFyBOu8KBDZyWhQPU-NGHbD9eA3H6dgM0gTSyCcQRTiCOdAJxxBM_-qiZ-ATSCCgQR0KBOCIKxJFRnHaGN0CcluYgfuQUp60RVfAlAnx_AVQJ2hoBrBG0NQJYI2hrBPoCRVsjgDXCyhqQRtaAOLIGxJE1II6sEVbWgDSyBsSRNSCOrAFxZI2grRHAGkFbI4A1grZGAmuknTWStkYCayT4ewlYI2lrJLBG0tZIYI20sgakkTUgjqwBcWQNiCNrpJU1II2sAXFkDYgja0AcWSNpaySwRtLWSGCNpK1RwBplZ40CT2aANYq2RqHnK7Q1ClijaGsUsEZZWQPS8PmOnTUgDp_w2FmjrKwBaWQNiCNrQBxZA-LIGkVbo4A1irZGAWsUbU0IrAkNrXl8_eX_AAAA___oPFwV

# EXCEPT ALL and EXCEPT with some overlap.
query T
EXPLAIN (DISTSQL) (SELECT y FROM xyz WHERE x >= 1) EXCEPT ALL (SELECT y FROM xyz WHERE x < 3) ORDER BY y
----
distribution: full
vectorized: true
·
• sort
│ order: +y
│
└── • except all
    │
    ├── • filter
    │   │ filter: x >= 1
    │   │
    │   └── • scan
    │         missing stats
    │         table: xyz@primary
    │         spans: FULL SCAN
    │
    └── • filter
        │ filter: x < 3
        │
        └── • scan
              missing stats
              table: xyz@primary
              spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzEmF1v4kYYhe_7K0bvVaIamZkxX5ZWYrvLapFoSAGpW7VcePE0QWKxaxspJMp_rwwbCDaZ4zHE3G0Ij-fdwzxnhjxR_N-CXOp9ux187N-wq8_98WT8x-CaXY17g96nCVuzL6Ph7-xh_cj-_Nob9dgD-2dVr0v1gfFr1vv2qXc7YR8HAwjMmLxmw9Hn3oj99hdbk0XLwFc33g8Vk_s3cbJIkEWSLHLIogZNLQqjYKbiOIjStzxtgL7_QG7dovkyXCXpy1OLZkGkyH2iZJ4sFLk08b4v1Eh5vorsOlnkq8SbLzbLPKwfu2E0_-FF6QTj0FvGLqvZ6crDVeKyLre6gqbPFgWrZL9CnHh3ilz-bBWf4st8kahIRXbjcITt6-lS-yRd1-3fTNq7KbIj7J_6fc3uvfj-8JFdTtPn_ZjCZMzXYfGzpiVLpcVBXDMmz5uW8-aY--eslkHkq0j5B0-apiR6y5H_61cvvh-rZBjaIhP4ZB0q95VVZNFC_Ztcdfn1h2h-d7_51z79N6NvmEQ_DqJERbZoZGP69c3nNwtkdiyOnw89MsRNUAtCW9azAR9dvnWwPDfY4AX2ty1qtizTB2CO3Q5vXrYPTOI6c16yVF4cBPbOjcCrbQReRSOA6F8aoVm2EUTxPSaKbDFZs50ySoI5dlusdVklDeLiZ85LlsqLg8DeWUlRrZKiCiVB9C9KtsoqKYvvMVlkizm1zcXWWEkwx26LtS-rpEFc_Mx5yVJ5cRDYOyspq1VSVqEkiP5FyXZZJZ3ie8wpssUatTJCgil2G6xzWSENwuJnTUuWSouDuN5ZR6daHZ0qdATRv-jYOcfX2CPPH6k4DJaxKvQNtZ4Gpvw7tf0A4mAVzdRtFMw2y2x_HG64zQu-ipPtb_n2h_5y-6t0wNcwz8L8NewcwNwM5vwkunUKLeRJdEdPC23iUp-4NEhcmMGZxE3p1il0JnFTuqOnHW3iDX3iDS3c1H_WTf1nDfRqaem2Hm6f4qYeRm4CGripp5GbgAZudvRtWAd1mCtTEzsBjfREOPAT4EhQhANDea5SD4MXIHh9pwJJea5dDhd3wOK5ejE6BfU0PAYBjs5BPQ4PQoAD27i-W3kTBJ9rVyPd9DTUDeBINz0OdQM40k1_snBwtPBcyRrppi9ZAUpWmJRs_vJlVLLGONAN4Eg3hKOLp75kBShZkStZE90AjXRDONAN4Eg3hAPdhP6AEeCAEfr7K9BN6EtWgJIVJiWbX9yoZI1xpJtRyRrjSDd9yQpQssLkAp_fckY3eGMc6WZ0hzfGkW76A0aCA0bq_ySS1W36_Mv_AQAA__9SNOwx

query T
EXPLAIN (DISTSQL) (SELECT y FROM xyz WHERE x >= 1) EXCEPT (SELECT y FROM xyz WHERE x < 3) ORDER BY y
----
distribution: full
vectorized: true
·
• sort
│ order: +y
│
└── • except
    │
    ├── • filter
    │   │ filter: x >= 1
    │   │
    │   └── • scan
    │         missing stats
    │         table: xyz@primary
    │         spans: FULL SCAN
    │
    └── • filter
        │ filter: x < 3
        │
        └── • scan
              missing stats
              table: xyz@primary
              spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy82N9v2lYcBfD3_RXWfUo0I3N_mIClSnQNVZFYyABpnbY8ULhLkChmtpFCo_zvE1Bw-OHvufa189YQDvf01P6I-oXF_81ZwDpf73sfu3fO1W13OBr-0bt2roadXufTyFk7nwf9353n9Q_nzy-dQcd5dv5Z1etSf3D4tdP5-qlzP4Jvnjjy2ukPbjsD57e_nDVz2SKc6rvxdx2z4G_GmcsEc5lkLlPMZT57cNkyCic6jsNo85aXbaA7fWZB3WWzxXKVbF5-cNkkjDQLXlgyS-aaBWw0_jbXAz2e6sirM5dNdTKezbfHPK9_tJfR7Ps42jQYLseLOHBq3ubk_ioJnDZ324I9vLosXCXpCXEyftQs4K-ueYvPs3miIx15_nGF3eubo9IVgyDo3o2ahxbZFUSeCm-H4KUuIQstwcEUE0eaL6HyVLidxclsMUk8cTJDm58ckGa-rZ2ncfx04f1pCb9YCb_UEo3MEunnrBZhNNWRnh590vZTMmtKtFVa4aaqCmiptELTooJbqOWXcfw01El_6amTpUbrpQ72Mn7s9ZjL5vrf5KrNrz9Es8en7Z_SOy3z79TKc3kNwyjRkafOJvs1G7S6wWiX9vj5qRda3IW1cOn59dOFL59_LCrPwZmBZp6oebKI7KDHwbNGdbLnmaLkLWShLTgYw8J2UCFllVdou3GJRoW28_JgRVtl2V5iBbRUlu35Kljbzt_DdnB57W0_m8zYdmEOijDxRNY8VcRW0OPgyU11tuaYgpe8hSy0BQdjWNgKKqSsiQptNS5xU6GtojzY0FZZtpZYAS2VZWu-Cta2ivewFVxee1vPJjO2VZqDIk08UbXtQ4PctoIeB0-a1dmaYwpe8hay0BYcjGFhK6iQsiYrtNW4RLNCW2V5sKGtsmwtsQJaKsvWfBWsbZXvYSu4vPa2nk1mbKsyB0WZeOLXisgKWhw0aVUna44heKlLyEJLcDCFhaugQkqaqtBV4xKtCl1V5aGGtspytcQKaKksV_NVsHZVvYer4PLau3o2WaFnvRcOGOh4GS5ibfQYt75ZTE8f9e5fIA5X0UTfR-Fke8zux_42t31hquNk91u--6G72P1qU_BtmJNhRYcFGZZ0WJJhnw6r0zB_G24chXm-ML-xSQurtLRKK5D2ybRVmDdt0sIqLa3SCqQb5GUKwjc5wuI03CTDLfoGadEo1OnenDbFR6jQqnAB4rQrHNjAaVk4QI2f3WTH8QaI05cboAmkkU0gjnACcaQTiCOe-NmtlscnkEZAgTgSCsQRUSCOjOK0M7wF4rQ0J_EzpzhtjaiDLxHg-wugStDWCGCNoK0RwBpBWyPQFyjaGgGsEVbWgDSyBsSRNSCOrAFxZI2wsgakkTUgjqwBcWQNiCNrBG2NANYI2hoBrBG0NRJYI-2skbQ1Elgjwf-XgDWStkYCayRtjQTWSCtrQBpZA-LIGhBH1oA4skZaWQPSyBoQR9aAOLIGxJE1krZGAmskbY0E1kjaGgWsUXbWKPBkBlijaGsUer5CW6OANYq2RgFrlJU1IA2f79hZA-LwCY-dNcrKGpBG1oA4sgbEkTUgjqxRtDUKWKNoaxSwRtHW-MAaP6c1D6-__B8AAP__bm96zA==

# EXCEPT ALL and EXCEPT with swapped column orders.
query T
EXPLAIN (DISTSQL) SELECT x, y FROM xyz EXCEPT ALL SELECT y, x from xyz
----
distribution: full
vectorized: true
·
• except all
│
├── • scan
│     missing stats
│     table: xyz@primary
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: xyz@primary
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzEll1v2jAUhu_3K6xz1UqOgp2ElkiTqDqmIbHSFS4qTblIiVeQaJLFQSKt-O9TwhjlYz7xDNllah77tc8j9X0D-XMOPvQe7wc3_Tty8ak_Go--DS7JqDfo3Y7JkpKCfH4YfiXL4pX0Hm9792NyMxhs1gtKln_WgUKcROIufBES_O_AgAIHCg5QcIGCBwGFNEsmQsokK3_yVgH9aAl-i8IsThd5-eeAwiTJBPhvkM_yuQAfxuHTXDyIMBKZ3QIKkcjD2bw6Zlm8dtNs9hJmBVAYpWEsfWLZ5cnDRe6TLqNdDsGKQrLIf5-w3fipINNQTne33CABBZmHzwJ8tqL_FtbTDMtpl5mG5X8Nu91qESdZJDIR7WwWlCT2kyM3_hLK6Ujkw9Rme9MZF6nw35kDFObiR35Rpb78mM2ep5sP1cC2l3MMLnck-V1iJanNvP1nOHq2u3M2q28Bq2GBzS3bOaO0GnHb2nFPry1rVlvWqLa8_ix4nVk4lu2eUR2NuFfacU-vDm9WHd6oOk79WTh1ZuFa1f-oc6mjEfdaO-7p1XGaVcdpVB23_izcOrPwrDOKoxG2oxn29Nq4zWrj_reOdSTXg5BpEktRq0G1ypuJ6FmsX0omi2wi7rNkUh2z_hxWXNUAIiHz9Spff_Tj9VIZsD7cNoE7JjAzys08Nc00nozrwW0TuGMCM6Pce092QPN9uvWedtTv7ShhtvtmrX3aNRFcDSOCq2FEcDWMCY7QiOCeieBqGBFcDSOCq2FMcIRGBG-bCH5loqgaRhRVw4iiahhTFKERRa9NFFXDiKJqGFFUDWOKIjSiaMdEUWbUExAakRShEUsRGtMUw7GuYFYWzNqCWV0w7AtmhYEZNQZ2UBm0bFXTmK1qGrNVTaO2Ijhmq05ZOpyZTlvSpTFbtfqSNo7ZelAelLYGqw-_AgAA__-poYDu

query T
EXPLAIN (DISTSQL) SELECT x, y FROM xyz EXCEPT SELECT y, x from xyz
----
distribution: full
vectorized: true
·
• except
│
├── • scan
│     missing stats
│     table: xyz@primary
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: xyz@primary
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzEmFFv4kYUhd_7K6z7tCsNgpmxgViqlNUuVSPRJA08rFTlwQvTBInF1DYSbJT_XmGUemPH98xgO30k7MecuevzMcMTpf-sKaTJ19vpp6tr78OXq9l89uf0ozebTCef595eeAfvt7ubP7z94Yc3-fp5cjt_ee8gvP1_75GgTbw019F3k1L4F0kSpEiQJkE-CQroXtA2iRcmTePk-E-ecuBquadwIGi12e6y45_vBS3ixFD4RNkqWxsKaR59W5s7Ey1N0h-QoKXJotU6X2Z_-HG5TVbfo-RAgmbbaJOGXq9_XPlml4XepRSXiu6fBcW7rFghzaIHQ6F8FuelCBxTKHEpa1MolxRfVmm22iyyvixN4q2dFti3g_cYpY9vI0UUfV6UoIMofm2U4qN2mzhZmsQsX31Y_im1YZXF3IoUQVcpLEZWpBg2SCHOCvp7lD7OTHaz7evSvOaHrQlfTPBpOiVBa_N39iHfwcdfk9XD48sLuxKO2h3xddyLt30dlMfw5trjV2tLewFICwH0Va-vzxGRQ46hcw4HFYEcRf9l5yqyjjLsXEWyPQlYzK1ORS2msBhZnYrcUjRWkXxXFSn7GiqbGupe3z9HBw45Rs45HHQAchQdVJ3rwDrKqHMdqPaKaDG3Oh20mMJiZHU6cEvRWAfqXXWg7WuobWro9_JrhLMOHHKMnXM46ADkKDqoO9eBdZRx5zrQ7RXRYm51OmgxhcXI6nTglqKxDvS76sC3r6FvU8Ogd44MHFJcOKZwUAFIUfTP71wF1lEuOleB314JLeZWp4IWU1iMrE4Fbikaq8D_336zeCPXnUm38SY1Vr9IDI47M8sHc5pUGu-ShblN4kW-zOnlTc7lf1iaNDu9q04vrjant44Bf4YlC2seVmVY_gz7r2DpBkvViL5oQqthE1prntYsHTSBZaOl1aARPWpCa_Cw-OxjCv6_AgdYleEhC4NNj_h2Dfl6jVlaDnj6gqcl8ELFKi7dBjQqN8JBuwGO6g1w1G9ZUapLwQGNGg5wVHGEg8cd4KjksiLW148swiuK4fBK0SXvGLR1XjJyBOrGa0aOAV4RjVNbeRq2FeCorTwO28rjsK0VyTq1ladhW3kcthXg6JHlcdhW_gtGSXCIAsdWybdV8QdXsHXFm0b54NzLm0YFAK-YxunczNPw4AxwdHLmcXh05nHUVlWxrEtbAY3aCnDUVoSjR5bHUVsV_wWjxgDnT7IlvNpW_iiLts6bRoOjrOZNo8ENWfOHGjB3QKO2Ihy0FeCorQCHN13-ooyuuuCK32xxeNkFOLrtgt8I0FPDf8FoNDr-KFvCK23V_Fm2vPX751_-DQAA__-aVB6L

# EXCEPT ALL and EXCEPT with different ORDER BY types.
query T
EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) EXCEPT ALL (SELECT y AS x FROM xyz ORDER BY z) ORDER BY x
----
distribution: full
vectorized: true
·
• sort
│ order: +x
│
└── • except all
    │
    ├── • scan
    │     missing stats
    │     table: xyz@primary
    │     spans: FULL SCAN
    │
    └── • scan
          missing stats
          table: xyz@primary
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy8lk9v2koQwO_vU6zmFPQW2bu2-WPpSclLqIpEQ4o5pKo4OHgbkAh210bCifLdK0woMSY7Xkx8g7C_2fHMbzJ-gfj3Alzo3d8Nrvq35OKm742974MGufB6g971mKzJl9HwG1mnz2Q4uumNyP8_SNogvfvr3t2YXA0Gf0-m5Mo7evy5sf-8BgrLMBC3_pOIwf0JDChwoGABBRsoODChEMlwKuI4lJsjLxnQD9bgmhTmy2iVbP48oTANpQD3BZJ5shDgwth_WIiR8AMhDRMoBCLx54vsmnX6fBnJ-ZMvU6DgRf4ydknT2Nw8XCUuuWQweaUQrpK38PuoDymZ-fEsHy87P6EQJ_6jAJe90tPSdDTT5JXS5B-muY-zWoYyEFIEuUiTDYkdOfKsX_145olkGBnsoCPjNBLuO4-AwkL8Si4uWeM_OX-cZZ8-bM_-mSyd0nuhTIQ0mHNYpn8_jG-XqNmxcrwFPZLEbdgMI4ObhwU-er2Tu56VN4uVMMvgTcP6lBHQSLSlneg5h4DVOwSsjiFAir8bgtapQ8DLN5eXaa7VNOxPsVAj0bZ2oue0kNdrIa_DQqT4Owvbp1polW-uVaa5djPbxue3UCPRjnai57TQqtdCqw4LkeLvLOycaqFdvrl2meY6zU9xUCPNrmaa5zTQrtdAuw4DkdLvDOye45X0SPyRiKNwGYtSb5vmpmAieBTbBsThSk7FnQyn2TXbr8OMy94yAhEn21_59kt_uf1pk2B5uF0FZqwS7VSiu2qaadSM68HtKvBBzXRppxLdVdP8kDbf01YONg9hSwnb6m7ZSpgz9dVOlflQw8h8qGFsPhAamQ-ERuajVWU-1DAyH2oYmw-ERuYDoZH5aCst7agl7VSZj24Vw9UwYrgaxgxHaMRwhMY2gM7aLP4n1dmbujS6BLQ2pzaOaM4KWySnKuNq0Zl6jSCms8Ie0VEdoRHXERqTHcMR2zEc072wQ7V0V9OY7moa1R3BMd0RHNO9sEjzurcQ3Qs7RUv3wk7R0l1NY7qraVR3BMd0R3BM98I-1dJdTWO6q2lUdwTHdEdwTPfCVs2_a5tq3Xlhtyh1n7z-8ycAAP___hN5LQ==

query T
EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) EXCEPT (SELECT y AS x FROM xyz ORDER BY z) ORDER BY x
----
distribution: full
vectorized: true
·
• sort
│ order: +x
│
└── • except
    │
    ├── • scan
    │     missing stats
    │     table: xyz@primary
    │     spans: FULL SCAN
    │
    └── • scan
          missing stats
          table: xyz@primary
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy8mE1v6kYYhff9FdasEtXIzIz5slQp6Q1VI9GQAotbVVn4wjRB4mJqGwkS5b9XmHKdePB7ZmI7u3z48Ry_zHk05oUl_65YwIZf70fXt3fOxc3tdDb9c3TpXEyHo-GXmbNzfpuM_3B2-2dnPLkZTpxf_3L2l87w65fh_ezHVXvnenr20ufL_Ocdc9k6Wqi78LtKWPA348xlgrlMMpf5zGUd9uCyTRzNVZJE8eGSlwy4XexY0HbZcr3Zpoc_P7hsHsWKBS8sXaYrxQI2C7-t1ESFCxV7beayhUrD5SpbZrd_vtrEy-9hvGcum27CdRI4Le-w8nibBs4VZw-vLou2aX77JA0fFQv4q_uxCB3LCKI0grCJcLNM0uV6nnq8MAPtGXPm2955CpOnM9fnIeTHQnRqDeGXhsjvs11H8ULFavHuTtldSmMKNKs8QqepCGhSeYRuhQjuh1L-HiZPU5WON54sTGq236jg5ILr0Yi5bKX-SS-u-OUv8fLxKfvJoGY9m-01jeJUxZ7URvZz6f37BjM7N47_b3omxF3Uijae3y4O-Ozyg3fLc3OLcAOLeKLlSWuVWYToWocwlRkIkXuENygz4xDdBmXG6zMJmlWZzGqMgCZVJjO7CJVlxj9DZmB7nWSmjcxUZsK8yMKkyLLl-dY2sQjRsw5hahMQIi-yaNAmxiF6DdpE1FdlNKsym9QYAU2qzCZ2ESrbRHyGTcD2OtlEG5mpTaR5kaVJkf1W9iZkZxOLEH3rEKY2ASHyIssGbWIcot-gTWR9VUazKrNJjRHQpMpsYhehsk3kZ9gEbK-TTbSRmdrENy-yb1LkTsvaJRYRBpYRTE0CIuQl9hs0iXGIQYMm8eurMZpVmUlqjIAmVWYSuwiVTeJ_hknA9jqZRBvZR76yOXP_iUo20TpRRt_GtA8DU4tHdfwAkmgbz9V9HM2zZY6_jjMu-8NCJenxv-L4y-36-K9DwLcwJ2FJw6II87ew_w7mdjCXVWjBK9GDKrTs0bQk6U4VmIOR07QQVWjZrkT3adont2mXhjsWsCjCXRLu0QXpkTB45j4J-5xeekDSHNCclgpHVtG0YmMGQCM1ABy5AeFADgBHduC0XIAeAI38AHAkCIAjQyAc1IVrhnm_ZdHoaMUUcE0TnJYM74LC0JpBj057hg_A4rRpRBvgmmqsyk7TsOw0DssOcFR2GkdlF5plbcoOaFR2gKOyAxyVHeFgxwv63CrQ6VFTDYVrZRe0aoQPjs20atCj06YR4EgiaNOIPsA11Vid-WkaHvppHJ76AY6O_TQOy65Z1qrsNA3LTuOw7DQOyw5wtOPps6wEH7ukz7IFXCu7BK_I4CgsadWAR5e0aWQHLE6bRoJTidRUY1N2QKOyAxyVHeGg7ACHL_maZa3e8mkavubTOHzPp3H4og9wtOPps6xEnxt9li3getlp1fjgKOzTqik--sPrT_8FAAD__xTXCD0=

# EXCEPT ALL and EXCEPT with different numbers of ORDER BY columns.
query T
EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) EXCEPT ALL (SELECT x FROM xyz ORDER BY y, z) ORDER BY x
----
distribution: full
vectorized: true
·
• sort
│ order: +x
│
└── • except all
    │
    ├── • scan
    │     missing stats
    │     table: xyz@primary
    │     spans: FULL SCAN
    │
    └── • scan
          missing stats
          table: xyz@primary
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy8ll9v2jwUh-_fT2Gdq6LXKNhJ-BNpUruWaUisdMBFp4mLlHgFiZLMCRK06nefCEU0hPjEpPVd0-Sxfzl-DicvEP9dgAfd-7v-Ve-WXNz0RuPRz36NXIy6_e71mKzJt-HgB1lvnslgeNMdkq-_yKZGuvfX3bsxuer31U9S8lw7XK6BwjIMxK3_JGLwfgMDChwo2EDBAQouTChEMpyKOA7l9pGXFOgFa_AaFObLaJVs_z2hMA2lAO8FknmyEODB2H9YiKHwAyGtBlAIROLPF-k2683zZSTnT77cAIVR5C9jj9St7c6DVeKRSwaTVwrhKnlb_rDqw4bM_HiWXS99fkIhTvxHAR57pefFdI3G5IUxD-uslqEMhBRBZqXJlsQeOfGu3_14NhLJILLY0YmMN5Hw3lkEFBbiT3JxyWpf5Pxxlv5V-N6Hd7J1Sj8KZSKkxdzjMv1fuL5TomanyvG26IkQt2E9jCzeOC7wye3dzPasvFmshFkWr1v2p7SARtCm4aC8MKiBJmAmmgAp_r4Jmuc2AS9_uLzM4dp1y_kUCzWCtgwH5YVBDVjITViIFH9vYetcC-3yh2uXOVynnk7jj7dQI2jbcFBeGNSAhbYJC5Hi7y1sn2uhU_5wnTKH69Y_xUGNmB2jMXlhTAMGOiYMREq_N7DzEZ-kJ9YfijgKl7Eo9bXZ2BZMBI9idwBxuJJTcSfDabrN7nKQculXRiDiZHeX7y56y92tbcDycKsKzFgl2q1Ed9Q006gZ14NbVeCjmunSbiW6o6b5Md14T9sZuHEM20rYUZ-Wo4Q5U2_tVukPNYz0hxrG-gOhkf5AaKQ_mlX6Qw0j_aGGsf5AaKQ_EBrpj5bS0rZa0naV_uhUMVwNI4arYcxwhEYMR2hsAuiMzfwvqc7c1KXRIaA1ObVxRHOWmyIZVRlXi87UYwQxneXmiI7qCI24jtCY7BiO2I7hmO65Gaqlu5rGdFfTqO4IjumO4JjuuUGa1b2J6J6bKVq652aKlu5qGtNdTaO6IzimO4JjuufmqZbuahrTXU2juiM4pjuCY7rnpmr2W7uh1p3nZotS98nrf_8CAAD__zWpeKA=

query T
EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) EXCEPT (SELECT x FROM xyz ORDER BY y, z) ORDER BY x
----
distribution: full
vectorized: true
·
• sort
│ order: +x
│
└── • except
    │
    ├── • scan
    │     missing stats
    │     table: xyz@primary
    │     spans: FULL SCAN
    │
    └── • scan
          missing stats
          table: xyz@primary
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy8mF9v6jYYxu_3KSJftVpQsB3-RZrUs1OmVWKlAy7ONPUiB7wWiUNYEiRo1e8-EYbSxuR97CbhrhR-8ZMXPz85vLLk3xUL2PDbw-jL3b1zdXs3nU3_HF07V9PhaPh15uyc3ybjP5zd_sUZT26HE-fXv5z9tTP89nX4MKM_5Tov1_nLHXPZOlqo-_CHSljwN-PMZYK5TDKX-cxlHfbosk0czVWSRPHhI68ZcLfYsaDtsuV6s00P_3502TyKFQteWbpMV4oFbBZ-X6mJChcq9trMZQuVhstVtsxu_3KziZc_wnjPXDbdhOskcFreYeXxNg2cG84e31wWbdP88kkaPikW8Df3cxE6tUUQNhFul0m6XM9TjxdmoC2QM9_3znOYPJ_5fB5Cfi5Ep9YQfmmI_DrbdRQvVKwWH66UXaU0pkCzyiN0moqAJpVH6FaI4H4q5e9h8jxV6XjjycKkZvuNCk4m-DIaMZet1D_p1Q2__iVePj1nfxns8Z7N9ppGcapiT2oj-7n0-n2DmZ0bx_8XPRPiPmpFG89vFwd8dvnBh-W5uUW4gUU80fKktcosQnRrDCFsQuQe4Q3KzDhEt0GZ8fpMgmZVJrMaI6BJlcnMLkJlmfFLyAxsr5PMtJGZykyYF1mYFFm2PN_aJhYhejWGEDYh8iKLBm1iHKLXoE1EfVVGsyqzSY0R0KTKbGIXobJNxCVsArbXySbayExtIs2LLE2K7LeyJyE7m1iE6NcYQtiEyIssG7SJcYh-gzaR9VUZzarMJjVGQJMqs4ldhMo2kZewCdheJ5toIzO1iW9eZN-kyJ2WtUssIgxqiyBsIuQl9hs0iXGIQYMm8eurMZpVmUlqjIAmVWYSuwiVTeJfwiRge51Moo3sMz_ZnLn-RCWbaJ0oo19j2oeBqcWTOn4BSbSN5-ohjubZMseX44zL_rFQSXp8Vxxf3K2Pbx0Cvoc5CUsaFkWYv4f9DzC3g7msQgteiR5UoWWPpiVJd6rAHIycpoWoQst2JbpP0z65Tbs03LGARRHuknCPLkiPhME990nY5_TSA5LmgOa0VDiyiqYVGzMAGqkB4MgNCAdyADiyA6flAvQAaOQHgCNBABwZAuGgLlwzzMcti0ZHK6aAa5rgtGR4FxSG1gy6ddozfAAWp00j2gDXVGNVdpqGZadxWHaAo7LTOCq70CxrU3ZAo7IDHJUd4KjsCAc7XtDnVoFOj5pqKFwru6BVI3xwbKZVg26dNo0ARxJBm0b0Aa6pxurMT9Pw0E_j8NQPcHTsp3FYds2yVmWnaVh2Godlp3FYdoCjHU-fZSX42iV9li3gWtkleEQGR2FJqwbcuqRNIztgcdo0EpxKpKYam7IDGpUd4KjsCAdlBzh8yNcsa_WUT9PwMZ_G4XM-jcMHfYCjHU-fZSX63uizbAHXy06rxgdHYZ9WTfHWH99--i8AAP__trkHsA==

# EXCEPT ALL and EXCEPT with compatible ORDER BY columns that are not in the final result.
query T
EXPLAIN (DISTSQL) (SELECT y FROM xyz ORDER BY z) EXCEPT ALL (SELECT y FROM xyz ORDER BY z)
----
distribution: full
vectorized: true
·
• except all
│
├── • scan
│     missing stats
│     table: xyz@primary
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: xyz@primary
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy8lkFv2jAYhu_7FdZ3aiWjYCfQEmkSXcs0JFY64NBpyiElXkGiSRYHqWnFf58SprUE8BfPw7fS5LFff36kvK8gf63Ah8H93ehqeEvObobT2fTb6JycTQejwfWMFOTzZPyVPBcvZDy5GUzIp-_k5ZwM7q8HdzNyNRohbwKFOInEbfgkJPg_gAEFDhRcoOABhQ4EFNIsmQspk6x85bUChtEz-G0Kyzhd5-W_AwrzJBPgv0K-zFcCfJiFDysxEWEkMqcNFCKRh8tVtc1z8dJPs-VTmBVAYZqGsfRJyyl3Hq9zn_Q5BBsKyTr_s_zbqg8FWYRysbten0GwCSjIPHwU4LMN_beYHasx-dGYb-us4ySLRCainZWCksReOXDWL6FcTEU-Th1Wu5FZkQr_nTdAYSV-5md9dv4xWz4uqr_-npvVzv12JtfgTAcC3yatJHVYp376g3t7O3uz5tfOGly7w1uOexI_NYJ2LQflR4NaMJTZMJQ3Hz5vMny35XgnsUQj6IXloPxoUAuWcBuWuM2H7zYZvteqPjX_3xKNoJeWg_KjQS1Y4tqwxGs-fK_J8DutkziiEbNnNSY_GtOCIZ7tPnQgzkTINImlaNR22uWBRPQotgOSyTqbi7ssmVfbbH-OK676ckdC5tunfPtjGG8flQGbw10TuGcCM6PcrKOmmcbIuB7cNYF7JjAzyl0b2R7N63T7Pe2q5-0qYbY7s3ad9kwEV8OI4GoYEVwNY4IjNCJ4x0RwNYwIroYRwdUwJjhCI4J3TQS_MFFUDSOKqmFEUTWMKYrQiKKXJoqqYURRNYwoqoYxRREaUbRnoigz6gkIjUiK0IilCI1piuFYVzArC2ZtwawuGPYFs8LAjBoD26sMWraqacxWNY3ZqqZRWxEcs1WnLO3fmU5b0qUxW7X6kjaO2bpXHpS2BpsPvwMAAP__sUVwWg==

query T
EXPLAIN (DISTSQL) (SELECT y FROM xyz ORDER BY z) EXCEPT (SELECT y FROM xyz ORDER BY z)
----
distribution: full
vectorized: true
·
• except
│
├── • scan
│     missing stats
│     table: xyz@primary
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: xyz@primary
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy8mNFu4kYUhu_7FNa5SiQjMzM2EEuVst1QNRINKXCxVZULL54mSCx2bSOFRHn3CqPWiR2f3xPbudsAn-efs_MdzvBM6T9b8mn67Xb25frGOru6Xq6Wf8zOrbPldDb9urIO1q-L-e_W4-HJmi-upgvrlz-tp3Nr-u3r9HYFPkU27aJQ3wQ_dEr-XyTIJkk2KbLJJZs8urMpTqK1TtMoOX7kOQeuw0fyhzZtdvE-O758Z9M6SjT5z5Rtsq0mn1bB961e6CDUiTMkm0KdBZttvszj4ekyTjY_guRANi3jYJf61sA5rjzfZ751KenuxaZonxWPT7PgXpMvXuyPRfA6iyBNIlxt0myzW2eOKNXgUpQWKJjvB-shSB_e-XwRQn0shNdpCLc2RPGc_S5KQp3o8M2T8qfUxpSoVkUEr68IqFJFhFGLCPaHUv4WpA9Lnc1jR5UqtTrE2v_P_S-zGdm01X9nZ5fi_Odkc_-Q_-v_M16_p3G3Zb2JBlHsKK-8-3fXnrxZWzRXXDRQ3JEDRxn3GYMQow5DSJMQheSix07TOMSox04jutMc1aqu03QYAVWqrtOYRWjdacRndBrZXDTZRDQ1cFxj2w1CjDsMIU1CFKLJHm1vHGLco-2yO9VQreps7zACqlSd7WYRWtsuP8N21Vw01UQ0d5CP-Wa2G4SYdBhCmoQoRFM92t44xKRH21V3qqFa1dneYQRUqTrbzSK0tl19hu1uc9HcJqJ5A2PXDSJcdBZBmkQoJHN7NL1xiIseTXe70wzVqs70DiOgStWZbhahtenuZ_9e8E6chU7jaJfqRr8GDI8b0uG9PhUojfbJWt8m0Tpf5vTnPOfyF0KdZqd35emP693prWPA17BgYcXDsgyL17D7BhZmsJCt6Is2tBy1oZXiacXSXhtYtFpaDlvR4za0AofFZY8p-P_yDGBZhkcsDDY95u0a8XpNWFoMefqCpwXoC5WuYuI2oJHcCAd2AxzpDXDkt6i0VBPBAY0MBzhSHOHguAMcSS4qjfXtkUV4pcVweEV0wfcYtHW-yYgx0I1vM2IC8EqjMbKVp6GtAEe28ji0lcehrZUma2QrT0NbeRzaCnB0ZHkc2sp_wUgBhigwtgreVskPrmDrku800gVzL99ppAfwSqcxmpt5Gg7OAEeTM4_D0ZnHka2y0mVNbAU0shXgyFaEoyPL48hWyX_ByAnA-Um2hFdt5UdZtHW-0ygwyiq-0yhwQ1b8UAPqDmhkK8KBrQBHtgIc3nT5izK66oIrfrvF4WUX4Oi2C34jQKeG_4JRqHT8KFvCK7YqfpYtb_3u5ad_AwAA__8MwAGf

# EXCEPT ALL and EXCEPT with a projection on the result.
query T
EXPLAIN (DISTSQL) SELECT x FROM ((SELECT x, y FROM xyz) EXCEPT ALL (SELECT x, y FROM xyz))
----
distribution: full
vectorized: true
·
• except all
│
├── • scan
│     missing stats
│     table: xyz@primary
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: xyz@primary
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzEllFr4kwUhu-_XzGcK4WROJNoa-CDlq7LCm7tVi8Kixepma2CTbKZCKal_31JsmKNOiezg8nlJHlm3jnngZx3kL_X4MLw6WF8O7onrS-j6Wz6Y9wm0-F4eDcjW_L1cfKdtFq7NSVp8WibvrXJ8Olu-DAjt-MxOf1FGygEoS_uvVchwf0JDChwoGADBQco9GBOIYrDhZAyjLNP3nNg5G_B7VJYBdEmyR7PKSzCWID7DskqWQtwYeY9r8Wj8HwRW12g4IvEW63zY7bp200Ur169OAUK08gLpEs6VnbyZJO45IbRGw7zDwrhJvl7wn7j55QsPbk83HKHzCnIxHsR4LIP-m9hew2E5WfD7rfaBGHsi1j4B5vNMxL75MSNv3lyORXJJLJYqTuzNBLuJ3mAwlr8Slp56vb_8epluVvsa1AqwP5mtsHNTsS-DzthZLFeuQYnz3YOzmbVFWAVFLB4x7IvaKxG3H4jcfnZuDU4y-pzlldvBK_SCLtjORf0RiPuVSNx-dm4NXjD6_PGrt4Iu0ojnE7-a7qUNxpxrxuJy8_GrcEbuz5vnOqNcKo0ote5oDUaYQcNhOVnw9bgjNPMXHUi1KOQURhIUWlq6mbXEv6LKMokw028EA9xuMiPKZaTnMv_-r6QSfGWF4tRULzKAlaH-ybwwARmRrlZT00zjZJxPbhvAg9MYGaUu1SyI5qX6e5n2lbX21bC7LBm3TLtmAiuhhHB1TAiuBrGBEdoRPCeieBqGBFcDSOCq2FMcIRGBO-bCH5loqgaRhRVw4iiahhTFKERRa9NFFXDiKJqGFFUDWOKIjSi6MBEUWY0JyA0IilCI5YiNKYphmOzgtmwYDYtmI0LhvOC2cDAjCYGdjQyaNmqpjFb1TRmq5pGbUVwzFadYem4ZzrTki6N2ao1L2njmK1Hw4PS1vnHf38CAAD___1ogpc=

query T
EXPLAIN (DISTSQL) SELECT x FROM ((SELECT x, y FROM xyz) EXCEPT (SELECT x, y FROM xyz))
----
distribution: full
vectorized: true
·
• except
│
├── • scan
│     missing stats
│     table: xyz@primary
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: xyz@primary
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzEmFFv4kYUhd_7K6z7lEiDYGZsIJYqZbVL1Ug0SQMPK1V58MI0QWIxtY0UNsp_rwBFXmx8zwy2s4_G-XzP3Mw5vuNXSv9bUkijr_fjTze33sWXm8l08vf40puMxqPPU-_F--Ph7i_v4uL9Wnjbw08v2x-X3ujr59H91Dt995IEreK5uY2-m5TCf0iSIEWCNAnySVBAj4LWSTwzaRonuz953QM38xcKe4IWq_Um2_38KGgWJ4bCV8oW2dJQSNPo29I8mGhukm6PBM1NFi2W-zIv2x_X62TxPUq2JGiyjlZp6HW6u8p3myz0rqW4VvT4JijeZHmFNIueDIXyTZynImhShXJR8WWRZovVLOvKQidO1cixb1vvOUqfTyO5FH2elKAFKX6llPxRm1WczE1i5kcP2z-lUqyy6FuuImhLhUXLchX9GirEWUL_jNLnicnu1l1d6Nd0uzbhexh8Go9J0NL8m13sV3D5e7J4en6_yLd_5coGzfb3Nu7E664Oij04WXt4VFvau19auL-rOl19Tgo56Og3q0O56MjNL1vPIWsp_dZzSDaXABZ9q8qhBlVYtKwqh9xU1M4h-XE5pOw9qGw8qDtd_5wscNAxaFaHctGRG1C1ngXWUgatZ4FqzoUWfavKggZVWLSsKgvcVNTOAvVxWaDtPahtPOh39qcH5yxw0DFsVody0ZEbULeeBdZShq1ngW7OhRZ9q8qCBlVYtKwqC9xU1M4C_XFZ4Nt70LfxYNA5JwkcVFw1qUK5qMjN57eeA9ZSrlrPAb85B1r0rSoHGlRh0bKqHHBTUTsH_F_zneKEqAeTruNVaqy-QvR2yzLzJ3NoUxpvkpm5T-LZvszh8m7P7X-YmzQ73FWHi5vV4dZO4M-wZGHNw6oIy59h_wiWbrBUteirOrTq16G15mnN0kEdWNYqrXq16EEdWoPN4rPbFPy_AgdYFeE-C4NFD3h39Xl7DVla9nj6iqclyIVSqrh4G9DI3AgH7gY4sjfAkb9lKVJdDA5o5HCAI4sjHGx3gCOTy1KwHm9ZhJcihsNLRpd8xqCl8yEjB8BufMzIIcBLQePkVp6GbgU4ciuPQ7fyOHRrKWSd3MrT0K08Dt0KcLRleRy6lX_BKAmGKDC2St6tih9cwdIVnzTKB3MvnzQqAHgpaZzmZp6GgzPA0eTM43B05nHkVlVKWRe3Ahq5FeDIrQhHW5bHkVsV_4JRQ4Dzk2wBL7uVH2XR0vmk0WCU1XzSaHBC1vxQA_oOaORWhAO3Ahy5FeDwpMsflNFRFxzx6xWHh12Ao9Mu-EaAdg3_gtGodfwoW8BLbtX8LFtc-uPbb_8HAAD__-F9IDQ=
