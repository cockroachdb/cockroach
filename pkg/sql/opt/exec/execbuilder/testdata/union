# LogicTest: local

statement ok
CREATE TABLE uniontest (
  k INT,
  v INT
)

query T
EXPLAIN SELECT v FROM uniontest UNION SELECT k FROM uniontest
----
distribution: local
vectorized: true
·
• union
│
├── • scan
│     missing stats
│     table: uniontest@uniontest_pkey
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: uniontest@uniontest_pkey
      spans: FULL SCAN

query T
EXPLAIN SELECT v FROM uniontest UNION ALL SELECT k FROM uniontest
----
distribution: local
vectorized: true
·
• union all
│
├── • scan
│     missing stats
│     table: uniontest@uniontest_pkey
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: uniontest@uniontest_pkey
      spans: FULL SCAN

# Check that EXPLAIN properly releases memory for virtual tables.
query T
EXPLAIN SELECT node_id FROM crdb_internal.node_build_info UNION VALUES(123)
----
distribution: local
vectorized: true
·
• union
│
├── • virtual table
│     table: node_build_info@primary
│
└── • values
      size: 1 column, 1 row

statement ok
CREATE TABLE abc (a INT, b INT, c INT)

query T
EXPLAIN (VERBOSE) (SELECT a FROM abc ORDER BY b) INTERSECT (SELECT a FROM abc ORDER BY c) ORDER BY a
----
distribution: local
vectorized: true
·
• sort
│ columns: (a)
│ estimated row count: 100 (missing stats)
│ order: +a
│
└── • intersect
    │ columns: (a)
    │ estimated row count: 100 (missing stats)
    │
    ├── • project
    │   │ columns: (a)
    │   │
    │   └── • scan
    │         columns: (a, b)
    │         estimated row count: 1,000 (missing stats)
    │         table: abc@abc_pkey
    │         spans: FULL SCAN
    │
    └── • project
        │ columns: (a)
        │
        └── • scan
              columns: (a, c)
              estimated row count: 1,000 (missing stats)
              table: abc@abc_pkey
              spans: FULL SCAN

# Regression test for #32723.
query T
EXPLAIN (VERBOSE) SELECT a FROM ((SELECT '' AS a , '') EXCEPT ALL (SELECT '', ''))
----
distribution: local
vectorized: true
·
• project
│ columns: (a)
│
└── • except all
    │ columns: (a, a)
    │ estimated row count: 1
    │
    ├── • project
    │   │ columns: (a, a)
    │   │
    │   └── • values
    │         columns: (a)
    │         size: 1 column, 1 row
    │         row 0, expr 0: ''
    │
    └── • project
        │ columns: ("?column?", "?column?")
        │
        └── • values
              columns: ("?column?")
              size: 1 column, 1 row
              row 0, expr 0: ''

query T
EXPLAIN (VERBOSE) ((SELECT '', '', 'x' WHERE false))
UNION ALL ((SELECT * FROM (VALUES ('', '', 'x'), ('', '', 'x'))) EXCEPT (VALUES ('', '', 'x')))
----
distribution: local
vectorized: true
·
• render
│ columns: ("?column?", "?column?", "?column?")
│ render ?column?: column1
│ render ?column?: column2
│ render ?column?: column3
│
└── • except
    │ columns: (column1, column2, column3)
    │ estimated row count: 1
    │
    ├── • values
    │     columns: (column1, column2, column3)
    │     size: 3 columns, 2 rows
    │     row 0, expr 0: ''
    │     row 0, expr 1: ''
    │     row 0, expr 2: 'x'
    │     row 1, expr 0: ''
    │     row 1, expr 1: ''
    │     row 1, expr 2: 'x'
    │
    └── • values
          columns: (column1, column2, column3)
          size: 3 columns, 1 row
          row 0, expr 0: ''
          row 0, expr 1: ''
          row 0, expr 2: 'x'

query T
EXPLAIN (VERBOSE)
SELECT 1 FROM (SELECT k FROM uniontest WHERE k > 3 UNION ALL SELECT k FROM uniontest)
----
distribution: local
vectorized: true
·
• render
│ columns: ("?column?")
│ render ?column?: 1
│
└── • union all
    │ columns: ()
    │ estimated row count: 1,333 (missing stats)
    │
    ├── • project
    │   │ columns: ()
    │   │
    │   └── • filter
    │       │ columns: (k)
    │       │ estimated row count: 333 (missing stats)
    │       │ filter: k > 3
    │       │
    │       └── • scan
    │             columns: (k)
    │             estimated row count: 1,000 (missing stats)
    │             table: uniontest@uniontest_pkey
    │             spans: FULL SCAN
    │
    └── • scan
          columns: ()
          estimated row count: 1,000 (missing stats)
          table: uniontest@uniontest_pkey
          spans: FULL SCAN

statement ok
CREATE TABLE ab (a INT NOT NULL, b INT, INDEX(a, b), INDEX (b, a))

statement ok
CREATE TABLE xy (x INT NOT NULL, y INT, INDEX(x, y), INDEX (y, x))

# Regression tests for #41245, #40797. Ensure we can plan ordered set ops
# without a sort.
query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a FROM ab UNION SELECT x AS a FROM xy ORDER BY a
----
distribution: local
vectorized: true
·
• union
│ columns: (a)
│ ordering: +a
│ estimated row count: 200 (missing stats)
│
├── • scan
│     columns: (a)
│     ordering: +a
│     estimated row count: 1,000 (missing stats)
│     table: ab@ab_a_b_idx
│     spans: FULL SCAN
│
└── • scan
      columns: (x)
      ordering: +x
      estimated row count: 1,000 (missing stats)
      table: xy@xy_x_y_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyckVFvmzAUhd_3K6z7tGmuiumbn9IWJiGloYNs2jQhZPBthkYws40Kivjvk8myFtRMW_2A8Ln2OZ_vPYD5WQOH8Mv9-jrakLdBlG7Tj2tKPofJTZyG70garsPbLRHkQxLfEVGQT5so3pzknlynp1o_kDgJwoTcfCUCKDRK4kbs0QD_BgwyCq1WJRqjtJMO04FI9sA9ClXTdtbJGYVSaQR-AFvZGoHDVhQ1Jigk6ksPKEi0oqonW1GsRJGLvMgr2QOFW1V3-8bwCSBthfu9gGykoDr7lGCs2CFw9gwpCoB7I30dFZtT9cOqH_I-H5ZU_b9Q-QsqdpbqCUZpiRrlHGPF3kM2voAeVMZWTWkv_eWFs1BXCyj_f1qVoGlVY3CWdi7JWyRdMPcElDs8PtmoTpd4r1U5nT1u48loEiQae6z6x03UTCXmEjSK_Z9JP3dir3ViSyf_r05XMydvzpRReKjVY15J4OD9XhcvfE4L3AWxM67Z6Xf1ONluh9a16kHUBinciR8YoEW9rxo39hK41R2O45tfAQAA__9wUUaR

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a, b FROM ab UNION SELECT x AS a, y AS b FROM xy ORDER BY a
----
distribution: local
vectorized: true
·
• union
│ columns: (a, b)
│ ordering: +a
│ estimated row count: 2,000 (missing stats)
│
├── • scan
│     columns: (a, b)
│     ordering: +a,+b
│     estimated row count: 1,000 (missing stats)
│     table: ab@ab_a_b_idx
│     spans: FULL SCAN
│
└── • scan
      columns: (x, y)
      ordering: +x,+y
      estimated row count: 1,000 (missing stats)
      table: xy@xy_x_y_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyckd9umzAUxu_3FNa52lRHBXrnK9rCJKQ0dJBNmyaEDD7N0AhmtlFBEe8-mbRrQc20xReg88ff9zvHB9C_amAQfr1fX0cb8j6I0m36aU3JlzC5idPwA0nDdXi7JZySgnxM4jvCC_J5E8Wb50pPrlNbHuz_qacfSJwEYUJuvhEOFBopcMP3qIF9BxcyCq2SJWotlU0dpoZI9MAcClXTdsamMwqlVAjsAKYyNQKDLS9qTJALVJcOUBBoeFVPsrzweZHzvMgr0QOFW1l3-0azCR0opC230QqykYLszIuJNnyHwNxXVFEAzBnpeWDuHKwf_H7I-3xYgvWUDP8C5i3A3JNgLzxSCVQo5iS-e0F97wKy8Y0JgkqbqinNpbe8RH3vJNvVgs37n6UlqFvZaJwZnnJyFk4r106BYofHybXsVIn3SpZT7zGMJ6EpIVCbY9U7BlEzlVzroJDv_7z5ayX3XCV3qeT9VelqpuTMmTIKD7V8zCsBDJyns3rj83zAXuA7bZed_pCPk-x2aO2qHnitkcId_4kBGlT7qrEvXwIzqsNxfPc7AAD__9D3TBQ=

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a, b FROM ab UNION ALL SELECT x AS a, y AS b FROM xy ORDER BY a
----
distribution: local
vectorized: true
·
• union all
│ columns: (a, b)
│ ordering: +a
│ estimated row count: 2,000 (missing stats)
│
├── • scan
│     columns: (a, b)
│     ordering: +a
│     estimated row count: 1,000 (missing stats)
│     table: ab@ab_a_b_idx
│     spans: FULL SCAN
│
└── • scan
      columns: (x, y)
      ordering: +x
      estimated row count: 1,000 (missing stats)
      table: xy@xy_x_y_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyckUFvnDAQhe_9FdacWtWrALn5tJsslZAIpLCtWlUIGTzZorKY2kYBrfjvldmkCSip0vUBNDOP9z7GR9C_a2Dgf7sNN0FE3m-DdJd-Din56idXcep_IKkf-tc7wikpyKckviG8IF-iII7IJgwfpz3ZpFYy2PeDrh9InGz9hFx9JxwoNFJgxA-ogf0AFzIKrZIlai2VbR0nQSB6YA6Fqmk7Y9sZhVIqBHYEU5kagcGOFzUmyAWqCwcoCDS8qidbXqx5kfO8yCvRA4VrWXeHRrMJHyikLbfVCrKRguzMU4g2fI_A3GdUwRaYM9LzwNw5WD-s-yHv82EJ1lMyvAXMW4C5r4I98UglUKGYk6zdj5CNL9BHciXbC2-mfo3mckHj_c-aEtStbDS-KclZJK1cy45ij6d_1bJTJd4qWU7aUxlPRlNDoDanqXcqgmYauTZBIT_8veXnTu65Tu7Syfun0-XMyZkzZRTuanmfVwIYOA9n9cLj8YD9gO-1XXb6U95Ptruhtau647VGCjf8F27RoDpUTaVNVQIzqsNxfPcnAAD__5G9SXg=

# TODO(yuzefovich): The synchronizers in the below DistSQL plans are all
# unordered. This is not a problem, but we shouldn't need an input synchronizer
# at all when there is only one incoming stream. We should look into removing
# it.
query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a, b FROM ab INTERSECT SELECT x AS a, y AS b FROM xy ORDER BY b, a
----
distribution: local
vectorized: true
·
• intersect
│ columns: (a, b)
│ ordering: +b,+a
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (a, b)
│     ordering: +b,+a
│     estimated row count: 1,000 (missing stats)
│     table: ab@ab_b_a_idx
│     spans: FULL SCAN
│
└── • scan
      columns: (x, y)
      ordering: +y,+x
      estimated row count: 1,000 (missing stats)
      table: xy@xy_y_x_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJykk9Fvmz4Qx99_f4V1T63qqgHSF0s_ibZhElJaOoimTVOEDFxTNIKZbVRQlP99MqRLgpJs6fwAuvP5c9_vyV6B-lkAA-_r8_TOfyIXEz-aRZ-nlHzxwvsg8i5J5E29hxnhlCTkUxg8Ep4Q_2nmhZFJb3YbcheZktb8N3VNS4Jw4oXk_htJKOFAoRQZPvElKmDfwYI5hUqKFJUS0qRWXYGfNcBGFPKyqrVJzymkQiKwFehcFwgMZjwpMESeobwZAYUMNc-LDssTlydxEvM4zxqg8CCKelkq1jkAClHFTXQN8zUFUettE6X5AoFZO6r8CbDRmn5MmLUvrGndpo3buBkKayhp_0aYPRBmnSNskiudl6m-sfdVuRZ1TSqQGUrMGHFt6lpHNTgDDfaHNDj_pGE80OAc1bBtXZeih-91npuTfyo5YOQR5QIj1EF1M963MmsrZDvv4246BQoFvugL176irnV1-b_MF6_b0PiuNSP9EI55vh14Hp8z9xBVJUqFQ-8HO40Gna4tMwHMFthPVIlapvgsRdrV9mHQgbpEhkr3u3Yf-OX7ltIS-fL3m9olWSdJznGSNSTZJ0njPZK1S7KHJOcMkr1Lcoak8UnS7ak5zSm8FOItzjNgMNqs6wOf9wXmAF8ocwGiV_HWYc21VMBeeKGQwiP_gRPUKJd5aZ5kCkzLGtfr_34FAAD__94S7ZY=

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT b FROM ab INTERSECT ALL SELECT x AS b FROM xy ORDER BY b
----
distribution: local
vectorized: true
·
• intersect all
│ columns: (b)
│ ordering: +b
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (b)
│     ordering: +b
│     estimated row count: 1,000 (missing stats)
│     table: ab@ab_b_a_idx
│     spans: FULL SCAN
│
└── • scan
      columns: (x)
      ordering: +x
      estimated row count: 1,000 (missing stats)
      table: xy@xy_x_y_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJycklFr2zAQx9_3KcQ9tUyllvsmGCRtPDAkcWeHsTGCkaNLauZYniRTm5DvPmQva2zSbZ0ejHR3-t_vf9YBzI8COARfHufTcEmuZmGySj7NKfkcxPdRElyTJJgHDyuSkY9xtCAiI-FyFcSJi03n81O6IdPkVNO0JIpnQUzuv5IMKJRK4lLs0QD_BgzWFCqtNmiM0i506ApC2QD3KORlVVsXXlPYKI3AD2BzWyBwWImswBiFRH3rAQWJVuRFJyuyicjSLBVpLhug8KCKel8a3gEklXDbG1gfKajavnQwVuwQODtDCmfAvSP9Pyo2pGraSdOmTdqOqZp_ofJHVOxVqheYulRaokY5AFm7m38ruWBtgXqHCdqouvWHzlZthXz4FIBCgVt7NWHvrz_ofPfUb4FCVFtOJuxVo3cjo_5bxh-jqVRpcGz4Yidv1OmGOdsod9iP0ahab_BRq01X2x-jTqgLSDS2z_r9ISy7FHMdNIr979dzrsTeoOSfK7Gxkv9HpbuBkjdkWlPYFuo5zSVw8H6tmwuf0wJ3QeyMG3bypJ47WfffDfCtKAxSWIjvOEOLep-XubH5BrjVNR6P734GAAD__yqNY2M=

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT b, a FROM ab INTERSECT ALL SELECT y AS b, x AS a FROM xy ORDER BY b
----
distribution: local
vectorized: true
·
• intersect all
│ columns: (b, a)
│ ordering: +b
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (b, a)
│     ordering: +b,+a
│     estimated row count: 1,000 (missing stats)
│     table: ab@ab_b_a_idx
│     spans: FULL SCAN
│
└── • scan
      columns: (y, x)
      ordering: +y,+x
      estimated row count: 1,000 (missing stats)
      table: xy@xy_y_x_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJycklFr2zAUhd_3K8R9aqlKLfdNMHDaeGBI4s4OY2MEI8c3rpljeZJMbUL--5DTNrFJNzI9JNyro3O_I2sH-ncJHPzvT7NJsCBX0yBexl9nlHzzo4cw9q9J7M_8xyVJKRHkSxTOiUhJsFj6UWzbk9nsTdGRSWxlrf1_1bYdCaOpH5GHHyQFCpXMcCG2qIH_BAYrCrWSa9RaKtva9YIga4E7FIqqboxtryispULgOzCFKRE4LEVaYoQiQ3XnAIUMjSjK3laknkiTNBFJkbVA4VGWzbbSnAjaM8S1sNUtUAgbw4nnUo_Bak9BNuY4URuRI3B2ghhMgTt7-n-UbEjZdl7bJV3SjilbSrqLKd0RJfuQ8gjXVFJlqDAbgK3syX9JzkSdo8oxRhPWd-4w6bKrkQ-fDFAocWOuPHZDPffm-rMq8udj-Z6ZUc_9MPP9KLN7yZeJUNey0jjOfnaSM5p0y-wNYJbj4Ua1bNQan5Rc99pDGfZGfSNDbQ677qEIqn6L2QkKxfb9YZ06sQuc3FMnNnZy_-p0P3ByhkwrCptSviRFBhyc13V75udtgT0gcm0vO36WL72tfQIa-EaUGinMxS-cokG1LapCm2IN3KgG9_tPfwIAAP__evpvzg==

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT b, a FROM ab EXCEPT SELECT y AS b, x AS a FROM xy ORDER BY b
----
distribution: local
vectorized: true
·
• except
│ columns: (b, a)
│ ordering: +b
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (b, a)
│     ordering: +b,+a
│     estimated row count: 1,000 (missing stats)
│     table: ab@ab_b_a_idx
│     spans: FULL SCAN
│
└── • scan
      columns: (y, x)
      ordering: +y,+x
      estimated row count: 1,000 (missing stats)
      table: xy@xy_y_x_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJykk1Fro0AQgN_vVyzz1NItjZq-LBzYNh4E0trTcPQ4gqw6SeWM6-2uVAn578dq0ySS5EjPh4SdGb_5Zt1dgfqTAwPv5XlyN34iF6NxOA2_Tyj54QX3fuhdktCbeA9TElPCybfAfyQ8Jt7Lg_c83aQacheafG3-34vqhvjByAvI_U8SA4VCpPjEl6iA_QILZhRKKRJUSkgTWrUF47QGNqCQFWWlTXhGIRESga1AZzpHYDDlcY4B8hTlzQAopKh5lrdYHrs8juKIR1laA4UHkVfLQjHCaesQltysroGCX2lGXJu6FszWFESltx2V5gsEZu0ojkfABmv6OUtr37Ju3LqJmqjuW9aUNGdb2j1L6xzLUaZ0ViT6xt5XdC3qmpAvU5SYMtIFjjk4PQf7Uw7OfzkMew7OUYdt66oQHXyv88y8-a-SA4M8olxgiNovb4b7o0ybEtnmztxNJkAhx7m-cK0r6tpXl19ltnjdLj8-_MmBb3sDD8_Z9ABVKQqF_cEPdhr0Ol1bZnxMF9htpxKVTPBZiqSt7ZZ-C2oDKSrdZe1uMS42KaUl8uXH7dolWSdJznGS1SfZJ0nDPZK1S7L7JOcMkr1Lcvqk4UnS7al9mlGY5-ItylJgMHh_rg_8bB4wL_CFMgcgfBVvLdacSQVsznOFFB75bxyhRrnMCnMfE2BaVrhef_kbAAD__zxH8Ts=

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a, b FROM ab EXCEPT ALL SELECT x AS a, y AS b FROM xy ORDER BY b, a
----
distribution: local
vectorized: true
·
• except all
│ columns: (a, b)
│ ordering: +b,+a
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (a, b)
│     ordering: +b,+a
│     estimated row count: 1,000 (missing stats)
│     table: ab@ab_b_a_idx
│     spans: FULL SCAN
│
└── • scan
      columns: (x, y)
      ordering: +y,+x
      estimated row count: 1,000 (missing stats)
      table: xy@xy_y_x_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyckt9q2zAUxu_3FOJctVShlnsnGDhNPAgkdWaH0TGCkaOT1MyxPEmmNiHvPuS0S2LSba0ubM4ffef3SdqB-VUAh_BxPh1OHsjVeJIskq9TSr6F8X2UhNckCafhaEEEJRn5EkczIjISPo7C-YIMp9PXckOGietp3f-lsWlJFI_DmNx_JxklAiiUSuKD2KIB_gMYLClUWq3QGKVdatc1TGQD3KOQl1VtXXpJYaU0At-BzW2BwGEhsgJjFBL1rQcUJFqRF52syAKRpVkq0lw2QGGkinpbGt5ZAApJJVw0gOWegqrtcYixYoPA2QnVZAzc29OPgbFzsKYNmjZt06YP1lDS_g-Y3wNjb4IdeepSaYka5RnL0u38V8sFdzPUG0zQRtWtf25u0VbITx4GUChwba8C_4YG7Ob6s843T8cQKES15SRgNPDfNHzXM-y_5yZiNJUqDfaNX5zk9SYNmLOPcoOH4zSq1iuca7Xqeg9h1Al1CYnGHqr-IZiUXYm5CRrF9s9DOlVi71DyT5VYX8n_q9LdmZJ3zrSksC7Uc5pL4OC9rMGFz-sCt0FsjDvs5Ek9d7Lu_g3wtSgMUpiJnzhGi3qbl7mx-Qq41TXu959-BwAA__9n92iJ

statement ok
CREATE TABLE abcde (a INT PRIMARY KEY, b INT, c INT, d INT, e INT, INDEX (b, c, d, e))

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT * FROM (SELECT a, b, c, d, e FROM abcde UNION SELECT a, c, b, d, e FROM abcde) WHERE c = 1 AND d = e ORDER BY a
----
distribution: local
vectorized: true
·
• union
│ columns: (a, b, c, d, e)
│ ordering: +a
│ estimated row count: 2 (missing stats)
│
├── • filter
│   │ columns: (a, b, c, d, e)
│   │ ordering: +a
│   │ estimated row count: 1 (missing stats)
│   │ filter: (c = 1) AND (d = e)
│   │
│   └── • scan
│         columns: (a, b, c, d, e)
│         ordering: +a
│         estimated row count: 1,000 (missing stats)
│         table: abcde@abcde_pkey
│         spans: FULL SCAN
│
└── • sort
    │ columns: (a, c, b, d, e)
    │ estimated row count: 1 (missing stats)
    │ order: +a
    │
    └── • filter
        │ columns: (a, b, c, d, e)
        │ estimated row count: 1 (missing stats)
        │ filter: d = e
        │
        └── • scan
              columns: (a, b, c, d, e)
              estimated row count: 10 (missing stats)
              table: abcde@abcde_b_c_d_e_idx
              spans: /1-/2
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyck11v4jwQhe_fXzGaK3gxgnxQrSxVSltSbaQWugn7pRVCJp52o4aYtY3aquK_rxLoFrIN29YXljyenPP4aPKI5leOHMNvVxcn0QhawyiZJJ8uGHwJ49NxErYhCS_Cswn8D-fx-BJa26NgMGeQMpAMaHMl5qkk-DyKxiN47kqrxlpXG75-DOMQWikcg9OGk9EQWhKOgdowjodhDKffQSDDQkkaiQUZ5D_QwSnDpVYpGaN0WXqsGiJ5j7zPMCuWK1uWpwxTpQn5I9rM5oQcJ2KeU0xCku71kaEkK7K8kq2IgmqfLW_pARmeqXy1KAzffyYyTJaiLHdxumaoVvbZ0FhxQ8idHcJoiLy_Zq-HPM9yS5p0z9kn3NQ5tAKvzItzHo0mH7axBT4cQzBoNyK5NSTnLUi7ubnNuc1n6UzOaJbJ-1fE13O6PbeR16vxuu-K0Hs5wm1ajeZ-zdx7i3mitCXd8_etA6eDDMcryyFwWOCxwGWBzw5ADGoQfiPEs7fSkjTJv6xZ4HZY4HVY4HdYMOjgdP0C-TAzNitS2xvUBSpa7x_ARzXgwVtSi8ksVWFoz7nJqV9z6jrlc0je0CYOo1Y6pSut0qp3cxxXQlVBkrGbW2dziIqnK2M1icWfn3ZXyTmoNNhTcnaVvLqSe1DJa2Zy6kreQSW_WcmtK_nvfZ1fVxocVDo6lPiU4XWu7maZRI797eq-sD0tLD8QN6YcpeSnuqtkJw_LchCuRW6I4aW4pSFZ0ousKAc8RW71itbr_34HAAD__ydFLgU=

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT * FROM (SELECT a, b, c, d, e FROM abcde UNION SELECT  a, c, b, d, e FROM abcde) WHERE c = 1 AND d = e ORDER BY b, c, d, e, a
----
distribution: local
vectorized: true
·
• union
│ columns: (a, b, c, d, e)
│ ordering: +b,+c,+d,+a
│ estimated row count: 2 (missing stats)
│
├── • filter
│   │ columns: (a, b, c, d, e)
│   │ ordering: +b,+d,+a
│   │ estimated row count: 1 (missing stats)
│   │ filter: (c = 1) AND (d = e)
│   │
│   └── • scan
│         columns: (a, b, c, d, e)
│         ordering: +b,+c,+d,+e,+a
│         estimated row count: 1,000 (missing stats)
│         table: abcde@abcde_b_c_d_e_idx
│         spans: FULL SCAN
│
└── • filter
    │ columns: (a, c, b, d, e)
    │ ordering: +c,+d,+a
    │ estimated row count: 1 (missing stats)
    │ filter: d = e
    │
    └── • scan
          columns: (a, b, c, d, e)
          ordering: +c,+d,+e,+a
          estimated row count: 10 (missing stats)
          table: abcde@abcde_b_c_d_e_idx
          spans: /1-/2
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJysk29v2jAQh9_vU5zuFYxD4CRIk6VKbkuqIbXQBfZPE0IhvnbRQsJso3aq-O5TAl0hKmytlheRfD6ee_zDeUD7M0OJ4Zfry9PBEBr9wXgy_nBJ8CmMzkbjsAnj8DI8n8BbuIhGV9DYLmOCOUFCoAl4sxXPE83wcTgYDeGpK6kaa11N-Pw-jEJoJHACogmnwz40NJwAN2EU9cMIzr7u8AliJMwLzcN4wRblNxQ4JVyaImFrC1OWHqqGgb5H2SVM8-XKleUpYVIYRvmALnUZo8RJPM844liz6XSRULOL06zCVnaqes_ms2SmZzxL9T0SnhfZapFbuX9yJBwv47LcxumasFi5p7nWxbeMUuyIDvoou2v6d9eLNHNs2HTEvuimLqGh_DJCKeVgOHm3TVIFcAKq1zyo5NWUxEuUduPz_ld8HdHueAd9_Zqv96oI_ecj3KaFhKOVk6AEKZ-URyog1TuoFNSU_INKTyaF0WxY72sor0XKb5EKWqREi1SvhdP1M-fop9aleeI6QQ0gKlv_L8K9mnDwkgwjtssit7w3-dCkbm1SW5THYX3LmzhssTIJX5siqXo3y1EFqgqardvsis1ikD9uWWc4Xvz5inZJ4igp2COJXZJXJ3lHSf5hJ1En-a918uuk4CipdyynKeFNVtzNUo0Su9un_czr8cHyB_GtLS_A-HtxV2Env5bl33cTZ5YJr-If3GfHZpHm5bVMUDqz4vX6ze8AAAD__5hW9vo=

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT * FROM (SELECT * FROM abcde UNION ALL SELECT * FROM abcde) WHERE c = 1 AND d = e ORDER BY a
----
distribution: local
vectorized: true
·
• union all
│ columns: (a, b, c, d, e)
│ ordering: +a
│ estimated row count: 2 (missing stats)
│
├── • filter
│   │ columns: (a, b, c, d, e)
│   │ ordering: +a
│   │ estimated row count: 1 (missing stats)
│   │ filter: (c = 1) AND (d = e)
│   │
│   └── • scan
│         columns: (a, b, c, d, e)
│         ordering: +a
│         estimated row count: 1,000 (missing stats)
│         table: abcde@abcde_pkey
│         spans: FULL SCAN
│
└── • filter
    │ columns: (a, b, c, d, e)
    │ ordering: +a
    │ estimated row count: 1 (missing stats)
    │ filter: (c = 1) AND (d = e)
    │
    └── • scan
          columns: (a, b, c, d, e)
          ordering: +a
          estimated row count: 1,000 (missing stats)
          table: abcde@abcde_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0k29r4kAQh9_fpxjmld6taEyEY0HQ1pQL2NhLvH8cUtbs1AuN2dzuSq-I3_1IbK8aVNpy3RcLOzs-8_hLskbzO0OO_ver8TAIoTEK4mn8eczgqx-dTWK_CbE_9s-n8B4uosklNPaPYp5Igi9hMAlhOB7DgdsmfPvkRz40EuiD04RhOIKGhD5QEybRyI_g7AcIZJgrSaFYkkH-Ex2cMSy0SsgYpcvSumoI5B_kHYZpXqxsWZ4xTJQm5Gu0qc0IOU7FPKOIhCTd7iBDSVakWYWtjAbVfl3c0j0yPFfZapkbDoLBnEHCQDIgZBgXoiy3cLZhqFb2aaCxYkHInR3DYIS8s2HPl7xIM0uadNvZN9zWOTQGbpkX5zwIpx8fYht40IdBr3lUqVtTcl6itJtb9w1zc2uS3Vfl5v7P3LyakntU6clEaUma5L7GwPmAs80B71C1VNH29rqP2fRqNt5LAorIFCo39KxJndqkllO6k1zQ9r8atdIJXWmVVL3b46QCVQVJxm5vne0hyB-vjNUklv--i12Sc5Lk7ZGcXVK3TuqeJLnHnZw6yX2tk1sneSdJvVM5zRjeZOruOpXIsfOwWge2x4XlD8TClC9A_EvdVdjpfVE-vhuRGWJ4KW5pRJb0Ms1TY9MEudUr2mze_Q0AAP__EdLhPg==

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT * FROM (SELECT * FROM abcde UNION ALL SELECT * FROM abcde) WHERE c = 1 AND d = e ORDER BY b, c, d, e, a
----
distribution: local
vectorized: true
·
• union all
│ columns: (a, b, c, d, e)
│ ordering: +b,+c,+d,+a
│ estimated row count: 2 (missing stats)
│
├── • filter
│   │ columns: (a, b, c, d, e)
│   │ ordering: +b,+d,+a
│   │ estimated row count: 1 (missing stats)
│   │ filter: (c = 1) AND (d = e)
│   │
│   └── • scan
│         columns: (a, b, c, d, e)
│         ordering: +b,+c,+d,+e,+a
│         estimated row count: 1,000 (missing stats)
│         table: abcde@abcde_b_c_d_e_idx
│         spans: FULL SCAN
│
└── • filter
    │ columns: (a, b, c, d, e)
    │ ordering: +b,+d,+a
    │ estimated row count: 1 (missing stats)
    │ filter: (c = 1) AND (d = e)
    │
    └── • scan
          columns: (a, b, c, d, e)
          ordering: +b,+c,+d,+e,+a
          estimated row count: 1,000 (missing stats)
          table: abcde@abcde_b_c_d_e_idx
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0k11r2zwUx--fT3E4V8kThcYvhSEouG1cZkidzs7eGMEo1mln5liepNCOku8-7LRrYprQlk0XAh1Jv_PTP_E9mp8lcgy_XE1Ooxh64yidpR8mDD6Fydk0DfuQhpPwfAb_w0UyvYTe7lIscknwMY6mMZxOJvDMbh8-vw-TEHo5nIDTh9N4DD0JJ0B9mCbjMIGzr7BgkDOQDIiBQIaVkhSLJRnk39DBOcNaq5yMUbop3bcHInmHfMSwqOqVbcpzhrnShPwebWFLQo4zsSgpISFJH42QoSQrirLFtnZBO2eLLM9kRlkh75DhuSpXy8pwEGzLDBmmtWjKQ5yvGaqVfeprrLgh5M6WaDRGPlqzl7teFKUlTfrI2RXd1Dn0Aq-JkHMexbN3D0kGPpxAcNzfq-R2lJzXKG3H5_77-LyOq_um-Ly_GZ_fUfL2Kj2ZKC1Jk9zVCNwBC7wBC_wBC5wBztfPvCFWQ1Uf-Ts395kdd8z814SVkKlVZehFnUadTkOncSd5Q5t3G7XSOV1plbdnN8tpC2oLkozd7DqbRVQ9bhmrSSz_fCrbJOcgyd8hOdskt0tyD5K8_U5Ol-S91cnrkvyDpONDOc0ZXpfqNiskchw9jOEz0-PA5oK4Mc0fIP2ublvs7Ffd_HzXojTE8FL8oDFZ0suiKowtcuRWr2i9_u93AAAA__9edOuG

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT b, c, d, e FROM (SELECT b, c, d, e FROM abcde INTERSECT SELECT b, c, d, e FROM abcde) WHERE c = 1 AND d = e ORDER BY b
----
distribution: local
vectorized: true
·
• intersect
│ columns: (b, c, d, e)
│ ordering: +b
│ estimated row count: 1 (missing stats)
│
├── • filter
│   │ columns: (b, c, d, e)
│   │ ordering: +b,+d
│   │ estimated row count: 1 (missing stats)
│   │ filter: (c = 1) AND (d = e)
│   │
│   └── • scan
│         columns: (b, c, d, e)
│         ordering: +b,+c,+d
│         estimated row count: 1,000 (missing stats)
│         table: abcde@abcde_b_c_d_e_idx
│         spans: FULL SCAN
│
└── • filter
    │ columns: (b, c, d, e)
    │ ordering: +b,+d
    │ estimated row count: 1 (missing stats)
    │ filter: (c = 1) AND (d = e)
    │
    └── • scan
          columns: (b, c, d, e)
          ordering: +b,+c,+d
          estimated row count: 1,000 (missing stats)
          table: abcde@abcde_b_c_d_e_idx
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0lN1u2jAYhs93FdZ3BMIV5Ac6WUJKW1ItEoUuQfvRhFCIv9JoIWG2o3aquPfJSbuGrMlG1eUgUl47jx-_AT-A_JEAA_fL9fTMm5HOxAsWwccpJZ9c_3weuF0SuFP3YkHWlESUcEqQXPrzK9JpyMN1xJF4s4XrB3q8bVqXfP7g-i7pRGRMjC45m01Ih5MxwS6Z-xPXJ-dfyRoopBnHWbhFCewbGLCksBNZhFJmQkcPxQSP3wMbUIjTXa50vKQQZQKBPYCKVYLAYBGuE_Qx5Cj6A6DAUYVxUmALI6e4r9araMVXuIr5PVC4yJJ8m0pW2QRQCHahzk5guaeQ5ep5UanCDQIzKpbeBNhgT_9d9DJOFAoUfePQsswZ6Tim7owx5s0W7x-rcywyJo7dbVQya0rGMUrV7sz_3J1VEzVf1Z31lt3ZNSXrGKVJLFWcRqpvHyo5BnVM6ljU0QNzwVEgZ0THVqPJsGZiv8pk-AYmo5rJsNHkWSBPsxJ-sP5Sv_m3KS9s5wrFBgNU811_dLihxc8dsspBdDadAoUEb1THMXrUsXrUMXvUsXvdsYg3t3_GuodclR08VdPUxGmtidEx38RHuctSifVGXlxpUFvpxNC9IN9g2bPMchHhtciiYm75OC9ARcBRqnLUKB-89GlIKoHh9vdZVSUZrSS7mWTWSWYryWomGXWS1UoaNpOsOsluJY0OSEaVZNdJwyNIZpU0rJNGraTTtm-3pHCTZHermAODweN18sLt6QL9QriR-kcZ3GZ3BVb_gSSwmzCRSOEq_I4TVCi2caqPkAiYEjnu9-9-BQAA__9eupZj

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT b, c, d, e FROM (SELECT b, c, d, e FROM abcde EXCEPT SELECT b, c, d, e FROM abcde) WHERE c = 1 AND d = e ORDER BY b, c, d, e
----
distribution: local
vectorized: true
·
• except
│ columns: (b, c, d, e)
│ ordering: +b,+d
│ estimated row count: 1 (missing stats)
│
├── • filter
│   │ columns: (b, c, d, e)
│   │ ordering: +b,+d
│   │ estimated row count: 1 (missing stats)
│   │ filter: (c = 1) AND (d = e)
│   │
│   └── • scan
│         columns: (b, c, d, e)
│         ordering: +b,+c,+d
│         estimated row count: 1,000 (missing stats)
│         table: abcde@abcde_b_c_d_e_idx
│         spans: FULL SCAN
│
└── • filter
    │ columns: (b, c, d, e)
    │ ordering: +b,+d
    │ estimated row count: 1 (missing stats)
    │ filter: (c = 1) AND (d = e)
    │
    └── • scan
          columns: (b, c, d, e)
          ordering: +b,+c,+d
          estimated row count: 1,000 (missing stats)
          table: abcde@abcde_b_c_d_e_idx
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0lF1v2jwYhs_fX2E9RyBcQT6grywhpS2phkShS9DWaUIoxE9ptJAw21E7Vfz3yUlZwSNsVF0OIuW2ffnKHfAzyO8pMPDvbkcXwzFpDIbhNPw4ouSTH1xOQr9JQn_kX03JgpKYEk4JkutgckMaNXm0iDkS_-7Kv53WrS3nNMnnD37gk0ZM-sRqkovxgDQ46RNskkkw8ANy-WVnJVDIco7jaIUS2FewYEZhLfIYpcyFjp7LCUP-BKxDIcnWhdLxjEKcCwT2DCpRKQKDabRIMcCIo2h3gAJHFSVpiS3VvPI-X8zjOZ_jPOFPQOEqT4tVJtm-U7iOdHYGsw2FvFCvm0oVLRGYtWM5HADrbOjfi14nqUKBom3tW1Y5Iw3P1uUxxobj6f8vHXoO6RPPbdYq2YaSdYrSbnf2P-7OMUTtN3XnvGd3rqHknKI0SKRKsli13X0lz6KeTT2HenpgIjgK5Izo2Kk16Rom7ptMuu9g0jNMurUmrwJFllfwvf1neuWfphx4nRsUSwxRTdbt3v4LTX-skW2Po4vRCCikeK8antWintOint2inttq9kWyfPg91iUUqipg20tdDedGDb1TPkiAcp1nEs06Du7UMXY6s3QpyJdYlSzzQsR4K_K4nFs9TkpQGXCUqhq1qodhth2SSmC0-nVQ7ZKsoyS3nmSbJPsoyaknWSbJOUrq1pMck-QeJfX2SNYuyTVJ3RNI9i6pa5J6R0nnx77djMJ9mj_OEw4MOi_X2YHb9gK9IFpK_aMMH_LHEqv_PRLYfZRKpHATfcMBKhSrJNPnRwxMiQI3m_9-BgAA__-PI5aj

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT * FROM (SELECT * FROM abcde EXCEPT ALL SELECT * FROM abcde) WHERE c = 1 AND d = e ORDER BY a
----
distribution: local
vectorized: true
·
• except all
│ columns: (a, b, c, d, e)
│ ordering: +a
│ estimated row count: 1 (missing stats)
│
├── • filter
│   │ columns: (a, b, c, d, e)
│   │ ordering: +a
│   │ estimated row count: 1 (missing stats)
│   │ filter: (c = 1) AND (d = e)
│   │
│   └── • scan
│         columns: (a, b, c, d, e)
│         ordering: +a
│         estimated row count: 1,000 (missing stats)
│         table: abcde@abcde_pkey
│         spans: FULL SCAN
│
└── • filter
    │ columns: (a, b, c, d, e)
    │ ordering: +a
    │ estimated row count: 1 (missing stats)
    │ filter: (c = 1) AND (d = e)
    │
    └── • scan
          columns: (a, b, c, d, e)
          ordering: +a
          estimated row count: 1,000 (missing stats)
          table: abcde@abcde_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0k29r2zAQh9_vUxz3KlmuNP4TGIKA2sZlgTTp4rB1jFBU-5qaOrYnyXSl5LsPO-2amCRbx-YXBt3Jjx79LD2h-Z6iwODqcnQyHENrMAxn4acRwedgejoJgzaEwSg4m8F7OJ9OLqC1PVQ3UcwQXJ0FlzM4GY1gR7sNXz4G0wBaEfTBacPJeACtGPrAbZhMB8EUTr-CQsIsj3mslmxQfEMH54SFziM2JtdV6ameMIx_oOgSJllR2qo8J4xyzSie0CY2ZRQ4UzcpT1nFrI-7SBizVUlaY2sjWb-vi3t-RMKzPC2XmRGgCG4IIoKYgJEwLFRVPsL5ijAv7euCxqoFo3A2DIcDFN0V_bnkeZJa1qyPnW3DdV1AS3pVXkKI4Xj24Tk26UMfZK-9V8ltKDlvUdrMzf2PuXkNSfevcvP-ZW5-Q8nbq_RqUma5jllzvCUyr7783ZQd-7pgveCQ7aQ49rd3NnssWGxcMiRM-da2pNMh6XZIeh2Sfodkr9Pu62Rxt7uFhJPSCpAOSZekR9In2dubSK-RiP-WnzRlU-SZ4WYyO1fqNlY6cqp8OF7wOm-TlzriS51H9dz1cFKD6kLMxq67znowzF5axmpWy193c5PkHCT5WyRnk-Q2Se5BkrffyWmSvDc4uZskr0nyD5J6h3KaE96m-cN1EqPA7vNztOP18mD1gVqY6gCEd_lDja0OrUFxq1LDhBfqngdsWS-TLDE2iVBYXfJq9e5nAAAA__9aXAZS

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT * FROM (SELECT * FROM abcde INTERSECT ALL SELECT * FROM abcde) WHERE c = 1 AND d = e ORDER BY b, c, d, e, a
----
distribution: local
vectorized: true
·
• intersect all
│ columns: (a, b, c, d, e)
│ ordering: +b,+d,+a
│ estimated row count: 1 (missing stats)
│
├── • filter
│   │ columns: (a, b, c, d, e)
│   │ ordering: +b,+d,+a
│   │ estimated row count: 1 (missing stats)
│   │ filter: (c = 1) AND (d = e)
│   │
│   └── • scan
│         columns: (a, b, c, d, e)
│         ordering: +b,+c,+d,+e,+a
│         estimated row count: 1,000 (missing stats)
│         table: abcde@abcde_b_c_d_e_idx
│         spans: FULL SCAN
│
└── • filter
    │ columns: (a, b, c, d, e)
    │ ordering: +b,+d,+a
    │ estimated row count: 1 (missing stats)
    │ filter: (c = 1) AND (d = e)
    │
    └── • scan
          columns: (a, b, c, d, e)
          ordering: +b,+c,+d,+e,+a
          estimated row count: 1,000 (missing stats)
          table: abcde@abcde_b_c_d_e_idx
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0k21r4koUx9_fT3E4r_R6Ss2DcBkQpq0pV7DaTWQfWERi5tSGjYk7M6Fdit99SWy3GtTdLrt5EZgzJ7_5zT8zT2i-Zigw-Hg7uhiOoTUYRtPo3YjgfRBeTqKgDVEwCq6m8C9ch5MbaO0P40WiGIbjaRBGVfliNIIDHW348H8QBtBKoA9OGy7GA2gp6AO3YRIOghAuP8GCICFQBEwQI2FeKB7HKzYoPqODM8K1LhI2ptBV6aluGKpHFF3CNF-XtirPCJNCM4ontKnNGAVO40XGIceK9XkXCRXbOM1qbG0n6_d8MU_mas7zVD0i4VWRlavcCIhpxwwJo3Vclc9wtiEsSvu6rrHxklE4O6LDAYruhn7d9TrNLGvW586-6LYuoCW9KkIhxHA8_e85SelDH2SvfVTJbSg5b1Hajc_9-_F5DVf3t-Lz_mR8fkPJO6r0alLmhVasWe2JzKovf9ZyYF83rJccsZ2sz_39nU2_rVns30AkzPjOtqTbIel3SDodkl6HZK_T7ut0eX94CgknpRUgHZIuSY-kT7J3NJReIxT_Lf8pZLMucsPNcA6u1G2sdOZUEbFa8jZyU5Q64VtdJHXvdjipQXVBsbHbWWc7GOYvU8Zqjlc_bukuyTlJ8vdIzi7JbZLckyTvuJPTJHlvcHJ3SV6T5J8k9U7lNCO8y4qHeapQYPf5OTvwenmw-iBemuoARPfFQ42tzq1BcRdnhglv4i88YMt6leapsWmCwuqSN5t_vgcAAP__6D4QDA==

# Regression test for #64181. Ensure that a projection on top of an ordered
# UNION ALL correctly projects away ordering columns.
query T
EXPLAIN (DISTSQL,VERBOSE) WITH q (x, y) AS (
  SELECT * FROM (VALUES ('a', 'a'), ('b', 'b'), ('c', 'c'))
  UNION ALL
  SELECT * FROM (VALUES ('d', 'd'))
)
SELECT 'e', y FROM q
ORDER BY x
----
distribution: local
vectorized: true
·
• project
│ columns: ("?column?", y)
│
└── • render
    │ columns: ("?column?", x, y)
    │ ordering: +x
    │ render ?column?: 'e'
    │ render x: column1
    │ render y: column2
    │
    └── • union all
        │ columns: (column1, column2)
        │ ordering: +column1
        │ estimated row count: 4
        │
        ├── • sort
        │   │ columns: (column1, column2)
        │   │ estimated row count: 3
        │   │ order: +column1
        │   │
        │   └── • values
        │         columns: (column1, column2)
        │         size: 2 columns, 3 rows
        │         row 0, expr 0: 'a'
        │         row 0, expr 1: 'a'
        │         row 1, expr 0: 'b'
        │         row 1, expr 1: 'b'
        │         row 2, expr 0: 'c'
        │         row 2, expr 1: 'c'
        │
        └── • values
              columns: (column1, column2)
              size: 2 columns, 1 row
              row 0, expr 0: 'd'
              row 0, expr 1: 'd'
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyckl9vmzAQwN_3KU73QthcBUP64qekC9uQKHSQdpumaqJw7dAoTm2ztqry3SdgXRtUomY8IP85_353Zz-gvqlQoP_1JFwEEUyWQbpKP4cMzvzkKE59G74Eq09wA5M7Bvc2LFKYpH7ov1_BW_iQxMcwOVuEp34KEyuzGFiZZTOYWBft-KIf5-04t2wbTqMgjmARhjDGKNrYwrJt-zHEIovBfR93A3Gy9BM4-gZ3yLCWBUXZNWkU35HjOcO1kjlpLVW79NAFBMUdCodhWa8b0y6fM8ylIhQPaEpTEQqsZJ5V8DurGtLgTB1kWJDJyqqL3zCUjXk6rU12RSj4M12wROFs2OuNqVSG1JRvmXDO3-GYzh3o-D66rQL51H1Vgd7A6I4an0RSFaSoeKmsF9KK5IFcT73t6ITqgpRoL14Ika6SIPrIYM4ZzN3R7swGuXr7dKdPY7adRtwY0Vrn3qj0cCCd7SNNSK9lrelVV-EMTAe8bScVV9S3X8tG5XSiZN7F9tO4A3ULBWnT7_J-EtSPW9ooyq7_PeDnJL6T5G2R-HMSH5Lc_yW5Q5K3kzQbr84bkmY7SYe7-nTO8LKStz_KAgU6f7-DF36PH7YHsivdPoD0p7ztsKv7dXt9l1mlieFx9ouWZEhdl3WpTZmjMKqhzebNnwAAAP__o5LDMw==

# Regression tests for #64062. Use a streaming set operation even though the
# ordering is not required.
query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a, b, c FROM abcde UNION SELECT b, c, d FROM abcde
----
distribution: local
vectorized: true
·
• union
│ columns: (a, b, c)
│ estimated row count: 2,000 (missing stats)
│
├── • scan
│     columns: (a, b, c)
│     ordering: +a
│     estimated row count: 1,000 (missing stats)
│     table: abcde@abcde_pkey
│     spans: FULL SCAN
│
└── • scan
      columns: (b, c, d)
      ordering: +b,+c,+d
      estimated row count: 1,000 (missing stats)
      table: abcde@abcde_b_c_d_e_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJycktFr2zAQxt_3V4h72siF2s6bnrw1GRjSpIuzMRjGKNI1M3UsT5JpS_D_PqQ0a2KasVUPAt1J3_e7z96D_VUDh9n32_nHbMHeT7N8nX-ZI_s2W31a5rMPLJ_NZ9drJpBtkEn2ebW8YWIjFbGvi2y5OPZ9E5k66QNCoxUtxI4s8B8QQ4HQGi3JWm18aR8uZOoReIRQNW3nfLlAkNoQ8D24ytUEHNZiU9OKhCJzFQGCIieqOsgGrzTsZXtPT4Bwretu11h-hAaEvBW-MIaiR9Cde7GyTmwJeHzClk2BRz2-DS--jLcpZalKKiv1eEr5HN2_UCYDyvgi5QucNooMqXOsNB5hmowwnYyg6F8ZaVpZVzXSXSXDh5gmmE4uIk4GiMn_BLki2-rG0pnnJado4DSO_SCktnQIwOrOSLo1Woa7h-MyCIWCIusO3eRwyJrQir2DIbH78x-cKsVvVYqHSslflSZnStE5U4FwV-uHslLAIXpe41e24wL_QGytDzv_qR-C7Pqp9VHdidoSwo24pyk5Mruq8R9fAnemo75_9zsAAP__dcpRbA==

# Use a streaming set operation even though the ordering is not required.
query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a, b, c FROM abcde INTERSECT SELECT b, c, d FROM abcde
----
distribution: local
vectorized: true
·
• intersect all
│ columns: (a, b, c)
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (a, b, c)
│     ordering: +a
│     estimated row count: 1,000 (missing stats)
│     table: abcde@abcde_pkey
│     spans: FULL SCAN
│
└── • scan
      columns: (b, c, d)
      ordering: +b,+c,+d
      estimated row count: 1,000 (missing stats)
      table: abcde@abcde_b_c_d_e_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyckt9r2zAQx9_3V4h7asmFWs6bYOCu8cCQH10cxmAEo1iX1NSxPEmmLSH_-5CTrk5ItrV-EOjuq-997nxbsL9KEBD_uB_dJhN2NUzSefpthOx7PPsyTeNrlsaj-G7OJLIlspx9nU3HTC5zRSyZzONZ6pMHjRcgUx0NIFRa0URuyIL4CRwWCLXROVmrjQ9tW0GinkEECEVVN86HFwi5NgRiC65wJYGAuVyWNCOpyNwEgKDIyaJsbdtaUXtm9SO9AMKdLptNZcUrOCCktfSBPix2CLpxb6Wsk2sCwTtsyRBEsMOP4fHLeMssz1RGWaGeu5SH0f0PZXhCyS9SvsE1lTaKDKkjsIV_-S_JmVbHZNaUkpvWN-Fxp_OXmkRnMW5HI0AoaeWuIt7DKOxhNOhdfzbF-uE4BAjTxgkWcYxCjAYX2x-ctB--5yfNyNa6snQ6hrOVgpNKfe6HQWpN--Fa3Zic7o3OW-3-Om2N2oAi6_bZcH9JqjbFfQVDcvNnx7pO_B1OYdeJnzqFf3UaHDkFx0wLhFWpn7JCgYDg8PXPHK8f-Adybf2w0wf91Nr6bbAgVrK0hDCWjzQkR2ZTVIV1RQ7CmYZ2u0-_AwAA___B_G7U

# Use a streaming set operation even though the ordering is not required.
query T
EXPLAIN (DISTSQL,VERBOSE) SELECT b, c, d FROM abcde INTERSECT ALL SELECT b, c, d FROM abcde
----
distribution: local
vectorized: true
·
• intersect all
│ columns: (b, c, d)
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (b, c, d)
│     ordering: +b,+c,+d
│     estimated row count: 1,000 (missing stats)
│     table: abcde@abcde_b_c_d_e_idx
│     spans: FULL SCAN
│
└── • scan
      columns: (b, c, d)
      ordering: +b,+c,+d
      estimated row count: 1,000 (missing stats)
      table: abcde@abcde_b_c_d_e_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0Ut9r2zAQft9fIe6ppRdqOW-CgbvGA0N-dHEYgxGMYl1cM8fyJJl2hPzvQ866xibZ6GB6EOi7u-_77nR7sN8rEBB_eZjeJXN2NUnSVfppiuxzvPywSONrlsbT-H7FNshyZIp9XC5mTG5yRSyZr-Jl6oN30-nlPECotaK53JEF8RU4rBEao3OyVhsP7buERD2DCBDKummdh9cIuTYEYg-udBWBgJXcVLQkqcjcBoCgyMmy6mg7rai7s02WZyqjrFTPgHCvq3ZXW_HiDRDSRnpgBOsDgm7dq6J1siAQ_MRiMgERHPDfXPL_6TIcuOQXXb6aa2ttFBlSPWNrX_m3lDOtzsgUlJJbNLdhv9PVj4ZEf0cAoaKtu4r4DUbhDUbjm-v3piwe-xAgLFonWMQxCjEaX2x_PGg_fMsnLck2urY0HMNZpWCgNOJ-GKQKOg7X6tbk9GB03uUen4uOqAMUWXeMhsdHUnch7hUMyd3vHTtl4m9gCk-Z-JAp_CPTuMcU9D2tEbaVfspKBQKCX2d05no54AtkYf2w00f91NH6bbAgtrKyhDCT32hCjsyurEvryhyEMy0dDu9-BgAA__-xLXJp

# Use a streaming set operation even though the ordering is not required.
query T
EXPLAIN (DISTSQL,VERBOSE) SELECT b, c, d FROM abcde EXCEPT SELECT a, d, e FROM abcde
----
distribution: local
vectorized: true
·
• except
│ columns: (b, c, d)
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (b, c, d)
│     ordering: +b,+c,+d
│     estimated row count: 1,000 (missing stats)
│     table: abcde@abcde_b_c_d_e_idx
│     spans: FULL SCAN
│
└── • scan
      columns: (a, d, e)
      ordering: +a
      estimated row count: 1,000 (missing stats)
      table: abcde@abcde_pkey
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyck1Fr4kAQgN_vVyzz1NIpmsS-LBykpzkQtHpGjsIhYc2ONjRmc7sb2iL-9yOxtjGop81DYGdnv_lm2F2D-ZsCh-BxPLjvP7CrXj-chr8GyH4Hkx-jMLhmYTAIulM2RxYjk-znZDRkYh5LYsFjNxhPdwkCmURGtQRAyJSkB7EiA_wPODBDyLWKyRily9C6SujLV-BthCTLC1uGZwix0gR8DTaxKQGHqZinNCEhSbfagCDJiiStsFUtv_pH8yiOZERRIl8BoavSYpUZvpMHhDAXZeAWZhsEVdjPisaKJQF3aor9HvD2Br9m6Ry3zJ_pra73Prpz9NyGnnOJXi8xNsli23L33XwHfRd9DxBGWpImydlH7JiJ1zBxv2TinWNy1KHTcPCOOnyWLjK1Je9VnpUn_5dyoJEh6SWFZEd5q7PfyvQtJ757I_eDASCktLBXvnODvnuDvndz_V0ny6f9UNl5Yc-Y_12j984l85-QyVVmqDmDg5XajUq3TjkJkkvaTtaoQsc01iqucrfLUQWqApKM3e6620U_220Zq0msPt5ZneScJHnHSU6T5J4kdfZITp3kNkneBSS3TvKapM5J0t2pOc0QFql6iRIJHNrv3-2B3-6D8oBYmvIChE_qpcKW19MAX4jUEMJQPFOPLOlVkpVPMwZudUGbzbd_AQAA__-RwvKB

# Use a streaming set operation even though the ordering is not required.
query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a, b, c FROM abcde EXCEPT ALL SELECT b, c, d FROM abcde
----
distribution: local
vectorized: true
·
• except all
│ columns: (a, b, c)
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (a, b, c)
│     ordering: +a
│     estimated row count: 1,000 (missing stats)
│     table: abcde@abcde_pkey
│     spans: FULL SCAN
│
└── • scan
      columns: (b, c, d)
      ordering: +b,+c,+d
      estimated row count: 1,000 (missing stats)
      table: abcde@abcde_b_c_d_e_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJycklFr2zAQx9_3KcQ9tfRCLedNMHCXeBBImiwOozCCUaxLaupYniTTlpDvPuQ0q2OSbZ0eBDr99b_fnW4H9mcBAuKH2fhudM-uhqNkkXwbI_sez79Mk_iaJfE4HiyYRLZClrGv8-mEyVWmiMUPg3i2YHfj8VHkFchUSwQIpVZ0L7dkQfwADkuEyuiMrNXGh3aNYKReQAQIeVnVzoeXCJk2BGIHLncFgYCFXBU0J6nI3AaAoMjJvGhsm1xRs6fVE70CwkAX9ba04kgOCEklfaAHyz2Crt17KuvkhkDwFttoCCLY4__h8ct4qzRLVUpprl7alG-t-xfKsEPJL1K-w9WlNooMqROwpX_5N8mZUidkNpSQm1a34Wmli9eKRGsyAKGgtbuK-A1G4Q1G_ZvrzybfPJ6GAGFaO8EijlGIUf9i7f1O7eFHfmhOttKlpW4PzmYKOpl63HeC1IYOnbW6NhnNjM4a7eE4bYyagCLrDrfh4TAqmyvuMxiS298D1nbiH3AK20686xT-0al_4hScMi0R1oV-TnMFAoK31TuzHRf4B3JjfbOTR_3c2PpRsCDWsrCEMJFPNCRHZpuXuXV5BsKZmvb7T78CAAD__-Xobf0=

# Do not use a streaming set operation for UNION ALL.
query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a, b, c FROM abcde UNION ALL SELECT b, c, d FROM abcde
----
distribution: local
vectorized: true
·
• union all
│ columns: (a, b, c)
│ estimated row count: 2,000 (missing stats)
│
├── • scan
│     columns: (a, b, c)
│     estimated row count: 1,000 (missing stats)
│     table: abcde@abcde_pkey
│     spans: FULL SCAN
│
└── • scan
      columns: (b, c, d)
      estimated row count: 1,000 (missing stats)
      table: abcde@abcde_pkey
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyckVFr2zAUhd_3K8R92kChlvump3WNBwbX6eJsDIYpinWbiSqWJ8l0Jfi_D8nNmphspNWDQFfH53w63oH7pYFD9v22uMpL8n6eV6vqS0HJt2z5aVFlH0iVFdn1ighK1pQ05PNycUPEupFIvpb5oiRXRbHXBAEl8kADFFojsRRbdMB_AIOaQmdNg84ZG0a7KMjlb-AJBdV2vQ_jmkJjLALfgVdeI3BYibXGJQqJ9iIBChK9UDraxqyPcb_rHvAJKFwb3W9bx_fgQKHqRBjMoB4omN6_RDkvNgicHbDlc-DJQN-Gx87He-7sHLx0gsf-ifdC5dAqoUnfGivRojwCq4cT7yjNzHQX6UR4muhyQpS-prAlus60Ds9KSiZJMxbYUW5wfK8zvW3w1pomasfjIhrFgUTnx9t0PORtvGIhwaLY_v3fh07srU5s6pT-1-nyyCk5Zqop3GvzeKckcEie1-zEtl8QPhAbF8qufprHaLt66kJV90I7pHAjHnCOHu1Wtcp51QD3tsdhePcnAAD__6gtTXQ=

# Regression test for #69497. Ensure the merge ordering for streaming set ops
# matches the input ordering.
statement ok
DROP TABLE abc;

statement ok
CREATE TABLE abc (a INT, b INT, c INT, INDEX (a, b, c DESC));
CREATE TABLE def (d INT PRIMARY KEY, e INT, f INT);

query T
EXPLAIN (VERBOSE, DISTSQL) SELECT d, e, f FROM def EXCEPT SELECT a, b, c FROM abc ORDER by d, e
----
distribution: local
vectorized: true
·
• except all
│ columns: (d, e, f)
│ ordering: +d
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (d, e, f)
│     ordering: +d
│     estimated row count: 1,000 (missing stats)
│     table: def@def_pkey
│     spans: FULL SCAN
│
└── • scan
      columns: (a, b, c)
      ordering: +a,+b,-c
      estimated row count: 1,000 (missing stats)
      table: abc@abc_a_b_c_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJycklFr2zAQx9_3KcQ9tfRCbedNMHCbeBBI6swOo2MEI1vn1NSxPEmmLSHffdhp1tik2zo9GHSn-9_v_r4dmJ8lcAjul_Ob2R27mM7iVfx1juxbEN2GcXDJ4mAeTFZMIiNkOfsShQsmKWfB_SRYro5pgSxFlh3SIs1YGE2DiN1-7woBoVKS7sSWDPAf4MIaodYqI2OUbkO77sFMPgN3EIqqbmwbXiNkShPwHdjClgQcViItKSIhSV87gCDJiqLsZCXlvqQ8qR_pBRAmqmy2leFHdkCIa9EGRrDeI6jGvrUxVmwIuHvCNZsCd_b4f2huH02kmS_SLBFJmmRJIZ9P-V7N-xc-b8Dnvsv3htVUSkvSJHtI67byb0_ODLkgvaGYbFhfe_0ZVy818eNe3MzngFBSbi989wp97wr98ejysy42D_0QIISN5cx30ffQH787-3gwu_eRfxORqVVlaOjB2U7OoNPIbZ0guaGDs0Y1OqOlVln39nANO6EuIMnYQ9Y7XGZVl3LbDprE9vdqnSq5H1DyTpXcoZL3R6VxT8npM60R8lI9JYUEDs7rGZ35HA-0BWJjWrPjB_XUybarYIDnojSEsBCPNCVLeltUhbFFBtzqhvb7T78CAAD__5tLaz4=

# Example where the interesting orderings do not include all columns.
statement ok
CREATE TABLE abcd (a INT, b INT, c INT, d INT, INDEX (a, b, c DESC) STORING (d));
CREATE TABLE efgh (e INT PRIMARY KEY, f INT, g INT, h INT)

query T
EXPLAIN (VERBOSE, DISTSQL) SELECT e, f, g, h FROM efgh EXCEPT SELECT a, b, c, d FROM abcd ORDER by e, f
----
distribution: local
vectorized: true
·
• except all
│ columns: (e, f, g, h)
│ ordering: +e
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (e, f, g, h)
│     ordering: +e
│     estimated row count: 1,000 (missing stats)
│     table: efgh@efgh_pkey
│     spans: FULL SCAN
│
└── • sort
    │ columns: (a, b, c, d)
    │ estimated row count: 1,000 (missing stats)
    │ order: +a,+b,-c,+d
    │ already ordered: +a,+b,-c
    │
    └── • scan
          columns: (a, b, c, d)
          ordering: +a,+b,-c
          estimated row count: 1,000 (missing stats)
          table: abcd@abcd_a_b_c_idx
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyckm9r2z4Qx5__XoW4Ry29UP_JI8EP3DYeBNKms8PoGMEo1sUxdSxPkmlLyXsfctbV8dpumR4IdDp973Nf3TOY7xVwiO9uZxfTG3YymaaL9PMM2Zc4uZyn8SlL41l8tWCEbI2sQLZhn5L5NaN1sWHx3VV8u3hJEchWyHJkcp8iVrlk82QSJ-zyaycACLWSdCO2ZIB_Ax-WCI1WORmjtAs9dwlT-QjcQyjrprUuvETIlSbgz2BLWxFwWIhVRQkJSfrcAwRJVpRVJ-vYIrdlzT09AcKVqtptbXivC0BIG-FiI1juEFRrX2sZKwoC7vfgphPg3g7_jc8_5HPGRG7LRLbK8qyUj33IVx__BjIYQPrHQKZKW9LnwSFf5J9hFJxhFI4wGp8BwlbYfMMqqjkL3yUJByTBuySvAG2ttCRN8oBg6V7-KeWNdq5JF5SSnTfn4WFLi6eG-Mu8XsxmgFDR2p4MWj39X5fF5vcwIMxby1nkYxRgFGI0fteG8cCG8JgPScg0qjY0tOPNSt6g0sh3ppAsaG-yUa3O6VarvMvdH-edUBeQZOz-NtwfpnV35bsKmsT21zz1lfwPlYIDJa-v5A2VgiOYgr5SMFQKP1Qaf8S0RFhX6iErJXDwfq7RG9vLAvdAFMZ9W7pRD52smy8DfC0qQwjX4p4mZElvy7o0tsyBW93SbvffjwAAAP__n2i1vg==

# Regression test for #68702. Ensure correct behavior when a column is projected
# twice on the left side.
statement ok
CREATE TABLE t68702 (k INT8 PRIMARY KEY)

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT tableoid AS col1, tableoid AS col2, k AS col3 FROM t68702
EXCEPT ALL SELECT * FROM (VALUES (NULL, 2505326470:::OID, (-1643624263):::INT8))
----
distribution: local
vectorized: true
·
• except all
│ columns: (col1, col2, col3)
│ estimated row count: 1,000 (missing stats)
│
├── • project
│   │ columns: (tableoid, tableoid, k)
│   │ ordering: +k
│   │
│   └── • scan
│         columns: (k, tableoid)
│         ordering: +k
│         estimated row count: 1,000 (missing stats)
│         table: t68702@t68702_pkey
│         spans: FULL SCAN
│
└── • values
      columns: (column1, column2, column3)
      size: 3 columns, 1 row
      row 0, expr 0: 2505326470
      row 0, expr 1: -1643624263
      row 0, expr 2: CAST(NULL AS OID)
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyUUm1r2zwU_f78CnE_JU8VasltWgQDZ40HBjfp4rQURiiafZuaKJYnyetKyX8ftvsSm3ZbhbGto6tzzzncR7A_FAgIry_iSTQjg2mULJOvMSVX4eLzPAmHJAnj8GxJnPyuUOcZmSQk1YrRPsIp2Tz9-uTLYn5O3Pj0xOMkvD4LL5ZkEsfPXP-354OrSXwZJmQwu4xjSvixd-zz8dGJJ4SYR1NKBiM2PvLH_IiP_aEQIpotT4dDoFDoDGdyixbEN2CwolAanaK12tTQY1MQZb9AeBTyoqxcDa8opNogiEdwuVMIApa1hwXKDM2hBxQydDJXDW2rPmg_N-UGH4DCmVbVtrCCbF79A4WklDU4AgrzygkScFo_DFY7CrpyrwKsk2sEwfYUR1MQ3o7-u2ilU6nIT6kqtMQ7ZF3drQCfBowG_F0BvCeAvSvgtW9VaJOhwazTcFXf_FvJGy7O0awxQTcvD3nXwfKhRLE3NkBB4a0bBP4BDdgBDfjB8JPJ13dd6CV81oTvv-vd73nnHwl_gbbUhcV-Bm928nqdRqxOArM1tslaXZkUL4xOm9p2O2-IGiBD69pT3m6iojlidQeDcvsyO_tM7ANMfJ-J9Zn4H5n8DpPX1bSicKv0_U2egQDvaY3eeD0vqC_Ita3DTu70fUNbj4IFcSuVRQrncoNTdGi2eZFbl6cgnKlwt_vvdwAAAP__X4d6wQ==

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a, b AS b1, b AS b2 FROM abc EXCEPT SELECT a, b, c FROM abc ORDER by a, b1
----
distribution: local
vectorized: true
·
• except
│ columns: (a, b1, b2)
│ ordering: +a,+b1
│ estimated row count: 1,000 (missing stats)
│
├── • project
│   │ columns: (a, b, b)
│   │ ordering: +a,+b
│   │
│   └── • scan
│         columns: (a, b)
│         ordering: +a,+b
│         estimated row count: 1,000 (missing stats)
│         table: abc@abc_a_b_c_idx
│         spans: FULL SCAN
│
└── • scan
      columns: (a, b, c)
      ordering: +a,+b,-c
      estimated row count: 1,000 (missing stats)
      table: abc@abc_a_b_c_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyck1Fr2zAQgN_3K8Q9tVShkZy-CAZuGw8Cad3ZYXSMEGT5mpo5lifJtKPkvw_bzeKYJFvqhxDpzt99d5bewP7KQUDw-DC9ntyTs_EknsVfp5R8C6KbMA7OSRxMg9sZkZQk5DomCdv84eRLFN4RmSgSPN4GD7NuKiVqGw6jcRCRm-9NhAGFQqd4L1doQfwABnMKpdEKrdWm3nprEibpK4ghhawoK1dvzykobRDEG7jM5QgCZjLJMUKZorkcAoUUnczyBisT5ctELeQiWahFlr4ChVudV6vCikYEKMSlrFcDoBBWThCfUZ9Tn8N8TUFXblvYOrlEEKxjOhmDGK7px2TZibKUqK7vIT_e82On-I0z67JCuUu-K_c-Fa-ekknRYNpOyjuo4fU0-Ic0vP_T4MdMRj0T76DJVqAqdMvfqT-v3_xXyp527tAsMUYXlpej3YZmv0sUm7tzPZ0ChRyf3JnPLqjPL6jvDc4_m2z5vLvVO6yHe7_q9T465StEaEtdWOzPYG-lYa_SgNWTwHSJ7WStrozCB6NVk9suwwbUbKRoXRvl7WJSbELWGZSrv3etS2JHSd5hEuuT-FHSaIfEuiTeJ3knkHiX5PVJo6Okq2NzmlN4yvXLIktBwPD9Gez52TxQvyCXtj4A8bN-abD18bQgnmRukcKd_IljdGhWWVFfUAXCmQrX609_AgAA__8_bvjt

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a, b AS b1, b AS b2 FROM abc INTERSECT SELECT a, c, b FROM abc ORDER by a, b2
----
distribution: local
vectorized: true
·
• intersect
│ columns: (a, b1, b2)
│ ordering: +a,+b1
│ estimated row count: 1,000 (missing stats)
│
├── • project
│   │ columns: (a, b, b)
│   │ ordering: +a,+b
│   │
│   └── • scan
│         columns: (a, b)
│         ordering: +a,+b
│         estimated row count: 1,000 (missing stats)
│         table: abc@abc_a_b_c_idx
│         spans: FULL SCAN
│
└── • scan
      columns: (a, c, b)
      ordering: +a,+b,-c
      estimated row count: 1,000 (missing stats)
      table: abc@abc_a_b_c_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyck1Fr2zAQgN_3K8Q9tVShsZy-CAZuGw8Mad3ZYWyMEGT5mpo5lifJtKPkvw85TZOYxFvqhxCdTt99OkmvYH6XwCH8_jC5ju7J2ThKp-nXCSXfwuQmTsNzkoaT8HZKBCUZuU5J5m3-MPIlie-IyCSJ7qdhkrq0bbZ0ee8ZcTIOE3Lzo-UwoFCpHO_FEg3wn-DBjEKtlURjlHah1zYhyl-ADykUVd1YF55RkEoj8FewhS0ROExFVmKCIkd9OQQKOVpRlC1WZDIQmZyLeTaX8yJ_AQq3qmyWleGtCFBIa-FGA6AQN5aTwKMBowGD2YqCauy2sLFigcC9HdNoDHy4oh-T9U6UpUQe8fX7fFnH1zvFd1wYW1TSXrJ92bcu-c5C56gxfzM5quF3NNiHNPz_1OhryKhj4h812Qo0lVrz9-rP3Mp_pRzYzh3qBaZo4_pytL-h6Z8a-c5zup5MgEKJj_Ys8C5o4F_QgA3OP-ti8bQf6tzf4wdx1dn-6JSDSNDUqjLYbcPBSsNOpYHnmoH5AtfNNarREh-0km3uehi3oDaQo7HrWbYeRNVmyliNYvn-_HZJXi_JP07yuiTWSxrtkbxdEuuS_BNIbJfkd0mjXtJVX59mFB5L9TwvcuAwfPsGB342H7gFYmHcBUif1HOLdTfUAH8UpUEKd-IXjtGiXhaVe6MSuNUNrlaf_gYAAP__EAD-bg==
