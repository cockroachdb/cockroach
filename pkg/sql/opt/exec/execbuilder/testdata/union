# LogicTest: local

statement ok
CREATE TABLE uniontest (
  k INT,
  v INT
)

query T
EXPLAIN SELECT v FROM uniontest UNION SELECT k FROM uniontest
----
distribution: local
vectorized: true
·
• union
│
├── • scan
│     missing stats
│     table: uniontest@uniontest_pkey
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: uniontest@uniontest_pkey
      spans: FULL SCAN

query T
EXPLAIN SELECT v FROM uniontest UNION ALL SELECT k FROM uniontest
----
distribution: local
vectorized: true
·
• union all
│
├── • scan
│     missing stats
│     table: uniontest@uniontest_pkey
│     spans: FULL SCAN
│
└── • scan
      missing stats
      table: uniontest@uniontest_pkey
      spans: FULL SCAN

# Check that EXPLAIN properly releases memory for virtual tables.
query T
EXPLAIN SELECT node_id FROM crdb_internal.node_build_info UNION VALUES(123)
----
distribution: local
vectorized: true
·
• union
│
├── • virtual table
│     table: node_build_info@primary
│
└── • values
      size: 1 column, 1 row

statement ok
CREATE TABLE abc (a INT, b INT, c INT)

query T
EXPLAIN (VERBOSE) (SELECT a FROM abc ORDER BY b) INTERSECT (SELECT a FROM abc ORDER BY c) ORDER BY a
----
distribution: local
vectorized: true
·
• sort
│ columns: (a)
│ ordering: +a
│ estimated row count: 100 (missing stats)
│ order: +a
│
└── • intersect
    │ columns: (a)
    │ estimated row count: 100 (missing stats)
    │
    ├── • project
    │   │ columns: (a)
    │   │
    │   └── • scan
    │         columns: (a, b)
    │         estimated row count: 1,000 (missing stats)
    │         table: abc@abc_pkey
    │         spans: FULL SCAN
    │
    └── • project
        │ columns: (a)
        │
        └── • scan
              columns: (a, c)
              estimated row count: 1,000 (missing stats)
              table: abc@abc_pkey
              spans: FULL SCAN

# Regression test for #32723.
query T
EXPLAIN (VERBOSE) SELECT a FROM ((SELECT '' AS a , '') EXCEPT ALL (SELECT '', ''))
----
distribution: local
vectorized: true
·
• project
│ columns: (a)
│ estimated row count: 1
│
└── • except all
    │ columns: (a, a)
    │ estimated row count: 1
    │
    ├── • project
    │   │ columns: (a, a)
    │   │
    │   └── • values
    │         columns: (a)
    │         size: 1 column, 1 row
    │         row 0, expr 0: ''
    │
    └── • project
        │ columns: ("?column?", "?column?")
        │
        └── • values
              columns: ("?column?")
              size: 1 column, 1 row
              row 0, expr 0: ''

query T
EXPLAIN (VERBOSE) ((SELECT '', '', 'x' WHERE false))
UNION ALL ((SELECT * FROM (VALUES ('', '', 'x'), ('', '', 'x'))) EXCEPT (VALUES ('', '', 'x')))
----
distribution: local
vectorized: true
·
• render
│ columns: ("?column?", "?column?", "?column?")
│ estimated row count: 1
│ render ?column?: column1
│ render ?column?: column2
│ render ?column?: column3
│
└── • except
    │ columns: (column1, column2, column3)
    │ estimated row count: 1
    │
    ├── • values
    │     columns: (column1, column2, column3)
    │     size: 3 columns, 2 rows
    │     row 0, expr 0: ''
    │     row 0, expr 1: ''
    │     row 0, expr 2: 'x'
    │     row 1, expr 0: ''
    │     row 1, expr 1: ''
    │     row 1, expr 2: 'x'
    │
    └── • values
          columns: (column1, column2, column3)
          size: 3 columns, 1 row
          row 0, expr 0: ''
          row 0, expr 1: ''
          row 0, expr 2: 'x'

query T
EXPLAIN (VERBOSE)
SELECT 1 FROM (SELECT k FROM uniontest WHERE k > 3 UNION ALL SELECT k FROM uniontest)
----
distribution: local
vectorized: true
·
• render
│ columns: ("?column?")
│ estimated row count: 1,333 (missing stats)
│ render ?column?: 1
│
└── • union all
    │ columns: ()
    │ estimated row count: 1,333 (missing stats)
    │
    ├── • project
    │   │ columns: ()
    │   │ estimated row count: 333 (missing stats)
    │   │
    │   └── • filter
    │       │ columns: (k)
    │       │ estimated row count: 333 (missing stats)
    │       │ filter: k > 3
    │       │
    │       └── • scan
    │             columns: (k)
    │             estimated row count: 1,000 (missing stats)
    │             table: uniontest@uniontest_pkey
    │             spans: FULL SCAN
    │
    └── • scan
          columns: ()
          estimated row count: 1,000 (missing stats)
          table: uniontest@uniontest_pkey
          spans: FULL SCAN

statement ok
CREATE TABLE ab (a INT NOT NULL, b INT, INDEX(a, b), INDEX (b, a))

statement ok
CREATE TABLE xy (x INT NOT NULL, y INT, INDEX(x, y), INDEX (y, x))

# Regression tests for #41245, #40797. Ensure we can plan ordered set ops
# without a sort.
query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a FROM ab UNION SELECT x AS a FROM xy ORDER BY a
----
distribution: local
vectorized: true
·
• union
│ columns: (a)
│ ordering: +a
│ estimated row count: 200 (missing stats)
│
├── • scan
│     columns: (a)
│     ordering: +a
│     estimated row count: 1,000 (missing stats)
│     table: ab@ab_a_b_idx
│     spans: FULL SCAN
│
└── • scan
      columns: (x)
      ordering: +x
      estimated row count: 1,000 (missing stats)
      table: xy@xy_x_y_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJykkV9rgzAUxd_3KcJ92lhG1b751H8OhE477cbGEInmUgRrXBJBKX73oVI6yzr25817ruecX5IDqPccbHBeNuu565HrlRtuw8c1Jc9OsPBD54aEztpZbgkj94H_QFhCnjzX945yTebhcVc3xA9WTkAWr4QBhUJw9NgeFdhvYEJEoZQiRaWE7KRD_4PLa7ANCllRVrqTIwqpkAj2AXSmcwQbtizJMUDGUU4MoMBRsyzvY-tmVjdxHTdxxmugsBR5tS-UTbohLFn3eQdRS0FU-tSgNNsh2GZL_0ZhjilYMmNJzOLknIL9hMK6SHEqF5KjRD6unZm3ELVfoK4ypbMi1RPr3HARYvqbqwhQlaJQOEq_lGx0hMh3OJxIiUqmuJEi7WuG0e99vcBR6WFrDYNb9Kv-rT6bzf-YrW_N05HZaKP26iMAAP__HJAFqg==

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a, b FROM ab UNION SELECT x AS a, y AS b FROM xy ORDER BY a
----
distribution: local
vectorized: true
·
• union
│ columns: (a, b)
│ ordering: +a
│ estimated row count: 2,000 (missing stats)
│
├── • scan
│     columns: (a, b)
│     ordering: +a,+b
│     estimated row count: 1,000 (missing stats)
│     table: ab@ab_a_b_idx
│     spans: FULL SCAN
│
└── • scan
      columns: (x, y)
      ordering: +x,+y
      estimated row count: 1,000 (missing stats)
      table: xy@xy_x_y_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJykkV-rm0AQxd_7KZZ5asmWqHnzyfyxIKSaalpaisjqDkEwrt1dYSX43Yt6L7mGm8v98yQzZ86cn7MXUP8qcMH_fdivg5B83gXJMfmxp-SXH2-ixP9CEn_vb4-EUZKTb3H0nbCc_AyDKHxUDFkng9wN34cZ05Eo3vkx2fwhDCjUgmPIzqjA_Qs2pBQaKQpUSsihdRkHAm7AtSiUddPqoZ1SKIREcC-gS10huHBkeYUxMo5yaQEFjpqV1bjWdJ7pMpN1WckNUNiKqj3XyiWGkg4oJA0bqq-Q9hREq68hSrMTgmv39H0g9hyE5R7LM5bltyDDDV8D4twFueYLyVEinyd79oJ6zgLS_hniXal0WRd66dyaqOfcZVm95SgxqkbUCmcB9zZbAyTyE04_pkQrCzxIUYwxUxmNvrHBUelJdaYiqEdpfLWnZvsjZudF82pmtvq0__Q_AAD__9-WCy0=

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a, b FROM ab UNION ALL SELECT x AS a, y AS b FROM xy ORDER BY a
----
distribution: local
vectorized: true
·
• union all
│ columns: (a, b)
│ ordering: +a
│ estimated row count: 2,000 (missing stats)
│
├── • scan
│     columns: (a, b)
│     ordering: +a
│     estimated row count: 1,000 (missing stats)
│     table: ab@ab_a_b_idx
│     spans: FULL SCAN
│
└── • scan
      columns: (x, y)
      ordering: +x
      estimated row count: 1,000 (missing stats)
      table: xy@xy_x_y_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJykkV9rq0AQxd_vp1jm6V7uhqh98yn_LAhWU01LSxFZ3SEIxrW7CivB717UltTSlLR9kpk5Z87P2SOo5wJscB623tL1yd-NG-2iW4-SeydcBZHzj0SO56x3hFGSkuswuCEsJXe-G_hk6XlvU02WUS9p---rTrckCDdOSFaPhAGFUnD02QEV2E9gQkyhkiJDpYTsW8dB4HINtkEhL6um7tsxhUxIBPsIdV4XCDbsWFpgiIyjnBtAgWPN8mJYq9uFbhOdtEnONVBYi6I5lMommpIWKEQV66sZxB0F0dSnEFWzPYJtdvRnIOYUhKULliYsST-C9He8BMQ6C3LKF5KjRD5NXpj_Ie4-ofXFTFRza6I-l2585wwhqkqUCi_cHFNAvsfxV5RoZIZbKbIhZiyDwTc0OKp6nFpj4ZbDaHin92bzN2brS_PVxGx0cffnJQAA___k4AiO

# TODO(yuzefovich): The synchronizers in the below DistSQL plans are all
# unordered. This is not a problem, but we shouldn't need an input synchronizer
# at all when there is only one incoming stream. We should look into removing
# it.
query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a, b FROM ab INTERSECT SELECT x AS a, y AS b FROM xy ORDER BY b, a
----
distribution: local
vectorized: true
·
• intersect
│ columns: (a, b)
│ ordering: +b,+a
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (a, b)
│     ordering: +b,+a
│     estimated row count: 1,000 (missing stats)
│     table: ab@ab_b_a_idx
│     spans: FULL SCAN
│
└── • scan
      columns: (x, y)
      ordering: +y,+x
      estimated row count: 1,000 (missing stats)
      table: xy@xy_y_x_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJykktFrnEAQxt_7VyzzlJAtOb3Ly0LBS86CYM5UpbQUkVWnV8G4dncF5bj_vawGLkru2kufZGbnN9_3De5B_a6AgfvtyV97W3K18aI4-uJT8tUN74PIvSaR67sPMeGUZORzGDwSnhFvG7thZNovrx1ZR2akN9-Xua4nQbhxQ3L_nWSUcKBQiwK3_BkVsB9gQUKhkSJHpYQ0rf0w4BUdsAWFsm5abdoJhVxIBLYHXeoKgUHMswpD5AXK2wVQKFDzshrWdr3T9WmfdmlZdEDhQVTtc60Y6SjpgULUcFN9hORAQbT6KKI03yEw60DfZ8SaGuGZw7M0S_nciDnlvxixLzGyKZUu61zf2lMXjkUd0wpkgRILRhybOtZJzeW7NJf_pbk6qXmUamsxLpsoJYb828gbxh9R7jBCHTS3q6n1uG-Qvfq_174PFCr8qa8c-4Y61s31J1nufh1Lk7PVjIyhT2W8u-SuIapG1ArnWd_cvDABsdjheDAlWpnjkxT5IDOWwcANjQKVHl-XY-HV45Mx-Bq2zsL2edg-C68msDWHlxfA9hxenYXvZraTw4c_AQAA__-l7pov

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT b FROM ab INTERSECT ALL SELECT x AS b FROM xy ORDER BY b
----
distribution: local
vectorized: true
·
• intersect all
│ columns: (b)
│ ordering: +b
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (b)
│     ordering: +b
│     estimated row count: 1,000 (missing stats)
│     table: ab@ab_b_a_idx
│     spans: FULL SCAN
│
└── • scan
      columns: (x)
      ordering: +x
      estimated row count: 1,000 (missing stats)
      table: xy@xy_x_y_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJycUWFrnTAU_b5fEe6nlmX0ab8FBr62DgT77IyMjSGSmDsnWOOSCMrD_z5USuej3fb6Lffce-455-YI9lcDDMKvD_E-OpCLu4hn_HNMyZcwvUl4eEl4GIe3GZHkU5rcEyFJdMjClM_YPo6f2gPZ86eZYSRJehem5OYbkUCh1QoP4hEtsO_gQU6hM7pEa7WZoeMyEKkB2I5C3Xa9m-GcQqkNAjuCq12DwCATssEUhUJztQMKCp2om2XtMAbDWAzFWNRqAAq3uukfW8vIXPBOzM8PkE8UdO-eFawTFQLzJvo2F97WhZCBkIUsxKkL-T8u_FddPIv3rTYKDaqNcD4z_zXyQpR7NBVydEl35W-TZGOHbPvVQKHBH-4i8N5ffjR19XN9AoWkd4wE3qvBrs85b4q2063F04Avbt7NqVBVuF7J6t6U-GB0ucisZbLwFkChdWvXX4uoXVrL5f8ke2eQvVOy_1fy9Ya8m_Lp3e8AAAD___LYInw=

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT b, a FROM ab INTERSECT ALL SELECT y AS b, x AS a FROM xy ORDER BY b
----
distribution: local
vectorized: true
·
• intersect all
│ columns: (b, a)
│ ordering: +b
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (b, a)
│     ordering: +b,+a
│     estimated row count: 1,000 (missing stats)
│     table: ab@ab_b_a_idx
│     spans: FULL SCAN
│
└── • scan
      columns: (y, x)
      ordering: +y,+x
      estimated row count: 1,000 (missing stats)
      table: xy@xy_y_x_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJycUmFrnEAU_N5fsbxPCXklp_m2UPCSWBDMmaqUliKy3r5eBePa3RWU4_57cW179ci1XD_JzM7sm3nuHsz3BjiEn57jdbRhV49RlmcfYmQfw_Q-ycJrloVx-JCzCplg79PkiYmKRZs8TLOJXsfxL8XI1tkkG6bvT-0wsiR9DFN2_5lVgNAqSRvxQgb4F_CgQOi02pIxSk_U3gkiOQBfIdRt19uJLhC2ShPwPdjaNgQcclE1lJKQpG9XgCDJirpx1w5jMIzlWA5lLQdAeFBN_9IazgZkIyBknZjQW0BIestZ4GPgQXFAUL09TjRW7Ai4d8D_S-UtU4kqEFVZleI0lUC3mctS-WdTHcP0rdKSNMlFkGJy_kvySrUn0jvKyCbdrb9slo8d8eWTAISGvtqrwLvBwL-5fqfr3bcj_N3Rw8A_2_Huks2nZDrVGjrt-urNq6kgyR3NCzOq11t61mrrxswwcT5HSDJ2PvVnELXuyP2EP83eBWbv1Oz_1Xy3MK8OxeHNjwAAAP__2Vku5w==

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT b, a FROM ab EXCEPT SELECT y AS b, x AS a FROM xy ORDER BY b
----
distribution: local
vectorized: true
·
• except
│ columns: (b, a)
│ ordering: +b
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (b, a)
│     ordering: +b,+a
│     estimated row count: 1,000 (missing stats)
│     table: ab@ab_b_a_idx
│     spans: FULL SCAN
│
└── • scan
      columns: (y, x)
      ordering: +y,+x
      estimated row count: 1,000 (missing stats)
      table: xy@xy_y_x_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJykklGLm0AQx9_7KZZ5uuO2JJrcy0LBXGIhkDtTlXKliKw6TQXPtbsrKCHfvaz2mip3ltw9hZnZ3_5_s_EI6lcBDNzH_W61fSBXm20QBl92lHx1_TsvcK9J4O7cdUgSSjj57Hv3hCfEfVy7-_B51JJVYOaN-f1zqGmJ529cn9x9IwlQKEWGD_wJFbDvYEFEoZIiRaWENK1jd2CbNcDmFPKyqrVpRxRSIRHYEXSuCwQGIU8K9JFnKGdzoJCh5nnRXcsThydxEvM4zxqgsBZF_VQqRjjtHIKKm-ojUPBqzYhjU8eC6ERB1PqcqDQ_IDDrRN9mZQ2tmtZp2riNm7FVQ0l7sZV9idUmVzovUz2zh0qORR3T8mSGEjNG-sZrmYs3ZS7elbl8NfMcVZeiv2yQFBnyf0deEL9HecAAtVfNlkP1sK2QPX_zq90OKBT4Q1851g117JvrTzI__DyXf__IyQVvL3lUH1UlSoXjRV-8eW62w-yA_WspUcsU91KkXUxfeh3XNTJUup_afbEt-5ER_Be2JuHFNGxPwssBbI3hxQWwPYaXk_DtSDs6ffgdAAD__76dndQ=

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a, b FROM ab EXCEPT ALL SELECT x AS a, y AS b FROM xy ORDER BY b, a
----
distribution: local
vectorized: true
·
• except all
│ columns: (a, b)
│ ordering: +b,+a
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (a, b)
│     ordering: +b,+a
│     estimated row count: 1,000 (missing stats)
│     table: ab@ab_b_a_idx
│     spans: FULL SCAN
│
└── • scan
      columns: (x, y)
      ordering: +y,+x
      estimated row count: 1,000 (missing stats)
      table: xy@xy_y_x_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJycUmFrnEAQ_d5fMcynhEzJab4tFLxcLByYeFUpKUVkvZ1eBePa3RWU4_570Wu5eCRt00_yZt7b9966e7Q_ahQYPm6i5foBLu7WaZZ-igg-h8ltnIaXkIZRuMpAEpTwMYnvQZYQPq7CTQbLKPq97mGZjpxh_P4i9gPEyV2YwO0XKAkkEjZa8YN8YoviK3qYE7ZGb9labcbRfiKsVY9iQVg1befGcU641YZR7NFVrmYUmMmy5oSlYnO9QELFTlb1dKwsA1kWZSGLSvVIuNJ199RYMVVAwrSVI3qP-YFQd-5kYp3cMQrvQP8XxJsH6YegH4qh6M-D9ATDvwTxXw1y8u8abRQbVjPvfFT-jfJCm3s2O07Zxe21Py-TDS2LZz8eCWv-5i4C_4oC7-ryg6l2308QCePOCQg8CvxXC9685aYTtq1uLJ8XffHkxdiO1Y6Pt2V1Z7a8MXo72RxhPOmmgWLrjlv_CNbNtJqewnOx9waxfy72_yi-mYkXh_zw7mcAAAD__266J6I=

statement ok
CREATE TABLE abcde (a INT PRIMARY KEY, b INT, c INT, d INT, e INT, INDEX (b, c, d, e))

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT * FROM (SELECT a, b, c, d, e FROM abcde UNION SELECT a, c, b, d, e FROM abcde) WHERE c = 1 AND d = e ORDER BY a
----
distribution: local
vectorized: true
·
• union
│ columns: (a, b, c, d, e)
│ ordering: +a
│ estimated row count: 0 (missing stats)
│
├── • filter
│   │ columns: (a, b, c, d, e)
│   │ ordering: +a
│   │ estimated row count: 0 (missing stats)
│   │ filter: (c = 1) AND (d = e)
│   │
│   └── • scan
│         columns: (a, b, c, d, e)
│         ordering: +a
│         estimated row count: 1,000 (missing stats)
│         table: abcde@abcde_pkey
│         spans: FULL SCAN
│
└── • sort
    │ columns: (a, c, b, d, e)
    │ ordering: +a
    │ estimated row count: 0 (missing stats)
    │ order: +a
    │
    └── • filter
        │ columns: (a, b, c, d, e)
        │ estimated row count: 0 (missing stats)
        │ filter: d = e
        │
        └── • scan
              columns: (a, b, c, d, e)
              estimated row count: 10 (missing stats)
              table: abcde@abcde_b_c_d_e_idx
              spans: /1-/2
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJykkltr20wQhu-_XzHMlf15gqJTKAuBTWKFClIpldwTxRhZOwSBIrmrNaQE__ciKeDYtdW4vRHM4Z3n1cw-Y_OjRIHB1_u7qzCC0TRMZ-nHO4LPQXIdp8EY0uAuuJnB_3CbxB9g9BJmBEuCnEARcF_Klrli-BSFcQTbrrxr3Osaw5f3QRLAKIdLsMdwFU1hpOASeAxxMg0SuP4GGRJWteIoe-QGxXe0cU640nXOTVPrNvXcNYTqCcU5YVGt1qZNzwnzWjOKZzSFKRkFzrJlyQlnirV1joSKTVaU3djOkey-i-UiX6gFLwr1hIQ3dbl-rBqx-7dImK6yNm3ZZ5aD8w1hvTZbdmOyB0Zhb-jt_m6L0rBmbdm75vq8AOnBJUj_KMw5BZbW2rC2nF2UtCdIGK-NAGmTdEk6JD0agLqnQF9fwD10gZUuHjP98w17PzvqyPurnXuHdz6Sbvs8hRBhNHv38kpfDjE-asE_amFLrrVizeq3_ZN0JiTdCUlvQtKf4HxzwPe0aExR5cby9wd0J3P_cLWLU3aUcLOqq4Z3SMcmn7duWT1w_7dNvdY53-s67zB9GHe6LqG4MX3V7oOw6kutwddie1DsDIudQbG_I7b3xe6g2Bsme_9C9gfFF3vk-ea_XwEAAP__pRHQSA==

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT * FROM (SELECT a, b, c, d, e FROM abcde UNION SELECT  a, c, b, d, e FROM abcde) WHERE c = 1 AND d = e ORDER BY b, c, d, e, a
----
distribution: local
vectorized: true
·
• union
│ columns: (a, b, c, d, e)
│ ordering: +b,+c,+d,+a
│ estimated row count: 0 (missing stats)
│
├── • filter
│   │ columns: (a, b, c, d, e)
│   │ ordering: +b,+d,+a
│   │ estimated row count: 0 (missing stats)
│   │ filter: (c = 1) AND (d = e)
│   │
│   └── • scan
│         columns: (a, b, c, d, e)
│         ordering: +b,+c,+d,+e,+a
│         estimated row count: 1,000 (missing stats)
│         table: abcde@abcde_b_c_d_e_idx
│         spans: FULL SCAN
│
└── • filter
    │ columns: (a, c, b, d, e)
    │ ordering: +c,+d,+a
    │ estimated row count: 0 (missing stats)
    │ filter: d = e
    │
    └── • scan
          columns: (a, b, c, d, e)
          ordering: +c,+d,+e,+a
          estimated row count: 10 (missing stats)
          table: abcde@abcde_b_c_d_e_idx
          spans: /1-/2
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyskl1r20wQhe_fXzHMlf16gr2SDGXBsEmsUIErpbL7RTFG1g5BoEiudg0B4_9eJBn8QeQ2bW8EOzNnzqOzu0PzI0eJ_tfH2W0QQm8azBfzjzOCz358F839Psz9mX-_gP_hIY4-QO9wTAjWBCmBJuC2laxTzfApDKIQjlNpM3gx1Ycv7_3Yh14KExB9uA2n0NMwAe5DFE_9GO6-newnSJCwKDWHyTMblN9R4JJwU5UpG1NWdWnXDAT6BeWIMCs2W1uXl4RpWTHKHdrM5owSF8k655gTzdVwhISabZLlzdqGTjXf1XqVrvSKV5l-QcL7Mt8-F0ae_zkSzjdJXR6Km6GDyz1hubVHb2OTJ0Yp9vT7fA9ZbrniaijO4dq6BOXBBNQYCaOtlaAEKZeUQ8ojNe5EcN6CcBqR868iuulkc_8oHvf1eHrKrV-VlDIIF-8Oj-uQWb8TwetEODqXleaK9bmtcgak3AEpb0BKDEiNB7jcv8I9zYzNitQOvYsFork89xf3N35LRjGbTVkYPnPq2jyqaVk_cfu3ptxWKT9WZdrYtMeo0TUFzca2XdEegqJt1YCnYnFV7J2JxaXYuSp2rzu7f-PsXRWPL5yX-_9-BgAA__8eXKOT

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT * FROM (SELECT * FROM abcde UNION ALL SELECT * FROM abcde) WHERE c = 1 AND d = e ORDER BY a
----
distribution: local
vectorized: true
·
• union all
│ columns: (a, b, c, d, e)
│ ordering: +a
│ estimated row count: 0 (missing stats)
│
├── • filter
│   │ columns: (a, b, c, d, e)
│   │ ordering: +a
│   │ estimated row count: 0 (missing stats)
│   │ filter: (c = 1) AND (d = e)
│   │
│   └── • scan
│         columns: (a, b, c, d, e)
│         ordering: +a
│         estimated row count: 1,000 (missing stats)
│         table: abcde@abcde_pkey
│         spans: FULL SCAN
│
└── • filter
    │ columns: (a, b, c, d, e)
    │ ordering: +a
    │ estimated row count: 0 (missing stats)
    │ filter: (c = 1) AND (d = e)
    │
    └── • scan
          columns: (a, b, c, d, e)
          ordering: +a
          estimated row count: 1,000 (missing stats)
          table: abcde@abcde_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0kN1q20AQhe_7FMNcSe0GW5YCZcEgJ1aoQJVSyf2j6GKtHYJA1qq7a2gxfvciqZAoxCbpz-Wc2TPn23NA871BjtGX22QVp-Cs42JTfEgYfIryq6yIXCiiJLrewGu4ybP34ExHsa0kwcc0zlJYJQk8sXXh87soj8CpYAmeC6t0DY6EJZALWb6Ocrj6CgIZtkpSKnZkkH9DD0uGnVYVGaN0Lx2GB7H8gXzOsG67ve3lkmGlNCE_oK1tQ8hxI7YN5SQk6dkcGUqyom6GswNR2Ol6J_RPZHitmv2uNRwEgy2DioFkQMiw6EQvX2B5ZKj29j7NWHFHyL0jez7RTd1Y0qRn3hRn1Dk4od-XwzmP083b3x2FASwhvHRPIixegvCwlMX_KsX_o1L8f1lKcBLhPllpSZrkNDb03mB5fIIzVReqmwWT16fS5y8pICfTqdbQMy-XDEne0fgVo_a6olutqiFmHLPBNwiSjB233jjE7bjqAR-avbPmYGL2HpsXZ83--WT_b5KDs-bLR8nl8dWvAAAA___vr4vM

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT * FROM (SELECT * FROM abcde UNION ALL SELECT * FROM abcde) WHERE c = 1 AND d = e ORDER BY b, c, d, e, a
----
distribution: local
vectorized: true
·
• union all
│ columns: (a, b, c, d, e)
│ ordering: +b,+c,+d,+a
│ estimated row count: 0 (missing stats)
│
├── • filter
│   │ columns: (a, b, c, d, e)
│   │ ordering: +b,+d,+a
│   │ estimated row count: 0 (missing stats)
│   │ filter: (c = 1) AND (d = e)
│   │
│   └── • scan
│         columns: (a, b, c, d, e)
│         ordering: +b,+c,+d,+e,+a
│         estimated row count: 1,000 (missing stats)
│         table: abcde@abcde_b_c_d_e_idx
│         spans: FULL SCAN
│
└── • filter
    │ columns: (a, b, c, d, e)
    │ ordering: +b,+d,+a
    │ estimated row count: 0 (missing stats)
    │ filter: (c = 1) AND (d = e)
    │
    └── • scan
          columns: (a, b, c, d, e)
          ordering: +b,+c,+d,+e,+a
          estimated row count: 1,000 (missing stats)
          table: abcde@abcde_b_c_d_e_idx
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0kG9rm1AUxt_vUxzOq2Q5JTFaGBcCpo1lQqadZv8YIsZ7KIL1unsNFEK--1AHjaUJ7ba-Ec5zfM7zu88eza8SBXrfb9dLP4DRyo838ec1wVcvugpjbwyxt_auN_AebqLwE4yGY7bNJcOXwA8DWK7X8Mx2DN8-epEHoxwWYI1hGaxgJGEBPIYwWnkRXP2ALUFOIAmYIEPCSkkOsns2KH6ihQlhrVXOxijdSvvuB18-oJgRFlW9a1o5IcyVZhR7bIqmZBS4ybYlR5xJ1tMZEkpusqLsznZ0bvdNt2meypTTQj4g4bUqd_eVEZDRERkSxnXWyheYHAjVrnnMNU12xyisA72c7aYoG9asp9YQrNcFjFy7rUwI4QebD3-acx1YgHs5Pokwfw3CcT3zt6_H_qt67P9Zj3MS4TFZacma5TDWnU_ItSfkOhNyrQkmh2eYA3Wh6qkzcJ4imb2mjIhNrSrDL7ycELK84_5ZRu10zrda5V1MP4adrxMkm6bfWv3gV_2qBTw2W2fNzsBsPTXPz5rt88n2vyQ7Z82XT5KTw7vfAQAA__-r-Zga

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT b, c, d, e FROM (SELECT b, c, d, e FROM abcde INTERSECT SELECT b, c, d, e FROM abcde) WHERE c = 1 AND d = e ORDER BY b
----
distribution: local
vectorized: true
·
• intersect
│ columns: (b, c, d, e)
│ ordering: +b
│ estimated row count: 0 (missing stats)
│
├── • filter
│   │ columns: (b, c, d, e)
│   │ ordering: +b,+d
│   │ estimated row count: 0 (missing stats)
│   │ filter: (c = 1) AND (d = e)
│   │
│   └── • scan
│         columns: (b, c, d, e)
│         ordering: +b,+c,+d
│         estimated row count: 1,000 (missing stats)
│         table: abcde@abcde_b_c_d_e_idx
│         spans: FULL SCAN
│
└── • filter
    │ columns: (b, c, d, e)
    │ ordering: +b,+d
    │ estimated row count: 0 (missing stats)
    │ filter: (c = 1) AND (d = e)
    │
    └── • scan
          columns: (b, c, d, e)
          ordering: +b,+c,+d
          estimated row count: 1,000 (missing stats)
          table: abcde@abcde_b_c_d_e_idx
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0lF1r20wQhe_fXzHMlYT3xdGHnbJg2CRWqMCxUkn0g2KMrJ26AkVSVytICfnvRVJLbDdW65DeCPbMPnvOnAs9YP0tR47ex9vFhb8EY-5HcfRuweC9F14GkWdC5C28qxg2DFIGkgHBdRjcgHFETzapJPCXsRdG7Xzomgkf3nqhB0YKM7BMuFjOwZAwAzIhCOdeCJefYIMMi1LSMrmjGvlntHDFsFJlSnVdqlZ66C748h75GcOsqBrdyiuGaakI-QPqTOeEHONkk1NIiSQ1PkOGknSS5d2zXSLRfdebdbqWa1pn8h4ZXpV5c1fUfGcJZBhVSav9j6tHhmWjn0xrnWwJufXI_j7YdZZrUqTG1n6qXudgCLvtiHPuL-M3P6sSDsxAuObRCPYpEXa7sf9xN86LunFesxv3lAjzrNZZkeqxux9BWEzYTDhMtINASVIkObSyc9R58iLnySs4T486Pxk2Rdk_tue3ask_XXkm_g2pLUWkg2o83V8g_l4R3_lRXCwWyDCnL9oQ1ogJZ8SEPWLCHZkzlW2__i63eze63_lXFcc2Pz-l85DqqixqOmzg2ZfP2rVJbqmvsS4bldKtKtPOpj8GHdcJkmrdT63-4Bf9qA24C1uD8GQYtgdhZxh2BmF3GHYH4ekebB3CkxNg-xCeDsLnB7FXj__9CAAA__-QiTB0

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT b, c, d, e FROM (SELECT b, c, d, e FROM abcde EXCEPT SELECT b, c, d, e FROM abcde) WHERE c = 1 AND d = e ORDER BY b, c, d, e
----
distribution: local
vectorized: true
·
• except
│ columns: (b, c, d, e)
│ ordering: +b,+d
│ estimated row count: 0 (missing stats)
│
├── • filter
│   │ columns: (b, c, d, e)
│   │ ordering: +b,+d
│   │ estimated row count: 0 (missing stats)
│   │ filter: (c = 1) AND (d = e)
│   │
│   └── • scan
│         columns: (b, c, d, e)
│         ordering: +b,+c,+d
│         estimated row count: 1,000 (missing stats)
│         table: abcde@abcde_b_c_d_e_idx
│         spans: FULL SCAN
│
└── • filter
    │ columns: (b, c, d, e)
    │ ordering: +b,+d
    │ estimated row count: 0 (missing stats)
    │ filter: (c = 1) AND (d = e)
    │
    └── • scan
          columns: (b, c, d, e)
          ordering: +b,+c,+d
          estimated row count: 1,000 (missing stats)
          table: abcde@abcde_b_c_d_e_idx
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0lN9q20wQxe-_pxjmysL74eiPnbJg2CRWqMGxUkm0KcUYWTt1BYqkrlaQEvLuRVJDIjdS65DeCPbs_uacORe6x_J7ihzdm-vV2XINo8UyCIMPKwYfXf_cC1wDAnflXoSwYxAzkAwILn3vCkY9erSLJYF7c-Feh31s88aAT-9d34VRDHMwDThbL2AkYQ5kgOcvXB_OPz8jkWGWS1pHt1Qi_4ImbhgWKo-pLHNVS_fNg6W8Q37CMMmKStfyhmGcK0J-jzrRKSHHMNql5FMkSU1OkKEkHSVpM7aJJprvdreNt3JL20TeIcOLPK1us5J3MwVFVGv_4-aBYV7pJ9NSR3tCbj6wvw92maSaFKmJ2U3V6hxGwqrL4pwv1-G7X50JG-YgHKM3gnVMhOfdWP-4G_tV3dhv2Y1zTIRFUuoki_XE6UYQJhMWEzYT9YWnJCmSHGrZ7nWevsp5-gbOs17nJ8Mqy9thHb9NTf7pyQvxr0jtKSDtFZNZd4HwR0H88Xdxtlohw5S-6pEwx0zYYyasMRPO2JirZP_td7leutLtwo899K19ekzhPpVFnpV0uP6Lk0_qnUnuqe2wzCsV07XK48amPXoN1wiSSt3emu1hmbVXdcDnsDkIO8OwNQjbw7A9CE-HYWcQnnVg8xCeHgFbh_BsED49iL15-O9nAAAA__924zC0

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT * FROM (SELECT * FROM abcde EXCEPT ALL SELECT * FROM abcde) WHERE c = 1 AND d = e ORDER BY a
----
distribution: local
vectorized: true
·
• except all
│ columns: (a, b, c, d, e)
│ ordering: +a
│ estimated row count: 0 (missing stats)
│
├── • filter
│   │ columns: (a, b, c, d, e)
│   │ ordering: +a
│   │ estimated row count: 0 (missing stats)
│   │ filter: (c = 1) AND (d = e)
│   │
│   └── • scan
│         columns: (a, b, c, d, e)
│         ordering: +a
│         estimated row count: 1,000 (missing stats)
│         table: abcde@abcde_pkey
│         spans: FULL SCAN
│
└── • filter
    │ columns: (a, b, c, d, e)
    │ ordering: +a
    │ estimated row count: 0 (missing stats)
    │ filter: (c = 1) AND (d = e)
    │
    └── • scan
          columns: (a, b, c, d, e)
          ordering: +a
          estimated row count: 1,000 (missing stats)
          table: abcde@abcde_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0k9-L2k4Uxd-_f8XlPiVfb9nND6EMCONqlgqusUlotxQfYnJrAzFJJxPoIv7vJUlhVdTW0j7OuXPmnPsJ2WH9LUeB3vNyPp4twJjOwih8Pyf44AUPfuiZEHpzbxLB__AY-E9gHB_jdZIyeM8TbxnBeD6HM2MTPr7zAg-MBEZgmTBeTMFIYQRsgh9MvQAePkGMhEWZ8iLeco3iM1q4IqxUmXBdl6qVdt2FWfodxT1hVlSNbuUVYVIqRrFDnemcUWAUr3MOOE5Z3d0jYco6zvLu2a6RrFS2jdULEk7KvNkWtYCYYE2QEKQEjIRhFbfyG1ztCctGv6bVOt4wCmtPv9_oMcs1K1Z31nGdXhdgSKeFI4SYLaK3PxlJF0Ygh-bFCvYtFQ6h2P8KivNHUJy_CcW9WOE1uSlKlbLi9Ch41Tp_deXMHk-sNhyy9qs793iT6KVicfB7IGHOX7QhrQFJe0DSGZB0BySHA3Okss3X8yMk9BstQFokbZIOSZfk8CKB4S0fIeC6KouaT0mcffm-XZ_TDfc467JRCS9VmXQx_dHvfJ2Qcq37qdUfZkU_agsemq2rZvfIbJ2a7atm53qyc0OyfWp2r5qHJ8mr_X8_AgAA__-W-7DW

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT * FROM (SELECT * FROM abcde INTERSECT ALL SELECT * FROM abcde) WHERE c = 1 AND d = e ORDER BY b, c, d, e, a
----
distribution: local
vectorized: true
·
• intersect all
│ columns: (a, b, c, d, e)
│ ordering: +b,+d,+a
│ estimated row count: 0 (missing stats)
│
├── • filter
│   │ columns: (a, b, c, d, e)
│   │ ordering: +b,+d,+a
│   │ estimated row count: 0 (missing stats)
│   │ filter: (c = 1) AND (d = e)
│   │
│   └── • scan
│         columns: (a, b, c, d, e)
│         ordering: +b,+c,+d,+e,+a
│         estimated row count: 1,000 (missing stats)
│         table: abcde@abcde_b_c_d_e_idx
│         spans: FULL SCAN
│
└── • filter
    │ columns: (a, b, c, d, e)
    │ ordering: +b,+d,+a
    │ estimated row count: 0 (missing stats)
    │ filter: (c = 1) AND (d = e)
    │
    └── • scan
          columns: (a, b, c, d, e)
          ordering: +b,+c,+d,+e,+a
          estimated row count: 1,000 (missing stats)
          table: abcde@abcde_b_c_d_e_idx
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0k92Lm0AUxd_7V1zukza37PoRKAOB2Q-XCtm4VekHJQTj3KaCq3ZU2LLkfy9qYWNI0qa0L4E59545Z37BZ6y_5yjQ-_Qwv_IXYNz6URy9nxN88MLrIPJMiLy5dxPDa7gLg3swxsdknSoGfxF7YdTJV_M5HNgw4eM7L_TASGEGlglXi1swFMyATQjCWy-E68-wJkgJFAETJEhYlIoXySPXKL6ghUvCSpcp13WpO-m5X_DVE4pLwqyo2qaTl4RpqRnFMzZZkzMKjJN1ziEnivXFJRIqbpIs76_t28n-d7VepSu14lWmnpDwpszbx6IWkNBOMySMqqST3-ByS1i2zUtu3SQbRmFt6c-73WV5w5r1hTUuNugCDOl0yIQQ_iJ--4ucdGEGcmoerWCfU2EXj_3_8Th_hcf5l3jcoxVektui1Io1q1HwsnP-buXAO-5ZbzjiJqgu3PFL4h8Vi_EXhIQ5f20MaU9IuhOS1oSkMyE5nZgznW2-HR4hYdA2AqRF0ibpkHRJTo9CmJ7zP4RcV2VR8z6MgzdfdgRYbXggWpetTvlBl2kfMxyD3tcLiutmmFrDwS-GUVdw12ydNLsjs71vtk-andPJzhnJ1r7ZPWme7iUvt69-BgAA__-XnbyW

# Regression test for #64181. Ensure that a projection on top of an ordered
# UNION ALL correctly projects away ordering columns.
query T
EXPLAIN (DISTSQL,VERBOSE) WITH q (x, y) AS (
  SELECT * FROM (VALUES ('a', 'a'), ('b', 'b'), ('c', 'c'))
  UNION ALL
  SELECT * FROM (VALUES ('d', 'd'))
)
SELECT 'e', y FROM q
ORDER BY x
----
distribution: local
vectorized: true
·
• project
│ columns: ("?column?", y)
│
└── • render
    │ columns: ("?column?", x, y)
    │ ordering: +x
    │ estimated row count: 4
    │ render ?column?: 'e'
    │ render x: column1
    │ render y: column2
    │
    └── • union all
        │ columns: (column1, column2)
        │ ordering: +column1
        │ estimated row count: 4
        │
        ├── • sort
        │   │ columns: (column1, column2)
        │   │ ordering: +column1
        │   │ estimated row count: 3
        │   │ order: +column1
        │   │
        │   └── • values
        │         columns: (column1, column2)
        │         size: 2 columns, 3 rows
        │         row 0, expr 0: 'a'
        │         row 0, expr 1: 'a'
        │         row 1, expr 0: 'b'
        │         row 1, expr 1: 'b'
        │         row 2, expr 0: 'c'
        │         row 2, expr 1: 'c'
        │
        └── • values
              columns: (column1, column2)
              size: 2 columns, 1 row
              row 0, expr 0: 'd'
              row 0, expr 1: 'd'
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJykkUFv1DAQhe_8itFcHIPRJllOPnVLA0QKSYm3BYT2kMajaqUQZ20HbbXa_46SCJWtmqqF23j8vvfGngO6XYMSk2-X2SrNIbhI1Vp9yQRcJ-V5oRIOX9P1J9hBsBdwx2GlIFBJlrxfw2v4UBafIbheZVeJgoBVTACrGBcQsJuhvpnqeqhrxjlc5WmRwyrLYM5DD1rNOOd_JIyYgLtJt4OivEhKOP8OexTYGk159ZMcyh8Y4UZgZ01Nzhk7tA6jINV7lKHAbdv1fmhvBNbGEsoD-q1vCCU2pq4a-FU1PTkIFyEK1OSrbTPqjwJN7-9p56tbQhkdxT8mRIvoWQnxSxKUsZ7sIj5xxrPoDc7ZL2ft712N1WRJP2b6yAy5eWu6xfJUXVKrycphkVJKtS7T_KOAs3h2rvAlzy7JdaZ19KwPDYehSd_S9EhnelvTpTX1GDMdi5EbG5qcn26X0yFtx6tx83_D0ZNwfAKHD-H4f5KXT8LvHiRvjq9-BwAA__9bjjq0

# Regression tests for #64062. Use a streaming set operation even though the
# ordering is not required.
query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a, b, c FROM abcde UNION SELECT b, c, d FROM abcde
----
distribution: local
vectorized: true
·
• union
│ columns: (a, b, c)
│ estimated row count: 2,000 (missing stats)
│
├── • scan
│     columns: (a, b, c)
│     ordering: +a
│     estimated row count: 1,000 (missing stats)
│     table: abcde@abcde_pkey
│     spans: FULL SCAN
│
└── • scan
      columns: (b, c, d)
      ordering: +b,+c,+d
      estimated row count: 1,000 (missing stats)
      table: abcde@abcde_b_c_d_e_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJykkV-rm0AQxd_7KZZ5asmU6583n2xvLAipppqWQhFZd4cgGNfurpAS_O7FtSFJSUrb-yLMOZ45P8cTmO8dRJB83W7epRl7vU7LXflpg-xLUrzPy-QNK5NN8rxjHFmDTLAPRf6R8UZIYp-zNM_O_mwik1c-IPRKUsYPZCD6Bj5UCINWgoxRepZO7oVUHiHyENp-GO0sVwhCaYLoBLa1HUEEO950VBCXpJ88QJBkedu5ta4rds-6qUUta6pbeQSEZ9WNh95EZzZAKAc-C2-hmhDUaC-NxvI9QeRP-H9U_j2qQbcHrn9cs_y649-wBA9ZLghKS9Ikb8tjf4VxsMI4XEE13QFft8a2vbBPwe9BjAOMw4dI4b-cpyAzqN7QTcejzd7MSXJPy_cZNWpBW62Eq1nG3OWcIMnYxQ2WIe2d5f7fddh_STj4Yzi8CXtTNb36GQAA__-F4Q-C

# Use a streaming set operation even though the ordering is not required.
query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a, b, c FROM abcde INTERSECT SELECT b, c, d FROM abcde
----
distribution: local
vectorized: true
·
• intersect all
│ columns: (a, b, c)
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (a, b, c)
│     ordering: +a
│     estimated row count: 1,000 (missing stats)
│     table: abcde@abcde_pkey
│     spans: FULL SCAN
│
└── • scan
      columns: (b, c, d)
      ordering: +b,+c,+d
      estimated row count: 1,000 (missing stats)
      table: abcde@abcde_b_c_d_e_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJycUWFrnEAU_N5fsbxPCfdKTu_bQsE0tSCYM1UphSKy575awXPt7goJh_-9uKZEw6Vt8mVh583szLw9gfnVAofw2118He3Zxacoy7MvMbKvYfoxycJLloVxeJMzgeyArGKf0-SWiUMliUX7PEyzafjImQjI5IIDCJ2StBdHMsC_gwcFQq9VRcYoPUEnR4jkPfAtQtP1g53gAqFSmoCfwDa2JeCQi0NLKQlJ-moLCJKsaFr3rPMK3FkeyqqUJZWNvAeEG9UOx87wP9kAIevFBLyHYkRQg31yNFbUBNwb8W2pvHOpet0chX5YZnnc5f9k8V_M8hRh6JSWpEmu7ItJ-S_KmUK3pGvKyCb9lb_ukz_0xBe_fh3HgNDSD3sReBsM_A0Gu83lB93UP9cQICSD5SzwMPAx2L1Yd_ea1adketUZel777MvbqSvJmubdGTXoiu60qpzNfE2czgGSjJ2n_nyJOjdy_7EUe68Qe8_F_l_Fu5V4Oxbju98BAAD___BfLOo=

# Use a streaming set operation even though the ordering is not required.
query T
EXPLAIN (DISTSQL,VERBOSE) SELECT b, c, d FROM abcde INTERSECT ALL SELECT b, c, d FROM abcde
----
distribution: local
vectorized: true
·
• intersect all
│ columns: (b, c, d)
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (b, c, d)
│     ordering: +b,+c,+d
│     estimated row count: 1,000 (missing stats)
│     table: abcde@abcde_b_c_d_e_idx
│     spans: FULL SCAN
│
└── • scan
      columns: (b, c, d)
      ordering: +b,+c,+d
      estimated row count: 1,000 (missing stats)
      table: abcde@abcde_b_c_d_e_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0km-LnDAQxt_3U4R5dcdOOf-8CxS8Xi0I3npVKYUiomZqBc_YJMKVxe9ejJSty27LFu6NkGfml3keJwfQP3rgEH55iu-jPbv5EGV59ilG9jlM3ydZeMuyMA4fclYja5AJ9jFNHllVN4JYtM_DNFuK93F8uQ8QBiloXz2TBv4VXCgQRiUb0lqqRTrYhki8AHcQumGczCIXCI1UBPwApjM9AYe8qntKqRKk7hxAEGSqrrfX2lmB_ZZ12ZSipLITL4DwIPvpedD8tzdAyMZqEd5CMSPIyRwnalO1BNyd8f9cua_pyrvo6mhmGqQSpEhsjBQL-a-WM9EeSbWUkUnGO2-bLP85Et--AUDo6Zu5CdwdBt4OA393-0517fetBAjJZDgLXAw8DPyLcf1rlpCSHuWg6TT22ZudJSuJltZ_p-WkGnpSsrFj1mNiOSsI0mateushGmzJ7uNP2L0Cdk9h76-wv4GduZjf_AoAAP__XLgxgg==

# Use a streaming set operation even though the ordering is not required.
query T
EXPLAIN (DISTSQL,VERBOSE) SELECT b, c, d FROM abcde EXCEPT SELECT a, d, e FROM abcde
----
distribution: local
vectorized: true
·
• except
│ columns: (b, c, d)
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (b, c, d)
│     ordering: +b,+c,+d
│     estimated row count: 1,000 (missing stats)
│     table: abcde@abcde_b_c_d_e_idx
│     spans: FULL SCAN
│
└── • scan
      columns: (a, d, e)
      ordering: +a
      estimated row count: 1,000 (missing stats)
      table: abcde@abcde_pkey
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJycklFr2zAQx9_3KcQ9teRGYjt9EQzcpR4E0jqLzSgMYxTrlhkcy5NkaAn57sP2ssYhSZO-GHS6n_6_O7wB86cADsHzfHY_fWI3D9Mojr7PkP0IFl_DKLhlUTALJjFbIsuQSfZtET4yscwkseB5EszjXYNAJpHRXgMglErSk1iTAf4THEgQKq0yMkbpprRpG6byBfgIIS-r2jblBCFTmoBvwOa2IOAQi2VBCxKS9HAECJKsyIv22TbLb7_pMs1SmVKayxdAmKiiXpeG7-QBIapEU_gMyRZB1fYt0VixIuDOFj9m5RyzqnS-Fvp13-Xfni5xca9xeciNzcvMDt2-iO-g76LvAUKoJWmSnP2vnUr2PpTsXZJ8MnN8MvMtqi5V91IvKWnI91qOiD-SXlFENqyG4756_FoR3_3g97MZIBT0y974zgB9d4C-N7j9ovPV736pmbS2F-z37pr9LshUqjR0OPPRl0fNoCRX1C3OqFpnNNcqa2O6Y9hybUGSsd2t2x2mZXfVCO7DzlnYOw-7Z-FxD3YOYe8K2D2Ex2fhuwPtZPvpbwAAAP__SaeeFw==

# Use a streaming set operation even though the ordering is not required.
query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a, b, c FROM abcde EXCEPT ALL SELECT b, c, d FROM abcde
----
distribution: local
vectorized: true
·
• except all
│ columns: (a, b, c)
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (a, b, c)
│     ordering: +a
│     estimated row count: 1,000 (missing stats)
│     table: abcde@abcde_pkey
│     spans: FULL SCAN
│
└── • scan
      columns: (b, c, d)
      ordering: +b,+c,+d
      estimated row count: 1,000 (missing stats)
      table: abcde@abcde_b_c_d_e_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJycklGLnDAUhd_7K8J92mVu2dF5CxTcTi0MuOt0lLJQRKK5tYJjbBJhl8H_XoxdVpfZttMXISfn5H4n8QTmZwMcwod9dLu7Z1efdkmafImQfQ0PH-MkvGZJGIXblAlkBbKSfT7Ed0wUpSQWPmzDfcpuo-jZNDqQyZkJEFol6V4cyQD_Bh5kCJ1WJRmj9CidnGEnH4GvEeq26-0oZwil0gT8BLa2DQGHVBQNHUhI0jdrQJBkRd24Y92soNP1UegnQNiqpj-2hj9jA0LSiVF4D9mAoHr7MsdYURFwb8D_Y_HOsbhvXuRlLnPKa_k4p_p9T_9C5b9J9QLTt0pL0iQXINmY_JvlTLU70hUlZOPuxl82S5864rNnB4SGvturwFth4K8w2KyuP-i6-rGUACHuLWeBh4GPwebNrptLXuBAplOtodedz568HouSrGi6OKN6XdJeq9KNmZaxyzlBkrHTrj8tdq3bcr_IPOxdEPZfh_0_hjeL8HrIhne_AgAA__-TtywT

# Do not use a streaming set operation for UNION ALL.
query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a, b, c FROM abcde UNION ALL SELECT b, c, d FROM abcde
----
distribution: local
vectorized: true
·
• union all
│ columns: (a, b, c)
│ estimated row count: 2,000 (missing stats)
│
├── • scan
│     columns: (a, b, c)
│     estimated row count: 1,000 (missing stats)
│     table: abcde@abcde_pkey
│     spans: FULL SCAN
│
└── • scan
      columns: (b, c, d)
      estimated row count: 1,000 (missing stats)
      table: abcde@abcde_pkey
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJykkUFL-0AQxe__T7HM6S9MaRJve7LWCIGY1KSKIDlss0MJpNm4uwGl5LtLNpa2UqXqcd68N_Pb2S2Ylxo4hE-LeBYl7P9NlC_z-xjZY5hdp3l4wfIwDudLJpCtkJXsNkvvmFiVkthDEqUJm8XxzjMYkMkDDyA0SlIiNmSAP4MPBUKrVUnGKD1IW2eI5CtwD6Fq2s4OcoFQKk3At2ArWxNwWIpVTRkJSXrqAYIkK6rajXW7rlpdbYR-A4S5qrtNY_iOCBDyVgzCBIoeQXV2v8dYsSbgfo-_Y_HPZPm44DkswZcsewRDuhI16xqlJWmSRxRFfwI6URPVToNPxtME3k-ukZFpVWPozMkFAsk1jc8xqtMlLbQq3ZqxTF3OCZKMHbvBWESNa7nvOgz7fwkH34Yvj8JeX_T_3gMAAP__FW8KhA==

# Regression test for #69497. Ensure the merge ordering for streaming set ops
# matches the input ordering.
statement ok
DROP TABLE abc;
CREATE TABLE abc (a INT, b INT, c INT, INDEX (a, b, c DESC));
CREATE TABLE def (d INT PRIMARY KEY, e INT, f INT);

query T
EXPLAIN (VERBOSE, DISTSQL) SELECT d, e, f FROM def EXCEPT SELECT a, b, c FROM abc ORDER by d, e
----
distribution: local
vectorized: true
·
• except all
│ columns: (d, e, f)
│ ordering: +d
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (d, e, f)
│     ordering: +d
│     estimated row count: 1,000 (missing stats)
│     table: def@def_pkey
│     spans: FULL SCAN
│
└── • scan
      columns: (a, b, c)
      ordering: +a,+b,-c
      estimated row count: 1,000 (missing stats)
      table: abc@abc_a_b_c_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJycklFr2zAUhd_3K8R9auktjZ03wcBt6kHArTPbjI5hgizdZAbH8iQZWkL--7C80Lq029JHnaOj-51r78H-aoBD_LBKrpf37Ox2mRf51wTZtzi7SfP4nOVxEi8KppARsg37kqV3TNGGxQ-LeFUcbYGsQiZHW1SSpdltnLGb7z4ICK1WdC92ZIH_gABKhM5oSdZqM0h7f2GpHoHPEOq2690glwhSGwK-B1e7hoBDIaqGMhKKzNUMEBQ5UTf-WUWbqDP1TpgnQFjopt-1lh_RASHvxCBcQnlA0L17nmKd2BLw4IAfIwmmJKKSkajkWqyrtVzX6vElz59d_Q9P-C7PM0bfaqPIkJoglEPyX1feKHVHZks5ubS7CqediqeO-PGzXycJIDS0cWdRcIFReIHR_PL8s6m3P6cSIKS94ywKMAoxmr_bdX7K7jOynW4tve785suzoSipLY2Ls7o3klZGSz9mPKY-5wVF1o1uOB6Wrbf8z_EyHJwQDl-Hw7-G55Pw7FAePv0OAAD__y5zKhQ=

# Example where the interesting orderings do not include all columns.
statement ok
CREATE TABLE abcd (a INT, b INT, c INT, d INT, INDEX (a, b, c DESC) STORING (d));
CREATE TABLE efgh (e INT PRIMARY KEY, f INT, g INT, h INT)

query T
EXPLAIN (VERBOSE, DISTSQL) SELECT e, f, g, h FROM efgh EXCEPT SELECT a, b, c, d FROM abcd ORDER by e, f
----
distribution: local
vectorized: true
·
• except all
│ columns: (e, f, g, h)
│ ordering: +e
│ estimated row count: 1,000 (missing stats)
│
├── • scan
│     columns: (e, f, g, h)
│     ordering: +e
│     estimated row count: 1,000 (missing stats)
│     table: efgh@efgh_pkey
│     spans: FULL SCAN
│
└── • sort
    │ columns: (a, b, c, d)
    │ ordering: +a,+b,-c,+d
    │ estimated row count: 1,000 (missing stats)
    │ order: +a,+b,-c,+d
    │ already ordered: +a,+b,-c
    │
    └── • scan
          columns: (a, b, c, d)
          ordering: +a,+b,-c
          estimated row count: 1,000 (missing stats)
          table: abcd@abcd_a_b_c_idx
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJycUl9r2z4Uff99CnGfWnJLYjtPgh-oTT0IpHVmh9ExQlCsG8fgWJ4kQ0vIdx92KIm9plv2ItDRPff8QXuwPwvgEL7MZ_fTZ3bzOE0WydcZsm9h_BAl4S1Lwlk4WTBCtkGWIduyL3H0xGiTbVn4Mgnni_cRiWyNLEWmjiNynSoWxY9hzB6-twsAodSKnuWOLPAf4MESoTI6JWu1aaB9OzBVr8BHCHlZ1a6BlwipNgR8Dy53BQGHhVwXFJNUZIYjQFDkZF60axtvojL5Tpo3QJjoot6Vlp9lAISkkg12B8sDgq7dSck6mRFw74D_5sbrumlqEM2xkqv1Kl3l6vXc1Km1vzHlX2Mq0caRGfpdP8IboPAHKII7FOMBIOykS7esoJKz4KJycFH5JFiX2igypDqKy4b5p5EP7D-RySghF1XDoBth8VYRf_9997MZIBS0cTe9aLf_mzzb_g4DQlQ7zoSHwkcRoBhfjD2-pvCYbKVLS_34H24eNZlJZXTs0OrapDQ3Om1ljteo5bWAIuuOr8HxMi3bp_abnpO9T8l-hzzqk_0rlP0-OfiUPO4pLw___QoAAP__nw9q6g==

# Regression test for #68702. Ensure correct behavior when a column is projected
# twice on the left side.
statement ok
CREATE TABLE t68702 (k INT8 PRIMARY KEY)

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT tableoid AS col1, tableoid AS col2, k AS col3 FROM t68702
EXCEPT ALL SELECT * FROM (VALUES (NULL, 2505326470:::OID, (-1643624263):::INT8))
----
distribution: local
vectorized: true
·
• except all
│ columns: (col1, col2, col3)
│ estimated row count: 1,000 (missing stats)
│
├── • project
│   │ columns: (tableoid, tableoid, k)
│   │ ordering: +k
│   │
│   └── • scan
│         columns: (k, tableoid)
│         ordering: +k
│         estimated row count: 1,000 (missing stats)
│         table: t68702@t68702_pkey
│         spans: FULL SCAN
│
└── • values
      columns: (column1, column2, column3)
      size: 3 columns, 1 row
      row 0, expr 0: 2505326470
      row 0, expr 1: -1643624263
      row 0, expr 2: CAST(NULL AS OID)
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyUUl1vmzAUfd-vsO5TstwqYNK0sjSJLGUSEg1ZoFWlKQ8M7jJUBzPbTKui_PcJ2JYmarZV4gGf63PPB-zAfJMgIHhYRrNwwQY3YZImHyNk98HqfZwEQ5YEUTBPmc0-S1JlwWYJy5V08RThyB5_vXrswyq-ZXZ6feVwFjzMg2XKZlH0e9fbfj64n0V3QcIGi7soQsYvnUuPTydXjhAiDm-QDS7c6cSb8gmfekMhRLhIr4dDQKhUQYtsSwbEJ3BhjVBrlZMxSrfQrrsQFj9AOAhlVTe2hdcIudIEYge2tJJAQNpmWFFWkB47gFCQzUrZre3d-7Uut5l-AoS5ks22MoI9HrIDQlJnLXgBCHFjBfM5to8L6z2CauxB3NhsQyDcPf6_QanyTLLvmWzIMGfsHnvsBT30XfT5WUF-VvCg01RKF6SpOBJYt8x_XXnB9S3pDSVk43rMjx2nTzWJZ78EIEj6Yge-N0LfHaHPR8N3utx8PYb-lOt25Xpns3qvKXdFplaVodPML2522qBUbKgvzqhG57TUKu9k-mPc8TqgIGP7Ke8PYdWNuq__nOy-gsxPyfyvZO-I7OzX-zc_AwAA__8-bTlL

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a, b AS b1, b AS b2 FROM abc EXCEPT SELECT a, b, c FROM abc ORDER by a, b1
----
distribution: local
vectorized: true
·
• except
│ columns: (a, b1, b2)
│ ordering: +a,+b1
│ estimated row count: 1,000 (missing stats)
│
├── • project
│   │ columns: (a, b, b)
│   │ ordering: +a,+b
│   │
│   └── • scan
│         columns: (a, b)
│         ordering: +a,+b
│         estimated row count: 1,000 (missing stats)
│         table: abc@abc_a_b_c_idx
│         spans: FULL SCAN
│
└── • scan
      columns: (a, b, c)
      ordering: +a,+b,-c
      estimated row count: 1,000 (missing stats)
      table: abc@abc_a_b_c_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyckt9r2zAQx9_3V4h7aumVxHL6Yhg4TTwIpHVmh9ExQpDlW2ZwLU-SoSPkfx-2VxKbxmv6pvvxue_3Du3B_M7Bg-BptZwuHtnVfBGv469LZN-C6D6Mg2sWB8tgtmYCWcKmMUuc1wdnX6LwgYlEsuBpFqzWp63I5LEcRvMgYvffm4oDCIVK6VE8kwHvBziwQSi1kmSM0nVq3zQs0hfwxghZUVa2Tm8QpNIE3h5sZnMCD9YiySkikZIejQEhJSuyvBkrEumLRG7FNtnKbZa-AMJM5dVzYbzGCCDEpaijW0AIK-sx30Gfo89hc0BQlT0KGyt2BJ5zwI-Zcy40h0ye-jvnh1_iZ54ZmxXSjnjXzL-t3foKOiVNaXsJ96ys-yFZ932yfEh5clb5KFgVqp3X0dvU5P9a3rD_QHpHMdmwHE26C6z_lOS9_v3pcgkIOf20V75zgz6_Qd-9vf6ss92vbqr32c7venfJlSMypSoM9Xd-c_K4XpTSHbWHM6rSklZayUamDcOGaxIpGdtWeRssirZUGzyFnUHYHYb5IDzpwE4fdi-AeR-eDMJ3Pdubw6e_AQAA__8n-aWG

query T
EXPLAIN (DISTSQL,VERBOSE) SELECT a, b AS b1, b AS b2 FROM abc INTERSECT SELECT a, c, b FROM abc ORDER by a, b2
----
distribution: local
vectorized: true
·
• intersect
│ columns: (a, b1, b2)
│ ordering: +a,+b1
│ estimated row count: 1,000 (missing stats)
│
├── • project
│   │ columns: (a, b, b)
│   │ ordering: +a,+b
│   │
│   └── • scan
│         columns: (a, b)
│         ordering: +a,+b
│         estimated row count: 1,000 (missing stats)
│         table: abc@abc_a_b_c_idx
│         spans: FULL SCAN
│
└── • scan
      columns: (a, c, b)
      ordering: +a,+b,-c
      estimated row count: 1,000 (missing stats)
      table: abc@abc_a_b_c_idx
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyck9Fr2zAQxt_3V4h7aqlKYjl9MQycNh4E3LizzdgYJsjyLTO4lifJ0BHyvw_Z3VKbxmv6Zp2-333fndEe9K8KPAi-PoTL9YZcrNZJmnwOKfkSxLdRElySJAiDu5RwSnKyTEju_P1g5FMc3ROeC7LepEGcWNlRLazunyKKV0FMbr91fRhQqGWBG_6IGrzv4EBGoVFSoNZS2dK-E6yLJ_DmFMq6aY0tZxSEVAjeHkxpKgQPUp5XGCMvUM3mQKFAw8uqa8tz4fNcbPk234ptWTwBhTtZtY-19roglAigkDTcFq6BQtQaj_gO9V3qM8gOFGRrjt7a8B2C5xzo-_I5Z-Y7EY5NhWPnhFuV2pS1MDM2TPbs4lpXVaDC4nktJ23dd9m6b7SdGnhx0vlo2Nay7zfwyyz5P8kr8e9R7TBBEzWzxXCA9HeD3ovnsAxDoFDhD3PhO1fUd6-oz64vP6py93NYGv3f04u-OWfRMepG1hrHY7_aeW5nxWKH_e60bJXAByVFZ9Mfo47rCgVq09-6_WFd91c24EvYmYTZNMwm4cUAdsawewbMxvBiEr4Zxc4OH_4EAAD__-kdqwc=
