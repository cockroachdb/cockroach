# LogicTest: local

statement ok
CREATE TABLE x (
  a INT PRIMARY KEY,
  b INT,
  INDEX (b),
  FAMILY "primary" (a, b)
)

statement ok
ALTER TABLE x INJECT STATISTICS '[
  {
    "columns": ["a"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 100,
    "histo_buckets": []
  },
  {
    "columns": ["b"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 123123,
    "histo_buckets": []
  }
]'

statement ok
CREATE TABLE y (
  u INT PRIMARY KEY,
  v INT REFERENCES x,
  INDEX (v),
  FAMILY "primary" (u, v)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM x WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0lNGO4jYUhq_HT3GUm2UqUhK4GQWt1CybqmnZMIJ0u6vRyHISJ7gYO2s7kKGqNA_BE86TVA7MDKpEUbUaLpB8-L_j__ycxHXhM1WaSRHAROYrJUm-_PgBaEvzrGG8oAoM1QY2BxVCrguKSlVQhf-UTGjM2ZoZWBINZkmhoCVpuIEN4Q0N4MbqqSAZp3jHqh2pOuqcXAqrl7Vha7ajCjea4iXTRlaKrPX_odYNNyyXHGtDzAWSy5xwZh7wc4sC10QZZpgUtMBMFLTFOicXbNdK1qQihmIm6sbgLiQmqrNUWR4wWlKFuZSrpj5mWkqFy9V52weyYJpwLre4bDjHpgvZ2rzEcaIqeoCsHCu5PYv4nudZJpfaHJrjLTNLfJThLmK2o5esHuVGEaFJbpPF35pj6iXWVG1YfraJolXDiUKLKLVDG_2Nw3vbegzw2vxZTRoj7Z0bmhup_subQGgyj8I0gjT8MI2gbjLO8h9b6KErAnGS3kAySyH5fTrto6vsWDmcJrNkkc7DOEmhxfWKPsDtPP4Uzr_Cb9FX6BEIF5PrPrqKk4_RF2hxhlnRQi_r6uh6jFA4TaP5v2-Ok1-jSQqLNEzjRRpPFvDuDgEA_NV9249DNlWXuROA138t55I3a6GdAO5eige983K-P9UrSgwtMDFOAM7Q829cz3c9Hzw_8LzA85wTsY2didz-4Y2wgO-d3t09pN0ymIfaGnNOYWFX7Rk8xZTcvjYcjvzhqPvt7_73jpy9ycidw7ebGt2_GyMUfbmdhnECvdlt2oco-XwNi2hql-IH-Hk--wQt_PFLNI8gg_cwGiPXdV3UvZ3an45rhuBpv3_aPz7tHyGXQhtFmDABDIYDP4C7wQhcGIzu0T8BAAD__71i0pU=

statement error ENV only supported with \(OPT\) option
EXPLAIN (ENV) SELECT * FROM x WHERE b = 3

#
# Multiple Tables.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x, y WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0ld9u4kYUxq8zT3HEzUKFGxNuIkcrlWUnrVvWRMbd7iqKRoM9hmmGGe_8cSBVpVWfgcs-XZ6kGpsktBs2qlbhAsnHv-_MOR-fcRDAe6YNVzKCscqvtaL58u0bYGuWzx0XBdNgmbFQtxRCQQCaKV0wTX5XXBoi-IpbWFIDdsmgYCV1wkJNhWMRnHqeSToXjNzyxS1dNKpDuJKeV5XlK37LNHGGkSU3Vi00XZn_o1o5YXmuBDGW2meUQuVUcLsh9y0KUlFtueVKsoJwWbA1MTl9ZuxKq4ouqGWEy8pZ0pjE5eKgqixbGSuZJkKpa1ftPC2VJuX14bFbZcENFULdkNIJQWxjsh_zOZ2gesFakceJVjcHJYMwDL0mV8a2zckNt0uyw0hjMb9lz426w62m0tDcO0s-uZ3rJTFM1zw_2ESzhRNUoxnO_NLWfBLw2rc-A3hsfk9TZ5U_s2a5Vfprs0mExikeZRiy0ZsJhsrNBc-_X0MXHVGIk-wUkmkGya-TSR8dzXeV9mo8TWZZOoqTDNakumYbuEjjd6P0I_yCP0KXwmg27vXRUZy8xR9gTeaEF2vozps66p0hNJpkOP3vyXHyMx5nMMtGWTzL4vEMXl0iAIA_mm__6dB60XjeiSDsP5ZzJdxKmk4Elw_Flu88XF_t85pRywpCbSeCzkk4OA3CQRAOIBxEYRiFYWcP9rZzmfsf3EkvGIT7ZzcPaRMGu6n8YJ19sfRRuxfuy7S6eWx4MhycDJt7f_a_deX5i6zcTPhyW6OrV2dPJ3LjE-m-SGR9KJGbJxLp7hP5L64mpSfPpymOf0xasu5Bis9xipMxnj1Es0sf4-x1TZzrr8Z582Scmy3xh4vJKE6gO73I-oCT9z2Y4Ylnv4PzdPoO1n3YwG8_4RTDHF7D8AwFQRAgLiXTQfMO6eZaGdNDcLf9-277-W77GZo_6c0XlfUPu-fP3_nLe3233e6AXEljNeXSRnB8cjyI4PJ4CAEcD6_QHlZyYZk20LXasR76JwAA___qiTXf

#
# Same table twice should only show up once.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x one, x two
----
https://cockroachdb.github.io/text/decode.html#eJy0lMGO2zYQhs_LpxjoEruwCnlzWXiRg-KogFpHXlhqkGCxIGhpJLOmSYWkbK2LAnkIH_t0-yQFJW_WKOAaRbA-GOLM_w1nflH0ffiE2nAlJzBV-Vorlq8-vAdsMV82XBSowaKxsO1VhPg-aFS6QE3_UFwaKviGW1gxA3aFUGDJGmFhy0SDE7hxepRsKZDuebVnVUedkyvp9Kq2fMP3qGljkK64sarSbGP-D7VphOW5EtRYZi-QQuVMcPtIn0sUtGbacsuVxIJyWWBLTc4utF1rVbOKWaRc1o2lnUlcVmepsuwxLFFTodS6qY-elkrTcn2-7Z4suGFCqB0tGyGo7Ux2bV7iBNMV9pCTU612Z5FxEASOyZWxfXG643ZFjzLaWcz3eKnVo9xqJg3LnbP0a3N0vaQG9ZbnZ4torBrBNEmjzA1tzVcB71zpW4CX4s9q1ljl9txibpX-r94kIdNFFGYRZOH7WQR1sxQ8_7mFAbliECfZDSTzDJLfZ7MRuVoeI_1qOk_SbBHGSQYtrdf4CHeL-GO4-AK_RV9gwCBMp8MRuYqTD9FnaOmS8qKFwbKLk-EtIeEsixb_3jlOfo2mGaRZmMVpFk9TeHNPAAD-7P7dz2PbqvPcm0AwegnnSjQbabwJ3H8P9nrv-_rhVK-RWSwos94EvOtgfOMHYz8YQzCeBMEkCLwTsbOdy9y98EY6YByc7t19pN1hsI-1a8w7haU7as_gKabV7qXg9dvx9dsu99foR0devsrIXYevNzV5eHNLSPT5bhbGCQzmd9kIouTTENJo5g7FT_DLYv4RWghTUBJH_ZPdqVvi-75PuJSo_e5-HeRaGTMk8HT4--nw7enwDboLrIV7Zt4piQ9nUnanutThmCq5sKgNDKxucEj-CQAA___TGesJ

#
# Set a relevant session variable to a non-default value and ensure it shows up
# in the environment dump.
#

statement ok
SET reorder_joins_limit = 63

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0lN9u2zYUxq_DpzjwTZ3BWuQYGAIFuXBdZtPmyoGsdS2CgKAlyuZCkyr_KFaGAX2IPGGeZKDkJF4XNxiK-MIAj7_v8JzPPykI4APThisZwUTl11rRfPXuLbANyxeOi4JpsMxYqDsVQnOcgWZKF0yTPxWXhgi-5hbO4KfRKUAQQMFK6oSFmgrHIjhBQQBM0oVg5JYvb-my9cGKGrAr9rVcSa9XleVrfss0cYaRFTdWLTVdm__jWjthea4EMZbaF5xC5VRw25CHFgWpqLbcciVZQbgs2IaYnL4wdqVVRZfUMsJl5SxpY-JyuddVlp2NlUwTodS1q7aplkqT8nr_2J2z4IYKoW5I6YQgtg3Zj_mST1C9ZJ3Jy4lWN3stwzAMvSdXxnbNyQ23K7KVkTZifsteGnUrt5pKQ3OfLPnstqmXxDBd83xvE82WTlDd4ldwY81nAWe-9bPMUWeVv7NmuVX6W7NJhCYpHmcYsvHbKYbKLQTPf9xAHx1QiJPsBJJZBsnv0-kAHSy2le40mSXzLB3HSQYbUl2zBi7S-P04_QS_4U_QpzCeTw4H6CBO3uGPsCELwosN9BdtHR2eIjSeZjj9-uY4-RVPMphn4yyeZ_FkDm8uEQDAX-23__RovWwz70UQDp7KuRJuLU0vgsvHYqfvPZ6vdvWaUcsKQm0vgt5xODwJwmEQDiEcRmEYhWFvR-xj5zL3f7iT3jAMd-9uH9IWBttUfrDerll61B6Muzatbp4aHo-Gx6P2t78H37vy4lVWbid8va3R1ZvT54lsPJHuP0TW-4hsniHSPRD5L11NSq88n6U4_jnplPUhpPgcpziZ4Pkjmn36hLP3tTjX38S5eRbndkv88WI6jhPozy6yAeDkwyHM8dRrf4DzdPYeGvjjF5xicHAGo1MUBEGA2ndwg-D-7u7-7sv93RfIlTRWUy5tBEfDCC6PRhDA0egK_RMAAP__IZgN_Q==

# Make sure it shows up correctly even if it matches the cluster setting.
statement ok
SET CLUSTER SETTING sql.defaults.reorder_joins_limit = 63


query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0lN9u2zYUxq_DpzjwTZ3BWuQYGAIFuXBdZtPmyoGsdS2CgKAlyuZCkyr_KFaGAX2IPGGeZKDkJF4XNxiK-MIAj7_v8JzPPykI4APThisZwUTl11rRfPXuLbANyxeOi4JpsMxYqDsVQnOcgWZKF0yTPxWXhgi-5hbO4KfRKUAQQMFK6oSFmgrHIjhBQQBM0oVg5JYvb-my9cGKGrAr9rVcSa9XleVrfss0cYaRFTdWLTVdm__jWjthea4EMZbaF5xC5VRw25CHFgWpqLbcciVZQbgs2IaYnL4wdqVVRZfUMsJl5SxpY-JyuddVlp2NlUwTodS1q7aplkqT8nr_2J2z4IYKoW5I6YQgtg3Zj_mST1C9ZJ3Jy4lWN3stwzAMvSdXxnbNyQ23K7KVkTZifsteGnUrt5pKQ3OfLPnstqmXxDBd83xvE82WTlDd4ldwY81nAWe-9bPMUWeVv7NmuVX6W7NJhCYpHmcYsvHbKYbKLQTPf9xAHx1QiJPsBJJZBsnv0-kAHSy2le40mSXzLB3HSQYbUl2zBi7S-P04_QS_4U_QpzCeTw4H6CBO3uGPsCELwosN9BdtHR2eIjSeZjj9-uY4-RVPMphn4yyeZ_FkDm8uEQDAX-23__RovWwz70UQDp7KuRJuLU0vgsvHYqfvPZ6vdvWaUcsKQm0vgt5xODwJwmEQDiEcRmEYhWFvR-xj5zL3f7iT3jAMd-9uH9IWBttUfrDerll61B6Muzatbp4aHo-Gx6P2t78H37vy4lVWbid8va3R1ZvT54lsPJHuP0TW-4hsniHSPRD5L11NSq88n6U4_jnplPUhpPgcpziZ4Pkjmn36hLP3tTjX38S5eRbndkv88WI6jhPozy6yAeDkwyHM8dRrf4DzdPYeGvjjF5xicHAGo1MUBEGA2ndwg-D-7u7-7sv93RfIlTRWUy5tBEfDCC6PRhDA0egK_RMAAP__IZgN_Q==

statement ok
SET enable_zigzag_join = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0lN9O40YUxq-ZpzjKzYYqLg6RKmTERTY7tG6zDnLc7a4QGk3scTJlMuOdPyamqrQPwRPyJJXHAdKWQKWKXESak-935pwvnx0E8Ilpw5WMYKLya61ovvrwHtiG5QvHRcE0WGYs1J0KoTnOQDOlC6bJ74pLQwRfcwtn8MPoFCAIoGAldcJCTYVjEZx4hEm6EIzc8uUtXXoQzkCV5bOIkigIQFWWr_kt08QZRlbcWLXUdG1gRQ3YFfsv1NoJy3MliLHUvkIKlVPBbUMeWhSkotpyy5VkBeGyYBticipfblNpVdEltYxwWTlLvFVcLvdSZdlhrGSaCKWuXbV1tlSalNf7x-7IghsqhLohpROCWO9zO-ZrnKB6yTqolROtbvYiwzAMWyZXxnbNyQ23K7KVEW8xv2WvjbqVW02loXnrLPnqtq6XxDBd83xvE82WTlDt81RwY81X8UKIqLOqvbNmuVX6pdkkQpMUjzMM2fj9FEPlFoLn32-gjw4oxEl2Asksg-TX6XSADhbbSneazJJ5lo7jJIMNqa5ZAxdp_HGcfoFf8BfoUxjPJ4cDdBAnH_Bn2JAF4cUG-gtfR4enCI2nGU7_eXOc_IwnGcyzcRbPs3gyh3eXCADgD__dfnq0XnrPexGEg6dyroRbS9OL4PKx2Ol7j-erXb1m1LKCUNuLoHccDk-CcBiEQwiHURhGYdjbEbe2c5m3f7iTLTAMd-_2D6kPg22qdrDeLizbqD2Au5hWN08Nj0fD45H_7c_B_1158SYr-wnfbmt09e70-UQ2bSLdvxJZ70tk80wi3UMi_6arSdkqz2cpjn9MOmV9CCk-xylOJnj-GM0-fYpzy_k41y_GuXk2zn5L_PliOo4T6M8usgHg5NMhzPG01X4H5-nsIzTw2084xeDgDEanKAiCAPl3cIPg_u7u_u7b_d03yJU0VlMubQRHwwguj0YQwNHoCv0VAAD__0fwDl8=

statement ok
SET optimizer_use_histograms = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0lN9u4kYUxq8zT3HEzZIKNyZIVeQoFyw7ad2yJjLudldRNBrsMUwzzHjnjwOpKu1D8IR5kspjktAtsBfVcoE0h-935pyPzw4C-MC04UpGMFL5vVY0X7x7C2zF8pnjomAaLDMW6laF0BRnoJnSBdPkT8WlIYIvuYUr-GlwCRAEULCSOmGhpsKxCC48wiSdCUYe-fyRzj0IV6DKci-ipGdUZfmSPzJNnGFkwY1Vc02X5jgZBF-BSycsz5UgxlJrYEEN2AXbTwqVU8Htmjy3KEhFteWWK8kKwmXBVsTkVB5vU2lV0Tm1jHBZOUu8XVzOD1Jl2WKsZJoIpe5dtXW3VJqU94fHbsmCGyqEeiClE4JY73Uz5rc4QfWctVAjJ1o9HET6YRg2TK6MbZuTB24XZCsj3mL-yL416lZuNZWG5o2z5LPbul4Sw3TN84NNNJs7QbXPR8GNNZ_FkThQZ1VzZ81yq_Sx2SRCoxQPMwzZ8O0YQ-Vmguc_rqCLTijESXYBySSD5PfxuIdOZttKexpNkmmWDuMkgxWp7tkabtL4_TD9BL_hT9ClMJyOTnvoJE7e4Y-wIjPCixV0Z76OTi8RGo4znH59c5z8ikcZTLNhFk-zeDSFN7cIAOAv_918OrSee887EYS913KuhFtK04ng9qXY6jsv57tdvWbUsoJQ24mgcx72L4KwH4R9CPtRGEZh2NkRN7ZzmTd_uJMN0A937_bPqQ-DXVfNYJ1dWDZRewZ3Ma0eXhueD_rnA__b373_u_Lsu6zsJ_x-W6O7N5f7E7luEun-k8j6UCLXexLpnhP5L11NykZ5PUlx_HPSKutTSPE1TnEywtOXaHbpa5wbzse5Phrn9d44-y3xx5vxME6gO7nJeoCTD6cwxeNG-wNcp5P3sIY_fsEpBgdXMLhEQRAEyL-D1wieNpunzZenzRfIlTRWUy5tBGf9CG7PBhDA2eAO_RMAAP__q2YOwQ==

statement ok
SET optimizer_use_multicol_stats = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0lN9O40YUxq-ZpzjKzYYqLg6RKmTERTY7tG6zDnLc7a4QGk3ssTNlMuOdPyamqrQPwRPyJJUnAdI2gKqKXETyyfc7c843XxwE8Ilpw5WMYKLya61ovvzwHtia5QvHRcE0WGYsNBsVQnOcgWZKF0yT3xWXhgi-4hbO4IfRKUAQQMFK6oSFhgrHIjjxCJN0IRi55dUtrTwIZ6DKci-ipGdUbfmK3zJNnGFkyY1VlaYr81_JlROW50oQY6l9hQ4CECqngtuWPHQpSE215ZYryQrCZcHWxORUwpIasEu2v02tVU0rahnhsnaWeMu4rJ6lynKDsZJpIpS6dvXW4VJpUl6bV8iCGyqEuiGlE4JY73c35mucoLpiG6iTE61unkWGYRh2TK6M3TQnN9wuyVZGvMv8lr026lZuNZWG5p2z5Kvbul4Sw3TD82ebaFY5QbW_6YIba76KFy6VOqu6MxuWW6Vfmk0iNEnxOMOQjd9PMdRuIXj-_Rr66IBCnGQnkMwySH6dTgfoYLGtbJ4ms2SepeM4yWBN6mvWwkUafxynX-AX_AX6FMbzyeEAHcTJB_wZ1mRBeLGG_sLX0eEpQuNphtN_nhwnP-NJBvNsnMXzLJ7M4d0lAgD4w393nx5tKu95L4Jw8FTOlXAraXoRXD4WN_re4_PVrl4zallBqO1F0DsOhydBOAzCIYTDKAyjMOztiDvbucy7C3eyA4bh7tn-v-rDYNu6G6y3C8suag_gLqbVzVPD49HweOR_-3Pwf1devMnKfsK32xpdvTvdn8i2S6T7VyKb5xLZ7kmke0jk33QNKTvl-SzF8Y_JRtkcQorPcYqTCZ4_RrNPn-LccT7OzYtxbvfG2W-JP19Mx3EC_dlFNgCcfDqEOZ522u_gPJ19hBZ--wmnGBycwegUBUEQIP8ObhHc393d3327v_sGuZLGasqljeBoGMHl0QgCOBpdob8CAAD__1FNDyM=

statement ok
RESET reorder_joins_limit

statement ok
RESET enable_zigzag_join

statement ok
RESET optimizer_use_histograms

statement ok
RESET optimizer_use_multicol_stats

#
# Test sequences.
#

statement ok
CREATE SEQUENCE seq

query T
EXPLAIN (OPT, ENV) SELECT * FROM seq
----
https://cockroachdb.github.io/text/decode.html#eJyUkk2P2jwUhff5FXf5vlVT8dEZ6KBZUOpKSJCZQgbNzjLOTbjF2MG-him_vgqhm6oUdRcp5zk-enTTFFboAzn7ABOnt94pvfnyGfAN9TqSKdADY2A4tKkkWYocPDpfoJffHdkgDe2I4RHu-yOANIUCSxUNw0GZiA8wTNIU0Kq1QXmi6qSqMwcbFYA3-Hvc2SbvaqYdndDLGFBuKLCrvNqFf6F20TBpZ2RgxTdI47QyxD_kr4pC1sozMTmLhSRb4JsMWt2YXXtXq0oxSrJ1ZHnWRLa6SpVli2GJXhrntrG-WC2dl-X2-uyWLCgoY9xRltEYyWfJzcxbnFG-whZq4tK741Wk2-l0Gka7wG25PBJv5CUmz4rphLemXuLslQ1KN2blPl6slzKgP5C-WuKxikb58_kVFDjsDTw21X-8ORXZNW8eULPzf9tmk2SyEONcwFJ8exHZREAd14b0h4B7mE-z1Xj2IqAL8_Fr-_mp1-v3B71O_35493EwuBt2BjDNJgsxF1kOXVjm40UO3VGSiNfn2XiawX9Pz_l7ENnqf1iKmZjk8A6-Lp7mEHA_StI0TZOA-4hWYxrQoObmT_IzAAD__3bhPyw=

#
# Test views.
#

statement ok
CREATE VIEW v AS SELECT a, b, u, v FROM x, y WHERE b = 3

query T
EXPLAIN (OPT, ENV) SELECT * FROM v
----
https://cockroachdb.github.io/text/decode.html#eJy0Vd1uIjcYvY6f4hM3C9XMZghSFYEilWWddlp2iIZpdldRZJkZD7gxNuufCaSqtOozcNmny5NUHiBhd8NGVRUukPzNOZ_Pd3wshyFcMm24kl0YqPxGK5rP3r4BtmT5xHFRMA2WGQvVBoXQGGegmdIF0-QPxaUhgs-5hTP4sdMDCEMoWEmdsFBR4VgXTlEYApN0Ihi549M7Oq15MKMG7Ix9DVfS49XC8jm_Y5o4w8iMG6umms7Nf2HNnbA8V4IYS-0zTKFyKrhdkV2LgiyottxyJVlBuCzYkpicPiN7odWCTqllhMuFs6S2icvpQVZZbmisZJoIpW7cYutqqTQpbw7L3jALbqgQ6paUTghia5O9zOd4guop25A8nGh1e5DSjqLIc3Jl7KY5ueV2RrYwUlvM79hzUrdwq6k0NPfOkk9u63pJDNMVzw820WzqBNV1_ApurPkk4My3fjJz1Fnl96xYbpX-njaJ0CDF_QxD1n8zxLBwE8Hz10tooiMKcZKdQjLKIPl9OAzQ0WRb2awGo2Scpf04yWBJFjdsBRdp_K6ffoTf8EdoUuiPB60AHcXJW_wBlmRCeLGE5qSuo1YPof4ww-nXO8fJr3iQwTjrZ_E4iwdjeHWFAAD-rP_9r0Grae15owtR8FjOlXBzaRpduHoobvCNh_X1Pl4zallBqG10oXEStU_DqB1GbYja3SjqRlFjD-xt5zL3B-6kJ7Sj_b3rS1qHwa4WXlhjnyx91HbEfZpWt48NTzrtk0797a_g_448eZGRa4UvNzW6ftV7OpErn0j3TSKrQ4lcPZFIt0vkF7iKlB55Pkpx_HOyQVYtSPE5TnEywOOHaDbpY5w9r45z9d04r56M8_6UlzF-v0NX9bXzFy1AR86Ph1rQH8MYD30PGsAkABdABefp6F39Mr3eiQu-WK7g_S84xTCBM-j0EMIfLob9OIHm6CILACeXrV3THza9qh4KwzBEXEqmw_qFauZaGdNCcL_-5379-X79GeonYPVNZfnT9nb7L3_7k7xfr7eAXEljNeXSduH45LjdhavjDoRw3LlGe7CSC8u0gabVjrXQvwEAAP__1MBPbw==

#
# Test tables in user-defined schemas.
#

statement ok
CREATE SCHEMA s;
CREATE TABLE s.t (a int primary key)

query T
EXPLAIN (OPT, ENV) SELECT * FROM s.t;
----
https://cockroachdb.github.io/text/decode.html#eJyUktFq20wQha-zTzF3sX-iH5dCCTG5UFQV1CqykbahoZRhI43krddaZXdkJ376ItmFUuqa3n_fmcNhggAeyHlt2xuIbLl2VpWr93dAL1Q-9dpU5IDJM2wPlBBFLMGRdRU5_G5169HojWa4hXdv5wBBABXVqjcMW2V6uoFrEQRArXoyhHvd7FUzerBSHnhFv-O2HXjbsd7oPTnsPeFKe7aNUxv_L9amN6xLa9Cz4jOmsaUyml_xZ0SFnXKsWduWKtRtRS_oS3WmdudspxrFhLrtesZxJt02J626PmhUk0Nj7brvjqvW1mG9Pl37YFbaK2PsDuveGORx5KHmOc8o19BBGnB0dndSeTObzQantJ4P4bjTvMIjhuPEek_nqh5xdqr1qhyWxef-uHqNntxWlydDHDW9UW58v0p79s8GbofoP_6c6tkON7dUsnV_69YKEeVxKGOQ4V0ag_-fYSIuFCSZvIZsISH7nKZX4iJaZIXMwySTwNit6RWWeXIf5o_wKX6EiYKwiKZiOhciTGWc_xKXZB_jSEIhQ5kUMokKuPz67XIuRPxlmYZJBpPFUl5BnD1MoYjTgf0PPuSL-8GeiyAIAjG-HosfAQAA___OrkHU

#
# Test default_transaction_quality_of_service settings.
#

statement ok
SET default_transaction_quality_of_service=background

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUkkFqG00QhfdzilpK4AGJH36CjRZOokXAOAY7Irui1VMzqqjVNa6ulhytfAidUCcJMyNvgmWR_fe9ejyqLGFBmljiNXwRv1ZxfvX1M9AL-WXmUJGCUTLYDlRRPM6fQEm0IsVfwjFh4A0bzOD__24AyhIqql0OBlsXMl3Dp6IsgaJbBsI9N3vX9B6sXAJb0d-4xI6X1njDe1LMiXDFyaRRt0n_Ym1yMPYSMJmzC2YQ7wLbb3yLqLB1amwskSrkWNELJu8u1G5VWtc4I-TYZsN-Jo7NWauuB41qUgwi69yeVq1FsV6frz2YFScXguywziGg9SN3NS95wWlDg9ThqLI7q0wnk0nneEk2hOOObYUnDPuJeU8fney-5o03dTE5302Lz_k0e42JdMueYAZL59eNSo7Vuw-l1OTgdMjkZOk5wKy78i7tsknXfkveRD-qGYti_vPh7vbbPYy-Pzxdwfx-MYbF7d2P-SOMpuOboizLsujxVMDxcDgeXo-HVxhNr8bFnwAAAP__2DQrKQ==

statement ok
SET default_transaction_quality_of_service=critical

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUksFq20AQhu96ijnaEIFNoZQEH9LWh0JIA0lNb8NmNZKnXu8os7N26lMewk_oJymSnEuJY3L_vn9-fqYsYUGaWOIlfBO_UnF--f0r0DP5x8yhIgWjZLAZqKK4nz-AkmhFin-EY8LAazaYwedPVwBlCRXVLgeDjQuZLuFLUZZA0T0Gwh03O9f0HixdAlvS_7jEjpfWeM07UsyJcMnJpFG3Th-x1jkYewmYzNkZM4h3ge0vvkZU2Do1NpZIFXKs6BmTd2dqtyqta5wRcmyzYT8Tx-akVdeDRjUpBpFVbo-r1qJYr07XHsyKkwtBtljnEND6kbua57zgtKFB6nBU2Z5UppPJpHO8JBvCccu2xCOG_cS8o_dOdl_zypu6mJzvpsWnfJy9xkS6YU8wA69s7F14852UmhycDomcLD0FmHU33qRdNum6b8ib6HslY1HMf9_dXP-4hdHPu4cLmN8uxrC4vvk1v4fRdHxVlGVZFj2eCjjs94f9y2H_AqPpxbj4FwAA__9iIypU

#
# Test recursive table references from foreign keys.
#

statement ok
CREATE TABLE z (
  pk INT PRIMARY KEY,
  ref INT,
  CONSTRAINT fk FOREIGN KEY (ref) REFERENCES y(u),
  FAMILY "primary" (pk, ref)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM z;
----
https://cockroachdb.github.io/text/decode.html#eJy0VV1vm0gUfc78iiu_1FmZFU6kVeQoD647WbHr4gjYqlVVjcYw4FmPGTofxGa1_301ECduC4lWVXhAmss5995zOAjPgw9MaS7LGSxkulWSppt3b4HtWbq2XGRMgWHaQN2hEIpxAopJlTFF_pa81ETwHTdwA79dXgN4HmQsp1YYqKmwbAZXyPOAlXQtGGl40dCi5cGGajAb9j1clg4vK8N3vGGKWM3IhmsjC0V3-v-wdlYYnkpBtKHmBaaQKRXcHMixRUYqqgw3XJYsI7zM2J7olL6wdqVkRQtqGOFlZQ1pbeJlMcjK847GcqaIkHJrqwdXc6lIvh1eu2NmXFMh5D3JrRDEtCa7NV_iCaoK1pEcnCh5P0iZ-r7vOKnUpmtO7rnZkAcYaS3mDXtupEvNEW8ULTVNnbXkq32wPSeaqZqnDG4gVdzwlIreOClWWEFV15Fro78KuHEzetHUGul2r1lqpHpuyRKhRYTnCYZk_naJobJrwdNf9zBGZxSCMLmCcJVA-NdyOUFn64dKd1qswjiJ5kGYwJ5UW3aAuyh4P48-wZ_4E4wpzOPF-QSdBeE7_BH2ZE14tofxuq2j82uE5ssER99PDsI_8CKBOJknQZwEixjefEYAAP-0d3eNaF205o9m4E-eyqkUdlfq0Qw-PxY7_Ojx_OUUrxg1LCPUjGYwuvCnV54_9fwp-NOZ7898f3QCdrbzMnVv3paOMPVPZ7dfa5sKc6jcYqNTcukydySe0pS8f2p4cTm9uGyf_Tv5WcnrV5Hcbvh6qtGXN9f9iTy4RNofElkPJfLQk0h7TOQ3uJrkDnm7inDwe9gh63OI8C2OcLjA8WM0x_Qpzo7Xxrl-Ns6H3jgPqmycymr7g0zF8iGhTY_QatujNN9-q1GxvE_lYWwH1TTDavDHu-U8CGG8uksmgMMP5xDjpcP-ArfR6j0018jzPA-1v5MG_RcAAP__OmE4gQ==

# A foreign key cycle shouldn't cause infinite recursion.
statement ok
ALTER TABLE y ADD CONSTRAINT fk FOREIGN KEY (v) REFERENCES z (pk);

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vd9v2zYYfA7_ig9-qTNYg5wAQ-AgD67LDNpcOZC1okVRELRE2ZxoUeUPxdKw_32gFDdeK8UYhvjBgOg7fnfn-yDPgw9MaS6LGSxkkitJk927t8AOLNlYLlKmwDBtoOpQCK1xDIpJlTJF_pS80ETwPTdwB79c3wJ4HqQso1YYqKiwbAY3yPOAFXQjGGn4tqHblgc7qsHs2PdwWTi8LA3f84YpYjUjO66N3Cq61_-FtbfC8EQKog01Z5hCJlRwU5PjFSkpqTLccFmwlPAiZQeiE3pGdqlkSbfUMMKL0hrSxsSL7SAryzoay5giQsrclk-pZlKRLB-W3TFTrqkQ8pFkVghi2pCdzHM8QdWWdSQHJ0o-DlKmvu87TiK16S4nj9zsyBOMtBHzhr000rXmiDeKFpomLlry1T7FnhHNVMUTBneQKG54QkVvnRTbWkFVdyPXRn8VcOdm9KKpNdJpr1hipHpJZIHQIsLzGEM8f7vEUNqN4MnPBxijCwpBGN9AuIoh_GO5nKCLzdNJ97RYhes4mgdhDAdS5qyGhyh4P48-we_4E4wpzNeLywm6CMJ3-CMcyIbw9ADjTXuOLm8Rmi9jHH0_OQh_w4sY1vE8DtZxsFjDm88IAOCv9tt9RrTatuGPZuBPno8TKey-0KMZfP522OFH356_nOIVo4alhJrRDEZX_vTG86eePwV_OvP9me-PTsAudl4k7p-3hSNM_dPZ7ba2rTB16YSNTsmF69yReEpT8vH5wqvr6dV1-9vfk_9refMqlluFr-cafXlz29_IxjWyzH-opGLZUCmbnlKW-bGVJ8Ash_tVhINfww6kWHYJEb7HEQ4XeH2UUI_tYG2b3toOuqmdG_uDmWrISt1jxfY4qUlFMof8l5-qz81hTM_E0EtrxmX-vNRuXrvU1YtLXQ-ngz8-LOdBCOPVQzwBHH64hDVeOuxPcB-t3kN9izzP81D7GqrRPwEAAP__rNtIQw==
