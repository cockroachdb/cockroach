# LogicTest: local !metamorphic-batch-sizes
# We must turn off metamorphic variables because some are included in
# EXPLAIN (OPT, ENV) output.

statement ok
CREATE TABLE x (
  a INT PRIMARY KEY,
  b INT,
  INDEX (b),
  FAMILY "primary" (a, b)
)

statement ok
ALTER TABLE x INJECT STATISTICS '[
  {
    "columns": ["a"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 100,
    "histo_col_type": ""
  },
  {
    "columns": ["b"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 123123,
    "histo_col_type": ""
  }
]'

statement ok
CREATE TABLE y (
  u INT PRIMARY KEY,
  v INT REFERENCES x,
  INDEX (v),
  FAMILY "primary" (u, v)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM x WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYYokZNdBA4KzHXVzVvqFLbatSgKgpKOZC4UyZKUa2cY0IfIE_ZJBlJ24mCWlWBoLoKIOd_h-fnOdxiG8B61YVIMYCSzay1pNn_1EnCJWVoznqMGi8bCorEKgjAEyrn8SpRGRTUSaohUlihOBcypATtHyLGgNbewoLzGAciicLhMGktMRoUhX5mdk7UVySQnht1gBzynLpIVb7Ubz66O4M2rj9547ZsJu9f3-bax1VQYmlkmBVGaSc3sqg0opK4ob0N_qSlndkVkQQzqBctaA9BY1pzqNkcaaU6k4K1xbIqzA1sbJIV0zULtHZkuJ0xj5vtRV4Lqda9Q0JRj3ok1DS-KmnNiHaTB78PN4sQBrfnC4YU7uQC4T2ZjSWsr3RVNIIRVirOMWWKQu3ALqUmtHDtarxK74Nulcj5SarM5MZZarFDY9sAfeBMGtSUFNZYoauePAlU1t0y5P2TOCpZRF4NxZPF166j02skNK29oSf6SrGvucKlcnajICSuF1EiEtGTBDHN-mm4bwgTJpNrLM9culvusH1TPoHHiQCyrUNYWXkC0s5GRuXfxBEwYAhMW9YLyvfOvpLGlRg_gVJfYcNGxkGj5tbWh_SiKPEZm66lVllXsBnOiqLbM5Yg5YSLHpfe2p8kuPy6z60fmJVyAUueoMSecGtvRSjfVnupE41xW6PLqHFBPPafRRnHWKDDhrGKtl51GP5-vMb4Oei0lGjNqugbjIWjOjJWlptWTUH5A_Fqw9Gn3bTPbNwy7RE-VxOqyOjasYpw6ySd2rtHMJW8taXR85qEaC9SES3ldKz-JxitJcd15qZaKlq6PTKjaNhRgouyAafSG66v29tA30HzhxNAC16Tp1OI78Xskfd1CZqIk9z3wO16htrVOvay1lnA33q0R1ztdcyRKy5SmjO9Zwy1uNBW5rIjB9rFokKzCGylaJeVdMvJmW2K3qcw-t7VIZS3yRkAo58i7d6GHZVIYqylzeiOkU-SF58WW-DxyHy8ws1Lve1WJIBhN42ESQzJ8eRn7Kh6rOuUsO17CQfCMwniSnMPkKoHJu8vLo-BZuj5pvkZXk1kyHY4nCSyJusYVvJ2O3wynH-GP-CMcUBjORodHwbPx5FX8AZYkJSxfwkHqz4PDiyAYXibxdOf148nv8SiBWTJMxrNkPJrB808BAMDf_rf76dFF6d92vQFER_fH64XWG8Cnu8PGvnf3_XnbXiO1mBNqewPonUb98zDqh1Efov4gigZR1Nsydq8VJvwjqRYO0I-27_Zy5x-0dqVcYL1tsFf7DXAb5lT8zuHpWf_0zP_vn6P_m3L6Q1L2Ef64rIPPzy_2cHPluFn_h5uLNm6udnCz3nDzgd2CFM7y9dU0Hv86aSwXhzCNX8fTeDKKZ7Dh5wG9J7bDeWIvuom92klsn2_84e3lcDyBg6u3yRHEk_eHMIsvne1P8Hp69QaW8Odv8TSGFF7A2UUQhmEY-NfI8pf1bAXw_fb2--2377ff4E5J7ABOTk_6A_h0cgYhnJx9Dv4NAAD__wYcoVg=


statement error pq: at or near "EOF": syntax error: the ENV flag can only be used with OPT
EXPLAIN (ENV) SELECT * FROM x WHERE b = 3

#
# Multiple Tables.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x, y WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt9u27YXvq6e4sA3dX6wEjn5XQQOCsx11c1b6hS22rUoCoKSjmQuFKmSlGtnGFDsGXK5p8uTDKSUxEEtK8HQXAQ2fb7D8-c736Hvw3tUmkkxgolMLpWkyfLVS8A1JnHFeIoKDGoDq9rK83wfKOfyKykVllQhoZrI0pCSUwFLqsEsEVLMaMUNrCivcAQyyywukdoQnVChyVdmlqSxIonkRLMr7ICn1Eay4a1208XFAN68-uiMG99MmL2-T7eNjaJC08QwKUipmFTMbNqAQqqC8jb0l4pyZjZEZkSjWrGkNQCFecWpanOkkKZECt4ax21xdmArjSSTtlmonCPd5YQpTFw_qkJQ1fQKBY05pp1YXfMiqzgnxkJq_D7cIows0OgvHF7YkzOA-2RuLWllpL2iDoSwouQsYYZo5DbcTCpSlZYdrVeJXfDtUlkfMTXJkmhDDRYoTHvgD7wJjcqQjGpDSmqWjwIVFTestB9kyjKWUBuDtmRxdeuodOPkiuVXNCd_SNY1d7gubZ2oSAnLhVRIhDRkxTSzfupua8IESWS5l2e2XSx1WT-onkZtxYEYVqCsDLyAYGcjA33v4gkY3wcmDKoV5Xvnv5Ta5AodgFOVY81Fy0Ki5NfWhg6DIHAYmTRTWxpWsCtMSUmVYTZHTAkTKa6dtz1NtvlxmVw-Mi9hA5QqRYUp4VSbjlbaqXZUJwqXskCbV-eAOupZjdYlZ7UCE84K1nrZcfD_0wbj6qAaKVGYUN01GA9BS6aNzBUtnoRyA-LWgqFPu2-b2a5h2CV6ZU6MyotDzQrGqZV8YpYK9VLy1pIGhycOqjBDRbiUl1XpJlE7JckuOy9VsqS57SMTZWVqCjCRd8AUOsPmqr09dA3UXzjRNMOGNJ1afCd-j6SvXchM5OS-B27Hl6hMpWIna60l3I23a8T2TlUcSalkTGPG96zhFjeKilQWRGP7WNRIVuCVFK2S8i6aOLMtsbutzD63lYhlJdJaQCjnyLt3oYMlUmijKLN6I6RV5JXjxZb4PHIfrzAxUu17VQnPm8zDcRRCNH55HroqHpZVzFlyuIa-94zCdBadwuwigtm78_OB9yxuTupvk4vZIpqPp7MI1qS8xA28nU_fjOcf4bfwI_QpjBeTg4H3bDp7FX6ANYkJS9fQj925d3DmeePzKJzvvH46-zWcRLCIxtF0EU0nC3j-yQMA-NP9t389usrd2643gmBwf9wstN4IPt0d1va9u--ft-0VUoMpoaY3gt5xMDz1g6EfDCEYjoJgFAS9LWP7WmHCPZIqYQHDYPtuJ3fuQWs2pQ2stw12an8L3IZZFb9zeHwyPD5xv_01-K8pxz8kZRfhj8va-_z8bA83N5ab1XfcXLVxc7ODm9UtNx_YrUhmLV9fzMPpz7PacnUA8_B1OA9nk3ABt_zs03tiW5wj9qqb2JudxHb5hh_eno-nM-hfvI0GEM7eH8AiPLe2_4PX84s3sB7ABn7_JZyHEMMLODnzfN_3PSYEKt89A_uJklofeHBz_c_N9beb62_gniub707WPzXjaH_521b95vq6MbjTIDOCo-Oj4Qg-HZ2AD0cnn70ts4xxg0pD36gKD7x_AwAA__-5LMVh

#
# Same table twice should only show up once.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x one, x two
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3dQYrkNNdBA564brq4C11ClstWhQFQUtHMheKZEnKsTMM6EPkck_XJxlIyYmDWVaKobkILPJ8h-fnOx8ZhvABtWFSjGAi02stabp6_Qpwg-myYjxDDRaNhXVtFQRhCJRzeUOURkU1EmqIVJYoTgWsqAG7QsgwpxW3sKa8whHIPHe4VBpLTEqFITfMrkhjRVLJiWG32AHPqItky1vtpourAbx9_ckbN76ZsEd9n-8bW02FoallUhClmdTMbtuAQuqS8jb014pyZrdE5sSgXrO0NQCNRcWpbnOkkWZECt4ax644B7CVQZJL1yzU3pHpcsI0pr4fVSmobnqFgi45Zp1YU_Mirzgn1kFq_DHcIk4c0JqvHF66lQuAh2R2lrSy0h1RB0JYqThLmSUGuQs3l5pUyrGj9ShxCL5fKudjSW26IsZSiyUK2x74I2_CoLYkp8YSRe3qSaCy4pYp90NmLGcpdTEYRxZft45KN05uWXFLC_KnZF1zhxvl6kRFRlghpEYipCVrZpjzU3fbECZIKtVRnrl2scxn_ah6Bo0TB2JZibKy8BKig42MzIOLH8CEITBhUa8pPzr_ShpbaPQATnWBNRcdC4mWN60NHUZR5DEybaZWWVayW8yIotoylyNmhIkMN97bkSa7_LhMr5-Yl3ABSp2hxoxwamxHK91Ue6oTjStZosurc0A99ZxGG8VZrcCEs5K1HnYW_XreYHwddCMlGlNqugbjMWjFjJWFpuUPofyA-GvB0h87b5_ZvmHYJXqqIFYX5alhJePUST6xK41mJXlrSaPTFx6qMUdNuJTXlfKTaLyS5Nedh2qpaOH6yISqbE0BJooOmEZv2Bx1tIe-geYrJ4bm2JCmU4vvxe-J9HUXMhMFeeiBv-MValvppZe11hIexrtrxPVOVxyJ0nJJl4wfuYZb3GgqMlkSg-1jUSNZibdStErK-2TizfbEbleZY24rsZSVyGoBoZwj774LPSyVwlhNmdMbIZ0irz0v9sTniffxGlMr9bFXlQiCyTweJzEk41eXsa_iqaqWnKWnG-gHzyhMZ8k5zK4SmL2_vBwEz5bNSv01uZotkvl4OktgQ9Q1buHdfPp2PP8Ef8SfoE9hvJicDIJn09nr-CNsyJKwbAP9pV8PTi6CYHyZxPODx09nv8eTBBbJOJkukulkAc8_BwAAf_n_7q9H14V_2_VGEA0elpsLrTeCz_eLtX3v_vvLvr1GajEj1PZG0DuLhudhNAyjIUTDURSNoqi3Z-xeK0z4R1IlHGAY7Z_t5c4_aO1WucB6-2Cv9jvgPsyp-L3DsxfDsxd-7-_B_015-VNS9hH-vKyDL88vjnBz67hZ_Yeb6zZubg9ws9px85HdmuTO8s3VPJ7-Nqst1ycwj9_E83g2iRew42efPhDb4Tyx193E3h4kts83_vjucjydQf_qXTKAePbhBBbxpbP9Bd7Mr97CBsYLkAIH9S97Iy-CMAzDgAmBOvQPwX6qpTEnAXy_--f73bfvd9_AP1g28Jmal1Lgl5YteyP91l2zlTNuURvoW13hSfBvAAAA__99U7nM

#
# Set a relevant session variable to a non-default value and ensure it shows up
# in the environment dump.
#

statement ok
SET reorder_joins_limit = 63

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYYoleNhCBzkwnXVzVvqFLbatSgKgpaOZC4UyZKUamcY0IfIE_ZJBlJO4mCWlWBoLoKIOd_h-fnOdxiG8B61YVIMYSzTKy1punz1EnCF6aJiPEMNFo2FurEKgjAEyrn8SpRGRTUSaohUlihOBSypAbtEyDCnFbdQU17hEGSeO1wqjSUmpcKQr8wuycaKpJITw66xA55RF8mat9pN5pdH8ObVR2-88c2E3ev7dNvYaioMTS2TgijNpGZ23QYUUpeUt6G_VJQzuyYyJwZ1zdLWADQWFae6zZFGmhEpeGsct8XZga0Mkly6ZqH2jkyXE6Yx9f2oSkH1plco6IJj1ok1DS_yinNiHaTB78PN48QBrfnC4dydnAHcJ3NrSSsr3RVNIISVirOUWWKQu3BzqUmlHDtarxK74Nulcj4W1KZLYiy1WKKw7YE_8CYMaktyaixR1C4fBSorbplyf8iM5SylLgbjyOLr1lHpjZNrVlzTgvwlWdfc4Uq5OlGREVYIqZEIaUnNDHN-mm4bwgRJpdrLM9culvmsH1TPoHHiQCwrUVYWziHa2cjI3Lt4AiYMgQmLuqZ87_wraWyh0QM41QU2XHQsJFp-bW1oP4oij5HpZmqVZSW7xowoqi1zOWJGmMhw5b3tabLLj8v06pF5CReg1BlqzAinxna00k21pzrRuJQlurw6B9RTz2m0UZw1Ckw4K1nrZSfRz6cbjK-D3kiJxpSarsF4CFoyY2WhafkklB8QvxYsfdp928z2DcMu0VMFsboojw0rGadO8oldajRLyVtLGh0PPFRjjppwKa8q5SfReCXJrzov1VLRwvWRCVXZhgJMFF3Tp9Fbbu5qmngOvwx2Usz30HzhxNAcN7zplOM7_Xskg91OZqIg923wa16htpVeeGVrreJuvNskrn264kiUlgu6YHzPJm5xo6nIZEkMtk9Gg2QlXkvRqirvkrE329K728rsc1uJhaxE1mgI5Rx59zr0sFQKYzVlTnKEdKJce2ps6c8jV3KNqZV638NKBMF4Fo-SGJLRy4vYV_FYVQvO0uMVHATPKEymySlMLxOYvru4OAqeLTYnzdf4cjpPZqPJNIEVUVe4hrezyZvR7CP8EX-EAwqj-fjwKHg2mb6KP8CKLAjLVnCw8OfB4VkQjC6SeLbz-sn093icwDwZJZN5MhnP4fmnAADgb__b_fRoXfjnXW8I0dH98Wan9Ybw6e6wse_dfX_ettdILWaE2t4QeidR_zSM-mHUh6g_jKJhFPW2jN2DhQn_TqqEA_Sj7bu94vk3rV0rF1hvG-wF_xa4DXNCfufwZNA_Gfj__XP0f1Ne_JCUfYQ_Luvg8_OzPdxcO25W_-Fm3cbN9Q5uVrfcfGBXk9xZvr6cxZNfp41lfQiz-HU8i6fjeA63_Dyg98R2OE_supvY653E9vnGH95ejCZTOLh8mxxBPH1_CPP4wtn-BK9nl29gDX_-Fs9iqOAcBmdBGIZh4B8k6wC-39x8v_n2_eYb3CmIHcKL_hA-vRhACC8Gn4N_AwAA__-NA51_

# Make sure it shows up correctly even if it matches the cluster setting.
statement ok
SET CLUSTER SETTING sql.defaults.reorder_joins_limit = 63


query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYYoleNhCBzkwnXVzVvqFLbatSgKgpaOZC4UyZKUamcY0IfIE_ZJBlJO4mCWlWBoLoKIOd_h-fnOdxiG8B61YVIMYSzTKy1punz1EnCF6aJiPEMNFo2FurEKgjAEyrn8SpRGRTUSaohUlihOBSypAbtEyDCnFbdQU17hEGSeO1wqjSUmpcKQr8wuycaKpJITw66xA55RF8mat9pN5pdH8ObVR2-88c2E3ev7dNvYaioMTS2TgijNpGZ23QYUUpeUt6G_VJQzuyYyJwZ1zdLWADQWFae6zZFGmhEpeGsct8XZga0Mkly6ZqH2jkyXE6Yx9f2oSkH1plco6IJj1ok1DS_yinNiHaTB78PN48QBrfnC4dydnAHcJ3NrSSsr3RVNIISVirOUWWKQu3BzqUmlHDtarxK74Nulcj4W1KZLYiy1WKKw7YE_8CYMaktyaixR1C4fBSorbplyf8iM5SylLgbjyOLr1lHpjZNrVlzTgvwlWdfc4Uq5OlGREVYIqZEIaUnNDHN-mm4bwgRJpdrLM9culvmsH1TPoHHiQCwrUVYWziHa2cjI3Lt4AiYMgQmLuqZ87_wraWyh0QM41QU2XHQsJFp-bW1oP4oij5HpZmqVZSW7xowoqi1zOWJGmMhw5b3tabLLj8v06pF5CReg1BlqzAinxna00k21pzrRuJQlurw6B9RTz2m0UZw1Ckw4K1nrZSfRz6cbjK-D3kiJxpSarsF4CFoyY2WhafkklB8QvxYsfdp928z2DcMu0VMFsboojw0rGadO8oldajRLyVtLGh0PPFRjjppwKa8q5SfReCXJrzov1VLRwvWRCVXZhgJMFF3Tp9Fbbu5qmngOvwx2Usz30HzhxNAcN7zplOM7_Xskg91OZqIg923wa16htpVeeGVrreJuvNskrn264kiUlgu6YHzPJm5xo6nIZEkMtk9Gg2QlXkvRqirvkrE329K728rsc1uJhaxE1mgI5Rx59zr0sFQKYzVlTnKEdKJce2ps6c8jV3KNqZV638NKBMF4Fo-SGJLRy4vYV_FYVQvO0uMVHATPKEymySlMLxOYvru4OAqeLTYnzdf4cjpPZqPJNIEVUVe4hrezyZvR7CP8EX-EAwqj-fjwKHg2mb6KP8CKLAjLVnCw8OfB4VkQjC6SeLbz-sn093icwDwZJZN5MhnP4fmnAADgb__b_fRoXfjnXW8I0dH98Wan9Ybw6e6wse_dfX_ettdILWaE2t4QeidR_zSM-mHUh6g_jKJhFPW2jN2DhQn_TqqEA_Sj7bu94vk3rV0rF1hvG-wF_xa4DXNCfufwZNA_Gfj__XP0f1Ne_JCUfYQ_Luvg8_OzPdxcO25W_-Fm3cbN9Q5uVrfcfGBXk9xZvr6cxZNfp41lfQiz-HU8i6fjeA63_Dyg98R2OE_supvY653E9vnGH95ejCZTOLh8mxxBPH1_CPP4wtn-BK9nl29gDX_-Fs9iqOAcBmdBGIZh4B8k6wC-39x8v_n2_eYb3CmIHcKL_hA-vRhACC8Gn4N_AwAA__-NA51_

statement ok
SET enable_zigzag_join = true

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYYoleNhCBzkwnXVzVvqFLbatSgKgpaOZC4UyZKUa2cY0IfIE_ZJBlJK4mCWlWBoLoKIOd_5_c5HhiG8R22YFEMYy_RKS5ouX70EXGO6qBjPUINFY2FVWwVBGALlXH4lSqOiGgk1RCpLFKcCltSAXSJkmNOKW1hRXuEQZJ47XCqNJSalwpCvzC5JY0VSyYlh19gBz6jLZMNb7SbzyyN48-qjN258M2H3-j7dNraaCkNTy6QgSjOpmd20AYXUJeVt6C8V5cxuiMyJQb1iaWsCGouKU93mSCPNiBS8NY_b5uzAVgZJLt2wUHtHpssJ05j6eVSloLqZFQq64Jh1Yk3Ni7zinFgHqfH7cPM4cUBrvnA4dydnAPfF3FrSykoXok6EsFJxljJLDHKXbi41qZRjR2sosQu-3SrnY0FtuiTGUoslCtue-ANvwqC2JKfGEkXt8lGgsuKWKfeHzFjOUupyMI4svm9dHWu8XLPimhbkL8mEa57Y2btmOrhWrlVUZIQVQmokQlqyYoY5T_XADWGCpFLtpZqLzzJf-IMGGjROH4hlJcrKwjlEO_OJzL2LJ2DCEJiwqFeU75UAJY0tNHoAp7rAmo6OiETLr60z7UdR5DEybRZXWVaya8yIotoyVyNmhIkM197bnjm7-rhMrx5Zl3AJSp2hxoxwamzHornF9mwnGpeyRFdX54569jmZNoqzWoQJZyVrDXYS_XzaYHwfdKMmGlNqunbjIWjJjJWFpuWTUH5H_M1g6dPibTPbDwy7dE8VxOqiPDasZJw61Sd2qdEsJW9taXQ88FCNOWrCpbyqlN9F48Ukv-oMqqWihZsjE6qyNQWYKLq2T6O3bGLVQzyHXwY7KeZnaL5wYmiODW86FflOAh_JYHctM1GQ-zH4m16htpVeeHFr7eJuvLtM3Ph0xZEoLRd0wfiey7jFjaYikyUx2L4ZNZKVeC1Fq6q8S8bebEvvbjuzz20lFrISWa0hlHPk3Teih6VSGKspc5IjpBPllafGlv488lZeYWql3ve2EkEwnsWjJIZk9PIi9l08VtWCs_R4DQfBMwqTaXIK08sEpu8uLo6CZ4vmpP4aX07nyWw0mSawJuoKN_B2Nnkzmn2EP-KPcEBhNB8fHgXPJtNX8QdYkwVh2RoOFv48ODwLgtFFEs92hp9Mf4_HCcyTUTKZJ5PxHJ5_CgAA_va_3U-Prgr_wusNITq6P27utN4QPt0d1va9u-_P2_YaqcWMUNsbQu8k6p-GUT-M-hD1h1E0jKLelrF7szDhn0qVcIB-tB3bK55_1tqNcon1tsFe8G-B2zAn5HcOTwb9k4H_3z9H_7fkxQ8p2Wf446oOPj8_28PNjeNm9R9urtq4udnBzeqWmw_sViR3lq8vZ_Hk12ltuTqEWfw6nsXTcTyHW34e0HtiO5wn9qqb2JudxPb1xh_eXowmUzi4fJscQTx9fwjz-MLZ_gSvZ5dvYAN__hbPYqjgHAZnQRiGYeAfJJsAvt_cfL_59v3mG9wpiB3Ci_4QPr0YQAgvBp-DfwMAAP__4tmdgw==

statement ok
SET optimizer_use_histograms = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt9u27YXvq6e4sA3TX6IUjn-YQgc5MJ11c1b6hS22rUoCoKWjmQuFMmSlGtnGNCHyBP2SQZSiuNglpVhaC6CiDnf4fnzne8wDOE9asOkGMJYpjda0nT56iXgGtNFxXiGGiwaC6vaKgjCECjn8itRGhXVSKghUlmiOBWwpAbsEiHDnFbcworyCocg89zhUmksMSkVhnxldkkaK5JKTgy7xQ54Rl0kG95qN5lfn8CbVx-9ceObCXvQ9_musdVUGJpaJgVRmknN7KYNKKQuKW9Df6koZ3ZDZE4M6hVLWwPQWFSc6jZHGmlGpOCtcdwXZw-2Mkhy6ZqF2jsyXU6YxtT3oyoF1U2vUNAFx6wTa2pe5BXnxDpIjT-Em8eJA1rzhcOlO7kAeEjm3pJWVror6kAIKxVnKbPEIHfh5lKTSjl2tF4l9sF3S-V8LKhNl8RYarFEYdsDf-RNGNSW5NRYoqhdPglUVtwy5f6QGctZSl0MxpHF162rYo2XW1bc0oL8IZlwxRN7a9d0B9fKlYqKjLBCSI1ESEtWzDDnqW64IUyQVKqDVHP3s8wn_qiABo3TB2JZibKycAnR3ngi8-DiX2DCEJiwqFeUH5QAJY0tNHoAp7rAmo6OiETLr6097UdR5DEybQZXWVayW8yIotoylyNmhIkM197bgT67_LhMb56Yl3ABSp2hxoxwamzHoLnB9mwnGpeyRJdX54x69jmZNoqzWoQJZyVrvews-v95g_F10I2aaEypOTgbLv3HqCUzVhaalubAkG9D3AH6OfHbwdKueXyM3GW3bxp2aZ8qiNVFeWpYyTh1yk_sUqNZSt5a1uh04KEac9SES3lTKT-PxgtKftN5qZaKFq6XTKjK1jRgouiaQI3esrmrbuQl_DTYW1nfR_OFE0NzbLjTqcpbGXwii91qZqIgD23w216htpVeeIFrreJ-vFsorn264kiUlgu6YPzAQm5xo6nIZEkMtk9HjWQl3krRqizvkrE329G8-8occluJhaxEVusI5Rx591b0sFQKYzVlTnaEdMK88tTY0aAnbuYVplbqQ-8rEQTjWTxKYkhGL69iX8VTVS04S0_XcBQ8ozCZJucwvU5g-u7q6iR4tmhO6q_x9XSezEaTaQJrom5wA29nkzej2Uf4Lf4IRxRG8_HxSfBsMn0Vf4A1WRCWreFo4c-D44sgGF0l8Wzv9ZPpr_E4gXkySibzZDKew_NPAQDAn_63--nRVeFfeb0hRCcPx81e6w3h0_awtu9tvz_v2mukFjNCbW8IvbOofx5G_TDqQ9QfRtEwino7xu7dwoR_LlXCAfrR7t1e9PzT1m6UC6y3C_aifw_chTkx3zo8G_TPBv5_f53815QXPyRlH-GPyzr4_PziADc3jpvVP7i5auPmZg83q3tuPrJbkdxZvr6exZOfp7Xl6hhm8et4Fk_H8Rzu-XlEH4jtcJ7Yq25ib_YS2-cbf3h7NZpM4ej6bXIC8fT9MczjK2f7P3g9u34DG_j9l3gWQwWXMLgIwjAMA_8o2QTw_e7u-92373ffYKsgdggv-kP49GIAIbwYfA7-DgAA__8cL53l

statement ok
SET optimizer_use_multicol_stats = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYYoleNhCBzkwnXVzVvqFLbatSgKgpaOZC4UyZKUa2cY0IfIE-ZJBlJK4qCWlWFoLoKIOd_h-fnOdxiG8B61YVIMYSzTKy1punz1EnCN6aJiPEMNFo2FVW0VBGEIlHP5lSiNimok1BCpLFGcClhSA3aJkGFOK25hRXmFQ5B57nCpNJaYlApDvjK7JI0VSSUnhl1jBzyjLpINb7WbzC-P4M2rj9648c2E3ev7dNvYaioMTS2TgijNpGZ20wYUUpeUt6G_VJQzuyEyJwb1iqWtAWgsKk51myONNCNS8NY47oqzA1sZJLl0zULtHZkuJ0xj6vtRlYLqplco6IJj1ok1NS_yinNiHaTG78PN48QBrfnC4dydnAE8JHNnSSsr3RV1IISVirOUWWKQu3BzqUmlHDtarxK74Nulcj4W1KZLYiy1WKKw7YE_8iYMaktyaixR1C6fBCorbplyf8iM5SylLgbjyOLr1lWxxss1K65pQf6STLjiiZ21a7qDa-VKRUVGWCGkRiKkJStmmPNUN9wQJkgq1V6quftZ5hN_VECDxukDsaxEWVk4h2hnPJF5cPEfMGEITFjUK8r3SoCSxhYaPYBTXWBNR0dEouXX1p72oyjyGJk2g6ssK9k1ZkRRbZnLETPCRIZr721Pn11-XKZXT8xLuAClzlBjRjg1tmPQ3GB7thONS1miy6tzRj37nEwbxVktwoSzkrVedhL9fNpgfB10oyYaU2r2zoZL_zFqyYyVhaal2TPkO5F-UPx6sNR2oL8LdpvhvnHYpX-qIFYX5bFhJePUqT-xS41mKXlraaPjgYdqzFETLuVVpfxMGi8q-VXnpVoqWrh-MqEqW1OBiaJrCjV6y-auupnn8MtgZ318L80XTgzNseFPpzLfS-ETmezWMxMFeWiD3_gKta30wotcaxV3491Sce3TFUeitFzQBeN7lnKLG01FJktisH1CaiQr8VqKVnV5l4y92Zbu3VVmn9tKLGQlslpLKOfIuzejh6VSGKspc9IjpBPnlafGlg49cTuvMLVS73tjiSAYz-JREkMyenkR-yoeq2rBWXq8hoPgGYXJNDmF6WUC03cXF0fBs0VzUn-NL6fzZDaaTBNYE3WFG3g7m7wZzT7CH_FHOKAwmo8Pj4Jnk-mr-AOsyYKwbA0HC38eHJ4FwegiiWc7r59Mf4_HCcyTUTKZJ5PxHJ5_CgAA_va_3U-Prgr_0usNITp6OG52W28In-4Pa_ve_ffnbXuN1GJGqO0NoXcS9U_DqB9GfYj6wygaRlFvy9i9XZjwT6ZKOEA_2r7bC59_3tqNcoH1tsFe-O-A2zAn6PcOTwb9k4H_3z9H_zflxQ9J2Uf447IOPj8_28PNjeNm9R03V23c3OzgZnXHzUd2K5I7y9eXs3jy67S2XB3CLH4dz-LpOJ7DHT8P6AOxHc4Te9VN7M1OYvt84w9vL0aTKRxcvk2OIJ6-P4R5fOFsf4LXs8s3sIE_f4tnMVRwDoOzIAzDMPAPk00Atzc3tzffbm--wb2C2CG86A_h04sBhPBi8Dn4NwAA__-X2J5H

statement ok
RESET reorder_joins_limit

statement ok
RESET enable_zigzag_join

statement ok
RESET optimizer_use_histograms

statement ok
RESET optimizer_use_multicol_stats

#
# Test sequences.
#

statement ok
CREATE SEQUENCE seq

query T
EXPLAIN (OPT, ENV) SELECT * FROM seq
----
https://cockroachdb.github.io/text/decode.html#eJyUVk1P5EgMvfevqOPuaoIamBnYQRzYnqyEBM0sNGj2ZFUnTuKlUlXtcpqPX7-qSjOARDpwi8DPZfs9P3eWqRvkQM5-UzNX3LLTRfP9L4X3WCw7MiWyEgyi1n3UZJJlShvj7sAzes0IOoDzAt5oqxodlDSoSqx0Z0Sttenwm3JVFXGFCwKh0DbAHUkDmygonIFAjzgCL3Ws5MEMxp1eXXxS59__TcGb3GRla-7Dl8HC2gZdCDkLnskxycMQ0DputRlCrzptSB7AVRCQ11QMFsBYd0bzUCJGXYKzZrCOp-G8ge0CQuUiWcgpURhLQoxF4qNrreYNV2j10mA5ig29LqrOGJAI6fHbcFf5IgIlrIw6jn85Uuq5madI3YmLT_SFALXeUEECAU0st3IMnY_qGHzKvgV_OaqYY6mlaCCIFmzRynDhr7LZgCxQ6SDgtTTvArWdEfLxw5VUUaFjDSGKJc1tZNKbJI9UP-oa_nM0tnd47-OctC2BausYwTqBNQWKeXq2A5CFwvmtOot0UZm6fjW9gCGaAwi16DpRx2r6JpHT8JziA5gsU2QFea3N1v33LkjNmABGc429FqMKgd3dIKG70-k0YVyx2Vov1NIjluA1C8UesQSyJd6nbFtIjv0ZV9y-sy8bC3RcImMJRgcZoTJudZI6MDauxdjX6IIm6UWPDt5Q78BgqKXBx_amnw83mDQH3lgJY6HD2GK8BjUUxNWs2w-h0oKksyD6Y--9VHYiDMdMz9cgXLc7gVoyOlo-SMMYGmcGRzrd2U9QxgoZjHO3nU-bGJKTVLejj7Lzuo48kvWd9BIgW49tH2OK3LzVk3isvu6_KbHEYVgZCLrCjW5G7fiX_71TwfEmk63hmYZ05j2ydLxMzjY4xbfx8ZJE-rgzCJ7dUi_JbLnEA2lY29K1EHB4M3oktfjo7KCrXC9mKeyF3z1NZlvazi5dZ8veQ7QxaMbPYYIVzgZhTdFyrIumvE7SeOE_7zzJayzE8bYfVnYymV3mJ4tcXeX_XOfzWa58tzRU7ARcqfPT-c3J2XWudtX5yc_-88-9vf39g73p_tfDL58PDr4cTg_U6Xx2mZ_n84XaVVeLk8uF2j2aTPKfP85OTufqt4sfi08qn9_8rq7ys3y2UH-ovy8vzlXA1dEky7JsEnDVoS0w6y96_M_k_wAAAP__NmnG9g==

#
# Test views.
#

statement ok
CREATE VIEW v AS SELECT a, b, u, v FROM x, y WHERE b = 3

query T
EXPLAIN (OPT, ENV) SELECT * FROM v
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u27gSvo6eYuCbJgdWIscHB4GDAMd11V3vpk5hq38oCoKSRjY3FKmSlGpnsUCxz5DLfbo8yYKUnThby0qxaC4Cm55vfr_5SN-Ht6g0k2IAI5lcK0mTxYvngEtM4pLxFBUY1Aaq2srzfB8o5_ILKRQWVCGhmsjCkIJTAQuqwSwQUsxoyQ1UlJc4AJllFpdIbYhOqNDkCzMLsrYiieREsxtsgafUZrLijXbj2VUXXr344IzXvpkwe32fbRsbRYWmiWFSkEIxqZhZNQGFVDnlTejPJeXMrIjMiEZVsaQxAYXzklPV5EghTYkUvDGPTXN2YEuNJJN2WKicI93mhClM3DzKXFC1nhUKGnNMW7G65kVWck6MhdT4fbhZGFmg0Z85XNiTc4CHYjaWtDTShqgTISwvOEuYIRq5TTeTipSFZUdjKLELvt0q6yOmJlkQbajBHIVpTvyRN6FRGZJRbUhBzeJJoLzkhhX2g0xZxhJqc9CWLK5vLZ1eO7lh8xs6J79J1rZ3uCxsn6hICZsLqZAIaUjFNLN-6mlrwgRJZLGXZ3ZcLHVVP-qeRm3FgRiWoywNXECwc5CBfnDxHRjfByYMqoryvftfSG3mCh2AUzXHmouWhUTJL40D7QVB4DAyWW9tYVjObjAlBVWG2RoxJUykuHTe9gzZ1sdlcv3EuoRNUKoUFaaEU21aRmm32lGdKFzIHG1drQvqqGc1Whec1QpMOMtZY7DT4L9na4zrg1pLicKE6rbFeAxaMG3kXNH8u1BuQdy1YOj3xdtmthsYtoleMSdGzfNjzXLGqZV8YhYK9ULyxpYGx30HVZihIlzK67Jwm6idkmTXrUGVLOjczpGJojQ1BZiYt22fQme5jlUP8QL-199JMTdD_ZkTTTNc86ZVju_174kMtncyE3PyMAZ3zReoTKlip2yNXdyNtzeJHZ8qOZJCyZjGjO-5iRvcKCpSmRONzZtRI1mON1I0qsqbaOTMtvRu05l9bksRy1KktYZQzpG3X4cOlkihjaLMSo6QVpQrR40t_XnilVxhYqTa97ASnjeahsMohGj4_DJ0XTwuypiz5HgJh94BhfEkOoPJVQSTN5eXXe8gXp_U30ZXk1k0HY4nESxJcY0reD0dvxpOP8Cv4Qc4pDCcjY663sF48iJ8D0sSE5Yu4TB2597RuecNL6NwujP8ePJLOIpgFg2j8Swaj2bw7KMHAPC7-2__OrSau-ddZwBB9-F4fad1BvDx_rC279x__7Rtr5AaTAk1nQF0ToPemR_0_KAHQW8QBIMg6GwZ2wcLE-6dVAoL6AXbsZ3iuTetWRU2sc422An-BrgNs0J-7_C03zvtu9_-6P7bkuMfUrLL8MdV7X16dr6HmyvLzfIbblZN3Fzt4Ga54eYju4pk1vLl1TQc_zSpLasjmIYvw2k4GYUz2PDzkD4Q2-Icsat2Yq92Enu73rfj8N0mTOW20O5d1zsobY3eEQxnMAsvrQ_ahbgLZRcqeDm9evV4g7r_iPvu53AaQgwX0D_3vPD968vheAKHV6-jLoSTt0cbp_-pfVXnnu_7vseEQOW7d-ZhoqTWRx7c3f51d_v17vYruPfQ6puT5f_Xy25_-dPO9O72dm1wr3BmACenJ70BfDzpgw8n_U_ellnGuEGl4dCoEo-8vwMAAP__qdne8Q==

#
# Test tables in user-defined schemas.
#

statement ok
CREATE SCHEMA s;
CREATE TABLE s.t (a int primary key)

query T
EXPLAIN (OPT, ENV) SELECT * FROM s.t;
----
https://cockroachdb.github.io/text/decode.html#eJyUVl1v4zYQfD79Cr5dUsSB2yuK4II8-Hwu4NZxAlt3aFAUxFpaydtQJLNcOR-_viDtNMkhspI3w9gZLndmhxoM1HfkQM5-VmNXXLODYv31i8I7LFYtmRJZCQZRm21Vlg0GCoxxt9ozemDUELTzor0Bq9YQlKxRlVhBa0RtwLT4WbmqirjCBdGhABv0Lcla76p04YwO9IA98BJiJ_ems266vDhS51-vUvGOm6zs5T55XiwMNkAh5Kz2TI5J7ruA1nEDpgt904Ihudeu0gF5Q0VnA4x1a4C7iBih1M6azj4eh_MKtg2oKxfFQk5EoY-EGIukR9tY4J1WaGFlsOzFhq0vqtYYLRGyxe_DLSd5BEq4Meos_nOq1NNlHiuhFReP2DaiqfGGChId0MR2K8e69dEdnUfZ1-DPRxU5ViDFWgcBwQatdDf-gs0GZNEVBNEeZP0mUNMaIR9_uJIqKiD2EKJZ0tx6Jr0jeaD6AWr9r6O-vcM7H-cEttRUW8eorRO9oUCRZ6t20GR14fxen0W5qEy3fjG9gCGGgxZq0LWiztTwVSGH4YniHZjBQJEV5A2YvfvvXZCaMQEMcI1bL0YXana3nYL-PBwOE8YVu631Qg09YKk9sFC8I5aabIl3iW2PyPF-xhXXb7yXjQ06LpGx1AaC9EgZtzpZXTOuXYPxXr0LmqwXMzp4Q9sE1oYa6jzsl-GvJztMmgPvooSxgNC3GC9BawriaobmXai0IOlZEHjfec-dnQTDvtDztRaum-NADRmIka9lzRjWznSOdHj8KUEZK2RtnLtufdrEkJKkuu49lJ2HOupI1reytQDZum_7GFPl7qytiGfqt0-vWixpGG6MDlDhzje9cfx__r3RwfFNJlvrJxnSM--RpeVVSrbOKb6Ojy9JlI9bg9qzW8GKzJ6XuIOGwZau0QG7N2OLpAYfnO1MlW_5OJU9y7vHyeyjbe3KtbbcZggYg6b_OUywwtkgDBQjx7oYyptkjWf588YneYOFON73YWWzbLyYjPKJykdfZpM0xeNwLOog-wBqOs9P1PwiV_Nvs9lR9mF8MV_mi9F0nivR_hrv1eViej5aXKk_J1fqANRoOT7MDk-zbDTLJ4sfOafzPybjXC3zUT5d5tPxUn38-5-Pp1k2-etyNprO1cHFZX6kJvPvh2o5mcXan9Tvi4tzFY7lNBsMBoMspa9k_wUAAP__NC3Neg==

#
# Test default_transaction_quality_of_service settings.
#

statement ok
SET default_transaction_quality_of_service=background

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVs1uG0cMvusp5mgDViA3RREk8CFNfAiQJgHsGO2JoHa5K9azwzGHK_-c8hB-Qj9JMbNyLQNarX0TBH4kh9_HjzufuwvSxBLeu09SXapgtfr8p6MbqpY9-5rUGSVz6yFqNpvPHXov1xCVIioBJpBoED0Gt8LkbEWupgZ7b26Nvqf3Tpom4ypJBqnCkOCabQWbKKjEQ-I7moDXmDu59aNxX86-H7m_Pv9Tgje5Odje3O-2g00xJKyMJUBUFmW7HQMG0Q797Oz0fCf8qkfPdgvSQCJdc0XuxC2xumxV-lB_cO6p7mNKpbb3qGMdKWENEvxoS49z2oHtE0EjmTfSkihNJWGlqlDTdwF1QxsFXHqqJ7FpkEjTew-WIQN-H64MkpOlK-9O8j87R4S9SS4xNALcRc8VGyTyud1GFPqYhTJaKuyCb48q51iiVStIhkYdBRtv_Fm2kEgNGkwGEW31IlDXe-OYf0jNDVeYe0hZNmVuE5PeJLnj9g5b-Fd4agXpJuY5YaiB2yBKEMRgzYlznoHtBBygkrhXZ5kursurn00vUco-AcYdSW_uxC12ErlITylegZnPHQcjXaPfawVRkrVKBeBRWxq0mFUIKtejhB4vFouCkWqzv9G44zuqIaIa5zdSDRxquinZ9pCc3-elunzhu0JuULQmpRo8JpugMm91kTooraSj_K7JBS3Sy3adoufBjMFzx6PFflv8_m6DKXPQjZUoVZimFuM5aMXJpFXsXoUqC1IuhOHr6m0ruxBGU6YXWzBtuzeJO_aY3R9spZRW4kdHunjztkCVGlLwIpd9LJuYipM0l5NFVSK2mUcOsbdBAhzaqe1TKpGbWgOJJ-6PtzslVjhMVx4SNrTRzaQd_-9_L1RwPs8cWniioVz8SGq9LouzjU5xNz5fkkyf9p4gqixxyX7PUR5Joxhq6SDR-GYMSO7oTsKoq_w8_1TCtvzucTL70vZhmW_-4CHoPfnpc1hglYRkipwtJ0g25XWRxpb_vPAkr6ky0X3fWGE2O_37x9ePX765g-8_zo_c6beLQ3fx8evP0zN3cHz4YTafz-ezEp5m7uH-_uH-18P9L3dwfHQ4-y8AAP__Urqy8w==

statement ok
SET default_transaction_quality_of_service=critical

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVs1uG0cMvusp5mgDViA3RREk8CFNfAiQJgHsGO2JoHa5K9azwzGHK_-c8hB-Qj9JMbNyLQNarX0TBH4kh9_HjzufuwvSxBLeu09SXapgtfr8p6MbqpY9-5rUGSVz6yFqNpvPHXov1xCVIioBJpBoED0Gt8LkbEWupgZ7b26Nvqf3Tpom4ypJBqnCkOCabQWbKKjEQ-I7moDXmDu59aNxX86-H7m_Pv9Tgje5Odje3O-2g00xJKyMJUBUFmW7HQMG0Q797Oz0fCf8qkfPdgvSQCJdc0XuxFXKxhX6D849VX1MqNT2HnWsHyWsQYIfbehxSjuwfSJoJLNGWhKlqSSsVBVi-i6gbkijgEtP9SQ2DQJpeu_BMmTA78OVMXKydOXdSf5n54iwN8klhkaAu-i5YoNEPrfbiEIfs0xGS4Vd8O1R5RxLtGoFydCoo2DjjT_LFhKpQYPJIKKtXgTqem8c8w-pueEKcw8pi6bMbWLSmyR33N5hC_8KTy0g3cQ8Jww1cBtECYIYrDlxzjOwnYADVBL36izTxXV59bPpJUrZJcC4I-nNnbjFTiIX6SnFKzDzueNgpGv0e40gSrJWqQA8akuDFrMKQeV6lNDjxWJRMFJttjcad3xHNURU4_xGqoFDTTcl2x6S8_u8VJcvfFfIDYrWpFSDx2QTVOatLlIHpZV0lN81uaBFetmsU_Q8WDF47ni02G-L399tMGUOurESpQrT1GI8B604mbSK3atQZUHKfTB8Xb1tZRfCaMr0Ygumbfcmccces_eDrZTSSvzoSBdv3haoUkMKXuSyj2UTU3GS5nKyqErENvPIIfY2SIBDO7V9SiVyU2sg8cT98XanxAqH6cpDwoY2upm04__974UKzseZQwtPNJR7H0mt12VxttEp7sbnS5Lp094TRJUlLtnvOckjaRRDLR0kGt-MAckd3UkYdZWf559K2JbfPU5mX9o-LKUP9eAh6D356XNYYJWEZIqcLSdINuV1kcaW_7zwJK-pMtF9X1hhNjv9-8fXj1--uYPvP86P3Om3i0N38fHrz9Mzd3B8-GE2n8_nsxKeZu7h_v7h_tfD_S93cHx0OPsvAAD__-zLsh4=

#
# Test recursive table references from foreign keys.
#

statement ok
CREATE TABLE z (
  pk INT PRIMARY KEY,
  ref INT,
  CONSTRAINT fk FOREIGN KEY (ref) REFERENCES y(u),
  FAMILY "primary" (pk, ref)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM z;
----
https://cockroachdb.github.io/text/decode.html#eJy0VkFv2zgTPVe_YuBLkw9xICcfFoGDHFxXXXg3dQpbLVoUBUFJI5lrimRJSrW92P--IOUkDipZCRbNIYiYecN5M4-PHA7hE2rDpBjDVKZrLWm6evsGcINpUjGeoQaLxkLdRAXBcAiUc_mDKI2KaiTUEKksUZwKWFEDdoWQYU4rbqGmvMIxyDx3uFQaS0xKhSE_mF2RfRRJJSeG7bAHnlFXyZZ3xs2Wd2fw_u0XH7zPzYQ9mvvqMNhqKgxNLZOCKM2kZnbbBRRSl5QHyyhuhX-vKGd2S2RODOqapQg3kGpmWUr5NcDjrvcJNRYVp7qrHo00I1LwzoLuu9SCrQySXLqpofaJTF8SpjH1g6lKQfV-aChowjHrxZpGIHnFObEO0uCP4XwbmbHmO4cbt9LaIlpZ6bZoCiGsVJylzBKD3JWbS00q5WTSuZVogx-2yuVIqE1XxFhqsURhuwt_kk0Y1Jbk1FiiqF09C1RW3DLl_pAZy1lKXQ3Gicb3rafT-yQ7VuxoQf6SrO8A4ka5PlGREVYIqZEIaUnNDHN5mmkbwgRJpTqqMzculnnWT7pn0DiXIJaVKCsLNxC2DjI0jylegBkOgQmLuqb8qBEoaWyh0QM41QU2WnQqJFr-6BzoKAxDj5Hp_vQqy0q2w4woqi1zHDEjTGS48dmODNnx4zJdP5OXcAVKnaHGjHBqbM8o3an2UicaV7JEx6v3gHrpObM2irPGiglnJevc7CL8_9Ue4_ug91aiMaWm72A8Ba2YsbLQtHwRyh8Qfz9Y-rL9DpXtB4Z9pqcKYnVRnhtWMk6d9xO70mhWkne2NDy_9FCNOWrCpVxXyp9E450kX_duqqWihZsjE6qyjQSYKPpOn0Yfud-rGeIN_HbZKjE_Q_OdE0Nz3Oum144f_O-ZCnaXMxMFeRyDv-8ValvpxDtbZxfb8e4mcePTFUeitExowviRK7kjjaYikyUx2H0yGiQrcSdFp6t8jKc-7MDv7jtzLG0lElmJrPEQyjny_uvQw1IpjNWUOcsR0ply7aVx4D_PvJJrTK3Ux15YIgimi2gSRxBP3txGvovnqko4S883cBK8ojCbx1cwv4th_vH29ix4lexXmq_p3XwZLyazeQwbota4hQ-L2fvJ4gv8GX2BEwqT5fT0LHg1m7-NPsOGJIRlGzhJ_Hpweh0Ek9s4WrRuP5v_EU1jWMaTeLaMZ9MlvP4aAAD87X-7nwGtC__OG4whPHtc3t9pgzF8fVhs4gcP398O4zVSixmhdjCGwUU4uhqGo2E4gnA0DsNxGA4Ogt2DhQn_TqqEA4zCw7294_nHrd0qV9jgEOwN_x54CHNG_pDw4nJ0cen_98_Zf6Wc_BLKvsJfxzr49vr6iDa3TpvVT9qsu7S5bdFmda_NJ3E1yV3ku7tFNPt93kTWp7CI3kWLaD6NlnCvzxP6KGyH88Ku-4W9bRX2cb47x1etfyKsMe-ivGuhrNYtnPP1U7Ya8za-25PqOK9dN6_o84fbyWwOJ3cf4jOI5p9OYRndutj_wbvF3XvYXQfD4XAY-MfVLvg3AAD__6T7y98=

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0VkFv2zgTPVe_YuBLkw9xICcfFoGDHFxXXXg3dQpbLVoUBUFJI5lrimRJSrW92P--IOUkDipZCRbNIYiYecN5M4-PHA7hE2rDpBjDVKZrLWm6evsGcINpUjGeoQaLxkLdRAXBcAiUc_mDKI2KaiTUEKksUZwKWFEDdoWQYU4rbqGmvMIxyDx3uFQaS0xKhSE_mF2RfRRJJSeG7bAHnlFXyZZ3xs2Wd2fw_u0XH7zPzYQ9mvvqMNhqKgxNLZOCKM2kZnbbBRRSl5QHyyhuhX-vKGd2S2RODOqapQg3kGpmWUr5NcDjrvcJNRYVp7qrHo00I1LwzoLuu9SCrQySXLqpofaJTF8SpjH1g6lKQfV-aChowjHrxZpGIHnFObEO0uCP4XwbmbHmO4cbt9LaIlpZ6bZoCiGsVJylzBKD3JWbS00q5WTSuZVogx-2yuVIqE1XxFhqsURhuwt_kk0Y1Jbk1FiiqF09C1RW3DLl_pAZy1lKXQ3Gicb3rafT-yQ7VuxoQf6SrO8A4ka5PlGREVYIqZEIaUnNDHN5mmkbwgRJpTqqMzculnnWT7pn0DiXIJaVKCsLNxC2DjI0jylegBkOgQmLuqb8qBEoaWyh0QM41QU2WnQqJFr-6BzoKAxDj5Hp_vQqy0q2w4woqi1zHDEjTGS48dmODNnx4zJdP5OXcAVKnaHGjHBqbM8o3an2UicaV7JEx6v3gHrpObM2irPGiglnJevc7CL8_9Ue4_ug91aiMaWm72A8Ba2YsbLQtHwRyh8Qfz9Y-rL9DpXtB4Z9pqcKYnVRnhtWMk6d9xO70mhWkne2NDy_9FCNOWrCpVxXyp9E450kX_duqqWihZsjE6qyjQSYKPpOn0Yfud-rGeIN_HbZKjE_Q_OdE0Nz3Oum144f_O-ZCnaXMxMFeRyDv-8ValvpxDtbZxfb8e4mcePTFUeitExowviRK7kjjaYikyUx2H0yGiQrcSdFp6t8jKc-7MDv7jtzLG0lElmJrPEQyjny_uvQw1IpjNWUOcsR0ply7aVx4D_PvJJrTK3Ux15YIgimi2gSRxBP3txGvovnqko4S883cBK8ojCbx1cwv4th_vH29ix4lexXmq_p3XwZLyazeQwbota4hQ-L2fvJ4gv8GX2BEwqT5fT0LHg1m7-NPsOGJIRlGzhJ_Hpweh0Ek9s4WrRuP5v_EU1jWMaTeLaMZ9MlvP4aAAD87X-7nwGtC__OG4whPHtc3t9pgzF8fVhs4gcP398O4zVSixmhdjCGwUU4uhqGo2E4gnA0DsNxGA4Ogt2DhQn_TqqEA4zCw7294_nHrd0qV9jgEOwN_x54CHNG_pDw4nJ0cen_98_Zf6Wc_BLKvsJfxzr49vr6iDa3TpvVT9qsu7S5bdFmda_NJ3E1yV3ku7tFNPt93kTWp7CI3kWLaD6NlnCvzxP6KGyH88Ku-4W9bRX2cb47x1etfyKsMe-ivGuhrNYtnPP1U7Ya8za-25PqOK9dN6_o84fbyWwOJ3cf4jOI5p9OYRndutj_wbvF3XvYXgfD4XAY-MfVNvg3AAD__6Tqy90=

query T
EXPLAIN (OPT, ENV) SELECT * FROM x;
----
https://cockroachdb.github.io/text/decode.html#eJy0VkFv2zgTPVe_YuBLkw9xICcfFoGDHFxXXXg3dQpbLVoUBUFJI5lrimRJSrW92P--IOUkDipZCRbNIYiYecN5M4-PHA7hE2rDpBjDVKZrLWm6evsGcINpUjGeoQaLxkLdRAXBcAiUc_mDKI2KaiTUEKksUZwKWFEDdoWQYU4rbqGmvMIxyDx3uFQaS0xKhSE_mF2RfRRJJSeG7bAHnlFXyZZ3xs2Wd2fw_u0XH7zPzYQ9mvvqMNhqKgxNLZOCKM2kZnbbBRRSl5QHyyhuhX-vKGd2S2RODOqapQg3kGpmWUr5NcDjrvcJNRYVp7qrHo00I1LwzoLuu9SCrQySXLqpofaJTF8SpjH1g6lKQfV-aChowjHrxZpGIHnFObEO0uCP4XwbmbHmO4cbt9LaIlpZ6bZoCiGsVJylzBKD3JWbS00q5WTSuZVogx-2yuVIqE1XxFhqsURhuwt_kk0Y1Jbk1FiiqF09C1RW3DLl_pAZy1lKXQ3Gicb3rafT-yQ7VuxoQf6SrO8A4ka5PlGREVYIqZEIaUnNDHN5mmkbwgRJpTqqMzculnnWT7pn0DiXIJaVKCsLNxC2DjI0jylegBkOgQmLuqb8qBEoaWyh0QM41QU2WnQqJFr-6BzoKAxDj5Hp_vQqy0q2w4woqi1zHDEjTGS48dmODNnx4zJdP5OXcAVKnaHGjHBqbM8o3an2UicaV7JEx6v3gHrpObM2irPGiglnJevc7CL8_9Ue4_ug91aiMaWm72A8Ba2YsbLQtHwRyh8Qfz9Y-rL9DpXtB4Z9pqcKYnVRnhtWMk6d9xO70mhWkne2NDy_9FCNOWrCpVxXyp9E450kX_duqqWihZsjE6qyjQSYKPpOn0Yfud-rGeIN_HbZKjE_Q_OdE0Nz3Oum144f_O-ZCnaXMxMFeRyDv-8ValvpxDtbZxfb8e4mcePTFUeitExowviRK7kjjaYikyUx2H0yGiQrcSdFp6t8jKc-7MDv7jtzLG0lElmJrPEQyjny_uvQw1IpjNWUOcsR0ply7aVx4D_PvJJrTK3Ux15YIgimi2gSRxBP3txGvovnqko4S883cBK8ojCbx1cwv4th_vH29ix4lexXmq_p3XwZLyazeQwbota4hQ-L2fvJ4gv8GX2BEwqT5fT0LHg1m7-NPsOGJIRlGzhJ_Hpweh0Ek9s4WrRuP5v_EU1jWMaTeLaMZ9MlvP4aAAD87X-7nwGtC__OG4whPHtc3t9pgzF8fVhs4gcP398O4zVSixmhdjCGwUU4uhqGo2E4gnA0DsNxGA4Ogt2DhQn_TqqEA4zCw7294_nHrd0qV9jgEOwN_x54CHNG_pDw4nJ0cen_98_Zf6Wc_BLKvsJfxzr49vr6iDa3TpvVT9qsu7S5bdFmda_NJ3E1yV3ku7tFNPt93kTWp7CI3kWLaD6NlnCvzxP6KGyH88Ku-4W9bRX2cb47x1etfyKsMe-ivGuhrNYtnPP1U7Ya8za-25PqOK9dN6_o84fbyWwOJ3cf4jOI5p9OYRndutj_wbvF3XvYXAfD4XAY-MfVJvg3AAD__6TZy9s=

# A foreign key cycle shouldn't cause infinite recursion.
statement ok
ALTER TABLE y ADD CONSTRAINT fk FOREIGN KEY (v) REFERENCES z (pk);

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zgTva6eYuCbOh_iQE4-LAIHuXBddeHd1C5stWhRFAQtjWSuKZIlKdf2Yt99QUpJHFSyEiyaiyBi5szvmUMOBvAJtWFSjGAik42WNFm_fQO4w2RVMp6iBovGwrayCoLBACjn8gdRGhXVSKghUlmiOBWwpgbsGiHFjJbcwpbyEkcgs8zhEmksMQkVhvxgdk1qK5JITgw7YAc8pS6TPW-1my7n5_D-7RdvXPtmwp70fX1sbDUVhiaWSUGUZlIzu28DCqkLyoNlFDfCv5eUM7snMiMG9ZYlCLeQaGZZQvkNwGPUe4ca85JT3ZaPRpoSKXhrQvddasCWBkkm3dRQe0emywnTmPjBlIWguh4aCrrimHZiTUWQrOScWAep8Kdwvo3MWPOdw607aWwRLa10IapECCsUZwmzxCB36WZSk1I5mrSGEk3w41Y5HytqkzUxllosUNj2xJ94Ewa1JRk1lihq188CFSW3TLk_ZMoyllCXg3Gk8X3r6HTt5MDyA83JX5J1LSDulOsTFSlhuZAaiZCWbJlhzk81bUOYIIlUJ3nmxsVSX_WT7hk0TiWIZQXK0sIthI2DDM2jixdgBgNgwqLeUn5SCJQ0NtfoAZzqHCsuOhYSLX-0DnQYhqHHyKTeXmVZwQ6YEkW1Za5GTAkTKe68txNDdvVxmWyeWZdwCUqdosaUcGpsxyjdVnuqE41rWaCrq3NBPfWcWBvFWSXFhLOCtQa7DP9_XWN8H3QtJRoTaroW4ylozYyVuabFi1B-Qfz9YOnL4h0z2w8Mu0RP5cTqvLgwrGCcOu0ndq3RrCVvbWl4ceWhGjPUhEu5KZXfROOVJNt0BtVS0dzNkQlV2ooCTORd26fRW9axqiHewm9XjRTzMzTfOTE0w5o3nXL8oH_PZLC7nJnIyeMY_H2vUNtSr7yytXaxGe9uEjc-XXIkSssVXTF-4kpucaOpSGVBDLZvRoVkBR6kaFWVj_HEmx3p3X1nTrktxUqWIq00hHKOvPs69LBECmM1ZU5yhHSivPXUONKfZ17JW0ys1KdeWCIIJotoHEcQj9_cRb6LF6pccZZc7KAfvKIwncXXMJvHMPt4d3cevFrVJ9XXZD5bxovxdBbDjqgN7uHDYvp-vPgCf0ZfoE9hvJycnQevprO30WfYkRVh6Q76K38enN0EwfgujhaN4aezP6JJDMt4HE-X8XSyhNdfAwCAv_1v99Oj29y_83ojCM8fj-s7rTeCrw-HlX3v4fvbsb1GajEl1PZG0LsMh9eDcDgIhxAOR2E4CsPekbF7sDDh30mlcIBheBzbK55_3Nq9con1jsFe8O-BxzAn5A8OL6-Gl1f-f_-c_9eSV7-kZJ_hr6s6-Pb65gQ3D46bavMTOTVmbfQ8NNBTbe75eWSYbeDdfBFNf59VRhqzM1hE76JFNJtES6hT2PfL0wQ-NBL4dF17V1f5U1nbtqL2DUWVDTXtyZZkzvJJZdumunZ92tGQRtihrzaPi-7i-UXfdi_6vr1P0ecPd-PpDPrzD_E5RLNPZ7CM7pzt_-DdYv4e9jfBYDAYBP5Rtg_-DQAA__9R2Nuh

# Check that we remove histograms from statistics correctly.

statement ok
CREATE TABLE b (
  b BOOL NOT NULL,
  INDEX (b)
)

statement ok
ALTER TABLE b INJECT STATISTICS '[
      {
          "avg_size": 1,
          "columns": [
              "b"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 2,
          "histo_buckets": [
              {
                  "distinct_range": 0,
                  "num_eq": 1000,
                  "num_range": 0,
                  "upper_bound": "false"
              },
              {
                  "distinct_range": 0,
                  "num_eq": 100,
                  "num_range": 0,
                  "upper_bound": "true"
              }
          ],
          "histo_col_type": "BOOL",
          "histo_version": 2,
          "name": "__auto__",
          "null_count": 0,
          "row_count": 1100
      },
      {
          "avg_size": 0,
          "columns": [
              "rowid"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 0,
          "histo_col_type": "",
          "name": "__auto__",
          "null_count": 0,
          "row_count": 0
      }
]'

query T
EXPLAIN (OPT, ENV) SELECT * FROM b
----
https://cockroachdb.github.io/text/decode.html#eJy8Vt9vGjkQfu7-FSNemp5CtCG9u5QoD5RQiTsKVdhWrapq5N0dlrl47Y3tJT9O97-fbEhDJJZNHu54QGDPNx5_M_ONu134QsayVn0Y6uzKaJEtL94D3VKW1ixzMuDIOlitraKo2wUhpb7BylAlDKGwqCuHlRQKlsKCWxLktBC1dLASsqY-6MXC4zJtHdpMKIs37Ja4scJMS7R8Ty3wXPhI7mSj3Xg-O4SPF9-C8cY3K7fX9-m2sTNCWZE51gorw9qwu2sCKm1KIaP5KNkJv66FZHeHeoGWzIozgnPIDDvOhDwDeDz1waGhopbCNMVjSOSolWwM6IGlHdjaEi60zxqZ4Mi2OWFDWUhMXSphNkkjJVJJeSvWrgtkUUuJzkPW-H24QCNbZ68lnPuVnRSJ2ml_xDoQ5LKSnLFDS9KHu9AG68qXSeNRahd8myrvIxUuW6J1wlFJyjUH_sSbsmQcLoR1WAm3fBaorKXjyv_QOS84Ez4G64sm8NbC9MbJPRf3osC_NLc1IN1WniehcuRCaUOotMMVW_Z-1tm2yAozXe2tM58uzsOtn7BnyXqVQMcl6drBOcQ7ExnbRxcvwHS7wMqRWQm5VwgqbV1hKACkMAWta9FXIRp905jQ4ziOA0Znm-6tHJd8TzlWwjj2d6QcWeV0G7ztSbK_n9TZ1TPvpXyA2uRkKEcprGtJpe_qUOpoaKlL8vdqbdBQel6sbSV5LcUoueTGw3rx29MNJvBgNlJiKBO2rTGegpZsnS6MKF-ECg0S5oMTLztvu7JDwqhN9KoCnSnKI8slS-G1H93SkF1q2UhpfHQSoIYWZFBqfVVXoRNtUJLFVeuhRlei8HlkVdVuXQKsirbuMxQsN2etk3gOv53sLLGQQ3st0YoFbeqmVY5_6t8zK9gPZ1YFPqYhzPuKjKtNGpStkcXdeD9JfPpMLQkro1ORstwzkhvcGKFyXaKl5s5YI7mke60aVeVzMgxmW3r3wMw-t7VKda3ytYYIKUm2j8MAy7Syzgj2kqO0F-VVKI0t_XnmSF5R5rTZ98JSUTS8HA2SESSD95NRYPGoqlPJ2VEKB9GrFN7PZhOYzhKYfp5MDqNXRt9wDuNpchpWv4znY498sICL0YfB50kCteLrOugT5wdvDqNXw9l0nlwOxtMEUqyu6A4-XY4_Di6_wZ-jb3Cw9juYD73teHox-goppsj5LRykYT16cxZFg0kyutwZ7Xj6x2iYwDwZJON5Mh7O4fX3CADg7_DtPx2xKsKzsNOH48PH5c0I7PTh-8_FsJF2fv7_sW1vSDjKUbhOHzq9uNfrHve6cQ-OT_snb_u9d0e__v723Umvs4XxzxxW4XVVK4_rbW0GlQwPYndX-eg621AlyrCG6F9CiE_2_AB5cBlvbfjB8LB-fBzHYeefwz2MxM9hJKTpP2Ql_v9Y2VAS_Xh9FkWjr58mg_EUDmafkkMYTb-8gflo4gvqF_hwOfsI6VnU7Xa7UZj_afRvAAAA__-fF2t1
