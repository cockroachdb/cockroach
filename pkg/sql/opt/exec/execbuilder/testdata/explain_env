# LogicTest: local !metamorphic-batch-sizes
# We must turn off metamorphic variables because some are included in
# EXPLAIN (OPT, ENV) output.

statement ok
CREATE TABLE x (
  a INT PRIMARY KEY,
  b INT,
  INDEX (b),
  FAMILY "primary" (a, b)
)

statement ok
ALTER TABLE x INJECT STATISTICS '[
  {
    "id": 1,
    "columns": ["a"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 100,
    "histo_col_type": ""
  },
  {
    "id": 2,
    "columns": ["b"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 123123,
    "histo_col_type": ""
  }
]'

statement ok
CREATE TABLE y (
  u INT PRIMARY KEY,
  v INT REFERENCES x,
  INDEX (v),
  FAMILY "primary" (u, v)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM x WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0ldFO40YUhq_xUxzlJlBhYwd2hRIhNQSzTTcYFJvtrhAajcfHMMX2ZGfG2aRVpX0IXqUv0EfhSaqxo2CoU7rd3VxE8vE53__7-J_EtuEdSsVF0YeRYHdSUHZ7cgy4QBaXPEtQgkalYV53WVboR5BQTWOqEI6ga-52BwC2DQmmtMw0zGlWYh_qVq60-pjBEYg0bW2jpRbNVvJJyLsccwN_fdCOfn0AZ_y4muJFggvyq-AFUVoizVGSmGp2SxT_rXJ46LjtlEPHfYaRyESeY5FQzUWhCBY0zjD5F_eiqMYrfYk0QUmeOqIab5bPHB1scnTQcNREFoIImaDkxc0mZm8Ts7eB-RLQczcAPdeFtyvgTOKMSkyI0lRjjoVWhFF2i2vMBogLx3WWRpPLMPKnEPpRNA7eQIpUlxKdOTItVst0Ht9DV8sS25EpzRS2MtXHzGEyiQkvNMqCZo42PCLFp8o4V5oz5VBFREo0zyvjtvfXn6pdyfZctVFo1aucx-h3RZq2k9bhbyMZa8oxLTnVnBEmsgyZSWZzIdVjt9PNrv4PPa-iS-sNKSPyql3gleu-wE-FREaVVt_OsloqjTmpXqEi5gHq-jcQmCOrA5egRpnzokoGSfminKkvSaF1GfrVD-fAGk39YeRDNDye-DAr44wzZwHb1haFcRAdQnAeQXA5mexaW_GqUl-NzoMwmg7HQQQLMrvDJVxMx2fD6Qd463-AbQrDcLSza22NgxP_PSxITHiygO24qls7g4FlDSfmCWtp48ZZ64-Dn_1RBGE0jMZhNB6F0L2yAAB-r77Np0PnN9Ux7vTB3X0sM5GVeaE6fbhaF-v-zvr6utkvkWpMCNWdPnR6rndou57teuB6fdftu26n0WwODS-YJkyUhRnw3Kb2LVdamKgSvZwZY53mME_MQKNQlFm2JjU55uSvFXr7Xm-_uvfH7tfuIP4uO6gcftkael-zBuu6O3gpw0uT4fIfGZ5vyvCyJcPl0wwvybzO8Pw_ZHjZmmFjfPPE8OQEnliak9SYOj2f-uM3QW1qvgNT_9Sf-sHID58dm226M7As__3FZDgOYPv8ItoFP3i3A6E_MV5-gNPp-Rks4Jef_KkPMRzB_sCybdu2FKMFLH5cnVMLHu7vH-4_P9x_BiYK8x_MC92Hvd6e14ervX2wYW__2vo7AAD__3R63oA=


statement error pq: at or near "EOF": syntax error: the ENV flag can only be used with OPT
EXPLAIN (ENV) SELECT * FROM x WHERE b = 3

#
# Multiple Tables.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x, y WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0ldFu2zYUhq-rpzjwje3BUiQnLQIbAeY4SufVUQJL6VoEAUFRVMJFIl2Scu0NA4o9gy_3GnuBPUqeZKBkOEoqL-va-cKADs_5zs_Dn5Jtw1sqFRN8AGNB7qTA5PbkGOiSkrhgWUIlaKo0LKosywr9CBKscYwVhSNom9X2EMC2IaEpLjINC5wVdABVKlNafcjgCESaNqbhQot6Kvoo5F1OcwN_ddCMfnUAZ-y4rGI8oUv0s2AcKS0pzqlEMdbkFin2S6nw0HGbKYeO-wQjKRF5TnmCNRNcIcpxnNHkH9QLXpaX_SXFCZXosSKs6c3qiaKDXYoOaorqSC6QkAmVjN_sYvZ3Mfs7mM8BPXcH0HNdeLMBziWdY0kTpDTWNKdcK0QwuaVbzA6IC8eVl8bTyzDyZxD6UTQJXkNKsS4kdRaUaLEZpvNwDm0tC9qMTHGmaCNTfcgcIpMYMa6p5DhztOEhKT6WwpnSjCgHKyRSpFleCre9v_5UzZ1sz1U7G21ylfNg_bZI02bS1vxNJCNNOSYlx5oRRESWUWKcWR9Iue1mupnVf6HnpXVxNSFlmrxsbvDSdZ_hp0JSgpVW306yWilNc1QeoUJmA1X8GzRYUFIZLqGaypzx0hkoZctirr7EhdZl6JcvzqE1nvmjyIdodDz1YV7EGSPOEjrWCwyTIDqE4DyC4HI67Vkv4k2kehqfB2E0G02CCJZofkdXcDGbnI1m7-GN_x46GEbhuNuzXkyCE_8dLFGMWLKETlzGre5waFmjqdlh1dqocbb9J8GP_jiCMBpFkzCajENoX1kAAL-W_-bXwoub8hq3BuD2HsJEZEXOVWsAV9tgld_aPl_X8yXFmiYI69YAWn3XO7Rdz3Y9cL2B6w5ct1VLNpeGcaIREQU3BZ5b733LlBbGqkiv5kZYq17MElNQC_Aiy7akOsfc_G2H_r7X3y_Xfut97Qzi_2UGpcIvG0P_a8ZgXbeHz3l4ZTxcfObhxS4Prxo8XDz28AotKg8v_oWHV40eNsJ3V4xOTuCRpAVKjajT85k_eR1UohZdmPmn_swPxn745Np0cHdoWf67i-loEkDn_CLqgR-87ULoT42W7-B0dn4Gyx6s4Kcf_JkPMRzB_tCybdu2GOdU2uYjDB0ihVJdC-7Xf9yvP92vP4EimMPqs8jy-83VNiu_m-O5X683CURw8_VmXA9gr7_nDeBqbx9s2Nu_tmppKcs0lQo65rXVtf4OAAD__znlApg=

#
# Same table twice should only show up once.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x one, x two
----
https://cockroachdb.github.io/text/decode.html#eJy0ld9u4sYXx6_jpzjiBvgJW4bNriJQLghxVvyWOBF2VruKotEwPk6msWfYmTGBVpX2IXLZ1-gL9FHyJNXYESGp3XS7Wy4QPn8-5-vj7xjXhY-oNJdiCBPJbpWk7Ob4CHCNbFHwLEEFBrWBVVXlOFEQQ0INXVCNcAhtm22PAFwXEkxpkRlY0azAIVSlXBv9JYNDkGlaW0YLI3dLyZ1UtznmFv5uvx79bh9O-VHZxUWCa_KT5IJoo5DmqMiCGnZDNP-5VHjg-fWUA89_gVHIZJ6jSKjhUmiCgi4yTP5GvRRlezlfIU1QkeeKqMHrzQtF-02K9ncU7SKFJFIlqLi4bmIOmpiDBuZrwL7fAOz7Pnx4BC4VLqnChGhDDeYojCaMshvcYhogPhxVXprMLqI4mEMUxPE0fA8pUlMo9FbIjHxcpvf0HNpGFViPTGmmsZapv2QeU8mCcGFQCZp5xvKIknelcK4NZ9qjmsiUGJ6Xwt3-H7_r-klu39eNgx5rtfdk_bZM03rS1vx1JCtNe7Ykp4YzwmSWIbPO3F1Iedv1dLurf0PPS-vSakPaDnlbP-Ct77_CT6VCRrXRP06y3miDOSkfoSb2Bqr4DxiwQlYZLkGDKueidAZJ-bpY6m9xoXMRBeWLc-RM5sE4DiAeH80CWBaLjDNvDR1nj8I0jA8gPIshvJjNes7e4jFSXU3Owiiej6dhDGuyvMUNnM-np-P5Z_gQfIYOhXE06facvWl4HHyCNVkQnqyhsyjjTnc0cpzxzN5hNdqq8bbzp-H_g0kMUTyOp1E8nUTQvnQAAH4pv-2nRVfX5TFuDcHvPYWZzIpc6NYQLrfBqr61vb7arVdIDSaEmtYQWgO_f-D6fdfvg98f-v7Q91s7xfbQcMEMYbIQtqHv786-4dpIa1ViNksrrLXbzBPbsBMQRZZtSbsce_K3EwZv-oM3Ze7X3vfuYPGf7KBU-G1rGHzPGpyr9ug1D2-sh4u_eHjV5OFNjYeL5x7ekFXl4dU_8PCm1sNWeHPH-PgYnklakdSKOjmbB9P3YSVq1YV5cBLMg3ASRC-OTYd2R44TfDqfjachdM7O4x4E4ccuRMHMavkfnMzPTmEN4wikwF71y9zJkeO6rutwIVC59m8YOkxJrbsOPNz_9nD_9eH-K2hGBazhkupDKfCqIWXuZJm6f0ylPDOoNHTsS6nr_BkAAP__3jX29A==

#
# Set a relevant session variable to a non-default value and ensure it shows up
# in the environment dump.
#

statement ok
SET reorder_joins_limit = 63

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0leFO40YQxz_jpxjlS6DCxk44hBLxIQRzTS8YFJvrnRBabdZj2GLv5nbXuaRVpXsIXqUv0EfhSaq1UQjUKb3eNR8ieTzzm__O_idxXXiPSnMpejCU7E5Jym5PjgEXyKYlz1NUYFAbmNdZjhOHCaTU0CnVCEfQtm_bfQDXhRQzWuYG5jQvsQd1KtdGf8rhCGSWNabR0sj1VPJZqrsCCws_2G9GH-zDGT-uqrhIcUF-kVwQbRTSAhWZUsNuiea_VgoPPb-Zcuj5LzAKmSwKFCk1XApNUNBpjuk_qJeiKq_6K6QpKvJcETV4s3yhaH-Tov01RetIIYlUKSoubjYxO5uYnQ3M14CBvwEY-D68ewTOFM6owpRoQw0WKIwmjLJbXGE2QHyoAQorHdW4NMl5wQ0cwUG3-cJq-w3Hl3ESTiAOk2QUvYUMqSkVenNkRj7O33u6urZRJTaryGiusZGpP-UeU-mUcGFQCZp7xvKIkp-rs3JtONMe1URmxPCiOqsb_PmHbu7kBr7e2OgxV3tP29KWWdZMWu1LE8lK055NKajhjDCZ58ismdcHUh27mW5n9V_oReV2Wk9I2yZvmhu88f1X-JlUyKg2-vtJ1kttsCDVFWpiD1DHv0ODObLacCkaVAUXlTNIxhflTH-NC53LOKx-a_vOcBIOkhCSwfE4hFk5zTnzFrDtbFEYRckhROcJRJfj8a6zNX2M1E_D8yhOJoNRlMCCzO5wCReT0dlg8hHehR9hm8IgHu7sOluj6CT8AAsyJTxdwPa0ijs7_b7jDMb2hHVrq8Zb9R9FP4XDBOJkkIziZDSMoX3lAAD8Vn3bT4vOb6rNb_XA330KM5mXhdCtHlytgnV-a_V8vZ6vkBpMCTWtHrQ6fnDo-oHrB-AHPd_v-X5rLdkuDRfMECZLYQsCf733LddGWqsSs5xZYa31Yp7agrWAKPN8RVrn2M1fdeh0g063evf77rfOYPq_zKBS-HVj6HzLGJzrdv81Dy-th8u_eXi-ycPLBg-Xzz28JPPaw_N_4eFlo4et8M0Vg5MTeCZpTjIr6vR8Eo7eRrWo-Q5MwtNwEkbDMH6xNtt0p-844YeL8WAUwfb5RbILYfR-B-JwbLX8AKeT8zNYws8_hpMQSjiCbt9xXdd1NKMClg483N8_3H95uP8CTAr7d82F6cFe0IOrvS64sNe9dv4KAAD__4hm668=

# Make sure it shows up correctly even if it matches the cluster setting.
statement ok
SET CLUSTER SETTING sql.defaults.reorder_joins_limit = 63


query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0llFO40gTx5_xKUp5CXzCxk4YhBLxEIKZLzvBoNjMzgihVqddhl5sd6a7nUl2tdIcgqvsBfYonGTVNgqGtYednVkekFyu-tW_y_9qxbbhPUrFRT6AsWB3UlB2e3IMuEI2L3gaowSNSsOyyrKs0I8gpprOqUI4gq552x0C2DbEmNAi1bCkaYEDqFK50upTCkcgkqQxjRZa1FPJZyHvMswM_GC_GX2wD2f8uKzieYwr8ovgOVFaIs1QkjnV7JYo_mup8NBxmymHjvsCI5GJLMM8ppqLXBHM6TzF-CvqRV6Wl_0l0hglea6IarxZv1C036Zov6aojswFETJGyfObNmavjdlrYb4G9NwWoOe68O4RuJC4oBJjojTVmGGuFWGU3eIG0wJxoQJILHWU41Ik5RnXcAQH_eYPVtlvPL0MI38GoR9Fk-AtJEh1IdFZItPicf7O06frallgs4qEpgobmepT6jAZzwnPNcqcpo42PCLF5_KsXGnOlEMVEQnRPCvPant__qGaO9meq1obPeYq52lbuiJJmkmbffkqqXmu3YN-yyq0Es1hlWOaZlRzRphIU2RmPeojLgfZjDbT_zf0rNwfWs1cmSZvmhu8cd1X-ImQyKjS6sdJVmulMSOlKRQxB6jiP6DBElll4Rg1yoznpddIwlfFQn2Lr63L0C9v76E1nvmjyIdodDz1YVHMU86cFWxbWxQmQXQIwXkEweV0umttzR8j1dP4PAij2WgSRLAiiztcw8VscjaafYR3_kfYpjAKxzu71tYkOPE_wIrMCY9XsD0v49bOcGhZo6k5YdXaqHE2_SfBT_44gjAaRZMwmoxD6F5ZAAC_lf_NX4cub8q7pDMAd_cpzERaZLnqDOBqE6zyO5vn63q-RKoxJlR3BtDpud6h7Xq264HrDVx34LqdWrJZQ54zTZgoclPgufXet1xpYaxK9HphhHXqxTw2BbVAXqTphlTnmLtk06HX93r98t3vu987g_l_MoNS4beNofc9Y7Cuu8PXPLw2Hi7-5uFlm4fXDR4unnt4TZaVh5f_wMPrRg8b4e0Vo5MTeCZpSRIj6vR85k_eBpWo5Q7M_FN_5gdjP3yxNtt0Z2hZ_oeL6WgSwPb5RbQLfvB-B0J_arT8D05n52ewhp__7898KOAI-kPLtm3bUozmsLbg4f7-4f7Lw_0XYCI3PwB4rgew5w3gaq8PNuz1r62_AgAA__88OQYo

statement ok
SET enable_zigzag_join = true

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VtFO20gUfa6_4iovgRU2dkIRSsRDCKabbTAoNt1WCI0m4zHMYs-kM-M0YbVSP4Jf2R_YT-FLVjNGwXTtst12eUDy-N5zzj0-dxTXhXdUKib4AMaC3EqByc3xEdAVJfOS5SmVoKnSsKyqHCcOE0ixxnOsKBxC17ztDgFcF1Ka4TLXsMR5SQdQlTKl1cccDkFkWWMZLrWol6JPQt4WtDDg-3vN0Pt7cMqObBfleJ5TdMeu7_A1-k0wbrh4Y5vIMtvDeEpXthYpLSkuqERzrMkNUuzOTnXg-c3MB56_oa5gJCWiKChPsWaCK1QJSr8yseC23fJLilMq0XNFWNPr9ReK9toU7dUU1SG5QEKmVDJ-3YbZa8PstWC-BBj4LYCB78PbR8CFpAssaYqUxpoWlGuFCCY3dAPTAuJDBSCp1WHtUihnBdNwCPv95g9WRXY8vYiTcAZxmCST6A1kFOtSUm9JiRaP_ntPn66rZUmbVWQ4V7QRU33MPSLTOWJcU8lx7mmbTSk-2VmZ0owoDyskMqRZYWd1g7_-VM1MbuCrVqLHWuU9bVhXZFkz0mbHvorU7Gt3v9-yCq2IZljlGdICa0YQEXlOiVmPusXWyGZo4_5_QS_s_uDKc2VIXjcTvPb9F_AzISnBSqsfJ1mtlaYFsqFQyAxQnf8AgiUlVYRTqqksGLdZQxlblQv1Lbl2LuLQ3vhDZzwLR0kIyehoGsKinOeMeCvYcl5hmETJAURnCUQX0-mO82r-eFI9jc-iOJmNJlECK7S4pWs4n01OR7MP8Db8AFsYRvF4e8d5NYmOw_ewQnPE0hVsze25sz0cOs5oaiasqI0ab8M_iX4JxwnEySiZxMlkHEP30gEA-N3-N38dvLy2d0lnAP7O0zEReVlw1RnA5eawqu9snq_q9ZJiTVOEdWcAnZ4fHLh-4PoB-MHA9we-36kVmzVknGhERMlNQ-DXuW-Y0sJEFen1wgjr1JtZahpqB7zM8w1SHcfcJRuGXj_o9e27P3a-14P5_-KBVfhtNvS-xwbnqjt8KcNrk-HyHxletmV43ZDh8nmG12hZZXj5LzK8bsywEd7eMTo-hmeSligzok7OZuHkTVSJWm7DLDwJZ2E0DuMv1mYLbw8dJ3x_Ph1NItg6O092IIzebUMcTo2Wn-BkdnYKa_j153AWQgmH0B86ruu6jiKYw9qBh_v7h_vPD_efgQhufgAwrgewGwzgcrcPLuz2r5y_AwAA__9vgxel

statement ok
SET optimizer_use_histograms = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VlFu20YQ_Q5PMdCP7MKkSckxDAn-kGU6VSNThkinCQxjsSKH8tYkV9ldKpKLAjmEr9IL9Cg-SbFLQ5ZTMm6aVB8COJx5783sm5VsG96hkIwXPRjy-FZwGt-cngCuMJ6VLEtQgEKpYFllWVboR5BQRWdUIhxDW79t9wFsGxJMaZkpWNKsxB5UqUwq-TGDY-BpWptGS8W3U8knLm5zzDX44UE99OEBnLMTU4UFnWVI7tj8js7Jb5wVmquoLeNpampYkeDK5BKpBNIcBZlRFd8Qye5MV0eOW8985Lgb6gpGYMzzHIuEKsYLSSpByVc65oUpN_wCaYKCPFdEFc7XXyg6aFJ0sKVoG7LghIsEBSvmTZidJsxOA-ZLgJ7bAOi5Lrx9BOQLxXJ2h4KUEskNk4rPBc3lyxNbCFxQgQmRiirMsVCSxDS-wY2ABnoXKmqBpgMzaEkyljMFx3DYrT_qyuzD8WUY-VMI_SgaBW8gRapKgc4SY8UfT855OvS2EiXWq0hpJrEWU37MnFgkM8IKhaKgmaOMqwX_ZHplUrFYOlQSnhLFctOr7f31p6xnsj1XNhI95krnaTfbPE3rkTbb-VWk-rm2D7sNS9SIqJuVjibNqWIxiXmWYawXa3vEZpD10Hr6_wU9N5tHq5lrK7Zf1xO8dt0X8FMuMKZSyR8nWa6lwpwYU0iiG6jiP4BgiXFl4QQVipwVxmskZatyIb_F19Zl6Jvfir41nPqDyIdocDL2YVHOMhY7K9ixXlEYBdERBJMIgsvxeM96NXuMVE_DSRBG08EoiGBFFre4hovp6Hww_QBv_Q-wQ2EQDnf3rFej4NR_DysyIyxZwc7MxK3dft-yBmPdYUWt1Tgb_lHwiz-MIIwG0SiMRsMQ2lcWAMDv5lt_WnQ5N3dJqwfu3lM45lmZF7LVg6tNsMpvbZ6vt_MFUoUJoarVg1bH9Y5s17NdD1yv57o9121tJes1ZEWsSMzLQhd47ja3uSC1VYlaL7Sw1nYxS3TBVqAos2yDtI2j75INQ6frdbrm3R973zuD2f8yA6Pw28bQ-Z4xWNft_kseXmsPl__w8LLJw-saD5fPPbwmy8rDy3_h4XWth7Xw5orB6Sk8k7QkqRZ1Npn6ozdBJWq5C1P_zJ_6wdAPv1ibHbrbtyz__cV4MApgZ3IR7YEfvNuF0B9rLT_B2XRyDmv49Wd_6kMJx9DtW7Zt25aMaQFrCx7u7x_uPz_cf4aYF_qvAytUD_a9Hlztd8GG_e619XcAAAD__64tK_A=

statement ok
SET optimizer_use_multicol_stats = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VuFO20gQ_o2fYpQ_gRMOTkIRSsSPEEwv12BQbHqtEFpt1uOwh-1Nd9dpwumkPgSvci9wj8KTnHaNQujZpb22-RHJ45nv-2b2m01cF96iVFzkPRgKdisFZTcnx4BLZNOCpzFK0Kg0LMosxwn9CGKq6ZQqhCNomrfNPoDrQowJLVINC5oW2IMylSutPqRwBCJJKtNoocVmKvko5G2GmQE_2K-GPtiHM35sqzCn0xTJHZ_d0Rn5Q_DccOWVZSJJbA3PY1zaXKK0RJqhJFOq2Q1R_M52ddjyqpkPW96auoSRyESWYR5TzUWuSCko_kLHIrflll8ijVGS54qoxtnqM0X7dYr2NxRtQuaCCBmj5PmsDrNTh9mpwXwJsO3VALY9D948Aoq55hm_Q0kKheSGKy1mkmbq5Yk9r8yKVHMmUqI01V9RPZc4pxJjm48Z5loRRtkNruXXiPegFC7R9m-PSZGUZ1zDERx0q41SrspwfBlG_gRCP4pGwWtIkOpCYmuBTIvHc289WaapZYHVKhKaKqzEVB_SFpPxlPBco8xp2tJ2J6T4aHvlSnOmWlQRkRDNM9ur2_7nb1XN5LY9VUv0mKtaT5vdFElSjbTe7S8iVc-1edCtWcFaRGuEliHNqOaMMJGmyMxabo7YDrIa2kz__6Bndm9pOXNjxearaoJXnvcCfiIkMqq0-nGS1UppzIg1hSKmgTL-AwgWyEoLx6hRZjy3XiMJXxZz9S2-di5D3_7S9J3hxB9EPkSD47EP82KactZawrazRWEURIcQnEcQXI7Hu87W9DFSPg3PgzCaDEZBBEsyv8UVXExGZ4PJe3jjv4dtCoNwuLPrbI2CE_8dLMmU8HgJ21Mbd3b6fccZjE2HJbVR01rzj4Lf_GEEYTSIRmE0GobQvHIAAP603-bToIuZvUsaPfB2n8JMpEWWq0YPrtbBMr-xfr7ezJdINcaE6kYPGh2vfeh6bddrg9fueV7P8xobyWYNec40YaLITUHb2-S216uxKtGruRHW2CzmsSnYCORFmq6RNnHMXbJm6HTbna5999fu985g-lNmYBV-2xg63zMG57rZf8nDK-Ph4j8eXtR5eFXh4eK5h1dkUXp48RUeXlV62AivrxicnMAzSQuSGFGn5xN_9DooRS12YOKf-hM_GPrhZ2uzTXf6juO_uxgPRgFsn19Eu-AHb3cg9MdGyy9wOjk_gxX8_qs_8aGAI-j2Hdd1XUcxmsPKgYf7-4f7Tw_3n4CJ3Pzx4LnuwV67B1d7XXBhr3vt_BsAAP__8wxB8Q==

statement ok
RESET reorder_joins_limit

statement ok
RESET enable_zigzag_join

statement ok
RESET optimizer_use_histograms

statement ok
RESET optimizer_use_multicol_stats

#
# Test sequences.
#

statement ok
CREATE SEQUENCE seq

query T
EXPLAIN (OPT, ENV) SELECT * FROM seq
----
https://cockroachdb.github.io/text/decode.html#eJyslM1u2zoQhfd6itn53osrQf53Y2ThuGxh1HZSWw6yI2hqlLCRSJtDOUnfqy_QJyskBYkbSAlaZGeYw--cOZyR78MlWlJGn8DUyFtrhLz5eAZ4j3KbqzRGCw7JwaGq8rw1iyAWTmwFIZxCqzhtjQF8H2JMRJ46OIg0xxOoShU52qdwCiZJastE7sxxKb8z9jbDrIAPevXoQQ8W6qy8pXSM9_ybUZqTsygytHwrnLzhpL6XDkdBWE8ZBeELjEVpsgx1LJwymjhqsU0xfsW90eX1Ut-iiNHy3x0Jh9cPLxz1mhz1jhwdI7XhxsZolb5uYnaamJ0G5lvAdtgAbIchfHkE7izuhMWYkxMOM9SOuBTyBp8wDZAQKoDF0kcZF_FUZcrBKQy69Q9Wjd90vllHbAVrFkWz5WdIULjcYnBA6cxj_sHz07WczbHeRSJSwlom7dNA2njLlXZotUgDV_C4NXdlr4qckhQI4ibhTmVlr3775w-qV_LbITUKPdZS8LwtLZMk9aSnfXmVVJ9ra9BtWIVGYtEsBYVoJpySXJo0RVmsx3HEZZD16CL9v6Fn5f6IKnMqRPr1Av0wfIOfGItSkKP3s0wP5DDj5VAQLxqo_n8HgQPKaoRjdGgzpctZ44m6z3f0J3Ptbdas_HqPvemKTSIGa_Z1w5ZTBrt8myoZEO5hMVteTuYbBm1YTK6qnx86nW532Am7g1G_Nxz2R-EQZsvpii3YMoI2rKPJKoL2eOx57OpiPpkt4Z_zi-h_YMvLf2HN5mwawX_waXW-AML92PN93_cI9zlqiT5h8cjFifcrAAD__120Hzg=

#
# Test views.
#

statement ok
CREATE VIEW v AS SELECT a, b, u, v FROM x, y WHERE b = 3

query T
EXPLAIN (OPT, ENV) SELECT * FROM v
----
https://cockroachdb.github.io/text/decode.html#eJy0ltFu2zYUhq-jpzjwje3BcmQ7DQIbAeY6SufVUQJLSVsEAUFRVMJFIl2SUu0NA4o9Qy73GnuBPUqeZKDkOk4qNeva5SKAqMPv_Pz1Hya2DRdUKib4ECaC3EqByc3RS6BLSsKMJRGVoKnSkJdVluW7AURY4xArCofQNG-bIwDbhojGOEs05DjJ6BDKUqa0ep_AIYg4rizDmRbbpeiDkLcpTQ18f68avb8HJ-xlsYvxiC7RL4JxpLSkOKUShViTG6TYr4XCg65TTTnoOk8wkhKRppRHWDPBFaIchwmNvqBe8GJ70V9SHFGJHivCml6vnijaq1O0t6VoG8kFEjKikvHrOma_jtmvYT4H7Dk1wJ7jwOs1cCHpAksaIaWxpinlWiGCyQ3dYGogDpQASQsdhV0KJSxlGg5hf1D9wcr4TWbnfuDOwXeDYOq9gphinUnazSnRYu1_9-HTNbXMaLWKGCeKVjLV-6RLZBQixjWVHCddbXhIig_FWZnSjKguVkjESLO0OKvd-_svVd3J7jmqttG6VnUfpqUp4riatJmXL5KqfW3uD2pGoZZoDqu6pmmKNSOIiCShxIzHtsWFkdVo4_5_oafF_ODSc2WavKhu8MJxnuHHQlKClVbfT7JaKU1TVIRCIXOAcv07NMgpKSMcUU1lyniRNRSzZbZQX5Nr69x3i9t7ZE3m7jhwIRi_nLmwyMKEke4SWtYOhqkXHIB3GoB3Ppt1rJ1wvVI-TU49P5iPp14AS7S4pSs4m09PxvN38Np9By0MY3_S7lg7U-_IfQtLFCIWLaEVFutWezSyrPHMnLBsbdR0N_2n3s_uJAA_GAdTP5hOfGheWgAAvxW_zU8D59fFXdIYgtN5WCYiyVKuGkO43CyW9Y3N89V2vaRY0whh3RhCo-_0DmynZzs9cHpDxxk6TmOr2Iwh40QjIjJuNvSc7d43TGlhoor0amGENbY3s8hs2FrgWZJsSNscc5dsOvQHvf6gePd751s9CP8XDwqFX2dD_1tssK6ao-cyvDIZzj7LcF6X4VVFhrPHGV6hvMxw_i8yvKrMsBFev2N8dASPJOUoNqKOT-fu9JVXisrbMHeP3bnrTVz_ydi0cLvKmIup--aTL3kx22aaO9ZOZhyx2jD2wXdnRi3uQNiBrAM5HM9PTx7zO0_0vvnJnbsQwiEMjBXu27PZeOpB6_Qs6IDrXbQ_UX8oYfnIsm3bthjnVNrmDxC0iBRKtS24v_vz_u7j_d1HUARzWH22svxxfYeYN3-YHNzf3a0LiODmfxXG9RB2-7u9IVzuDsCG3cGVtVUWs0RTqaBl7se29U8AAAD__wBQSuc=

#
# Test tables in user-defined schemas.
#

statement ok
CREATE SCHEMA s;
CREATE TABLE s.t (a int primary key)

query T
EXPLAIN (OPT, ENV) SELECT * FROM s.t;
----
https://cockroachdb.github.io/text/decode.html#eJyslNFO20oQhq_xU8xd4AhbDoQIEXFhcnyOXIKD4gUVVdVqsx7DFtsbdtYB-l59gT5ZZRtBimxQK27t2e__59-ZdV24RENKl0cw1fLWaCFv_j0BfEC5rFSeogGLZGHdVjlOEjJIhRVLQQjHMKj_DiYArgspZqLKLaxFXuERtKWKLN3lcAw6yzrLRGX1Zim_1-a2wKKGj0fd6PEIztRJc0qVKT7wb1qVnKxBUaDhS2HlDSf1vXF46PndlEPPf4UxKHVRYJkKq3RJHEuxzDF9w70um-ONvkGRouG_OxIWrx9fORr1ORptONpElpprk6JR5XUfc6-PudfDfA849HuAQ9-H0yfgyuBKGEw5WWGxwNISl0Le4DOmB-JDCzDY-GjiIp6rQlk4hvF-94W14zedXSQsXEASMhbF_0OGwlYGvTVKq5_y916ubmBNhd0uMpETdjLpLvekSZdclRZNKXLP1jxu9H3TqyKrJHmCuM64VUXTqzv8-YO6ldyhT71CT7XkvWzLQGdZN-l5X94kdec6GO_3rEIvsW6WvFq0EFZJLnWeo6zXYzPiJshudJ3-39CLZn9EmznVIgfdAge-_w4_0walIEsfZ5keyWLBm6EgXjfQfv8AgTXKdoRTtGgKVTazxjP1UK3oT-bauUjC5vWeONNFGLAQWHAyC4E8C9vOloAoZocQzxnEF7PZrrM1nccJWwRRzMDy1S0-wvkiOgsWV3AaXsG2gCCZ7jg7k4njBLPadsurJbwaGsWfwimDhAUsSlg0TWDw5etg4jjh5_NZEMWwPT9nuxDGlzuQhLO69h_4bzE_qy1NHNd1XYekKME6vwIAAP__ONkjzg==

#
# Test default_transaction_quality_of_service settings.
#

statement ok
SET default_transaction_quality_of_service=background

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyslFFO204Qxt9zinkLSNhyIEQIxAPwj_5CpRQ1AfVtNVmPw5b1LuyMA_SJQ-QqvUCPwkkqrxGkyAa14nU9-_u--XbGSQIXFNh4twtHXl8Fj_ryv0OgO9KzyticAgixwKKp6vUm4ynkKDhDJtiHfv21vweQJJBTgZUVWKCtaBea0uZMSUDHqMV4p24qtEbulS8UU1gYXYNmqK_mwVcub4UFmlcWQ8M0LHxjYR98UbRWYyV-tVTd-nBVUlkbHg3b7Y6G8NkcxlvG5XSnvnvjFEsgLCmoGYq-VGx-xK530qydspNmrzCBtC9LcjnWzbMihzNL-RvuvYvXo34gzCmoPx2h0Pz-laNhl6PhiqNVpPPKh5yCcfMu5mYXc7OD-R5wkHUAB1kGn56A14GuMVCuWFCoJCesNOpLesZ0QDJoAIGijxgXK2tKI7APo632B2tG-ujkfDIdf4XJeDo9Pv0fCkKpAqUL0uKf8k9fnq4voaJ2FwVaplYm39hUh3ymjBMKDm0qNU8Ffxt7NSxGc4pcb4aYMvaaDH795HalZJBxp9BTLacv29L3RdFOet6XN0ntufZHWx2r0Emsm-W0Fi1RjFbaW0vx37AacQyyHV2n_y_0Mu4PNplzLbLdLrCdZe_wCx9IIwt_nGW-Z6FSxaFgVTfQnH-AwIJ0M8I5CYXSuDhrqjB31TX_zVz3xt_OTg6OT2Hty9l0A8anF-twcXByPp7A2mB9r5ckSdKLN7gHj8vl4_LhcfkAa4ON9d7vAAAA__8zyyON

statement ok
SET default_transaction_quality_of_service=critical

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyslEFO40oQhvc-Re0CErYcCBECsQBe9IQej4deAppdq9IuQw_tbugqB5gVh8hV5gJzFE4ychtBBtmgGbFtV3__X39XOU3hggIb73bhyOvr4FFf_XUIdE96XhtbUAAhFli0VUkyncygQME5MsE-DJqvgz2ANIWCSqytwAJtTbvQlrZnSgI6Ri3GO3VbozXyoHypmMLC6AakgxGj0XaiAl3WFkNLNCx8a2EffFl2VmMtfrVU3flwXVHV2B2Pus2OR_CvOYy3jCvoXn31ximWQFhRUHMUfaXYfIs972R5N2Uny99gAmlfVeQKbFpnRQ7nlop33HsXr0f9QFhQUL86QqHLhzeORn2ORiuOVpHOKx8KCsZd9jE3-5ibPcyPgMO8BzjMc_jnGXgT6AYDFYoFhSpywkqjvqIXTA8khxYQKPqIcbGypjIC-zDe6n6wdqCPTs6ns8n_MJ3MZsenf0NJKHWgbEFa_HP-2evTDSTU1O2iRMvUyeRbm-lQzJVxQsGhzaThqeDvYq-GxWjOkJu9EFPFXtPhj-_crZQOc-4Veq7l7HVbBr4su0kv-_IuqTvXwXirZxV6iU2znDWiFYrRSntrKf4ZViOOQXajm_T_hF7F_cE2c25EtrsFtvP8A37pA2lk4c-zzA8sVKk4FKyaBtrzTxBYkG5HuCChUBkXZ02V5r6-4d-Z62Ty5ezk4PgU1v47m23A5PRiHS4OTs4nU1gbru8laZqmSbzBCTwtl0_Lx6flI6wNN9aTnwEAAP__7hoiuA==

#
# Test recursive table references from foreign keys.
#

statement ok
CREATE TABLE z (
  pk INT PRIMARY KEY,
  ref INT,
  CONSTRAINT fk FOREIGN KEY (ref) REFERENCES y(u),
  FAMILY "primary" (pk, ref)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM z;
----
https://cockroachdb.github.io/text/decode.html#eJy0leFO20gQxz_XTzHKlyQnbDmBIpSIDyGYKtdgUGyqVlW12qzHsBfbG3bXbpLTPda9wD3ZaW0UDLULvfb4gOTx7G_-M_7PxrbhA0rFRTaCqWArKSi7Oz8D3CBb5jyJUIJGpaGosiwr8EKIqKZLqhBOoWvedscAtg0RxjRPNBQ0yXEEVWoVI1rSTFGmucjIfU4TrrdExEShLDgzICa55owmjSiJt3lCZUXkSqv7BE5BxHFjNs21qKeSr0KuUkyN3OOjZrHHR3DJz8pTPItwQ_4QPCNKS6QpSrKkmt0RxXdlzyeO20w5cdxnGIlMpClmETWtK4IZXSYYfUe9yMrjZX2JNEJJniqiGm-3zxQdtSk6qimqIzNBhIxQ8uy2jTlsYw5bmC8BB24LcOC68P4BuJa4phIjojTVmGKmFWGU3eEe0wJxoQJILHWU41Ik4SnXcArHh80frDL0dH4ThN4CAi8MZ_47iJHqXKJTINPiYf7O46frapljs4qYJgobmeo-cZiMloRnGmVGE0cbHpHia9krV5oz5VBl9kLztOzVHvzzt2quZA9c1VroIVc5j9vSFXHcTNrvy3dJzXPtHh-2rEIr0TSrHFM0pZozwkSSYHkz1EdcDrIZbab_X-hpuT-0mrkyRd42F3jrui_wYyGRUaXVr5OstkpjSkpTKGIaqOK_oECBrLJwhBplyrPSayTmm3ytfsTX1k3glb8HY2u68CahB-HkbO7BOl8mnDkb6FlvKMz88AT8qxD8m_n8wHqzfIhUT9MrPwgXk5kfwoasV7iF68XscrL4BO-9T9CjMAmm_QPrzcw_9z7ChiwJjzbQW5Zxqz8eW9ZkbjqsShs1zr7-zP_dm4YQhJNwFoSzaQDdzxYAwJ_lf_PXocVteZd0RuAePIaZSPI0U50RfN4Hq_zO_vlLPV8i1RgRqjsj6AzdwYntDmx3AO5g5Loj1-3Uks0a8oxpwkSemQMDt177jistjFWJ3q6NsE79MI_MgVogy5NkT6pzzF2yrzA8HAwPy3d_HfzsDJb_ywxKhT82huHPjMH60h2_5OGt8XD-jYeLNg9vGzycP_XwlhSVh4tXeHjb6OFXCN8Z4evVN8olxm3adw3a16tXiNy1imxva3J-Dk_mVpDYVL-4Wnizd35VvejDwrvwFp4_9YJnu92j_Xb-7jk_Xj0lS4xb2Vvo5f2xZXkfr-eTmQ-9q-vwADz_Qx8Cb276_A0uFleXsBtbtm3blmI0g531bwAAAP__I3Jc3g==

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0leFO20gQxz_XTzHKlyQnbDmBIpSIDyGYKtdgUGyqVlW12qzHsBfbG3bXbpzTPda9wD3ZaW0UArULvfb4gOTx7G_-M_7PxrbhA0rFRTaCqWArKSi7Oz8D3CBb5jyJUIJGpaGosywr8EKIqKZLqhBOoWvedscAtg0RxjRPNBQ0yXEEdWodI1rSTFGmucjIfU4TrksiYqJQFpwZEJNcc0aTRpTE2zyhsiZypdV9Aqcg4rgxm-Za7KeSr0KuUkyN3OOjZrHHR3DJz6pTPItwQ_4QPCNKS6QpSrKkmt0RxbdVzyeO20w5cdxnGIlMpClmETWtK4IZXSYYfUe9yKrjVX2JNEJJniqiGm_LZ4qO2hQd7SnaR2aCCBmh5NltG3PYxhy2MF8CDtwW4MB14f0DcC1xTSVGRGmqMcVMK8Iou8MdpgXiQg2QWOmoxqVIwlOu4RSOD5s_WG3o6fwmCL0FBF4Yzvx3ECPVuUSnQKbFw_ydx0_X1TLHZhUxTRQ2MtV94jAZLQnPNMqMJo42PCLF16pXrjRnyqHK7IXmadWrPfjnb9VcyR64qrXQQ65yHrelK-K4mbTbl--SmufaPT5sWYVWomlWOaZoSjVnhIkkwepm2B9xNchmtJn-f6Gn1f7QeubKFHnbXOCt677Aj4VERpVWv06yKpXGlFSmUMQ0UMd_QYECWW3hCDXKlGeV10jMN_la_YivrZvAq34PxtZ04U1CD8LJ2dyDdb5MOHM20LPeUJj54Qn4VyH4N_P5gfVm-RCpn6ZXfhAuJjM_hA1Zr7CE68XscrL4BO-9T9CjMAmm_QPrzcw_9z7ChiwJjzbQW1Zxqz8eW9ZkbjqsSxs1zq7-zP_dm4YQhJNwFoSzaQDdzxYAwJ_Vf_PXocVtdZd0RuAePIaZSPI0U50RfN4F6_zO7vnLfr5EqjEiVHdG0Bm6gxPbHdjuANzByHVHrtvZSzZryDOmCRN5Zg4M3P3ad1xpYaxKdLk2wjr7h3lkDuwFsjxJdqR9jrlLdhWGh4PhYfXur4OfncHyf5lBpfDHxjD8mTFYX7rjlzxcGg_n33i4aPNw2eDh_KmHS1LUHi5e4eGy0cOvEL41wterb5RLjNu0bxu0r1evELltFdne1uT8HJ7MrSCxqX5xtfBm7_y6etGHhXfhLTx_6gXPdrtH--387XN-vHpKlhi3skvo5f2xZXkfr-eTmQ-9q-vwADz_Qx8Cb276_A0uFleXUI4t27ZtSzGaQWn9GwAA__8jYVzc

query T
EXPLAIN (OPT, ENV) SELECT * FROM x;
----
https://cockroachdb.github.io/text/decode.html#eJy0leFO20gQxz_XTzHKlyQnbDmBIpSIDyGYKtdgUGyqVlW12qzHsBfbG3bXbpLTPda9wD3ZaW0UDLULvfb4gOTx7G_-M_7PxrbhA0rFRTaCqWArKSi7Oz8D3CBb5jyJUIJGpaGosiwr8EKIqKZLqhBOoWvedscAtg0RxjRPNBQ0yXEEVWoVI1rSTFGmucjIfU4TrrdExEShLDgzICa55owmjSiJt3lCZUXkSqv7BE5BxHFjNs21qKeSr0KuUkyN3OOjZrHHR3DJz8pTPItwQ_4QPCNKS6QpSrKkmt0RxXdlzyeO20w5cdxnGIlMpClmETWtK4IZXSYYfUe9yMrjZX2JNEJJniqiGm-3zxQdtSk6qimqIzNBhIxQ8uy2jTlsYw5bmC8BB24LcOC68P4BuJa4phIjojTVmGKmFWGU3eEe0wJxoQJILHWU41Ik4SnXcArHh80frDL0dH4ThN4CAi8MZ_47iJHqXKJTINPiYf7O46frapljs4qYJgobmeo-cZiMloRnGmVGE0cbHpHia9krV5oz5VBl9kLztOzVHvzzt2quZA9c1VroIVc5j9vSFXHcTNrvy3dJzXPtHh-2rEIr0TSrHFM0pZozwkSSYHkz1EdcDrIZbab_X-hpuT-0mrkyRd42F3jrui_wYyGRUaXVr5OstkpjSkpTKGIaqOK_oECBrLJwhBplyrPSayTmm3ytfsTX1k3glb8HY2u68CahB-HkbO7BOl8mnDkb6FlvKMz88AT8qxD8m_n8wHqzfIhUT9MrPwgXk5kfwoasV7iF68XscrL4BO-9T9CjMAmm_QPrzcw_9z7ChiwJjzbQW5Zxqz8eW9ZkbjqsShs1zr7-zP_dm4YQhJNwFoSzaQDdzxYAwJ_lf_PXocVteZd0RuAePIaZSPI0U50RfN4Hq_zO_vlLPV8i1RgRqjsj6AzdwYntDmx3AO5g5Loj1-3Uks0a8oxpwkSemQMDt177jistjFWJ3q6NsE79MI_MgVogy5NkT6pzzF2yrzA8HAwPy3d_HfzsDJb_ywxKhT82huHPjMH60h2_5OGt8XD-jYeLNg9vGzycP_XwlhSVh4tXeHjb6OFXCN8Z4evVN8olxm3adw3a16tXiNy1imxva3J-Dk_mVpDYVL-4Wnizd35VvejDwrvwFp4_9YJnu92j_Xb-7jk_Xj0lS4xb2Vvo5f2xZXkfr-eTmQ-9q-vwADz_Qx8Cb276_A0uFleXsBlbtm3blmI0g431bwAAAP__I1Bc2g==

# A foreign key cycle shouldn't cause infinite recursion.
statement ok
ALTER TABLE y ADD CONSTRAINT fk FOREIGN KEY (v) REFERENCES z (pk);

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0leFO20gQxz_jpxjlS5ITtpxAEUrEhxBMlWswKDZVq6pabdZj2IvtDbvrNOZ0j3UvcE92WhsFQ-0C1x4fkDye_c1_xv_Z2DZ8RKm4yEYwFWwlBWW3Z6eAW2TLnCcRStCoNGyqLMsKvBAiqumSKoQT6Jq33TGAbUOEMc0TDRua5DiCKrWKES1ppijTXGTkLqcJ1wURMVEoN5wZEJNcc0aTRpTEmzyhsiJypdVdAicg4rgxm-Za1FPJNyFXKaZG7tFhs9ijQ7jgp-UpnkW4JX8InhGlJdIUJVlSzW6J4vdlz8eO20w5dtxnGIlMpClmETWtK4IZXSYY_UC9yMrjZX2JNEJJniqiGm-KZ4oO2xQd1hTVkZkgQkYoeXbTxhy2MYctzJeAA7cFOHBd-PAAXEtcU4kRUZpqTDHTijDKbnGHaYG4UAEkljrKcSmS8JRrOIGjg-YPVhl6Or8OQm8BgReGM_89xEh1LtHZINPiYf7O46frapljs4qYJgobmeoucZiMloRnGmVGE0cbHpHiW9krV5oz5VBl9kLztOzVHvzzt2quZA9c1VroIVc5j9vSFXHcTNrtyw9JzXPtHh20rEIr0TSrHFM0pZozwkSSYHkz1EdcDrIZbab_X-hpuT-0mrkyRd41F3jnui_wYyGRUaXVr5OsCqUxJaUpFDENVPFfUGCDrLJwhBplyrPSayTm23yt3uJr6zrwyt-DsTVdeJPQg3ByOvdgnS8Tzpwt9Kw9CjM_PAb_MgT_ej7ft_aWD5HqaXrpB-FiMvND2JL1Cgu4WswuJovP8MH7DD0Kk2Da37f2Zv6Z9wm2ZEl4tIXesoxb_fHYsiZz02FV2qhxdvVn_u_eNIQgnISzIJxNA-h-sQAA_iz_m78O3dyUd0lnBO7-Y5iJJE8z1RnBl12wyu_snr_W8yVSjRGhujOCztAdHNvuwHYH4A5Grjty3U4t2awhz5gmTOSZOTBw67VvudLCWJXoYm2EdeqHeWQO1AJZniQ7Up1j7pJdheHBYHhQvvtr_2dnsPxfZlAqfNsYhj8zButrd_ySh--Nh9er70wsMW6z8X2DjderV_j1vtGvrxBZGJH5dxo3bQqLBoX500UryKZatM0rhBetwttbnZydQU1SvILzy4U3e-9XciTGfVh4597C86de8KxcL--3s4vnbNNLbBp-UmHTyt9Cj76F_1x7O_neOKE_tizv09V8MvOhd3kV7oPnf-xD4M3NCH-D88XlBRRjy7Zt21KMZlBY_wYAAP__DEB38Q==

# Check that we remove histograms from statistics correctly.

statement ok
CREATE TABLE b (
  b BOOL NOT NULL,
  INDEX (b)
)

statement ok
ALTER TABLE b INJECT STATISTICS '[
      {
          "id": 1,
          "avg_size": 1,
          "columns": [
              "b"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 2,
          "histo_buckets": [
              {
                  "distinct_range": 0,
                  "num_eq": 1000,
                  "num_range": 0,
                  "upper_bound": "false"
              },
              {
                  "distinct_range": 0,
                  "num_eq": 100,
                  "num_range": 0,
                  "upper_bound": "true"
              }
          ],
          "histo_col_type": "BOOL",
          "histo_version": 2,
          "name": "__auto__",
          "null_count": 0,
          "row_count": 1100
      },
      {
          "id": 2,
          "avg_size": 0,
          "columns": [
              "rowid"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 0,
          "histo_col_type": "",
          "name": "__auto__",
          "null_count": 0,
          "row_count": 0
      }
]'

query T
EXPLAIN (OPT, ENV) SELECT * FROM b
----
https://cockroachdb.github.io/text/decode.html#eJy0leFO4zgQxz-Tpxj1S-FEojQUjm3Fh1Kyp9yWFjUB7Wq1shxnCj4Su9hOgTvdY90L3JOd7LClh1L29sT2Q6WOx7_5--8Z1_fhCpXmUgxgLNmtkpTdnJ0CPiDLa14WqMCgNrBqsjwvjTMoqKE51Qgn0LWr3SGA70OBC1qXBla0rHEATWoTI0ZRoSkzXApyV9OSm0ciF0SjWnFmQUxxwxktW1EKr-uSqobItdF3JZyAXCxas2lt5GYquZfqtsLKyj3qt4s96sM5P3W7uCjwgfwmuSDaKKQVKpJTw26I5r-7Mx8HYTvlOAhfYBQyWVUoCmqPrgkKmpdYvKJeCrfd1VdIC1Tk34qowevHF4r62xT1NxRtIoUkUhWouLjexoy2MaMtzG8Be-EWYC8M4cMTcKlwSRUWRBtqsEJhNGGU3eAaswUSQgNQ6HQ4uzQpecUNnMDRQfuFNQ09nlymWTyHNM6yZPoLLJCaWmGwQmbkk__B89V1jaqxXcWClhpbmfquDJgqcsKFQSVoGRjLI0reu7NybTjTAdV2Lgyv3Fn93t9_6fZKfi_UWws95ergeVq6crFoJ63n5VVSu6_do4Mto7CVaA-rA1u0ooYzwmRZonsZNi12Rrajrfv_h165-aGN59oWOWwvcBiG3-AvpEJGtdFvJ1k_aoMVcU2hiT1AE3-DAitkTQsXaFBVXLheIwv-UC_19_S1d5nG7v9g6I3n8SiLIRudTmJY1nnJWZDDrreTw-lsNoHpLIPp5WSy7-0oec8LSKbZsYteJWliN33NgLP4_ehykkEt-F3tLocXu3v73s54Nk2z-SiZZpCT5S0-wsU8OR_NP8GH-BPsNtxROra5yfQs_gg5yQkvHmA3d3Fvbzj0vNHEGtIoteKDtdxk-ms8ziDNRlmSZsk4he5nDwDgD_dtPx26unZPT2cAvf3nMJNlXQndGcDnddAt5J317y-b-QqpwYJQ0xlAJwqjyO9FfhhB73hw0B9E74LDn_vvDqLOxh47vFwwQ5ishd0XbSzecG2kbW9iHpdWXWdzKy9e6BW0cknEtRYhm8miLst1jXBjwb5NX-O9Xhi6lT_3X7Eo_C8WuYv7gTaF32dT9JY2PXnkfekOPS_-eDEZJVPYnV1k-xBPr_YgjSe25X6C9_PZOeRDz_d939OMCsi9fwIAAP__qQPjBA==
