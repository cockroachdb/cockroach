# LogicTest: local !metamorphic-batch-sizes
# We must turn off metamorphic variables because some are included in
# EXPLAIN (OPT, ENV) output.

statement ok
CREATE TABLE x (
  a INT PRIMARY KEY,
  b INT,
  INDEX (b),
  FAMILY "primary" (a, b)
)

statement ok
ALTER TABLE x INJECT STATISTICS '[
  {
    "columns": ["a"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 100,
    "histo_col_type": ""
  },
  {
    "columns": ["b"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 123123,
    "histo_col_type": ""
  }
]'

statement ok
CREATE TABLE y (
  u INT PRIMARY KEY,
  v INT REFERENCES x,
  INDEX (v),
  FAMILY "primary" (u, v)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM x WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VuFu2zYQ_l09xcF_mg52I8f7ETgoMNfVMG-uU9hq1yAICEo6yVwokiEpx8kwoA-RJ8yTDKSUxB0iq8VQ_zAs-r67491332kwgE-oDZNiDFOZXmpJ0_W7t4BbTJOK8Qw1WDQWNrVVEAwGQDmX10RpVFQjoYZIZYniVMCaGrBrhAxzWnELG8orHIPMc4dLpbHEpFQYcs3smjRWJJWcGHaLHfCMukxueKvdbHXah_fvzrxx45sJu9f38a6x1VQYmlomBVGaSc3sTRtQSF1S3oa-qihn9obInBjUG5a2JqCxqDjVbY400oxIwVvzeCjOM9jKIMmlaxZq78h0OWEaU9-PqhRUN71CQROOWSfW1LzIK86JdZAavw-3imIHtOaKwxt3cgLwdJkHS1pZ6ULUiRBWKs5SZolB7tLNpSaVcuxoDSWeg--WyvlIqE3XxFhqsURh2xP_ypswqC3JqbFEUbv-JlBZccuU-yEzlrOUuhyMI4uvW0elGye3rLilBflLsva5q4NulSsTFRlhhZAaiZCWbJhhzk3dbEOYIKlUXTRjwqLeUL53DpU0ttBoHIBTXWDNCccGouV1a2GHYRh6jEyb6VGWlewWM6KotsxVCTPCRIZb723_vYULKnWGGjPCqbEdd3MT42lENK5liS7XTvL7SE7_jOKsVjfCWclagx2FPx83GH833YypxpSaLtJ9DVozY2WhafldKE8-L7mWfl-8Xdr4JmCXoKiCWF2Urw0rGadOToldazRryVtLGr4eeajGHDXhUl5WyrPc-CnNLzuDaqlo4frIhKpsTQEmig6YRm_YhNrbQ99Ac8WJoTk2pOnKyu0uJgryVFK_DhVqW-nEK0BrRZ7HO8V1rdAVR6K0TGjC-J6N1eJGU5HJkhhsZ3mNZCXeStE69R_jqTOrRCqFsZoyN6tCOlnZ-PrvDO437pQNplbqfW8GIgimy2gSRxBP3s4jUFXCWfp6CwfBCwqzRXwMi9MYFh_n837wImlO6qfp6WIVLyezRQxboi7xBj4sZ-8nyzP4IzqDAwqT1fRVP3gxW7yLPsOWJIRlWzhI_Hnw6iQIJvM4Wv438mzxezSNYRVP4tkqnk1X8PI8AAD423-7T49uCv9W0htD2H86brS4N4bzx8Pavvf4fLFrr5FazAi1vTH0jsLh8SAcDsIhhMNxGI7DsLdj7PYsE369V8IBhuFubC8m_lXM3iiXWG8X7LX0AbgLcxr56PBoNDwa-f_-6f_fKyc_5Mo-wx936-Di5UkQRJ8_zCezBRycfoj7EC0-vYJVNHek-Al-XZ6-hy38-Vu0jCCBNzA6CQaDwSDw-2z7S0OzAO7v7u7vvtzffYHHebJjODw6HI7h_HAEAzgcXQT_BgAA__9Fnu46


statement error ENV only supported with \(OPT\) option
EXPLAIN (ENV) SELECT * FROM x WHERE b = 3

#
# Multiple Tables.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x, y WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3dQa7kZNdBA4KzHXVzVvqFLbatSgKgpaOZC4UqR5Srp1hQLFnyOWeLk8ykFISZ43sFkNzEdj0953f7xyy34c3SEZoNYSxTi5I82T5_BngGpNFJWSKBBaNhVWNCoJ-H7iU-hMrCUtOyLhhurSslFzBkhuwS4QUM15JCysuKxyCzjLHS7SxzCRcGfZJ2CVrUCzRkhlxiXvoKXeRbGQrbjI_78HL5-88uLEtlN1p-2QbbIkrwxMrtGIlCU3CbtqISlPBZRv7Y8WlsBumM2aQViJpDYAwrySnNkOEPGVaydY4borzALcyyDLtmoXkDZl9RgRh4vtRFYpT0ytUfCEx3cs1tS6ySkpmHaXm7-LNo9gRrfko4ak7OQW4S-YGySurnYs6ECaKUopEWGZQunAzTawqnTpaXamH6NulcjYW3CZLZiy3WKCy7YHfs6YMkmUZN5aV3C6_ilRU0orSfdCpyETCXQzGicXXbU-lGyOXIr_kOftDi_a5q52uS1cmrlImcqUJmdKWrYQRzkzdbMOEYoku98lMKIu04nLnHJba2JzQOILklGOtCacGRvpTa2EHYRh6jk6a6SmtKMQlpqzkZIWrEqZMqBTX3truvJVzqilFwpRJbuye3NzEeBkxwqUu0MW6V_zek9t_ppSi3m5MikK0OjsKfzxpOD43asaUMOFmn-juk5bCWJ0TL76J5cXnV67l3-ZvWza-CbhvoZQ5s5QXT4wohORunTK7JDRLLVtLGj459lTCDIlJrS-q0qvc-CnNLvY6JV3y3PVRqLKytQSEyvfQCD2wcbWzh76B5qNkhmfYiGZfVO7uEipndyX112GJZCta-A3QWpGH-W7julZQJZGVpBd8IeSOG6vFDHGV6oIZbFd5zRQFXmrVOvWv47GDVSrRyljiws2q0m6trHz9twb3K--UFSZW066XgQqC8SwaxRHEo2dnEZTVQorkyRq6wSMOk2l8AtPzGKavz856waNFc1J_G59P5_FsNJnGsGblBW7g1WzycjR7B79F76DLYTQfH_SCR5Pp8-gtrNmCiXQN3YU_Dw5Og2B0Fkez_3qeTH-NxjHM41E8mceT8Rwevw8AAP70_91fh69y_yrpDCHs3R03u7gzhPe3hzW-c_v9wzaekFtMGbedIXSOwsFJPxz0wwGEg2EYDsOwswV296xQ_nqvlCMMwm3ffpn4p5jdlC6wzjbZ79Ib4jbN7chbg0fHg6Nj_9tfvf-b8uK7pOwj_H5ZBx8enz6syI1TZPWFIldtitw8oMjqRpH3cCuWOeSL81k0-XlaI1cHMIteRLNoOo7mt9Ls8js5O56X82qnnDcPytlnGb19dTaaTKF7_iruQTR9cwDz6Mxhf4AXs_OXsO7BBn7_JZpFsICncHwa9Pv9fiCUQur7Z0s3IW3MQQDXV_9cX32-vvoM_lrffHGy_qmZP_fL367W11dXDeB239ghHB4dDobw_vAY-nB4_CHYgmVCWiQDXUsVHgT_BgAA__9dJVGE

#
# Same table twice should only show up once.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x one, x two
----
https://cockroachdb.github.io/text/decode.html#eJy0Vs1u2zgQPldPMfClzsIu5HQPgYMeXNcLeNd1ClstWhQFQUsjmRuKZIeU42SxQB8ix326PsmClJK4i8hqsagPhkTON7_fzGg4hHdIVmg1hqlOL0nzdPvqJeAe000lZIYEDq2DXS0VRcMhcCn1FTOEhhMybpk2jhnJFWy5BbdFyDDnlXSw47LCMeg897hUW8dsypVlV8JtWSPFUi2ZFTfYAc-49-RatsrN1xcDeP3qQxBudAvljuo-OxR2xJXlqRNaMUNCk3DXbUClqeSyDf254lK4a6ZzZpF2Im11gLCoJKc2RYQ8Y1rJVj_ukvMItrLIcu2LhRQU2S4lgjAN9ahKxampFSq-kZh1Ym3Ni7ySkjkPqfHHcOtZ4oHOfpbwwp-cAzwEcyfJK6e9idoRJkojRSocsyi9u7kmVhnPjlZT6jH4Yaq8jg136ZZZxx2WqFy7499oUxbJsZxbxwx32-8ClZV0wvgHnYlcpNz7YD1ZQt46Mt0ouRHFDS_Yn1q0911tdG98mrjKmCiUJmRKO7YTVng1dbEtE4ql2nTRTCiHtOPyaB8abV1BaD1Aciqw5oRnAyN91ZrYURzHAaPTpnuME6W4wYwZTk74LGHGhMpwH7Qdj1t5o5oyJMyY5NZ1xOY7JtCIEW51id7XTvIHS37-WSNFPd2YFKVoNXYa_3rWYEJs1LQpYcptF-m-BW2FdbogXv4QKpAvjFzHf8zeIW1CEbBroJiCOSrKZ1aUQnI_TpnbEtqtlq0pjZ89D1DCHIlJrS8rE1huQ5fml51GSRte-DoKZSpXU0CoogNGGAQbU0drGApoP0tmeY4Nabq88rtLqII9pDSsQ4PkKtqECdCakcfxfuL6UlAlkRnSG74R8sjGalFDXGW6ZBbbWV4jRYk3WrV2_dtk6sUqlWplHXHhe1VpP1Z2If8HjfudO2WHqdN07MtARdF0NZskM0gmLxczMNVGivTZHvrREw7zZXIGy4sElm8Xi0H0ZNOc1G_Ti-U6WU3mywT2zFziNbxZzV9PVh_gj9kH6HOYrKcng-jJfPlq9h72bMNEtof-JpxHJ-dRNFkks9V_Lc-Xv8-mCayTSTJfJ_PpGp5-jAAA_gr__tfjuyJ8lfTGEA8ejptZ3BvDx_vDWr53__7pUJ6QO8wYd70x9E7j0dkwHg3jEcSjcRyP47h3IOz3rFBhvVfKA0bxoe0wTMKnmLs23rHeITjM0jvgIczPyHuFp89Hp8_D3d-D_xvy5qeEHDz8eVFHn56eR9Hs_ZvFZL6E_sWbZACz5bsTWM8WnhS_wG-ri9ewh8katMJB_eSu9Hk0HA6HkVAKaRhWej8lbe1JBF9v__l6--Xr7RcIK28PH7l9oRV-arlyVzpc3TZXuZAOyULfUYUn0b8BAAD__8HaBr0=

#
# Set a relevant session variable to a non-default value and ensure it shows up
# in the environment dump.
#

statement ok
SET reorder_joins_limit = 63

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt9u27YXvq6e4sA3TX6wWzn-YQgc9MJ11c2baxe22rUoCoKWjmQuFMmSlGJnGNCHyBPmSQZSTuJsltViqC8Miz7f-fudj-r14D1qw6QYwlgml1rSZP3qJeAGk1XJeIoaLBoLVW0VBL0eUM7lFVEaFdVIqCFSWaI4FbCmBuwaIcWMltxCRXmJQ5BZ5nCJNJaYhApDrphdk50VSSQnhl1jCzylLpMtb7SbLOddePPqozfe-WbCHvV9vm9sNRWGJpZJQZRmUjO7bQIKqQvKm9BfSsqZ3RKZEYO6YkljAhrzklPd5EgjTYkUvDGPu-YcwJYGSSbdsFB7R6bNCdOY-HmUhaB6NysUdMUxbcWamhdZyTmxDlLjj-GWUeyA1nzh8MKdXAA8FHNnSUsrXYg6EcIKxVnCLDHIXbqZ1KRUjh2NocQh-H6rnI8VtcmaGEstFihsc-KPvAmD2pKMGksUtetvAhUlt0y5HzJlGUuoy8E4svi-tXR65-Sa5dc0J39I1rx3ddCNcm2iIiUsF1IjEdKSihnm3NTDNoQJkkjVRjMmLOqK8qN7qKSxuUbjAJzqHGtOODYQLa8aG9sPw9BjZLLbHmVZwa4xJYpqy1yXMCVMpLjx3o7XLVxQqVPUmBJOjW2pzW2MpxHRuJYFulxbye8jOf0zirNa3QhnBWsMdhb-_3yH8bXp3ZpqTKhpI91j0JoZK3NNi-9CefJ5ybX0--Lt08YPAdsEReXE6rx4ZljBOHVySuxao1lL3tjS8NnAQzVmqAmX8rJUnuXGb2l22RpUS0VzN0cmVGlrCjCRtwmRRm-5i1UP8QX8NDioSX6G5gsnhma4401bYu76YiInD131N6JCbUu98iLQ2JTDeCe6bhq65EiUliu6YvzIpdXgRlORyoIYbCZ6jWQFXkvRuPjv4rEzK0UihbGaMreuQjplqfwI9nb3G6-VChMr9bGXAxEE40U0iiOIRy-nEahyxVnybAMnwRMKk1l8DrN5DLN302k3eLLandRP4_lsGS9Gk1kMG6IucQtvF5M3o8VH-C36CCcURsvxaTd4Mpm9ij7AhqwISzdwsvLnwelFEIymcbT4Z-TJ7NdoHMMyHsWTZTwZL-HppwAA4E__7T4dWuX-xaQzhLD7cLyT484QPt0f1vad--fP-_YaqcWUUNsZQucs7J_3wn4v7EPYH4bhMAw7e8buqmXC3_ClcIB-uB_b64l_G7Nb5RLr7IO9nN4B92FOJu8dng36ZwP_31_d_1ry6oeU7DP8cVUHn59eHGbk1jGy_BcjqyZGbg8wsrxj5CO7imTO8vV8EU1-ntWW1SksotfRIpqNo-U9NU_oA50dztO5Okrn7UE6-yqjD2-no8kMTuZv4y5Es_ensIymzvZ_8HoxfwNb-P2XaBFBCS9gcBH0er1e4C_ubQC3Nze3N19vb77CvVrYITzvD-HT8wH04Pngc_B3AAAA__9k5ymi

# Make sure it shows up correctly even if it matches the cluster setting.
statement ok
SET CLUSTER SETTING sql.defaults.reorder_joins_limit = 63


query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt9u27YXvq6e4sA3TX6wWzn-YQgc9MJ11c2baxe22rUoCoKWjmQuFMmSlGJnGNCHyBPmSQZSTuJsltViqC8Miz7f-fudj-r14D1qw6QYwlgml1rSZP3qJeAGk1XJeIoaLBoLVW0VBL0eUM7lFVEaFdVIqCFSWaI4FbCmBuwaIcWMltxCRXmJQ5BZ5nCJNJaYhApDrphdk50VSSQnhl1jCzylLpMtb7SbLOddePPqozfe-WbCHvV9vm9sNRWGJpZJQZRmUjO7bQIKqQvKm9BfSsqZ3RKZEYO6YkljAhrzklPd5EgjTYkUvDGPu-YcwJYGSSbdsFB7R6bNCdOY-HmUhaB6NysUdMUxbcWamhdZyTmxDlLjj-GWUeyA1nzh8MKdXAA8FHNnSUsrXYg6EcIKxVnCLDHIXbqZ1KRUjh2NocQh-H6rnI8VtcmaGEstFihsc-KPvAmD2pKMGksUtetvAhUlt0y5HzJlGUuoy8E4svi-tXR65-Sa5dc0J39I1rx3ddCNcm2iIiUsF1IjEdKSihnm3NTDNoQJkkjVRjMmLOqK8qN7qKSxuUbjAJzqHGtOODYQLa8aG9sPw9BjZLLbHmVZwa4xJYpqy1yXMCVMpLjx3o7XLVxQqVPUmBJOjW2pzW2MpxHRuJYFulxbye8jOf0zirNa3QhnBWsMdhb-_3yH8bXp3ZpqTKhpI91j0JoZK3NNi-9CefJ5ybX0--Lt08YPAdsEReXE6rx4ZljBOHVySuxao1lL3tjS8NnAQzVmqAmX8rJUnuXGb2l22RpUS0VzN0cmVGlrCjCRtwmRRm-5i1UP8QX8NDioSX6G5gsnhma4401bYu76YiInD131N6JCbUu98iLQ2JTDeCe6bhq65EiUliu6YvzIpdXgRlORyoIYbCZ6jWQFXkvRuPjv4rEzK0UihbGaMreuQjplqfwI9nb3G6-VChMr9bGXAxEE40U0iiOIRy-nEahyxVnybAMnwRMKk1l8DrN5DLN302k3eLLandRP4_lsGS9Gk1kMG6IucQtvF5M3o8VH-C36CCcURsvxaTd4Mpm9ij7AhqwISzdwsvLnwelFEIymcbT4Z-TJ7NdoHMMyHsWTZTwZL-HppwAA4E__7T4dWuX-xaQzhLD7cLyT484QPt0f1vad--fP-_YaqcWUUNsZQucs7J_3wn4v7EPYH4bhMAw7e8buqmXC3_ClcIB-uB_b64l_G7Nb5RLr7IO9nN4B92FOJu8dng36ZwP_31_d_1ry6oeU7DP8cVUHn59eHGbk1jGy_BcjqyZGbg8wsrxj5CO7imTO8vV8EU1-ntWW1SksotfRIpqNo-U9NU_oA50dztO5Okrn7UE6-yqjD2-no8kMTuZv4y5Es_ensIymzvZ_8HoxfwNb-P2XaBFBCS9gcBH0er1e4C_ubQC3Nze3N19vb77CvVrYITzvD-HT8wH04Pngc_B3AAAA__9k5ymi

statement ok
SET enable_zigzag_join = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VmFv2zYT_lz9ioO_NHkRt3L8Yggc9IPrqps31y5stWtRFAQtnWQuFMmSlGpnGNAfkV_YXzKQUhJns6wWQ_3BsOjnuTvePXenfh_eojZMihFMZHKlJU02L54DbjFZl4ynqMGisVDVqCDo94FyLj8TpVFRjYQaIpUlilMBG2rAbhBSzGjJLVSUlzgCmWWOl0hjiUmoMOQzsxvSoEgiOTHsGjvoKXWR7HgrbrpanMGrF-89uLHNhD1q-2IfbDUVhiaWSUGUZlIzu2sjCqkLytvYn0rKmd0RmRGDumJJawAa85JT3WZII02JFLw1jtvkHOCWBkkmXbFQe0OmywjTmPh6lIWguqkVCrrmmHZyTa2LrOScWEep-cd4qyh2RGs-cXjmTi4B7i9zi6Sllc5FHQhhheIsYZYY5C7cTGpSKqeOVlfiEH0_Vc7GmtpkQ4ylFgsUtj3wB9aEQW1JRo0litrNN5GKklum3A-Zsowl1MVgnFh83roy1li5Zvk1zckfkokjyWscb5VLFRUpYbmQGomQllTMMGepLrghTJBEqi6pMWFRV5Qf7UUljc01GkfgVOdY68Ipgmj5uTW5gzAMPUcmTQcpywp2jSlRVFvmMoUpYSLFrbd2POHCOZU6RY0p4dTYjru5rvFSIho3skAXa2cDeE9uBhrFWT3hCGcFa3V2Hv7_ouH4u-mmVTUm1HQJ7yFpw4yVuabFd7G8AP3YtfT7_O3LxhcBu4aKyonVefHEsIJx6kYqsRuNZiN5a0rDJ0NP1ZihJlzKq1J5oRvfqdlVp1MtFc1dHZlQpa0lwETe1VoaPbLxVRfxGfw0PNhavobmEyeGZtjopiswt8KYyMl9Vv1WVKhtqdd-ELQm5TDfDV5XDV1yJErLNV0zfmRxtZjRVKSyIAbbhV4zWYHXUrQ2_pt44mClSKQwVlPm2lVIN1kqX4K93v3G1VJhYqU-9oIggmCyjMZxBPH4-SwCVa45S55s4SR4RGE6jy9gvohh_mY2OwserZuT-mmymK_i5Xg6j2FL1BXu4PVy-mq8fA-_Re_hhMJ4NTk9Cx5N5y-id7Ala8LSLZys_XlwehkE41kcLf_peTr_NZrEsIrH8XQVTycrePwhAAD403-7T49WuX856Y0gPLs_bsZxbwQf7g5rfO_u-eM-XiO1mBJqeyPonYeDi3446IcDCAejMByFYW8P7NYtE37Ll8IRBuG-bz9P_BuZ3SkXWG-f7MfpLXGf5sbkncHz4eB86P_76-y_Xnn9Q67sI_xxtw4-Pr48rMidU2T5L0VWbYrcHVBkeavIB7iKZA75crGMpj_Pa2R1CsvoZbSM5pNodSfNE3ovZ8fzcq6Oynl3UM7-ltG717PxdA4ni9fxGUTzt6ewimYO-z94uVy8gh38_ku0jKCEZzC8DPr9fj_wi3sXwNebm683X77efIG7aWFH8HQwgg9Ph9CHp8OPwd8BAAD__1dFKgQ=

statement ok
SET optimizer_use_histograms = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VmFv2zYT_lz9ioO_NHkRt3L8Yggc9IPrqps31y5stWtRFAQtnWQuFMmSlGpnGNAfkV-YXzKQUhJns6wCQ_3BsOjnuTvePXenfh_eozZMihFMZHKlJU02r14CbjFZl4ynqMGisVDVqCDo94FyLr8SpVFRjYQaIpUlilMBG2rAbhBSzGjJLVSUlzgCmWWOl0hjiUmoMOQrsxvSoEgiOTHsGjvoKXWR7HgrbrpanMGbVx89uLHNhD1q-2IfbDUVhiaWSUGUZlIzu2sjCqkLytvYX0rKmd0RmRGDumJJawAa85JT3WZII02JFLw1jrvkHOCWBkkmXbFQe0OmywjTmPh6lIWguqkVCrrmmHZyTa2LrOScWEep-cd4qyh2RGu-cHjhTi4BHi5zh6Sllc5FHQhhheIsYZYY5C7cTGpSKqeOVlfiEH0_Vc7GmtpkQ4ylFgsUtj3wR9aEQW1JRo0litrNd5GKklum3A-Zsowl1MVgnFh83roy1li5Zvk1zckfkokjyWscb5VLFRUpYbmQGomQllTMMGepLrghTJBEqi6pMWFRV5Qf7UUljc01GkfgVOdY68Ipgmj5tTW5gzAMPUcmTQcpywp2jSlRVFvmMoUpYSLFrbd2POHCOZU6RY0p4dTYjru5rvFSIho3skAXa2cDeE9uBhrFWT3hCGcFa3V2Hv7_ouH4u-mmVTUm1BwVniv_Y9aGGStzTQvTKYLHRC9CP3ot7RL7Y-a-dHwhsGuwqJxYnRfPDCsYp26sErvRaDaSt6Y1fDb0VI0ZasKlvCqVF7vx3ZpddTrVUtHc1ZIJVdpaBkzkXe2l0SMbX3UhX8BPw4OZ9XU0XzgxNMNGO12BuTXGRE4esuo3o0JtS732w6A1KYf5bvi6auiSI1Faruma8SPLq8WMpiKVBTHYLvaayQq8lqK1-d_FEwcrRSKFsZoy17JCuulS-RLs9e93rpcKEyv1sZcEEQSTZTSOI4jHL2cRqHLNWfJsCyfBEwrTeXwB80UM83ez2VnwZN2c1E-TxXwVL8fTeQxboq5wB2-X0zfj5Uf4LfoIJxTGq8npWfBkOn8VfYAtWROWbuFk7c-D08sgGM_iaPlPz9P5r9EkhlU8jqereDpZwdNPAQDAn_7bfXq0yv0LSm8E4dnDcTOSeyP4dH9Y43v3z5_38RqpxZRQ2xtB7zwcXPTDQT8cQDgYheEoDHt7YLdymfCbvhSOMAj3ffuR4t_K7E65wHr7ZD9S74j7NDcq7w2eDwfnQ__fX2f_9crrH3JlH-GPu3Xw-enlYUXunCLLfymyalPk7oAiyztFPsJVJHPI14tlNP15XiOrU1hGr6NlNJ9Eq3tpntAHOTuel3N1VM67g3L2t4w-vJ2Np3M4WbyNzyCavz-FVTRz2P_B6-XiDezg91-iZQQlvIDhZdDv9_uBX967AG5vbm5vvt3efIP7aWFH8Hwwgk_Ph9CH58PPwd8BAAD__3QxKmY=

statement ok
SET optimizer_use_multicol_stats = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VuFu2zYQ_l09xcF_mgxxK8fDEDjoD9dVN2-uXdhq16IoCFo6yVwokiUp1c4woA-RJ-yTDKSUxF0sq8BQ_zAs-vvujnff3anfh7eoDZNiBBOZXGlJk82L54BbTNYl4ylqsGgsVDUqCPp9oJzLz0RpVFQjoYZIZYniVMCGGrAbhBQzWnILFeUljkBmmeMl0lhiEioM-czshjQokkhODLvGDnpKXSQ73oqbrhZn8OrFew9ubDNhj9q-2AdbTYWhiWVSEKWZ1Mzu2ohC6oLyNvanknJmd0RmxKCuWNIagMa85FS3GdJIUyIFb43jNjkHuKVBkklXLNTekOkywjQmvh5lIahuaoWCrjmmnVxT6yIrOSfWUWr-Md4qih3Rmk8cnrmTS4D7y9wiaWmlc1EHQlihOEuYJQa5CzeTmpTKqaPVlThE30-Vs7GmNtkQY6nFAoVtD_wba8KgtiSjxhJF7ea7SEXJLVPuh0xZxhLqYjBOLD5vXRlrrFyz_Jrm5C_JxJHkNY63yqWKipSwXEiNREhLKmaYs1QX3BAmSCJVl9SYsKgryo_2opLG5hqNI3Cqc6x14RRBtPzcmtxBGIaeI5Omg5RlBbvGlCiqLXOZwpQwkeLWWzuecOGcSp2ixpRwamzH3VzXeCkRjRtZoIu1swG8JzcDjeKsnnCEs4K1OjsPf75oOP5uumlVjQk1R4Xnyv8ta8OMlbmmhTkugodMr0I_ey21HewHwe7LxxcDu4aLyonVefHEsIJx6kYrsRuNZiN5a2rDJ0NP1ZihJlzKq1J5wRvfsdlVp1MtFc1dPZlQpa2lwETe1WIaPbLxVRfzGfwyPJgfX0vziRNDM2z00xWYW2VM5OQ-q347KtS21Gs_EFqTcpjvBrCrhi45EqXlmq4ZP7LAWsxoKlJZEIPtgq-ZrMBrKVoHwJt44mClSKQwVlPm2lZIN2EqX4K9Hv7OFVNhYqU-9qIggmCyjMZxBPH4-SwCVa45S55s4SR4RGE6jy9gvohh_mY2OwserZuT-mmymK_i5Xg6j2FL1BXu4PVy-mq8fA9_RO_hhMJ4NTk9Cx5N5y-id7Ala8LSLZys_XlwehkE41kcLf_reTr_PZrEsIrH8XQVTycrePwhAAD423-7T49WuX9J6Y0gPLs_bsZybwQf7g5rfO_u-eM-XiO1mBJqeyPonYeDi3446IcDCAejMByFYW8P7NYuE37bl8IRBuG-bz9W_JuZ3SkXWG-f7MfqLXGf5sblncHz4eB86P_75-z_Xnn9Q67sI_xxtw4-Pr48rMidU2T5QJFVmyJ3BxRZ3iryG1xFMod8uVhG01_nNbI6hWX0MlpG80m0upPmCb2Xs-N5OVdH5bw7KGd_y-jd69l4OoeTxev4DKL521NYRTOH_QleLhevYAd__hYtIyjhGQwvg36_3w_8At8F8PXm5uvNl683X-BuWtgRPB2M4MPTIfTh6fBj8G8AAAD__9N_Ksg=

statement ok
RESET reorder_joins_limit

statement ok
RESET enable_zigzag_join

statement ok
RESET optimizer_use_histograms

statement ok
RESET optimizer_use_multicol_stats

#
# Test sequences.
#

statement ok
CREATE SEQUENCE seq

query T
EXPLAIN (OPT, ENV) SELECT * FROM seq
----
https://cockroachdb.github.io/text/decode.html#eJyUVsFu20gMvfsr5ri7qAMnbptsgx68rhYIEDvd2Am6J4KWKImb0cyYM3ISf_1iRi6aApHV3ISE75FDPj56PFb3JJ6t-aTmNn8Qi3n95S9FT5RvWtYFiQrkg9p1UaPReKxQa_sITsihEKAH6wI4jUbV6FWoSRVUYquD2qFu6ZOyZRlxufUBfI7GwyOHGg5RkFsNnvc0AC8wVvKse-OuVjfv1OLLvyn4wM0mHOW-eBkcBI3HPLA14IStcHjuAxorDeo-9LZFzeEZbAmeZMd5bwFCVatR-oiEsABrdG8d35vzCrb1BKWNwyJJRH6IhIXyNI-2MSiHWZHBjaZiEOs7XZSt1hAipMMfw62ydQQGv9Xqc_zLpVI_HvM9EttgY4quEODGac45gCcdyy2tQOuiOnpTmdfgL1sVOTYY8hp8wEANmdBf-E9sxpMEKNEHcBjqXwI1rQ7s4octuOQcYw0-iiX1baDTB5I9V3us4D_L_XvXJX1ysU1oCuDKWCEwNsCOPUeabtge2EBu3ZDM2ASSHeqje-isD5WQjwCNUlGniagGEPvY29jTyWSSMDY_bI8L3PCeCnAogWOXqAA2BT0ltuPvNjGplYKECtDow8Db4sYkGYFQbRuKtQ6KP2WK_ued5s7dQHPDvcnOJu8vDpj0NjmsqVCOfkh0P4Nq9sFWgs2bUEl8yXIDvi3fS9mkIdCQobgKglTNieeGNUY7hVAL-drq3pZOTqYJKlSSgLb2oXVJ5T5tafkwmFSswyrOkY1rQycBNtWQEQmlyEOuboif1cfpq56UZui3GjyWdNDNUGHxfLGp4EdX00V0JKGVTTKB3qa8jo-mG6chrSZwYje4YX3kaPXQCJrCNuCpX-gdkhvaW9O7-HfreQxrTW6ND4Ic19XY6Cy7NIIXu_uLZ2VHebBy7MeBGY3mt9lsnalV9s9dtpxnyrUbzfmJp61aXC3vZ9d3mTpVi9m37vPPs7Pp9PxsMv148eH9-fmHi8m5ulrOb7NFtlyrU7Vaz27X6vRyNMq-fb2eXS3Vbzdf1-9Utrz_Xa2y62y-Vn-ov29vFsrT9nI0Ho_HI0_blkxO4-4qxf-M_g8AAP__wQVa0Q==

#
# Test views.
#

statement ok
CREATE VIEW v AS SELECT a, b, u, v FROM x, y WHERE b = 3

query T
EXPLAIN (OPT, ENV) SELECT * FROM v
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvo6e4sA3tQc7keNhCBwUmOuqm7fUKWz1D0VB0NKRzIUiVZJS7AwDij1DLvd0eZKBlJw4q2W3GNqLIqK_7_x-55C9HrxBpZkUQxjL6EpJGi2fPwNcYbQoGI9RgUFtoKxQntfrAeVcXpNcYU4VEqqJzA3JORWwpBrMEiHGhBbcQEl5gUOQSWJ5kdSG6IgKTa6ZWZIaRSLJiWY3eIAeUxvJmjfiJvPLLrx8_t6Ba9tMmL22z7bBRlGhaWSYFCRXTCpm1k1EIVVGeRP7U0E5M2siE6JRlSxqDEBhWnCqmgwppDGRgjfGsSnODm6hkSTSNguVM6QPGWEKI9ePIhNU1b1CQRcc44NcXekiKTgnxlIq_j7ePAgt0ehPHJ7ak3OAh2Q2SFoYaV1UgRCW5ZxFzBCN3IabSEWK3Kqj0ZXYRd8ulbWxoCZaEm2owQyFaQ78kTWhURmSUG1ITs3yq0hZwQ3L7R8yZgmLqI1BW7G4uh2odG3khqU3NCV_SNY8d5XTVW7LREVMWCqkQiKkISXTzJqpmq0JEySS-SGZMWFQlZTvncNcapMq1JbAqUqx0oRVA1HyurGwfd_3HUdG9fTkhmXsBmOSU2WYrRLGhIkYV87a_ryFdSpVjApjwqk2B3KzE-NkRBQuZYY21oPid57s_tM5Z9V2I5xlrNHZqf_jWc1xual6TBVGVB8S3WPSkmkjU0Wzb2I58bmVa-i3-duWjWsCHlooeUqMSrNjzTLGqV2nxCwV6qXkjSX1jweOqjBBRbiUV0XuVK7dlCZXB50qmdPU9pGJvDCVBJhIDy0ihQ5Z-6qa-BR-GuzcSa6H-hMnmiZY6-ZQYPb6YiIlD1V1N2KOyhRq4ZZAY1F28-3Std1QBUeSK7mgC8b3XFoNZhQVscyIxmahV0yW4Y0UjYP_OhxbWCEiKbRRlNlxFdJultK1YGt2v_JaKTEyUu17HAjPG8-CURhAOHp2EUBeLDiLjlfQ9o4oTKbhGUwvQ5i-vrjoekeL-qT6Gl9O5-FsNJmGsCL5Fa7h1WzycjR7D78H76FNYTQfd7re0WT6PHgHK7IgLF5Be-HOvc65540uwmD2X8-T6W_BOIR5OAon83AynsOTDx4AwJ_uf_uvRcvUPUxaQ_C7D8f1Om4N4cP9YYVv3X9_3MYrpAZjQk1rCK1Tv3_W8_s9vw9-f-j7Q99vbYHtVcuEu-ELYQl9f9u32yfuNWbWuQ2stU1263RD3KbZNXlv8HTQPx243_7q_t-UF98lZRfh98va-_jkfLci11aRxReKLJsUud6hyGKjyEe4kiQW-eJyFkx-mVbIsgOz4EUwC6bjYH4vzTZ9kLPlOTmXe-W83inn7SzfTIK3G3Tpxs4OWtc7Kmx6XgdGc5gHF9YG7cKiC0UXSngxu3zpdtHxJrjuo881vP01mAWwgKcwOPe84N2ri9FkCu3LV2EXgumbzsboD5Wt8tzr9Xo9jwmBqufeRe1ISa07Htzd_nN3-_nu9jO4d8P6i5PVz_V021_-tp28u72tAffbzAzh5PSkP4QPJwPowcngo7cFSxg3qDS0jSqw4_0bAAD__2Z2axQ=

#
# Test tables in user-defined schemas.
#

statement ok
CREATE SCHEMA s;
CREATE TABLE s.t (a int primary key)

query T
EXPLAIN (OPT, ENV) SELECT * FROM s.t;
----
https://cockroachdb.github.io/text/decode.html#eJyUVt1u20gPva6eYu6afIiDfNvFImjQC9f1At51nMBWiw0WC4KWKGk2o5kJh3J-nn4xIxd1gchq7wyD55BDHh5qMlFfiIN29r2aueKeHRbNp4-KnqjYdtqUxEooiNr1UVk2mSg0xj2CZ_LIBBjAeQFv0KoGg5KGVEkVdkbUDk1H75WrqogrXBAIBdoAj1oa2EdB4QwE_UIj8BJjJc9mMG6xuTlT15_uUvCeW1s5yn15GCyMNmAh2lnwrB1reR4CWsctmiH0Q4dGyzO4CgLxTheDBTDVnUEeImLCEpw1g3V8bc4r2C4QVC4OizgRhTESzVSkeXStRd7PiixuDZWj2NDrouqMAYmQHn8Mt5nnESjhwagP8Z8rpb495mskduJiir4Q0K03utACgUwst3IMnY_qGExlX4MftipybFGKBoKgUEtWhgv_js0GYoEKg4BHaX4I1HZGtI8_XKkrXWCsIUSxpL6NdHpP8qLrF6zhX6eH965P-uRjm9CWoGvrmMA6gZ0OOtL0ww6gLRTOj8lMWyHeoTm6h94FqZlCBBjkmnpNRDUAu8fBxv7_4uIiYVyx3x4vutUvVIJHFh27RCVoW9JTYjv-bhuTOi6JqQSDQUbeFjcmyQiYGtdSrHVU_ClT9L_gje7dDYxu9WCyXy5-vdxj0tt4v6ZMBYYx0X0PanQQVzO2P4VK4kuWK_hz-Q5lk4ZAY4biaxCu2_OgW20w2ilIwxQaZwZbenH-LkGZKmIwzt13Pqk8pC2t7keTsvNYxzlq6zvpJaBtPWZETClyn6sf4gf127tXPSnNMDwYCFjRXjdjhcXzpW0N37qaLqInlo63yQQGm_I6PppunAZ3hsCz2-JWmyNHa4CG0ZauhUDDQu-RuqUXZwcX_3M-i2GdLZwNwqjjuloXnWWXRnCwuz94VnZUiONjHwc2y2br-TSfq3z6cTlX4VzUSfYG1WKVX6rVTa5Wn5fLs-zN7Ga1ydfTxSpXAv6entXtenE9Xd-pP-d36gTVdDM7zU6vsmy6zOfrA7rF6o_5LFebfJovNvlitlFv__7n7VWWzf-6XU4XK3Vyc5ufqfnqy6nazJcx9n_q9_XNdURfZZPJZJIlv5LsvwAAAP__Jj5deQ==

#
# Test default_transaction_quality_of_service settings.
#

statement ok
SET default_transaction_quality_of_service=background

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVsFu20gMvfsr5pgAceFsF4uiRQ7dNocC3bZA0mD3RNASJXEzGk44lJP41I_IF-ZLihm5aApYVnMLAr5H6vHxjZdLd0WaWMJr906qaxWsuvd_O7qjaj2wr0mdUTK3GasWi-XSofdyC1EpohJgAokG0WNwHSZnHbmaGhy8uQ36gV47aZqMqyQZpApDglu2DnZVUImHxFuagdeYJ7n3k3UfLj6fuH_e_1eKd9wc7CD3q6fFphgSVsYSICqLst1PAYNoj35xcX65F34zoGe7B2kgkW64Infm1lhdtypDqN8497PvD0qldvCoUxMpYQ0S_ORIP3Tagx0SQSN5b6SFKM2RsFJVVjP0AXW3Ngq49lTPYtNokWbwHixDRvwhXBGSk6Ub787yf_ZKhINJbjEOAtxHzxUbJPJ53EYUhpiNMtkq7IM_lSpzrNGqDpKhUU_Bpgf_hS0kUoMGk0FE634L1A_eOOY_pOaGK8wzpGybotuM0juSLbdbbOF_4ekTHJvexSwThhq4DaIEQQw2nDjTjMtOwAEqiXM242CkG_QHTzJKslYpZYBHbWn0RHYDqNxOCnu6Wq0KRqrdHUXjnrdUQ0Q1zipRDRxquitsh7875KaiNSnV4DHZzLfliyk2AqVOesqzzpq_dMpRmKLnMejAc8-Tzf5Y_flqhynfprszVaowzZnuV1DHyaRV7J-FKuYr6Wv4vH5PbVOWQHOBElswbfsXiXv2mJMVrFNKnfhJSVcvXhaoUkMKXuR6iMXlqVxpcz3bVCVim_fIIQ42WoBDOxdESqVy12tc4pn76-XeTCo7TDceEja0883cYPkl49DCT1XL4xhJbdB1CYFJUfbjc-jmbejgCaLKGtfsD7xfEzSKoZYeEk0bfURyT1sJk4f_9fJdLhtCJSGZIudzDZKTZVNW8OR2f_NZ2VBlood-J4TF4vzfLx_ffvjkjj5_uTxx55-ujt3V249fzy_c0enxm8VyuVwuSnlauMeHh8eHb48P39zR6cnx4nsAAAD__x0_Rs4=

statement ok
SET default_transaction_quality_of_service=critical

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVsFu20gMvfsr5pgAceFsF4uiRQ7dNocC3bZA0mD3RNASJXEzGk44lJP41I_IF-ZLihm5aApYVnMLAr5H6vHxjZdLd0WaWMJr906qaxWsuvd_O7qjaj2wr0mdUTK3GasWi-XSofdyC1EpohJgAokG0WNwHSZnHbmaGhy8uQ36gV47aZqMqyQZpApDglu2DnZVUImHxFuagdeYJ7n3k3UfLj6fuH_e_1eKd9wc7CD3q6fFphgSVsYSICqLst1PAYNoj35xcX65F34zoGe7B2kgkW64InfmKmXjCv0b5352_UGo1A4edWoeJaxBgp8c6IdKe7BDImgkb420EKU5ElaqymKGPqDulkYB157qWWwaDdIM3oNlyIg_hCsycrJ0491Z_s9eiXAwyS3GQYD76Llig0Q-j9uIwhCzTSZbhX3wp1JljjVa1UEyNOop2PTgv7CFRGrQYDKIaN1vgfrBG8f8h9TccIV5hpRNU3SbUXpHsuV2iy38Lzx9gGPTu5hlwlADt0GUIIjBhhNnmnHZCThAJXHOZhyMdIP-4EFGSdYqpQzwqC2NnshuAJXbSWFPV6tVwUi1u6Jo3POWaoioxlklqoFDTXeF7fB3h9xUtCalGjwmm_m2fDHFRqDUSU951lnzl045CFP0PMYceO55stkfqz9f7TDl23R3pkoVpjnT_QrqOJm0iv2zUMV8JXsNn9fvqW3KEmguUGILpm3_InHPHnOugnVKqRM_KenqxcsCVWpIwYtcD7G4PJUrba5nm6pEbPMeOcTBRgtwaOeCSKlU7nqNSzxzf73cm0llh-nGQ8KGdr6ZGyy_Yxxa-KlqeRojqQ26LiEwKcp-fA7dvA0dPEFUWeOa_YHXa4JGMdTSQ6Jpo49I7mkrYfLwv16-y2VDqCQkU-R8rkFysmzKCp7c7m8-KxuqTPTQr4SwWJz_--Xj2w-f3NHnL5cn7vzT1bG7evvx6_mFOzo9frNYLpfLRSlPC_f48PD48O3x4Zs7Oj05XnwPAAD__75LRfk=

#
# Test recursive table references from foreign keys.
#

statement ok
CREATE TABLE z (
  pk INT PRIMARY KEY,
  ref INT,
  CONSTRAINT fk FOREIGN KEY (ref) REFERENCES y(u),
  FAMILY "primary" (pk, ref)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM z;
----
https://cockroachdb.github.io/text/decode.html#eJy0VlFv2zYQfq5-BeGXJoNdyMkwBA764Lrq4M21C1stWhQFQUsnmTNFskdKsT3svw-knMRZJavF0DwEEXPf3X133x05GJAPgIYrOSITlWxRsWTz-hWBHSTrkosUkFgwllS1VRAMBoQJoe6oRtAMgTJDlbZUCybJhhliN0BSyFgpLKmYKGFEVJY5XKKMpSZh0tA7bjf0aEUTJajhB-iAp8xlshetdtPVok_evv7kjY--ubRnfd-cGltk0rDEciWpRq6Q230bUCosmAhWUdwI_1oywe2eqowawIonQF6SBLnlCRO3hDxGvXeIkJeCYVs-CCylSorWhO6r1IAtDdBMua4BekemywlHSHxjykIyPDYNJFsLSDuxphZIVgpBrYPU-HM4X0ZurPkqyEt30lgiVlrlQtSJUF5owRNuqQHh0s0U0lI7mbSGkk3w01I5H2tmkw01llkoQNr2xJ94kwbQ0owZSzWzm-8CFaWwXLs_VMoznjCXg3Gi8XXrqPTRyYHnB5bTvxRvH8A66E67MjGZUp5LhUClsrTihjs3dbMN5ZImSnfJjEsLWDFxdiC1MjZHMA4gGOZQa8KpgaK6ay3sMAxDj1HJcYq05QU_QEo1Q8tdlSClXKaw897O85YuqMIUEFIqmLEd3NzEeBlRhI0qwOXaKX4fyS1CowWv1xwVvOCtwa7CX2-OGM8Nj2OKkDDTJbqnoA03VuXIih9CefH53WvZj8U7lY1vAnQtFJ1Ti3nxwvCCC-b2KrUbBLNRorWk4YtrD0XIAKlQaltqr3LjpzTbdgZFpVnu-silLm0tAS7zrkWE4C2PseomviS_XTfuJN9D81VQwzI46qYrMXePcZnTx6r6q1ED2hLXfgm0FqUZ75au6waWAqhGtWZrLs7cXi1ukMlUFdRAu9BrJC_goGTr4L-PJ86slImSxiLjblylcpul8i04md3vvFYqSKzCc68EGQSTZTSOIxKPX80iosu14MmLHbkInjEyncc3ZL6Iyfz9bNYPnq2PJ_XXZDFfxcvxdB6THdVb2JN3y-nb8fIT-TP6RC4YGa8ml_3g2XT-OvpIdnRNebojF2t_HlzeBsF4FkfL_0aezv-IJjFZxeN4uoqnkxV5_jkghJC__W_302NV7l8ovREJ-4_Hx3XcG5HPD4e1fe_h-8upPQKzkFJmeyPSuwqHN4NwOAiHJByOwnAUhr0TY3fVculv-FI6wDA8je33iX-W2b12ifVOwX6d3gNPYW5NPji8uh5eXfv__dP_v5TXP4Wyz_DnsQ6-PL9tVuTeKbL8RpFVmyL3DYos7xX5xK6imbN8s1hG09_ntWV1SZbRm2gZzSfR6kGaF-xRzg7n5VydlfO-Uc6tLA-Opd5-QxMhayN6aCCqtw1Ms-1TjghZE8v9RdnK5tDOJvr4bjaezsnF4l3cJ9H8wyVZRTNn-wt5s1y8JYfbYDAYDAL_9DgE_wYAAP__kGtUJg==

# A foreign key cycle shouldn't cause infinite recursion.
statement ok
ALTER TABLE y ADD CONSTRAINT fk FOREIGN KEY (v) REFERENCES z (pk);

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vl1v2zYUfa5-xYVf6gxxISfDEDjog-uqg7fULmy1aFEUBC1dyZwpkiUp1fKw_z6QchpnlawWQ_MQRMw99_PcQ45G8A61YVJMYCaTnZY02b58AbjHZFMynqIGi8ZC1VgFwWgElHP5hSiNimok1BCpLFGcCthSA3aLkGJGS26horzECcgsc7hEGktMQoUhX5jdkqMVSSQnhh2wB55Sl0nNO-3m6-UlvH75wRsffTNhz_q-OTW2mgpDE8ukIEozqZmtu4BC6oLyYB3FrfDPJeXM1kRmxKCuWILwHBLNLEsovwV4iHrvUGNecqq78tFIUyIF70zovkst2NIgyaSbGmrvyPQ5YRoTP5iyEFQfh4aCbjimvVjTECQrOSfWQRr8OZxvIzPWfObw3J20toiWVroQTSKEFYqzhFlikLt0M6lJqRxNOkOJNvhpq5yPDbXJlhhLLRYobHfij7wJg9qSjBpLFLXb7wIVJbdMuT9kyjKWUJeDcaTxfevp9NHJgeUHmpO_JOtewCboXrk2UZESlgupkQhpScUMc26aYRvCBEmk6qMZExZ1RfnZhVTS2FyjcQBOdY4NJxwbiJZfOhs7DsPQY2Ry3CJlWcEOmBJFtWWuS5gSJlLce2_n6xYuqNQpakwJp8b21OY2xtOIaNzKAl2uveT3kZwQGsVZI3OEs4J1BrsKf705Ynxt-rimGhNq-kj3GLRlxspc0-KHUJ58Xnst_bF4p7TxQ8A-QVE5sTovnhlWME6drhK71Wi2kne2NHx27aEaM9SES7krlWe58Vua7XqDaqlo7ubIhCptQwEm8j4h0ugtj7GaIT6H365bNcnP0HzmxNAMj7zpS8zdY0zk5KGr_mpUqG2pN14EOpvSjnei66ahS45EabmhG8bP3F4dbjQVqSyIwW6iN0hW4EGKzsV_G8-cWSkSKYzVlLl1FdIpS-VHcLK733mtVJhYqc-9EkQQzFbRNI4gnr64i0CVG86SZ3sYBk8ozBfxDSyWMSze3t1dBk82x5Pma7ZcrOPVdL6IYU_UDmt4s5q_nq4-wJ_RBxhSmK5nF5fBk_niZfQe9mRDWLqH4cafBxe3QTC9i6PVfyPPF39EsxjW8TSer-P5bA1PPwYAAH_73-5nQKvcv1AGEwgvH46PcjyYwMevh4394Ov3p1N7jdRiSqgdTGBwFY5vRuF4FI4hHE_CcBKGgxNjd9Uy4W_4UjjAODyN7fXEP8tsrVxig1Owl9N74CnMyeRXh1fX46tr_79_Lv9vyZufUrLP8OdVHXx6etvOyINjpNp9Q0mNWRcpDy2kVLt7Vp4YZjt4tVxF898XjZHG7AJW0atoFS1m0fo-hXpYdtL20ErbzmpqV035TTFVVyl1SyllSyU1qUjmLB_VU7VVsx_Snja0wg5DtXtYahfPL3V1dqnr7u5E79_cTecLGC7fxJcQLd5dwDq6c7a_wKvV8jXUt8FoNBoF_slSB_8GAAD__w9mY-g=

# Check that we remove histograms from statistics correctly.

statement ok
CREATE TABLE b (
  b BOOL NOT NULL,
  INDEX (b)
)

statement ok
ALTER TABLE b INJECT STATISTICS '[
      {
          "avg_size": 1,
          "columns": [
              "b"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 2,
          "histo_buckets": [
              {
                  "distinct_range": 0,
                  "num_eq": 1000,
                  "num_range": 0,
                  "upper_bound": "false"
              },
              {
                  "distinct_range": 0,
                  "num_eq": 100,
                  "num_range": 0,
                  "upper_bound": "true"
              }
          ],
          "histo_col_type": "BOOL",
          "histo_version": 2,
          "name": "__auto__",
          "null_count": 0,
          "row_count": 1100
      },
      {
          "avg_size": 0,
          "columns": [
              "rowid"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 0,
          "histo_col_type": "",
          "name": "__auto__",
          "null_count": 0,
          "row_count": 0
      }
]'

query T
EXPLAIN (OPT, ENV) SELECT * FROM b
----
https://cockroachdb.github.io/text/decode.html#eJy8Vk9vG7kPPXc-BeFL0x_iwHH6200d9OA6LuBd1y7iadGiKAjNDD3mRiMpksb5s9jvvpDstO7C40kPuzkEicRHch4fSXW78JGsY60GMNL5tdUiX12-AbqjPKtZFmTBk_Ow3lglSbcLQkp9i8aSEZZQONTGo5FCwUo48CuCgpailh7WQtY0AL1cBlyunUeXC-Xwlv0Kt1aYa4mOH6gFXoiQyb1stJss5sfw7vJzNN76ZuUP-j7fNfZWKCdyz1qhsawt-_smoNK2EjJZjNO98JtaSPb3qJfoyK45J3gNuWXPuZAXAN-jPjq0VNZS2KZ8LIkCtZKNCT2ytAdbO8KlDlUjGx25NidsKY-FqSsl7LZopEQmqWjFuo1AlrWU6ANkgz-EizSy8-5GwutwspciUXsdQmwSQa6M5Jw9OpIh3aW2WJsgk8ZQah98l6rgIxM-X6HzwlNFyjcn_oM35ch6XArn0Qi_ehKoqqVnE_7QBS85FyEHF0QTeWtheuvkgcsHUeIfmpsbcBP0zgSahCqQS6UtodIe1-w4uNkU2yErzLVpkxkrT3Yt5MGGNNr50pILAClsSRtNBDWg1beNxJ72er2I0fm2i4znih-oQCOs58ASFciqoLvo7fB3qxBU24IsFSiF8y3fFjomyggtrXRFIddW8cdIYRA6I3kz5lByxY3B-r2X51tM_Da7bVNLuXBtovsRtGLndWlF9VOoKL44e734uXi7solFoLaBYkr0tqxOHFcsRZir6FeW3ErLRkp7J2cRamlJFqXW17WJKnexS5fXrUGtNqIMdWRlar-RAKuybRBZipbbWJsivoZfzvbOpFhDdyPRiSVtddOWWNhjrEr8zmpcjYasr20Wh0AjKfvxYeiGathaEhqrM5GxPLC9GtxYoQpdoaNmoW-QXNGDVo2N_yEdBbNa5Vo5bwWHdlU6TJZ1LMFO7z5xrawp99oeeiWoJBldjYfpGNLhm-kYTJ1Jzk8yOEqeZfBmPp_CbJ7C7MN0epw8s_qWC5jM0vN4-nGymATQowVcjt8OP0xTqBXf1HEEcHH04jh5NprPFunVcDJLIUNzTffw_mrybnj1GX4ff4ajjd_hYhRsJ7PL8SfIMEMu7uAoi-fJi4skGU7T8dU_E53MfhuPUlikw3SySCejBTz_kgAA_Bl_h5-OWJfxQdMZwOnx9-Pt9O4M4Mu3w3iRdb79_3XX3pLwVKDwnQF0-r1-v3va7_b6cHo-OHs56L86-f-vL1-d9Ts7mLCgWcV3Qa0Crr9zGWdQfMr5exOy6-xClajiGWLY4Yg_3IXx_Oiyt3MRxu7j-elprxdv_jo-wEjvKYzECv2LrPT-O1a2lCRfn18kyfjT--lwMoOj-fv0GMazjy9gMZ4GQf0P3l7N30F2kXS73W4SN2aW_B0AAP__pt37ZQ==
