# LogicTest: local !metamorphic-batch-sizes
# We must turn off metamorphic variables because some are included in
# EXPLAIN (OPT, ENV) output.

statement ok
CREATE TABLE x (
  a INT PRIMARY KEY,
  b INT,
  INDEX (b),
  FAMILY "primary" (a, b)
)

statement ok
ALTER TABLE x INJECT STATISTICS '[
  {
    "columns": ["a"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 100,
    "histo_col_type": ""
  },
  {
    "columns": ["b"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 123123,
    "histo_col_type": ""
  }
]'

statement ok
CREATE TABLE y (
  u INT PRIMARY KEY,
  v INT REFERENCES x,
  INDEX (v),
  FAMILY "primary" (u, v)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM x WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4kZNdBA4KzHXVzVvqFLbatSgKgpKOZC4UyZKUamcY0IfIE_ZJBlJK4mCRlWBoLoKIOd_h-fnOdzgcwnvUhkkxhqlML7Wk6erVS8A1pknFeIYaLBoLdWMVBMMhUM7lV6I0KqqRUEOkskRxKmBFDdgVQoY5rbiFmvIKxyDz3OFSaSwxKRWGfGV2RVorkkpODLvCHnhGXSQb3mk3W14cwJtXH71x65sJu9P36bax1VQYmlomBVGaSc3spgsopC4p70J_qShndkNkTgzqmqWdAWgsKk51lyONNCNS8M44borzALYySHLpmoXaOzJ9TpjG1PejKgXVba9Q0IRj1os1DS_yinNiHaTB78Ito9gBrfnC4YU7OQO4S-bGklZWuiuaQAgrFWcps8Qgd-HmUpNKOXZ0XiUegm-XyvlIqE1XxFhqsURhuwO_500Y1Jbk1FiiqF09ClRW3DLl_pAZy1lKXQzGkcXXrafSrZMrVlzRgvwlWd_c4Vq5OlGREVYIqZEIaUnNDHN-mm4bwgRJperjGct80veKZ9A4bSCWlSgr2-UhvMU_CSAs6prynZOvpLGFRuMAnOoCGxY6_hEtv3a2chSG_hIu03ZelWUlu8KMKKotc-lhRpjIcO297W4vl-nlo5ISLjqpM9SYEU5Np3VbdTfMnuFE40qW6JLqnUsfkpNmozhrhJdwVrLOy47Dn09bjC-CJlQpvtmqpUJBud0QK0nNtK1oO-l9wnLnsdEkjSk1fRN2H7RixspC0_JJKD9pfr9Y-rT7tkfE9783SVUQq4vy0LCScep2B7ErjWYleWeTwsMTD9WYoyZcystK-ZE2XpLyy95LtVS0cMxgQlW2IRUTRQ9Mozdsr9rJCk8J84UTQ3NsadgX1a2IPmoa3FpnoiB3DfAvBYXaVjrx4vhEvFtGrnG64kiUlglNGN-xzDvcaCoyWRKD3VPWIFmJV1J0ytO7eOrNtjTzMXWpRCIrkTViRDlH3r9RPSyVwlhNmdMuIZ2u154UW0L2yK1eY2ql3vU2E0EwXUSTOIJ48vI88lU8VFXCWXq4hr3gGYXZPD6F-UUM83fn5wfBs6Q9ab6mF_NlvJjM5jGsibrEDbxdzN5MFh_hj-gj7FGYLKf7B8Gz2fxV9AHWJCEsW8Ne4s-D_bMgmJzH0eLB62fz36NpDMt4Es-W8Wy6hOefAgCAv_1v9zOgdeFfiIMxhAd3x-1aHIzh0-1hYz-4_f68ba-RWswItYMxDI7D0ekwHA3DEYSjcRiOw3CwZezePEz4p1YlHGAUbt_ttc4_i-1GucAG22C_PG6A2zC3FG4dHp-Mjk_8__45-L8pJz8kZR_hj8s6-Pz8bAc3N46b1X-4WXdxc_MAN6sbbt6zq0nuLF9fLKLZr_PGst6HRfQ6WkTzabSEG37u0TtiO5wndt1P7M2DxPb5Rh_enk9mc9i7eBsfQDR_vw_L6NzZ_gSvFxdvYA1__hYtIkjgBZycBcPhcBj4l836l3a2Avh-ff39-tv3629wqyR2DEfHR6MxfDo6gSEcnXwO_g0AAP__oGzBpA==


statement error pq: at or near "EOF": syntax error: the ENV flag can only be used with OPT
EXPLAIN (ENV) SELECT * FROM x WHERE b = 3

#
# Multiple Tables.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x, y WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt9u27YXvq6e4sA3TX6wEzn5XQQOCsx11c1b6hS22rUoCoKWjmQuFMmSlGpnGFDsGXK5p8uTDKSUxEEjK8HQXAQ2_X2H5893zuFgAO9RGybFCCYyudCSJqtXLwHXmCxLxlPUYNFYqGpUEAwGQDmXX4nSqKhGQg2RyhLFqYAVNWBXCClmtOQWKspLHIHMMsdLpLHEJFQY8pXZFWlQJJGcGHaJHfSUOk82vBU3XZz34c2rjx7c2GbC7rR9sg22mgpDE8ukIEozqZndtBGF1AXlbewvJeXMbojMiEFdsaTVAY15yaluM6SRpkQK3urHTXIe4JYGSSZdsVB7Q6bLCNOY-HqUhaC6qRUKuuSYdnJNrYus5JxYR6n5u3iLKHZEa75weOFOTgHugrlB0tJKd0XtCGGF4ixhlhjkzt1MalIqp47Wq8RD9O1UORtLapMVMZZaLFDYdsfvWRMGtSUZNZYoalePIhUlt0y5DzJlGUuo88E4sfi8dWS6MXLJ8kuakz8k6-o7XCuXJypSwnIhNRIhLamYYc5OXW1DmCCJVF06Y6kP-l7yDBo3G4hlBcrStlkIb_lPIgiLuqJ8Z-craWyu0TgCpzrHWoVOf0TLr62lHIahv4TLpOlXZVnBLjElimrLXHiYEiZSXHtru8vLZXLxqKCE807qFDWmhFPTim6y7prZK5xoXMkCXVCdfeldcqPZKM7qwUs4K1jrZUfh_08ajk-CJlQpvtnKpUJBud0QK0nFtC1p0-ldg-XOYj2TNCbUdHXYfdKKGStzTYsnsXyn-f1i6dPu224RX__OIFVOrM6LA8MKxqnbHcSuNJqV5K1FCg-OPVVjhppwKS9K5Vva-JGUXXReqqWiuVMGE6q0taiYyDtoGj2wuWqnKrwkzBdODM2wkWGXV7dD9FHd4NY6Ezm5K4B_KSjUttRLPxyfyHfLyBVOlxyJ0nJJl4zvWOYtZjQVqSyIwfYuq5mswEspWsfTu3jiYVsz8zF5KcVSliKthxHlHHn3RvW0RApjNWVudgnp5nrlRbE1yB651StMrNS73mYiCCbzaBxHEI9fnkU-iweqXHKWHKxhL3hGYTqLT2B2HsPs3dlZP3i2bE7qb5Pz2SKej6ezGNZEXeAG3s6nb8bzj_Bb9BH2KIwXk_1-8Gw6exV9gDVZEpauYW_pz4P90yAYn8XR_MHrp7Nfo0kMi3gcTxfxdLKA558CAIA__X_316NV7l-IvRGE_bvjZi32RvDp9rDG926_f97Ga6QWU0JtbwS9o3B4MgiHg3AI4XAUhqMw7G2B3ZuHCf_UKoUjDMPtu_2s889iu1HOsd422S-PG-I2zS2FW4NHx8OjY__bX_3_GvLyh4TsPfxxUQefn5_u0ObGabP8TptVmzY3D2izvNHmPVxFMod8fT6Ppj_PamS1D_PodTSPZpNoATf63KN3wnY8L-yqW9ibB4Xt440-vD0bT2ewd_427kM0e78Pi-jMYf8Hr-fnb2Ddhw38_ks0j2AJL-D4NBgMBoOACYF64B-Te4mWxuwHcH31z_XVt-urb-CfPpvvTtY_Ne3ofvnbZf366qoB3M4gO4LDo8PhCD4dHsMADo8_B1uwjHGL2sCe1SXuB_8GAAD__-0R5a0=

#
# Same table twice should only show up once.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x one, x two
----
https://cockroachdb.github.io/text/decode.html#eJy0Vs1u2zgQPldPQfhSZ2EHcrqHwEEPrqsuvJvaha0WLYqCGEsjmRuKZElKsbNYoA-R4z5dnmRBSkkcbGQlWDSHwCLnm99vZjgckk-oDZNiTKYyudASks3bNwS3mKxLxlPUxKKxpKqlgmA4JMC5vKRKowKNFAyVylLFQZANGGI3SFLMoOSWVMBLHBOZZQ6XSGOpSUAYesnshjZSNJGcGnaFHfAUnCc73io3Wy0G5P3bL1640c2EPaj7dF_YahAGEsukoEozqZndtQGF1AXwNvT3EjizOyozalBXLGl1QGNectBtijRCSqXgrX7cJucRbGmQZtIVC7VXZLqUMI2Jr0dZCNBNrVDAmmPaiTU1L7KSc2odpMYfwq2i2AGt-c7Ja3dyRsh9MLeSUFrpTNSOUFYozhJmqUHu3M2kpqVy7Gg1JR6D76fK6ViDTTbUWLBYoLDtjj_QJgxqSzMwliqwmyeBipJbptwPmbKMJeB8MI4sPm8dmW6UXLH8CnL6p2RdfYdb5fIEIqUsF1IjFdLSihnm9NTVNpQJmkjVxTOW-qAfJM-gcbOBWlagLG2bhvAO_yyAsKgr4Ac7X0ljc43GATjoHGsWOv5RLS9bSzkKQ2-Ey6TpV2VZwa4wpQq0ZS48TCkTKW69tsPl5TK5eFJQwnkndYoaU8rBtEo3WXfN7BlONW5kgS6ozr70LrnRbBRn9eClnBWs1dhJ-Otpg_FJ0BSU4ru9XCoUwO2OWkkrpm0JTad3DZZ7jfVM0piA6eqwh6ANM1bmGopnoXyn-f1i4Xn29lvE178zSJVTq_Pi2LCCcXC7g9qNRrORvLVI4fErD9WYoaZcyotS-ZY2fiRlF51GtVSQO2YwoUpbk4qJvAOm0Qs2pg6ywlPCfOfUQIYNDbu8uhuiT-oGt9aZyOl9AfxLQaG2pV774fhMvFtGrnC65EiVlmtYM35gmbeo0SBSWVCD7V1WI1mBV1K0jqeP8dSL7c3Mp-SlFGtZirQeRsA58u6N6mGJFMZqYG52CenmeuVJsTfInrjVK0ys1IfeZiIIpstoEkcknrw5j3wWj1W55iw53pJ-8ALIbB6fkvkiJvOP5-eD4MW6Oam_pov5Kl5OZvOYbKm6wB35sJy9nyy_kD-iL6QPZLKaHg2CF7P52-gz2dI1ZemW9Nf-PDg6C4LJeRwtHzU_m_8eTWOyiifxbBXPpivy8mtACCF_-f_urwdV7l-IvTEJB_fHzVrsjcnXu8Navnf3_W1fXiNYTCnY3pj0TsLR6TAcDcMRCUfjMByHYW9P2L15mPBPrVI4wCjct-1nnX8W251yjvX2wX553AL3YW4p3Ck8eTU6eeXv_h7835DXPyVk7-HPizr49vLsADd3jpvlf7hZtXFz9wg3y1tuPpCraOYk3y2W0ey3eS1ZHZFl9C5aRvNptCK3_OzDPbEdzhO76ib27lFi-3ijzx_OJ7M56S8-xAMSzT8dkVV07mR_Ie-Wi_dkSyYrIgUO6l_2Up4Fw-FwGDAhUA_9c7KfaGnMUUBurv-5uf5xc_2D-MfPlnwF81oK_NZyZS-lv7purjLGLWpD-laXeBT8GwAA__9m5NoY

#
# Set a relevant session variable to a non-default value and ensure it shows up
# in the environment dump.
#

statement ok
SET reorder_joins_limit = 63

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpaOZC4UyZKUamcY0IfIE-ZJBlJK4mCWlWBoLoKIOd_h-fnOd9jvwwfUhkkxgolMLrWkyer1K8A1JsuS8RQ1WDQWqtoqCPp9oJzLb0RpVFQjoYZIZYniVMCKGrArhBQzWnILFeUljkBmmcMl0lhiEioM-cbsijRWJJGcGHaFHfCUukg2vNVuurg4grevP3njxjcTdq_v021jq6kwNLFMCqI0k5rZTRtQSF1Q3ob-WlLO7IbIjBjUFUtaA9CYl5zqNkcaaUqk4K1x3BZnB7Y0SDLpmoXaOzJdTpjGxPejLATVTa9Q0CXHtBNral5kJefEOkiN34dbRLEDWvOVw0t3cgZwn8ytJS2tdFfUgRBWKM4SZolB7sLNpCalcuxovUrsgm-XyvlYUpusiLHUYoHCtgf-wJswqC3JqLFEUbt6FKgouWXK_SFTlrGEuhiMI4uvW0elGydXLL-iOflLsq65w7VydaIiJSwXUiMR0pKKGeb81N02hAmSSNXFM5b6pB8Uz6Bx2kAsK1CWts1DeId_EkBY1BXleydfSWNzjcYBONU51ix0_CNafmtt5SAM_SVcJs28KssKdoUpUVRb5tLDlDCR4tp7299eLpPLRyUlXHRSp6gxJZyaVuum6m6YPcOJxpUs0CXVOZc-JCfNRnFWCy_hrGCtl52EP582GF8ETahSfLNVS4WCcrshVpKKaVvSZtK7hOXeY61JGhNquibsIWjFjJW5psWTUH7S_H6x9Gn3bY-I739nkionVufFsWEF49TtDmJXGs1K8tYmhcdDD9WYoSZcystS-ZE2XpKyy85LtVQ0d8xgQpW2JhUTeZfqavSWzV01LV7CL8OdAuxZYb5yYmiGDRO7ArvT0UcNhNvsTOTkvgf-saBQ21IvvT4-Ee_2keudLjkSpeWSLhnfs89b3GgqUlkQg-2DViNZgVdStCrU-3jizbZk8zF1KcVSliKt9Yhyjrx7qXpYIoWxmjInX0I6aa88L7a07JGLvcLESr3veSaCYDKPxnEE8fjVeeSreKzKJWfJ8RoOgmcUprP4FGYXMczen58fBc-WzUn9NbmYLeL5eDqLYU3UJW7g3Xz6djz_BH9En-CAwngxOTwKnk1nr6OPsCZLwtI1HCz9eXB4FgTj8zia77x-Ovs9msSwiMfxdBFPJwt4_jkAAPjb_3Y_PVrl_pHYG0F4dH_cbMbeCD7fHdb2vbvvL9v2GqnFlFDbG0HvJByc9sNBPxxAOBiF4SgMe1vG7tnDhH9tlcIBBuH23V7u_MvYbpQLrLcN9vvjFrgNc3vhzuHJcHAy9P_75-j_prz8ISn7CH9c1sGX52d7uLlx3Cz_w82qjZubHdwsb7n5wK4imbN8czGPpr_OasvqEObRm2gezSbRAm75eUDvie1wnthVN7E3O4nt840-vjsfT2dwcPEuPoJo9uEQFtG5s_0J3swv3sIG_vwtmkdQwksYngX9fr8f-MfNJoCb6-ub6-8319_hTkHsCF4MRvD5xRD68GL4Jfg3AAD__0Xtvcs=

# Make sure it shows up correctly even if it matches the cluster setting.
statement ok
SET CLUSTER SETTING sql.defaults.reorder_joins_limit = 63


query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpaOZC4UyZKUamcY0IfIE-ZJBlJK4mCWlWBoLoKIOd_h-fnOd9jvwwfUhkkxgolMLrWkyer1K8A1JsuS8RQ1WDQWqtoqCPp9oJzLb0RpVFQjoYZIZYniVMCKGrArhBQzWnILFeUljkBmmcMl0lhiEioM-cbsijRWJJGcGHaFHfCUukg2vNVuurg4grevP3njxjcTdq_v021jq6kwNLFMCqI0k5rZTRtQSF1Q3ob-WlLO7IbIjBjUFUtaA9CYl5zqNkcaaUqk4K1x3BZnB7Y0SDLpmoXaOzJdTpjGxPejLATVTa9Q0CXHtBNral5kJefEOkiN34dbRLEDWvOVw0t3cgZwn8ytJS2tdFfUgRBWKM4SZolB7sLNpCalcuxovUrsgm-XyvlYUpusiLHUYoHCtgf-wJswqC3JqLFEUbt6FKgouWXK_SFTlrGEuhiMI4uvW0elGydXLL-iOflLsq65w7VydaIiJSwXUiMR0pKKGeb81N02hAmSSNXFM5b6pB8Uz6Bx2kAsK1CWts1DeId_EkBY1BXleydfSWNzjcYBONU51ix0_CNafmtt5SAM_SVcJs28KssKdoUpUVRb5tLDlDCR4tp7299eLpPLRyUlXHRSp6gxJZyaVuum6m6YPcOJxpUs0CXVOZc-JCfNRnFWCy_hrGCtl52EP582GF8ETahSfLNVS4WCcrshVpKKaVvSZtK7hOXeY61JGhNquibsIWjFjJW5psWTUH7S_H6x9Gn3bY-I739nkionVufFsWEF49TtDmJXGs1K8tYmhcdDD9WYoSZcystS-ZE2XpKyy85LtVQ0d8xgQpW2JhUTeZfqavSWzV01LV7CL8OdAuxZYb5yYmiGDRO7ArvT0UcNhNvsTOTkvgf-saBQ21IvvT4-Ee_2keudLjkSpeWSLhnfs89b3GgqUlkQg-2DViNZgVdStCrU-3jizbZk8zF1KcVSliKt9Yhyjrx7qXpYIoWxmjInX0I6aa88L7a07JGLvcLESr3veSaCYDKPxnEE8fjVeeSreKzKJWfJ8RoOgmcUprP4FGYXMczen58fBc-WzUn9NbmYLeL5eDqLYU3UJW7g3Xz6djz_BH9En-CAwngxOTwKnk1nr6OPsCZLwtI1HCz9eXB4FgTj8zia77x-Ovs9msSwiMfxdBFPJwt4_jkAAPjb_3Y_PVrl_pHYG0F4dH_cbMbeCD7fHdb2vbvvL9v2GqnFlFDbG0HvJByc9sNBPxxAOBiF4SgMe1vG7tnDhH9tlcIBBuH23V7u_MvYbpQLrLcN9vvjFrgNc3vhzuHJcHAy9P_75-j_prz8ISn7CH9c1sGX52d7uLlx3Cz_w82qjZubHdwsb7n5wK4imbN8czGPpr_OasvqEObRm2gezSbRAm75eUDvie1wnthVN7E3O4nt840-vjsfT2dwcPEuPoJo9uEQFtG5s_0J3swv3sIG_vwtmkdQwksYngX9fr8f-MfNJoCb6-ub6-8319_hTkHsCF4MRvD5xRD68GL4Jfg3AAD__0Xtvcs=

statement ok
SET enable_zigzag_join = true

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpaOZC4UyZKUamcY0IfIE-ZJBlJK4mCWlWBoLoKIOd_h-fnOd9jvwwfUhkkxgolMLrWkyer1K8A1JsuS8RQ1WDQWqtoqCPp9oJzLb0RpVFQjoYZIZYniVMCKGrArhBQzWnILFeUljkBmmcMl0lhiEioM-cbsijRWJJGcGHaFHfCUukg2vNVuurg4grevP3njxjcTdq_v021jq6kwNLFMCqI0k5rZTRtQSF1Q3ob-WlLO7IbIjBjUFUtaA9CYl5zqNkcaaUqk4K1x3BZnB7Y0SDLpmoXaOzJdTpjGxPejLATVTa9Q0CXHtBNral5kJefEOkiN34dbRLEDWvOVw0t3cgZwn8ytJS2tdFfUgRBWKM4SZolB7sLNpCalcuxovUrsgm-XyvlYUpusiLHUYoHCtgf-wJswqC3JqLFEUbt6FKgouWXK_SFTlrGEuhiMI4uvW1fFGi9XLL-iOflLMuGKJ3bWrukOrpUrFRUpYbmQGomQllTMMOepbrghTJBEqi6qsdTn_aB-Bo2TB2JZgbK0bR7CO_yTAMKirijfO_xKGptrNA7Aqc6xJqKjINHyW2s3B2HoL-EyaUZWWVawK0yJotoylx6mhIkU197b_g5zmVw-KinhopM6RY0p4dS0WjdVd_PsSU40rmSBLqnO0fQhOXU2irNaewlnBWu97CT8-bTB-CJoQpXim61aKhSU2w2xklRM25I2w96lLfcea1nSmFDTNWQPQStmrMw1LZ6E8sPmV4ylT7tve0R8_zuTVDmxOi-ODSsYp259ELvSaFaStzYpPB56qMYMNeFSXpbKD7XxqpRddl6qpaK5YwYTqrQ1qZjIu2REo7ds7qpp8RJ-Ge7UEc8K85UTQzNsmNgV2J2UPmog3HJnIif3PfDvBYXalnrpJfKJeLeSXO90yZEoLZd0yfield7iRlORyoIYbB-0GskKvJKiVaHexxNvtiWbj6lLKZayFGmtR5Rz5N171cMSKYzVlDn5EtJJe-V5saVlj9ztFSZW6n0vNBEEk3k0jiOIx6_OI1_FY1UuOUuO13AQPKMwncWnMLuIYfb-_PwoeLZsTuqvycVsEc_H01kMa6IucQPv5tO34_kn-CP6BAcUxovJ4VHwbDp7HX2ENVkSlq7hYOnPg8OzIBifx9F85_XT2e_RJIZFPI6ni3g6WcDzzwEAwN_-t_vp0Sr378TeCMKj--NmM_ZG8PnusLbv3X1_2bbXSC2mhNreCHon4eC0Hw764QDCwSgMR2HY2zJ2Lx8m_IOrFA4wCLfv9nLnH8d2o1xgvW2w3x-3wG2Y2wt3Dk-Gg5Oh_98_R_835eUPSdlH-OOyDr48P9vDzY3jZvkfblZt3Nzs4GZ5y80HdhXJnOWbi3k0_XVWW1aHMI_eRPNoNokWcMvPA3pPbIfzxK66ib3ZSWyfb_Tx3fl4OoODi3fxEUSzD4ewiM6d7U_wZn7xFjbw52_RPIISXsLwLOj3-_3AP242AdxcX99cf7-5_g53CmJH8GIwgs8vhtCHF8Mvwb8BAAD__5zbvc8=

statement ok
SET optimizer_use_histograms = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpaOZC4UyZKUamcY0IfIE_ZJBlKK42CWlWJoLoKIOd_h-fnOd9jvwzvUhkkxgolMrrWkyerlC8A1JsuS8RQ1WDQWqtoqCPp9oJzLL0RpVFQjoYZIZYniVMCKGrArhBQzWnILFeUljkBmmcMl0lhiEioM-cLsijRWJJGcGHaDHfCUukg2vNVuurg6gdcvP3jjxjcT9qDv811jq6kwNLFMCqI0k5rZTRtQSF1Q3ob-XFLO7IbIjBjUFUtaA9CYl5zqNkcaaUqk4K1x3BVnD7Y0SDLpmoXaOzJdTpjGxPejLATVTa9Q0CXHtBNral5kJefEOkiNP4RbRLEDWvOZw3N3cgFwn8ydJS2tdFfUgRBWKM4SZolB7sLNpCalcuxovUrsg--WyvlYUpusiLHUYoHCtgf-wJswqC3JqLFEUbt6FKgouWXK_SFTlrGEuhiMI4uvW1fFGi83LL-hOflLMuGKJ_bWrukOrpUrFRUpYbmQGomQllTMMOepbrghTJBEqi6qsdTn_aB-Bo2TB2JZgbK0bR7CLf67AMKirig_OPxKGptrNA7Aqc6xJqKjINHyS2s3B2HoL-EyaUZWWVawG0yJotoylx6mhIkU197b4Q5zmVw_KinhopM6RY0p4dS0WjdVd_PsSU40rmSBLqnO0fQhOXU2irNaewlnBWu97Cz8-bzB-CJoQpXim51aKhSU2w2xklRM25I2w96lLfcea1nSmFBzcMgc1R-iVsxYmWtamANqsU16B-gHzq8ZS7sG-yFyd0w8BzoTVTmxOi9ODSsYp26FELvSaFaStzYqPB16qMYMNeFSXpfKD7bxypRdd16qpaK5YwcTqrQ1sZjIu6REo7ds7qqp8Rx-Ge6trGeG-cyJoRk2bOwKbCunjxoKt-CZyMl9D_ybQaG2pV56mfxOvFtLrne65EiUlku6ZPzAWm9xo6lIZUEMtg9bjWQF3kjRqlJv44k325HOx9SlFEtZirTWJMo58u7d6mGJFMZqypyECenkvfK82NGzR-73ChMr9aFXmgiCyTwaxxHE4xeXka_iqSqXnCWnazgKnlCYzuJzmF3FMHt7eXkSPFk2J_XX5Gq2iOfj6SyGNVHXuIE38-nr8fwD_BF9gCMK48Xk-CR4Mp29jN7DmiwJS9dwtPTnwfFFEIwv42i-9_rp7PdoEsMiHsfTRTydLODpxwAA4G__2_30aJX7t2JvBOHJ_XGzHXsj-Lg9rO172-9Pu_YaqcWUUNsbQe8sHJz3w0E_HEA4GIXhKAx7O8bu9cOEf3SVwgEG4e7dXvH8A9lulAustwv2O-QOuAtzu2Hr8Gw4OBv6__1z8n9TXv6QlH2EPy7r4NPTiwPc3Dhulv_hZtXGzc0ebpZ33HxgV5HMWb66mkfTX2e1ZXUM8-hVNI9mk2gBd_w8ovfEdjhP7Kqb2Ju9xPb5Ru_fXI6nMzi6ehOfQDR7dwyL6NLZ_gSv5levYQN__hbNIyjhOQwvgn6_3w_8A2cTwLfb22-3X7_dfoWtgtgRPBuM4OOzIfTh2fBT8G8AAAD__1VjvjE=

statement ok
SET optimizer_use_multicol_stats = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zgTva6eYuCbJh_iVI4_LAIHvXBddde7qVPYardFURC0NJK5oUiWpFQ7iwX6EHnCPsmClOI4qGWlWDQXQcTMGc7PmTPs9-EdasOkGMFEJtda0mT18gXgGpNlyXiKGiwaC1VtFQT9PlDO5ReiNCqqkVBDpLJEcSpgRQ3YFUKKGS25hYryEkcgs8zhEmksMQkVhnxhdkUaK5JITgy7wQ54Sl0kG95qN11cncDrlx-8ceObCXvQ9_musdVUGJpYJgVRmknN7KYNKKQuKG9Dfy4pZ3ZDZEYM6oolrQFozEtOdZsjjTQlUvDWOO6KswdbGiSZdM1C7R2ZLidMY-L7URaC6qZXKOiSY9qJNTUvspJzYh2kxh_CLaLYAa35zOG5O7kAuE_mzpKWVror6kAIKxRnCbPEIHfhZlKTUjl2tF4l9sF3S-V8LKlNVsRYarFAYdsDf-BNGNSWZNRYoqhdPQpUlNwy5f6QKctYQl0MxpHF162rYo2XG5bf0Jz8JZlwxRN7a9d0B9fKlYqKlLBcSI1ESEsqZpjzVDfcECZIIlUX1Vjq835QP4PGyQOxrEBZ2jYP4Rb_QwBhUVeUHxx-JY3NNRoH4FTnWBPRUZBo-aW1m4Mw9JdwmTQjqywr2A2mRFFtmUsPU8JEimvv7XCHuUyuH5WUcNFJnaLGlHBqWq2bqrt59iQnGleyQJdU52j6kJw6G8VZrb2Es4K1XnYW_v-8wfgiaEKV4pudWioUlNsNsZJUTNuSNsPepS33HmtZ0phQc3DIHNUfolbMWJlrWpgDarEX6SfO7xlLbQf6u2B3R8XzoDNZlROr8-LUsIJx6tYIsSuNZiV5a7PC06GHasxQEy7ldan8cBuvTtl156VaKpo7hjChSluTi4m8S040esvmrpoez-GX4d76eHaYz5wYmmHDyK7AtpL6qMFwS56JnNz3wL8bFGpb6qWXyh_Eu9XkeqdLjkRpuaRLxg-s9hY3mopUFsRg-8DVSFbgjRStSvU2nnizHfl8TF1KsZSlSGtdopwj796vHpZIYaymzMmYkE7iK8-LHU175I6vMLFSH3qpiSCYzKNxHEE8fnEZ-SqeqnLJWXK6hqPgCYXpLD6H2VUMs7eXlyfBk2VzUn9NrmaLeD6ezmJYE3WNG3gzn74ezz_AH9EHOKIwXkyOT4In09nL6D2syZKwdA1HS38eHF8EwfgyjuZ7r5_Ofo8mMSzicTxdxNPJAp5-DAAA_va_3U-PVrl_L_ZGEJ7cHzcbsjeCj9vD2r63_f60a6-RWkwJtb0R9M7CwXk_HPTDAYSDURiOwrC3Y-xeQEz4h1cpHGAQ7t7tVc8_ku1GucB6u2C_R-6AuzC3H7YOz4aDs6H_3z8n_zXl5U9J2Uf487IOPj29OMDNjeNm-R03qzZubvZws7zj5gO7imTO8tXVPJr-Oqstq2OYR6-ieTSbRAu44-cRvSe2w3liV93E3uwlts83ev_mcjydwdHVm_gEotm7Y1hEl872f_BqfvUaNvDnb9E8ghKew_Ai6Pf7_cA_cjYBfLu9_Xb79dvtV9gqiB3Bs8EIPj4bQh-eDT8F_wYAAP__UE2-kw==

statement ok
RESET reorder_joins_limit

statement ok
RESET enable_zigzag_join

statement ok
RESET optimizer_use_histograms

statement ok
RESET optimizer_use_multicol_stats

#
# Test sequences.
#

statement ok
CREATE SEQUENCE seq

query T
EXPLAIN (OPT, ENV) SELECT * FROM seq
----
https://cockroachdb.github.io/text/decode.html#eJyUVk1PI0kMvedX1HF3NUEBZgZ20BzYTK-EBGEWApo9WU63u-Oluqriqgofv35V1ZkhSHQabhH4Pbvs5-cej9UtiWdrvqipLe_EYrn89peiByoXkXVFogL5oNZd1Gg0HivU2t6DE3IoBOjBugBOo1FL9CosSVVUY9RBrVFH-qJsXSdcaX0AX6LxcM9hCZsoKK0Gz080AK8wVfKoe-POri8_qItv_-bgDTebsJP7eDs4CBqPZWBrwAlb4fDYBzRWWtR96FVEzeERbA2eZM1lbwFCTdQofURCWIE1ureOn815BRs9QW3TsEgykR8iYaEyzyO2BmUzKzK40FQNYn2nizpqDSFBOvwu3HUxT8DgV1p9TX85Uer5MT8jMQabUnSFALdOc8kBPOlUbm0Fokvq6E1lXoNvtypxLDCUS_ABA7VkQn_hL9iMJwlQow_gMCzfBGqjDuzSD1txzSWmGnwSS-7bQKc3JE_cPGED_1ke2jt6cKlPaCrgxlghMDbAmj0nnm7aHthAad2QzrjKj37RPE8-eQMEbsnG0Mcw-YV_F8AEkjXqnZvvrA-NkE8AjdJQp8KkPxB73zvK_ckkJ9G23OyrC9zyE1XgUAKn51EFbCp6yGy7x6ttefemR5lUnZWKhCrQ6HujN11Py5wVDkJL21J61OBe5pKSNXunuTNe0Nxyb7KDycfjDSY3QQCd049bvXRkUIdHCBbWLCHiZtOHjOWZsfMkoRL90Ia9BC3ZB9sItu9C5U3L9yXg-_Jtr0ie_-AjXQNBmnbPc8sa0-2AsBTyS6t7hzTZO8xQoZoEtLV30eWV9tmS6rvBpGIdNkkZbFwMnajYNEOuK5QjN7k6WXxVnw9fNeCsCr_S4LGmjRKHCvvlo29aiHTZ2TTwPIP8seBIQpRF9sd34tM9SrOTqAmc2AUuWO-45z00gqayLXjqX7QOyS09WdPrUDfzaQ7bss239CWahY2m6vwItSY9fFQzrLTGB0FO9mVssvZ11sWWl73xsK-pDFZ2fZ6Z0Wh6VZzOC3Vd_HNTzKaFcnGhudzztFIXZ7Pb0_ObQu2ri9Mf3c8_Dw4OD48OJoefjz99PDr6dDw5Umez6VVxUczmal9dz0-v5mr_ZDQqfnw_Pz2bqd8uv88_qGJ2-7u6Ls6L6Vz9of6-urxQnlYno_F4PB55WkUyJY2774L0n9H_AQAA__9Lw-dC

#
# Test views.
#

statement ok
CREATE VIEW v AS SELECT a, b, u, v FROM x, y WHERE b = 3

query T
EXPLAIN (OPT, ENV) SELECT * FROM v
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u27gSvo6eYuCbxgd2IscHB4GDAsd11V3vpk5hq38oCoKSRjY3FKmSlGpnsUCxz5DLfbo8yYKUnDjbyEqwaC4Cm55vfr_5yH4f3qHSTIoRTGR8qSSNVy9fAK4xjgrGE1RgUBsoKyvP6_eBci6_klxhThUSqonMDck5FbCiGswKIcGUFtxASXmBI5BpanGx1IbomApNvjKzIrUViSUnml1hCzyhNpMNb7SbLi568PrlR2dc-2bC7PV9umtsFBWaxoZJQXLFpGJm0wQUUmWUN6G_FJQzsyEyJRpVyeLGBBQuC05VkyOFNCFS8MY8ts15AFtoJKm0w0LlHOk2J0xh7OZRZIKqelYoaMQxacXqihdpwTkxFlLh9-EWQWiBRn_h8NyenAHcFbO1pIWRNkSVCGFZzlnMDNHIbbqpVKTILTsaQ4mH4Lutsj4iauIV0YYazFCY5sTveRMalSEp1Ybk1KweBcoKblhuP8iEpSymNgdtyeL61tLp2skVW17RJflNsra9w3Vu-0RFQthSSIVESENKppn1U01bEyZILPM2nrHEFX2veRq11QZiWIayME0e_Fv8kwDCoCop37v5udRmqVBbAKdqiRULLf-Ikl8bRznwfReEy7je19ywjF1hQnKqDLPlYUKYSHDtvO0fL5fx5aOKEjY7qRJUmBBOdaN13XW7zI7hROFKZmiLat1Ll5KVZp1zVgkv4SxjjcFO_P-e1hjXBEVonvPNTi9zFJSbDTGSlEyZgtab3iYsdx4rTVIYU922YfdBK6aNXCqaPQnlNs3dL4Y-Ld7uirj5txaZL4lRy-xIs4xxau8OYlYK9UryxiH5R0MHVZiiIlzKyyJ3K62dJKWXrUGVzOnSMoOJvDAVqZhYtqmuQmdZx6po8Rz-N3xQgB0r9BdONE2xZmJbYrc6-qiFsDc7E0tyNwP3WMhRmUJFTh-fiLf3kZ2dKjiSXMmIRozvuc8b3CgqEpkRjc2LViFZhldSNCrU23DizHZk8zF9KUQkC5FUekQ5R95-qTpYLIU2ijIrX0JaaS8dL3a07JEXe4mxkWrf80x43mQejMMAwvGL88B18SgvIs7iozUcegcUprPwFGYXIczenp_3vIOoPqm-TS5mi3A-ns5CWJP8EjfwZj59PZ5_hF-Dj3BIYbyYdHvewXT2MvgAaxIRlqzhMHLnXvfM88bnYTB_MPx09kswCWERjsPpIpxOFvDskwcA8Lv7b_86tFy6R2JnBH7v7ri-GTsj-HR7WNl3br9_3rVXSA0mhJrOCDon_uC07w_6_gD8wcj3R77f2TG2zx4m3GurEBYw8HdjO7lzL2OzyW1inV2wuz-2wF2YvRduHZ4MBydD99sfvX9bcvRDSnYZ_riqvc_PzvZwc2O5WXzHzbKJm5sHuFlsuXnPriSptXx1MQ-mP80qy7IL8-BVMA9mk2ABW34e0jtiW5wjdtlO7M2DxN6t9900eL8NU7ottHvX8w4KW6PXhfECFsG59UF7EPWg6EEJr-YXr-9vUO8fcd__HMwDiOA5DM88L_jw5nw8ncHhxZuwB8HsXXfr9D-Vr_LM6_f7fY8JgarvXquHsZJadz24uf7r5vrbzfU3cG-rzXcn6__Xy25_-dPO9Ob6uja4VTgzguOT48EIPh0PoQ_Hw8_ejlnKuEGl4dCoArve3wEAAP__G_v_PQ==

#
# Test tables in user-defined schemas.
#

statement ok
CREATE SCHEMA s;
CREATE TABLE s.t (a int primary key)

query T
EXPLAIN (OPT, ENV) SELECT * FROM s.t;
----
https://cockroachdb.github.io/text/decode.html#eJyUVlFv20YMfq5-xb21HeogW4ehaNAH1_UAb44T2GqxYBgIWqLkW053Fx7lxPn1w53cxhkiK3kzDH4feeTHjxqN1DfioJ39qCauuGaHxebLZ0V3VKxbbUpiJRREbbuoLBuNFBrjbsEzeWQCDOC8gDdo1QaDkg2pkipsjagtmpY-KldVEVe4IBAKtAFutWxgHwWFMxD0PQ3AS4yV7Exv3Gx18U6df7lKwXtubeUo94fDYGG0AQvRzoJn7VjLrg9oHTdo-tA3LRotO3AVBOKtLnoLYKpbg9xHxIQlOGt66_jenCewbSCoXBwWcSIKQySaqUjzaBuLvJ8VWVwbKgexodNF1RoDEiEd_hhuNc0jUMKNUZ_iP2dKPTzmeyS24mKKrhDQjTe60AKBTCy3cgytj-roTWWfgh-2KnKsUYoNBEGhhqz0F_6IzQZigQqDgEfZPAvUtEa0jz9cqStdYKwhRLGkvg10ek9yr-t7rOFfp4f2ju587BPaEnRtHRNYJ7DVQUeebtoBtIXC-SGd6TI9-lHzAoXoDSC6IddKH8PpD_yLAFaIt2iObr53QWqmEAEGuaZOhVF_wO62d5Q_n56mJMYV-331oht9TyV4ZNHxeVSCtiXdJbbj4zWuuH7Wo2ysznFJTCUYDL3R-67HZU4KB6aNayg-anAvU0nRmoM3ujNeMLrRvcl-Of31wx6TmsCA3pvdQS89WTSyA3Gw1Swt7jd9yFgeGDtPYiowDG3YY9BGB3E1Y_MiVNq0dF8EX5bvcEXS_Acf6WsQrpuToBttMN4OkA1T2DjTO6TTk_cJylQRg3HuuvVppUOypOp6MCk7j3VUhra-lU5U2tZDrsuUIve5Oll8Ur-9f9KAkyrCjYGAFe2VOFTYDx991kLEy65tDQ8zSB8LnlhaXid_fCE-3qM4O24NgWe3xrU2R-55Dw2jLV0DgfoXrUPqhu6d7XWor_kkhR3Y5nP60tq1a23Z-REaQ2b4qCZY4WwQRh3ty7po7dukiwMve-Zh31Ihjo99ntksmyyn43yq8vHn-TR18SSciHqTvUI1W-Qf1OIiV4uv8_m77NXkYrHKl-PZIlcC_pp26nI5Ox8vr9Sf0yv1BtV4NXmbvT3LsvE8ny7_zzlb_DGd5GqVj_PZKp9NVur13_-8Psuy6V-X8_Fsod5cXObv1HTx7a1aTecx9if1-_LiXIUTOctGo9EoS04u2X8BAAD___JQ7cY=

#
# Test default_transaction_quality_of_service settings.
#

statement ok
SET default_transaction_quality_of_service=background

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVs1OHEkMvs9T1BEkJoLNahUl4pBNOETKJpEgaPdkebrdPV6qy4XLPfyc8hA8IU8SVXUnDBI9DbfRyN9nl_35cy-X7pw0sYS37oNUFypYrT_-7eiaqlXPviZ1RsncZohaLJZLh97LFUSliEqACSQaRI_BrTE5W5OrqcHem9ug7-mtk6bJuEqSQaowJLhiW8MYBZV4SHxLM_AacyU3fjLu0-nXA_fPx_9K8MjNwXZyv9kONsWQsDKWAFFZlO1mChhEO_SL05OzJ-GXPXq2G5AGEumGK3LHboXVRavSh_qdcw95f1Eqtb1HnapICWuQ4CdL-tWnJ7B9Imgkz420EKU5Elaqymj6LqCOY6OAK0_1LDYNEml678EyZMDvwpVGcrJ06d1x_ufJFmFvklMMhQB30XPFBol8LrcRhT5moUymCk_Bt1uVOVZo1RqSoVFHwaYLf8QWEqlBg8kgoq2fBep6bxzzD6m54QpzDSnLpvRtptMjyS23t9jC_8JzK0jXMfcJQw3cBlGCIAYbTpx5hmkn4ACVxDmdcV0e_ah5iVK2CTDuSHqbYjj8jX8RIBjpBv1OE4iSrFVKGeBRWxpUmPUHKleTozw6PCxJvFTj5kbjjm-phohqnJ9HNXCo6bqw7R6vl-riWY8KuTrRmpRq8Jgmo8eu52UuCgeltXSUHzW7l6Wk7NIpeh48GDx3PJnsj8M_34yY0gQFjNHfbPUyUkBvN2ACG1brcdz0OWN5YBw8SanCNLdhj0FrTiatYvciVNm0cmoMX5Zve0XK_GcfGVswbbtXiTv2mM8I2FoprcVPDunw1esCVWpIwYtc9LGsdCqW1FzMJlWJ2GZlcIi9DaLi0M65rlKJHHMNsjh2f71-0oCLKtKlh4QNjUqcK-y3jz5rIfKR59DCwwzKd0MktV5XxR9fiM_3KM9Oe08QVVa4Yr_jtE_QKIZaOkg0vWgDkju6lTDpUN_PPpSwLdt8Tl_6sMpfDoMfoffk549qgVUSkilytq8g2do3RRdbXvbMw76hykR3famFxeLk32-f33_64va-fjs7cCdfzvfd-fvP309O3d7R_rvFcrlcLkp4Wrj7u7v7ux_3dz_c3tHB_uJnAAAA__-RPdM_

statement ok
SET default_transaction_quality_of_service=critical

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVs1OHEkMvs9T1BEkJoLNahUl4pBNOETKJpEgaPdkebrdPV6qy4XLPfyc8hA8IU8SVXUnDBI9DbfRyN9nl_35cy-X7pw0sYS37oNUFypYrT_-7eiaqlXPviZ1RsncZohaLJZLh97LFUSliEqACSQaRI_BrTE5W5OrqcHem9ug7-mtk6bJuEqSQaowJLhiW8MYBZV4SHxLM_AacyU3fjLu0-nXA_fPx_9K8MjNwXZyv9kONsWQsDKWAFFZlO1mChhEO_SL05OzJ-GXPXq2G5AGEumGK3LHrlI2rtC_c-4h6y9Cpbb3qFP1KGENEvxkQb-69AS2TwSN5KmRFqI0R8JKVRlM3wXUcWgUcOWpnsWmQSBN7z1Yhgz4XbjSRk6WLr07zv882SLsTXKKoRDgLnqu2CCRz-U2otDHLJPJVOEp-HarMscKrVpDMjTqKNh04Y_YQiI1aDAZRLT1s0Bd741j_iE1N1xhriFl0ZS-zXR6JLnl9hZb-F94bgHpOuY-YaiB2yBKEMRgw4kzzzDtBBygkjinM67Lox81L1HKJgHGHUlvUwyHv_EvAgQj3aDfaQFRkrVKKQM8akuDCrP-QOVqcpRHh4cliZdq3Nto3PEt1RBRjfPzqAYONV0Xtt3j9VJdPOtRIVcnWpNSDR7TZPTY9bzMReGgtJaO8qNm97KUlD06Rc-DA4PnjieT_XH455sRU5qggDH6m61eRgro7QZMYMNqPY6bPmcsD4yDJylVmOY27DFozcmkVexehCqbVg6N4cvyba9Imf_sI2MLpm33KnHHHvMRAVsrpbX4ySEdvnpdoEoNKXiRiz6WlU7FkpqL2aQqEdusDA6xt0FUHNo511UqkWOuQRbH7q_XTxpwUUW69JCwoVGJc4X99tFnLUQ-8RxaeJhB-WqIpNbrqvjjC_H5HuXZae8JosoKV-x3HPYJGsVQSweJphdtQHJHtxImHer72YcStmWbz-lLH1bSh3rwI_Se_PxRLbBKQjJFzvYVJFv7puhiy8ueedg3VJnoru-0sFic_Pvt8_tPX9ze129nB-7ky_m-O3__-fvJqds72n-3WC6Xy0UJTwt3f3d3f_fj_u6H2zs62F_8DAAA___xENJq

#
# Test recursive table references from foreign keys.
#

statement ok
CREATE TABLE z (
  pk INT PRIMARY KEY,
  ref INT,
  CONSTRAINT fk FOREIGN KEY (ref) REFERENCES y(u),
  FAMILY "primary" (pk, ref)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM z;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zgTva6egvBNkw9xICcfFoGDXriuuvBu6hS2WrQoCmIsjWSuKZLlj2J7se--IOUkDmpZCRbNRRAxc4bzc-YM-33yGbVhUgzJWGYrLSFbvntLcI3ZwjGeoyYWjSV1YxVF_T4BzuUdVRoVaKRgqFSWKg6CLMEQu0SSYwGOW1IDdzgksig8LpPGUpOBMPSO2SXdWdFMcmrYFjvgOfhINrzVbjK_PSMf3n0NxjvfTNijvq_2ja0GYSCzTAqqNJOa2U0bUEhdAY_mSXoQ_sMBZ3ZDZUEN6pplSN6QTDPLMuDXhDzeeu9QY-k46LZ4NEJOpeCtAd1X6QDWGaSF9F1DHRyZLidMYxYa4yoBetc0FLDgmHdiTUOQwnFOrYc0-GO4UEZmrPnByRt_crBE4Kz0VzSBUFYpzjJmqUHuwy2kpk55mrReJQ7B90vlfSzAZktqLFisUNj2wJ94Ewa1pQUYSxXY5bNAleOWKf-HzFnBMvAxGE-aULeOSu-cbFm5hZL-JVnXAOJa-TqByCkrhdRIhbS0ZoZ5P023DWWCZlJ18YzlIeknxTNovEhQyyqUzrZ5iB_wLwIIi7oGflQClDS21Gg8gIMusWGh5x_V8q61lYM4Dpdwme3mVllWsS3mVIG2zKeHOWUix3Xwdry9XGarZyUlfHRS56gxpxxMq_Wu6n6YA8OpxqWs0CfVOZchJK_RRnHWKDDlrGKtl13E_7_aYUIRNAWl-GavlgoFcLuhVtKaaetgN-ldwvLosdEkjRmYrgl7CloyY2WpoXoRKkxaWDQWXnbf_oiE_ncmqUpqdVmdG1YxDn6JULvUaJaStzYpPr8MUI0FasqlXDkVRtoESSpWnZdqqaD0zGBCOduQiomyS3U1BsvdXQ0t3pDfLg8KcGCF-cGpgQJ3TOwK7EFHnzUQfsUzUdLHHoRXg0JtnV4EfXwh3u8j3zvtOFKl5QIWjB9Z7C1uNIhcVtRg-6A1SFbhVopWhfqUjoPZnmw-py5OLKQTeaNHwDny7qUaYJkUxmpgXr6E9NJeB17sadkzF3uNmZX62DtNRNF4lozShKSjtzdJqOK5cgvOsvM1OYleAZlM0ysyvU3J9NPNzVn0arE7ab7Gt9N5OhtNpilZU7XCDfk4m3wYzb6SP5Ov5ATIaD4-PYteTabvki9kTReU5Wtysgjn0el1FI1u0mR28PrJ9I9knJJ5Okon83QynpPX3yJCCPk7_PY_PajL8FrsDUl89ni824y9Ifn2cNjY9x6-v-_bawSLOQXbG5LeRTy46seDfjwg8WAYx8M47u0Z-2cPE-G15YQHDOL9u4PchSey3SgfWG8fHPbHPXAf5vfCg8OLy8HFZfjfP2f_NeXFL0k5RPjrso6-v74-ws2N56b7iZt1Gzc3B7jp7rn5xK6mhbd8fztLJr9PG8v6lMyS98ksmY6TObnn5wk8EtvjArHrbmJvDhL7eL5bn69a_ZSwxqIt5e2BlNXqQM7F6mm2GotD-W5O3PG8tu15JV8-3owmU3Jy-zE9I8n08ymZJzfe9n_k_ez2A9leR_1-vx-Fh9o2-jcAAP__G-_sKw==

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zgTva6egvBNkw9xICcfFoGDXriuuvBu6hS2WrQoCmIsjWSuKZIlKcXyYt99QUpJHNSyEiyaiyBi5gzn58wZDofkM2rDpBiTqUw2WkKyfveW4BaTVcl4ippYNJZUjVUQDIcEOJd3VGlUoJGCoVJZqjgIsgZD7BpJihmU3JIKeIljIrPM4RJpLDUJCEPvmF3T1oomklPDdtgDT8FFUvNOu9ny9ox8ePfVG7e-mbBHfV_tG1sNwkBimRRUaSY1s3UXUEhdAA-WUXwQ_qMEzmxNZUYN6oolSN6QRDPLEuDXhDzeeu9QY15y0F3xaISUSsE7A7qv0gFsaZBm0nUNtXdk-pwwjYlvTFkI0G3TUMCKY9qLNQ1BspJzah2kwR_D-TIyY80PTt64k4MlgtJKd0UTCGWF4ixhlhrkLtxMaloqR5POq8Qh-H6pnI8V2GRNjQWLBQrbHfgTb8KgtjQDY6kCu34WqCi5Zcr9IVOWsQRcDMaRxtetp9Ktkx3Ld5DTvyTrG0DcKlcnEClluZAaqZCWVsww56fptqFM0ESqPp6x1Cf9pHgGjRMJalmBsrRdHsIH_IsAwqKugB-VACWNzTUaB-Cgc2xY6PhHtbzrbOUoDP0lXCbt3CrLCrbDlCrQlrn0MKVMpLj13o63l8tk86ykhItO6hQ1ppSD6bRuq-6G2TOcalzLAl1SvXPpQ3IabRRnjQJTzgrWedlF-P-rFuOLoCkoxeu9WioUwG1NraQV07aEdtL7hOXRY6NJGhMwfRP2FLRmxspcQ_EilJ80v2gsvOy-_RHx_e9NUuXU6rw4N6xgHNwSoXat0awl72xSeH7poRoz1JRLuSmVH2njJSnb9F6qpYLcMYMJVdqGVEzkfaqr0Vu2dzW0eEN-uzwowJ4V5genBjJsmdgX2IOOPmsg3IpnIqePPfCvBoXalnrl9fGFeLePXO90yZEqLVewYvzIYu9wo0GksqAGuwetQbICd1J0KtSneOrN9mTzOXUpxUqWIm30CDhH3r9UPSyRwlgNzMmXkE7aK8-LPS175mKvMLFSH3uniSCYLqJJHJF48vYm8lU8V-WKs-R8S06CV0Bm8_iKzG9jMv90c3MWvFq1J83X9Ha-jBeT2TwmW6o2WJOPi9mHyeIr-TP6Sk6ATJbT07Pg1Wz-LvpCtnRFWbolJyt_HpxeB8HkJo4WB6-fzf-IpjFZxpN4toxn0yV5_S0ghJC__W_3M4Aq96_FwZiEZ4_H7WYcjMm3h8PGfvDw_X3fXiNYTCnYwZgMLsLR1TAcDcMRCUfjMByH4WDP2D17mPCvrVI4wCjcv9vLnX8i21q5wAb7YL8_7oH7MLcXHhxeXI4uLv3__jn7rymvfknKPsJfl3Xw_fX1EW7WjpvlT9ysurhZH-Bmec_NJ3YVzZzl-9tFNPt93lhWp2QRvY8W0XwaLck9P0_gkdgO54ld9RO7Pkjs4_nuXL5q81PCGrOulHcHUlabAzlnm6fZaswO5VuflMfz2nXnFX35eDOZzcnJ7cf4jETzz6dkGd042_-R94vbD6S-DobD4TDwD7U6-DcAAP__G97sKQ==

query T
EXPLAIN (OPT, ENV) SELECT * FROM x;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zgTva6egvBNkw9xICcfFoGDXriuuvBu6hS2WrQoCmIsjWSuKZLlj2J7se--IOUkDmpZCRbNRRAxc4bzc-YM-33yGbVhUgzJWGYrLSFbvntLcI3ZwjGeoyYWjSV1YxVF_T4BzuUdVRoVaKRgqFSWKg6CLMEQu0SSYwGOW1IDdzgksig8LpPGUpOBMPSO2SXdWdFMcmrYFjvgOfhINrzVbjK_PSMf3n0NxjvfTNijvq_2ja0GYSCzTAqqNJOa2U0bUEhdAY_mSXoQ_sMBZ3ZDZUEN6pplSN6QTDPLMuDXhDzeeu9QY-k46LZ4NEJOpeCtAd1X6QDWGaSF9F1DHRyZLidMYxYa4yoBetc0FLDgmHdiTUOQwnFOrYc0-GO4UEZmrPnByRt_crBE4Kz0VzSBUFYpzjJmqUHuwy2kpk55mrReJQ7B90vlfSzAZktqLFisUNj2wJ94Ewa1pQUYSxXY5bNAleOWKf-HzFnBMvAxGE-aULeOSu-cbFm5hZL-JVnXAOJa-TqByCkrhdRIhbS0ZoZ5P023DWWCZlJ18YzlIeknxTNovEhQyyqUzrZ5iB_wLwIIi7oGflQClDS21Gg8gIMusWGh5x_V8q61lYM4Dpdwme3mVllWsS3mVIG2zKeHOWUix3Xwdry9XGarZyUlfHRS56gxpxxMq_Wu6n6YA8OpxqWs0CfVOZchJK_RRnHWKDDlrGKtl13E_7_aYUIRNAWl-GavlgoFcLuhVtKaaetgN-ldwvLosdEkjRmYrgl7CloyY2WpoXoRKkxaWDQWXnbf_oiE_ncmqUpqdVmdG1YxDn6JULvUaJaStzYpPr8MUI0FasqlXDkVRtoESSpWnZdqqaD0zGBCOduQiomyS3U1BsvdXQ0t3pDfLg8KcGCF-cGpgQJ3TOwK7EFHnzUQfsUzUdLHHoRXg0JtnV4EfXwh3u8j3zvtOFKl5QIWjB9Z7C1uNIhcVtRg-6A1SFbhVopWhfqUjoPZnmw-py5OLKQTeaNHwDny7qUaYJkUxmpgXr6E9NJeB17sadkzF3uNmZX62DtNRNF4lozShKSjtzdJqOK5cgvOsvM1OYleAZlM0ysyvU3J9NPNzVn0arE7ab7Gt9N5OhtNpilZU7XCDfk4m3wYzb6SP5Ov5ATIaD4-PYteTabvki9kTReU5Wtysgjn0el1FI1u0mR28PrJ9I9knJJ5Okon83QynpPX3yJCCPk7_PY_PajL8FrsDUl89ni824y9Ifn2cNjY9x6-v-_bawSLOQXbG5LeRTy46seDfjwg8WAYx8M47u0Z-2cPE-G15YQHDOL9u4PchSey3SgfWG8fHPbHPXAf5vfCg8OLy8HFZfjfP2f_NeXFL0k5RPjrso6-v74-ws2N56b7iZt1Gzc3B7jp7rn5xK6mhbd8fztLJr9PG8v6lMyS98ksmY6TObnn5wk8EtvjArHrbmJvDhL7eL5bn69a_ZSwxqIt5e2BlNXqQM7F6mm2GotD-W5O3PG8tu15JV8-3owmU3Jy-zE9I8n08ymZJzfe9n_k_ez2A1lfR_1-vx-Fh9o6-jcAAP__G83sJw==

# A foreign key cycle shouldn't cause infinite recursion.
statement ok
ALTER TABLE y ADD CONSTRAINT fk FOREIGN KEY (v) REFERENCES z (pk);

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vl1v2zoSfa5-BeGXOos4kJPFInDQB9dVF95NncJWixZFQYylkcxrimRJSrV8cf_7BSklcVDLSnDRPAQRM2e-eOYMRyPyGbVhUkzITCZbLSHZvHtLcIfJumQ8RU0sGkuqxioIRiMCnMufVGlUoJGCoVJZqjgIsgFD7AZJihmU3JIKeIkTIrPM4RJpLDUJCEN_MruhrRVNJKeG7bEHnoLLpOaddvPV3Tn58O6rN259M2FP-r4-NLYahIHEMimo0kxqZusuoJC6AB6sovgo_EcJnNmayowa1BVLkLwhiWaWJcBvCHmMeu9QY15y0F35aISUSsE7E7rv0hFsaZBm0t0aau_I9DlhGhN_MWUhQLeXhgLWHNNerGkIkpWcU-sgDf4UzreRGWt-cPLGnRxtEZRWuhBNIpQVirOEWWqQu3QzqWmpHE06Q4lj8MNWOR9rsMmGGgsWCxS2O_En3oRBbWkGxlIFdvMsUFFyy5T7Q6YsYwm4HIwjje9bT6dbJ3uW7yGnf0jWN4C4U65PIFLKciE1UiEtrZhhzk9z24YyQROp-njGUl_0k-YZNE4kqGUFytJ2eQgf8C8CCIu6An5SApQ0NtdoHICDzrFhoeMf1fJn51WOw9AH4TJp51ZZVrA9plSBtsyVhyllIsWd93b6erlMts8qSrjspE5RY0o5mE7rtutumD3DqcaNLNAV1TuXPiWn0UZx1igw5axgncEuw39ftxjfBE1BKV4f9FKhAG5raiWtmLYltJPeJyyPHhtN0piA6Zuwp6ANM1bmGooXofyk-UVj4WXxDkfE339vkSqnVufFhWEF4-CWCLUbjWYjeeclhRdXHqoxQ025lNtS-ZE2XpKybW9QLRXkjhlMqNI2pGIi71Ndjd6yjdXQ4g35z9VRAfasMD84NZBhy8S-xB509FkD4VY8Ezl9vAP_alCobanXXh9fiHf7yN2dLjlSpeUa1oyfWOwdbjSIVBbUYPegNUhW4F6KToX6FM-82YFsPqcvpVjLUqSNHgHnyPuXqoclUhirgTn5EtJJe-V5caBlz1zsFSZW6lPvNBEEs2U0jSMST9_eRr6LF6pcc5Zc7MgweAVkvoivyeIuJotPt7fnwat1e9J8ze4Wq3g5nS9isqNqizX5uJx_mC6_kv9HX8kQyHQ1OzsPXs0X76IvZEfXlKU7Mlz78-DsJgimt3G0PBp-vvhfNIvJKp7G81U8n63I628BIYT86X-7nwFUuX8tDiYkPH88bjfjYEK-PRw29oOH7--H9hrBYkrBDiZkcBmOr0fheBSOSTiehOEkDAcHxu7Zw4R_bZXCAcbhYWwvd_6JbGvlEhscgv3-uAcewtxeeHB4eTW-vPL_--v8n5a8_i0l-wx_X9XB99c3J7i5d9xU21_IqTHrouf-CD3V9p6fB4bZlry_W0bz_y4aI43ZGVlG76NltJhFK9KmUA_L0wTeHyXw6bpqV1f5S1lVV1H1kaLKIzXVtKKZs3xSWXWsrt0QehpyFLYfqu3joLt4ftCr_kGvu_sUffl4O50vyPDuY3xOosXnM7KKbp3tv8j75d0HUt8Eo9FoFPgHXh38HQAA___Zxvvt

# Check that we remove histograms from statistics correctly.

statement ok
CREATE TABLE b (
  b BOOL NOT NULL,
  INDEX (b)
)

statement ok
ALTER TABLE b INJECT STATISTICS '[
      {
          "avg_size": 1,
          "columns": [
              "b"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 2,
          "histo_buckets": [
              {
                  "distinct_range": 0,
                  "num_eq": 1000,
                  "num_range": 0,
                  "upper_bound": "false"
              },
              {
                  "distinct_range": 0,
                  "num_eq": 100,
                  "num_range": 0,
                  "upper_bound": "true"
              }
          ],
          "histo_col_type": "BOOL",
          "histo_version": 2,
          "name": "__auto__",
          "null_count": 0,
          "row_count": 1100
      },
      {
          "avg_size": 0,
          "columns": [
              "rowid"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 0,
          "histo_col_type": "",
          "name": "__auto__",
          "null_count": 0,
          "row_count": 0
      }
]'

query T
EXPLAIN (OPT, ENV) SELECT * FROM b
----
https://cockroachdb.github.io/text/decode.html#eJy8VlFv2zYQfq5-BeGXpkMcOE63pQ764Dou4M21i1gtWhTFgZJO8i0UyZCUE2fYfx9IKYkDRFbysPnBsMn7jsfv7r5jv8--orGk5IhNVHppFE_X5x8Y3mCaVCQyNMyhdWxTW0VRv8-4EOoatEHNDQK3oLQDLbhka26ZWyPLMOeVcGzDRYUjpvLc41JlHdiUSwvX5NbQWEGqBFi6xQ54xn0kW9FqN1stD9mn8-_BuPFN0u31fbpr7AyXlqeOlARtSBly2zagVKbkIlpN4yfhVxUX5LagcrBoNpQie89SQ45SLs4Yezj1zqHBohLctMVjkGegpGgN6I6lJ7CVRciVzxqa4Mh2OSGDaUhMVUpumqSh5InArBNr6wLJKyHAeUiN34cLNJJ19kqw937lSYp45ZQ_og4EqNSCUnJgUfhwc2Wg0r5MWo-ST8F3qfI-Eu7SNVjHHZYoXXvgj7xJi8ZBzq0Dzd36WaCyEo60_6EyyinlPgbriybw1sF04-SWiltewF-KuhoQb7TnicsMqJDKIEjlYEOWvJ862xZIQqp0V51RFi79iDyL1osEOCpRVa7Nw-Ae_yKAdGg2XOyVAK2sKwxaDxDcFFhXoa8_MOq6NZXHg0E4RKi06VvtqKRbzEBz48hfDzMgmeFN8LY_vUKll8-6lPTRKZOhwQwEt63WDeu-mUOFg8G1KtFfqrMvQ0heo60WVCswCCqp9bDh4O1pgwkkGOBai-0OlxolF24LTsGGjKt40-ldwvLgsdYkgym3XR32GLQm61RhePkiVOi0MGgcf9l5uy0S8t95SV2AM0V5ZKkkwf0QAbc2aNdKtCZpcHQSoAZzNCCUuqx0aGkbJCm_7DzUKM0LXxkkdeXqoiJZdKmuwWDZnFWXxXv228mTAhyqwl4JsDzHphK7ArvX0Wc1hB_xJAt4yEF4NWg0rjJJ0McX4v088rkzlUDQRiU8IbFnsLe4MVxmqgSL7Y1WI6nEWyVbFepLPAlmO7L5HF4qmahKZrUecSFQdA_VAEuVtM5w8vIllZf2TaiLHS175mDfYOqU2fdOk1E0uZiO4ymLxx_m08Dika4SQelRwg6iVwn7sFzO2WIZs8WX-fwwemXUNWVstohPw-rX2WrmkXcW7Hz6cfxlHrNK0lUV5I6ygzeH0avJcrGKL8azRcwS0Je4ZZ8vZp_GF9_Zn9Pv7KD2O15NvO1scT79xhJIgLIbdpCE9ejNWRSN5_H04sloZ4s_ppOYreJxPFvFs8mKvf4RMcbY3-Hbf3p8U4THZW_Ejg8flptB2huxH_eLYSPp3f__uWtvkDvMgLveiPWGg-GwfzzsD4bs-HR08nY0fHf06-9v350MezsY_1giGd5olfS44c5mkMjwrHZb7aPr7UIlL8MagH9PATza8wp_53Kws-HnzN368fFgEHb-OdzDyOA5jIQ0_YesDP4_VhpKop-vz6Jo-u3zfDxbsIPl5_iQTRdf37DVdO4L6hf28WL5iSVnUb_f70fhLZFE_wYAAP__C9uLwQ==
