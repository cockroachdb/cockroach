# LogicTest: local !metamorphic-batch-sizes
# We must turn off metamorphic variables because some are included in
# EXPLAIN (OPT, ENV) output.

statement ok
CREATE TABLE x (
  a INT PRIMARY KEY,
  b INT,
  INDEX (b),
  FAMILY "primary" (a, b)
)

statement ok
ALTER TABLE x INJECT STATISTICS '[
  {
    "id": 1,
    "columns": ["a"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 100,
    "histo_col_type": ""
  },
  {
    "id": 2,
    "columns": ["b"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 123123,
    "histo_col_type": ""
  }
]'

statement ok
CREATE TABLE y (
  u INT PRIMARY KEY,
  v INT REFERENCES x,
  INDEX (v),
  FAMILY "primary" (u, v)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM x WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VtFu2zYUfY6-4sIvTgbLkeylMGwYmOswnTZXDiSlaxEEBEVRDVGZdEnKtTcM6EfkV_YD-5R8yUDJcOxMWdZ11YMBUeeee3juIWHXhTdMaS7FEKaSflCS0Nvzl8DWjKYlLzKmwDBtYFWjHMd1QTGSuVIUGyCluWXCcEoMlwIvmLmVGYyBMmXcJdH6k1SZE6MEMmJISjSDMbQtYXsE4LqQsZyUhYEVKUo2hBrKFaMGU1mUC0EU1pQIjZkgacEsuczzxmKZ59t6bfTH4h-QpDSygnKRsTVWjMrFgoms2sW_aiUOfeAa63LJVKmZsmWPPheSkoKbDYxBsfdcirG1oJPRcUb9Q6iQGcPc9n70QTFdFkbjtMxzprDmv1ovz3rf9waDQ6Rm2o5qyzLov8j7XnZ29oL1BoOBd_g8aqJ10SDfKCI0odWIl4pLVW9FSLUgxdNQbYgpNYwhlMlaOJXh09lVnKAIYpQkQfgKckZMqVh3xaiRClfz6D743zaqZM1RyUmhWSOn_lh0qcpSzIVhSpCiaywfVvJTpYlrw6nuEo1ljg1fVJl0_T__0M2dXN_TTzbaYnX3IXVtmefNTLvcNTFZabprIQtiOLX5L1jl5L4h1bab2a1X_4V9watZ1Q7ZebXPmhuced4z_LlUjBJt9P8nWW-0YQtcjVBju4F6_QsaOFcxqm6xkTON0CRBkExezhAsy7TgtLuGY-eIQBAmAwjnCYRXs1nHOUq3K_XbdB7GSTQJwgTWePmBbeAyCl5PonfwM3oHxwQm8fSk4xwF4Tl6C2ucYp6t4Tit1p2TkeNMZnaDdWcrprtrH4Q_oWkCcTJJgjgJpjG0rx0AgN-qX_u0yOp9deZbQ_A6D8v1JalbQ7jeLdb41u79Zh-vGDEsw8S0htDqef7A9XzX88Hzh5439LzWHthGmovqKi6FLfC9_d63XBtpg4TNZmmFtfaLeWYL9hZEWRQ7pn0eey53HXp9v9evvv3e-VoP0m_iQaXwy2zofY0Nzk179FyENzbC5d8ivHoqwpuGCJeHEd7gVR3h1fMR3jRG2Op-umJyfg4HilY4t5ou5hEKXoW1ptUJROgCRSicovjRqTkmVhJ6ezmbBCEczy-TDqDwzQnEaGa1fAcX0fw1rOGXH1GEIIUx9EeO67quY_9RwPqH7Sl14P7u7v7u8_3dZ6BSaKMIF2YIp71TfwjXp31w4bR_4_wVAAD__5MiuVg=


statement error pq: at or near "EOF": syntax error: the ENV flag can only be used with OPT
EXPLAIN (ENV) SELECT * FROM x WHERE b = 3

#
# Multiple Tables.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x, y WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VtFu2zYXvq6e4sA3tn9Yjmz_KQwHBuY6SufNVQJL6VoEAUFRVMNVJl0eyrU2DCj2DLnca-wF9ih5koGS4dipsqzrpgsDPPzOOR-_85Gw68JrrlEoOYKpYu-1ouzm9AXwDWdxLrKEazAcDawrlOO4LmhOE1fJrACamxsujWDUCCXJkpsblcAYGNfGXVHEj0onTuhHkFBDY4ocxtC0BZsnAK4LCU9pnhlY0yznI6igQnNmCFNZvpRUE2RUIuGSxhm3xVWa1iarNN3mo8EP2V8gaW5UCRUy4RuiOVPLJZdJeYq_1Uoe6iCQYL7iOkeubdqD7UwxmglTwBg0fyeUHFsJOgkbJ6x3CJUq4UTY3g82NMc8M0jiPE25Jih-sloe9__fHw4PkcjRjmpbZTh4ng685Pj4Oe8Ph0Pv8HvQBDGroW80lUhZOeKVFkpXR5FKL2n2OBQNNTnCGAIVbaRTCj6dX4aRv4DQj6JZ8BJSTk2ueXfNmVGalPPo3uvfNDrn9VZJaYa8tiZ-yLpMJzER0nAtadY1th7R6mPJSaARDLsUiUqJEcvSk27vj9-xvpPb8_DRRlssdu9d11RpWl9p57u6SpYadi1kSY1g1v8ZL5XcF6Q8dn11q9U_qb4U5awqhey8msf1DY4974n6qdKcUTT471HGAg1fknKESOwBqvgXNHAuQ798xU6c6cKfRD5EkxdzH1Z5nAnW3UDLeUZhFkRDCM4jCC7n847zLN5GqtX0PAijxWQWRLAhq_e8gIvF7NVk8Ra-999Ci8IknLY7zrNZcOq_gQ2JiUg20IrLuNM-cZzJ3B6w6mzJdHftZ8F3_jSCMJpEszCaTUNoXjkAAD-Xv_Zr0PW78s43RuB17sPVI4mNEVztghW-sVtf7-M1p4YnhJrGCBp9rzd0vZ7r9cDrjTxv5HmNPbC1tJDlU5xLm9Dz9nvfCDTKGomYYmWJNfaTRWIT9gIyz7Jdpf069l7uOvQHvf6g3Pul87UaxP-JBiXDL5Oh_zUyONfNk6csXFgL559ZeP2YhYsaC-eHFi7IurLw-mkLF7UWtrwfz5icnsIBozVJLaez84U_exlUnNZtWPhn_sIPpn744Na0qKXkv7mYT2YBtM4vog74wes2hP7ccvkfnC3OX8GmAwX88K2_8CGGMQxOHNd1XUdIybX7oxISWkwrxLYDd7e_3d1-urv9BPYvBxSfRTbfbC-23fnVTufu9nYLYEqi0VRIM4Kj_lFvBFdHA3DhaHDt7MFSkRmuEVr2ZWo7fwYAAP__JrndYQ==

#
# Same table twice should only show up once.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x one, x two
----
https://cockroachdb.github.io/text/decode.html#eJy0VtFu4kYUfY6_4ooXoMLIkGaFiHhgibOiZZ0IO6tdRdFobF9vpmtm2LljAq0q7Ufksb_RH-in5EuqsSMCqWm63dYPUTxz7rlnzj0e4brwDjUJJYcwUcknrXhye_YacI1JXIg8RQ0GycCqQjmO64JGnrpK5hvghblFaUTCjVCSLdDcqhRGkKA27pIT3SmdOqEfQcoNjzkhjKBpCZunAK4LKWa8yA2seF7gECqo0JgYlqi8WEiuGSVcEkPJ4xwtucqy2mKVZY_1ZOhz_jdIXhhVQoVMcc00JmqxQJmWp_hHreS-D4IYFUvUBaG2Zc-2c5XwXJgNjEDjR6HkyFrQSZNRmvT2oVKlyITt_WxDIxW5IRYXWYaakfjZennS_74_GOwjCcmO6pFlcPwqO_bSk5NX2B8MBt7-86wJUV4j32guiSfliJdaKF0dRSq94PlhKBluCoIRBCpaS6c0fDK7CiN_DqEfRdPgDWTITaGxu8LEKM3KeXSf_G8aXWB9VDKeE9Zy0ue8m-g0ZkIa1JLnXWP5mFZ3pSZBRiTU5cRUxoxYlJl0e3_8TvWd3J5HBxs9Yqn7lLqmyrJ6pm3u6pisNOpayIIbkdj851g6uWtIeex6duvVv2FfiHJWlUN2Xs2T-gYnnvcCf6Y0JpwM_XeSaUMGF6wcITF7gGr9Kxo4V6Ff3mKnzmTujyMfovHrmQ_LIs5F0l1DyzniMA2iAQQXEQRXs1nHOYofV6q3yUUQRvPxNIhgzZafcAOX8-nb8fwD_Oh_gBaHcThpd5yjaXDmv4c1i5lI19CKy3Wnfeo445k9YNXZiulu20-DH_xJBGE0jqZhNJ2E0Lx2AAB-Kf_ap8FXH8tvvjEEr_O0XF2S1BjC9Xaxwje27ze7eI3cYMq4aQyh0fd6A9fruV4PvN7Q84ae19gB20gLWV7FhbQFPW-3960go2yQmNksrbDGbrFIbcHOgizyfMu0y2O_y22H_nGvf1zu_dr5Vg_i_8WDUuHX2dD_Fhucm-bpSxHe2AgXf4nw6lCENzURLvYjvGGrKsKrlyO8qY2w1X24Ynx2BnuKViyzms4v5v70TVBpWrVh7p_7cz-Y-OGzr6bFrST__eVsPA2gdXEZdcAP3rUh9GdWy3dwPr94C2sYh6Akdqr_zJ06dVzXdR0hJWr3JyUktBKtiNoOPNz_9nD_5eH-C9gfHbCGa04jJfHmwJa5U-XW_eNWJnKDmqBl752282cAAAD__7qk0cw=

#
# Set a relevant session variable to a non-default value and ensure it shows up
# in the environment dump.
#

statement ok
SET reorder_joins_limit = 63

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VuFu2zYX_R09xYX_OPlgOZL9JTAc-IfrKJ03Vw4spWsRBAQtUQ1XinR5KdfaMKAPkVfZC-xR8iQDpcCxM2VZ100_DIg699zDcw8Juy68ZRq5kkOYqOSjVjS5PX8FbMOSZcFFyjQYhgbWNcpxXBc0o6mrpCiBFuaWScMTariSJGfmVqUwgoRp464o4melUycKYkipoUuKDEbQtoTtMwDXhZRltBAG1lQUbAg1lGuWGJIoUeSSaoIJlUiYpEvBLLnKssZilWUP9Wjwk_gLJC2MqqBcpmxDNEtUnjOZVrv4W63kvg8cCRYrpgtk2pY9-SxUQgU3JYxAsw9cyZG1oJMmozTx96FSpYxw29uvFGqmdMo0-UlxiUTwnBsYwWm_UdZgn0szLIRBsiyyjGmC_Gdr_0nv_73BEyQytNN9aDzon2Z9Lz05OWW9wWDg7T9PBCOKhh0bTSXSpErFSnOl691LpXMqnoeioaZAGEGo4o10Kgcms6soDhYQBXE8DV9DxqgpNOuuWWKUJtUIu48jaxtdsOZ0ZVQga-TET6Kb6HRJuDRMSyq6xvIRrT5XmjganmCXIlEZMTyvYuz6v_-GzZ1c38NnGz1gsfsY1LbKsmambVSbmKw07FpITg1P7JERrHJy15Bq283s1qt_wp7zala1Q3Ze7ZPmBiee9wJ_pjRLKBr89yRjiYblpBohEruBev0rGjhXUVBdfGfOZBGM4wDi8atZAKtiKXjS3cChc0BhGsYDCOcxhFezWcc5WD6s1G-TeRjFi_E0jGFDVh9ZCZeL6Zvx4j38ELyHQwrjaHLUcQ6m4XnwDjZkSXi6gcNlte4cnTnOeGY3WHe2Yrrb9tPw-2ASQxSP42kUTycRtK8dAIBfql_7tOj6Q3XmW0PwOo_L9b2KrSFcbxdrfGv7frOL14walhJqWkNo9Tx_4Hq-6_ng-UPPG3peawdsI81ldXsX0hb43m7vW45G2SARU66ssNZuMU9twc6CLITYMu3y2HO57dDr-71-9e3Xzrd6sPxPPKgUfp0NvW-xwblpn70U4dJGuPhThNfPRbhsiHCxH-GSrOsIr1-OcNkYYav7-Yrx-TnsKVqTzGq6mC-C6euw1rQ-gkVwESyCcBJET07NIbWSgneXs_E0hMP5ZdyBIHx7BFEws1r-BxeL-Rso4cfvgkUABYygf-a4rus69k8IlA7c393d3325v_sCiZJoNOXSDOHYH8L1cR9cOO7fOH8EAAD__w1_xoc=

# Make sure it shows up correctly even if it matches the cluster setting.
statement ok
SET CLUSTER SETTING sql.defaults.reorder_joins_limit = 63


query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VtFu2zYUfa6-4sIvTgbLkewlMBz4wXWUzpurBJbStQgCgpaohitFuryUa20Y0I_Ir-wH9in5koFS4NiZ3KzrpocAou4959zDQ8auC2-YRq7kECYq-aAVTW7PXgJbs2RRcJEyDYahgVVd5TiuC5rR1FVSlEALc8uk4Qk1XEmSM3OrUhhBwrRxlxTxk9KpEwUxpNTQBUUGI2hbwPYpgOtCyjJaCAMrKgo2hLqUa5YYkihR5JJqggmVSJikC8EsuMqyxmaVZQ_9aPCj-EIlLYyqSrlM2Zpolqg8ZzKtpvhHVHLXB44EiyXTBTJt2558FiqhgpsSRqDZe67kyFrQSZNRmvi7pVKljHDL7VcKNVM6ZZr8orhEInjODYzgpN8oa7CLpRkWwiBZFFnGNEH-q7X_uPd9b_CkEhna3X0gHvRPsr6XHh-fsN5gMPB2nyeCEUXDxEZTiTSpUrHUXOl6eql0TsX-UjTUFAgjCFW8lk7lwGR2FcXBHKIgjqfhK8gYNYVm3RVLjNKk2sLu45a1jS5Yc7oyKpA1YuJH0U10uiBcGqYlFV1j8YhWnypNHA1PsEuRqIwYnlcxdv0__8BmJtf3cC_RQy12H4PaVlnWjLSJ6heRmlPSPuk3gw72ItphsWtJc2p4Yg-hYNXebFtcGdkMbd3_N-g5r3a_9twmoH3cTHDsec_gZ0qzhKLB_04ylmhYTqpQILED1OtfQeBcRUF1lZ46k3kwjgOIxy9nASyLheBJdw0HzgsK0zAeQHgRQ3g1m3WcF4uHlfptchFG8Xw8DWNYk-UHVsLlfPp6PH8HPwXv4IDCOJocdpwX0_AseAtrsiA8XcPBolp3Dk8dZzyzA9bMVkx3Qz8NfwwmMUTxOJ5G8XQSQfvaAQD4rfprnxZdva9ukdYQvM7jcn1TY2sI15vFur61eb_ZrteMGpYSalpDaPU8f-B6vuv54PlDzxt6Xmur2B4SLqv_B4W0Db63zX3L0SgbJGLKpRXW2m7mqW3YWpCFEBukbRx70jcMvb7f61fffu98qweL_8WDSuHX2dD7Fhucm_bpcxEubYSLv0V4tS_CZUOEi90Il2RVR3j1fITLxghb3fs7xmdnsKNoRTKr6fxiHkxfhbWm1SHMg_NgHoSTIHpyag6olRS8vZyNpyEcXFzGHQjCN4cQBTOr5Ts4n1-8hhJ-_iGYB1DACPqnjuu6rmN_1kDpwP3d3f3d5_u7z5AoiUZTLs0QjvwhXB_1wYWj_o3zVwAAAP__XdDg8Q==

statement ok
SET enable_zigzag_join = true

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VuFO40YX_Y2f4ip_Ap_iYCcfKArKj2ww27RZg2Kz3RVCo4k9huk6M9m542xMVWkfglfpC_RReJJqxigk1IFut_UPJI_vPefcM2eGuC68Zwq5FH0YyeSTkjS5PX0DbMWSWcHzlCnQDDUsqyrHcV1QjKauFHkJtNC3TGieUM2lIHOmb2UKA0iY0u6CIn6RKnWiIIaUajqjyGAATQPYPAFwXUhZRotcw5LmBetDVcoVSzRJZF7MBVUEEyqQMEFnOTPgMstqm2WWPfajxs_5C5W00NKWVqDkjt_c0Rvyi-TCdIkX4blI2Yoolsj5nInUTv635Ilt7zgSLBZMFciUZd3-nMuE5lyXMADFbrgUA2NbK00GaeJvlwqZMsINt28VKiZVypSdB0nO51zDAI67tbJ621iKYZFrJLMiy5giyO_Mlh11_t_pPatEhiYRj8S97nHW9dKjo2PW6fV63vbzTDBiXjOxVlQgTWySFopLVU0vpJrTfHcpaqoLhAGEMl4JxzowmlxGcTCFKIjjcfgWMkZ1oVh7yRItFbFb2H7asqZWBatPZEZzZLWY-DlvJyqdES40U4LmbW3DpOQXq4mj5gm2KRKZEc3nNvqu_8fvWM_k-h7uJHqsxfZTuJsyy-qR1vF-Eak-Jc3jbj1obyeiGRbbhnRONU_Mwc2Z3ZtNi62R9dDG_X-CPud29yvPTQKaR_UER573Cn4mFUsoavz3JGOJms2JDQUSM0C1_g0EzmUU2Ov3xBlNg2EcQDx8MwlgUcxynrRXsO_sURiHcQ_C8xjCy8mk5ezNHleqt9F5GMXT4TiMYUUWn1gJF9Pxu-H0I_wUfIR9CsNodNBy9sbhafABVmRGeLqC_Zlddw5OHGc4MQNWzEZMe00_Dn8MRjFE8TAeR_F4FEHzygEA-NX-NU-DLm_sLdLog9d6Wq5ud2z04Wq9WNU31u_Xm_WKUc1SQnWjD42O5_dcz3c9Hzy_73l9z2tsFJtDwoX9H1II0-B7m9y3HLU0QSK6XBhhjc1mnpqGjQVR5PkaaRPHnPQ1Q6frd7r222-t7_Vg9p94YBV-mw2d77HBuW6evBbh0kS4-EuEl7siXNZEuNiOcEmWVYSXr0e4rI2w0b27Y3h6CluKliQzms7Op8H4bVhpWh7ANDgLpkE4CqJnp2afGknBh4vJcBzC_vlF3IIgfH8AUTAxWv4HZ9Pzd1DCzz8E0wAKGED3xHFd13XMTyEoHXi4v3-4__pw_xUSKVAryoXuw6Hfh6vDLrhw2L12_gwAAP__Xevybg==

statement ok
SET optimizer_use_histograms = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VuFu2zYX_V09xYX_OPlguZL9JTAc-IfrKJ03VwkspWsRBAQtXSVcJdIlKdfKMKAPkVfZC-xR8iQDqcCxMyVZ100_DIi695zDw3Mluy68R6mY4EOYiOSTFDS5Pn4DuMZkUbI8RQkalYZVXeU4rgsSaeoKnldAS32NXLOEaiY4KVBfixRGkKDU7pIq9UXI1ImCGFKq6YIqhBG0DWD7CMB1IcWMlrmGFc1LHEJdyiQmmiQiLwtOJVEJ5Yogp4scDbjIssZmkWX3_Uqrz_kzlbTUwpbWoOSGXd3QK_KLYNx08WfhGU9xTSQmoiiQp3bnf0se3_WOKaLKJcpSobSsu49zkdCc6QpGIPGKCT4ytnXSZJQm_m4pFykSZrh9q1AsNSvYDUpSKiTXTGlxJWmhnhdnOiUKmaK0TiiSs4JpGMFhv7FnsKtCoipzrciizDKURLEbc9gHvf_3Bo8qFSqTpXvJg_5h1vfSg4ND7A0GA2_3erRVpfIGr7SkXNHEZnApmZC1b1zIguZPlypNdWlcCUW85o51YDI7j-JgDlEQx9PwLWRIdSmxu8JEC0ns4XcfDrutZYnNWc5orrARU33Ou4lMF4RxjZLTvKttDKX4YjUxpVmiulQRkRHNCjs0rv_H76qZyfU99STRfa3qPoxFW2RZM9JmMJ5Fak5J-7DfDDp4EtFsVnUNaUE1S8zI52jPZttia2QztHH_n6AXzJ5-7blJQPugmeDA817Az4TEhCqt_j3JqlIaC2JDoYjZQL3-DQTOeRTYF_eRM5kH4ziAePxmFsCyXOQs6a5hz3lFYRrGAwhPYwjPZ7OO82pxv1LfTU7DKJ6Pp2EMa7L8hBWczafvxvOP8FPwEfYojKPJfsd5NQ2Pgw-wJgvC0jXsLey6s3_kOOOZ2WDNbMR0N_TT8MdgEkMUj-NpFE8nEbQvHACAX-2vuVp0dWXfIq0heJ2H5fq7oFpDuNgs1vWtzf3ldr1EqjElVLeG0Op5_sD1fNfzwfOHnjf0vNZWsRkSxu3Xp-Smwfe2ue271ASJ6GpphLW2m1lqGrYWeJnnG6RtHDPpG4Ze3-_17bPfOt_rweI_8cAq_DYbet9jg3PZPnopwpWJcPmXCK-einDVEOFyN8IVWdURXr0c4aoxwkb30x3j42PYUbQimdF0cjoPpm_DWtNqH-bBSTAPwkkQPZqaPWokBR_OZuNpCHunZ3EHgvD9PkTBzGj5H5zMT99BBT__EMwDKGEE_SPHdV3XMX-ioHLg7vb27vbr3e1XSARXWlLG9RBe-0O4eN0HF173L50_AwAA___mgQbI

statement ok
SET optimizer_use_multicol_stats = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYYvY6e4oNvnAyWI9tLYDjwhesonTdXCSylaxEEBC1RCVeKdPnjWhkG9CHyKnuBPUqeZCAVOHaqJO266sKAqO875_DofJR9H94SqajgAxiL9IMUOL0-fgVkRdK5oSwjEjRRGpZVlef5PkiCM19wVgI2-ppwTVOsqeCoIPpaZDCElEjtL7BSn4TMvDhMIMMaz7EiMISmBWweAfg-ZCTHhmlYYmbIAKpSKkmqUSqYKTiWSKWYK0Q4njNiwUWe1zaLPL_vV1p9ZM9UYqOFK61A0Q29usFX6A9Bue3iz8JTnpEVkiQVRUF45nb-VfL4tndUIWUWRBpFpGPdfsxEihnVJQxBkisq-NDa1srSYZZ2tku5yAiilrvjFIqFpgW9IRIZRdA1VVpcSVyo58V92VkYpmkqGFIa66_olkTIjEjno0KMFlTDEA57tT397T1IogzTCs1NnhOJFL2xUTno_tztP6pURNkk3m-43zvMe0F2cHBIuv1-P9i-HhmlFKtxWkvMFU5dgheSClm5zoUsMHu61JpirCuRSFbccw6Mp-dxEs4gDpNkEr2GnGBtJGkvSaqFRC467YeoNLU0pH4ScswUqcVUH1k7ldkcUa6J5Ji1tQuxFJ-cJqo0TVUbKyRypGnhRs7v_PO3qmfyO4F6kui-VrUfhqop8rweaT1WzyLVp6R52KsH7T-J6FLZtqQF1jS1BwYj7t1sWuyMrIe27v8X9IK6t195bhPQPKgnOAiCF_BzIUmKlVb_n2RVKk0K5EKhkN1Atf4NBN55HLpj_8gbz8JREkIyejUNYWHmjKbtFex6OxgmUdKH6DSB6Hw6bXk78_uV6m58GsXJbDSJElihxQdSwtls8mY0ew-_he9hF8MoHu-1vJ1JdBy-gxWaI5qtYHfu1r29I88bTe0GK2Yrpr2mn0S_huME4mSUTOJkMo6heeEBAPzpfu3VwMsrd4o0BhC0Hparr4pqDOBivVjVN9b3l5v1kmBNMoR1YwCNbtDp-0HHDzoQdAZBMAiCxkaxHRLK3bfLcNvQCTa53Ulsg4R0ubDCGpvNNLMNGwvcMLZG2sSxk75m6PY63Z579lfrez2Y_xAPnMJvs6H7PTZ4l82jlyJc2gibLyK8fCrCZU2EzXaES7SsIrx8OcJlbYSt7qc7RsfHsKVoiXKr6eR0Fk5eR5Wm5R7MwpNwFkbjMH40NbvYSgrfnU1Hkwh2T8-SFoTR2z2Iw6nV8hOczE7fQAm__xLOQjAwhN6R5_u-79m_YFB6cHd7e3f7-e72M6SCKy0x5XoA-50BXOz3wIf93qX3bwAAAP__-kQcyQ==

statement ok
RESET reorder_joins_limit

statement ok
RESET enable_zigzag_join

statement ok
RESET optimizer_use_histograms

statement ok
RESET optimizer_use_multicol_stats

#
# Test sequences.
#

statement ok
CREATE SEQUENCE seq

query T
EXPLAIN (OPT, ENV) SELECT * FROM seq
----
https://cockroachdb.github.io/text/decode.html#eJysVNtu4zYUfNdXnDe3RST4EttqDD-4LlsYsJXUloO8ETR11HCXIm0eKpf9r_2B_bIF5WCzDpTsBesnQxzOnDMzUhzDNTpS1lzA3Mr3zgp5-_dfgA8od7XSBTrwSB7ujqgoimNwKIrYGv0Iova3aLySwitreIX-1hYwBYnOx3tBdG9dEW1YDoXwYicIYQqdQNiZAMQxFFiKWnu4E7rGCzhClUPpubS6roxwnKQwxNGIncZAbsuy9bIty6f75Omg30CK2tsGqkyBD9yhtFWFpmi2-C4pc-qDIk71Hl1N6MK1F8faSqGVf4QpOPxfWTMNFpwVclrI3inU2AK5Ctq9ZkKH1hXo-DurDHGtKuVhCqNB61jpKZdDqrUnvqvLEh0n9SHYP-yf99MXSEIK6T4Jp4NROegWw-EI-2madk9_LwYm0i0beycMCdm0Yu-UdcftjXWV0K9DyQtfE0whs_mDiRoH5svtJmdr2LA8X2T_QonC1w6TO5TeOt5EmDxH1vGuxvZ2lUITtnLSQSfSFTuujEdnhE584OPO3jczKfJKUiKI25J7VTU1jnufPlK7Utzr0qtCT1hKnovasWXZzvSlqm8ytbekMxq0k6avMoZlKQmilfBKhpdQY5PN1xY3RrZTB_d_hr1STfpHz0MDOsN2gWG3-w3-0jqUgjz9upHpkTxWvCkF8bDA8fkPCETbDWs-pZNovmaznMGG_bdl2ZzBvt5pJRPCA6wW2fVsuWXQg9Xs5vj3z35_MBj3u4NROjwfj4dpdwyLbL5mK5bl0INNPlvn0JtEEbu5Ws4WGfx2eZWfAcuuf4cNW7J5Dn_AP-vLFRAeJlEcx3FEeKjRSIwJQwThJPocAAD__3yG-jw=

#
# Test views.
#

statement ok
CREATE VIEW v AS SELECT a, b, u, v FROM x, y WHERE b = 3

query T
EXPLAIN (OPT, ENV) SELECT * FROM v
----
https://cockroachdb.github.io/text/decode.html#eJy0VtFu2zYUfQ6_4sIvtgfLkewlMGwYmOsonTZXCSwlbREEBCVRDVeZdElKtTcMKPYNedxv7Af2KfmSgZLr2KnSrOvqhwC6Ovfcw8NDKpYFl1QqJvgQpiJ-KwWJb06eAV3ROMpZllAJmioNRYVCyLJAUpJYgmdrILm-oVyzmGgmOF5QfSMSGENMpbaWRKn3QiYocENIiCYRURTG0DSEzRGAZUFCU5JnGgqS5XQIFZRJGmsciyxfcCKxiglXmHISZdSQizStbRZpuulXWr3LPoMkuRYllPGErrCksVgsKE_KVfyrUXzfB6awypdU5opK0_bgdSZikjG9hjFI-oYJPjYWdJJ4nMTOPpSLhGJmZjulQkmFTKjEvwjGFc7YgmkYw3G_VtZgn0tSlWda4ShPUyqxYr8a-4963_cGD5CKKrO7m8GD_nHat5Ojo2PaGwwG9v7vgWClspoVa0m4InGZiqVkQlar50IuSPY4VGmicwVj8EW44qh0YDq7CEJ3DoEbhp7_HFJKdC5pt6CxFhKXW9i937KmljmtT1dKMkVrOdW7rBvLJMKMayo5ybra8GEp3peamNIsVl2isEixZosyxpbz91-qfpLl2OrRQRus6t4HtSnStJ5pG9XPMtWnpHncrycdPMpoFqu6ZuiCaBabQ5jRcm92LS6NrKc27v8X9gUrd7_y3CSgeVQ_4Mi2n-BPhaQxUVr9f5LVWmm6wGUoFDYLqOpfMABdBG55lY7QdO5OQhfCybOZC8s8yljcXUELHRDw_HAA_lkI_sVs1kEH0aZSPU3P_CCcTzw_hBVevqVrOJ97Lybz1_Cz-xpaBCbBtN1BB55_4r6CFY4wS1bQiso6ao8QmszMAqvJRkx3O97zf3KnIQThJPSC0JsG0LxCAAC_lX_Nr0GKN-Ut0hiC3bkvVze1agzhalus8I3t8_UuXlKiaYKJbgyh0bOdgWU7lu2A7Qxte2jbjR2wOSSMl9-DnJsGx96dfcOUFiZIWK-XRlhjt5klpmGnwPMs2zLt8piTvp3Q6zu9fvnu987XehB9Ew9KhV9mQ-9rbEDXzdFTEV6bCOefRLh4LMLrmgjn-xFe46KKcPF0hNe1ETa6H--YnJzAnqICp0bT6dnc9Z77laaiDXP31J27_tQNHpyaFmnX-XLpuS8_2lKUJ9uc5Q46yI0hqA2TAAJ3ZtSSDkQdyDtQwOn87MU-f-eB3pc_unMXIhhDf4SQ--p8NvF8aJ2dhx1w_cv2R9LvKq5ihCzLshDjnErLfBygFUuhVBvB3e2fd7cf7m4_gPn_CtafVFY_bC4Q8-YPk4K729sNIBZcaUkY10M47B06Q7g67IMFh_1rtANLWaapVNAyN2Ab_RMAAP__L7clhA==

#
# Test tables in user-defined schemas.
#

statement ok
CREATE SCHEMA s;
CREATE TABLE s.t (a int primary key)

query T
EXPLAIN (OPT, ENV) SELECT * FROM s.t;
----
https://cockroachdb.github.io/text/decode.html#eJysVO1u2zYU_V0-xf2nZIgEJ5kDoYZ_qJ42aHOVwGKKFcNA0NTVwpUiXV4qjfdee4E92UA5WOdAyT5Q_ZQOzzn33COmKbxDT9rZ17By6oN3Ut198wbwAdV20KZFDwEpwP0BxViagkfZps6aPcgh3KENWsmgnRU9hjvXwhIU-pDuJNEn51vWlBxaGeRWEsISkkiYLADSFFrs5GAC3Esz4Gs4QLVHFYRyZuit9IKUtCTQyq3BSO66bvKw67rH8xToo3kBKYfgRqi2LT4Ij8r1Pdp2nOJfSdnjHDQJGnboB0Ifjz35bJySRoc9LMHjL9rZZYzgrFXLVp0fQ61rUeiofT469Oh8i1786rQlYXSvAyzh6nLSVn7M5ZEGE0hsh65DL0j_FuOfX3x9kT9BElLc7qNwfnnVXc7a-fwKL_I8nx0_TwwTmYmJg5eWpBpbsfPa-cP01vlemuehFGQYCJZQO_5g2ZjAan3b8HIDTcl5VX8HHcoweMzuUQXnxbjC7PPKkuAHnG5XJw3hJCd9NJny7VZoG9BbabIQ-YR3n0ZPmoJWlEkSrhNB92ON0_M_fqdppfR8Rs8KPWIp-1zUxHXdNNNfVX2RabolydXlNGn-LGMclrIo2sugVfwJDY67-XvEY5DT1DH9_8Pe63H7h8xjA5L5tMB8NvsH_s55VJICfTnLtKeAvRhLQSIOcHj_HwTYbVOOV-mCrTZlwUvgxZt1CZQFOGGvJFQ1z6G-5lDfrtdn7NXqum74pqhqDkHsPuAebjbV22LzHn4o38OJhKJZnbLTBWPFOro-0EWFLHJW9fflikPDC141vFo1kPz0c7JgrPzxZl1UNZxc3_AzKOt3p9CU64j9Cr7dXL-NjhYsTdOUxZsXAvszAAD__-HE_tI=

#
# Test default_transaction_quality_of_service settings.
#

statement ok
SET default_transaction_quality_of_service=background

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJysk19OGzEQxt_3FPMWkNgoIU0UgfJAaVQhoRQ1AfXNcuxZcPHaMGMH6BOHyFV6gR6Fk1T2okLQQv-o--gd_76Zbz6XJZwhsfFuDw69uiQv1cWH94C3qJbRWI0EATnAqqkqirIEQqlL7-wdyBgu0AWjZDDeiRrDhdcwAYUUyivJfONJF_PpArQMcikZYQKdBOzsA5QlaKxktAFW0kbcg6a0OROBpGOpMvk6SmvCnfCVYKSVUQm0lOrynHx0uhVGeB6tpIZpCFUQyttYO0mClXQs0MmlxdSwr6pWhq-qx_sc-Nq-USlj8LnUOI23glD5ukanszN_JOU2vTUsOF4hRUZK1178tl5lS2CSBjXeTZKtO1pNtOpvljqvUZik3c8dEnrSSOKrN46FNbUJMIHRoLWt8SaLkKMNLJaxqpAEm29pE8Pdd7vjF5WMnBLzKDwejKpBTw-HI9wdj8e9ze9Fw8y2ZeLnebgi46mZ3nmqpX29lIMMkWECM7-4dUV24PD4dL6Yfob5dLE4mn2ECmWIhN0VquBJ5BV2n1bWCRSxPbGVtIytTL62XUV6KYwLSE7abkg8Qf4m92Q4GMVdySnUwdT5aZT9H9-5Xans9_hVocda7j4FteOrqp30K6pvktpT0hkN2qHjV4lpWO4m0VoGo9IjtJh389zibGQ7Orn_L_Ta5O03nqcEdIbtAsNe7zf8yhMqyYH_X8t8xwFrkUPBIg3QnP-FQDH9cnJ8cDSDrU8nix2Yzs624ezg-HQ6h63-9n5RlmVZ5AtcwMN6_bC-f1jfw1Z_Z7v4GQAA__9KXP7M

statement ok
SET default_transaction_quality_of_service=critical

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJysk99OGzsQxu_3KeYuILFRQk6iCJQLDic6QkIpagLqneV4Z4tbrw0z4wC94iHyKn2BPgpPUtlBhaCF_lH30jv-fTPffC5LuEBiG_wBHAfzmYI2l__9C3iLZhmtq5BAkAVWm6qiKEsg1FUZvLsDHeUSvVijxQavGpTLUMEEDJKUV5r5JlBVzKcLqLTopWaECXQSsHMIUJZQYa2jE1hpF_EANqWbMyWkPWuTyddROyt3KtSKkVbWJJAhm6RdK4rwY3SaNkRLaESZ4GLjNSk22rNCr5cOU7uhrlsZoa4f77PwtXujUkcJudT6Cm8VoQlNg77KvvySlN921rLieIUUGSlde_HbBZMNgUka1AY_SabuVWZSmf52qQ8VKpu0-7lDwkAVkvoUrGflbGMFJjAatLY13mYRcnTCahnrGkmx_ZL2MNz_Z3_8opKRU14ehceDUT3oVcPhCPfH43Fv-3vRMLNrmfh5Gq7IBtpM7wM12r1eyqIlMkxgFha3vsgOHJ-ezxfT9zCfLhYns_-hRi2RsLtCI4FUXmH3aWUdoYjtea21Y2xl8rXrGqqWynpB8tp1JfEUhZvck2WxhruaU6TFNvlhlP1vX7ldqez3-FWhx1ruPgW1E-q6nfQjqm-S2lPSGQ3aoeNXiWlY7ibRRos16RE6zLt5bnE2sh2d3P8TemPz9jeepwR0hu0Cw17vJ_w6EBrNwn-vZb5jwUblULBKA2zOf0OgmH44Oz06mcHOu7PFHkxnF7twcXR6Pp3DTn_3sCjLsizyBS7gYb1-WN8_rO9hp7-3W3wPAAD__2lk_fc=

#
# Test recursive table references from foreign keys.
#

statement ok
CREATE TABLE z (
  pk INT PRIMARY KEY,
  ref INT,
  CONSTRAINT fk FOREIGN KEY (ref) REFERENCES y(u),
  FAMILY "primary" (pk, ref)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM z;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vu1u2kgU_R0_xRV_ICuMDGwiRMQPSpyKXepE4FStqmo0jK-b2QwzZD4osNrH2hfYJ1uNHRFITdNut_4Rydd3zjn3zJkJYQhvURuuZB9Git1rRdnd5SvANbK54yJDDRaNhVXZFQRhCBppFiopNkCdvUNpOaOWK0kWaO9UBgNgqG24pMZ8VjoLZnEKGbV0Tg3CAOoesH4BEIaQYU6dsLCiwmEfytayRqym0lBWID84KrjdEJUTg3rFmQdimntqUQml8ZMTVJeIXCOzhCnhFpJqYhiVhqCkc4FersrzSgyV54_rjTUP4iud1FlVtHKZ4ZpoZGqxQJkVvnwTlTx0lhti3BK1M6j9smefhWKFITDwg3IlB97UZsYGGWsftkqVIeGeu10o1Kh0hpr8obg0RPAFtzCA826lrN4hlkbjhDVk7vIcNTF86_fhrPNrp_es06DxeXkk7nXP826UnZ2dY6fX60WHzzPBxoiKiffTsNRc6XJ6qfSCiuOtxlLrDAwgUelaBoUDo8ntLI2nMIvTdJy8hhypdRpbK2RWaVJsYetpy-pWO6zOa06FwUpM8yBaTGdzwqVFLaloWY9HtPpcaOLGcmZa1PhIW74oDkbY_udvU80UtiNzlOix17SeglpXeV6NtIvqV5GqU1I_71aD9o4i-mFNy5MuqOXMH0KBxd7sW1wYWQ3t3f8v6Ate7H7puU9A_aya4CyKXsDPlUZGjTX_n2SzMRYXpAiFIX6Asv4dBMHtLC4u54tgNI2HaQzp8NUkhqWbC85aa2gEJxTGSdqD5DqF5HYyaQYn88dK-Ta6TmbpdDhOUliT5T1u4GY6fjOcvoff4_fQoDCcjU6bwck4uYzfwZrMCc_W0JgX9eD0IgiGEz9gyezFtHb04-S3eJTCLB2m41k6Hs2g_iEAAPiz-OufGl19Km6RWh-i5lO5vKlNrQ8fdsWyv7Z7_7jfr5FazAi1tT7UOlG7F0btMGpD1O5HUT-KanvN_pBwWfw_cNIvaEf73HfcWOWDROxm6YXV9hfzzC_YK0gnxA5pH8ef9B1Dp9vudItvfzV_1IP5T_GgUPh9NnR-xIbgY_3ipQhvfITdFxFeHYvwpiLC7jDCG7IqI7x6OcKbygh_g-6t1728_0K4xvyY9G2F9OX9yxq3RzUen2p4eQkHrq1I7smvrqfx-HVSkq9OYRpfxdM4GcWzZye7QU-P42-f4-f3h8ga86PYG2g4P2787mYyHCfQuL5JmxAnb09hFk_8nL_A1fT6DWwvgjAMw8D_lINt8G8AAAD__yuON3s=

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vu1u2kgU_R0_xRV_ICuMDGwiRMQPSpyKXepE2KlaVdVosK-b2QwzZD4ozmofa19gn2w1dkSAmqbdbv0jkq_vnHPumTMTfB_eotJMiiFMZHqvJE3vLl8BbjBdWMYzVGBQG1hXXZ7n-6CQZr4UvABqzR0Kw1JqmBRkieZOZjCCFJXxV1Trz1JlXhwmkFFDF1QjjKDpAJsXAL4PGebUcgNryi0OoWqtasQoKjRNS-QHSzkzBZE50ajWLHVAqWKOmtdCKfxkOVUVIlOYGpJKbpeCKqJTKjRBQRccnVyZ57UYMs-f1mujH_hXOqk1smxlIsMNUZjK5RJFVvryTVRi31mmibYrVFajcssOPnOZlobAyA3KpBg5U9tZOsrS7n6rkBkS5ri7pUKFUmWoyB-SCU04WzIDIzjv18oa7GMp1JYbTRY2z1ERzR7dPpz1fu0NDjo1apeXJ-JB_zzvB9nZ2Tn2BoNBsP8cCNaa10y8m4aVYlJV0wuplpQfb9WGGqthBJFMNsIrHZjMbuMknEMcJsk0eg05UmMVdtaYGqlIuYWd5y1rGmWxPq855RprMfUD76QqWxAmDCpBecc4PKLk51IT04alukO1i7Rhy_Jg-N1__tb1TH430EeJnnp15zmoTZnn9UjbqH4VqT4lzfN-PejgKKIbVncc6ZIalrpDyLHcm12LSyProZ37_wV9ycrdrzx3CWie1ROcBcEL-LlUmFJt9P8nWRfa4JKUodDEDVDVv4PAu43D8nK-8CbzcJyEkIxfzUJY2QVnaWcDLe-EwjRKBhBdJxDdzmZt72TxVKneJtdRnMzH0yiBDVndYwE38-mb8fw9_B6-hxaFcTw5bXsn0-gyfAcbsiAs20BrUda90wvPG8_cgBWzE9PZ0k-j38JJAnEyTqZxMp3E0PzgAQD8Wf51T4OuP5W3SGMIQfu5XN3UujGED9ti1d_Yvn_c7VdIDWaEmsYQGr2gO_CDrh90IegOg2AYBI2dZndImCj_H1jhFnSDXe47po10QSKmWDlhjd3FLHMLdgrCcr5F2sVxJ33L0Ot3e_3y21_tH_Vg8VM8KBV-nw29H7HB-9i8eCnChYuw_SLC62MRLmoibPcjXJB1FeH1yxEuaiP8Dbofne7V_RfCFebHpD_WSF_dv6zx8ajG41ONLy9hz7U1yR351fU8nL6OKvL1KczDq3AeRpMwPjjZLXp6HP_xED-_30dWmB_FLqBl3bjhu5vZeBpB6_omaUMYvT2FOJy5OX-Bq_n1GyguPN_3fc_9lIPC-zcAAP__K303eQ==

query T
EXPLAIN (OPT, ENV) SELECT * FROM x;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vu9u2sgX_Vw_xRVfID9hZOCXCBHxgRKnYpc6EXaqVlU1GsbXzWyGGTJ_KGS1j7UvsE-2GjsikJqm3e76QyRf3znn3DNnJoQhvENtuJJDmCh2pxVltxevATfIFo6LHDVYNBbWVVcQhCFopHmopNgCdfYWpeWMWq4kWaK9VTmMgKG24Yoa80XpPEjjDHJq6YIahBE0PWDzHCAMIceCOmFhTYXDIVStVY1YTaWhrES-d1RwuyWqIAb1mjMPxDT31KIWSuNnJ6iuELlGZglTwi0l1cQwKg1BSRcCvVxVFLUYqige1xtr7sU3OqmzqmzlMscN0cjUcokyL335Lip56Cw3xLgVamdQ-2XPPgvFSkNg5AflSo68qe2cjXLWPWyVKkfCPXe3VKhR6Rw1-U1xaYjgS25hBGf9WlmDQyyNxglryMIVBWpi-IPfh9Pe_3uDZ50Gjc_LI_Ggf1b0o_z09Ax7g8EgOnyeCTZG1Ey8n4aV5kpX00ull1QcbzWWWmdgBInKNjIoHZjMbtIsnkMaZ9k0eQMFUus0dtbIrNKk3MLO05Y1rXZYn9eCCoO1mOZedJjOF4RLi1pS0bEej2j1pdTEjeXMdKjxkbZ8WR6MsPvXn6aeKexG5ijRY6_pPAW1qYqiHmkX1W8i1aekedavBx0cRfTDmo4nXVLLmT-EAsu92be4NLIe2rv_T9CXvNz9ynOfgOZpPcFpFL2AXyiNjBpr_j3JZmssLkkZCkP8AFX9BwiCmzQuL-fzYDKPx1kM2fj1LIaVWwjOOhtoBa8oTJNsAMlVBsnNbNYOXi0eK9Xb5CpJs_l4mmSwIas73ML1fPp2PP8Av8YfoEVhnE5O2sGraXIRv4cNWRCeb6C1KOvByXkQjGd-wIrZi-ns6KfJL_EkgzQbZ9M0m05SaH4MAAB-L__6p0HXn8tbpDGEqP1Urm5q0xjCx12x6m_s3j_t92ukFnNCbWMIjV7UHYRRN4y6EHWHUTSMosZesz8kXJb_D5z0C7rRPvctN1b5IBG7XXlhjf3FPPcL9grSCbFD2sfxJ33H0Ot3e_3y2x_tn_Vg8Z94UCr8MRt6P2ND8Kl5_lKEtz7C7qsIr49FeFsTYXcY4S1ZVxFevxzhbW2Ev0P3g9e9uvtKuMbimPSHGumru5c1PhzVeHyq8cUFHLi2JoUnv7yax9M3SUW-PoF5fBnP42QSp89OdoueHMd_eI5f3B0iayyOYm-h5fy48fvr2XiaQOvqOmtDnLw7gTSe-Tn_B5fzq7ewOQ_CMAwD_1MONsHfAQAA__8rbDd3

# A foreign key cycle shouldn't cause infinite recursion.
statement ok
ALTER TABLE y ADD CONSTRAINT fk FOREIGN KEY (v) REFERENCES z (pk);

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vu9u2sgX_Rw_xRVfID9hZOCXCBHxgRKnYpc6EXaqVlU1GuzrZjbDDJk_FGe1j7UvsE-2GjsiQE3TbHf9IZKv75xz7pkzE3wf3qPSTIohTGR6ryRN7y7fAG4wXVjGM1RgUBtYV12e5_ugkGa-FLwAas0dCsNSapgUZInmTmYwghSV8VdU669SZV4cJpBRQxdUI4yg6QCbFwC-Dxnm1HIDa8otDqFqrWrEKCo0TUvkB0s5MwWROdGo1ix1QKlijprXQin8YjlVFSJTmBqSSm6XgiqiUyo0QUEXHJ1cmee1GDLPn9Zrox_4dzqpNbJsZSLDDVGYyuUSRVb68kNUYt9Zpom2K1RWo3LLDj5zmZaGwMgNyqQYOVPbWTrK0u5-q5AZEua4u6VChVJlqMhvkglNOFsyAyM479fKGuxjKdSWG00WNs9REc0e3T6c9f7fGxx0atQuL0_Eg_553g-ys7Nz7A0Gg2D_ORCsNa-ZeDcNK8WkqqYXUi0pP96qDTVWwwgimWyEVzowmd3GSTiHOEySafQWcqTGKuysMTVSkXILO89b1jTKYn1ec8o11mLqB95JVbYgTBhUgvKOcXhEya-lJqYNS3WHahdpw5blwfC7f_2p65n8bqCPEj316s5zUJsyz-uRtlH9LlJ9Sprn_XrQwVFEN6zuONIlNSx1h5BjuTe7FpdG1kM79_8J-pKVu1957hLQPKsnOAuCF_BzqTCl2uh_T7IutMElKUOhiRugqr-CwLuNw_JyvvAm83CchJCM38xCWNkFZ2lnAy3vhMI0SgYQXScQ3c5mbe9k8VSp3ibXUZzMx9MogQ1Z3WMBN_Ppu_H8I_wafoQWhXE8OW17J9PoMvwAG7IgLNtAa1HWvdMLzxvP3IAVsxPT2dJPo1_CSQJxMk6mcTKdxND85AEA_F7-dU-Drr-Ut0hjCEH7uVzd1LoxhE_bYtXf2L5_3u1XSA1mhJrGEBq9oDvwg64fdCHoDoNgGASNnWZ3SJgo_x9Y4RZ0g13uO6aNdEEiplg5YY3dxSxzC3YKwnK-RdrFcSd9y9Drd3v98tsf7Z_1YPGfeFAqfJ0NvZ-xwfvcvHgpwo8uwqv7bzKsMD-W4seaFK_uX47rY21cf0Bj4TTabySujwksagTa_WNWkHV1zNYv6y6O6j4-6fjyEnYU5fdwdT0Pp2-jSo3C_BTm4VU4D6NJGB_QtezpceziENuNkrt59xjWR_E30KKvwT_Ufhz50eXAORl-uJmNpxG0rm-SNoTR-1OIw5mz8H9wNb9-B8WF5_u-77lfiVB4fwcAAP__yc5Sjg==

# Check that we remove histograms from statistics correctly.

statement ok
CREATE TABLE b (
  b BOOL NOT NULL,
  INDEX (b)
)

statement ok
ALTER TABLE b INJECT STATISTICS '[
      {
          "id": 1,
          "avg_size": 1,
          "columns": [
              "b"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 2,
          "histo_buckets": [
              {
                  "distinct_range": 0,
                  "num_eq": 1000,
                  "num_range": 0,
                  "upper_bound": "false"
              },
              {
                  "distinct_range": 0,
                  "num_eq": 100,
                  "num_range": 0,
                  "upper_bound": "true"
              }
          ],
          "histo_col_type": "BOOL",
          "histo_version": 2,
          "name": "__auto__",
          "null_count": 0,
          "row_count": 1100
      },
      {
          "id": 2,
          "avg_size": 0,
          "columns": [
              "rowid"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 0,
          "histo_col_type": "",
          "name": "__auto__",
          "null_count": 0,
          "row_count": 0
      }
]'

query T
EXPLAIN (OPT, ENV) SELECT * FROM b
----
https://cockroachdb.github.io/text/decode.html#eJy0Vu9u27YX_Rw9xYW_OPnBMmQ5zs914A-Oow7eXDmwlKBFURAUddVwpUiHpPJnwx5rL7AnG0iniRMoWTt0-mDAl4fnHp57RDsM4QK14UpOYK7YF60ouzw9AbxFVjRclKjBorFwvUUFQRiCRlqGSoo7oI29RGk5o5YrSWq0l6qEKTDUNtxQY26ULoMsyaGklhbUIEyh6wi7xwBhCCVWtBEWrqlocAJb6LZGrKbSUOaZrxoquL0jqiIG9TVnjohp7lqLViqNnxtB9ZaRa2SWMCWaWlJNDKPSEJS0EOjkqqpq5VBVdb_fWHMlXkHSxioP5bLEW6KRqbpGWXpfvqmVfOosN8Q0G9SNQe22PVsWinlDYOoOypWcOlN7JZuWbPAUKlWJhLveA69Qo9IlavKr4tIQwWtuYQpHw1ZZ46dcGk0jrCFFU1WoieG_uTmM4sN4_Axp0Li83DceD4-qYVSORkcYj8fj6OnzTLAxouXEu2nYaK709vRS6ZqKl6HGUtsYmEKq8lsZeAfmy_MsT9aQJXm-SH-CCqltNPavkVmliR9h_3FkXasbbM9rRYXBVk5zJfpMlwXh0qKWVPSt4yNa3XhN3FjOTJ8aF2nLa_9ihIO__jTtncJBZF5sdI81_cegdlVVtTM9RPVVpvaUdI-G7aTjFxndYU3fNa2p5cy9hAL9bHYt9ka2Uzv3_w17zf30t567BHRH7Q1GUfQP_JXSyKix5sdJNnfGYk18KAxxB9jWv6NBcJ4l_nI-DubrZJYnkM9OlglsmkJw1i9gP9gr4GS1WkK6yiE9Xy57wZ5WN7yERZqPffVikS3cpq8IOE3ezs6XOTSSXzXeO17uH_SCvfkqzfL1bJHmUJDNF7yDs_Xi3Wz9AX5JPsD-lneWzR12kZ4m76EgBeHlLewXvh4cHAfBbOn82Ap12vsPahfpz8k8hyyf5YssX8wz6H4MAAB-95_u6dDrz_7S6Uxg0Hssby9205nAx4eiXyg6D98_7eI1UoslobYzgU4cxXE4iMMohsF4MjycxG_6o_8fvhnGnZ097tXi0v-KNNLti3cWL7mxyoWP2LuNU9fZ3crLZ3olrT2I-METsguWjRAPPaKdBXdzfK0PBlHkV_7ovWJR9C0W-bn9hzZF32dT_CNtuvco-NQ9DoLk_dlytkhhf3WW9yBJLw4gS5Yucv-Dt-vVOyiOgzAMw8D9O4Ai-DsAAP__Idi-Fw==
