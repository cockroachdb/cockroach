# LogicTest: local

statement ok
CREATE TABLE x (
  a INT PRIMARY KEY,
  b INT,
  INDEX (b),
  FAMILY "primary" (a, b)
)

statement ok
ALTER TABLE x INJECT STATISTICS '[
  {
    "columns": ["a"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 100,
    "histo_buckets": []
  },
  {
    "columns": ["b"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 123123,
    "histo_buckets": []
  }
]'

statement ok
CREATE TABLE y (
  u INT PRIMARY KEY,
  v INT REFERENCES x,
  INDEX (v),
  FAMILY "primary" (u, v)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM x WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0k99O20wQxa_ZpzjyDcmn-IuT3CBHSDXBqG6Dg2yXghBare2FbNl40_WaOqkq8RB5Qp6ksvnTCKm0vcAXlmbm_I5nvLO2jVOuS6EKFxOV3WjFsvnhAXjNs7QSMucahpcGtw8qQmwbmiudc02_KFGUVIqFMJizEmbOkfMrVkmDWyYr7mKv0fOCpZLTtbhes-uW-p1cFY1eLY1YiDXXtCo5nYvSqGvNFuW_UItKGpEpSUvDzB9IqTImhVnRJ4ucLpk2wghV8JyKIuc1LTP2WtuxnyAXpSm_SuxDXV2NAdt-KWSVUc0Xb3lmlBZr_oojmUS-l_hIvIOpj2WVSpH9X6NDdhiCMNlDOEsQfppOe2Qnfcw8RJNZGCeRF4QJarq84SucRMGxF53jo3-ODoMXT7o9shOEh_4ZappSkdfopE_5I-84mJ7DWmqxYHplocN6SLukOybEmyZ-9LKnIPzgTxLEiZcEcRJMYuxeEAD43r6bx8qUrBZFabm4eE62BWY9x5e9Lb3mzPCcMmO5sIbOYM92BrYzgDNwHcd1HGtL3Px5UWSGZqoqGmDgOFvldoVosw1mteSN3zZcVFI-g9uYVt9-GQ5Hg-Gorf3o_fVs6ZvM1rbyduORy90xIf7ZydQLQnRmJ0kPfnjaRexPm2P-D0fR7Bg1Pr_3Ix8p9jEaE9u2bdJekvrd40oR3G8295u7-80dMlWURjNRGBf9YX_g4qI_go3-6JL8DAAA___Rs0vw

statement error ENV only supported with \(OPT\) option
EXPLAIN (ENV) SELECT * FROM x WHERE b = 3

query T
EXPLAIN (OPT, ENV) SELECT * FROM x WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0k99O20wQxa_ZpzjyDcmn-IuT3CBHSDXBqG6Dg2yXghBare2FbNl40_WaOqkq8RB5Qp6ksvnTCKm0vcAXlmbm_I5nvLO2jVOuS6EKFxOV3WjFsvnhAXjNs7QSMucahpcGtw8qQmwbmiudc02_KFGUVIqFMJizEmbOkfMrVkmDWyYr7mKv0fOCpZLTtbhes-uW-p1cFY1eLY1YiDXXtCo5nYvSqGvNFuW_UItKGpEpSUvDzB9IqTImhVnRJ4ucLpk2wghV8JyKIuc1LTP2WtuxnyAXpSm_SuxDXV2NAdt-KWSVUc0Xb3lmlBZr_oojmUS-l_hIvIOpj2WVSpH9X6NDdhiCMNlDOEsQfppOe2Qnfcw8RJNZGCeRF4QJarq84SucRMGxF53jo3-ODoMXT7o9shOEh_4ZappSkdfopE_5I-84mJ7DWmqxYHplocN6SLukOybEmyZ-9LKnIPzgTxLEiZcEcRJMYuxeEAD43r6bx8qUrBZFabm4eE62BWY9x5e9Lb3mzPCcMmO5sIbOYM92BrYzgDNwHcd1HGtL3Px5UWSGZqoqGmDgOFvldoVosw1mteSN3zZcVFI-g9uYVt9-GQ5Hg-Gorf3o_fVs6ZvM1rbyduORy90xIf7ZydQLQnRmJ0kPfnjaRexPm2P-D0fR7Bg1Pr_3Ix8p9jEaE9u2bdJekvrd40oR3G8295u7-80dMlWURjNRGBf9YX_g4qI_go3-6JL8DAAA___Rs0vw

#
# Multiple Tables.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x, y WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0lMFu6kYUhteZpzjy5prKLgY2kdGV6ssdWrfERLZ7myiKRmN7CNMYD50ZuzZVpajPwLJPx5NUdhJCk5D2LsICyed8_2EOfIxtwxcmFReFCxOR3kpB0-XnT8BqliYlzzMmQTOlobqnELJtkEzIjEnyq-CFIjlfcQ1LqkAvGWRsQctcQ0Xzkrlw2vKsoEnOyIbfbOhNlzqGi6LlxVrzFd8wSUrFyJIrLW4kXamvSa3KXPNU5ERpqv8jmYuU5lw35HFERtZUaq65KFhGeJGxmqiUvnXsCMeQcaXVbzl8BLFYjAFs-zlISy3aT6xYqoXkG_bGRDQJsRdjiL1PMwzrMsl5-m0NJjqh4AfxKQTzGIKfZzMLnSQPlfunyTyI4tDzgxhqsr5lDZyH_pkXXsJP-BJMCl406VnoxA8-4wuoSUJ4VoOZPNan3pk_uwRjLfmKysYAk1qQ9FBvjJA3i3H4_Ex-8COexBDFXuxHsT-J4MMVAgD4o3tvX0Yq8nJVKMOFq32xa1Bj_3xtHfCSUc0yQrXhgjF0Bqe2M7CdATgD13FcxzEO4Pab50WqSSrKog0MHOeg3SlEWht0s2btvMNwUeb5PngYk-L3p4HD0WA46np_Wv97t-RdduuO8n7roesP49fta1r7yhf2Vcfsa16xr3y07F9cRRYtOZ2H2P8-uCerHoR4ikMcTHC0l82kT-q2uU7d6ri6pQXVUXWbV9Xt9scX5zPPD8Ccn8cW4OBLDyI8a9lvYBrOz6C2oIFffsAhhgQ-wmiMbNu2ES8KJu3ukjNTKZTqIdht_95t73bbO-hukeZFpf7u4V_Ydv5qf4XddvsApKJQWlJeaBf6w_7Ahav-CGzoj67RAbbguWZSgallyXronwAAAP__ZDq2PA==

#
# Same table twice should only show up once.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x one, x two
----
https://cockroachdb.github.io/text/decode.html#eJy0U89O20wQP7NPMfIF55P9yYELSsTBBCO5NQ6KXQRCaLW2J2TLZjfdXYOTqhIPkWOfjiepbCCNkKDtAR8sz_z-eGZ3xvfhHLXhSg5gpMpbrVg5Oz4CbLAsai4q1GDRWLh7YhHi-6BR6Qo1_aq4NFTwObcwYwbsDKHCKauFhTsmahzAQctHyQqBdMVvVuymU71FV7Llq4Xlc75CTWuDdMaNVTeazc2_qOa1sLxUghrL7B-UQpVMcLukLxYVXTBtueVKYkW5rLChpmTvlZ1FOVTcWPNNwCGo6XQI4Puviay2qv3jHZZWab7CdxzJaBKFeQR5eJREsKgLwcv_G3DJDoM4zQ8gHeeQfkkSj-wUz5mnaDROs3wSxmkODV3c4hLOJvFpOLmEz9EluAzCbNTzyE6cHkcX0NCC8qoBt3jJn4SncXIJzkLzOdNLB1zmQdEjvSEhYZJHk9c1xemnaJRDlod5nOXxKIPdKwIA8L17t49TKlHPpXEGcLVJdgBzNvG1t8XXyCxWlFlnAM5e0D_wg74f9CHoD4JgEATOFrk9eS5LS0tVy1bQD4ItuBsh2k6DXS6w9dsWy1qIjXBbptX9b8O9_f7efof98P66t-JDeutK-bj2yPXukJDo4iwJ4xTc8VnuQZSe9yCLkvaa_4OTyfgUGggzUBK9py97r4bE932fcClR-92au6VWxvQIPK5_Pq4fHtcP0O1RA1fMHCqJ129A9l510PoZmnJhURtwra6xR34FAAD__5mqZGQ=

#
# Set a relevant session variable to a non-default value and ensure it shows up
# in the environment dump.
#

statement ok
SET reorder_joins_limit = 63

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJyUkdFu2jwYho_rq3jVk4ZfzV9NSFMF6kGami1bGqrE64qqyjKJAa8hZrYTEY56EVwhVzIFxgmaOu3Q1vO8_vx-vo9HaazS1QChzl-NFvni7hZyLfNprcpCGjhpHZoDRUhGGYzUppCG_9CqsrxUS-Vwg4_9IeD7KORM1KVDI8paDnBNfB-yEtNS8o2ab8R872EhLNxCnuK66ni9cmqpNtLw2kq-UNbpuRFL-y_Wsi6dynXJrRPuL2apc1Eq1_JjRMFXwjjllK5kwVVVyDW3uXhv7K6ZQllnf5a4gZ7N_liHqJ3uXmxk7rRRG_lOIglTGjAKFtzGFKt6Wqr8_xYeOasRJewayZgh-RbHl-Ss-X1zOIXjJGNpECUMLV-9yhYPaXQfpBN8pRN4NYIs7J1yDZ915Gic0uhTciCbHlI6oilNQpodR1h7opOj5I4-7T1VrOE1x9BRcB_FE5yvjFoK057Dqy_R9EhvSEgQM5qefihKvtCQIWMBizIWhRkunl8uhoTQp4c4iBJ44wd2CZo89pDRuGP_wygd36PF9880pahxg_6Q-L7vk_2aWoLddrvbvu22b8h1ZZ0RqnIDXH0Y4PmqDx9X_RfyKwAA___dvfXn

# Make sure it shows up correctly even if it matches the cluster setting.
statement ok
SET CLUSTER SETTING sql.defaults.reorder_joins_limit = 63


query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJyUkdFu2jwYho_rq3jVk4ZfzV9NSFMF6kGami1bGqrE64qqyjKJAa8hZrYTEY56EVwhVzIFxgmaOu3Q1vO8_vx-vo9HaazS1QChzl-NFvni7hZyLfNprcpCGjhpHZoDRUhGGYzUppCG_9CqsrxUS-Vwg4_9IeD7KORM1KVDI8paDnBNfB-yEtNS8o2ab8R872EhLNxCnuK66ni9cmqpNtLw2kq-UNbpuRFL-y_Wsi6dynXJrRPuL2apc1Eq1_JjRMFXwjjllK5kwVVVyDW3uXhv7K6ZQllnf5a4gZ7N_liHqJ3uXmxk7rRRG_lOIglTGjAKFtzGFKt6Wqr8_xYeOasRJewayZgh-RbHl-Ss-X1zOIXjJGNpECUMLV-9yhYPaXQfpBN8pRN4NYIs7J1yDZ915Gic0uhTciCbHlI6oilNQpodR1h7opOj5I4-7T1VrOE1x9BRcB_FE5yvjFoK057Dqy_R9EhvSEgQM5qefihKvtCQIWMBizIWhRkunl8uhoTQp4c4iBJ44wd2CZo89pDRuGP_wygd36PF9880pahxg_6Q-L7vk_2aWoLddrvbvu22b8h1ZZ0RqnIDXH0Y4PmqDx9X_RfyKwAA___dvfXn

statement ok
SET enable_zigzag_join = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJyMkdFu2jwYho_rq3jVk4ZfzV9NSFMF6kGami1bCCjxuqKqskxiwGuIme1EhKNeBFfIlUzAOKkmtkNbz_N-36vP9_EojVW66iHU-avRIl883EOuZT6tVVlIAyetQ3OkCMkog5HaFNLwH1pVlpdqqRzu8LHbB3wfhZyJunRoRFnLHm4PiqzEtJR8o-YbMT-IuIOezf6o6Ir4PvTKqaXaSMNrK_lCWafnRiwtFsLCLeS_WMu6dCrXJbdOuL-Ypc5FqVzLTxEFXwnjlFO6kgVXVSHX3OaiOhOzr1oo6-zP8kw_UTu9n9jI3GmjNvJMIglTGjAKFtzHFKt6Wqr8_xYeuagRJewWyYgh-RbH1-Si-f1zfIWjJGNpECUMLV-9yhbjNBoG6QRf6QRejSALO--5hs_25GCU0uhTciSbDlI6oClNQpqdVlh7Yi9HyQN9OniqWMNrTqGDYBjFE1yujFoK017Cq6_RdEinT0gQM5q-LxQlX2jIkLGARRmLwgxXzy9XfULo0zgOogTeaMyuQZPHDjIa79n_MEhHQ7T4_pmmFDXu0O0T3_d9cjhTS7Dbbnfbt932DbmurDNCVa6Hmw89PN904eOm-0J-BQAA__-JbPZJ

statement ok
SET optimizer_use_histograms = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJx8kdFu2jAUhq_rp_jVm4apWTUhTRWoF2lqtmxpQInXFVWVZRIDXkPMbCciXPUheEKeZALGDaq4tPV9__mPju_jSRqrdNVDqPM3o0U-f7iHXMl8UquykAZOWofmQBGSUQYjtSmk4X-0qiwv1UI53OFrtw_4Pgo5FXXp0Iiylj3c7hVZiUkp-VrN1mK2F3EHPZ1-qOhq7-ilUwu1lobXVvK5sk7PjFjY86bvn4iLunQq1yW3TjiLubBwc_mxWepclMq1_BhR8KUwTjmlK1lwVRVyxW0uqjMxu-qFss7-Lc80FbXTu4mNzJ02ai3PJJIwpQGjYMF9TLGsJ6XKP7fwyEWNKGG3SIYMya84viYXzf-fwyscJhlLgyhhaPnyTbYYpdFjkI7xk47h1QiysHPKNXy6IwfDlEbfkgPZdJDSAU1pEtLsWGHliZ0cJQ_0ee-pYgWvOYYOgscoHuNyadRCmPYSXn2NpkM6fUKCmNH0dKEo-UFDhowFLMpYFGa4enm96hNCn0dxECXwhiN2DZo8dZDReMd-wiAdPqLF7-80pahxh26f-L7vk_2ZWoLtZrPdvG8378h1ZZ0RqnI93Hzp4eWmCx833VfyLwAA__9yOfar

statement ok
SET optimizer_use_multicol_stats = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJyUkcFu2jAAhs_1U_zqpWFqVk1IUwXqIU3Nli0ElHhdUVVZJjHgNcTMdiLCqQ_BE_IkEzAu1dZpR1vf9_-_Zd_HvTRW6aqHUOfPRot8cXcLuZb5tFZlIQ2ctA7NkSIkowxGalNIw39oVVleqqVyuMHHbh_wfRRyJurSoRFlLXu4PiiyEtNS8o2ab8T8IOIGejb7o6Krg6NXTi3VRhpeW8kXyjo9N2Jp_9dc1qVTuS65dcL9w_Z9lDoXpXItP6UUfCWMU07pShZcVYVcc5uLCgth4RbyLyMKZZ39Wb7RJ2qn942NzJ02aiPfSCRhSgNGwYLbmGJVT0uVv2_hkbMaUcKukYwYkm9xfEnOmt83x1M4SjKWBlHC0PLVs2wxTqNhkE7wlU7g1QiysPOaa_hsTw5GKY0-JUey6SClA5rSJKTZacLaE3s5Su7ow8FTxRpecwodBMMonuB8ZdRSmPYcXn2JpkM6fUKCmNH09YOi5AsNGTIWsChjUZjh4vHpok8IfRjHQZTAG43ZJWhy30FG4z37DoN0NESL759pSlHjBt0-8X3fJ4dvagl22-1u-7LbviDXlXVGqMr1cPWhh8erLnxcdZ_IrwAAAP__nWj3DQ==

statement ok
RESET reorder_joins_limit

statement ok
RESET enable_zigzag_join

statement ok
RESET optimizer_use_histograms

statement ok
RESET optimizer_use_multicol_stats

#
# Test sequences.
#

statement ok
CREATE SEQUENCE seq

query T
EXPLAIN (OPT, ENV) SELECT * FROM seq
----
https://cockroachdb.github.io/text/decode.html#eJyUkEFvGjEQhe_-Fe_YVnUVoAk0KIft1pWQYJPCBuVmGe8A05o12LMo5ddXNOqlqqhyG2m-783oaY0lpcyxvUUZ_Y8Und9--Qx6Jr_qODSUIJQFxxdKqYWpkSimhpL9HrnNNvCOBXe4GYwBrdHQ2nVBcHSho1uMlNag1q0C2RNvTm7z28PWZciW_sZje-bjXnjHJ0q2y2S3nCVuktvl11i7Lgj7GGwWJ_8xQ_QusPy0fyIau3dJWDi21FhuG3q22btLb5-baThLPgTcIa7X_6zDdRLPF4_kJSY-0YVEVc5NURsszLdHU5UG-24V2H_IdMBsUi2L6aNBD7Pi6WX81O8PBsP-1eBmdP1xOLweXQ0xqcq5mZmqRg-LupjX6I2VMk8P02JS4c39Q_0eplq-xcJMTVnjHb7O72fIdBgrrbVWmQ4dtZ50pkBezhv1KwAA__8rjrxH

#
# Test views.
#

statement ok
CREATE VIEW v AS SELECT a, b, u, v FROM x, y WHERE b = 3

query T
EXPLAIN (OPT, ENV) SELECT * FROM v
----
https://cockroachdb.github.io/text/decode.html#eJy0lNFuo0YUhq8zT3HEzeIK1tiWqggrUlnvuKV1cAQ0u1EUjQYYx9PFjDszUOOq0qrP4Ms-nZ-kAseOd-Ok3YtwgTTn_P_hnOGbsW24ZlJxUbgwEuknKWg6f_8O2IqlScnzjEnQTGmodiqEIhyDZEJmTJLfBC8UyfmCa7iA7wdDANuGjM1omWuoaF4yF86RbQMraJIzsub3a3rf-mBOFeg5-1ouikYvlpov-JpJUipG5lxpcS_pQn2La1HmmqciJ0pT_R_OXKQ057om-xIZWVKpueaiYBnhRcZWRKX0pbabncm40ur3HC5AzGYnt4OWWjRfrFiqheRr9kJFNAqxF2OIvXcTDMsyyXn6dgUmOqPgB_E5BNMYgl8nEwudJQ-R3Wo0DaI49PwghhVZfmI1XIX-pRfewC_4BkwKXjTqWOjMD97jj7AiCeHZCsxkHx97l_7kBoyl5AsqawNMakHSQZ0hQt4kxuHXPfnBz3gUQxR7sR_F_iiCN7cIAODP9t08RiryclEow4XbQ7BNUOOwvrOO9JJRzTJCteGC0Xd657bTs50eOD3XcVzHMY7Ezc7zItUkFWXRGHqOc5RuESINDbpesqbesbko8_xgPLZJ8cdjwf6g1x-0ub-s_z1b8iqzta283njo7s3wNH11Q1_5hL7qOfrqE_SVe8q-0FVk1ijH0xD7PwY7ZdWBEI9xiIMRjg6wmfQR3cbXols9j25pQfUsuvVJdI_nv_bxh7262h0EC9qa4EUQ4UnjfozCOJxetpfm233D1hfLGj78hEMMCVzAYIgQ_ng18fwAzOlVbAEOrjv7ot_talVDZNu2jXhRMGm3l6eZSqFUB8F2889283m7-Qzt7VQ_iax-eDjdTebv5u9uN5sHQSoKpSXlhXah2-_2XLjtDsCG7uAOHclmPNdMKjC1LFkH_RsAAP__PLjP1g==

#
# Test tables in user-defined schemas.
#

statement ok
CREATE SCHEMA s;
CREATE TABLE s.t (a int primary key)

query T
EXPLAIN (OPT, ENV) SELECT * FROM s.t;
----
https://cockroachdb.github.io/text/decode.html#eJyUkFFr2zAURp-jX_HRlyYj2stglIY-uJ4K3hwn2FpZGEOo9k2iVbEy6To0-fUjHYMxRkffz7nf5UiJe4rJhf4aeWgfY7Dt9sMt6Inah8H5jiKYEuPwixKiURqRQuwomu_B9cl4t3OMG7x_NwOkREdrO3jGwfqBrnElpAT19sGTObnNyW6ePWxtAm_pbzz0Zz7s2e3ciaIZEpmtSxw20e7Sa6zd4Nm1wZvElv9j-tBa7_hofp_ozN5GduxCT51xfUdPJrX2pbfPZTqXOP3wuEFYr_-Zww4czosHajlEd6IXLoq8VplW0NltqZDeMsZiZFFU-grVQqP6XJZTMcoXVaPrrKg02Owf6YhlXcyzeoVPaoWxRdbkk6kY3WXzolzhYh_dzsbjBcZ2IiYzIbJSq_qPlaL6qHKNRme6aHSRN7j8-u1yJoT6siyzosJ4sdRTqOp-gkaVZ_YN7urF_GzPhJRSiudYLH4GAAD__2xjxSo=
