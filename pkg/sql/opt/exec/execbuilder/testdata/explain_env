# LogicTest: local !metamorphic-batch-sizes
# We must turn off metamorphic variables because some are included in
# EXPLAIN (OPT, ENV) output.

statement ok
CREATE TABLE x (
  a INT PRIMARY KEY,
  b INT,
  INDEX (b),
  FAMILY "primary" (a, b)
)

statement ok
ALTER TABLE x INJECT STATISTICS '[
  {
    "columns": ["a"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 100,
    "histo_col_type": ""
  },
  {
    "columns": ["b"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 123123,
    "histo_col_type": ""
  }
]'

statement ok
CREATE TABLE y (
  u INT PRIMARY KEY,
  v INT REFERENCES x,
  INDEX (v),
  FAMILY "primary" (u, v)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM x WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VtFu27gSfa6-YuCXphd2Isf3IXBQYF1Xi_Wu6xS22m0QBAQljWRuKJIhKcfJYoF-RL4wX7IgpSQuEFktFs1DEDFzZoYzZ85wMIDPqA2TYgxTmV5pSdP1-3eAW0yTivEMNVg0Fja1VRAMBkA5lzdEaVRUI6GGSGWJ4lTAmhqwa4QMc1pxCxvKKxyDzHOHS6WxxKRUGHLD7Jo0ViSVnBh2hx3wjLpMbnmr3Wx11ocP78-9ceObCbvX98musdVUGJpaJgVRmknN7G0bUEhdUt6Gvq4oZ_aWyJwY1BuWtiagsag41W2ONNKMSMFb83gszgvYyiDJpWsWau_IdDlhGlPfj6oUVDe9QkETjlkn1tS8yCvOiXWQGr8Pt4piB7TmmsNbd3IK8HyZR0taWelC1IkQVirOUmaJQe7SzaUmlXLsaA0lXoLvlsr5SKhN18RYarFEYdsT_8abMKgtyamxRFG7_i5QWXHLlPtDZixnKXU5GEcWX7eOSjdO7lhxRwvyl2Rdc4db5epERUZYIaRGIqQlG2aY81N32xAmSCpVF8-YsKg3lO8dRCWNLTQaB-BUF1iTwtGBaHnTWtlhGIYeI9NmfJRlJbvDjCiqLXNlwowwkeHWe9tfbeGCSp2hxoxwamzH3dzIeB4RjWtZosu1k_0-khNAozir5Y1wVrLWYMfh_08ajL-bbuZUY0pNF-u-Ba2ZsbLQtPwhlGef11xLfyzeLm18E7BLUVRBrC7KQ8NKxqnTU2LXGs1a8taShocjD9WYoyZcyqtKeZobP6b5VWdQLRUtXB-ZUJWtKcBE0QHT6A2bUHt76BtorjkxNMeGNF1ZueXFREGeS-r3oUJtK514CWityMt4J7muFbriSJSWCU0Y37OyWtxoKjJZEoPtLK-RrMQ7KVqn_lM8dWaVSGQlsnpmKefIu_eAh6VSGKspcyMupFOjjW_bzrx_5y7aYGql3veiEEEwXUaTOIJ48m4e-aocqirhLD3cwkHwisJsEZ_A4iyGxaf5vB-8SpqT-mt6tljFy8lsEcOWqCu8hY_L2YfJ8hz-iM7hgMJkNX3TD17NFu-jL7AlCWHZFg4Sfx68OQ2CyTyOli-Gny1-j6YxrOJJPFvFs-kKXl8EAAB_-9_up0c3hX_X9MYQ9p-PGzHvjeHi6bC27z19X-7aa6QWM0Jtbwy943B4MgiHg3AI4XAchuMw7O0Yu03NhH8gVMIBhuFubK9G_jFnb5VLrLcL9mL8CNyFOZF9cng8Gh6P_P_-6f_XKyc_5co-w5936-Dy9WkQRF8-ziezBRycfYz7EC0-v4FVNHek-B_8ujz7AFv487doGUECb2F0GgwGg0HgF-L2l4ZrATzc3z_cf324_wpPk2XHcHR8NBzDxdEIBnA0ugz-DQAA__9vZgaC


statement error pq: at or near "EOF": syntax error: the ENV flag can only be used with OPT
EXPLAIN (ENV) SELECT * FROM x WHERE b = 3

#
# Multiple Tables.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x, y WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt9u27YXvq6e4sA3dX6wEzn5XQQOCsx11c1b6hS22rUoCoKSjmQuFMmSlGtnGFDsGXK5p8uTDKSUxEEjq8XQXAQ2_X3n73cOORzCW9SGSTGGqUwvtaTp6sVzwA2mScV4hhosGgvrGhUEwyFQzuVnojQqqpFQQ6SyRHEqYEUN2BVChjmtuIU15RWOQea546XSWGJSKgz5zOyKNCiSSk4Mu8IOekZdJFveipstLwbw6sV7D25sM2H32j7dBVtNhaGpZVIQpZnUzG7biELqkvI29qeKcma3RObEoF6ztDUAjUXFqW4zpJFmRAreGsdtcR7hVgZJLl2zUHtDpssI05j6flSloLrpFQqacMw6uabWRV5xTqyj1Px9vGUUO6I1nzg8cydnAPfJ3CJpZaVzUQdCWKk4S5klBrkLN5eaVMqpo9WVeIy-WypnI6E2XRFjqcUShW0P_IE1YVBbklNjiaJ29U2ksuKWKfdBZixnKXUxGCcWX7eOSjdGrlhxRQvyh2Rdc4cb5epERUZYIaRGIqQla2aYs1N32xAmSCpVl86YsKjXlO8dRCWNLTQaR-BUF1iLwsmBaPm5tbKjMAw9R6bN-CjLSnaFGVFUW-bKhBlhIsONt7a_2sI5lTpDjRnh1NiO3NzIeB0RjStZoou1U_3ek1uARnFWrzfCWclanR2H_z9tOD433cypxpSaLtU9JK2YsbLQtPwullef37mWfp-_Xdn4JmDXRlEFsbooDw0rGadunxK70mhWkreWNDw88VSNOWrCpbyslJe58WOaX3Y61VLRwvWRCVXZWgJMFB00jR7YuNrbQ99A84kTQ3NsRNMVlbu8mCjIfUn9fahQ20onfgW0VuRxvlu5rhW64kiUlglNGN9zZbWY0VRksiQG21VeM1mJV1K0Tv2beOpglUhkJbJ6ZinnyLvvAU9LpTBWU-ZGXEi3jda-bTvz_o130RpTK_W-F4UIgukimsQRxJPn55GvyqGqEs7Sww30gycUZvP4FOYXMczfnJ8PgidJc1J_m17Ml_FiMpvHsCHqErfwejF7NVm8h9-i99CnMFlODwbBk9n8RfQONiQhLNtAP_HnwcFZEEzO42jxqPvZ_NdoGsMynsSzZTybLuHphwAA4E__3_316Lrw75reGMLB_XGzzHtj-HB3WON7d98_7uI1UosZobY3ht5xODodhqNhOIJwNA7DcRj2dsDupmbCPxAq4QijcNe330b-MWe3ygXW2yX7ZXxL3KW5JXtn8PhkdHzif_tr8F9TTn5Iyj7CH5d18PHp2R5tbp02q6-0uW7T5vYRbVa32nyAW5PcIV9eLKLZz_MauT6ARfQyWkTzabSEW3326b2wHc8Le90t7O2jwvb5Ru9en09mc-hfvI4HEM3fHsAyOnfY_8HLxcUr2AxgC7__Ei0iSOAZnJwFw-FwGDAhUA_9E6ifamnMQQA31__cXH-5uf4C_oWw_epk81Mzju6Xv13Vb66vG8DdDrJjODo-Go3hw9EJDOHo5GOwA8sZt6gN9K2u8CD4NwAA__85222Z

#
# Same table twice should only show up once.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x one, x two
----
https://cockroachdb.github.io/text/decode.html#eJy0Vs9u2zgTP1dPMfClyQc7kNPvEDjowXW9gHddp7DVokVREJQ0krmhSHZIOU4WC_Qhctyn65MsSKmNC0RWi0VzCCxyfvP3NzMcjeAtkhVaTWCms2vSPNu-fAG4xyythcyRwKF1sGukomg0Ai6lvmGG0HBCxi3TxjEjuYItt-C2CDkWvJYOdlzWOAFdFB6XaeuYzbiy7Ea4LWulWKYls-IOe-A5957cyk65xeZqCK9evg_CrW6h3FHdF4fCjriyPHNCK2ZIaBLutguoNFVcdqE_1VwKd8t0wSzSTmSdDhCWteTUpYiQ50wr2enH1-Q8gq0tskL7YiEFRbZPiSDMQj3qSnFqa4WKpxLzXqxteFHUUjLnIQ3-GG4zTzzQ2U8SnvuTS4CHYL5K8tppb6JxhInKSJEJxyxK726hidXGs6PTlHoMfpgqryPlLtsy67jDCpXrdvw7bcoiOVZw65jhbvtDoKqWThj_Q-eiEBn3PlhPlpC3nky3Su5EecdL9qcWfX2He-PzxFXORKk0IVPasZ2wwutpqm2ZUCzTpo9nQjmkHZdHG9Fo60pC6wGSU4kNKTwdGOmbzsyO4zgOGJ217WOcqMQd5sxwcsKnCXMmVI77oO14tpU3qilHwpxJbl1PbL5lAo8Y4VZX6H3tZX-w5AegNVI0441JUYlOY-fx_y9aTIiN2j4lzLjtY933oK2wTpfEq59CBfaFmev4z9k7pE0oAvZNFFMyR2V1ZkUlJPfzlLktod1q2ZnS-OxZgBIWSExqfV2bQHMb2rS47jVK2vDS11EoU7uGAkKVPTDCINiaOlrDUED7STLLC2xJ0-eVX15ClewhpWEfGiRXUxpGQGdGHsf7ketLQbVEZkinPBXyyMrqUENc5bpiFrtZ3iBFhXdadXb9m2TmxWqV6lrlTc9yKVH274EAy7SyjrjwLa60n0a7ULaDfv_BXbTDzGk69qJQUTRbz6fJHJLpi-U8ZOXM1KkU2dkeTqInHBar5AJWVwms3iyXw-hJ2p40X7Or1SZZTxerBPbMXOMtvF4vXk3X7-GP-Xs44TDdzE6H0ZPF6uX8HexZykS-h5M0nEenl1E0XSbz9aPmF6vf57MENsk0WWySxWwDTz9EAAB_hf_-b8B3ZXjXDCYQDx-O22E-mMCHb4eN_ODb98dDeULuMGfcDSYwOI_HF6N4PIrHEI8ncTyJ48GBsN_UQoUHQq08YBwf2g7TKDzm3K3xjg0OwWEYfwUewvyQ_abw_Nn4_Fm4-3v4X0NOf0nIwcNfF3X08ellFM3fvV5OFys4uXqdDGG-ensKm_nSk-J_8Nv66hXsYboBrXDY_HI3-jIajUajSCiFNAqPgpOMtLWnEXy5_-fL_ecv958h7Mw9fOD2uVb4sePK3ehwdd9eFUI6JAsnjmo8jf4NAAD__6cPHvY=

#
# Set a relevant session variable to a non-default value and ensure it shows up
# in the environment dump.
#

statement ok
SET reorder_joins_limit = 63

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzZtrF7batSgKgpKOZC4UyZKUamcY0IfIE_ZJBlJO4mKW1WJoLoKIOd_5_c5H9vvwBrVhUoxgItNrLWm6fv4McINpUjGeoQaLxkLdWAVBvw-Uc_mJKI2KaiTUEKksUZwKWFMDdo2QYU4rbqGmvMIRyDx3uFQaS0xKhSGfmF2TnRVJJSeG3WAHPKMuky1vtZuuFmfw8vk7b7zzzYQ96vty39hqKgxNLZOCKM2kZnbbBhRSl5S3oT9WlDO7JTInBnXN0tYENBYVp7rNkUaaESl4ax53zTmArQySXLphofaOTJcTpjH186hKQfVuVihowjHrxJqGF3nFObEO0uCP4VZR7IDWfOTw1J1cATwUc2dJKytdiCYRwkrFWcosMchdurnUpFKOHa2hxCH4fqucj4TadE2MpRZLFLY98a-8CYPakpwaSxS1628ClRW3TLk_ZMZyllKXg3Fk8X3r6PTOyQ0rbmhB_pKsa-9wo1yfqMgIK4TUSIS0pGaGOT_NtA1hgqRSdfGMCYu6pvzoIippbKHROACnusCGFI4ORMtPrZ0dhGHoMTLdrY-yrGQ3mBFFtWWuTZgRJjLceG_Huy1cUKkz1JgRTo3tqM2tjOcR0biWJbpcO9nvIzkBNIqzRt4IZyVrDXYR_ny5w_ja9G5PNabUdLHua9CaGSsLTcvvQnn2ec219Pvi7dPGDwG7FEUVxOqiPDesZJw6PSV2rdGsJW9taXg-9FCNOWrCpbyulKe58WuaX3cG1VLRws2RCVXZhgJMFF1KpNFb7mI1Q3wKvwwPipKfofnIiaE57njTlZi7v5goyENX_ZWoUNtKJ14FWptyGO9U101DVxyJ0jKhCeNHbq0WN5qKTJbEYDvRGyQr8UaK1sV_HU-cWSUSWYmsWVvKOfLuq8DDUimM1ZS5LRfSCVLtJ7e38t94HdWYWqmPPSpEEEyW0TiOIB4_m0W-K-eqSjhLzzdwEjyiMJ3HlzBfxDB_PZudBY-S3UnzNVnMV_FyPJ3HsCHqGrfwajl9OV6-gz-id3BCYbyanJ4Fj6bz59Fb2JCEsGwDJ4k_D06vgmA8i6PlwfDT-e_RJIZVPI6nq3g6WcHj9wEAwN_-t_vp0brwT5veCMKzh-OdnvdG8P7-sLHv3X9_2LfXSC1mhNreCHoX4eCyHw764QDCwSgMR2HY2zN2lzUT_o1QCQcYhPuxvSD595zdKpdYbx_s9fgOuA9zOnvv8GI4uBj6__1z9n9LTn5IyT7DH1d18OHx1RFubh03q_9ws27j5vYAN6s7bn5lV5PcWb5YLKPpr_PGsj6FZfQiWkbzSbSCO36e0AdiO5wndt1N7O1BYvt6o7evZuPpHE4Wr-IziOZvTmEVzZztT_BiuXgJW_jzt2gZQQVPYXgV9Pv9fuDfANsAvtzefrn9_OX2M9wriB3Bk8EI3j8ZQh-eDD8E_wYAAP__0YxFtw==

# Make sure it shows up correctly even if it matches the cluster setting.
statement ok
SET CLUSTER SETTING sql.defaults.reorder_joins_limit = 63


query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzZtrF7batSgKgpKOZC4UyZKUamcY0IfIE_ZJBlJO4mKW1WJoLoKIOd_5_c5H9vvwBrVhUoxgItNrLWm6fv4McINpUjGeoQaLxkLdWAVBvw-Uc_mJKI2KaiTUEKksUZwKWFMDdo2QYU4rbqGmvMIRyDx3uFQaS0xKhSGfmF2TnRVJJSeG3WAHPKMuky1vtZuuFmfw8vk7b7zzzYQ96vty39hqKgxNLZOCKM2kZnbbBhRSl5S3oT9WlDO7JTInBnXN0tYENBYVp7rNkUaaESl4ax53zTmArQySXLphofaOTJcTpjH186hKQfVuVihowjHrxJqGF3nFObEO0uCP4VZR7IDWfOTw1J1cATwUc2dJKytdiCYRwkrFWcosMchdurnUpFKOHa2hxCH4fqucj4TadE2MpRZLFLY98a-8CYPakpwaSxS1628ClRW3TLk_ZMZyllKXg3Fk8X3r6PTOyQ0rbmhB_pKsa-9wo1yfqMgIK4TUSIS0pGaGOT_NtA1hgqRSdfGMCYu6pvzoIippbKHROACnusCGFI4ORMtPrZ0dhGHoMTLdrY-yrGQ3mBFFtWWuTZgRJjLceG_Huy1cUKkz1JgRTo3tqM2tjOcR0biWJbpcO9nvIzkBNIqzRt4IZyVrDXYR_ny5w_ja9G5PNabUdLHua9CaGSsLTcvvQnn2ec219Pvi7dPGDwG7FEUVxOqiPDesZJw6PSV2rdGsJW9taXg-9FCNOWrCpbyulKe58WuaX3cG1VLRws2RCVXZhgJMFF1KpNFb7mI1Q3wKvwwPipKfofnIiaE57njTlZi7v5goyENX_ZWoUNtKJ14FWptyGO9U101DVxyJ0jKhCeNHbq0WN5qKTJbEYDvRGyQr8UaK1sV_HU-cWSUSWYmsWVvKOfLuq8DDUimM1ZS5LRfSCVLtJ7e38t94HdWYWqmPPSpEEEyW0TiOIB4_m0W-K-eqSjhLzzdwEjyiMJ3HlzBfxDB_PZudBY-S3UnzNVnMV_FyPJ3HsCHqGrfwajl9OV6-gz-id3BCYbyanJ4Fj6bz59Fb2JCEsGwDJ4k_D06vgmA8i6PlwfDT-e_RJIZVPI6nq3g6WcHj9wEAwN_-t_vp0brwT5veCMKzh-OdnvdG8P7-sLHv3X9_2LfXSC1mhNreCHoX4eCyHw764QDCwSgMR2HY2zN2lzUT_o1QCQcYhPuxvSD595zdKpdYbx_s9fgOuA9zOnvv8GI4uBj6__1z9n9LTn5IyT7DH1d18OHx1RFubh03q_9ws27j5vYAN6s7bn5lV5PcWb5YLKPpr_PGsj6FZfQiWkbzSbSCO36e0AdiO5wndt1N7O1BYvt6o7evZuPpHE4Wr-IziOZvTmEVzZztT_BiuXgJW_jzt2gZQQVPYXgV9Pv9fuDfANsAvtzefrn9_OX2M9wriB3Bk8EI3j8ZQh-eDD8E_wYAAP__0YxFtw==

statement ok
SET enable_zigzag_join = true

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpKOZC4UyZKUamcY0IfIE_ZJBlJK4mKW1WJoLoKI-b7z-51DDofwBrVhUkxgJtNrLWm6fv4McINpUjGeoQaLxkLdoIJgOATKufxElEZFNRJqiFSWKE4FrKkBu0bIMKcVt1BTXuEEZJ47XiqNJSalwpBPzK5JiyKp5MSwG-yhZ9RFsuWduPnq6gRePn_nwa1tJuxB2-e7YKupMDS1TAqiNJOa2W0XUUhdUt7F_lhRzuyWyJwY1DVLOwPQWFSc6i5DGmlGpOCdcdwVZw-3Mkhy6ZqF2hsyfUaYxtT3oyoF1W2vUNCEY9bLNY0u8opzYh2l4R_iraLYEa35yOGpO7kAeEjmDkkrK52LJhDCSsVZyiwxyF24udSkUk4dna7EPvpuqZyNhNp0TYylFksUtjvwr6wJg9qSnBpLFLXrbyKVFbdMuT9kxnKWUheDcWLxdeurWGvlhhU3tCB_SSZc8cTe2rXdwY1ypaIiI6wQUiMR0pKaGeYsNQ03hAmSStUnNSYs6pryg7OopLGFRuMInOoCG104RRAtP3UWdxSGoefItJ0gZVnJbjAjimrLXKUwI0xkuPHWDhdcOKdSZ6gxI5wa25ObmxovJaJxLUt0sfYOgPfkdqBRnDUbjnBWsk5nZ-HP5y3H56bbUdWYUtMnvK9Ja2asLDQtv4vlBejXrqXf529XNr4J2LdUVEGsLspTw0rGqVupxK41mrXknSUNT8eeqjFHTbiU15XyQjd-UvPrXqdaKlq4PjKhKttIgImib7Q0emTrq2niU_hlvHe2fA_NR04MzbHVTV9g7gpjoiAPVfW3okJtK534RdBZlP18t3hdN3TFkSgtE5owfuDi6jCjqchkSQx2C71hshJvpOgc_NfxzMEqkchKZM3YUs6R998GnpZKYaymzE25kG4h1b5zOyP_jTdSjamV-tC7QgTBbBlN4wji6bPLyFflVFUJZ-npBo6CRxTmi_gcFlcxLF5fXp4Ej5L2pPmaXS1W8XI6X8SwIeoat_BqOX85Xb6DP6J3cERhupodnwSP5ovn0VvYkISwbANHiT8Pji-CYHoZR8u97ueL36NZDKt4Gs9X8Xy2gsfvAwCAv_1v9zOgdeFfN4MJhCcPx-0-H0zg_f1hgx_cf3_YxWukFjNC7WACg7NwdD4MR8NwBOFoEoaTMBzsgN19zYR_JlTCEUbhrm-_kPyTzm6VC2ywS_b7-I64S3N79t7g2Xh0Nvb_--fk_6ac_JCUfYQ_Luvgw-OLA9rcOm1W_9Fm3aXN7R5tVnfa_ApXk9whX1wto_mviwZZH8MyehEto8UsWsGdPo_og7Adzwu77hf2dq-wfb7R21eX0_kCjq5exScQLd4cwyq6dNif4MXy6iVs4c_fomUEFTyF8UUwHA6HgX8DbAP4cnv75fbzl9vPcL9B7ASejCbw_skYhvBk_CH4NwAA__8jYUW7

statement ok
SET optimizer_use_histograms = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpKOZC4UyZKUamcY0IfIE_ZJBlJK4mCWVWBoLoKIOd_5-c53DjkcwjvUhkkxgZlMr7Wk6frlC8ANpknFeIYaLBoLdWMVBMMhUM7lF6I0KqqRUEOkskRxKmBNDdg1QoY5rbiFmvIKJyDz3OFSaSwxKRWGfGF2TVorkkpODLvBHnhGXSZb3mk3X12dwOuXH7xx65sJe9D3-a6x1VQYmlomBVGaSc3stgsopC4p70J_rihndktkTgzqmqWdCWgsKk51lyONNCNS8M487sjZg60Mkly6ZqH2jkyfE6Yx9f2oSkF12ysUNOGY9WJNo4u84pxYB2nwh3CrKHZAaz5zeO5OLgAeirmzpJWVLkSTCGGl4ixllhjkLt1calIpp47OUGIffJcq5yOhNl0TY6nFEoXtTvyRN2FQW5JTY4midv1doLLilin3h8xYzlLqcjBOLJ63PsZaLzesuKEF-Usy4cgTe7lru4Mb5aiiIiOsEFIjEdKSmhnmPDUNN4QJkkrVJzUmLOqa8oOzqKSxhUbjAJzqAhtdOEUQLb90kjsKw9BjZNpOkLKsZDeYEUW1ZY4pzAgTGW68t8OECxdU6gw1ZoRTY3tqc1PjpUQ0rmWJLtfeAfCR3A40irNmwxHOStYZ7Cz8-bzF-Np0O6oaU2oOCs-1_zFqzYyVhaalOTBB9ynuAL0I_eq1tE_sj5G70vGNwL7FogpidVGeGlYyTt1aJXat0awl76Q1PB17qMYcNeFSXlfKi934ac2ve4NqqWjhesmEqmwjAyaKvvHS6C3bWE0jn8Mv473M-j6az5wYmmOrnb7E3DXGREEeWPU3o0JtK534ZdBJyn68W76uG7riSJSWCU0YP3B5dbjRVGSyJAa7xd4gWYk3UnQO_9t45swqkchKZM3oUs6R998IHpZKYaymzE26kG4p1b5zO2P_nbdSjamV-tDbQgTBbBlN4wji6YvLyLNyqqqEs_R0A0fBEwrzRXwOi6sYFm8vL0-CJ0l70nzNrhareDmdL2LYEHWNW3iznL-eLj_AH9EHOKIwXc2OT4In88XL6D1sSEJYtoGjxJ8HxxdBML2Mo-Xe8PPF79EshlU8jeereD5bwdOPAQDA3_63-xnQuvAvnMEEwpOH43anDybw8f6wsR_cf3_atddILWaE2sEEBmfh6HwYjobhCMLRJAwnYTjYMXZ3NhP-qVAJBxiFu7H9TvLPOrtVLrHBLtjv5DvgLszt2nuHZ-PR2dj_75-T_1ty8kNK9hn-uKqDT08vDmhz67RZ_UebdZc2t3u0Wd1p85FdTXJn-epqGc1_XTSW9TEso1fRMlrMohXc6fOIPgjb4byw635hb_cK29cbvX9zOZ0v4OjqTXwC0eLdMayiS2f7E7xaXr2GLfz5W7SMoILnML4IhsPhMPDvgG0A325vv91-_Xb7Fe43iJ3As9EEPj4bwxCejT8F_wYAAP__XQNGHQ==

statement ok
SET optimizer_use_multicol_stats = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zgTva6eYuCbJh_iVI4_LAIHvXBddde7qVPYardFURCUNJK5oUiWpFQ7iwX6EHnCPsmClJI4qGUVWDQXQcTMmZ8zZ4YcDuEdasOkmMBMptda0nT98gXgBtOkYjxDDRaNhbqxCoLhECjn8gtRGhXVSKghUlmiOBWwpgbsGiHDnFbcQk15hROQee5wqTSWmJQKQ74wuyatFUklJ4bdYA88oy6TLe-0m6-uTuD1yw_euPXNhD3o-3zX2GoqDE0tk4IozaRmdtsFFFKXlHehP1eUM7slMicGdc3SzgQ0FhWnusuRRpoRKXhnHnfk7MFWBkkuXbNQe0emzwnTmPp-VKWguu0VCppwzHqxptFFXnFOrIM0-EO4VRQ7oDWfOTx3JxcAD8XcWdLKSheiSYSwUnGWMksMcpduLjWplFNHZyixD75LlfORUJuuibHUYonCdif-yJswqC3JqbFEUbv-IVBZccuU-0NmLGcpdTkYJxbPWx9jrZcbVtzQgvwlmXDkib3ctd3BjXJUUZERVgipkQhpSc0Mc56ahhvCBEml6pMaExZ1TfnBWVTS2EKjcQBOdYGNLpwiiJZfOskdhWHoMTJtJ0hZVrIbzIii2jLHFGaEiQw33tthwoULKnWGGjPCqbE9tbmp8VIiGteyRJdr7wD4SG4HGsVZs-EIZyXrDHYW_v-8xfjadDuqGlNqDgrPtf8xas2MlYWmpTkwQXuRXoV-91pqe9DfJbsrH98M7FsuqiBWF-WpYSXj1K1WYtcazVryTmrD07GHasxREy7ldaW84I2f2Py6N6iWihaun0yoyjZSYKLoGzGN3rKN1TTzOfwy3suP76X5zImhObb66UvMXWVMFOSBVX87KtS20olfCJ2k7Me7Bey6oSuORGmZ0ITxAxdYhxtNRSZLYrBb8A2SlXgjRecCeBvPnFklElmJrBlfyjny_lvBw1IpjNWUuWkX0i2m2nduZ_R_8GaqMbVSH3pfiCCYLaNpHEE8fXEZeVZOVZVwlp5u4Ch4QmG-iM9hcRXD4u3l5UnwJGlPmq_Z1WIVL6fzRQwboq5xC2-W89fT5Qf4I_oARxSmq9nxSfBkvngZvYcNSQjLNnCU-PPg-CIIppdxtNwbfr74PZrFsIqn8XwVz2crePoxAAD42_92PwNaF_6VM5hAePJw3O71wQQ-3h829oP770-79hqpxYxQO5jA4CwcnQ_D0TAcQTiahOEkDAc7xu7eZsI_FyrhAKNwN7bfS_5pZ7fKJTbYBfu9fAfchbl9e-_wbDw6G_v__XPyX0tOfkrJPsOfV3Xw6enFAW1unTar77RZd2lzu0eb1Z02H9nVJHeWr66W0fzXRWNZH8MyehUto8UsWsGdPo_og7Adzgu77hf2dq-wfb3R-zeX0_kCjq7exCcQLd4dwyq6dLb_g1fLq9ewhT9_i5YRVPAcxhfBcDgcBv4tsA3g2-3tt9uv326_wv0GsRN4NprAx2djGMKz8afg3wAAAP__2QdGfw==

statement ok
RESET reorder_joins_limit

statement ok
RESET enable_zigzag_join

statement ok
RESET optimizer_use_histograms

statement ok
RESET optimizer_use_multicol_stats

#
# Test sequences.
#

statement ok
CREATE SEQUENCE seq

query T
EXPLAIN (OPT, ENV) SELECT * FROM seq
----
https://cockroachdb.github.io/text/decode.html#eJyUVsFu20gMvfsr5ri7qAMnbptsgx68rhYIEDvd2Am6J4KWKImb0cyYM3ISf_1iRi6aApHV3ISE75Hz-Eh6PFb3JJ6t-aTmNn8Qi3n95S9FT5RvWtYFiQrkg9p1UaPReKxQa_sITsihEKAH6wI4jUbV6FWoSRVUYquD2qFu6ZOyZRlxufUBfI7GwyOHGg5RkFsNnvc0AC8wVvKse-OuVjfv1OLLvyn4wM0mHOW-eBkcBI3HPLA14IStcHjuAxorDeo-9LZFzeEZbAmeZMd5bwFCVatR-oiEsABrdG8d38V5Bdt6gtLGZpEkIj9EwkJ56kfbGJRDr8jgRlMxiPWdL8pWawgR0uGP4VbZOgKD32r1Of7lUqkfj_keiW2wMUVXCHDjNOccwJOO5ZZWoHXRHb2pzGvwl1JFjg2GvAYfMFBDJvQX_hOb8SQBSvQBHIb6l0BNqwO7-GELLjnHWIOPZkm6DSh9INlztccK_rM8NHf05KJOaArgylghMDbAjj1Hnq7bHthAbt2Qz9gEkh3qo4PorA-VkI8AjVJRZ4poBxD72Kvs6WQySRibH8bHBW54TwU4lMBRJiqATUFPie242iYmtVKQUAEafRh4WxyZ5CMQqm1DsdZB96dMcQF6p7lbb6C54d5kZ5P3FwdMepsc5lQoRz_kup9BNftgK8HmTajkvrRzA74t30vbpCbQ0EZxFQSpmhPPDWuM-xRCLeRrq3slnZxME1SoJAFt7UPrks19GtPyYTCpWIdV7CMb14bOAmyqoU0klCIPubomflYfp68updRDv9XgsaSDb4YKi_eLTQU_VE0n0ZGEVjZpC_SK8jo-bt3YDWk1gRO7wQ3rI1erh0bQFLYBT_1G75Dc0N6a3sG_W89jWGs2tjVFN7aoNenhU5BguTU-CHKccmPjQtqlzr0Y-V88RzvKg5VjPyrMaDS_zWbrTK2yf-6y5TxTrt1ozk88bdXiank_u77L1KlazL51n3-enU2n52eT6ceLD-_Pzz9cTM7V1XJ-my2y5VqdqtV6drtWp5ejUfbt6_Xsaql-u_m6fqey5f3vapVdZ_O1-kP9fXuzUJ62l6PxeDweedq2ZHIad9cs_mf0fwAAAP__CYVvLg==

#
# Test views.
#

statement ok
CREATE VIEW v AS SELECT a, b, u, v FROM x, y WHERE b = 3

query T
EXPLAIN (OPT, ENV) SELECT * FROM v
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvo6e4sA3tQc7keNhCBwUmOuqm7fUKWz1D0VBUNKRzYUmVZJS7AwDij1DLvd0eZKBlJw4q2W1GJqLwKa_7_x-55C9HrxBpZkUQxjL-EpJGi-fPwNcYxzljCeowKA2UJQoz-v1gHIur0mmMKMKCdVEZoZknApYUg1miZBgSnNuoKA8xyHINLW8WGpDdEyFJtfMLEmFIrHkRLMbbKAn1Eay4bW4yfyyCy-fv3fgyjYT5qDts12wUVRoGhsmBckUk4qZTR1RSLWivI79KaecmQ2RKdGoChbXBqBwkXOq6gwppAmRgtfGsS3OHm6ukaTSNguVM6SbjDCFsetHvhJUVb1CQSOOSSNXl7pIc86JsZSSf4g3D0JLNPoTh6f25BzgIZktkuZGWhdlIIStMs5iZohGbsNNpSJ5ZtVR60rso--WytqIqImXRBtqcIXC1Af-yJrQqAxJqTYko2b5VaRVzg3L7AeZsJTF1MagrVhc3RoqXRm5YYsbuiB_SNY0d7jObJ2oSAhbCKmQCGlIwTSzdspua8IEiWXWpDMmDKqC8oODmEltFgq1JXCqFliKwsqBKHldW9m-7_uOI-NqfDLDVuwGE5JRZZgtEyaEiQTXztrhagvrVKoEFSaEU20acrMj43REFC7lCm2sjep3nuwC1Bln5XojnK1YrbNT_8eziuNyU9WcKoypblLdY9KSaSMXiq6-ieXU53auod_mb1c2rgnYtFGyBTFqsTrWbMU4tfuUmKVCvZS8tqT-8cBRFaaoCJfyKs-czLUb0_Sq0amSGV3YPjKR5aaUABOLpk2k0CErX2UTn8JPg71LyfVQf-JE0xQr3TQFZu8vJhbkoaruSsxQmVxFbgvUFmU_325d2w2VcySZkhGNGD9wa9WYUVQkckU01gu9ZLIV3khRO_ivw7GF5SKSuUjKsaWcI2--ChwtlkIbRZmdciHtQipc53ZG_iuvowJjI9WhR4XwvPEsGIUBhKNnF4GrynGWR5zFx2toe0cUJtPwDKaXIUxfX1x0vaOoOim_jS-n83A2mkxDWJPsCjfwajZ5OZq9h9-D99CmMJqPO13vaDJ9HryDNYkIS9bQjty51zn3vNFFGMz2up9MfwvGIczDUTiZh5PxHJ588AAA_nT_7V-LFgv3tGkNwe8-HFf7vDWED_eHJb51__3jLl4hNZgQalpDaJ36_bOe3-_5ffD7Q98f-n5rB2wvaybcGyEXltD3d327heTec2aT2cBau2S3j7fEXZrds_cGTwf904H77a_u_005-i4puwi_X9bexyfnB7S5sdrMv9BmUafNzR5t5lttPsIVJLXIF5ezYPLLtEQWHZgFL4JZMB0Hc9jqs00fhG15TthFs7A3e4W9m--bSfB266ZwU2jnrusd5TZHrwOjOcyDC2uDdiHqQt6FAl7MLl8-nqDuf_y-_TWYBRDBUxice17w7tXFaDKF9uWrsAvB9E1na_SH0lZx7vV6vZ7HhEDVc2-sdqyk1h0P7m7_ubv9fHf7GdwTZPPFyfrnatjtL3_bnt7d3laA-w1nhnByetIfwoeTAfTgZPDR24GljBtUGtpG5djx_g0AAP__c8KHKQ==

#
# Test tables in user-defined schemas.
#

statement ok
CREATE SCHEMA s;
CREATE TABLE s.t (a int primary key)

query T
EXPLAIN (OPT, ENV) SELECT * FROM s.t;
----
https://cockroachdb.github.io/text/decode.html#eJyUVtFu20YQfA6_4t4SF5bhNkVhxMiDoqiAWlk2JCaoURSLFbkkrz7enfeWsq2vL-6oIE5hismbYezMLmdn5zSZqM_EQTv7Ts1ccccOi-bjB0WPVGw7bUpiJRRE7fqqLJtMFBrjHsAzeWQCDOC8gDdoVYNBSUOqpAo7I2qHpqN3ylVVxBUuCIQCbYAHLQ0cqqBwBoLe0wi8xDjJkxmsW2yuT9XVx9tUfODWVo5yXzwvFkYbsBDtLHjWjrU8DQGt4xbNEPq-Q6PlCVwFgXini8EBmOrOIA8RMWEJzprBOb6I8wK2CwSVi8siTkRhjEQzFWkfXWuRD7sii1tD5Sg29L6oOmNAIqTHH8Nt5nkESrg36n38z6VSXz_mSyV24mKLfhDQrTe60AKBTBy3cgydj-4YbGVfgj-XKnJsUYoGgqBQS1aGB_-GzQZigQqDgEdpvgvUdka0j3-4Ule6wDhDiGZJuo0ofSDZ63qPNfzr9Njd0aOPOqEtQdfWMYF1AjsddOTptx1AWyicH_OZtkK8Q3P0EL0LUjOFCDDINfWmiHYAdg-Dyv58fn6eMK44nI8X3eo9leCRRUeZqARtS3pMbMfVtrGp45KYSjAYZOTb4skkHwFT41qKs466P3WKARi80X28gdGtHmz2y_mvFwdM-jY-3ClTgWHMdd-CGh3E1YztD6GS-1LmCv5Yv-e2SUugsUTxNQjX7VnQrTYY8xSkYQqNM4OSnp-9TVCmihiMc3edTzYP6Uyru9Gm7DzWcY_a-k56C2hbjyURU6o89OqX-F799vbFUEo7DPcGAlZ08M3YYPH90raGr6qmJ9ETS8fblAKDoryMj6kbt8GdIfDstrjV5sirNUDDaEvXQqBho_dI3dLe2cHD_5TPYllnt66zZX-2aAyZ8acgwQpngzDqeOXWxUDapc09O_nvfI52VIjjYz8qbJbN1vNpPlf59MNynlQ5C2ei3mSvUC1W-YVaXedq9Wm5PM1eza5Xm3w9XaxyJeDv6EndrBdX0_Wt-nN-q96gmm5mJ9nJZZZNl_l8_X_OxeqP-SxXm3yaLzb5YrZRr__-5_Vlls3_ullOFyv15vomP1Xz1ecTtZkvY-1P6vf19ZUKZ3KZTSaTSZYCT7L_AgAA__8VC3Wy

#
# Test default_transaction_quality_of_service settings.
#

statement ok
SET default_transaction_quality_of_service=background

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVsFu20gMvfsr5pgAceFsF4uiRQ7dNocC3bZA0mD3RNASJXEzGk44lJP41I_IF-ZLihm5aApYVnMzDL5HzuMjqeXSXZEmlvDavZPqWgWr7v3fju6oWg_sa1JnlMxtxqjFYrl06L3cQlSKqASYQKJB9Bhch8lZR66mBgdvboN-oNdOmibjKkkGqcKQ4Jatg10UVOIh8ZZm4DXmSu79ZNyHi88n7p_3_5XgHTcHO8j96mmwKYaElbEEiMqibPdTwCDao19cnF_uhd8M6NnuQRpIpBuuyJ25NVbXrcoQ6jfO_cz7g1KpHTzqVEVKWIMEP1nSD532YIdE0EjuG2khSnMkrFSV1gx9QN21jQKuPdWz2DRapBm8B8uQEX8IV4TkZOnGu7P8z16JcDDJKcZCgPvouWKDRD6X24jCELNRJlOFffCnUmWONVrVQTI06inYdOG_sIVEatBgMoho3W-B-sEbx_xDam64wlxDyrYpus0ovSPZcrvFFv4XnhtBuotZJww1cBtECYIYbDhx5hm7nYADVBLnfMbBSDfoD85klGStUsoAj9rSaIpsB1C5nVT2dLVaFYxUu0GKxj1vqYaIapxloho41HRX2A6rHXJS0ZqUavCYbOZteWSKj0Cpk55yrbPuL5nyLkzR87jpwHPPk8n-WP35aocpb9PdnCpVmOZc9yuo42TSKvbPQhX3lfVr-Lx8T21TmkBzGyW2YNr2LxL37DGvVrBOKXXiJyVdvXhZoEoNKXiR6yEWm6cyps31bFKViG3uI4c42GgBDu3cJlIqkbtcYxPP3F8v9y6l0sN04yFhQzvfzBWWTxmHFn6qWq5jJLVB12ULTIqyH5-3bu6GDp4gqqxxzf7AAZugUQy19JBo2ugjknvaSpgc_K-X73LYENb53o1ji96Tnz8FBVZJSKbIecqD5IW0KZ17MvK_eY42VJnooe-LsFic__vl49sPn9zR5y-XJ-7809Wxu3r78ev5hTs6PX6zWC6Xy0UJTwv3-PDw-PDt8eGbOzo9OV58DwAA__-3Blsr

statement ok
SET default_transaction_quality_of_service=critical

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVsFu20gMvfsr5pgAceFsF4uiRQ7dNocC3bZA0mD3RNASJXEzGk44lJP41I_IF-ZLihm5aApYVnMLAr5H6vHxjZdLd0WaWMJr906qaxWsuvd_O7qjaj2wr0mdUTK3GasWi-XSofdyC1EpohJgAokG0WNwHSZnHbmaGhy8uQ36gV47aZqMqyQZpApDglu2DnZVUImHxFuagdeYJ7n3k3UfLj6fuH_e_1eKd9wc7CD3q6fFphgSVsYSICqLst1PAYNoj35xcX65F34zoGe7B2kgkW64InfmKmXjCv0b5352_UGo1A4edWoeJaxBgp8c6IdKe7BDImgkb420EKU5ElaqymKGPqDulkYB157qWWwaDdIM3oNlyIg_hCsycrJ0491Z_s9eiXAwyS3GQYD76Llig0Q-j9uIwhCzTSZbhX3wp1JljjVa1UEyNOop2PTgv7CFRGrQYDKIaN1vgfrBG8f8h9TccIV5hpRNU3SbUXpHsuV2iy38Lzx3gHQXs04YauA2iBIEMdhw4swzbjsBB6gkzvmMg5Fu0B-8yCjJWqWUAR61pdEU2Q6gcjup7OlqtSoYqXZnFI173lINEdU4y0Q1cKjprrAdVjvkpqI1KdXgMdnMt-WTKT4CpU56yrPOur90ykmYoucx58Bzz5PN_lj9-WqHKd-muztVqjDNue5XUMfJpFXsn4Uq7ivha_i8fk9tU5ZAc4kSWzBt-xeJe_aYgxWsU0qd-ElJVy9eFqhSQwpe5HqIxeapnGlzPdtUJWKb98ghDjZagEM7l0RKpXLXa1zimfvr5d5QKjtMNx4SNrTzzdxg-SHj0MJPVcvbGElt0HVJgUlR9uNz6uZt6OAJosoa1-wPPF8TNIqhlh4STRt9RHJPWwmTh__18l0uG8JahlCPZ4vek59_CgqskpBMkfOVB8mBtCmbe3Lyv_kcbagy0UO_LsJicf7vl49vP3xyR5-_XJ64809Xx-7q7cev5xfu6PT4zWK5XC4XpTwt3OPDw-PDt8eHb-7o9OR48T0AAP__KYlaVg==

#
# Test recursive table references from foreign keys.
#

statement ok
CREATE TABLE z (
  pk INT PRIMARY KEY,
  ref INT,
  CONSTRAINT fk FOREIGN KEY (ref) REFERENCES y(u),
  FAMILY "primary" (pk, ref)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM z;
----
https://cockroachdb.github.io/text/decode.html#eJy0VkFv2zgTPVe_gvClyYc4kJMPi8BBD66rLrzr2oWtFi2KgqCkkcw1RbJDSrW92P--IOU0DipZLRbNIYiYeTPzZt4MORyS94CGKzkmU5VuUbF08-olgR2kScVFBkgsGEvqxioIhkPChFBfqUbQDIEyQ5W2VAsmyYYZYjdAMshZJSypmahgTFSeO1yqjKUmZdLQr9xu6NGKpkpQww_QA8-Yy2QvOu1m6-UVefPqozc--ubSnvV9d2pskUnDUsuVpBq5Qm73XUCpsGQiWEdxK_xLxQS3e6pyagBrngJ5QVLklqdM3BPyGPXBIUJRCYZd-SCwjCopOhN6qFILtjJAc-W6BugdmT4nHCH1jalKyfDYNJAsEZD1Yk0jkLwSgloHafDncL6M3FjzRZAX7qS1RKyyyoVoEqG81IKn3FIDwqWbK6SVdjLpDCXb4Kelcj4SZtMNNZZZKEHa7sSfeJMG0NKcGUs1s5sfApWVsFy7P1TGc54yl4NxovF166n00cmBFwdW0L8U7xtA2GlXJyYzygupEKhUltbccOen6bahXNJU6T6dcWkBaybOTqRWxhYIxgEEwwIaUTg5UFRfOys7CsPQY1R6HCNteckPkFHN0HJXJsgolxnsvLfz1ZYuqMIMEDIqmLE93NzIeB1RhI0qweXaq34fyW1CowVv9hwVvOSdwW7C_98dMZ4bHucUIWWmT3VPQRturCqQlT-F8urzy9eyn4t3KhvfBOjbKLqgFovy2vCSC-YWK7UbBLNRorOk4fWthyLkgFQota20l7nxY5pve4Oi0qxwfeRSV7aRAJdF3yZC8JbHWE0TX5DfbluXku-h-SKoYTkcddOXmLvIuCzoY1X93agBbYWJ3wKdRWnHu63ruoGVAKpRJSzh4sz11eEGmcxUSQ10C71B8hIOSnYO_rt46swqmahKZs3YMiFA9F8FHpYqaSwy7qZcKreQat-5k5H_weuohtQqPPe6kEEwXUWTOCLx5OU88lW51lUieHq9IxfBM0Zmi_iOLJYxWbybz6-CZ8nxpPmaLhfreDWZLWKyo3oLe_J2NXszWX0kf0YfyQUjk_X08ip4Nlu8ij6QHU0oz3bkIvHnweV9EEzmcbRqDT9b_BFNY7KOJ_FsHc-ma_L8U0AIIX_73-5nwOrCv3EGYxJePR4f9_lgTD59O2zsB9--P5_aIzALGWV2MCaDm3B0NwxHw3BEwtE4DMdhODgxdpc1l_6NUEkHGIWnsf1C8g87u9cuscEp2O_jB-ApzO3Zbw5vbkc3t_5__1z9V8rJL6HsM_x1rIPPz-_PaHPvtFl9p826S5v7Fm1WD9p8YlfT3Fm-Xq6i2e-LxrK-JKvodbSKFtNoTR70ecEehe1wXth1v7D3rcI-z_fg-Ortd4QR8i7KhxbKetvCOd8-ZYuQt_HdX1TneR26eUUf3s4nswW5WL6Nr0i0eH9J1tHc2f6PvF4t35DDfTAcDoeBf88cgn8DAAD__ybPdBc=

# A foreign key cycle shouldn't cause infinite recursion.
statement ok
ALTER TABLE y ADD CONSTRAINT fk FOREIGN KEY (v) REFERENCES z (pk);

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zgTva6eYuCbOh_iQE4-LAIHvXBddeHd1C5stWhRFAQtjWSuKZIlKdfyYt99QUppHFSyWiyaiyBi5szPmTNDjkbwHrVhUkxgJpOdljTZvnoJeMBkUzKeogaLxsK-tgqC0Qgo5_IrURoV1UioIVJZojgVsKUG7BYhxYyW3MKe8hInILPM4RJpLDEJFYZ8ZXZLGiuSSE4MO2IPPKUuk4p32s3Xy0t48-qjN258M2HP-r49NbaaCkMTy6QgSjOpma26gELqgvJgHcWt8C8l5cxWRGbEoN6zBOEFJJpZllB-B_AY9cGhxrzkVHflo5GmRAremdADSy3Y0iDJpOsaau_I9DlhGhPfmLIQVDdNQ0E3HNNerKkFkpWcE-sgNf4cztPIjDVfOLxwJ60U0dJKF6JOhLBCcZYwSwxyl24mNSmVk0lnKNEGP6XK-dhQm2yJsdRigcJ2J_7EmzCoLcmosURRu_0hUFFyy5T7Q6YsYwl1ORgnGs9bD9ONkyPLjzQnf0nWN4B4UI4nKlLCciE1EiEt2TPDnJ-624YwQRKp-nTGhEW9p_zsRCppbK7ROACnOsdaFE4ORMuvncyOwzD0GJk0Y6QsK9gRU6KotszRhClhIsWD93aebeGCSp2ixpRwamxPbW5kvI6Ixq0s0OXaq34fyW1Cozir9xzhrGCdwa7D_982GF-bbuZUY0JNn-qegrbMWJlrWvwUyqvPL19Lfy7eqWx8E7Bvo6icWJ0XV4YVjFO3WIndajRbyTspDa9uPFRjhppwKXel8jI3fkyzXW9QLRXNXR-ZUKWtJcBE3reJNHrLJlbdxBfw203rUvI9NF84MTTDRjd9ibmLjImcPLLq70aF2pZ647dAJynteLd1XTd0yZEoLTd0w_iZ66vDjaYilQUx2C30GskKPErROfjv4pkzK8VGliKtx5Zyjrz_KvCwRApjNWVuyoV0C2nvO3cy8j94He0xsVKfe12IIJitomkcQTx9eR95Vq5UueEsuTrAMHhGYb6Ib2GxjGHx7v7-Mni2aU7qr9lysY5X0_kihgNRO6zg7Wr-Zrr6CH9GH2FIYbqeXVwGz-aLV9EHOJANYekBhht_HlzcBcH0Po5WreHniz-iWQzreBrP1_F8tobnnwIAgL_9b_czoPvcv3EGEwgvH4-bfT6YwKdvh7X94Nv351N7jdRiSqgdTGBwHY5vR-F4FI4hHE_CcBKGgxNjd1kz4d8IpXCAcXga2y8k_7CzlXKJDU7Bfh8_AE9hbs9-c3h9M76-8f_75_K_lrz5JSX7DH9d1cHn53dntHl02lS778SpMeuS57FFnmr3oM8Tw2wHr5eraP77ojbSmF3AKnodraLFLFpDk0I1LM8L-Ngq4PN1Va6u8ruy9l1FVS1FlS01VWRPMmf5pLJ9W12HIe0hpBV2HKrd46C7eH7Q9_2DXnXzFH14ez-dL2C4fBtfQrR4fwHr6N7Z_g9er5ZvoLoLRqPRKPDvoCr4NwAA__-ewIPZ

# Check that we remove histograms from statistics correctly.

statement ok
CREATE TABLE b (
  b BOOL NOT NULL,
  INDEX (b)
)

statement ok
ALTER TABLE b INJECT STATISTICS '[
      {
          "avg_size": 1,
          "columns": [
              "b"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 2,
          "histo_buckets": [
              {
                  "distinct_range": 0,
                  "num_eq": 1000,
                  "num_range": 0,
                  "upper_bound": "false"
              },
              {
                  "distinct_range": 0,
                  "num_eq": 100,
                  "num_range": 0,
                  "upper_bound": "true"
              }
          ],
          "histo_col_type": "BOOL",
          "histo_version": 2,
          "name": "__auto__",
          "null_count": 0,
          "row_count": 1100
      },
      {
          "avg_size": 0,
          "columns": [
              "rowid"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 0,
          "histo_col_type": "",
          "name": "__auto__",
          "null_count": 0,
          "row_count": 0
      }
]'

query T
EXPLAIN (OPT, ENV) SELECT * FROM b
----
https://cockroachdb.github.io/text/decode.html#eJy8Vt9v2zYQfq7-CsIvTYc4UJxuSx30wXVUwJtrF7FatCiKAyWd5FsokiEp58ew_30g5bQuYFnpw5aHICHvuzt9990dh0P2EY0lJcdsqvJro3i-vnzD8A7zrCFRoGEOrWOb1iqKhkPGhVC3oA1qbhC4BaUdaMElW3PL3BpZgSVvhGMbLhocM1WWHpcr68DmXFq4JbeGrRXkSoClB-yBF9xnci867War5TF7d_k5GG99k3QHfZ_vGjvDpeW5IyVBG1KG3H0XUCpTcxGtknQv_Kbhgtw9qBIsmg3lyF6z3JCjnIsLxr5HfXRosGoEN135GOQFKCk6E3pkaQ-2sQil8lVDExzZPidkMA-FaWrJzbZoKHkmsOjF2lYgZSMEOA9p8YdwgUayzt4I9tqf7KWIN075EG0iQLUWlJMDi8KnWyoDjfYy6Qwl98F3qfI-Mu7yNVjHHdYoXXfiP3iTFo2DklsHmrv1k0B1Ixxp_4cqqKSc-xysF03grYfprZMHqh54BX8p6mtAvNOeJy4LoEoqgyCVgw1Z8n7aalsgCbnSfToj6dBsuDjYkVpZVxm0HiC4qbAVhZcDGHXbyexpHMcBo_JtG2lHNT1gAZobR54mLIBkgXfB22G2pQ-qTIEGCxDcup5v8y0TdAQG16pGn2uv-kMkPwmtFtTOORBUU2ewUfzyfIsJ32a2fWow57ZPdT-C1mSdqgyvfwoV1BeGr-M_F29XNqEI2DdRdAXOVPWJpZoE94MV3NqgXSvRSWl8chagBks0IJS6bnSQuQ1tWl73BjVK88rXkaRuXCsBklXfJDIYLLex2iK-Zr-d7R1KoYb2RoDlJW5105eYX2QkK_jOatiNGo1rTBamQCcp-_F-6vpqmEYgaKMynpE4sL463BguC1WDxW6ht0iq8UHJzsb_kE69WSMz1ciibVsuBIr-VRBguZLWGU6-y6XyA2kTKrfT8k9cRxvMnTKHXhcyiqZXySRNWDp5M08CKye6yQTlJxk7ip5l7M1yOWeLZcoWH-bz4-iZUbdUsNkiPQ-nH2ermUc-WrDL5O3kwzxljaSbJowPKo5eHEfPpsvFKr2azBYpy0Bf4z17fzV7N7n6zP5MPrOj1u9kNfW2s8Vl8ollkAEVd-woC-fRi4somszT5GpvtrPFH8k0Zat0ks5W6Wy6Ys-_RIwx9nf47X8GfFOFJ9FgzE6Pvx9vx_9gzL58OwwX2eDb_1937Q1yhwVwNxizwSgejYano2E8Yqfn47OX49Grk19_f_nqbDTYwfgVTzK8LBrpcaOdyzDEwmPQ3Wuf3WAXKnkdzgD8KwDghzs_3x9dxjsXfm4_np-exnG4-ef4ACPxUxgJZfoPWYn_P1a2lERfn19EUfLp_XwyW7Cj5fv0mCWLjy_YKpl7Qf3C3l4t37HsIhoOh8MorNws-jcAAP__04wTrQ==
