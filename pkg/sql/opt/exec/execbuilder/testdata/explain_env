# LogicTest: local !metamorphic-batch-sizes
# We must turn off metamorphic variables because some are included in
# EXPLAIN (OPT, ENV) output.

statement ok
CREATE TABLE x (
  a INT PRIMARY KEY,
  b INT,
  INDEX (b),
  FAMILY "primary" (a, b)
)

statement ok
ALTER TABLE x INJECT STATISTICS '[
  {
    "columns": ["a"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 100,
    "histo_col_type": ""
  },
  {
    "columns": ["b"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 123123,
    "histo_col_type": ""
  }
]'

statement ok
CREATE TABLE y (
  u INT PRIMARY KEY,
  v INT REFERENCES x,
  INDEX (v),
  FAMILY "primary" (u, v)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM x WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4kZNdBA4KzHXVzVvqFLbatSgKgpKOZC4UyZKUamcY0IfIE_ZJBlJK4mCW1WJoLoKIOd_5_c5HDofwFrVhUoxhKtNrLWm6evEccI1pUjGeoQaLxkLdWAXBcAiUc_mZKI2KaiTUEKksUZwKWFEDdoWQYU4rbqGmvMIxyDx3uFQaS0xKhSGfmV2R1oqkkhPDbrAHnlGXyYZ32s2WV0fw6sV7b9z6ZsLu9X2-bWw1FYamlklBlGZSM7vpAgqpS8q70J8qypndEJkTg7pmaWcCGouKU93lSCPNiBS8M4-75uzAVgZJLt2wUHtHps8J05j6eVSloLqdFQqacMx6sabhRV5xTqyDNPh9uGUUO6A1nzg8cycXAA_F3FnSykoXokmEsFJxljJLDHKXbi41qZRjR2cosQu-3SrnI6E2XRFjqcUShe1O_JE3YVBbklNjiaJ29U2gsuKWKfeHzFjOUupyMI4svm89nW6d3LDihhbkL8m6964JulauTVRkhBVCaiRCWlIzw5ybZtiGMEFSqfpoxoRFXVO-dw-VNLbQaByAU11gwwnHBqLl587GjsIw9BiZttujLCvZDWZEUW2Z6xJmhIkM197b_rqFCyp1hhozwqmxPbW5jfE0IhpXskSXay_5fSSnf0Zx1qgb4axkncFOw5_PW4yvTROqFN9stUihoNxuiJWkZtpWtF2nvu198NgsvsaUmj4aPwatmLGy0LT8LpSnsxdxS78v3jYR_Vh7i1QFsboojw0rGadOoIldaTQryTuHFB6feajGHDXhUl5Xyu-N8XufX_cG1VLRwjGDCVXZhlRMFD0wjd6wDbWXFZ4S5hMnhubY0rAvK3cbMlGQh5b6C1ahtpVOvKZ0dmQ33mm4G4WuOBKlZUITxvfcgR1uNBWZLInB7r1pkKzEGyk6deRNPHVmlUhkJbJGBSjnyPsvFg9LpTBWU-ZEQ0inb7Uf25aCfOPlVmNqpd73RBFBMF1EkziCePL8MvJdOVZVwll6vIaD4AmF2Tw-h_lVDPM3l5dHwZOkPWm-plfzZbyYzOYxrIm6xg28XsxeTRbv4Y_oPRxQmCynh0fBk9n8RfQO1iQhLFvDQeLPg8OLIJhcxtFiZ_jZ_PdoGsMynsSzZTybLuHphwAA4G__2_0MaF34h9JgDOHRw3F7PQzG8OH-sLEf3H9_3LbXSC1mhNrBGAan4eh8GI6G4QjC0TgMx2E42DJ2Vz8T_sVRCQcYhduxvRr516HdKJfYYBvs5f0OuA1zsn3v8PRsdHrm__fP0f8tOfkhJfsMf1zVwcenF3u4uXHcrP7DzbqLm5sd3KzuuPnIria5s3x5tYhmv84by_oQFtHLaBHNp9ES7vh5QB-I7XCe2HU_sTc7ie3rjd69vpzM5nBw9To-gmj-9hCW0aWz_QleLq5ewRr-_C1aRJDAMzi7CIbD4TDwT4r1L-1uBfD19vbr7Zevt1_gXknsGE5OT0Zj-HByBkM4OfsY_BsAAP__VAFopg==


statement error pq: at or near "EOF": syntax error: the ENV flag can only be used with OPT
EXPLAIN (ENV) SELECT * FROM x WHERE b = 3

#
# Multiple Tables.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x, y WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt9u27YXvq6e4sA3dX6wEzn5XQQOCsx11c1b6hS22rUoCoKWjmQuFMmSlGpnGFDsGXK5p8uTDKSUxEEjq8XQXAQ2_X3n73cOORzCW9SGSTGGqUwutaTJ-sVzwA0mq5LxFDVYNBaqGhUEwyFQzuVnojQqqpFQQ6SyRHEqYE0N2DVCihktuYWK8hLHILPM8RJpLDEJFYZ8ZnZNGhRJJCeGXWEHPaUuki1vxc2WFwN49eK9Bze2mbB7bZ_ugq2mwtDEMimI0kxqZrdtRCF1QXkb-1NJObNbIjNiUFcsaQ1AY15yqtsMaaQpkYK3xnFbnEe4pUGSSdcs1N6Q6TLCNCa-H2UhqG56hYKuOKadXFPrIis5J9ZRav4-3jKKHdGaTxyeuZMzgPtkbpG0tNK5qAMhrFCcJcwSg9yFm0lNSuXU0epKPEbfLZWzsaI2WRNjqcUChW0P_IE1YVBbklFjiaJ2_U2kouSWKfdBpixjCXUxGCcWX7eOSjdGrlh-RXPyh2Ttc1c73ShXJipSwnIhNRIhLamYYc5M3WxDmCCJVF0yY8KirijfO4dKGptrNI7Aqc6x1oRTA9Hyc2thR2EYeo5MmulRlhXsClOiqLbMVQlTwkSKG29tf97COZU6RY0p4dTYjtzcxHgZEY1rWaCLtVP83pPbf0ZxVm83wlnBWp0dh_8_bTg-N02oUny7UyKFgnK7JVaSimlb0macuqb33mI9-BoTarpk_JC0ZsbKXNPiu1hezn6JW_p9_naF6NvamaTKidV5cWhYwTh1C5rYtUazlry1SeHhiadqzFATLuVlqfzcGD_32WWnUy0VzZ0ymFClrUXFRN5B0-iBjau9qvCSMJ84MTTDRoZdUbnbkImc3JfUX7AKtS31yu-U1oo8znc73LVClxyJ0nJFV4zvuQNbzGgqUlkQg-1zUzNZgVdStO6RN_HUwUqxkqVI6y1AOUfefbF4WiKFsZoytzSEdPut8m3b2SDfeLlVmFip9z1RRBBMF9EkjiCePD-PfFUOVbniLDncQD94QmE2j09hfhHD_M35-SB4smpO6m_Ti_kyXkxm8xg2RF3iFl4vZq8mi_fwW_Qe-hQmy-nBIHgym7-I3sGGrAhLN9Bf-fPg4CwIJudxtHjU_Wz-azSNYRlP4tkynk2X8PRDAADwp__v_nq0yv1DqTeGcHB_3FwPvTF8uDus8b277x938RqpxZRQ2xtD7zgcnQ7D0TAcQTgah-E4DHs7YHf1M-FfHKVwhFG469tvI_86tFvlAuvtkv16vyXu0tzavjN4fDI6PvG__TX4rymvfkjKPsIfl3Xw8enZHm1unTbLr7RZtWlz-4g2y1ttPsBVJHPIlxeLaPbzvEZWB7CIXkaLaD6NlnCrzz69F7bjeWFX3cLePipsn2_07vX5ZDaH_sXreADR_O0BLKNzh_0fvFxcvILNALbw-y_RIoIVPIOTs2A4HA4DJgTqoX9T9RMtjTkI4Ob6n5vrLzfXX8C_ObZfnWx-asbR_fK3q_rN9XUDuNtBdgxHx0ejMXw4OoEhHJ18DHZgGeMWtYG-1SUeBP8GAAD__2ubjK8=

#
# Same table twice should only show up once.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x one, x two
----
https://cockroachdb.github.io/text/decode.html#eJy0Vs1u27gWXldPceBNnQs7kNO7CBx04brqhe-kTmGrRYuiII6lI5sTimRJSrEzGKAPkeU8XZ9kQMppXExktRg0i8Aiv-_88TuHHA7hHRnLlRzDVGXXRmG2efkCaEvZquIiJwOOrIO6QUXRcAgohLph2pBGQwwtU9oxLVDCBi24DUFOBVbCQY2iojGoovC8TFnHbIbSshvuNmyPYpkSzPJb6qDn6CPZiVbcbHk1gNcvPwTw3jaX7qjt80OwMygtZo4rybThynC3ayNKZUoUbezPFQrudkwVzJKpedYagKF1JdC0GTKEOVNStMZxX5xHuJUlVih_WGSCIdtlhBvKwnlUpUSzPyuSuBKUd3Jto4uiEoI5T2n4x3jLJPVEZz8LeO5XLgAekrlHYuWUd9EEwnipBc-4Y5aED7dQhlXaq6PVlXyMflgqb2OFLtsw69BRSdK1B_6dNWnJOFagdUyj2_wQqayE49r_UDkveIY-BuvFEurWUem9kVu-vsU1-13x9r5rnG61LxPKnPG1VIaYVI7V3HJvpjlsy7hkmdJdMuPSkalRHO1DraxbG7KeINCsqdGEVwMz6qa1sKM4jgNHZfvu0Y6X_JZyptE47qtEOeMyp22wdjxv6Z0qk5OhnAm0riM33zFBRszQRpXkY-0Uf_Dk55_VgjfTjQle8lZnZ_F_z_eckJthqLXYHZRIk0ThdswpVnPjKty3U1f3PlhsGt9QhrZLxt-TNtw6tTZY_hQryDkMcYc_5-9QiOFYO5PUa-bMujy1vOQC_YBmbmPIbpRoPaT49FmgGirIMKHUdaVD39jQ98V1p1OjNK69MrjUlWtExeW6g2YoAPeujqoiSMJ-FsxiQXsZdkXlb0Mu1-yhpOGC1WRcZVZhprRW5HG-n-H-KEwliGmjVrji4sgd2GLGoMxVySy1903D5CXdKtk6R96mUw-r5EpVMm-mAApBovtiCbRMSesMcj80pPLzrQ7HdjBBfvByqylzyhx7osgomi6SSZpAOnlxmYSqnOpqJXh2uoV-9ARhNk_PYX6Vwvzt5eUgerLarzRf06v5Ml1MZvMUtkxf0w7eLGavJ4sP8FvyAfoIk-X0ZBA9mc1fJu9hy1aM51vor8J6dHIRRZPLNFk86n42_38yTWGZTtLZMp1Nl_D0YwQA8Ef47_96WK_DQ6k3hnjwsLy_Hnpj-PhtscH3vn1_OsQbQkc5Q9cbQ-8sHp0P49EwHkE8GsfxOI57B2B_9XMZXhyV9IRRfOg7TKPwOnQ77QPrHZLDeL8nHtL82P5m8OzZ6OxZ2Ptz8G9TXv2SlEOEvy7r6NPTiyPa3HltVv_QZt2mzd0j2qzutfkdrmaFR766WiSz_80bZH0Ci-RVskjm02QJ9_rs44OwPS8Iu-4W9u5RYYd8k_dvLiezOfSv3qQDSObvTmCZXHrsf-DV4uo1bGGyBCVp0PxyN-oiGg6Hw4hLSWYYXlX9zChrTyL4evfX17svX---QHh1bOEj2udK0qeWLXejwtbdfqvgwpGx0HemopPo7wAAAP__t8-BGg==

#
# Set a relevant session variable to a non-default value and ensure it shows up
# in the environment dump.
#

statement ok
SET reorder_joins_limit = 63

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpKOZC4UyZKUamUY0IfIE_ZJBlJO4mKW1WJoLoKIOd_5_c5HDofwBrVhUkxgJtNrLWm6fv4McINpUjGeoQaLxkLdWgXBcAiUc_mJKI2KaiTUEKksUZwKWFMDdo2QYU4rbqGmvMIJyDx3uFQaS0xKhSGfmF2TrRVJJSeG3WAPPKMuk4Z32s1XVyfw8vk7b7z1zYQ96Pt819hqKgxNLZOCKM2kZrbpAgqpS8q70B8rypltiMyJQV2ztDMBjUXFqe5ypJFmRAremcddc_ZgK4Mkl25YqL0j0-eEaUz9PKpSUL2dFQqacMx6sablRV5xTqyDtPhDuFUUO6A1Hzk8dScXAA_F3FnSykoXok2EsFJxljJLDHKXbi41qZRjR2cosQ--2yrnI6E2XRNjqcUShe1O_CtvwqC2JKfGEkXt-ptAZcUtU-4PmbGcpdTlYBxZfN96Or11csOKG1qQvyTr3rs26Ea5NlGREVYIqZEIaUnNDHNu2mEbwgRJpeqjGRMWdU35wT1U0thCo3EATnWBLSccG4iWnzobOwrD0GNkut0eZVnJbjAjimrLXJcwI0xkuPHeDtctXFCpM9SYEU6N7anNbYynEdG4liW6XHvJ7yM5_TOKs1bdCGcl6wx2Fv58vsX42jShSvFmp0UKBeW2IVaSmmlb0e069W3vg8d28TWm1PTR-GvQmhkrC03L70J5OnsRt_T74u0S0Y-1t0hVEKuL8tSwknHqBJrYtUazlrxzSOHp2EM15qgJl_K6Un5vjN_7_Lo3qJaKFo4ZTKjKtqRiouiTNo3echurpcVT-GW8V-U8K8xHTgzNccvEvsTchchEQR666u9YhdpWOvGy0tmU_Xgn424auuJIlJYJTRg_cA12uNFUZLIkBrtXp0WyEm-k6JSS1_HMmVUikZXIWiGgnCPvv1s8LJXCWE2Z0w0hncTVfnI7IvKN91uNqZX60CtFBMFsGU3jCOLps8vId-VUVQln6ekGjoJHFOaL-BwWVzEsXl9engSPku1J-zW7Wqzi5XS-iGFD1DU28Go5fzldvoM_ondwRGG6mh2fBI_mi-fRW9iQhLBsA0eJPw-OL4JgehlHy73h54vfo1kMq3gaz1fxfLaCx-8DAIC__W_3M6B14d9KgwmEJw_H2xtiMIH394et_eD--8OuvUZqMSPUDiYwOAtH58NwNAxHEI4mYTgJw8GOsbv9mfCPjko4wCjcje0FyT8QbaNcYoNdsFf4O-AuzCn3vcOz8ehs7P_3z8n_LTn5ISX7DH9c1cGHxxcHuNk4blb_4Wbdxc1mDzerO25-ZVeT3Fm-uFpG818XrWV9DMvoRbSMFrNoBXf8PKIPxHY4T-y6n9jNXmL7eqO3ry6n8wUcXb2KTyBavDmGVXTpbH-CF8url9DAn79FywgqeArji2A4HA4D_6poAvhye_vl9vOX289wryB2Ak9GE3j_ZAxDeDL-EPwbAAD___XVZM0=

# Make sure it shows up correctly even if it matches the cluster setting.
statement ok
SET CLUSTER SETTING sql.defaults.reorder_joins_limit = 63


query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpKOZC4UyZKUamUY0IfIE_ZJBlJO4mKW1WJoLoKIOd_5_c5HDofwBrVhUkxgJtNrLWm6fv4McINpUjGeoQaLxkLdWgXBcAiUc_mJKI2KaiTUEKksUZwKWFMDdo2QYU4rbqGmvMIJyDx3uFQaS0xKhSGfmF2TrRVJJSeG3WAPPKMuk4Z32s1XVyfw8vk7b7z1zYQ96Pt819hqKgxNLZOCKM2kZrbpAgqpS8q70B8rypltiMyJQV2ztDMBjUXFqe5ypJFmRAremcddc_ZgK4Mkl25YqL0j0-eEaUz9PKpSUL2dFQqacMx6sablRV5xTqyDtPhDuFUUO6A1Hzk8dScXAA_F3FnSykoXok2EsFJxljJLDHKXbi41qZRjR2cosQ--2yrnI6E2XRNjqcUShe1O_CtvwqC2JKfGEkXt-ptAZcUtU-4PmbGcpdTlYBxZfN96Or11csOKG1qQvyTr3rs26Ea5NlGREVYIqZEIaUnNDHNu2mEbwgRJpeqjGRMWdU35wT1U0thCo3EATnWBLSccG4iWnzobOwrD0GNkut0eZVnJbjAjimrLXJcwI0xkuPHeDtctXFCpM9SYEU6N7anNbYynEdG4liW6XHvJ7yM5_TOKs1bdCGcl6wx2Fv58vsX42jShSvFmp0UKBeW2IVaSmmlb0e069W3vg8d28TWm1PTR-GvQmhkrC03L70J5OnsRt_T74u0S0Y-1t0hVEKuL8tSwknHqBJrYtUazlrxzSOHp2EM15qgJl_K6Un5vjN_7_Lo3qJaKFo4ZTKjKtqRiouiTNo3echurpcVT-GW8V-U8K8xHTgzNccvEvsTchchEQR666u9YhdpWOvGy0tmU_Xgn424auuJIlJYJTRg_cA12uNFUZLIkBrtXp0WyEm-k6JSS1_HMmVUikZXIWiGgnCPvv1s8LJXCWE2Z0w0hncTVfnI7IvKN91uNqZX60CtFBMFsGU3jCOLps8vId-VUVQln6ekGjoJHFOaL-BwWVzEsXl9engSPku1J-zW7Wqzi5XS-iGFD1DU28Go5fzldvoM_ondwRGG6mh2fBI_mi-fRW9iQhLBsA0eJPw-OL4JgehlHy73h54vfo1kMq3gaz1fxfLaCx-8DAIC__W_3M6B14d9KgwmEJw_H2xtiMIH394et_eD--8OuvUZqMSPUDiYwOAtH58NwNAxHEI4mYTgJw8GOsbv9mfCPjko4wCjcje0FyT8QbaNcYoNdsFf4O-AuzCn3vcOz8ehs7P_3z8n_LTn5ISX7DH9c1cGHxxcHuNk4blb_4Wbdxc1mDzerO25-ZVeT3Fm-uFpG818XrWV9DMvoRbSMFrNoBXf8PKIPxHY4T-y6n9jNXmL7eqO3ry6n8wUcXb2KTyBavDmGVXTpbH-CF8url9DAn79FywgqeArji2A4HA4D_6poAvhye_vl9vOX289wryB2Ak9GE3j_ZAxDeDL-EPwbAAD___XVZM0=

statement ok
SET enable_zigzag_join = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpaOZC4UyZKUamUY0IfIE_ZJBlJK4mKW1WJoLoKIOd_5_c5HDofwBrVhUkxgJpNrLWmyef4McIvJumQ8RQ0WjYWqsQqC4RAo5_ITURoV1UioIVJZojgVsKEG7AYhxYyW3EJFeYkTkFnmcIk0lpiECkM-MbshrRVJJCeG3WAPPKUuk5p32s1XVyfw8vk7b9z6ZsIe9H2-a2w1FYYmlklBlGZSM1t3AYXUBeVd6I8l5czWRGbEoK5Y0pmAxrzkVHc50khTIgXvzOOuOXuwpUGSSTcs1N6R6XPCNCZ-HmUhqG5nhYKuOaa9WNPwIis5J9ZBGvwh3CqKHdCajxyeupMLgIdi7ixpaaUL0SRCWKE4S5glBrlLN5OalMqxozOU2AffbZXzsaY22RBjqcUChe1O_CtvwqC2JKPGEkXt5ptARcktU-4PmbKMJdTlYBxZfN_6OtZ6uWH5Dc3JX5KJA81rA2-VaxUVKWG5kBqJkJZUzDDnqRm4IUyQRKo-qjFhUVeUH9xFJY3NNRoH4FTn2PDCMYJo-amzuaMwDD1GJu0GKcsKdoMpUVRb5jqFKWEixa33drjhwgWVOkWNKeHU2J7a3NZ4KhGNG1mgy7V3AXwkp4FGcdYoHOGsYJ3BzsKfz1uMr00TqhSvd1qkUFBua2IlqZi2JW1Xqm-DHzw2y68xoaaPyl-DNsxYmWtafBfKU9oLuaXfF2-XiH6svUWqnFidF6eGFYxTJ9LEbjSajeSdQwpPxx6qMUNNuJTXpfKrY_zuZ9e9QbVUNHfMYEKVtiEVE3nfsmr0lm2shhZP4Zfx3mX1rDAfOTE0w5aJfYm5S5GJnDx01d-zCrUt9dpLS2dT9uOdlLtp6JIjUVqu6ZrxA1dhhxtNRSoLYrB7dRokK_BGik4peR3PnFkp1rIUaSMElHPk_feLhyVSGKspc7ohpJO4yk9uR0S-8Y6rMLFSH3qpiCCYLaNpHEE8fXYZ-a6cqnLNWXK6haPgEYX5Ij6HxVUMi9eXlyfBo3V70nzNrhareDmdL2LYEnWNNbxazl9Ol-_gj-gdHFGYrmbHJ8Gj-eJ59Ba2ZE1YuoWjtT8Pji-CYHoZR8u94eeL36NZDKt4Gs9X8Xy2gsfvAwCAv_1v9zOgVe7fS4MJhCcPx-0NMZjA-_vDxn5w__1h114jtZgSagcTGJyFo_NhOBqGIwhHkzCchOFgx9i9AJjwD49SOMAo3I3tBck_Em2tXGKDXbBX-DvgLswp973Ds_HobOz_98_J_y15_UNK9hn-uKqDD48vDnCzdtws_8PNqoub9R5ulnfc_MquIpmzfHG1jOa_LhrL6hiW0YtoGS1m0Qru-HlEH4jtcJ7YVT-x673E9vVGb19dTucLOLp6FZ9AtHhzDKvo0tn-BC-WVy-hhj9_i5YRlPAUxhfBcDgcBv5VUQfw5fb2y-3nL7ef4V5B7ASejCbw_skYhvBk_CH4NwAA__8kXGUv

statement ok
SET optimizer_use_histograms = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpaOZC4UyZKUamUY0IfIE_ZJBlJK4mCWVWBoLoKIOd_5_c5HDofwDrVhUkxgJpNrLWmyefkCcIvJumQ8RQ0WjYWqsQqC4RAo5_ILURoV1UioIVJZojgVsKEG7AYhxYyW3EJFeYkTkFnmcIk0lpiECkO-MLshrRVJJCeG3WAPPKUuk5p32s1XVyfw-uUHb9z6ZsIe9H2-a2w1FYYmlklBlGZSM1t3AYXUBeVd6M8l5czWRGbEoK5Y0pmAxrzkVHc50khTIgXvzOOuOXuwpUGSSTcs1N6R6XPCNCZ-HmUhqG5nhYKuOaa9WNPwIis5J9ZBGvwh3CqKHdCazxyeu5MLgIdi7ixpaaUL0SRCWKE4S5glBrlLN5OalMqxozOU2AffbZXzsaY22RBjqcUChe1O_JE3YVBbklFjiaJ2812gouSWKfeHTFnGEupyMI4svm99HWu93LD8hubkL8nEgea1gbfKtYqKlLBcSI1ESEsqZpjz1AzcECZIIlUf1ZiwqCvKD-6iksbmGo0DcKpzbHjhGEG0_NLZ3FEYhh4jk3aDlGUFu8GUKKotc53ClDCR4tZ7O9xw4YJKnaLGlHBqbE9tbms8lYjGjSzQ5dq7AD6S00CjOGsUjnBWsM5gZ-HP5y3G16YJVYrXOy1SKCi3NbGSVEzbkrYr1bfBDx6b5deYUHOQyo5Qj1EbZqzMNS1ML60eAz2tvZhb2rc-j5G7ZPSj7S1U5cTqvDg1rGCcOqEmdqPRbCTvHFR4OvZQjRlqwqW8LpVfH-P3P7vuDaqlorljBxOqtA2xmMj7Flajt2xjNdR4Dr-M93bWM8N85sTQDFs29iXmLkYmcvLQVX_XKtS21GsvL51N2Y93cu6moUuORGm5pmvGD1yHHW40FaksiMHu9WmQrMAbKTrl5G08c2alWMtSpI0YUM6R998xHpZIYaymzGmHkE7mKj-5HSH5znuuwsRKfei1IoJgtoymcQTx9MVl5Ltyqso1Z8npFo6CJxTmi_gcFlcxLN5eXp4ET9btSfM1u1qs4uV0vohhS9Q11vBmOX89XX6AP6IPcERhupodnwRP5ouX0XvYkjVh6RaO1v48OL4IgullHC33hp8vfo9mMaziaTxfxfPZCp5-DAAA_va_3c-AVrl_Mw0mEJ48HLe3xGACH-8PG_vB_fenXXuN1GJKqB1MYHAWjs6H4WgYjiAcTcJwEoaDHWP3CmDCPz5K4QCjcDe21yT_ULS1cokNdsFe5e-AuzCn3vcOz8ajs7H_3z8n_7fk9Q8p2Wf446oOPj29OMDN2nGz_A83qy5u1nu4Wd5x85FdRTJn-epqGc1_XTSW1TEso1fRMlrMohXc8fOIPhDb4Tyxq35i13uJ7euN3r-5nM4XcHT1Jj6BaPHuGFbRpbP9CV4tr15DDX_-Fi0jKOE5jC-C4XA4DPzLog7g2-3tt9uv326_wr2C2Ak8G03g47MxDOHZ-FPwbwAAAP__285lkQ==

statement ok
SET optimizer_use_multicol_stats = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt9u27YXvq6e4sA3TX6IUzn-YQgc9MJ11c1b6hS22rUoCoKWjmQuFMmSlGplGNCHyBP2SQZSSuIillVgaC6CiDnf-fudjxwO4R1qw6SYwEwm11rSZPPyBeAWk3XJeIoaLBoLVWMVBMMhUM7lF6I0KqqRUEOkskRxKmBDDdgNQooZLbmFivISJyCzzOESaSwxCRWGfGF2Q1orkkhODLvBHnhKXSY177Sbr65O4PXLD9649c2EPej7fNfYaioMTSyTgijNpGa27gIKqQvKu9CfS8qZrYnMiEFdsaQzAY15yanucqSRpkQK3pnHXXP2YEuDJJNuWKi9I9PnhGlM_DzKQlDdzgoFXXNMe7Gm4UVWck6sgzT4Q7hVFDugNZ85PHcnFwAPxdxZ0tJKF6JJhLBCcZYwSwxyl24mNSmVY0dnKLEPvtsq52NNbbIhxlKLBQrbnfh33oRBbUlGjSWK2s0PgYqSW6bcHzJlGUuoy8E4svi-9XWs9XLD8huak78kEwea1wbeKtcqKlLCciE1EiEtqZhhzlMzcEOYIIlUfVRjwqKuKD-4i0oam2s0DsCpzrHhhWME0fJLZ3NHYRh6jEzaDVKWFewGU6Kotsx1ClPCRIpb7-1ww4ULKnWKGlPCqbE9tbmt8VQiGjeyQJdr7wL4SE4DjeKsUTjCWcE6g52F_z9vMb42TahSvN5pkUJBua2JlaRi2pa0Xam-DX7w2Cy_xoSag1R2hPoetWHGylzTwhym1WOk57VXc0ttD_pRsruE9OPtLVblxOq8ODWsYJw6sSZ2o9FsJO8cVng69lCNGWrCpbwulV8h4zUgu-4NqqWiuWMIE6q0DbmYyPuWVqO3bGM19HgOv4z39sezw3zmxNAMW0b2JeYuRyZy8tBVf98q1LbUay8xnU3Zj3eS7qahS45Eabmma8YPXIkdbjQVqSyIwe4VapCswBspOiXlbTxzZqVYy1KkjSBQzpH33zMelkhhrKbM6YeQTuoqP7kdMfnBu67CxEp96MUigmC2jKZxBPH0xWXku3KqyjVnyekWjoInFOaL-BwWVzEs3l5engRP1u1J8zW7Wqzi5XS-iGFL1DXW8GY5fz1dfoA_og9wRGG6mh2fBE_mi5fRe9iSNWHpFo7W_jw4vgiC6WUcLfeGny9-j2YxrOJpPF_F89kKnn4MAAD-9r_dz4BWuX83DSYQnjwctzfFYAIf7w8b-8H996dde43UYkqoHUxgcBaOzofhaBiOIBxNwnAShoMdY_cSYMI_QErhAKNwN7bXJf9YtLVyiQ12wV7p74C7MKfg9w7PxqOzsf_fPyf_teT1TynZZ_jzqg4-Pb04wM3acbN8xM2qi5v1Hm6Wd9z8zq4imbN8dbWM5r8uGsvqGJbRq2gZLWbRCu74eUQfiO1wnthVP7HrvcT29Ubv31xO5ws4unoTn0C0eHcMq-jS2f4PXi2vXkMNf_4WLSMo4TmML4LhcDgM_OuiDuDb7e2326_fbr_CvYLYCTwbTeDjszEM4dn4U_BvAAAA___VsWXz

statement ok
RESET reorder_joins_limit

statement ok
RESET enable_zigzag_join

statement ok
RESET optimizer_use_histograms

statement ok
RESET optimizer_use_multicol_stats

#
# Test sequences.
#

statement ok
CREATE SEQUENCE seq

query T
EXPLAIN (OPT, ENV) SELECT * FROM seq
----
https://cockroachdb.github.io/text/decode.html#eJyUVk1v20gMvftXzHF3URdO0jbZFj1kXS0QIHG6iRN0TwQtUTI3o5kxh3I-fv1iRi6SApHV3oSE75FDPj56OjW3JJG9-2jmvrwTj-X6y1-GHqhcdWwrEqMU1Wz7qMlkOjVorb-HIBRQCDCCDwrBojNrjEbXZCqqsbNqtmg7-mh8XSdc6aNCLNFFuGddwy4KSm8h8hONwCtMlTzawbiz68s35uLLvzl4x81O93KfvAxWQRexVPYOgrAX1schoPPSoh1Cbzq0rI_ga4gkWy4HCxBqOosyRCSEFXhnB-v43pxXsF0kqH0aFkkmimMkLFTmeXStQ9nNihyuLFWj2Njrou6sBU2QHr8Pd10sE1DjxprP6S-fjHl-zPdI7NSnFH0hwG2wXLJCJJvKrb1AF5I6BlO51-AvW5U4VqjlGqKiUktOhwv_gc1FEoUao0JAXf8UqO2sckgfvuKaS0w1xCSW3LeRTu9Inrh5wgb-8zy8d33Sh5DahK4CbpwXAucVthw50fTDjsAOSh_GZMZOSbZo9-5h8FEboZgAFqWhXhNJDSD-frCxB7PZLGN8udueoNzyE1UQUJRTl6gCdhU9ZLb973YpqZeKhCqwGHXkbWljsoxAaO1bSrWOij9nSv4Xg-Xe3cByy4PJDmfvTnaY_DYBDME-vmhRIIdWH0E9bFm0w906jW3vM2O_-EIlxjEZ_whac1TfCLa_hMpyziau-Gv5Xgoxj3X0kaEBlaZ9G7lli8mgQddCce3t4JBmb48yVKgmAev9XRfy3sS89_XdaFLxAZukDHah015U7JoxaxPKkbtcvSw-mw9Hr7pcVkXcWIhY006JY4Wlg8iugeeu5hsbSLSTVbaVwaa8jk82nqYhnSUI4le4YrvnDA7QCLrKtxBpeHV6JLf05N2gldws5ymscyvfuao3ArSW7PhtybDSu6iCnHzD-WRx2zy5Fybyk_dtS6V62fcrxU0m86vidFmY6-Kfm2IxL0zoVpbLt5E25uJscXt6flOYA3Nx-q3__PPw8Ojo-HB29OHk_bvj4_cns2NztphfFRfFYmkOzPXy9GppDj5NJsW3r-enZwvz2-XX5RtTLG5_N9fFeTFfmj_M31eXFybS5tNkOp1OJ5E2HbmSpv15TP-Z_B8AAP__k2iORA==

#
# Test views.
#

statement ok
CREATE VIEW v AS SELECT a, b, u, v FROM x, y WHERE b = 3

query T
EXPLAIN (OPT, ENV) SELECT * FROM v
----
https://cockroachdb.github.io/text/decode.html#eJy0Vu1uGjkX_p25iiP-NLyCZAivXkVElV5Kp7vspqSC6ZeqyvLMnAFvjO3anilktVK115Cfe3W5kpU9kJAtw7RaNT8iMOc5n8957G4X3qA2TIoBjGR6rSVNF8-fAa4wTQrGM9Rg0VgoK6sg6HaBci4_E6VRUY2EGiKVJYpTAQtqwC4QMsxpwS2UlBc4AJnnDpdKY4lJqTDkM7MLsrEiqeTEsBtsgGfUZbLmtXbj2VUHXj5_7403vpmwB32f7xpbTYWhqWVSEKWZ1Myu64BC6iXldehPBeXMronMiUFdsrQ2AY3zglNd50gjzYgUvDaPbXP2YAuDJJduWKi9I9PkhGlM_TyKpaB6MysUNOGYNWJNxYu84JxYB6nwh3CzKHZAaz5xeOpOLgAeitla0sJKF6JKhLCl4ixllhjkLt1calIox47aUGIffLdVzkdCbbogxlKLSxS2PvFH3oRBbUlOjSWK2sU3gZYFt0y5DzJjOUupy8E4svi-NXR64-SGzW_onPwmWf3eVUFXyrWJioywuZAaiZCWlMww56YatiFMkFSqJpoxYVGXlB_cQyWNnWs0DsCpnmPFCccGouXn2sb2wjD0GJlutkdZtmQ3mBFFtWWuS5gRJjJceW-H6xYuqNQZaswIp8Y21OY2xtOIaFzIJbpcG8nvIzn9M4qzSt0IZ0tWG-ws_O_5BuNr04Qqxdc7LVIoKLdrYiUpmbYF3axT0_Y-eKwWX2NKTRONH4MWzFg513T5XShPZy_iln5fvF0i-rE2FqnmxOr58sSwJePUCTSxC41mIXntkMKTvodqzFETLuV1ofzeGL_3-XVjUC0VnTtmMKEKW5GKiXmTtGn0lptYFS2ewv_6e1XOs8J84sTQHDdMbErMXYhMzMlDV_0dq1DbQideVmqbsh_vZNxNQxccidIyoQnjB67BGjeaikwuicH61amQbIk3UtRKyet45MwKkchCZJUQUM6RN98tHpZKYaymzOmGkE7iSj-5HRH5xvutxNRKfeiVIoJgNI2GcQTx8Nll5LtyooqEs_RkBcfBEYXxJD6HyVUMk9eXl53gKNmcVN9GV5NZPB2OJzGsiLrGNbyajl8Op-_h1-g9HFMYzkbtTnA0njyP3sGKJIRlKzhO_HnQvgiC4WUcTfeGH09-iUYxzOJhPJ7F49EMnnwIAAB-9__dX4uWc_9Wag0g7Dwcb26I1gA-3B9W9q377x937TVSixmhtjWA1lnYO--GvW7Yg7A3CMNBGLZ2jN3tz4R_dBTCAXrhbmwvSP6BaNfKJdbaBXuF3wJ3YU657x2e9Xtnff_bH51_W3LyQ0r2Gf64qoOPTy4OcHPtuFl8xc2yjpvrPdwsttx8ZFeS3Fm-uJpG458mlWXZhmn0IppGk1E0gy0_j-kDsR3OE7tsJvZ6L7F3630zjt5uw5R-C93edYKjwtUYtGE4g1l06XzQDiQdKDpQwovp1cvHG9T5R9y3P0fTCBJ4Cv2LIIjevbocjidwfPUq7kA0edPeOv1P5au8CLrdbjdgQqDu-kfbcaqlMe0A7m7_urv9cnf7BfyjZv3Vyer_m2V3v_zpZnp3e7sxuFc4O4DTs9PeAD6c9qELp_2PwY5ZzrhFbeDY6gLbwd8BAAD__22Mpj8=

#
# Test tables in user-defined schemas.
#

statement ok
CREATE SCHEMA s;
CREATE TABLE s.t (a int primary key)

query T
EXPLAIN (OPT, ENV) SELECT * FROM s.t;
----
https://cockroachdb.github.io/text/decode.html#eJyUVlFv20YMfq5-xb01GeIgW4chaNAH1_UAb44T2GqxYBgIWqLkW053Fx7lxPn1w51cxB0iq30zDH4feeTHjxqN1BfioJ19ryauuGeHxebTR0VPVKxbbUpiJRREbbuoLBuNFBrjHsEzeWQCDOC8gDdo1QaDkg2pkipsjagtmpbeK1dVEVe4IBAKtAEetWxgHwWFMxD0Mw3AS4yV7Exv3Gx1c6auP92l4D23tnKU-_IwWBhtwEK0s-BZO9ay6wNaxw2aPvRDi0bLDlwFgXiri94CmOrWIPcRMWEJzpreOr425xVsGwgqF4dFnIjCEIlmKtI82sYi72dFFteGykFs6HRRtcaAREiHP4ZbTfMIlPBg1If4z5VSL4_5GomtuJiiKwR0440utEAgE8utHEProzp6U9nX4IetihxrlGIDQVCoISv9hX_DZgOxQIVBwKNsvgvUtEa0jz9cqStdYKwhRLGkvg10ek_yrOtnrOFfp_v3rkv65GOb0Jaga-uYwDqBrQ460nTDDqAtFM4PyUxbId6iObqH3gWpmUIEGOSaOk1ENQC7x97G_nxxcZEwrthvjxfd6GcqwSOLjl2iErQt6SmxHX-3jUkdl8RUgsEgA2-LG5NkBEwb11CsdVD8KVP0v-CN7twNjG50b7JfLn693GPS2xjQe7M7aJEni0Z2IA62mqXF_ToNbe8LY7f4TAWGIRl_C9roIK5mbH4IleScTFzwx_IdCjGNdfCRvgbhujkPutEGo0GDbJjCxpneIV2cv0tQpooYjHP3rU97E9LeV_eDSdl5rKMytPWtdKLSth6yNqYUuc_VyeKD-u3dqy6XVBEeDASsaK_EocLiQdS2hpeuphvriaXldbKV3qa8jo82HqfBrSHw7Na41ubIGeyhYbSlayBQ_-p0SN3Qs7O9VvI5n8Sw1q5da8vOCNAYMsO3JcEKZ4Mw6ugb1kWL26bJHZjId963LRXi-NhXis2yyXI6zqcqH3-cT1NXzsO5qJPsDarZIr9Ui5tcLT7P52fZm8nNYpUvx7NFrgT8Pe3U7XJ2PV7eqT-nd-oE1Xg1Oc1Or7JsPM-ny_9zzhZ_TCe5WuXjfLbKZ5OVevv3P2-vsmz61-18PFuok5vb_ExNF19O1Wo6j7E_qd-XN9cqnMtVNhqNRlmyUMn-CwAA__8kqJTI

#
# Test default_transaction_quality_of_service settings.
#

statement ok
SET default_transaction_quality_of_service=background

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVsFu20gMvfsr5pgAcZFsF4uiRQ7dNocC3bZA0mD3RNASJXEzGk44lJP41I_IF-ZLihm5iAtYVnszDD6S8_j4qOXSXZMmlvDavZPqRgWr7v3fju6pWg3sa1JnlMytx6jFYrl06L3cQVSKqASYQKJB9Bhch8lZR66mBgdvbo1-oNdOmibjKkkGqcKQ4I6tg20UVOIh8YZm4DXmTh78ZNyHy88n7p_3_5XgbW4OdjD3q91gUwwJK2MJEJVF2R6mgEG0R7-4vLjaC78d0LM9gDSQSNdckTt3K6xuWpUh1G-ce677I6VSO3jUqY6UsAYJfrKlHzztwQ6JoJE8N9KSKM0lYaWqjGboA-p2bBRw5amexaZRIs3gPViGjPhDuEIkJ0u33p3nf_ZShINJLjE2AtxHzxUbJPK53UYUhpiFMlkq7IPvUpVzrNCqDpKhUU_Bphv_KVtIpAYNJoOI1v0SqB-8ccw_pOaGK8w9pCybwtsM09skG2432ML_wtMrOBa9j5kmDDVwG0QJghisOXFOMw47AQeoJM7JjIORrtEfXMkoyVqllAEetaVRE1kNoHI3SezZ6elpwUi13aNo3POGaoioxpklqoFDTfcl2-F3h1xUtCalGjwmm3lb3pgiI1DqpKfc66z4S6VshSl6Ho0OPPc8WeyP0z9fbTHlbQoYo3_YoShSQG8PYAJrVhtwu05z2_uccVx8pQrTnIx_BnWcTFrF_rdQRc7Fzw1_r96uEMtYZx8ZWzBt-xeJe_aYvRqsU0qd-Mkhnb54WaBKDSl4kZshlr1JZe-bm9miKhHbrAwOcbBRVBzaOWtTKpHbWqMszt1fL_e6XFFFuvWQsKGtEucay7eRQwvPrJZzG0lt0FWxlUlS9uOzjedp6OAJosoKV-wPXMSJNIqhlh4STa_OiOSeNhImreTr1bscNoRVPqCjEaD35OdvS4FVEpIpcvaNINni1mVyOybyi_dtTZWJHvpgCYvFxb9fPr798Mkdff5ydeIuPl0fu-u3H79eXLqjs-M3i-VyuVyU8LRwT4-PT4_fnh6_uaOzk-PF9wAAAP___sx6QQ==

statement ok
SET default_transaction_quality_of_service=critical

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVsFu20gMvfsr5pgAcZFsF4uiRQ7dNocC3bZA0mD3RNASJXEzGk44lJP41I_IF-ZLihm5iAtYVnsLAr5H6vHxjZdLd02aWMJr906qGxWsuvd_O7qnajWwr0mdUTK3HqsWi-XSofdyB1EpohJgAokG0WNwHSZnHbmaGhy8uTX6gV47aZqMqyQZpApDgju2DrZVUImHxBuagdeYJ3nwk3UfLj-fuH_e_1eKt9wc7CD3q91iUwwJK2MJEJVF2R6mgEG0R7-4vLjaC78d0LM9gDSQSNdckTt3lbJxhf6Nc89dfxAqtYNHnZpHCWuQ4CcH-qHSHuyQCBrJWyMtRGmOhJWqspihD6jbpVHAlad6FptGgzSD92AZMuIP4YqMnCzdenee_7NXIhxMcotxEOA-eq7YIJHP4zaiMMRsk8lWYR98V6rMsUKrOkiGRj0Fmx78J7aQSA0aTAYRrfslUD9445j_kJobrjDPkLJpim4zSm9JNtxusIX_hacPcGx6H7NMGGrgNogSBDFYc-JMMy47AQeoJM7ZjIORrtEfPMgoyVqllAEetaXRE9kNoHI3KezZ6elpwUi1vaJo3POGaoioxlklqoFDTfeF7fB3h9xUtCalGjwmm_m2fDHFRqDUSU951lnzl045CFP0PMYceO55stkfp3--2mLKtylgjP5hR6JIAb09gAmsWW3A7TnNXe8z43j4ShWmORv_DOo4mbSK_W-hip1Lmhv-Xr9dI5a1zn5kbMG07V8k7tljTmqwTil14ieXdPriZYEqNaTgRW6GWO4mlbtvbmabqkRsszM4xMFGU3Fo56JNqVRue422OHd_vdybcsUV6dZDwoa2TpwbLL-MHFp4VrU8tpHUBl2VWJkUZT8-x3jehg6eIKqscMX-wHs4QaMYaukh0fTpjEjuaSNhMkq-Xr3LZUNYyRDqMQjQe_Lzb0uBVRKSKXLOjSA54tZlczsh8ovv25oqEz30cyUsFhf_fvn49sMnd_T5y9WJu_h0feyu3378enHpjs6O3yyWy-VyUcrTwj09Pj49fnt6_OaOzk6OF98DAAD__y3qeWw=

#
# Test recursive table references from foreign keys.
#

statement ok
CREATE TABLE z (
  pk INT PRIMARY KEY,
  ref INT,
  CONSTRAINT fk FOREIGN KEY (ref) REFERENCES y(u),
  FAMILY "primary" (pk, ref)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM z;
----
https://cockroachdb.github.io/text/decode.html#eJy0VkFv2zgTPVe_gvClyYc4kJMPi8BBD66rLrzr2oWtFi2KghhJI5lrimRJSrW92P--IOU0DipZLRbNIYiYeTPzZt4MORyS96gNk2JMpjLdagnp5tVLgjtMk4rxDDWxaCypG6sgGA4JcC6_UqVRgUYKhkplqeIgyAYMsRskGeZQcUtq4BWOicxzh0ulsdSkIAz9yuyGHq1oKjk17IA98AxcJnveaTdbL6_Im1cfvfHRNxP2rO-7U2OrQRhILZOCKs2kZnbfBRRSl8CDdRS3wr9UwJndU5lTg7pmKZIXJNXMshT4PSGPUR8caiwqDrorH42QUSl4Z0IPVWrBVgZpLl3XUHtHps8J05j6xlSlAH1sGgpIOGa9WNMIJK84p9ZBGvw5nC8jM9Z84eSFO2ktEVRWuhBNIpSVirOUWWqQu3RzqWmlnEw6Q4k2-GmpnI8EbLqhxoLFEoXtTvyJN2FQW5qDsVSB3fwQqKy4Zcr9ITOWsxRcDsaJxtetp9JHJwdWHKCgf0nWPYBN0J1yZQKRUVYIqZEKaWnNDHNummYbygRNpeqTGRMWdQ387EAqaWyh0TgAB11gowmnBqrl187CjsIw9BiZHqdIWVayA2ZUgbbMVQkzykSGO-_tPG_hgkqdocaMcjC2h5ubGC8jqnEjS3S59orfR3KL0CjOmjVHOStZZ7Cb8P93R4znpikoxfcnJVIogNs9tZLWTNsKjuPUN72PHpvB15iC6ZPxU9CGGSsLDeVPobyc_Ta38HPxToXo29pLUhXU6qK8NqxkHNympnaj0Wwk72xSeH3roRpz1JRLua2Unxvj5z7f9gbVUkHhlMGEqmwjKiaKvtWm0VseYzWyeEF-u23dcl4V5gunBnI8KrEvMXczMlHQx6r6y1ahtpVO_FrpLEo73q1x1w1dcaRKywQSxs_chx1uNIhMltRg9-g0SFbiQYrOVfIunjqzSiSyElmzCIBz5P13i4elUhirgbm9IaRbcbXv3MkS-cH7rcbUSn3uuSKCYLqKJnFE4snLeeSrcq2qhLP0ekcugmdAZov4jiyWMVm8m8-vgmfJ8aT5mi4X63g1mS1isqNqi3vydjV7M1l9JH9GH8kFkMl6enkVPJstXkUfyI4mlGU7cpH48-DyPggm8zhatYafLf6IpjFZx5N4to5n0zV5_ikghJC__W_3M4C68I-mwZiEV4_HxxtiMCafvh029oNv359P7TWCxYyCHYzJ4CYc3Q3D0TAckXA0DsNxGA5OjN3tz4R_dFTCAUbhaWy_kPxL0e6VS2xwCvYb_gF4CnOb-5vDm9vRza3_3z9X_5Vy8kso-wx_Hevg8_P7M9rcO21W32mz7tLmvkWb1YM2n9jVNHeWr5eraPb7orGsL8kqeh2tosU0WpMHfV7Ao7Adzgu77hf2vlXY5_keHF-1_Y6wxryL8qGFstq2cM63T9lqzNv47i-q87wO3byiD2_nk9mCXCzfxlckWry_JOto7mz_R16vlm_I4T4YDofDwL-QDsG_AQAA__9Zv5Mt

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0VkFv2zgTPVe_gvClyYc4kJMPi8BBD66rLrybOoWtFi2KghhJI5lrimRJSrW82P--IOU0DipZLRbNIYiYeTPzZt4MOR6T96gNk2JK5jLdagnp5tVLgjtMk4rxDDWxaCypW6sgGI8JcC6_UqVRgUYKhkplqeIgyAYMsRskGeZQcUtq4BVOicxzh0ulsdSkIAz9yuyGHqxoKjk1bI8D8AxcJg3vtVus7y_Im1cfvfHBNxP2pO-bY2OrQRhILZOCKs2kZrbpAwqpS-DBOoo74V8q4Mw2VObUoK5ZiuQFSTWzLAV-S8hj1AeHGouKg-7LRyNkVArem9BDlTqwlUGaS9c11N6RGXLCNKa-MVUpQB-ahgISjtkg1rQCySvOqXWQFn8K58vIjDVfOHnhTjpLBJWVLkSbCGWl4ixllhrkLt1calopJ5PeUKILflwq5yMBm26osWCxRGH7E3_iTRjUluZgLFVgNz8EKitumXJ_yIzlLAWXg3Gi8XUbqPTByZ4VeyjoX5L1D2AbdKdcmUBklBVCaqRCWlozw5ybttmGMkFTqYZkxoRFXQM_OZBKGltoNA7AQRfYasKpgWr5tbewkzAMPUamhylSlpVsjxlVoC1zVcKMMpHhzns7zVu4oFJnqDGjHIwd4OYmxsuIatzIEl2ug-L3kdwiNIqzds1RzkrWG-wq_P_NAeO5aQpK8eaoRAoFcNtQK2nNtK3gME5D0_vosR18jSmYIRk_BW2YsbLQUP4UysvZb3MLPxfvWIi-rYMkVUGtLspLw0rGwW1qajcazUby3iaFl9ceqjFHTbmU20r5uTF-7vPtYFAtFRROGUyoyraiYqIYWm0aveUhViuLF-S3684t51VhvnBqIMeDEocSczcjEwV9rKq_bBVqW-nEr5XeonTj3Rp33dAVR6q0TCBh_MR92ONGg8hkSQ32j06LZCXupehdJe_iuTOrRCIrkbWLADhHPny3eFgqhbEamNsbQroVV_vOHS2RH7zfakyt1KeeKyII5qtoFkcknr28i3xVLlWVcJZe7shZ8AzIYhnfkOV9TJbv7u4ugmfJ4aT9mt8v1_FqtljGZEfVFhvydrV4M1t9JH9GH8kZkNl6fn4RPFssX0UfyI4mlGU7cpb48-D8Nghmd3G06gy_WP4RzWOyjmfxYh0v5mvy_FNACCF_-9_uZwR14R9NoykJLx6PDzfEaEo-fTts7Uffvj8f22sEixkFO5qS0VU4uRmHk3E4IeFkGobTMBwdGbvbnwn_6KiEA0zC49h-IfmXom2US2x0DPYb_gF4DHOb-5vDq-vJ1bX_3z8X_5Vy8kso-wx_Hevg8_PbE9psnDar77RZ92mz6dBm9aDNJ3Y1zZ3l6_tVtPh92VrW52QVvY5W0XIercmDPs_gUdgO54VdDwu76RT2ab57x1dtvyOsMe-jvO-grLYdnPPtU7Ya8y6-zVl1mte-n1f04e3dbLEkZ_dv4wsSLd-fk3V052z_R16v7t-Q5jYYj8fjwL-QmuDfAAAA__9ZrpMr

query T
EXPLAIN (OPT, ENV) SELECT * FROM x;
----
https://cockroachdb.github.io/text/decode.html#eJy0VkFv2zgTPVe_gvClyYc4kJMPi8BBD66rLrzr2oWtFi2KghhJI5lrimRJSrW92P--IOU0DipZLRbNIYiYeTPzZt4MORyS96gNk2JMpjLdagnp5tVLgjtMk4rxDDWxaCypG6sgGA4JcC6_UqVRgUYKhkplqeIgyAYMsRskGeZQcUtq4BWOicxzh0ulsdSkIAz9yuyGHq1oKjk17IA98AxcJnveaTdbL6_Im1cfvfHRNxP2rO-7U2OrQRhILZOCKs2kZnbfBRRSl8CDdRS3wr9UwJndU5lTg7pmKZIXJNXMshT4PSGPUR8caiwqDrorH42QUSl4Z0IPVWrBVgZpLl3XUHtHps8J05j6xlSlAH1sGgpIOGa9WNMIJK84p9ZBGvw5nC8jM9Z84eSFO2ktEVRWuhBNIpSVirOUWWqQu3RzqWmlnEw6Q4k2-GmpnI8EbLqhxoLFEoXtTvyJN2FQW5qDsVSB3fwQqKy4Zcr9ITOWsxRcDsaJxtetp9JHJwdWHKCgf0nWPYBN0J1yZQKRUVYIqZEKaWnNDHNummYbygRNpeqTGRMWdQ387EAqaWyh0TgAB11gowmnBqrl187CjsIw9BiZHqdIWVayA2ZUgbbMVQkzykSGO-_tPG_hgkqdocaMcjC2h5ubGC8jqnEjS3S59orfR3KL0CjOmjVHOStZZ7Cb8P93R4znpikoxfcnJVIogNs9tZLWTNsKjuPUN72PHpvB15iC6ZPxU9CGGSsLDeVPobyc_Ta38HPxToXo29pLUhXU6qK8NqxkHNympnaj0Wwk72xSeH3roRpz1JRLua2Unxvj5z7f9gbVUkHhlMGEqmwjKiaKvtWm0VseYzWyeEF-u23dcl4V5gunBnI8KrEvMXczMlHQx6r6y1ahtpVO_FrpLEo73q1x1w1dcaRKywQSxs_chx1uNIhMltRg9-g0SFbiQYrOVfIunjqzSiSyElmzCIBz5P13i4elUhirgbm9IaRbcbXv3MkS-cH7rcbUSn3uuSKCYLqKJnFE4snLeeSrcq2qhLP0ekcugmdAZov4jiyWMVm8m8-vgmfJ8aT5mi4X63g1mS1isqNqi3vydjV7M1l9JH9GH8kFkMl6enkVPJstXkUfyI4mlGU7cpH48-DyPggm8zhatYafLf6IpjFZx5N4to5n0zV5_ikghJC__W_3M4C68I-mwZiEV4_HxxtiMCafvh029oNv359P7TWCxYyCHYzJ4CYc3Q3D0TAckXA0DsNxGA5OjN3tz4R_dFTCAUbhaWy_kPxL0e6VS2xwCvYb_gF4CnOb-5vDm9vRza3_3z9X_5Vy8kso-wx_Hevg8_P7M9rcO21W32mz7tLmvkWb1YM2n9jVNHeWr5eraPb7orGsL8kqeh2tosU0WpMHfV7Ao7Adzgu77hf2vlXY5_keHF-1_Y6wxryL8qGFstq2cM63T9lqzNv47i-q87wO3byiD2_nk9mCXCzfxlckWry_JOto7mz_R16vlm_I7j4YDofDwL-QdsG_AQAA__9ZnZMp

# A foreign key cycle shouldn't cause infinite recursion.
statement ok
ALTER TABLE y ADD CONSTRAINT fk FOREIGN KEY (v) REFERENCES z (pk);

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zgTva6egvBNnQ9xICcfFoGDXriuuvBuahe2WrQoCmIsjWSuKZIlKdXyYt99QcppHFSyWiyaiyBi5szvmUOORuQ9asOkmJCZTHZaQrJ99ZLgHpNNyXiKmlg0llSNVRCMRgQ4l1-p0qhAIwVDpbJUcRBkC4bYLZIUMyi5JRXwEidEZpnDJdJYahIQhn5ldkuPVjSRnBp2wB54Ci6TmnfazdfLS_Lm1UdvfPTNhD3r-_bU2GoQBhLLpKBKM6mZrbuAQuoCeLCO4lb4lxI4szWVGTWoK5YgeUESzSxLgN8R8hj1waHGvOSgu_LRCCmVgncm9NClFmxpkGbSTQ21d2T6nDCNiR9MWQjQx6GhgA3HtBdrGoJkJefUOkiDP4fzbWTGmi-cvHAnrS2C0koXokmEskJxljBLDXKXbiY1LZWjSWco0QY_bZXzsQGbbKmxYLFAYbsTf-JNGNSWZmAsVWC3PwQqSm6Zcn_IlGUsAZeDcaTxfevp9NHJgeUHyOlfknUvYBN0r1ybQKSU5UJqpEJaWjHDnJtm2IYyQROp-mjGhEVdAT-7kEoam2s0DsBB59hwwrGBavm1s7HjMAw9RibHLVKWFeyAKVWgLXNdwpQykeLeeztft3BBpU5RY0o5GNtTm9sYTyOqcSsLdLn2kt9HckJoFGeNzFHOCtYZ7Dr8_-0R42vTFJTi9UmLFArgtqZW0oppW8Jxnfq299Fjs_gaEzB9NH4K2jJjZa6h-CmUp7NXcws_F--UiH6svUWqnFqdF1eGFYyDU2pqtxrNVvLOIYVXNx6qMUNNuZS7Uvm9MX7vs11vUC0V5I4ZTKjSNqRiIu-TNo3e8hirocUL8ttNq8p5VpgvnBrI8MjEvsTczchETh-76i9bhdqWeuNlpbMp7Xgn424auuRIlZYb2DB-5j7scKNBpLKgBrtXp0GyAg9SdErJu3jmzEqxkaVIGyEAzpH33y0elkhhrAbmdENIJ3GVn9yJiPzg_VZhYqU-91wRQTBbRdM4IvH05X3ku3Klyg1nydWeDINnQOaL-JYsljFZvLu_vwyebY4nzddsuVjHq-l8EZM9VTusydvV_M109ZH8GX0kQyDT9eziMng2X7yKPpA93VCW7slw48-Di7sgmN7H0ao1_HzxRzSLyTqexvN1PJ-tyfNPASGE_O1_u58BVLl_NA0mJLx8PD7eEIMJ-fTtsLEffPv-fGqvESymFOxgQgbX4fh2FI5H4ZiE40kYTsJwcGLsbn8m_KOjFA4wDk9je0HyL0VbK5fY4BTsFf4BeApzyv3N4fXN-PrG_--fy_9a8uaXlOwz_HVVB5-f353h5sFxU-2-I6fGrIuehxZ6qt0DP08Msx15vVxF898XjZHG7IKsotfRKlrMojU5plAPy_MEPrQS-Hxdtaur_K6sqquouqWosqWmmlY0c5ZPKqva6toPoachrbDDUO0eF93F84te9S963d2n6MPb--l8QYbLt_EliRbvL8g6une2_yOvV8s3pL4LRqPRKPAvqzr4NwAA__-e6aLv

# Check that we remove histograms from statistics correctly.

statement ok
CREATE TABLE b (
  b BOOL NOT NULL,
  INDEX (b)
)

statement ok
ALTER TABLE b INJECT STATISTICS '[
      {
          "avg_size": 1,
          "columns": [
              "b"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 2,
          "histo_buckets": [
              {
                  "distinct_range": 0,
                  "num_eq": 1000,
                  "num_range": 0,
                  "upper_bound": "false"
              },
              {
                  "distinct_range": 0,
                  "num_eq": 100,
                  "num_range": 0,
                  "upper_bound": "true"
              }
          ],
          "histo_col_type": "BOOL",
          "histo_version": 2,
          "name": "__auto__",
          "null_count": 0,
          "row_count": 1100
      },
      {
          "avg_size": 0,
          "columns": [
              "rowid"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 0,
          "histo_col_type": "",
          "name": "__auto__",
          "null_count": 0,
          "row_count": 0
      }
]'

query T
EXPLAIN (OPT, ENV) SELECT * FROM b
----
https://cockroachdb.github.io/text/decode.html#eJy8VlFv2zYQfq5-BeGXpkMcOE63pQ764Doq4M21C1stWhTFgZJO8i0UyZCUE2fYfx9IOY0LWFb7sOUhSMj77k7ffXfHfp99RGNJyRGbqOzGKJ6tr98wvMcsrUnkaJhD69imsYqifp9xIdQdaIOaGwRuQWkHWnDJ1twyt0aWY8Fr4diGixpHTBWFx2XKOrAZlxbuyK1hZwWZEmDpATvgOfeZbEWr3XS1OGXvrj8H451vku6o78t9Y2e4tDxzpCRoQ8qQ27YBpTIVF9EqTg7Cb2suyG1BFWDRbChD9pplhhxlXFwx9hT10aHBshbctOVjkOegpGhN6JGlA9jaIhTKVw1NcGS7nJDBLBSmriQ3u6Kh5KnAvBNrG4EUtRDgPKTBH8MFGsk6eyvYa39ykCJeO-VDNIkAVVpQRg4sCp9uoQzU2sukNZQ8BN-nyvtIucvWYB13WKF07Yl_501aNA4Kbh1o7tY_BKpq4Uj7P1ROBWXc52C9aAJvHUzvnDxQ-cBL-EtRewM2Qe-1p4nLHKiUyiBI5WBDlrybptgWSEKmdJfMSDo0Gy6ONqRW1pUGrQcIbkpsNOHVAEbdtRJ7PhgMAkZluy7Sjip6wBw0N448S5gDyRzvg7fj3y19UGVyNJiD4NZ1fJvvmCAjMLhWFfpcO8UfIvlBaLWgZsyBoIpagw0HLy93mPBtBrjWYrtHkUbJhduCU7Ah42q-a6eu7n3y2DS-wYzbLhl_D1qTdao0vPopVJBzmOaO_1y8fSGGsnZ-pC7BmbI6s1SR4H5Sg1sbtGslWos0OLsIUIMFGhBK3dQ69I0NfV_cdAY1SvPSK4Okrl0jKpJl12gzGCx3sRpZvGa_XRycckEV9laA5QXulNiVmN-MJEt4YjUsW43G1SYNY6WVlMN4P8Z9NUwtELRRKU9JHNmHLW4Ml7mqwGJ76zRIqvBBydZR8iGZeLNapqqWeTMIuBAoundLgGVKWmc4-bkhlR9xm1C5vSHyg_ttg5lT5thzRUbRZBmPk5gl4zezOLByputUUHaWspPoWcreLBYzNl8kbP5hNjuNnhl1RzmbzpPLcPpxupp65KMFu47fjj_MElZLuq3DQKL85MVp9GyymK-S5Xg6T1gK-ga37P1y-m68_Mz-jD-zk8bveDXxttP5dfyJpZAC5ffsJA3n0YurKBrPknh5MNvp_I94krBVMk6mq2Q6WbHnXyLGGPs7_PY_Pb4pwxurN2Lnp0_Hu4XSG7Ev3w7DRdr79v_XfXuD3GEO3PVGrDccDIf982F_MGTnl6OLl6Phq7Nff3_56mLY28P4NwPJ8FSppccN9y7DEAuvS7fVPrvePlTyKpwB-GcFwHd3fgY_uhzsXfhN8Hh-fj4YhJt_To8wMvgRRkKZ_kNWBv8fKztKoq_Pr6Io_vR-Np7O2cnifXLK4vnHF2wVz7ygfmFvl4t3LL2K-v1-PwpLPI3-DQAA__-jCDLD
