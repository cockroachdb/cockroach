# LogicTest: local !metamorphic-batch-sizes
# We must turn off metamorphic variables because some are included in
# EXPLAIN (OPT, ENV) output.

statement ok
CREATE TABLE x (
  a INT PRIMARY KEY,
  b INT,
  INDEX (b),
  FAMILY "primary" (a, b)
)

statement ok
ALTER TABLE x INJECT STATISTICS '[
  {
    "columns": ["a"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 100,
    "histo_col_type": ""
  },
  {
    "columns": ["b"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 123123,
    "histo_col_type": ""
  }
]'

statement ok
CREATE TABLE y (
  u INT PRIMARY KEY,
  v INT REFERENCES x,
  INDEX (v),
  FAMILY "primary" (u, v)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM x WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VuFu2zYQ_l09xcF_mg52I8f7ETgoMNfVMG-uU9hq1yAICEo6yVwokiEpx8kwoA-RJ8yTDKSUxB0iq8XQ_Agi5r67491333EwgE-oDZNiDFOZXmpJ0_W7t4BbTJOK8Qw1WDQWNrVVEAwGQDmX10RpVFQjoYZIZYniVMCaGrBrhAxzWnELG8orHIPMc4dLpbHEpFQYcs3smjRWJJWcGHaLHfCMukxueKvdbHXah_fvzrxx45sJu9f38a6x1VQYmlomBVGaSc3sTRtQSF1S3oa-qihn9obInBjUG5a2JqCxqDjVbY400oxIwVvzeCjOM9jKIMmlaxZq78h0OWEaU9-PqhRUN71CQROOWSfW1LzIK86JdZAavw-3imIHtOaKwxt3cgLwdJkHS1pZ6ULUiRBWKs5SZolB7tLNpSaVcuxoDSWeg--WyvlIqE3XxFhqsURh2xP_ypswqC3JqbFEUbv-JlBZccuU-0NmLGcpdTkYRxZft45KN05uWXFLC_KXZF1zh1vl6kRFRlghpEYipCUbZpjzU3fbECZIKlUXz5iwqDeU7x1EJY0tNBoH4FQXWJPC0YFoed1a2WEYhh4j02Z8lGUlu8WMKKotc2XCjDCR4dZ7219t4YJKnaHGjHBqbMfd3Mh4HhGNa1miy7WT_T6SE0CjOKvljXBWstZgR-HPxw3G3003c6oxpaaLdV-D1sxYWWhafhfKs89rrqXfF2-XNr4J2KUoqiBWF-Vrw0rGqdNTYtcazVry1pKGr0ceqjFHTbiUl5XyNDd-TPPLzqBaKlq4PjKhKltTgImiA6bRGzah9vbQN9BccWJojg1purJyy4uJgjyV1O9DhdpWOvES0FqR5_FOcl0rdMWRKC0TmjC-Z2W1uNFUZLIkBttZXiNZibdStE79x3jqzCqRyEpk9cxSzpF37wEPS6UwVlPmRlxIp0Yb37adef_GXbTB1Erd8aIIpstoEkcQT97OI1BVwln6egsHwQsKs0V8DIvTGBYf5_N-8CJpTuqv6eliFS8ns0UMW6Iu8QY-LGfvJ8sz-CM6gwMKk9X0VT94MVu8iz7DliSEZVs4SPx58OokCCbzOFr-N_Js8Xs0jWEVT-LZKp5NV_DyPAAA-Nv_dj89uin8c6Y3hrD_dNxoeG8M54-HtX3v8fti114jtZgRantj6B2Fw-NBOByEQwiH4zAch2Fvx9gtaCb8u6ASDjAMd2N7EfJvOHujXGK9XbDX4AfgLsxp66PDo9HwaOT_90___145-SFX9hn-uFsHFy9PgiD6_GE-mS3g4PRD3Ido8ekVrKK5I8VP8Ovy9D1s4c_fomUECbyB0UkwGAwGgd-D218amgVwf3d3f_fl_u4LPA6UHcPh0eFwDOeHIxjA4egi-DcAAP__yxUDBA==


statement error pq: at or near "EOF": syntax error: the ENV flag can only be used with OPT
EXPLAIN (ENV) SELECT * FROM x WHERE b = 3

#
# Multiple Tables.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x, y WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3dQa7kZNdBA4KzHXVzVvqFLbatSgKgpKOZC4UyZKUa2cYUOwZcrmny5MMpJTEWSOrxdBcBDb9fef3O4ccDuENasOkGMNUphda0nT1_BngBtOkYjxDDRaNhXWNCoLhECjn8hNRGhXVSKghUlmiOBWwogbsCiHDnFbcwpryCscg89zxUmksMSkVhnxidkUaFEklJ4ZdYgc9oy6SLW_FzZbnA3j5_J0HN7aZsHttn-yCrabC0NQyKYjSTGpmt21EIXVJeRv7Y0U5s1sic2JQr1naGoDGouJUtxnSSDMiBW-N46Y4D3ArgySXrlmovSHTZYRpTH0_qlJQ3fQKBU04Zp1cU-sirzgn1lFq_j7eMood0ZqPHJ66k1OAu2RukLSy0rmoAyGsVJylzBKD3IWbS00q5dTR6ko8RN8tlbORUJuuiLHUYonCtgd-z5owqC3JqbFEUbv6KlJZccuU-yAzlrOUuhiME4uvW0elGyOXrLikBflDsq65w41ydaIiI6wQUiMR0pI1M8zZqbttCBMklapLZ0xY1GvK9w6iksYWGo0jcKoLrEXh5EC0_NRa2VEYhp4j02Z8lGUlu8SMKKotc2XCjDCR4cZb219t4ZxKnaHGjHBqbEdubmS8jojGlSzRxdqpfu_JLUCjOKvXG-GsZK3OjsIfTxqOz003c6oxpaZLdfdJK2asLDQtv4nl1ed3rqXf5m9XNr4J2LVRVEGsLsonhpWMU7dPiV1pNCvJW0saPjn2VI05asKlvKiUl7nxY5pfdDrVUtHC9ZEJVdlaAkwUHTSNHti42ttD30DzkRNDc2xE0xWVu7yYKMhdSf19qFDbSid-BbRW5GG-W7muFbriSJSWCU0Y33NltZjRVGSyJAbbVV4zWYmXUrRO_et46mCVSGQlsnpmKefIu-8BT0ulMFZT5kZcSLeN1r5tO_P-lXfRGlMrdceLIpguokkcQTx5dhaBqhLO0icb6AePKMzm8QnMz2OYvz47GwSPkuak_jY9ny_jxWQ2j2FD1AVu4dVi9nKyeAe_Re-gT2GynB4Mgkez-fPoLWxIQli2gX7iz4OD0yCYnMXR4r-eZ_Nfo2kMy3gSz5bxbLqEx-8DAIA__X_316Prwj9nemMIB3fHzQ7vjeH97WGN791-_7CL10gtZoTa3hh6R-HoZBiOhuEIwtE4DMdh2NsBuwuaCf8uqIQjjMJd334J-Tec3SoXWG-X7HfwDXGX5nbrrcGj49HRsf_tr8H_TTn5Lin7CL9f1sGHx6cPK3LrFFl9och1myK3DyiyulHkPdya5A754nwRzX6e18j1ASyiF9Eimk-j5a00-_ROzo7n5bzeK-ftg3L2WUZvX51NZnPon7-KBxDN3xzAMjpz2B_gxeL8JWwGsIXff4kWESTwFI5Pg-FwOAyYEKiH_r3TT7U05iCA66t_rq8-X199Bv8c2H5xsvmpmT_3y9-u1tdXVw3gduHYMRweHY7G8P7wGIZwePwh2IHljFvUBvpWV3gQ_BsAAP__UYBmPw==

#
# Same table twice should only show up once.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x one, x two
----
https://cockroachdb.github.io/text/decode.html#eJy0Vl-P0zgQfyafYtQXuqcWpcs9rLrioZSe1LvSRW1AIIQsJ5mkvnVsM3a63T2dxIfYx_t0fJKTnQDlRBrQiX1YNfb85u9vZjwewyskK7Sawlxn16R5tnv2FPCAWVoLmSOBQ-tg30hF0XgMXEp9wwyh4YSMW6aNY0ZyBTtuwe0Qcix4LR3suaxxCrooPC7T1jGbcWXZjXA71kqxTEtmxR32wHPuPbmVnXLL7dUInj97E4Rb3UK5k7ovjoUdcWV55oRWzJDQJNxtF1BpqrjsQr-vuRTulumCWaS9yDodICxryalLESHPmVay049PyfkGtrbICu2LhRQU2T4lgjAL9agrxamtFSqeSsx7sbbhRVFLyZyHNPhTuO0i8UBn30t44k8uAb4E80mS1057E40jTFRGikw4ZlF6dwtNrDaeHZ2m1Lfgx6nyOlLush2zjjusULlux7_SpiySYwW3jhnudt8FqmrphPE_dC4KkXHvg_VkCXnryXSr5E6Ud7xkf2rR13d4MD5PXOVMlEoTMqUd2wsrvJ6m2pYJxTJt-ngmlEPac3myEY22riS0HiA5ldiQwtOBkb7pzOwkjuOA0VnbPsaJStxhzgwnJ3yaMGdC5XgI2k5nW3mjmnIkzJnk1vXE5lsm8IgR7nSF3tde9gdLfgBaI0Uz3pgUleg0dh7_etFiQmzU9ilhxm0f674G7YR1uiRe_RAqsC_MXMd_zN4xbUIRsG-imJI5KqtHVlRCcj9PmdsR2p2WnSmNHz0OUMICiUmtr2sTaG5DmxbXvUZJG176OgplatdQQKiyB0YYBFtTJ2sYCmjfS2Z5gS1p-rzyy0uokn1JadiHBsnVlIYR0JmRb-P9yPWloFoiM6RTngp5YmV1qCGucl0xi90sb5CiwjutOrv-ZTL3YrVKda3ypme5lCj790CAZVpZR1z4FlfaT6N9KNtRv3_nLtpj5jT1vCii-WYxSxaQzJ6uFmDqVIrs0QGG0QMOy3VyAeurBNYvV6tR9CBtT5qv-dV6m2xmy3UCB2au8RZebJbPZ5s38MfiDQw5zLbzs1H0YLl-tngNB5YykR9gmIbz6OwyimarZLH5r-Xl-vfFPIFtMkuW22Q538LDtxEAwF_hv_8b8H0ZnjODKcSjL8ftDB9M4e3nw0Z-8Pn73bE8IXeYM-4GUxicx5OLcTwZxxOIJ9M4nsbx4EjYL2ihwrugVh4wiY9thyEU3nDu1njHBsfgMIM_AY9hfrZ-Vnj-eHL-ONz9Pfq_Iac_JeTg4c-LOnr38DKKFq9frGbLNQyvXiQjWKxfncF2sfKk-AV-21w9hwPMtqAVjppf7kZfRuPxeBwJpZDG4S0wzEhbexbBx_t_Pt5_-Hj_AcKqPMBbbp9ohe86rtyNDlf37VUhpEOyMHRU41n0bwAAAP__VCIbeA==

#
# Set a relevant session variable to a non-default value and ensure it shows up
# in the environment dump.
#

statement ok
SET reorder_joins_limit = 63

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VmFv2zYT_lz9ioO_NHkRt3L8Yggc9IPrqps31y5stWtRFAQlnWQuFMmSlGpnGNAfkV_YXzKQchJns6wWQ_MhiJh77o53zz3Hfh_eojZMihFMZHqlJU3XL54DbjBNKsYz1GDRWKgbqyDo94FyLj8TpVFRjYQaIpUlilMBa2rArhEyzGnFLdSUVzgCmecOl0pjiUmpMOQzs2uysyKp5MSwa-yAZ9RlsuWtdtPV4gxevXjvjXe-mbBHfV_sG1tNhaGpZVIQpZnUzG7bgELqkvI29KeKcma3RObEoK5Z2pqAxqLiVLc50kgzIgVvzeO2OAewlUGSS9cs1N6R6XLCNKa-H1UpqN71CgVNOGadWNPwIq84J9ZBGvwx3CqKHdCaTxyeuZNLgPvL3FrSykoXokmEsFJxljJLDHKXbi41qZRjR2socQi-XyrnI6E2XRNjqcUShW1P_IE3YVBbklNjiaJ2_U2gsuKWKfeHzFjOUupyMI4svm4dld45uWbFNS3IH5J1zR1ulKsTFRlhhZAaiZCW1Mww56fptiFMkFSqLp4xYVHXlB8dRCWNLTQaB-BUF9iQwtGBaPm5tbKDMAw9Rqa78VGWlewaM6KotsyVCTPCRIYb7-14tYULKnWGGjPCqbEdd3Mj43lENK5liS7XTvb7SE4AjeKskTfCWclag52H_7_YYfzd9G5ONabUdLHuIWjNjJWFpuV3oTz7vOZa-n3x9mnjm4BdiqIKYnVRPjGsZJw6PSV2rdGsJW8tafhk6KEac9SES3lVKU9z48c0v-oMqqWihesjE6qyDQWYKLqUSKO33MVqmvgMfhoeFCXfQ_OJE0Nz3PGmKzG3v5goyH1V_UpUqG2lE68CrUU5jHeq67qhK45EaZnQhPEjW6vFjaYikyUx2E70BslKvJaidfDfxBNnVolEViJrxpZyjrx7FXhYKoWxmjI35UI6Qap95_ZG_hvXUY2plbrjURFMltE4jiAeP59FoKqEs_TJBk6CRxSm8_gC5osY5m9ms7PgUbI7ab4mi_kqXo6n8xg2RF3hFl4vp6_Gy_fwW_QeTiiMV5PTs-DRdP4iegcbkhCWbeAk8efB6WUQjGdxtPxn5On812gSwyoex9NVPJ2s4PGHAADgT__b_fRoXfgXTW8E4dn98U7GeyP4cHfY2Pfuvj_u22ukFjNCbW8EvfNwcNEPB_1wAOFgFIajMOztGbsdzYR_GlTCAQbhfmyvQ_4ZZ7fKJdbbB3sZvgXuw5y83jk8Hw7Oh_5_f5391ysnP-TKPsMfd-vg4-PLw4zcOkZW_2Jk3cbI7QFGVreMfGBXk9xZvlwso-nP88ayPoVl9DJaRvNJtLqj5gm9p7PDeTrXR-m8PUhnf8vo3evZeDqHk8Xr-Ayi-dtTWEUzZ_s_eLlcvIIt_P5LtIyggmcwvAz6_X4_8At_G8DXm5uvN1--3nyBO7mwI3g6GMGHp0Pow9Phx-DvAAAA__-kuj5d

# Make sure it shows up correctly even if it matches the cluster setting.
statement ok
SET CLUSTER SETTING sql.defaults.reorder_joins_limit = 63


query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VmFv2zYT_lz9ioO_NHkRt3L8Yggc9IPrqps31y5stWtRFAQlnWQuFMmSlGpnGNAfkV_YXzKQchJns6wWQ_MhiJh77o53zz3Hfh_eojZMihFMZHqlJU3XL54DbjBNKsYz1GDRWKgbqyDo94FyLj8TpVFRjYQaIpUlilMBa2rArhEyzGnFLdSUVzgCmecOl0pjiUmpMOQzs2uysyKp5MSwa-yAZ9RlsuWtdtPV4gxevXjvjXe-mbBHfV_sG1tNhaGpZVIQpZnUzG7bgELqkvI29KeKcma3RObEoK5Z2pqAxqLiVLc50kgzIgVvzeO2OAewlUGSS9cs1N6R6XLCNKa-H1UpqN71CgVNOGadWNPwIq84J9ZBGvwx3CqKHdCaTxyeuZNLgPvL3FrSykoXokmEsFJxljJLDHKXbi41qZRjR2socQi-XyrnI6E2XRNjqcUShW1P_IE3YVBbklNjiaJ2_U2gsuKWKfeHzFjOUupyMI4svm4dld45uWbFNS3IH5J1zR1ulKsTFRlhhZAaiZCW1Mww56fptiFMkFSqLp4xYVHXlB8dRCWNLTQaB-BUF9iQwtGBaPm5tbKDMAw9Rqa78VGWlewaM6KotsyVCTPCRIYb7-14tYULKnWGGjPCqbEdd3Mj43lENK5liS7XTvb7SE4AjeKskTfCWclag52H_7_YYfzd9G5ONabUdLHuIWjNjJWFpuV3oTz7vOZa-n3x9mnjm4BdiqIKYnVRPjGsZJw6PSV2rdGsJW8tafhk6KEac9SES3lVKU9z48c0v-oMqqWihesjE6qyDQWYKLqUSKO33MVqmvgMfhoeFCXfQ_OJE0Nz3PGmKzG3v5goyH1V_UpUqG2lE68CrUU5jHeq67qhK45EaZnQhPEjW6vFjaYikyUx2E70BslKvJaidfDfxBNnVolEViJrxpZyjrx7FXhYKoWxmjI35UI6Qap95_ZG_hvXUY2plbrjURFMltE4jiAeP59FoKqEs_TJBk6CRxSm8_gC5osY5m9ms7PgUbI7ab4mi_kqXo6n8xg2RF3hFl4vp6_Gy_fwW_QeTiiMV5PTs-DRdP4iegcbkhCWbeAk8efB6WUQjGdxtPxn5On812gSwyoex9NVPJ2s4PGHAADgT__b_fRoXfgXTW8E4dn98U7GeyP4cHfY2Pfuvj_u22ukFjNCbW8EvfNwcNEPB_1wAOFgFIajMOztGbsdzYR_GlTCAQbhfmyvQ_4ZZ7fKJdbbB3sZvgXuw5y83jk8Hw7Oh_5_f5391ysnP-TKPsMfd-vg4-PLw4zcOkZW_2Jk3cbI7QFGVreMfGBXk9xZvlwso-nP88ayPoVl9DJaRvNJtLqj5gm9p7PDeTrXR-m8PUhnf8vo3evZeDqHk8Xr-Ayi-dtTWEUzZ_s_eLlcvIIt_P5LtIyggmcwvAz6_X4_8At_G8DXm5uvN1--3nyBO7mwI3g6GMGHp0Pow9Phx-DvAAAA__-kuj5d

statement ok
SET enable_zigzag_join = true

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VmFv2zYT_lz9ioO_NHkRt3L8Yggc9IPrqpu31ClstWtRFAQlnWQuFMmSlGpnGNAfkV_YXzKQUhJns6wWQ_MhiJjnuTvePXfH4RDeojZMignMZHqlJU3XL54DbjBNKsYz1GDRWKgbVBAMh0A5l5-J0qioRkINkcoSxamANTVg1wgZ5rTiFmrKK5yAzHPHS6WxxKRUGPKZ2TVpUSSVnBh2jT30jLpItrwTN19dnsCrF-89uLXNhD1o-2wXbDUVhqaWSUGUZlIzu-0iCqlLyrvYnyrKmd0SmRODumZpZwAai4pT3WVII82IFLwzjtvk7OFWBkkuXbFQe0OmzwjTmPp6VKWguq0VCppwzHq5ptFFXnFOrKM0_EO8VRQ7ojWfODxzJ-cA95e5RdLKSueiCYSwUnGWMksMchduLjWplFNHpyuxj76bKmcjoTZdE2OpxRKF7Q78gTVhUFuSU2OJonb9TaSy4pYp94fMWM5S6mIwTiw-b30Za61cs-KaFuQPyYRLntibu7Y6uFEuVVRkhBVCaiRCWlIzw5ylpuCGMEFSqfqkxoRFXVN-sBeVNLbQaByBU11gowunCKLl587kjsIw9ByZth2kLCvZNWZEUW2ZyxRmhIkMN97a4YQL51TqDDVmhFNje-7musZLiWhcyxJdrL0N4D25GWgUZ82EI5yVrNPZafj_s5bj76bbVtWYUtMnvIekNTNWFpqW38XyAvRj19Lv87crG18E7BsqqiBWF-UTw0rGqRupxK41mrXknSkNn4w9VWOOmnApryrlhW58p-ZXvU61VLRwdWRCVbaRABNFX2tp9MjWV1PEZ_DTeG9v-RqaT5wYmmOrm77A3ApjoiD3WfVbUaG2lU78IOhMyn6-G7yuGrriSJSWCU0YP7C4OsxoKjJZEoPdQm-YrMRrKTob_008c7BKJLISWdO2lHPk_dvA01IpjNWUuS4X0g2k2ldup-W_cSPVmFqpe94VwWwZTeMI4unziwhUlXCWPtnAUfCIwnwRn8HiMobFm4uLk-BR0p40X7PLxSpeTueLGDZEXeEWXi_nr6bL9_Bb9B6OKExXs-OT4NF88SJ6BxuSEJZt4Cjx58HxeRBML-Jo-U_P88Wv0SyGVTyN56t4PlvB4w8BAMCf_rf7GdC68I-awQTCk_vjdowPJvDh7rDBD-6-P-7iNVKLGaF2MIHBaTg6G4ajYTiCcDQJw0kYDnbAbk0z4V8HlXCEUbjr288h_5KzW-UCG-yS_Ri-Je7S3Hi9M3g6Hp2O_f_-OvmvV05-yJV9hD_u1sHHx-f7Fbl1iqz-pci6S5HbPYqsbhX5AFeT3CFfXi6j-c-LBlkfwzJ6GS2jxSxa3UnziN7L2fG8nOuDct7ulbO_ZfTu9cV0voCjy9fxCUSLt8ewii4c9n_wcnn5Crbw-y_RMoIKnsH4PBgOh8PAL_xtAF9vbr7efPl68wXuxoWdwNPRBD48HcMQno4_Bn8HAAD___Y0PmE=

statement ok
SET optimizer_use_histograms = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VmFv2zYT_lz9ioO_NHkRt3L8Yggc9IPrqpu31ClstWtRFAQlnWQuFMmSlGpnGNAfkV-YXzKQUhJns6wCQ_MhiJjnuTvePXfH4RDeozZMignMZHqlJU3Xr14CbjBNKsYz1GDRWKgbVBAMh0A5l1-J0qioRkINkcoSxamANTVg1wgZ5rTiFmrKK5yAzHPHS6WxxKRUGPKV2TVpUSSVnBh2jT30jLpItrwTN19dnsCbVx89uLXNhD1o-2wXbDUVhqaWSUGUZlIzu-0iCqlLyrvYXyrKmd0SmRODumZpZwAai4pT3WVII82IFLwzjrvk7OFWBkkuXbFQe0OmzwjTmPp6VKWguq0VCppwzHq5ptFFXnFOrKM0_EO8VRQ7ojVfOLxwJ-cAD5e5Q9LKSueiCYSwUnGWMksMchduLjWplFNHpyuxj76bKmcjoTZdE2OpxRKF7Q78kTVhUFuSU2OJonb9XaSy4pYp94fMWM5S6mIwTiw-b30Za61cs-KaFuQPyYRLntibu7Y6uFEuVVRkhBVCaiRCWlIzw5ylpuCGMEFSqfqkxoRFXVN-sBeVNLbQaByBU11gowunCKLl187kjsIw9ByZth2kLCvZNWZEUW2ZyxRmhIkMN97a4YQL51TqDDVmhFNje-7musZLiWhcyxJdrL0N4D25GWgUZ82EI5yVrNPZafj_s5bj76bbVtWYUnNQeK78j1lrZqwsNC3NgQ66D3GH6EXoR6-lfWJ_zNyVji8E9g0WVRCri_KZYSXj1I1VYtcazVryzrSGz8aeqjFHTbiUV5XyYje-W_OrXqdaKlq4WjKhKtvIgImir700emTrqynkC_hpvDezvo7mCyeG5thqpy8wt8aYKMhDVv1mVKhtpRM_DDqTsp_vhq-rhq44EqVlQhPGDyyvDjOaikyWxGC32BsmK_Fais7mfxfPHKwSiaxE1rQu5Rx5_0bwtFQKYzVlrtOFdEOp9pXbafvv3Eo1plbqnrdFMFtG0ziCePryIgJVJZylzzZwFDyhMF_EZ7C4jGHx7uLiJHiStCfN1-xysYqX0_kihg1RV7iFt8v5m-nyI_wWfYQjCtPV7PgkeDJfvIo-wIYkhGUbOEr8eXB8HgTTizha_tPzfPFrNIthFU_j-Sqez1bw9FMAAPCn_-1-BrQu_MNmMIHw5OG4HeWDCXy6P2zwg_vvz7t4jdRiRqgdTGBwGo7OhuFoGI4gHE3CcBKGgx2wW9VM-BdCJRxhFO769qPIv-bsVrnABrtkP4rviLs0N2LvDZ6OR6dj_7-_Tv7rlZMfcmUf4Y-7dfD56fl-RW6dIqt_KbLuUuR2jyKrO0U-wtUkd8jXl8to_vOiQdbHsIxeR8toMYtW99I8og9ydjwv5_qgnLd75exvGX14ezGdL-Do8m18AtHi_TGsoguH_R-8Xl6-gS38_ku0jKCCFzA-D4bD4TDwS38bwO3Nze3Nt9ubb3A_LuwEno8m8On5GIbwfPw5-DsAAP__KJ8-ww==

statement ok
SET optimizer_use_multicol_stats = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VuFu2zYQ_l09xcF_mgxxK8fDEDjoD9dVN2-pU9hq16IoCEo6yVwokiUp1c4woA-RJ-yTDKSUxFktq8DQ_Agi5vvujnff3XE4hLeoDZNiAjOZXmlJ0_WL54AbTJOK8Qw1WDQW6gYVBMMhUM7lZ6I0KqqRUEOkskRxKmBNDdg1QoY5rbiFmvIKJyDz3PFSaSwxKRWGfGZ2TVoUSSUnhl1jDz2jLpIt78TNV5cn8OrFew9ubTNhD9o-2wVbTYWhqWVSEKWZ1Mxuu4hC6pLyLvaninJmt0TmxKCuWdoZgMai4lR3GdJIMyIF74zjNjl7uJVBkktXLNTekOkzwjSmvh5VKahua4WCJhyzXq5pdJFXnBPrKA3_EG8VxY5ozScOz9zJOcD9ZW6RtLLSuWgCIaxUnKXMEoPchZtLTSrl1NHpSuyj76bK2UioTdfEWGqxRGG7A39gTRjUluTUWKKoXX8Xqay4Zcr9ITOWs5S6GIwTi89bX8ZaK9esuKYF-Usy4ZIn9uaurQ5ulEsVFRlhhZAaiZCW1MwwZ6kpuCFMkFSqPqkxYVHXlB_sRSWNLTQaR-BUF9jowimCaPm5M7mjMAw9R6ZtBynLSnaNGVFUW-YyhRlhIsONt3Y44cI5lTpDjRnh1Nieu7mu8VIiGteyRBdrbwN4T24GGsVZM-EIZyXrdHYa_nzWcvzddNuqGlNqDgrPlf8ha82MlYWmpTnQQXuZXoV-9lpqe9jfBLsrH18M7BsuqiBWF-UTw0rGqRutxK41mrXknakNn4w9VWOOmnApryrlBW98x-ZXvU61VLRw9WRCVbaRAhNFX4tp9MjWV1PMZ_DLeG9-fC3NJ04MzbHVT19gbpUxUZD7rPrtqFDbSid-IHQmZT_fDWBXDV1xJErLhCaMH1hgHWY0FZksicFuwTdMVuK1FJ0D4E08c7BKJLISWdO-lHPk_VvB01IpjNWUuW4X0g2m2ldup_W_czPVmFqpe94XwWwZTeMI4unziwhUlXCWPtnAUfCIwnwRn8HiMobFm4uLk-BR0p40X7PLxSpeTueLGDZEXeEWXi_nr6bL9_BH9B6OKExXs-OT4NF88SJ6BxuSEJZt4Cjx58HxeRBML-Jo-V_P88Xv0SyGVTyN56t4PlvB4w8BAMDf_rf7GdC68I-bwQTCk_vjdpwPJvDh7rDBD-6-P-7iNVKLGaF2MIHBaTg6G4ajYTiCcDQJw0kYDnbAbl0z4V8JlXCEUbjr248j_6KzW-UCG-yS_Ti-Je7S3Ji9M3g6Hp2O_f_-Ofm_V05-yJV9hD_u1sHHx-f7Fbl1iqy-UWTdpcjtHkVWt4p8gKtJ7pAvL5fR_NdFg6yPYRm9jJbRYhat7qR5RO_l7HhezvVBOW_3ytnfMnr3-mI6X8DR5ev4BKLF22NYRRcO-xO8XF6-gi38-Vu0jKCCZzA-D4bD4TDwi38bwNebm683X77efIG7cWEn8HQ0gQ9PxzCEp-OPwb8BAAD__51dPyU=

statement ok
RESET reorder_joins_limit

statement ok
RESET enable_zigzag_join

statement ok
RESET optimizer_use_histograms

statement ok
RESET optimizer_use_multicol_stats

#
# Test sequences.
#

statement ok
CREATE SEQUENCE seq

query T
EXPLAIN (OPT, ENV) SELECT * FROM seq
----
https://cockroachdb.github.io/text/decode.html#eJyUVsFu20gMvfsr5ri7qAMnbptsgx68rhYIEDvd2Am6J4KWKImb0cyYM3ISf_1iRi6aApHV3ISE75Hz-Eh6PFb3JJ6t-aTmNn8Qi3n95S9FT5RvWtYFiQrkg9p1UaPReKxQa_sITsihEKAH6wI4jUbV6FWoSRVUYquD2qFu6ZOyZRlxufUBfI7GwyOHGg5RkFsNnvc0AC8wVvKse-OuVjfv1OLLvyn4wM0mHOW-eBkcBI3HPLA14IStcHjuAxorDeo-9LZFzeEZbAmeZMd5bwFCVatR-oiEsABrdG8d38V5Bdt6gtLGZpEkIj9EwkJ56kfbGJRDr8jgRlMxiPWdL8pWawgR0uGP4VbZOgKD32r1Of7lUqkfj_keiW2wMUVXCHDjNOccwJOO5ZZWoHXRHb2pzGvwl1JFjg2GvAYfMFBDJvQX_hOb8SQBSvQBHIb6l0BNqwO7-GELLjnHWIOPZkm6DSh9INlztccK_rM8NHf05KJOaArgylghMDbAjj1Hnq7bHthAbt2Qz9gEkh3qo4PorA-VkI8AjVJRZ4poBxD72Kvs6WQySRibH8bHBW54TwU4lMBRJiqATUFPie242iYmtVKQUAEafRh4WxyZ5CMQqm1DsdZB96dMcQF6p7lbb6C54d5kZ5P3FwdMepsc5lQoRz_kup9BNftgK8HmTajkvrRzA74t30vbpCbQ0EZxFQSpmhPPDWuM-xRCLeRrq3slnZxME1SoJAFt7UPrks19GtPyYTCpWIdV7CMb14bOAmyqoU0klCIPubomflYfp68updRDv9XgsaSDb4YKi_eLTQU_VE0n0ZGEVjZpC_SK8jo-bt3YDWk1gRO7wQ3rI1erh0bQFLYBT_1G75Dc0N6a3sG_W89jWGs2tjVFN7aoNenhU5BguTU-CHKccmPjQtqlzr0Y-V88RzvKg5WBHxWj-W02W2dqlf1zly3nmXLtRnN-4mmrFlfL-9n1XaZO1WL2rfv88-xsOj0_m0w_Xnx4f37-4WJyrq6W89tskS3X6lSt1rPbtTq9HI2yb1-vZ1dL9dvN1_U7lS3vf1er7Dqbr9Uf6u_bm4XytL0cjcfj8cjTtiWT07g7Z_E_o_8DAAD__4hwb4w=

#
# Test views.
#

statement ok
CREATE VIEW v AS SELECT a, b, u, v FROM x, y WHERE b = 3

query T
EXPLAIN (OPT, ENV) SELECT * FROM v
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u27gSvo6eYuCb2gd2IscHB4GDAsd11V3vpk5hq38oCoKSRjY3FKmSlGpnsUCxz5DLfbo8yYKUnDhbK2qxaC-KiP6--f1myMEA3qDSTIoxTGV8pSSN18-fAW4wjgrGE1RgUBsoK5TnDQZAOZefSa4wpwoJ1UTmhuScClhTDWaNkGBKC26gpLzAMcg0tbxYakN0TIUmn5lZkxpFYsmJZtfYQk-ojWTLG3Gz5WUfXj5_78C1bSbMo7bP9sFGUaFpbJgUJFdMKma2TUQhVUZ5E_tTQTkzWyJTolGVLG4MQOGq4FQ1GVJIEyIFb4xjV5wD3EIjSaVtFipnSLcZYQpj148iE1TVvUJBI45JK1dXukgLzomxlIr_GG8ZhJZo9CcOT-3JOcB9MjskLYy0LqpACMtyzmJmiEZuw02lIkVu1dHoShyi75fK2oioiddEG2owQ2GaA39gTWhUhqRUG5JTs_4mUlZww3L7h0xYymJqY9BWLK5uLZWujVyz1TVdkd8ka5s73OS2TlQkhK2EVEiENKRkmlk7Vbc1YYLEMm_TGRMGVUn5o4OYS21WCrUlcKpWWInCyoEo-bmxskPf9x1HxvX45IZl7BoTklNlmC0TJoSJBDfO2uPVFtapVAkqTAin2rTkZkfG6YgoXMsMbayt6nee7ALUOWfVeiOcZazR2an_37Oa43JT9ZwqjKluU91D0pppI1eKZt_FcupzO9fQ7_O3LxvXBGzbKPmKGLXKjjXLGKd2nxKzVqjXkjeW1D8eOarCFBXhUl4VuZO5dmOaXrU6VTKnK9tHJvLCVBJgYtW2iRQ6ZO2rauJT-N_o4FJyPdSfONE0xVo3bYHZ-4uJFbmvqrsSc1SmUJHbAo1FOcy3W9d2QxUcSa5kRCPGH7m1GswoKhKZEY3NQq-YLMNrKRoH_3U4tbBCRLIQSTW2lHPk7VeBo8VSaKMos1MupF1Ipevc3sh_43VUYmykanlUeNNFMAkDCCfPLgLIi4iz-HgDXe-IwmwensH8MoT564uLvncU1SfV1_RyvgwXk9k8hA3Jr3ALrxazl5PFe_g1eA9dCpPltNf3jmbz58E72JCIsGQD3cide71zz5tchMHin55n81-CaQjLcBLOluFsuoQnHzwAgN_d__Zfh5Yr96LpjMHv3x_Xa7wzhg93hxW-c_f9cR-vkBpMCDWdMXRO_eHZwB8O_CH4w7Hvj32_swe2dzQT7mlQCEsY-vu-3R5yzzizzW1gnX2yW8M74j7Nrtc7g6ej4enI_fZH_9-mHP2QlF2EPy5r7-OT88OK3FpFFl8psmxS5PaAIoudIh_gSpJa5IvLRTD7aV4hyx4sghfBIphPg-WdNLv0Xs6W5-RcPirn7UE572f5Zha83aFLN3Z20PreUWHT83owWcIyuLA2aB-iPhR9KOHF4vKl22HHu-D6Dz638PbnYBFABE9hdO55wbtXF5PZHLqXr8I-BPM3vZ3R_1S2ynNvMBgMPCYEqoF7UHVjJbXueXB789ftzZfbmy_g3hvbr042_6-n2_7yp-3k7c1NDbhbZ2YMJ6cnwzF8OBnBAE5GH709WMq4QaWha1SBPe_vAAAA___gfn_P

#
# Test tables in user-defined schemas.
#

statement ok
CREATE SCHEMA s;
CREATE TABLE s.t (a int primary key)

query T
EXPLAIN (OPT, ENV) SELECT * FROM s.t;
----
https://cockroachdb.github.io/text/decode.html#eJyUlk9v20gPxs_Vp5hbkxdxkHe7WAQNenBdLeBdxwlstdhgsSBoiZJmM5qZcCjnz6dfzMhFUyCK2lsQ8PeQIh9yPJupL8RBO_teLVx5yw7L9tNHRQ9U7nptKmIlFETth6gsm80UGuPuwTN5ZAIM4LyAN2hVi0FJS6qiGnsjao-mp_fK1XXkShcEQok2wL2WFg5RUDoDQT_RBF5hrOTRjMYtt1cn6vLTTQo-aGsrr2qfPw8WRhuwFO0seNaOtTyOgdZxh2aMvuvRaHkEV0Mg3utytACmpjfIY0JMWIGzZrSOr815ge0DQe3isIiTUJgS0UxlmkffWeTDrMjizlA1yYbBF3VvDEhEBv41bpsXEZRwZ9SH-J8Lpb59zNdI7MXFFEMhoDtvdKkFAplYbu0Yeh_dMZrKvoQ_b1XU2KGULQRBoY6sjBf-nZoNxAI1BgGP0v4Q1PVGtI9_uErXusRYQ4hmSX2b6PRB5Ek3T9jAv05P7R09-NgntBXoxjomsE5gr4OOOsO0A2gLpfNTPtNWiPdoXl1E74I0TCECBrmhwRTRDsDufrSz_z87O0uMKw_r40V3-okq8MiiY5uoAm0rekhqr3fbxqSOK2KqwGCQiW-LK5N8BEyt6yjWOun-lCkewOCNHs4bGN3p0WS_nP16fmDSt_FhT5lKDFOu-x5qdRDXMHY_RSX3pZsr-HP5ntsmDYGmLopvQLjpToPutMF4T0FaptA6M9rSs9N3CWWqicE4d9v7ZPOQ1rS-nUzKzmMT56it72WwgLbN1CViSpGHXMMQP6jf3r14lNIMw52BgDUdfDNVWHy_tG3gW1fTk-iJpeddugKjTXmZj1c3ToN7Q-DZ7XCnzSuv1ogMo61cB4HGjT6QuqMnZ0cX_3OxiGG93bneVsPaojFkpp-ChJXOBmHUccutiwdpnyb3bOV_8DnaUymOJ35UZItNPi9yVcw_rnIVTkUdZW9QLdfFuVpfFWr9ebU6yd4srtbbYjNfrgsl4G_pUV1vlpfzzY36M79RR6jm28VxdnyRZfNVkW-eyS3Xf-SLQm2LebHcFsvFVr39-5-3F1mW_3W9mi_X6ujqujhR-frLsdrmqxj7P_X75uoy0hfZbDabZenOSfZfAAAA__93mXI0

#
# Test default_transaction_quality_of_service settings.
#

statement ok
SET default_transaction_quality_of_service=background

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVsFu20gMvfsr5pgAceFsF4uiRQ7dNocC3bZA0mD3RNASJXEzGk44lJP41I_IF-ZLihm5aApYVnMzDL5HzuMjqeXSXZEmlvDavZPqWgWr7v3fju6oWg_sa1JnlMxtxqjFYrl06L3cQlSKqASYQKJB9Bhch8lZR66mBgdvboN-oNdOmibjKkkGqcKQ4Jatg10UVOIh8ZZm4DXmSu79ZNyHi88n7p_3_5XgHTcHO8j96mmwKYaElbEEiMqibPdTwCDao19cnF_uhd8M6NnuQRpIpBuuyJ25NVbXrcoQ6jfO_cz7g1KpHTzqVEVKWIMEP1nSD532YIdE0EjuG2khSnMkrFSV1gx9QN21jQKuPdWz2DRapBm8B8uQEX8IV4TkZOnGu7P8z16JcDDJKcZCgPvouWKDRD6X24jCELNRJlOFffCnUmWONVrVQTI06inYdOG_sIVEatBgMoho3W-B-sEbx_xDam64wlxDyrYpus0ovSPZcrvFFv4XnhtBuotZJww1cBtECYIYbDhx5hm7nYADVBLnfMbBSDfoD85klGStUsoAj9rSaIpsB1C5nVT2dLVaFYxUu0GKxj1vqYaIapxloho41HRX2A6rHXJS0ZqUavCYbOZteWSKj0Cpk55yrbPuL5nyLkzR87jpwHPPk8n-WP35aocpb9PdnCpVmOZc9yuo42TSKvbPQhX3lfVr-Lx8T21TmkBzGyW2YNr2LxL37DGvVrBOKXXiJyVdvXhZoEoNKXiR6yEWm6cyps31bFKViG3uI4c42GgBDu3cJlIqkbtcYxPP3F8v9y6l0sN04yFhQzvfzBWWTxmHFn6qWq5jJLVB12ULTIqyH5-3bu6GDp4gqqxxzf7AAZugUQy19JBo2ugjknvaSpgc_K-X73LYENb53o1ji96Tnz8FBVZJSKbIecqD5IW0KZ17MvK_eY42VJnozPfF4vzfLx_ffvjkjj5_uTxx55-ujt3V249fzy_c0enxm8VyuVwuSnxauMeHh8eHb48P39zR6cnx4nsAAAD__xchW4k=

statement ok
SET default_transaction_quality_of_service=critical

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVsFu20gMvfsr5pgAceFsF4uiRQ7dNocC3bZA0mD3RNASJXEzGk44lJP41I_IF-ZLihm5aApYVnMLAr5H6vHxjZdLd0WaWMJr906qaxWsuvd_O7qjaj2wr0mdUTK3GasWi-XSofdyC1EpohJgAokG0WNwHSZnHbmaGhy8uQ36gV47aZqMqyQZpApDglu2DnZVUImHxFuagdeYJ7n3k3UfLj6fuH_e_1eKd9wc7CD3q6fFphgSVsYSICqLst1PAYNoj35xcX65F34zoGe7B2kgkW64InfmKmXjCv0b5352_UGo1A4edWoeJaxBgp8c6IdKe7BDImgkb420EKU5ElaqymKGPqDulkYB157qWWwaDdIM3oNlyIg_hCsycrJ0491Z_s9eiXAwyS3GQYD76Llig0Q-j9uIwhCzTSZbhX3wp1JljjVa1UEyNOop2PTgv7CFRGrQYDKIaN1vgfrBG8f8h9TccIV5hpRNU3SbUXpHsuV2iy38Lzx3gHQXs04YauA2iBIEMdhw4swzbjsBB6gkzvmMg5Fu0B-8yCjJWqWUAR61pdEU2Q6gcjup7OlqtSoYqXZnFI173lINEdU4y0Q1cKjprrAdVjvkpqI1KdXgMdnMt-WTKT4CpU56yrPOur90ykmYoucx58Bzz5PN_lj9-WqHKd-muztVqjDNue5XUMfJpFXsn4Uq7ivha_i8fk9tU5ZAc4kSWzBt-xeJe_aYgxWsU0qd-ElJVy9eFqhSQwpe5HqIxeapnGlzPdtUJWKb98ghDjZagEM7l0RKpXLXa1zimfvr5d5QKjtMNx4SNrTzzdxg-SHj0MJPVcvbGElt0HVJgUlR9uNz6uZt6OAJosoa1-wPPF8TNIqhlh4STRt9RHJPWwmTh__18l0uG8JahlCPZ4vek59_CgqskpBMkfOVB8mBtCmbe3Lyv_kcbagy0ZlfF4vzf798fPvhkzv6_OXyxJ1_ujp2V28_fj2_cEenx28Wy-VyuSj1aeEeHx4eH749PnxzR6cnx4vvAQAA__-IwFq0

#
# Test recursive table references from foreign keys.
#

statement ok
CREATE TABLE z (
  pk INT PRIMARY KEY,
  ref INT,
  CONSTRAINT fk FOREIGN KEY (ref) REFERENCES y(u),
  FAMILY "primary" (pk, ref)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM z;
----
https://cockroachdb.github.io/text/decode.html#eJy0VlFv2zYQfq5-BeGXJkNcyMkwBA764Lrq4C21C1stWhQFQUknmTNFskdKsT3svw-knMRZJavF0DwEEXPf3X133x05HJIPgIYrOSZTlW5QsXT9-hWBLaRJxUUGSCwYS-rGKgiGQ8KEUHdUI2iGQJmhSluqBZNkzQyxayAZ5KwSltRMVDAmKs8dLlXGUpMyaegdt2t6sKKpEtTwPfTAM-Yy2YlOu9lqcUHevv7kjQ--ubQnfV8fG1tk0rDUciWpRq6Q210XUCosmQhWUdwK_1oxwe2OqpwawJqnQF6SFLnlKRM3hDxGvXeIUFSCYVc-CCyjSorOhO6r1IKtDNBcua4BekemzwlHSH1jqlIyPDQNJEsEZL1Y0wgkr4Sg1kEa_CmcLyM31nwV5KU7aS0Rq6xyIZpEKC-14Cm31IBw6eYKaaWdTDpDyTb4camcj4TZdE2NZRZKkLY78SfepAG0NGfGUs3s-rtAZSUs1-4PlfGcp8zlYJxofN16Kn1wsufFnhX0L8X7BhC22tWJyYzyQioEKpWlNTfc-Wm6bSiXNFW6T2dcWsCaiZMTqZWxBYJxAMGwgEYUTg4U1V1nZUdhGHqMSg9jpC0v-R4yqhla7soEGeUyg633drra0gVVmAFCRgUztoebGxmvI4qwViW4XHvV7yO5TWi04M2eo4KXvDPYZfjr9QHjueFhThFSZvpU9xS05saqAln5QyivPr98LfuxeMey8U2Avo2iC2qxKF8YXnLB3GKldo1g1kp0ljR8ceWhCDkgFUptKu1lbvyY5pveoKg0K1wfudSVbSTAZdG3iRC85SFW08SX5Ler1qXke2i-CmpYDgfd9CXmLjIuC_pYVX83akBbYeK3QGdR2vFu67puYCWAalQJS7g4cX11uEEmM1VSA91Cb5C8hL2SnYP_Pp46s0omqpJZM7ZMCBD9V4GHpUoai4y7KZfKLaTad-5o5L_zOqohtQp7XhfBdBlN4ojEk1e3EdFVInj6YkvOgmeMzObxNZkvYjJ_f3t7ETxLDifN13QxX8XLyWweky3VG9iRd8vZ28nyE_kz-kTOGJmspucXwbPZ_HX0kWxpQnm2JWeJPw_Ob4JgchtHy_9Gns3_iKYxWcWTeLaKZ9MVef45IISQv_1v9zNgdeGfNoMxCS8ejw9rfDAmnx8OG_vBw_eXY3sEZiGjzA7GZHAZjq6H4WgYjkg4GofhOAwHR8bujubSPw0q6QCj8Di230P-PWd32iU2OAb7NXwPPIa59frg8PJqdHnl__fPxf-lnPwUyj7Dn8c6-PL8pl2RO6fI6htF1l2K3LUosrpX5BO7mubO8s1iGc1-nzeW9TlZRm-iZTSfRqsHaZ6xRzk7nJdzfVLOu1Y5d7LcO5Z68w1NhLyL6L6FqN60MM03Tzki5G0sd2dVJ5t9N5vo47vbyWxOzhbv4gsSzT-ck1V062x_IW-Wi7dkfxMMh8Nh4J8s--DfAAAA__8TIWjh

# A foreign key cycle shouldn't cause infinite recursion.
statement ok
ALTER TABLE y ADD CONSTRAINT fk FOREIGN KEY (v) REFERENCES z (pk);

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt9v2zYQfq7-ioNf6gxxISfDEDjog-uqg7fUKWy1aFEUBCWdZM4UyZKUannY_z6QchpnlaIWQ_MQRMx99-O7746cTOAdasOkmMFCpjstabp9-QJwj2lSMZ6hBovGQt1aBcFkApRz-YUojYpqJNQQqSxRnArYUgN2i5BhTituoaa8whnIPHe4VBpLTEqFIV-Y3ZKjFUklJ4YdcACeUZdJw3vtlpvbc3j98oM3Pvpmwj7q--rU2GoqDE0tk4IozaRmtukDCqlLyoNNFHfCP1eUM9sQmRODumYpwnNINbMspfwa4D7qnUONRcWp7stHI82IFLw3oTuWOrCVQZJL1zXU3pEZcsI0pr4xVSmoPjYNBU04ZoNY0wokrzgn1kFa_GM4TyMz1nzm8NyddFJEKytdiDYRwkrFWcosMchdurnUpFJOJr2hRBf8lCrnI6E23RJjqcUShe1P_IE3YVBbklNjiaJ2-12gsuKWKfeHzFjOUupyME40nrcBpo9ODqw40IL8JdnQAOJeOZ6oyAgrhNRIhLSkZoY5P223DWGCpFIN6YwJi7qm_NGJVNLYQqNxAE51ga0onByIll96mZ2GYegxMj2OkbKsZAfMiKLaMkcTZoSJDPfe2-NsCxdU6gw1ZoRTYwdqcyPjdUQ0bmWJLtdB9ftIbhMaxVm75whnJesNdhH-enXE-Nr0cU41ptQMqe4haMuMlYWm5Q-hvPr88rX0x-KdysY3AYc2iiqI1UX5zLCSceoWK7FbjWYreS-l4bNLD9WYoyZcyl2lvMyNH9N8NxhUS0UL10cmVGVbCTBRDG0ijd7yGKtt4nP47bJzKfkems-cGJrjUTdDibmLjImC3LPq70aF2lY68Vugl5RuvNu6rhu64kiUlglNGH_k-upxo6nIZEkM9gu9RbISD1L0Dv7beOHMKpHISmTt2FLOkQ9fBR6WSmGspsxNuZBuIdW-cycj_53XUY2plXrgdREs1tE8jiCev7iJQFUJZ-mzPYyDJxSWq_gKVrcxrN7e3JwHT5LjSfu1uF1t4vV8uYphT9QOG3izXr6erz_An9EHGFOYbxZn58GT5epl9B72JCEs28M48efB2XUQzG_iaP3fyMvVH9Eihk08j5ebeLnYwNOPAQDA3_63-xnRuvBPm9EMwvP74-MaH83g49fD1n709fvTqb1GajEj1I5mMLoIp1eTcDoJpxBOZ2E4C8PRibG7o5nwT4NKOMA0PI3t95B_z9lGucRGp2C_hu-ApzC3Xr86vLicXlz6__1z_n9LTn5KyT7Dn1d18OnpdbciD06RaveNJDXmfaI8dIhS7e5UeWKY7-DV7Tpa_r5qjTTmZ7COXkXraLWINncpNOOqV7aHTtn2VtO4aqpviqn7Smk6Sqk6KmlITXJn-aCeuqua_ZgO0NAJO4zV7n6oXTw_1PWjQ930sxO9f3MzX65gfPsmPodo9e4MNtGNs_0FXq1vX0NzHUwmk0ngnzpN8G8AAAD__xtAeKM=

# Check that we remove histograms from statistics correctly.

statement ok
CREATE TABLE b (
  b BOOL NOT NULL,
  INDEX (b)
)

statement ok
ALTER TABLE b INJECT STATISTICS '[
      {
          "avg_size": 1,
          "columns": [
              "b"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 2,
          "histo_buckets": [
              {
                  "distinct_range": 0,
                  "num_eq": 1000,
                  "num_range": 0,
                  "upper_bound": "false"
              },
              {
                  "distinct_range": 0,
                  "num_eq": 100,
                  "num_range": 0,
                  "upper_bound": "true"
              }
          ],
          "histo_col_type": "BOOL",
          "histo_version": 2,
          "name": "__auto__",
          "null_count": 0,
          "row_count": 1100
      },
      {
          "avg_size": 0,
          "columns": [
              "rowid"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 0,
          "histo_col_type": "",
          "name": "__auto__",
          "null_count": 0,
          "row_count": 0
      }
]'

query T
EXPLAIN (OPT, ENV) SELECT * FROM b
----
https://cockroachdb.github.io/text/decode.html#eJy8Vk9v27gTPVefYuBL0x_iwHH6200d9OA6LuBd1y5itWhRFANKGsuzoUiGpJw_i_3uC1JO6y6iKD3s5hAk5LyZ0Zs3M-z34SNZx1qNYKLzS6tFvjl_A3RDeVazLMiCJ-dh21glSb8PQkp9jcaSEZZQONTGo5FCwUY48BuCgtailh62QtY0Ar1eB1yunUeXC-Xwmv0Gd1aYa4mO76gDXoiQya1stZutlofw7vxzNN75ZuUf9X26b-ytUE7knrVCY1lb9rdtQKVtJWSymqYPwq9qIdnfol6jI7vlnOA15JY950KeAXyPeu_QUllLYdvysSQK1Eq2JnTP0gPY2hGudaga2ejIdTlhS3ksTF0pYXdFIyUySUUn1jUCWddSog-QBv8YLtLIzrsrCa_DyYMUidrrEKJJBLkyknP26EiGdNfaYm2CTFpDqYfg-1QFH5nw-QadF54qUr498R-8KUfW41o4j0b4zZNAVS09m_CHLnjNuQg5uCCayFsH0zsnd1zeiRL_0NzVgHRjAk9CFcil0pZQaY9bdhz8NNV2yApzbbp0xsqT3Qr5aEca7XxpyQWAFLakRhRBDmj1dSuzx4PBIGJ0vmsj47niOyrQCOs50EQFsiroJnp7nG0VgmpbkKUCpXC-49tCy0QdoaWNrijk2qn-GClMQmckN3MOJVfcGmw4eHm6w8Rvs7s-tZQL16W6H0Ebdl6XVlQ_hYrqi8PXi5-Lty-bWATqmiimRG_L6shxxVKEwYp-Y8lttGyldHB0EqGW1mRRan1ZmyhzF9t0fdkZ1GojylBHVqb2jQRYlV2TyFK03MVqivgafjl5cCjFGroriU6saaebrsTCImNV4ndW4240ZH1tszgFWkl5GB-mbqiGrSWhsToTGctH1leLGytUoSt01C70BskV3WnV2vgf0kkwq1Wma1U0bSukJNm9CiIs18p5Kzh0udJhIG1j5fZa_onraEu517bjdZFMLqbjdArp-M18CqbOJOdHGRwkzzJ4s1zOYbFMYfFhPj9Mnll9zQXMFulpPP04W80C6N4Czqdvxx_mKdSKr-o4Org4eHGYPJssF6v0YjxbpJChuaRbeH8xeze--Ay_Tz_DQeN3vJoE29nifPoJMsyQixs4yOJ58uIsScbzdHrxz0Rni9-mkxRW6TidrdLZZAXPvyQAAH_G3-GnJ7ZlfAn1RnB8-P14N_V7I_jy7TBeZL1v_3_dt7ckPBUofG8EveFgOOwfD_uDIRyfjk5ejoavjv7_68tXJ8PeHiZsdlbxQVGrgBvuXcbZFd-A_taE7Hr7UCWqeIYYlj_iD3dhrN-7HOxdhHF9f358PBjEm78OH2Fk8BRGYoX-RVYG_x0rO0qSr8_PkmT66f18PFvAwfJ9egjTxccXsJrOg6D-B28vlu8gO0v6_X4_iZs2S_4OAAD__4OrEC8=
