# LogicTest: local !metamorphic-batch-sizes
# We must turn off metamorphic variables because some are included in
# EXPLAIN (OPT, ENV) output.

statement ok
CREATE TABLE x (
  a INT PRIMARY KEY,
  b INT,
  INDEX (b),
  FAMILY "primary" (a, b)
)

statement ok
ALTER TABLE x INJECT STATISTICS '[
  {
    "columns": ["a"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 100,
    "histo_col_type": ""
  },
  {
    "columns": ["b"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 123123,
    "histo_col_type": ""
  }
]'

statement ok
CREATE TABLE y (
  u INT PRIMARY KEY,
  v INT REFERENCES x,
  INDEX (v),
  FAMILY "primary" (u, v)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM x WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VuFu2zYQ_l09xcF_mg52I8f7ETgoMNfVMG-uU9hq1yAICEo6yVwokiEpx8kwoA-RJ8yTDKSUxB0iq8XQ_Agi5r67491333EwgE-oDZNiDFOZXmpJ0_W7t4BbTJOK8Qw1WDQWNrVVEAwGQDmX10RpVFQjoYZIZYniVMCaGrBrhAxzWnELG8orHIPMc4dLpbHEpFQYcs3smjRWJJWcGHaLHfCMukxueKvdbHXah_fvzrxx45sJu9f38a6x1VQYmlomBVGaSc3sTRtQSF1S3oa-qihn9obInBjUG5a2JqCxqDjVbY400oxIwVvzeCjOM9jKIMmlaxZq78h0OWEaU9-PqhRUN71CQROOWSfW1LzIK86JdZAavw-3imIHtOaKwxt3cgLwdJkHS1pZ6ULUiRBWKs5SZolB7tLNpSaVcuxoDSWeg--WyvlIqE3XxFhqsURh2xP_ypswqC3JqbFEUbv-JlBZccuU-0NmLGcpdTkYRxZft45KN05uWXFLC_KXZF1zh1vl6kRFRlghpEYipCUbZpjzU3fbECZIKlUXz5iwqDeU7x1EJY0tNBoH4FQXWJPC0YFoed1a2WEYhh4j02Z8lGUlu8WMKKotc2XCjDCR4dZ7219t4YJKnaHGjHBqbMfd3Mh4HhGNa1miy7WT_T6SE0CjOKvljXBWstZgR-HPxw3G3003c6oxpaaLdV-D1sxYWWhafhfKs89rrqXfF2-XNr4J2KUoqiBWF-Vrw0rGqdNTYtcazVry1pKGr0ceqjFHTbiUl5XyNDd-TPPLzqBaKlq4PjKhKltTgImiA6bRGzah9vbQN9BccWJojg1purJyy4uJgjyV1O9DhdpWOvES0FqR5_FOcl0rdMWRKC0TmjC-Z2W1uNFUZLIkBttZXiNZibdStE79x3jqzCqRyEpk9cxSzpF37wEPS6UwVlPmRlxIp0Yb37adef_GXbTB1Eq970UhgmC6jCZxBPHk7TwCVSWcpa-3cBC8oDBbxMewOI1h8XE-7wcvkuak_pqeLlbxcjJbxLAl6hJv4MNy9n6yPIM_ojM4oDBZTV_1gxezxbvoM2xJQli2hYPEnwevToJgMo-j5X8jzxa_R9MYVvEknq3i2XQFL88DAIC__W_306Obwr9memMI-0_HjYT3xnD-eFjb9x6_L3btNVKLGaG2N4beUTg8HoTDQTiEcDgOw3EY9naM3X5mwj8LKuEAw3A3ttcg_4SzN8ol1tsFewl-AO7CnLQ-OjwaDY9G_n__9P_vlZMfcmWf4Y-7dXDx8iQIos8f5pPZAg5OP8R9iBafXsEqmjtS_AS_Lk_fwxb-_C1aRpDAGxidBIPBYBD4Nbj9paFZAPd3d_d3X-7vvsDjPNkxHB4dDsdwfjiCARyOLoJ_AwAA__9qlQKm


statement error pq: at or near "EOF": syntax error: the ENV flag can only be used with OPT
EXPLAIN (ENV) SELECT * FROM x WHERE b = 3

#
# Multiple Tables.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x, y WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3dQa7kZNdBA4KzHXVzVvqFLbatSgKgpKOZC4UyZKUa2cYUOwZcrmny5MMpJTEWSOrxdBcBDb9fef3O4ccDuENasOkGMNUphda0nT1_BngBtOkYjxDDRaNhXWNCoLhECjn8hNRGhXVSKghUlmiOBWwogbsCiHDnFbcwpryCscg89zxUmksMSkVhnxidkUaFEklJ4ZdYgc9oy6SLW_FzZbnA3j5_J0HN7aZsHttn-yCrabC0NQyKYjSTGpmt21EIXVJeRv7Y0U5s1sic2JQr1naGoDGouJUtxnSSDMiBW-N46Y4D3ArgySXrlmovSHTZYRpTH0_qlJQ3fQKBU04Zp1cU-sirzgn1lFq_j7eMood0ZqPHJ66k1OAu2RukLSy0rmoAyGsVJylzBKD3IWbS00q5dTR6ko8RN8tlbORUJuuiLHUYonCtgd-z5owqC3JqbFEUbv6KlJZccuU-yAzlrOUuhiME4uvW0elGyOXrLikBflDsq65w41ydaIiI6wQUiMR0pI1M8zZqbttCBMklapLZ0xY1GvK9w6iksYWGo0jcKoLrEXh5EC0_NRa2VEYhp4j02Z8lGUlu8SMKKotc2XCjDCR4cZb219t4ZxKnaHGjHBqbEdubmS8jojGlSzRxdqpfu_JLUCjOKvXG-GsZK3OjsIfTxqOz003c6oxpaZLdfdJK2asLDQtv4nl1ed3rqXf5m9XNr4J2LVRVEGsLsonhpWMU7dPiV1pNCvJW0saPjn2VI05asKlvKiUl7nxY5pfdDrVUtHC9ZEJVdlaAkwUHTSNHti42ttD30DzkRNDc2xE0xWVu7yYKMhdSf19qFDbSid-BbRW5GG-W7muFbriSJSWCU0Y33NltZjRVGSyJAbbVV4zWYmXUrRO_et46mCVSGQlsnpmKefIu-8BT0ulMFZT5kZcSLeN1r5tO_P-lXfRGlMr9b4XhQiC6SKaxBHEk2dnEagq4Sx9soF-8IjCbB6fwPw8hvnrs7NB8ChpTupv0_P5Ml5MZvMYNkRd4BZeLWYvJ4t38Fv0DvoUJsvpwSB4NJs_j97ChiSEZRvoJ_48ODgNgslZHC3-63k2_zWaxrCMJ_FsGc-mS3j8PgAA-NP_d389ui78a6Y3hnBwd9ys8N4Y3t8e1vje7fcPu3iN1GJGqO2NoXcUjk6G4WgYjiAcjcNwHIa9HbC7n5nwz4JKOMIo3PXtd5B_wtmtcoH1dsl-Bd8Qd2lutd4aPDoeHR373_4a_N-Uk--Sso_w-2UdfHh8-rAit06R1ReKXLcpcvuAIqsbRd7DrUnukC_OF9Hs53mNXB_AInoRLaL5NFreSrNP7-TseF7O671y3j4oZ59l9PbV2WQ2h_75q3gA0fzNASyjM4f9AV4szl_CZgBb-P2XaBFBAk_h-DQYDofDgAmBeuifO_1US2MOAri--uf66vP11Wfwr4HtFyebn5r5c7_87Wp9fXXVAG73jR3D4dHhaAzvD49hCIfHH4IdWM64RW2gb3WFB8G_AQAA__99pWXh

#
# Same table twice should only show up once.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x one, x two
----
https://cockroachdb.github.io/text/decode.html#eJy0Vl-P0zgQfyafYtQXuqcWpcs9rLrioZSe1LvSRW1AIIQsJ5mkvnVsM3a63T2dxIfYx_t0fJKTnQDlRBrQiX1YNfb85u9vZjwewyskK7Sawlxn16R5tnv2FPCAWVoLmSOBQ-tg30hF0XgMXEp9wwyh4YSMW6aNY0ZyBTtuwe0Qcix4LR3suaxxCrooPC7T1jGbcWXZjXA71kqxTEtmxR32wHPuPbmVnXLL7dUInj97E4Rb3UK5k7ovjoUdcWV55oRWzJDQJNxtF1BpqrjsQr-vuRTulumCWaS9yDodICxryalLESHPmVay049PyfkGtrbICu2LhRQU2T4lgjAL9agrxamtFSqeSsx7sbbhRVFLyZyHNPhTuO0i8UBn30t44k8uAb4E80mS1057E40jTFRGikw4ZlF6dwtNrDaeHZ2m1Lfgx6nyOlLush2zjjusULlux7_SpiySYwW3jhnudt8FqmrphPE_dC4KkXHvg_VkCXnryXSr5E6Ud7xkf2rR13d4MD5PXOVMlEoTMqUd2wsrvJ6m2pYJxTJt-ngmlEPac3myEY22riS0HiA5ldiQwtOBkb7pzOwkjuOA0VnbPsaJStxhzgwnJ3yaMGdC5XgI2k5nW3mjmnIkzJnk1vXE5lsm8IgR7nSF3tde9gdLfgBaI0Uz3pgUleg0dh7_etFiQmzU9ilhxm0f674G7YR1uiRe_RAqsC_MXMd_zN4xbUIRsG-imJI5KqtHVlRCcj9PmdsR2p2WnSmNHz0OUMICiUmtr2sTaG5DmxbXvUZJG176OgplatdQQKiyB0YYBFtTJ2sYCmjfS2Z5gS1p-rzyy0uokn1JadiHBsnVlIYR0JmRb-P9yPWloFoiM6RTngp5YmV1qCGucl0xi90sb5CiwjutOrv-ZTL3YrVKda3ypme5lCj790CAZVpZR1z4FlfaT6N9KNtRv3_nLtpj5jSdelGoKJpvFrNkAcns6WoBpk6lyB4dYBg94LBcJxewvkpg_XK1GkUP0vak-ZpfrbfJZrZcJ3Bg5hpv4cVm-Xy2eQN_LN7AkMNsOz8bRQ-W62eL13BgKRP5AYZpOI_OLqNotkoWm_9aXq5_X8wT2CazZLlNlvMtPHwbAQD8Ff77vwHfl-E1M5hCPPpy3I7wwRTefj5s5Aefv98dyxNyhznjbjCFwXk8uRjHk3E8gXgyjeNpHA-OhP1-Fio8C2rlAZP42HaYQeEJ526Nd2xwDA4j-BPwGOZH62eF548n54_D3d-j_xty-lNCDh7-vKijdw8vo2jx-sVqtlzD8OpFMoLF-tUZbBcrT4pf4LfN1XM4wGwLWuGo-eVu9GU0Ho_HkVAKaRyeAsOMtLVnEXy8_-fj_YeP9x8gbMoDvOX2iVb4ruPK3ehwdd9eFUI6JAtDRzWeRf8GAAD__-E3Gxo=

#
# Set a relevant session variable to a non-default value and ensure it shows up
# in the environment dump.
#

statement ok
SET reorder_joins_limit = 63

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VmFv2zYT_lz9ioO_NHkRt3L8Yggc9IPrqps31y5stWtRFAQlnWQuFMmSlGpnGNAfkV_YXzKQchJns6wWQ_MhiJh77o53zz3Hfh_eojZMihFMZHqlJU3XL54DbjBNKsYz1GDRWKgbqyDo94FyLj8TpVFRjYQaIpUlilMBa2rArhEyzGnFLdSUVzgCmecOl0pjiUmpMOQzs2uysyKp5MSwa-yAZ9RlsuWtdtPV4gxevXjvjXe-mbBHfV_sG1tNhaGpZVIQpZnUzG7bgELqkvI29KeKcma3RObEoK5Z2pqAxqLiVLc50kgzIgVvzeO2OAewlUGSS9cs1N6R6XLCNKa-H1UpqN71CgVNOGadWNPwIq84J9ZBGvwx3CqKHdCaTxyeuZNLgPvL3FrSykoXokmEsFJxljJLDHKXbi41qZRjR2socQi-XyrnI6E2XRNjqcUShW1P_IE3YVBbklNjiaJ2_U2gsuKWKfeHzFjOUupyMI4svm4dld45uWbFNS3IH5J1zR1ulKsTFRlhhZAaiZCW1Mww56fptiFMkFSqLp4xYVHXlB8dRCWNLTQaB-BUF9iQwtGBaPm5tbKDMAw9Rqa78VGWlewaM6KotsyVCTPCRIYb7-14tYULKnWGGjPCqbEdd3Mj43lENK5liS7XTvb7SE4AjeKskTfCWclag52H_7_YYfzd9G5ONabUdLHuIWjNjJWFpuV3oTz7vOZa-n3x9mnjm4BdiqIKYnVRPjGsZJw6PSV2rdGsJW8tafhk6KEac9SES3lVKU9z48c0v-oMqqWihesjE6qyDQWYKLqUSKO33MVqmvgMfhoeFCXfQ_OJE0Nz3PGmKzG3v5goyH1V_UpUqG2lE68CrUU5jHeq67qhK45EaZnQhPEjW6vFjaYikyUx2E70BslKvJaidfDfxBNnVolEViJrxpZyjrx7FXhYKoWxmjI35UI6Qap95_ZG_hvXUY2plfrYo0IEwWQZjeMI4vHzWQSqSjhLn2zgJHhEYTqPL2C-iGH-ZjY7Cx4lu5Pma7KYr-LleDqPYUPUFW7h9XL6arx8D79F7-GEwng1OT0LHk3nL6J3sCEJYdkGThJ_HpxeBsF4FkfLf0aezn-NJjGs4nE8XcXTyQoefwgAAP70v91Pj9aFf9D0RhCe3R_vVLw3gg93h4197-774769RmoxI9T2RtA7DwcX_XDQDwcQDkZhOArD3p6xW9FM-JdBJRxgEO7H9jLkX3F2q1xivX2wV-Fb4D7Mqeudw_Ph4Hzo__fX2X-9cvJDruwz_HG3Dj4-vjzMyK1jZPUvRtZtjNweYGR1y8gHdjXJneXLxTKa_jxvLOtTWEYvo2U0n0SrO2qe0Hs6O5ync32UztuDdPa3jN69no2nczhZvI7PIJq_PYVVNHO2_4OXy8Ur2MLvv0TLCCp4BsPLoN_v9wO_77cBfL25-Xrz5evNF7hTCzuCp4MRfHg6hD48HX4M_g4AAP__89M9_w==

# Make sure it shows up correctly even if it matches the cluster setting.
statement ok
SET CLUSTER SETTING sql.defaults.reorder_joins_limit = 63


query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VmFv2zYT_lz9ioO_NHkRt3L8Yggc9IPrqps31y5stWtRFAQlnWQuFMmSlGpnGNAfkV_YXzKQchJns6wWQ_MhiJh77o53zz3Hfh_eojZMihFMZHqlJU3XL54DbjBNKsYz1GDRWKgbqyDo94FyLj8TpVFRjYQaIpUlilMBa2rArhEyzGnFLdSUVzgCmecOl0pjiUmpMOQzs2uysyKp5MSwa-yAZ9RlsuWtdtPV4gxevXjvjXe-mbBHfV_sG1tNhaGpZVIQpZnUzG7bgELqkvI29KeKcma3RObEoK5Z2pqAxqLiVLc50kgzIgVvzeO2OAewlUGSS9cs1N6R6XLCNKa-H1UpqN71CgVNOGadWNPwIq84J9ZBGvwx3CqKHdCaTxyeuZNLgPvL3FrSykoXokmEsFJxljJLDHKXbi41qZRjR2socQi-XyrnI6E2XRNjqcUShW1P_IE3YVBbklNjiaJ2_U2gsuKWKfeHzFjOUupyMI4svm4dld45uWbFNS3IH5J1zR1ulKsTFRlhhZAaiZCW1Mww56fptiFMkFSqLp4xYVHXlB8dRCWNLTQaB-BUF9iQwtGBaPm5tbKDMAw9Rqa78VGWlewaM6KotsyVCTPCRIYb7-14tYULKnWGGjPCqbEdd3Mj43lENK5liS7XTvb7SE4AjeKskTfCWclag52H_7_YYfzd9G5ONabUdLHuIWjNjJWFpuV3oTz7vOZa-n3x9mnjm4BdiqIKYnVRPjGsZJw6PSV2rdGsJW8tafhk6KEac9SES3lVKU9z48c0v-oMqqWihesjE6qyDQWYKLqUSKO33MVqmvgMfhoeFCXfQ_OJE0Nz3PGmKzG3v5goyH1V_UpUqG2lE68CrUU5jHeq67qhK45EaZnQhPEjW6vFjaYikyUx2E70BslKvJaidfDfxBNnVolEViJrxpZyjrx7FXhYKoWxmjI35UI6Qap95_ZG_hvXUY2plfrYo0IEwWQZjeMI4vHzWQSqSjhLn2zgJHhEYTqPL2C-iGH-ZjY7Cx4lu5Pma7KYr-LleDqPYUPUFW7h9XL6arx8D79F7-GEwng1OT0LHk3nL6J3sCEJYdkGThJ_HpxeBsF4FkfLf0aezn-NJjGs4nE8XcXTyQoefwgAAP70v91Pj9aFf9D0RhCe3R_vVLw3gg93h4197-774769RmoxI9T2RtA7DwcX_XDQDwcQDkZhOArD3p6xW9FM-JdBJRxgEO7H9jLkX3F2q1xivX2wV-Fb4D7Mqeudw_Ph4Hzo__fX2X-9cvJDruwz_HG3Dj4-vjzMyK1jZPUvRtZtjNweYGR1y8gHdjXJneXLxTKa_jxvLOtTWEYvo2U0n0SrO2qe0Hs6O5ync32UztuDdPa3jN69no2nczhZvI7PIJq_PYVVNHO2_4OXy8Ur2MLvv0TLCCp4BsPLoN_v9wO_77cBfL25-Xrz5evNF7hTCzuCp4MRfHg6hD48HX4M_g4AAP__89M9_w==

statement ok
SET enable_zigzag_join = true

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VmFv2zYT_lz9ioO_NHkRt3L8Yggc9IPrqpu31ClstWtRFAQlnWQuFMmSlGpnGNAfkV_YXzKQUhJns6wWQ_MhiJjnuTvePXfH4RDeojZMignMZHqlJU3XL54DbjBNKsYz1GDRWKgbVBAMh0A5l5-J0qioRkINkcoSxamANTVg1wgZ5rTiFmrKK5yAzHPHS6WxxKRUGPKZ2TVpUSSVnBh2jT30jLpItrwTN19dnsCrF-89uLXNhD1o-2wXbDUVhqaWSUGUZlIzu-0iCqlLyrvYnyrKmd0SmRODumZpZwAai4pT3WVII82IFLwzjtvk7OFWBkkuXbFQe0OmzwjTmPp6VKWguq0VCppwzHq5ptFFXnFOrKM0_EO8VRQ7ojWfODxzJ-cA95e5RdLKSueiCYSwUnGWMksMchduLjWplFNHpyuxj76bKmcjoTZdE2OpxRKF7Q78gTVhUFuSU2OJonb9TaSy4pYp94fMWM5S6mIwTiw-b30Za61cs-KaFuQPyYRLntibu7Y6uFEuVVRkhBVCaiRCWlIzw5ylpuCGMEFSqfqkxoRFXVN-sBeVNLbQaByBU11gowunCKLl587kjsIw9ByZth2kLCvZNWZEUW2ZyxRmhIkMN97a4YQL51TqDDVmhFNje-7musZLiWhcyxJdrL0N4D25GWgUZ82EI5yVrNPZafj_s5bj76bbVtWYUtMnvIekNTNWFpqW38XyAvRj19Lv87crG18E7BsqqiBWF-UTw0rGqRupxK41mrXknSkNn4w9VWOOmnApryrlhW58p-ZXvU61VLRwdWRCVbaRABNFX2tp9MjWV1PEZ_DTeG9v-RqaT5wYmmOrm77A3ApjoiD3WfVbUaG2lU78IOhMyn6-G7yuGrriSJSWCU0YP7C4OsxoKjJZEoPdQm-YrMRrKTob_008c7BKJLISWdO2lHPk_dvA01IpjNWUuS4X0g2k2ldup-W_cSPVmFqpD70rRBDMltE0jiCePr-IQFUJZ-mTDRwFjyjMF_EZLC5jWLy5uDgJHiXtSfM1u1ys4uV0vohhQ9QVbuH1cv5qunwPv0Xv4YjCdDU7PgkezRcvonewIQlh2QaOEn8eHJ8HwfQijpb_9Dxf_BrNYljF03i-iuezFTz-EAAA_Ol_u58BrQv_phlMIDy5P26n-GACH-4OG_zg7vvjLl4jtZgRagcTGJyGo7NhOBqGIwhHkzCchOFgB-y2NBP-cVAJRxiFu779GPIPObtVLrDBLtlP4VviLs1N1zuDp-PR6dj_76-T_3rl5Idc2Uf4424dfHx8vl-RW6fI6l-KrLsUud2jyOpWkQ9wNckd8uXlMpr_vGiQ9TEso5fRMlrMotWdNI_ovZwdz8u5Pijn7V45-1tG715fTOcLOLp8HZ9AtHh7DKvowmH_By-Xl69gC7__Ei0jqOAZjM-D4XA4DPy-3wbw9ebm682Xrzdf4G5a2Ak8HU3gw9MxDOHp-GPwdwAAAP__RVg-Aw==

statement ok
SET optimizer_use_histograms = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VmFv2zYT_lz9ioO_NHkRt3L8Yggc9IPrqpu31ClstWtRFAQlnWQuFMmSlGpnGNAfkV-YXzKQUhJns6wCQ_MhiJjnuTvePXfH4RDeozZMignMZHqlJU3Xr14CbjBNKsYz1GDRWKgbVBAMh0A5l1-J0qioRkINkcoSxamANTVg1wgZ5rTiFmrKK5yAzHPHS6WxxKRUGPKV2TVpUSSVnBh2jT30jLpItrwTN19dnsCbVx89uLXNhD1o-2wXbDUVhqaWSUGUZlIzu-0iCqlLyrvYXyrKmd0SmRODumZpZwAai4pT3WVII82IFLwzjrvk7OFWBkkuXbFQe0OmzwjTmPp6VKWguq0VCppwzHq5ptFFXnFOrKM0_EO8VRQ7ojVfOLxwJ-cAD5e5Q9LKSueiCYSwUnGWMksMchduLjWplFNHpyuxj76bKmcjoTZdE2OpxRKF7Q78kTVhUFuSU2OJonb9XaSy4pYp94fMWM5S6mIwTiw-b30Za61cs-KaFuQPyYRLntibu7Y6uFEuVVRkhBVCaiRCWlIzw5ylpuCGMEFSqfqkxoRFXVN-sBeVNLbQaByBU11gowunCKLl187kjsIw9ByZth2kLCvZNWZEUW2ZyxRmhIkMN97a4YQL51TqDDVmhFNje-7musZLiWhcyxJdrL0N4D25GWgUZ82EI5yVrNPZafj_s5bj76bbVtWYUnNQeK78j1lrZqwsNC3NgQ66D3GH6EXoR6-lfWJ_zNyVji8E9g0WVRCri_KZYSXj1I1VYtcazVryzrSGz8aeqjFHTbiUV5XyYje-W_OrXqdaKlq4WjKhKtvIgImir700emTrqynkC_hpvDezvo7mCyeG5thqpy8wt8aYKMhDVv1mVKhtpRM_DDqTsp_vhq-rhq44EqVlQhPGDyyvDjOaikyWxGC32BsmK_Fais7mfxfPHKwSiaxE1rQu5Rx5_0bwtFQKYzVlrtOFdEOp9pXbafvv3Eo1plbqQ28LEQSzZTSNI4inLy8iUFXCWfpsA0fBEwrzRXwGi8sYFu8uLk6CJ0l70nzNLhereDmdL2LYEHWFW3i7nL-ZLj_Cb9FHOKIwXc2OT4In88Wr6ANsSEJYtoGjxJ8Hx-dBML2Io-U_Pc8Xv0azGFbxNJ6v4vlsBU8_BQAAf_rf7mdA68K_awYTCE8ejttJPpjAp_vDBj-4__68i9dILWaE2sEEBqfh6GwYjobhCMLRJAwnYTjYAbtNzYR_IFTCEUbhrm8_ifxjzm6VC2ywS_aT-I64S3MT9t7g6Xh0Ovb_--vkv145-SFX9hH-uFsHn5-e71fk1imy-pci6y5FbvcosrpT5CNcTXKHfH25jOY_LxpkfQzL6HW0jBazaHUvzSP6IGfH83KuD8p5u1fO_pbRh7cX0_kCji7fxicQLd4fwyq6cNj_wevl5RvYwu-_RMsIKngB4_NgOBwOA7_ztwHc3tzc3ny7vfkG99PCTuD5aAKfno9hCM_Hn4O_AwAA__93Uj5l

statement ok
SET optimizer_use_multicol_stats = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VuFu2zYQ_l09xcF_mgxxK8fDEDjoD9dVN2-pU9hq16IoCEo6yVwokiUp1c4woA-RJ-yTDKSUxFktq8DQ_Agi5vvujnff3XE4hLeoDZNiAjOZXmlJ0_WL54AbTJOK8Qw1WDQW6gYVBMMhUM7lZ6I0KqqRUEOkskRxKmBNDdg1QoY5rbiFmvIKJyDz3PFSaSwxKRWGfGZ2TVoUSSUnhl1jDz2jLpIt78TNV5cn8OrFew9ubTNhD9o-2wVbTYWhqWVSEKWZ1Mxuu4hC6pLyLvaninJmt0TmxKCuWdoZgMai4lR3GdJIMyIF74zjNjl7uJVBkktXLNTekOkzwjSmvh5VKahua4WCJhyzXq5pdJFXnBPrKA3_EG8VxY5ozScOz9zJOcD9ZW6RtLLSuWgCIaxUnKXMEoPchZtLTSrl1NHpSuyj76bK2UioTdfEWGqxRGG7A39gTRjUluTUWKKoXX8Xqay4Zcr9ITOWs5S6GIwTi89bX8ZaK9esuKYF-Usy4ZIn9uaurQ5ulEsVFRlhhZAaiZCW1MwwZ6kpuCFMkFSqPqkxYVHXlB_sRSWNLTQaR-BUF9jowimCaPm5M7mjMAw9R6ZtBynLSnaNGVFUW-YyhRlhIsONt3Y44cI5lTpDjRnh1Nieu7mu8VIiGteyRBdrbwN4T24GGsVZM-EIZyXrdHYa_nzWcvzddNuqGlNqDgrPlf8ha82MlYWmpTnQQXuZXoV-9lpqe9jfBLsrH18M7BsuqiBWF-UTw0rGqRutxK41mrXknakNn4w9VWOOmnApryrlBW98x-ZXvU61VLRw9WRCVbaRAhNFX4tp9MjWV1PMZ_DLeG9-fC3NJ04MzbHVT19gbpUxUZD7rPrtqFDbSid-IHQmZT_fDWBXDV1xJErLhCaMH1hgHWY0FZksicFuwTdMVuK1FJ0D4E08c7BKJLISWdO-lHPk_VvB01IpjNWUuW4X0g2m2ldup_W_czPVmFqpD70vRBDMltE0jiCePr-IQFUJZ-mTDRwFjyjMF_EZLC5jWLy5uDgJHiXtSfM1u1ys4uV0vohhQ9QVbuH1cv5qunwPf0Tv4YjCdDU7PgkezRcvonewIQlh2QaOEn8eHJ8HwfQijpb_9Txf_B7NYljF03i-iuezFTz-EAAA_O1_u58BrQv_thlMIDy5P26n-WACH-4OG_zg7vvjLl4jtZgRagcTGJyGo7NhOBqGIwhHkzCchOFgB-y2NRP-kVAJRxiFu779NPIPOrtVLrDBLtlP41viLs1N2TuDp-PR6dj_75-T_3vl5Idc2Uf4424dfHx8vl-RW6fI6htF1l2K3O5RZHWryAe4muQO-fJyGc1_XTTI-hiW0ctoGS1m0epOmkf0Xs6O5-VcH5Tzdq-c_S2jd68vpvMFHF2-jk8gWrw9hlV04bA_wcvl5SvYwp-_RcsIKngG4_NgOBwOA7_3twF8vbn5evPl680XuJsWdgJPRxP48HQMQ3g6_hj8GwAA___rrj7H

statement ok
RESET reorder_joins_limit

statement ok
RESET enable_zigzag_join

statement ok
RESET optimizer_use_histograms

statement ok
RESET optimizer_use_multicol_stats

#
# Test sequences.
#

statement ok
CREATE SEQUENCE seq

query T
EXPLAIN (OPT, ENV) SELECT * FROM seq
----
https://cockroachdb.github.io/text/decode.html#eJyUVsFu20gMvfsr5ri7qAMnbptsgx68rhYIEDvd2Am6J4KWKImb0cyYM3ISf_1iRi6aApHV3ISE75Hz-Eh6PFb3JJ6t-aTmNn8Qi3n95S9FT5RvWtYFiQrkg9p1UaPReKxQa_sITsihEKAH6wI4jUbV6FWoSRVUYquD2qFu6ZOyZRlxufUBfI7GwyOHGg5RkFsNnvc0AC8wVvKse-OuVjfv1OLLvyn4wM0mHOW-eBkcBI3HPLA14IStcHjuAxorDeo-9LZFzeEZbAmeZMd5bwFCVatR-oiEsABrdG8d38V5Bdt6gtLGZpEkIj9EwkJ56kfbGJRDr8jgRlMxiPWdL8pWawgR0uGP4VbZOgKD32r1Of7lUqkfj_keiW2wMUVXCHDjNOccwJOO5ZZWoHXRHb2pzGvwl1JFjg2GvAYfMFBDJvQX_hOb8SQBSvQBHIb6l0BNqwO7-GELLjnHWIOPZkm6DSh9INlztccK_rM8NHf05KJOaArgylghMDbAjj1Hnq7bHthAbt2Qz9gEkh3qo4PorA-VkI8AjVJRZ4poBxD72Kvs6WQySRibH8bHBW54TwU4lMBRJiqATUFPie242iYmtVKQUAEafRh4WxyZ5CMQqm1DsdZB96dMcQF6p7lbb6C54d5kZ5P3FwdMepsc5lQoRz_kup9BNftgK8HmTajkvrRzA74t30vbpCbQ0EZxFQSpmhPPDWuM-xRCLeRrq3slnZxME1SoJAFt7UPrks19GtPyYTCpWIdV7CMb14bOAmyqoU0klCIPubomflYfp68updRDv9XgsaSDb4YKi_eLTQU_VE0n0ZGEVjZpC_SK8jo-bt3YDWk1gRO7wQ3rI1erh0bQFLYBT_1G75Dc0N6a3sG_W89jWGs2tjVFN7aoNenhU5BguTU-CHKccmPjQtqlzr0Y-V88RzvKg5VjPyrMaDS_zWbrTK2yf-6y5TxTrt1ozk88bdXiank_u77L1KlazL51n3-enU2n52eT6ceLD-_Pzz9cTM7V1XJ-my2y5VqdqtV6drtWp5ejUfbt6_Xsaql-u_m6fqey5f3vapVdZ_O1-kP9fXuzUJ62l6PxeDweedq2ZHIad9cs_mf0fwAAAP__CYVvLg==

#
# Test views.
#

statement ok
CREATE VIEW v AS SELECT a, b, u, v FROM x, y WHERE b = 3

query T
EXPLAIN (OPT, ENV) SELECT * FROM v
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvo6e4sA3tQc7keNhCBwUmOuqm7fUKWz1D0VBUNKRzYUmVZJS7AwDij1DLvd0eZKBlJw4q2W1GNqLIqK_7_x-55C9HrxBpZkUQxjL-EpJGi-fPwNcYxzljCeowKA2UJQoz-v1gHIur0mmMKMKCdVEZoZknApYUg1miZBgSnNuoKA8xyHINLW8WGpDdEyFJtfMLEmFIrHkRLMbbKAn1Eay4bW4yfyyCy-fv3fgyjYT5qDts12wUVRoGhsmBckUk4qZTR1RSLWivI79KaecmQ2RKdGoChbXBqBwkXOq6gwppAmRgtfGsS3OHm6ukaTSNguVM6SbjDCFsetHvhJUVb1CQSOOSSNXl7pIc86JsZSSf4g3D0JLNPoTh6f25BzgIZktkuZGWhdlIIStMs5iZohGbsNNpSJ5ZtVR60rso--WytqIqImXRBtqcIXC1Af-yJrQqAxJqTYko2b5VaRVzg3L7B8yYSmLqY1BW7G4ujVUujJywxY3dEH-kKxp7nCd2TpRkRC2EFIhEdKQgmlm7ZTd1oQJEsusSWdMGFQF5QcHMZPaLBRqS-BULbAUhZUDUfK6trJ93_cdR8bV-GSGrdgNJiSjyjBbJkwIEwmunbXD1RbWqVQJKkwIp9o05GZHxumIKFzKFdpYG9XvPNkFqDPOyvVGOFuxWmen_o9nFcflpqo5VRhT3aS6x6Ql00YuFF19E8upz-1cQ7_N365sXBOwaaNkC2LUYnWs2YpxavcpMUuFeil5bUn944GjKkxRES7lVZ45mWs3pulVo1MlM7qwfWQiy00pASYWTZtIoUNWvsomPoWfBnuXkuuh_sSJpilWumkKzN5fTCzIQ1XdlZihMrmK3BaoLcp-vt26thsq50gyJSMaMX7g1qoxo6hI5IporBd6yWQrvJGidvBfh2MLy0Ukc5GUY0s5R958FThaLIU2ijI75ULahVS4zu2M_FdeRwXGRqpDjwrheeNZMAoDCEfPLgLI8oiz-HgNbe-IwmQansH0MoTp64uLrncUVSfl1_hyOg9no8k0hDXJrnADr2aTl6PZe_g9eA9tCqP5uNP1jibT58E7WJOIsGQN7cide51zzxtdhMHsv54n09-CcQjzcBRO5uFkPIcnHzwAgD_d__ZfixYL96BpDcHvPhxXW7w1hA_3hyW-df_9cRevkBpMCDWtIbRO_f5Zz-_3_D74_aHvD32_tQO2VzQT7mWQC0vo-7u-3RpyrzizyWxgrV2y28Jb4i7Nbtd7g6eD_unA_fZX9_-mHH2XlF2E3y9r7-OT8_2K3FhF5l8osqhT5GaPIvOtIh_hCpJa5IvLWTD5ZVoiiw7MghfBLJiOg_m9NNv0Qc6W5-RcHJTzZq-cd7N8MwnebtGFGzs7aF3vKLfpeR0YzWEeXFgbtAtRF_IuFPBidvnSrbDjbXDdR58bePtrMAsggqcwOPe84N2ri9FkCu3LV2EXgumbztboD6Wt4tzr9Xo9jwmBqufeU-1YSa07Htzd_nN3-_nu9jO458bmi5P1z9V021_-tp28u72tAPfbzAzh5PSkP4QPJwPowcngo7cDSxk3qDS0jcqx4_0bAAD__-qPf3E=

#
# Test tables in user-defined schemas.
#

statement ok
CREATE SCHEMA s;
CREATE TABLE s.t (a int primary key)

query T
EXPLAIN (OPT, ENV) SELECT * FROM s.t;
----
https://cockroachdb.github.io/text/decode.html#eJyUlk9v20gPxs_Vp5hbkxdxkHe7WAQNenBdL-BdxwlstdhgsSBoiZJmM5qZcCjnz6dfzMhFXSCy2lsQ8PeQIh9yPJmoL8RBO_tezVxxzw6L5tNHRU9UbDttSmIlFETt-qgsm0wUGuMewTN5ZAIM4LyAN2hVg0FJQ6qkCjsjaoemo_fKVVXkChcEQoE2wKOWBvZRUDgDQb_QCF5irOTZDMYtNjdn6vrTXQrea2srR7UvD4OF0QYsRDsLnrVjLc9DoHXcohmiHzo0Wp7BVRCId7oYLICp7gzykBATluCsGazja3NeYbtAULk4LOIkFMZENFOR5tG1Fnk_K7K4NVSOsqH3RdUZAxKRnj_GbeZ5BCU8GPUh_udKqW8f8zUSO3ExRV8I6NYbXWiBQCaWWzmGzkd3DKayr-GHrYoaW5SigSAo1JKV4cK_U7OBWKDCIOBRmh-C2s6I9vEPV-pKFxhrCNEsqW8jnd6LvOj6BWv41-mxvaMnH_uEtgRdW8cE1gnsdNBRp592AG2hcH7MZ9oK8Q7N0UX0LkjNFCJgkGvqTRHtAOweBzv7_4uLi8S4Yr8-XnSrX6gEjyw6tolK0Lakp6R2vNs2JnVcElMJBoOMfFtcmeQjYGpcS7HWUfenTPEABm90f97A6FYPJvvl4tfLPZO-jfd7ylRgGHPd91Cjg7iasf0pKrkv3VzBn8t3aJs0BBq7KL4G4bo9D7rVBuM9BWmYQuPMYEsvzt8llKkiBuPcfeeTzUNa0-p-NCk7j3Wco7a-k94C2tZjl4gpRe5z9UP8oH579-pRSjMMDwYCVrT3zVhh8f3StoZvXU1PoieWjrfpCgw25XU-Xt04De4MgWe3xa02R16tARlGW7oWAg0bvSd1Sy_ODi7-53wWwzq7dZ0t-7VFY8iMPwUJK5wNwqjjllsXD9IuTe5g5X_wOdpRIY6P_aiwWTZbz6f5XOXTj8u5CueiTrI3qBar_FKtbnK1-rxcnmVvZjerTb6eLla5EvD39Kxu14vr6fpO_Tm_UyeoppvZaXZ6lWXTZT5fH8gtVn_MZ7na5NN8sckXs416-_c_b6-ybP7X7XK6WKmTm9v8TM1XX07VZr6Msf9Tv69vriN9lU0mk0mWzpxk_wUAAP__8aVx1g==

#
# Test default_transaction_quality_of_service settings.
#

statement ok
SET default_transaction_quality_of_service=background

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVsFu20gMvfsr5pgAceFsF4uiRQ7dNocC3bZA0mD3RNASJXEzGk44lJP41I_IF-ZLihm5aApYVnMzDL5HzuMjqeXSXZEmlvDavZPqWgWr7v3fju6oWg_sa1JnlMxtxqjFYrl06L3cQlSKqASYQKJB9Bhch8lZR66mBgdvboN-oNdOmibjKkkGqcKQ4Jatg10UVOIh8ZZm4DXmSu79ZNyHi88n7p_3_5XgHTcHO8j96mmwKYaElbEEiMqibPdTwCDao19cnF_uhd8M6NnuQRpIpBuuyJ25NVbXrcoQ6jfO_cz7g1KpHTzqVEVKWIMEP1nSD532YIdE0EjuG2khSnMkrFSV1gx9QN21jQKuPdWz2DRapBm8B8uQEX8IV4TkZOnGu7P8z16JcDDJKcZCgPvouWKDRD6X24jCELNRJlOFffCnUmWONVrVQTI06inYdOG_sIVEatBgMoho3W-B-sEbx_xDam64wlxDyrYpus0ovSPZcrvFFv4XnhtBuotZJww1cBtECYIYbDhx5hm7nYADVBLnfMbBSDfoD85klGStUsoAj9rSaIpsB1C5nVT2dLVaFYxUu0GKxj1vqYaIapxloho41HRX2A6rHXJS0ZqUavCYbOZteWSKj0Cpk55yrbPuL5nyLkzR87jpwHPPk8n-WP35aocpb9PdnCpVmOZc9yuo42TSKvbPQhX3lfVr-Lx8T21TmkBzGyW2YNr2LxL37DGvVrBOKXXiJyVdvXhZoEoNKXiR6yEWm6cyps31bFKViG3uI4c42GgBDu3cJlIqkbtcYxPP3F8v9y6l0sN04yFhQzvfzBWWTxmHFn6qWq5jJLVB12ULTIqyH5-3bu6GDp4gqqxxzf7AAZugUQy19JBo2ugjknvaSpgc_K-X73LYENb53o1ji96Tnz8FBVZJSKbIecqD5IW0KZ17MvK_eY42VJnooe-LsFic__vl49sPn9zR5y-XJ-7809Wxu3r78ev5hTs6PX6zWC6Xy0UJTwv3-PDw-PDt8eGbOzo9OV58DwAA__-3Blsr

statement ok
SET default_transaction_quality_of_service=critical

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVsFu20gMvfsr5pgAceFsF4uiRQ7dNocC3bZA0mD3RNASJXEzGk44lJP41I_IF-ZLihm5aApYVnMLAr5H6vHxjZdLd0WaWMJr906qaxWsuvd_O7qjaj2wr0mdUTK3GasWi-XSofdyC1EpohJgAokG0WNwHSZnHbmaGhy8uQ36gV47aZqMqyQZpApDglu2DnZVUImHxFuagdeYJ7n3k3UfLj6fuH_e_1eKd9wc7CD3q6fFphgSVsYSICqLst1PAYNoj35xcX65F34zoGe7B2kgkW64InfmKmXjCv0b5352_UGo1A4edWoeJaxBgp8c6IdKe7BDImgkb420EKU5ElaqymKGPqDulkYB157qWWwaDdIM3oNlyIg_hCsycrJ0491Z_s9eiXAwyS3GQYD76Llig0Q-j9uIwhCzTSZbhX3wp1JljjVa1UEyNOop2PTgv7CFRGrQYDKIaN1vgfrBG8f8h9TccIV5hpRNU3SbUXpHsuV2iy38Lzx3gHQXs04YauA2iBIEMdhw4swzbjsBB6gkzvmMg5Fu0B-8yCjJWqWUAR61pdEU2Q6gcjup7OlqtSoYqXZnFI173lINEdU4y0Q1cKjprrAdVjvkpqI1KdXgMdnMt-WTKT4CpU56yrPOur90ykmYoucx58Bzz5PN_lj9-WqHKd-muztVqjDNue5XUMfJpFXsn4Uq7ivha_i8fk9tU5ZAc4kSWzBt-xeJe_aYgxWsU0qd-ElJVy9eFqhSQwpe5HqIxeapnGlzPdtUJWKb98ghDjZagEM7l0RKpXLXa1zimfvr5d5QKjtMNx4SNrTzzdxg-SHj0MJPVcvbGElt0HVJgUlR9uNz6uZt6OAJosoa1-wPPF8TNIqhlh4STRt9RHJPWwmTh__18l0uG8JahlCPZ4vek59_CgqskpBMkfOVB8mBtCmbe3Lyv_kcbagy0UO_LsJicf7vl49vP3xyR5-_XJ64809Xx-7q7cev5xfu6PT4zWK5XC4XpTwt3OPDw-PDt8eHb-7o9OR48T0AAP__KYlaVg==

#
# Test recursive table references from foreign keys.
#

statement ok
CREATE TABLE z (
  pk INT PRIMARY KEY,
  ref INT,
  CONSTRAINT fk FOREIGN KEY (ref) REFERENCES y(u),
  FAMILY "primary" (pk, ref)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM z;
----
https://cockroachdb.github.io/text/decode.html#eJy0VlFv2zYQfq5-BeGXJkNcyMkwBA764Lrq4C21C1stWhQFQUknmTNFskdKsT3svw-knMRZJavF0DwEEXPf3X133x05HJIPgIYrOSZTlW5QsXT9-hWBLaRJxUUGSCwYS-rGKgiGQ8KEUHdUI2iGQJmhSluqBZNkzQyxayAZ5KwSltRMVDAmKs8dLlXGUpMyaegdt2t6sKKpEtTwPfTAM-Yy2YlOu9lqcUHevv7kjQ--ubQnfV8fG1tk0rDUciWpRq6Q210XUCosmQhWUdwK_1oxwe2OqpwawJqnQF6SFLnlKRM3hDxGvXeIUFSCYVc-CCyjSorOhO6r1IKtDNBcua4BekemzwlHSH1jqlIyPDQNJEsEZL1Y0wgkr4Sg1kEa_CmcLyM31nwV5KU7aS0Rq6xyIZpEKC-14Cm31IBw6eYKaaWdTDpDyTb4camcj4TZdE2NZRZKkLY78SfepAG0NGfGUs3s-rtAZSUs1-4PlfGcp8zlYJxofN16Kn1wsufFnhX0L8X7BhC22tWJyYzyQioEKpWlNTfc-Wm6bSiXNFW6T2dcWsCaiZMTqZWxBYJxAMGwgEYUTg4U1V1nZUdhGHqMSg9jpC0v-R4yqhla7soEGeUyg633drra0gVVmAFCRgUztoebGxmvI4qwViW4XHvV7yO5TWi04M2eo4KXvDPYZfjr9QHjueFhThFSZvpU9xS05saqAln5QyivPr98LfuxeMey8U2Avo2iC2qxKF8YXnLB3GKldo1g1kp0ljR8ceWhCDkgFUptKu1lbvyY5pveoKg0K1wfudSVbSTAZdG3iRC85SFW08SX5Ler1qXke2i-CmpYDgfd9CXmLjIuC_pYVX83akBbYeK3QGdR2vFu67puYCWAalQJS7g4cX11uEEmM1VSA91Cb5C8hL2SnYP_Pp46s0omqpJZM7ZMCBD9V4GHpUoai4y7KZfKLaTad-5o5L_zOqohtQpPvS5kEEyX0SSOSDx5dRsRXSWCpy-25Cx4xshsHl-T-SIm8_e3txfBs-Rw0nxNF_NVvJzM5jHZUr2BHXm3nL2dLD-RP6NP5IyRyWp6fhE8m81fRx_JliaUZ1tylvjz4PwmCCa3cbT8b-TZ_I9oGpNVPIlnq3g2XZHnnwNCCPnb_3Y_A1YX_mUzGJPw4vH4sMUHY_L54bCxHzx8fzm2R2AWMsrsYEwGl-HoehiOhuGIhKNxGI7DcHBk7K5oLv3LoJIOMAqPY_s15J9zdqddYoNjsN_C98BjmNuuDw4vr0aXV_5__1z8X8rJT6HsM_x5rIMvz2_aFblziqy-UWTdpchdiyKre0U-satp7izfLJbR7Pd5Y1mfk2X0JlpG82m0epDmGXuUs8N5Odcn5bxrlXMny71jqTff0ETIu4juW4jqTQvTfPOUI0LexnJ3VnWy2XeziT6-u53M5uRs8S6-INH8wzlZRbfO9hfyZrl4S_Y3wXA4HAb-xbIP_g0AAP__JiJogw==

# A foreign key cycle shouldn't cause infinite recursion.
statement ok
ALTER TABLE y ADD CONSTRAINT fk FOREIGN KEY (v) REFERENCES z (pk);

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt9v2zYQfq7-ioNf6gxxISfDEDjog-uqg7fULmy1aFEUBC2dZM4UyZKUannY_z6QchpnlawWQ_MQRMx99-O7744cjeAdasOkmMBMJjstabJ9-QJwj8mmZDxFDRaNhaqxCoLRCCjn8gtRGhXVSKghUlmiOBWwpQbsFiHFjJbcQkV5iROQWeZwiTSWmIQKQ74wuyVHK5JITgw7YA88pS6TmnfazdfLS3j98oM3Pvpmwp71fXNqbDUVhiaWSUGUZlIzW3cBhdQF5cE6ilvhn0vKma2JzIhBXbEE4TkkmlmWUH4L8BD13qHGvORUd-WjkaZECt6Z0D1LLdjSIMmk6xpq78j0OWEaE9-YshBUH5uGgm44pr1Y0wgkKzkn1kEa_Dmcp5EZaz5zeO5OWimipZUuRJMIYYXiLGGWGOQu3UxqUionk85Qog1-SpXzsaE22RJjqcUChe1O_JE3YVBbklFjiaJ2-12gouSWKfeHTFnGEupyME40nrcepo9ODiw_0Jz8JVnfAOJeOZ6oSAnLhdRIhLSkYoY5P023DWGCJFL16YwJi7qi_OxEKmlsrtE4AKc6x0YUTg5Eyy-dzI7DMPQYmRzHSFlWsAOmRFFtmaMJU8JEinvv7TzbwgWVOkWNKeHU2J7a3Mh4HRGNW1mgy7VX_T6S24RGcdbsOcJZwTqDXYW_3hwxvjZ9nFONCTV9qnsM2jJjZa5p8UMorz6_fC39sXinsvFNwL6NonJidV48M6xgnLrFSuxWo9lK3klp-OzaQzVmqAmXclcqL3PjxzTb9QbVUtHc9ZEJVdpGAkzkfZtIo7c8xmqa-Bx-u25dSr6H5jMnhmZ41E1fYu4iYyInD6z6u1GhtqXe-C3QSUo73m1d1w1dciRKyw3dMH7m-upwo6lIZUEMdgu9QbICD1J0Dv7beObMSrGRpUibsaWcI--_CjwskcJYTZmbciHdQqp8505G_juvowoTK_W514UIgtkqmsYRxNMXdxGocsNZ8mwPw-AJhfkivoHFMobF27u7y-DJ5njSfM2Wi3W8ms4XMeyJ2mENb1bz19PVB_gz-gBDCtP17OIyeDJfvIzew55sCEv3MNz48-DiNgimd3G0-m_k-eKPaBbDOp7G83U8n63h6ccAAOBv_9v9DGiV-5fNYALh5cPxcYsPJvDx62FjP_j6_enUXiO1mBJqBxMYXIXjm1E4HoVjCMeTMJyE4eDE2F3RTPiXQSkcYByexvZryD_nbK1cYoNTsN_C98BTmNuuXx1eXY-vrv3__rn8vyVvfkrJPsOfV3Xw6eltuyIPTpFq940kNWZdojy0iFLt7lV5Ypjt4NVyFc1_XzRGGrMLWEWvolW0mEXr-xTqYdkp20OrbDurqV015TfFVF2l1C2llC2V1KQimbN8VE_VVs1-SHtoaIUdhmr3MNQunh_q6uxQ193sRO_f3E3nCxgu38SXEC3eXcA6unO2v8Cr1fI11LfBaDQaBf6lUwf_BgAA__8ZsXhF

# Check that we remove histograms from statistics correctly.

statement ok
CREATE TABLE b (
  b BOOL NOT NULL,
  INDEX (b)
)

statement ok
ALTER TABLE b INJECT STATISTICS '[
      {
          "avg_size": 1,
          "columns": [
              "b"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 2,
          "histo_buckets": [
              {
                  "distinct_range": 0,
                  "num_eq": 1000,
                  "num_range": 0,
                  "upper_bound": "false"
              },
              {
                  "distinct_range": 0,
                  "num_eq": 100,
                  "num_range": 0,
                  "upper_bound": "true"
              }
          ],
          "histo_col_type": "BOOL",
          "histo_version": 2,
          "name": "__auto__",
          "null_count": 0,
          "row_count": 1100
      },
      {
          "avg_size": 0,
          "columns": [
              "rowid"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 0,
          "histo_col_type": "",
          "name": "__auto__",
          "null_count": 0,
          "row_count": 0
      }
]'

query T
EXPLAIN (OPT, ENV) SELECT * FROM b
----
https://cockroachdb.github.io/text/decode.html#eJy8Vk9vG7kPPXc-BeFL0x_iwHH6200d9OA6LuBd1y7iadGiKAjNDD3mRiMpksb5s9jvvpDstO7C40kPuzkEicRHch4fSXW78JGsY60GMNL5tdUiX12-AbqjPKtZFmTBk_Ow3lglSbcLQkp9i8aSEZZQONTGo5FCwUo48CuCgpailh7WQtY0AL1cBlyunUeXC-Xwlv0Kt1aYa4mOH6gFXoiQyb1stJss5sfw7vJzNN76ZuUP-j7fNfZWKCdyz1qhsawt-_smoNK2EjJZjNO98JtaSPb3qJfoyK45J3gNuWXPuZAXAN-jPjq0VNZS2KZ8LIkCtZKNCT2ytAdbO8KlDlUjGx25NidsKY-FqSsl7LZopEQmqWjFuo1AlrWU6ANkgz-EizSy8-5GwutwspciUXsdQmwSQa6M5Jw9OpIh3aW2WJsgk8ZQah98l6rgIxM-X6HzwlNFyjcn_oM35ch6XArn0Qi_ehKoqqVnE_7QBS85FyEHF0QTeWtheuvkgcsHUeIfmtsakO5M4EmoArlU2hIq7XHNjoOfTbUdssJcmzadsfJk10Ie7EijnS8tuQCQwpa0EUWQA1p928jsaa_Xixidb9vIeK74gQo0wnoONFGBrAq6i94Os61CUG0LslSgFM63fFtomagjtLTSFYVcW9UfI4VJ6IzkzZxDyRU3Buv3Xp5vMfHb7LZPLeXCtanuR9CKndelFdVPoaL64vD14ufi7comFoHaJoop0duyOnFcsRRhsKJfWXIrLRsp7Z2cRailJVmUWl_XJsrcxTZdXrcGtdqIMtSRlan9RgKsyrZJZClabmNtivgafjnbO5RiDd2NRCeWtNVNW2JhkbEq8TurcTcasr62WZwCjaTsx4epG6pha0lorM5ExvLA-mpwY4UqdIWOmoW-QXJFD1o1Nv6HdBTMapXpWhWbthVSkmxfBRGWa-W8FRy6XOkwkNaxcjst_8R1tKbca3vodaGSZHQ1HqZjSIdvpmMwdSY5P8ngKHmWwZv5fAqzeQqzD9PpcfLM6lsuYDJLz-Ppx8liEkCPFnA5fjv8ME2hVnxTx8nBxdGL4-TZaD5bpFfDySyFDM013cP7q8m74dVn-H38GY42foeLUbCdzC7HnyDDDLm4g6MsnicvLpJkOE3HV_9MdDL7bTxKYZEO08kinYwW8PxLAgDwZ_wdfjpiXcaHUGcAp8ffj7dDvzOAL98O40XW-fb_1117S8JTgcJ3BtDp9_r97mm_2-vD6fng7OWg_-rk_7--fHXW7-xgwmJnFd8TtQq4_s5lHF3xCejvTciuswtVoopniGH3I_5wF6b6o8vezkWY1o_np6e9Xrz56_gAI72nMBIr9C-y0vvvWNlSknx9fpEk40_vp8PJDI7m79NjGM8-voDFeBoE9T94ezV_B9lF0u12u0lctFnydwAAAP__D4kP0Q==
