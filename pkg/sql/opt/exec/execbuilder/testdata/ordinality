# tests adapted from logictest -- ordinality

exec
SELECT ordinality FROM (VALUES ('a'), ('b')) WITH ORDINALITY
----
ordinality:int
1
2

exec-raw
CREATE TABLE foo (x CHAR PRIMARY KEY); INSERT INTO foo(x) VALUES ('a'), ('b')
----

exec
SELECT * FROM foo WITH ORDINALITY
----
x:string  ordinality:int
a         1
b         2

exec
SELECT * FROM foo WITH ORDINALITY LIMIT 1
----
x:string  ordinality:int
a         1

exec
EXPLAIN (VERBOSE) SELECT MAX(ordinality) FROM foo WITH ORDINALITY
----
Tree:string           Level:int  Type:string  Field:string  Description:string  Columns:string     Ordering:string
group                 0          group        ·             ·                   (column3)          ·
 │                    0          ·            aggregate 0   max(ordinality)     ·                  ·
 └── render           1          render       ·             ·                   ("ordinality")     ·
      │               1          ·            render 0      "ordinality"        ·                  ·
      └── ordinality  2          ordinality   ·             ·                   (x, "ordinality")  ·
           └── scan   3          scan         ·             ·                   (x)                ·
·                     3          ·            table         foo@primary         ·                  ·
·                     3          ·            spans         ALL                 ·                  ·

exec
SELECT * FROM foo WITH ORDINALITY AS a, foo WITH ORDINALITY AS b
----
x:string  ordinality:int  x:string  ordinality:int
a         1               a         1
a         1               b         2
b         2               a         1
b         2               b         2

exec
EXPLAIN (VERBOSE) SELECT * FROM foo WITH ORDINALITY WHERE ordinality > 1 ORDER BY ordinality
----
Tree:string      Level:int  Type:string  Field:string  Description:string  Columns:string     Ordering:string
filter           0          filter       ·             ·                   (x, "ordinality")  ·
 │               0          ·            filter        "ordinality" > 1    ·                  ·
 └── ordinality  1          ordinality   ·             ·                   (x, "ordinality")  ·
      └── scan   2          scan         ·             ·                   (x)                ·
·                2          ·            table         foo@primary         ·                  ·
·                2          ·            spans         ALL                 ·                  ·

exec
EXPLAIN (VERBOSE) SELECT * FROM foo WITH ORDINALITY WHERE ordinality > 1 ORDER BY ordinality DESC
----
Tree:string           Level:int  Type:string  Field:string  Description:string  Columns:string     Ordering:string
sort                  0          sort         ·             ·                   (x, "ordinality")  -"ordinality"
 │                    0          ·            order         -"ordinality"       ·                  ·
 └── filter           1          filter       ·             ·                   (x, "ordinality")  ·
      │               1          ·            filter        "ordinality" > 1    ·                  ·
      └── ordinality  2          ordinality   ·             ·                   (x, "ordinality")  ·
           └── scan   3          scan         ·             ·                   (x)                ·
·                     3          ·            table         foo@primary         ·                  ·
·                     3          ·            spans         ALL                 ·                  ·
