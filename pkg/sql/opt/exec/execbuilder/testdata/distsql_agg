# LogicTest: 5node

statement ok
CREATE TABLE data (a INT, b INT, c FLOAT, d DECIMAL, _bool BOOL, _bytes BYTES, _bit BIT, PRIMARY KEY (a, b, c, d))

# Split into ten parts.
statement ok
ALTER TABLE data SPLIT AT SELECT i FROM generate_series(1, 9) AS g(i)

# Relocate the ten parts to the five nodes.
statement ok
ALTER TABLE data EXPERIMENTAL_RELOCATE
  SELECT ARRAY[i%5+1], i FROM generate_series(0, 9) AS g(i)

# Verify data placement.
query TTTI colnames,rowsort
SELECT start_key, end_key, replicas, lease_holder FROM [SHOW RANGES FROM TABLE data WITH DETAILS]
ORDER BY 1
----
start_key           end_key       replicas  lease_holder
<before:/Table/62>  …/1/1         {1}       1
…/1/1               …/1/2         {2}       2
…/1/2               …/1/3         {3}       3
…/1/3               …/1/4         {4}       4
…/1/4               …/1/5         {5}       5
…/1/5               …/1/6         {1}       1
…/1/6               …/1/7         {2}       2
…/1/7               …/1/8         {3}       3
…/1/8               …/1/9         {4}       4
…/1/9               <after:/Max>  {5}       5

# Verify that all aggregate functions that we expect to have multi-stage
# execution do, in fact, get planned with 2 stages.
query T
EXPLAIN (DISTSQL) SELECT
  b, -- any_not_null
  avg(a),
  bool_and(_bool),
  bool_or(_bool),
  count(a),
  max(a),
  min(a),
  stddev(a),
  stddev_samp(a),
  stddev_pop(a),
  sum(a),
  sum_int(a),
  variance(a),
  var_samp(a),
  var_pop(a),
  xor_agg(_bytes),
  count(*), -- count_rows
  bit_and(_bit),
  bit_or(_bit),
  covar_pop(a, b),
  regr_sxx(a, b),
  regr_sxy(a, b),
  regr_syy(a, b),
  regr_avgx(a, b),
  regr_avgy(a, b),
  regr_intercept(a, b),
  regr_r2(a, b),
  regr_slope(a, b),
  regr_count(a, b),
  covar_samp(a, b),
  corr(a, b),
  sqrdiff(a)
FROM data GROUP BY b
----
distribution: full
vectorized: true
·
• group (hash)
│ group by: b
│
└── • scan
      missing stats
      table: data@data_pkey
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzsWU1v4jwX3b-_wvKKvjICOwlfq2QKRZEgYQLt0-pRFRni0mggYZLQaVX1vz9ygJAPyGDaXVkM8b2xT06uj8-Npu8w_L2AHdi7Hw003QCVrj6ejH8OrsC4N-hdT8AUAfoyr9ArBKa-v7Cp51RsPtol_CCJZ_7ai-KpS_q6ubpefA0jx2EvqaEd0uUqHa_8bbhe7q62u0V7oYFLvRnbBfvFPNitfPUDm87nFXv6FrEwofN_TtSNtsTdaBvGtONo5icoCEyvEAjYPLDD19dc_JaN37IxfZm_5hPZGa4XsWDGVlEmG5As7MJfsUxmW9RNZsN18_q7TBDsxuHvwHGfnir0CtxY5hA4NKKgb5m3I_DjAUwhgp7vMIMuWQg7_0IMESQQQQkiKEMEFfiI4CrwZywM_YBPeY8X6M4r7NQRdL3VOuLpRwRnfsBg5x1GbrRgsAMndLpgFqMOC2p1iKDDIuou4sdwFir_sVe_2BtE8NpfrJde2AGcNgKxeviFbxu_uhFEcLyifEq1hgH1HICBHz2zAD5-IOivoz2RMKJzBjs4xVzvwk79A51OXpvPAzankR_UlCx3lddHMx5sw5zYxu1gUFHJFWd3O6yomI-uzVtjsh3_MM2BrRndiioloWlto3iibZn_jCs8HGr321VD3diOxj-trn5zs4tuh7aeYN-blq31-xVVjqH1yeZByi7iz4mDiaUZY32im4Zt9fpWbzzmQ63ft3p9bdKrqBjxd8gWcl-L6Rt4puFzrgwYPn7si01yxVaOFnuPu_b8wGEBczLIMWrJduB6gUh-P3CyHyRTNSm7I3JmR5TM1EayIc1kQ1p8dKMb2sAeT7rd3l1FbSOVoA1u-oY9MkeZm_uNq-_n3mmWrhnXvQMwd5pVwEi2G-PMfmOS3nCcQrk2Exws79NcA_b4_v5g9uFQ9uFQVrvrH4LQ7vqHZuvGpGdd90aTA_cscuihA3PUy-Y37zPWhqN83rKymeTYpOpnMc9hQQeoGAGV1FQJAVVGQFUQUBsIqE0E1BYCanv7D9f5PD7gCzBJfvhCLG9XYb4cxyMOgDkC5stJvDx-Fl9F-CrCV5HdA0n8w1eR1lEXk3IHCx-3sbNOluFX_VUNK7mZh8nIeTLZY45Pbwj4CxtCDVdr5KyWgEXopzyocWkJ4i2hcbTYn24J-NISLi3h-7aErI2R012YfKULk2pNOsuFiQj91LFvXlxY3IWbR4v9aRcmFxe-uPD3deGsjUmnu7D0lS4sVWvyWS4sidBPHfvWxYXFXbh1tNifdmHp4sIXF_6-Lpy1Mfl0F5a_0oXlak05y4VlEfqpY9--uLC4C7ePFvvTLixfXPjiwt_XhWWRv7VZLFz5XshO-i_oeu5RVcyPInPmbHNuQ38dzNgo8Gfx3E1oxkBxwmFhtLmLN4Hu7W6FUcDoMvlTYRoJ55FwGolkkHAaSRFDahxHwoKk2iVQgqxwyQsSQVpYKcEq8CKlOygdh5IKtKRyMTQE1CCXQinHkXAeSTlXVw0xpDJdCZIq05Ugq1JdCdIq1VWBV-NsXRVoNUuhWsfFQPJIrXPF0BRDKhODIKkyMQiyKhWDIK1SMRR4tc8WQ4EW_kvLKek5UgHr7KbTEoQqE4QorTJFiPIqlYQosVJNFJmd33mKxP7SeuTjopALWIXec6oo2oJQZaIQpVUmClFepaIQJVYqiiKzQgs6WRQy_0p9Wvh_bNeBHego0yltNGl1ppB2VSbNdnXKKKs2n5ozhWA2bTX55_DTgs5D_qk8fvb_xLiTtxX_0H2ii5AhOKS_WJdFLFi6nhtG7mx75-Pjf_8FAAD__y4VEho=


statement ok
ALTER TABLE data DROP COLUMN _bool;
ALTER TABLE data DROP COLUMN _bytes;
ALTER TABLE data DROP COLUMN _bit;

query T
EXPLAIN (DISTSQL) SELECT sum(a) FROM data
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • scan
      missing stats
      table: data@data_pkey
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJykld1umzAYhs93Feg7aiUjsHFIwlGrtpMi9W9NJk2aosrFX1JUgjPbqKuq3PsE2VZgAwVyEgVM3vfJ4x_ewfxIIYKrb_fX57Nb5-RyNl_Mv1yfOvOr66uLhWPyzYk4dT4_3N04UlgBBDIl8VZs0ED0HSgQYEAgAAIcCIxgSWCrVYzGKF088l7-YCZ_QuQTSLJtbovbSwKx0gjRO9jEpggRLMRTig8oJGrPBwISrUjSsqaoPis-Hrcv-AYELlSabzITOQXRfCuKr65HHZFJhzrKPqOG5Y6Ayu1HobFijRDRCuHsEiJ_Rw6HPF-vNa6FVdob1RnnX29Ozuhpay1r1I5aaz_a8kxpiRplrWq56wajfj-yoEFG60bo4dNGB0ybR12PDZo42gez4ic8buLCWi073A4bYoe5XjDIDuuDWbEzPs7OuFYbHG4nGGIncD0-yE7QB7NiZ3KcnUmtlh9uhw-xw11vNMgO74NZsTM9zs60z0n8gGarMoONo_H_TX6jyaXFGYpyjfsD16hcx3ivVVw-u7-8K4PKGxKN3Y_S_cUs-zNkrEax-fsiqSbRziRWS6LVpFEziXUz9YEKOqN4exJtJvGhfy9sJo06k8J2JtZMCocyjZtJ486kSTtT0EyaDGWaNJOm3cvAb4fi_6zN7mXeQTUtts4qVa-PiYQI_NBnYx6jy8NYuJxNQ_dpwlduuOLsicWS03FxaK5SsTbF_p0_q9cydvG2LXbfSqQGCdyIF7xEi3qTZImxSfx7ZLf79CsAAP__o2F0nA==

query T
EXPLAIN (DISTSQL) SELECT sum((a-1)*1000 + (b-1)*100 + (c::INT-1)*10 + (d-1)) FROM data
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • render
    │
    └── • scan
          missing stats
          table: data@data_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzUVl1v4jgUfd9fYd0naB0lTsJXnqgKK0WCtgustNIKVW58oVFDzNhBnariv4-STKdJZohI8wQPCN9rzjk551rOO-hvEXgw_e9hduPfkc7EX66W_8y6ZDmdTW9XRB92nfTDiUFYl1wRZllWl1yTTuepUOrmpcDz_LvV8LOR10VW6JK_F_dzInjCgUIsBd7xHWrw_gcGFGyg4AAFFyj0YE1hr2SAWkuVbnnP_uCL7-BZFMJ4f0jS8ppCIBWC9w5JmEQIHqz4U4QL5AKVaQEFgQkPo4wmpR6nX4_7F3wDCrcyOuxi7RFOyRMlASUCKCz3PK0ZJiM8FoQRmTyjAgoLjAUqj6SGjJnBvPxxu1epKR-L605nbJd7H7-znpMvSjsKG8Zu1plMb_35zawL6yMFeUg-n1cnfIvgsYJB_gQ860jP9-hmu1W45YlUZq9s0fLfeWfMTtPaFdreSdpPtkMslUCFokS1PtYLY1YzZU5FGSs7ws6fGtZmakxmmPYFzQ1r4lIhnn67uemXaO3zw7FbhWMbpnNB4dhNXCqEM2gXzqBE65wfjtMqHMcw3QsKx2niUiGcYbtwhiVa9_xw3FbhuIbZu6Bw3CYuFcIZtQtn1OQWXqDey1hj5Vr8M5NVYTJYen-i2GJ-2Wp5UAE-KBlke_PlfQaUFQTqJO-yfOHHHy2dKOS7Xy8RRSRWi2SXkFgRqVdFsus1NRHl1EK5p5FYFcn96uP1q0i9WqT-aU12Fan_VU2DKtKgFml4WpNTRRp-VdOwijSqHwPrtCj3t9msH_MaVaP06Gwi-foYCvBgM2QBw83A4LwvDJePLGPUt4QhHM7RxtGGY_q2s4n4Vqfnd_ksXzPY1ds-PX0bHmmkMOcvOMEE1S6MQ52Ewc_O8fjXjwAAAP__vroT0w==

query T
EXPLAIN (DISTSQL) SELECT sum(a), count(a), max(a) FROM data
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • scan
      missing stats
      table: data@data_pkey
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0lV9ro0wUh-_fTyHnKoERM2r8d9XS9oVAk3RjyhaWEKbOaSo1TtYZaUvJd180u626qyRCboLjmN95fGbm-AHyZwIB3Dzc3V5OZtrgehIuw2-3Qy28ub25Wmoy3w7YkGiRyFNVXm3Z24ANtf8X86nGmWJAIBUcZ2yLEoIfQIGACQQsIGADgTGsCOwyEaGUIise-Sj_MOFvEIwIxOkuV8XtFYFIZAjBB6hYJQgBLNljggtkHDNjBAQ4KhYnZZmi9EXxs9694DsQuBJJvk1loBVE4Y4Vl7pBNZZyjWpCPWMGqz0BkauvglKxDUJAK4STawhGe3I85OVmk-GGKZEZ4zpjeD8dXNBhATe_ny3Xi_n3cFAMp5cP5UQbj9ngGbfyfGHkqcg4ZshrDKt9NzEdtSGH99P1ZLYcXJifxFY7sdUgpnWF9Ph1pj3W2aC6YfZaaXoKZsWbc6aVdmo85vHazD7aTN2wemkzT8GsaHPPpM2t8VjHa7P6aLN0w-6lzToFs6LNO5M2r8ZjH6_N7qPN1o1xL232KZgVbf6ZtPmnfB4WKHcildhoy_-uNGpU0mnRv5Fv8NDspcizCO8yEZXPHobzMqi8wVGqwyw9DCbpnympMmTbz69bNYl2Jpm1JFpNGjeTzG6mU6Cszii7PYk2k-y-r-c0k8adSU47k9lMcvoyuc0ktzPJa2eymkleXyavmeR3b4NRO5T9197s3uYdVH5xdJ4S8bqOOQTgoMMdizo68znXbccb6_6j6-ouczzqWT6PvKJfPCVsI4vzGz6L1zJ2-b4rTt8TSyQSmLIXvEaF2TZOY6ni6PfMfv_frwAAAP___Cudxg==

query T
EXPLAIN (DISTSQL) SELECT sum(a+b), count(a+b), max(a+b) FROM data
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • render
    │
    └── • scan
          missing stats
          table: data@data_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0lt9u2jAUh-_3FNa5oqqjYCfhT66o2k5CKtARqlWaEDLxgaKGmNlGbVXx7lOgayFbIkBwgzix-fnjs83hHczvBEK4fby_u2p3SeWmHQ2iH3cXJLq9u70eELOcVwS5JOMLSmK1TO1nNRevH-_J936vQ6SwAiikSmJXzNFA-AsYUOBAwQMKPlAIYEhhoVWMxiidTXlff6AtXyGsUpili6XNHg8pxEojhO9gZzZBCGEgxgn2UUjUbhUoSLRilqyXyZZuZS-jxTO-AYVrlSznqQmJoGQMFKKFyCrHZUSkkjCi7BNqoNDHVKIOSYtdtjgMVxTU0n4xGCumCCHbgm7fQFhd0f25r6ZTjVNhlXaDXezooVNpsYuMt_fQHYz6vZ9RJSs7V4_rgSIenuMJCnm-MJap0hI1yh2G4aqcmFWLkKOHzqjdHVRa_JPYKyb2csRsVyHbf-vZcVvvMsflJ9l8dgj5lsramTa_tsPD9zfJjzTJHdc7iUl-CPmWyfqZTNZ3eLz9TXpHmvQc1z-JSe8Q8i2TjTOZbOzw-Pub9I806TtucBKT_iHkWyabZzLZPKTV9NEsVGow9xP__5WquZUclvUClFPcNA6jljrGe63i9dxN2VsHrR9INHYzyjZFO_07ZKxGMf_slNtJrDSJ7ySx7aQgn8TLmQ6B8kqj_OIklk_yj_16tXxSUJpUK2bi-aTasUz1fFK9NKlRzOTlkxrHMjXySc3yY1AthvL_OZvlx7yEqpldnUmiXkYzCSGM5SQOpJBO0JSe4zPuO01R951GEIxZXOPN8Tj7NzBJxNRk9zd6Ui_r2MHbIrt9E5EYpNARz3iDFvV8ls6MncUfI6vVtz8BAAD__z4buUY=

query T
EXPLAIN (DISTSQL) SELECT sum((a-1)*1000) + sum((b-1)*100) + sum((c::INT-1)*10) + sum(d-1) FROM data
----
distribution: full
vectorized: true
·
• render
│
└── • group (scalar)
    │
    └── • render
        │
        └── • scan
              missing stats
              table: data@data_pkey
              spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzMlt9vqkgUx9_3r5icJ6hDYBhE5ImmuomJtl11k002phmdU2uK4DKYbtP4v9-AvQrcK_FHTHwxwzn4nc853zMZvkD9F4IP3X-e-_e9R6J1eqPx6K--TkbdfvdhTDRNrZeaJohBmE7uCLMsSycNkkenhai-i858v_c49va5XUpuY38OnwZEilQAhSiW-CiWqMD_FxhQsIECBwoOUGjChMIqiWeoVJxkr3zlf-jJ_8G3KCyi1TrNwhMKszhB8L8gXaQhgg9jMQ1xiEJiYlpAQWIqFmG-TbZ1kP28rN7xEyg8xOF6GSmfCEqmlMwokUBhtBJZzDAZEZEkjMTpGyZAYYiRxMQnWsAM5m-r1e-yznw_UKIFdjlVyPDtspTfpQMnj3e6D73BfR8mGwrxOt2XqVIxR_BZoS-9DvjWhh7fmvv5PMG5SOPEbJY7M_p7oAVMz4rPVvZuxXcrRz8IZVegmgeh9izrKE4kJihLIJNNPTazzuHeOxc4DS3gDS1gjcDWD1fEKxWxcp_Z8SPILhlBkxmmfftDyE5pTsFN95pD6Jag7OMdsy9yzDZMfvuO2ac0p-BY65qOtUpQ_HjH-EWOccN0bt8xfkpzCo5513TMK0E5xzvmXOSYY5jN23fMOaU5Bcfa13Ssfcr3whDVKo4UVq7o3-9kVXYyWHaXo5zj9uJX8TqZ4XMSz_J3t49PuVAekKjSbZZtH3rRz5RKExTL3edOUYnVKtklJVZUalaV7HqmU6B4rZRzWIlVlZxzy3OrSs1aJfcwk11Vcs9lalWVWrVK3mEmXlXyzmXyqkrt-jGwDkM5v8xm_ZjXULWzo_Maxh8vCwk-oG05OJVTA5seGo6LzGi35dRocca5Zbddz82uwNdQzFV2fkdv8UcuO_5cZafvVYQKKQzEO3YwxWS5iBYqXcy-M5vNHz8CAAD__825O6M=

query T
EXPLAIN (DISTSQL) SELECT sum(a), min(b), max(c), count(d) FROM data
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • scan
      missing stats
      table: data@data_pkey
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0ld9vokoUx9_vX0HOEyZDYPihwJNN25uQVO0Vm9tkY8zIjJYUGZcZ0jaN__sG3N0CuxAh8UVhBr_n4ydnOJ8gvifgw_3z48NNMFfUuyBchf89jJTw_uH-dqWI_KCSEVIOcapui2_yrkYjpEQ8T6VKR8q_y8VMoUQSQJByyubkwAT43wADAhMQWIDABgQOrBEcMx4xIXhWPPJZ_iCg7-AbCOL0mMtieY0g4hkD_xNkLBMGPqzINmFLRijLdAMQUCZJnJRlitLT4mNzfGUfgOCWJ_khFb5CkLJFSgQIwiMpFjQdKySlCla4fGEZrE8IeC6_ygpJ9gx8XOEM7sA3Tuhy1Jv9PmN7InmmO3XS8GmmTvEIEMyCuTo1y6ubZ3VqFVe3i6f5arNc_B-qo1Yys0HmtJJ9AeUpzyjLGK3RrE_d7NjoAx8-zTbBfKVO7XZ2q8GO61rx5R2AB3eAjjXdHNQDuA9sxeP46j0wrpGZl2s0h2s0Nd0apNHsA1vROLm6xkmNzLpcozVco6Xp9iCNVh_Yikb36hrdGpl9uUZ7uEZb051BGu0-sBWN3tU1en1GzpKJI08Fa7zg_17JaFTScDEJGN2z89gQPM8i9pjxqHz2fLsog8oFyoQ87-LzTZD-2hIyY-Twe2JWk3BnkllLwtUkp5lkdjP1gbI6o-z2JNxMsof-vXEzyelMGrczmc2k8VCmSTNp0pnktjNZzSR3KJPbTPK628Boh7L_6M3uNu-g8oqjs0v42yam4IO7jXZuZJia5008zd5GY21ruYZGzJ3jUEaoZxVvjl1C9qI4v-ELfytjVx_H4vTtSCIYghl5ZXdMsuwQp7GQcfRz53T650cAAAD__xd1tB8=

# AVG is more tricky: we do two aggregations (for the sum and for the count)
# and calculate the average at the end.
query T
EXPLAIN (DISTSQL) SELECT avg(a+b+c::INT+d) FROM data
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • render
    │
    └── • scan
          missing stats
          table: data@data_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0llFv4jgUhd_3V1j3CYSjYMdAyBNV25WQCu0ClVZaocrEF4oaYtYO06kq_vso0JkmmUkEBV5QYptzv3N0rZt3sP9HEMDtvw93V_0hqd30x5PxP3d1Mr69u72eEPltUavVJGmQWZ00SBgE_eHETx9Vnfw9uh8QJRMJFGKtcChXaCH4DxhQ4EDBAwoCKLRgSmFtdIjWapMeed_9oa--Q9CksIzXmyRdnlIItUEI3iFZJhFCABM5i3CEUqFxm0BBYSKX0a5MWrqX_jytX_ANKFzraLOKbUAkJTNKQkoUUBivZbrmuIzIWBFGdPKMBiiMMFZoAtITjVqtxxo9Xm_0vA-LMN1S0Jvkk8wmcoEQsIyV_g0EzS093M3VYmFwIRNt3FbezPhxUOuxeuri_nE42T2XIfACQqsU4bPyJtZGoUGVKzvdVkOyZhnl-HHw1E85eT0bJXN7vJTbK3CzfHbs8E5gp3SCyxyXX6QX2DF-MjG3z9cL7RwCPzxSflKk3HG9i0TKj_GTibRzvkg7OQTv8Ei9kyL1HFdcJFLvGD-ZSP3zRernEMThkYqTIhWO27pIpOIYP5lIu-eLtHvMHBqhXevYYmEY_LlSs1DJYenUQLXA_YixemNCfDA63J3dv97vhHYLCm2y32X7l378c8smBuXq1xjNKrFKJZ5TYlmlVlGJVzMdA-VVSolyJVZUEl-11y4qtSqV2uVMvKjU_ipTp6jUqVTyy5m8opL_VSa_qNStboNmOZT4rTer27yCqptenXmkX5-WCgLohl7XxzlzZqHyHSH8riPlrOl4oiU6M-4JxtLvxHkkFza9v-Nn_bqTnbyt09s3l5FFCgP5gjeYoFkt46VNluHHznb7148AAAD__6opvyQ=

# VARIANCE/STDDEV have three local (sqrdiff, sum, and count) and one final stage aggregations.
# We calculate and render the variance/stddev at the end.
query T
EXPLAIN (DISTSQL) SELECT sum(a), round(stddev(b), 1) FROM data
----
distribution: full
vectorized: true
·
• render
│
└── • group (scalar)
    │
    └── • scan
          missing stats
          table: data@data_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0lt9r4koUx9_vXxHOk8KEZPJDTZ5SqkLA2lbt5cJFyugcrTRm3Jlxu6X4vy-J263JboIGfJHMTPyez3w44_gB6lsCIQz-exjdxGOj1Y-ns-njqG1MB6PB7cxQ-22LtYkhxT7lLaU5x--tRZsYtG0MJ_d3BmeaAYFUcByzLSoI_wcKBBwg4AIBDwj4MCewk2KJSgmZvfKRfyHmPyC0CWzS3V5n03MCSyERwg_QG50ghDBjiwQnyDhKywYCHDXbJHmZrHSUfTzvXvEdCNyKZL9NVWgwYiyAwHTHspFpUYOl3KCG0C8oYX4gIPb6q6bSbI0Q0hPIuA-hfSDnc96s1xLXTAtp-UXM6dNdK6LtjOdx0o-Hw1bk5KNsPn-6vX8az_LnKjSnhOZXon0R7VMhOUrkBZz5oR6e2lX0w3h8M3qezvr9wb-tyCGRSyIvW5hgylGGRkQ_-yRyCA3DMB7PetV7ckt7okXf9Py-oM36wqKm5TTqDHoJ6YnczvU7o1NAc86X6DSU6JiW20iicwnpicTu9SV2C2ju-RLdhhJd0_IaSXQvIT2R2Lu-xF4BzTtfotdQomdafiOJ3iWkJxKD60sMLrmDJqh2IlVY-sH_eyW7VMmk2c2AfI3Ha0SJvVzigxTL_N3j8D4Pyic4Kn1cpcdBnH4uKS2RbX9foadJtDbJKSTR0yS_nOTUM10C5dZGedVJtJzkNd1ep5zk1yZ1qpmcclKnKVO3nNStTepVM7nlpF5Tpl45KahvA7sayvujN-vbvIYqyI7OKhFvzxsOISyCbsf2l67pdwPb9BaBay461DNX6AVd36beapH9y1olbK2y8zt9EW957Ox9l52-FUsUErhjr9hHjXK7STdKb5a_Vg6Hf34GAAD__5ETtek=

query T
EXPLAIN (DISTSQL) SELECT sum(a), round(variance(b), 1) FROM data
----
distribution: full
vectorized: true
·
• render
│
└── • group (scalar)
    │
    └── • scan
          missing stats
          table: data@data_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0ld9r4koUx9_vXxHOk8KEOPllzFPEHxCwtlV7uXCRMmaONlQz7kzcbin-70vidmuym6ABXyQzk3zPZz6ccT5AfduCD6P_Hib9cKq1huF8MX-ctLX5aDIaLDR12LVYm2hSHBLe-s5kzJIIW6s20WhbG8_u7zTOUgYEEsFxynaowP8fKBAwgYAFBGwg4MCSwF6KCJUSMnvlI_8g5D_A7xCIk_0hzaaXBCIhEfwPSON0i-DDgq22OEPGURodIMAxZfE2L5OVDrKf5_0rvgOBgdgedonyNUa0FRCY71k20g2qsYRrVBPpC0pYHgmIQ_pVU6Vsg-DTM8hwCH7nSC7n7G82EjcsFdJwipjzp7tWQNsZz-NsGI7HrcDMR9l8_jS4f5ou8ucqNLOE5lSifREdEiE5SuQFnOWxHp52qujH4bQ_ef63Pwv708GoFZgksEhgZ0szTDhKXwvoZ68EJqG-74fThVe9K6u0K1o0Ti_vDNqsMwyqG2aj3qDXkJ7pdW_fG24BzbxcotlQoqkbViOJ5jWkZxK7t5fYLaBZl0u0Gkq0dMNuJNG6hvRMond7iV4Bzb5cot1Qoq0bTiOJ9jWkZxJ7t5fYu-YWmqHai0Rh6S__75U6pUo6ze4G5Bs8XSRKHGSED1JE-bun4X0elE9wVOlplZ4GYfK5pFKJbPf7Ej1PorVJZiGJnic55SSznukaKKs2yq5OouUku-n23HKSU5vkVjOZ5SS3KVO3nNStTfKqmaxykteUySsn9erboFMNZf_Rm_VtXkPVy47OeivenmMOPqy9nrNe8bXetVeublu2q_eoy3SnE3kes6M1d9eQfcA2Kju_8xfxlscu3vfZ6VuzrUICd-wVh5ii3MVJrNI4-rVyPP7zMwAA__-xaLgo

query T
EXPLAIN (DISTSQL) SELECT stddev(a+b+c::INT+d) FROM data
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • render
    │
    └── • scan
          missing stats
          table: data@data_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0lVFvokAUhd_3V0zuE8YhOICIPNFUTUisbdVuNtmYZmQu1hTBZcbtNo3_fYN2t8ouRGt4McMMnvud4x3vG8gfMXjQ_3Y3vApGROsFk-nkftggk_6wfz0lUgmBPzVN46RJ5g3SJKHnBaOpmy9FgwzGtzdEcMWBQpIKHPEVSvC-AwMKJlCwgIINFNowo7DO0hClTLP8lbfdFwLxC7wWhWWy3qh8e0YhTDME7w3UUsUIHkz5PMYxcoGZ0QIKAhVfxrsyeWk__3hcP-MrULhO480qkR7hlMwpCSkRQGGy5vmebjDCE0EYSdUTZkBhjInAzCO-3dQ0nzV9s9H0rXeLMNtSSDfqg0wqvkDw2IGVoAdea0tPd3O1WGS44CrNjPaxmcn9uBcMBprPGjnzw8376vr2YTTdrcuAzAJQuxTog2OTpJnADMURxGxbjcwKP8AgGF0NHyfTXq__VfMZ9U3qW-WgVgGUHUfHTm8EdkkjGEw3zFpagZ3j5yBXp65WcI6AzNMDNi8K2NQNq5aAzXP8HATcqSvgzhGQdXrA1kUBW7ph1xKwdY6fg4DdugJ2j4Ds0wO2LwrY1o12LQHb5_g5CLhbV8Ddc8bXGOU6TSQWpsb_K7UKlXSWjxcUC9zPIplushDvsjTcvbt_vN0J7TYESrU_ZfuHIPlzJFWGfPV3-h4qsUol80iJHSq1i0pmNdM5UFallF2uxIpK9mftOUWldqWSU85kFpWczzJ1ikqdSiW3nMkqKrmfZXKLSt3qNmiVQ9n_9GZ1m1dQdfOrE8Xpy-NSgAdOJExnzizdYZ1Qt11m65xFbd2Jwi6akYtRlP8jRzFfyPz-Tp7Sl53s9HWd376IxxIp3PBn7KHCbLVMllItw_eT7fbL7wAAAP__wMjNgg==

query T
EXPLAIN (DISTSQL) SELECT variance(a+b+c::INT+d) FROM data
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • render
    │
    └── • scan
          missing stats
          table: data@data_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0lV9v4joQxd_vp7DmKQhHwU4CIU9B_JEiUdoCvbrSFarceKBRIWHtsN2q4ruvAt0tZJcIivKCHDs58zuHseYd9Lcl-ND_727YCUfE6IWT6eR-WCOT_rDfnZLvQsUiidAwDEHq5KlG6iTy_XA09fKlrJHB-PaGSJEJoJCkEkdihRr8_4EBBQ4UbKDgAAUXZhTWKo1Q61Tlr7zvPgjlD_AbFOJkvcny7RmFKFUI_jtkcbZE8GEqnpY4RiFRWQ2gIDET8XJXJi8d5D-P6xd8AwrddLlZJdongpInSiJKJFCYrEW-Z1qMiEQSRtLsGRVQGGMiUfkkcOqGEbB6wGv1wP6wCLMthXSTfZLpTCwQfHZgJeyB39jS8910FguFC5GlynKPzUzux71wMDACVsuZH24-Vt3bh9F0tz4FxAtA7kmgT45NkiqJCuURxGxbjswKf8AgHHWGj_92xmFn1O0bAaMBp4F9GtUuoLLj8Nj5rcCuaQWLmRavpBnYJX4Okm1W1QzNIyB-fsD8qoC5admVBMwv8XMQcKuqgFtHQPb5AdtXBWybllNJwPYlfg4C9qoK2DsCcs4P2LkqYMe03EoCdi7xcxBwu6qA25cMsDHqdZpoLMyNv1dqFCqZLB8wKBe4n0Y63agI71Qa7d7dP97uhHYbEnW2P2X7hzD5daQzhWL1e_4eKrFSJX6kxA6V3KISL2e6BMoulXJOK7GikvNVe82ikluq1DzNxItKza8ytYpKrVIl7zSTXVTyvsrkFZXa5W3QOA3l_NGb5W1eQtXOr858mb4-xhJ8cDBqzOeRa9qMu6bjNbkpPNc1ORPS5qzBHDeC_AOx0Pn9nTynrzvZ6ds6v31zsdRI4Ua8YA8zVKs4iXUWRx8n2-0_PwMAAP__0uvN2g==

# Regression aggregate functions have two local, and one final stage aggregations.
# Calculation and rendering are happening at the end.
query T
EXPLAIN (DISTSQL) SELECT covar_pop(a, c), regr_sxx(a, c), regr_sxy(a, c), regr_syy(a, c), regr_avgx(a, c), regr_avgy(a, c), regr_intercept(a, c), regr_r2(a, c), regr_slope(a, c), regr_count(a, c), covar_samp(a, c), corr(a, c), sqrdiff(a) FROM data
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • scan
      missing stats
      table: data@data_pkey
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzMVk1vozoU3b9fge4qlYwS85EPVkEpjZDSkAGmr6OnCnnAyaAhmLHJTKsq__0J0mmBJihhlU3ke22fe86xb8wriF8JGGA9rhamvZR6t7bne18WN5JnLayZL4XsN-FBxrIeQVJ4gyRONzwQz8-N-KUev9Rj8nvz3EzUV8RpTnlIs7yW5UodNmEZrWVCtkvftxy4CrLNPjKc_x2LXzyK1-seuZHuXOdeikhOAEHKIrokWyrA-A8wIFAAgQoINECgwxOCjLOQCsF4seS13GBHz2AMEMRptsuL9BOCkHEKxivkcZ5QMMAn3xPqUhJR3h8AgojmJE7KMkXpafETZD_pCyCYsWS3TYUhFVwBgZeRIpL7WCJpJGGJ5T8oh6c9ArbLP2qKnGwoGLhC0r4FY7BH5_M0NxtONyRnvK_XafquufRs33aWgWvNXcvziqE5n7vW3PSt3hSjqXJT0He-Lv3Adf71ekXofXFv7bu73hSX0df7t1G5rByfEqI0hOgnhXzw36WMR5TTqEb-ad8uFTeO5M5emotg5jyYbrByVm-MD9lCfOA9Ph5LfjuS_HYkaT7Mj-w3H-ZH1tpL33Jn1sr_POUqR-otnJX1YXaxvXc4l6ooz7yvq5o5rltLvB-biqYamuqnj0ltHBOuXzh8fmPgbo3Rx3Jf6dQa-BKmlfsyvLbWGNaEKOdbrnS0XJH7aifLlUuYViwfXZvlo5oQ9XzL1Y6Wq3Jf62S5egnTiuXja7N8XBOinW-51tFyTe7rnSzXLmFasXxybZZPLvl4cKnIWCpo4-09XmnQqCTj4pGm0YYeXnTBdjykK87Ccu0hdEqgMhFRkR9m8SGw079TIueUbN-_fapIuBVJqSHhKpLeRFLaOV1CSm2F0k4j4SaS1lXesImktyINT3NSmkjDrpxGTaRRK9L4NCe1iTTuymncRJq0X4PBaVLap7vZfs1bWE2K1lkn7E8QR2CAOib6WtcGMsFkImvj0VAma0zkSJnQ0Xj4faRGxR_NOiEbUfSv94P9KWH9l6zovjVJBEVwT37SW5pTvo3TWORx-Daz3__zfwAAAP__NYRp9w==


# Test various combinations of aggregation functions and verify that the
# aggregation processors are set up correctly.
query T
EXPLAIN (DISTSQL) SELECT sum(a), avg(b), sum(c), avg(d), stddev(a), stddev_samp(a), stddev_pop(a), variance(b), var_samp(b), var_pop(b), sum(a+b+c::INT+d), covar_pop(a, c), regr_sxx(a, c), regr_sxy(a, c), regr_syy(a, c), regr_avgx(a, c), regr_avgy(a, c), regr_intercept(a, c), regr_r2(a, c), regr_slope(a, c), regr_count(a, c), covar_samp(a, c), corr(a, c), sqrdiff(a)  FROM data
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • render
    │
    └── • scan
          missing stats
          table: data@data_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzcV81u4joU3t-nsLwKqhGx8wNklQhSFKkFJsn0dnRVITd2GTSQME7otKr67ldOgCYZiKCVuuiC6Px-Pud8tmVeYPp7CS3o3k6vHG8MlKEXhMG3qxYI3Ct3EIJ0s1JoCwH6OFfuWyjXo63OpJ4xxh_zkEKcpXS1LuvrpFAfqVjQOOI5zCMVReBOkVE7fEWh4ALct8AFiCzLG4c9KcrVomQXSxGQZQg-F7P06ammP1f156pOH-dPdUM1YhFnXER8nVWsglRhl8maVyxRson3KUWtxTR2FiF2cvpbsMXDg0Jb4NKfXANGMwoRjBPGx3TFU2j9BzFEkEAENYigDhE04B2Ca5FEPE0TIUNe8gSPPUFLRXARrzeZNN8hGCWCQ-sFZotsyaEFQ3q_5D6njIuOChFkPKOLZb6MXNqWn9n6F3-GCA6S5WYVpxagCNwjECHAIILBmkpbu4MBjRnAIMl-cgER9HnMuLCArV8oio0vbNK6sLUtcQjYGAGbIGBrCNg6vHtFMNlkb5WmGZ1zaOFSa94QWuorOr07Zz4XfE6zRHSManPB92vFJi1Zv5Q0KQ0m38fhVs6t-l4ySv5cDr75Q-_ycoux9ZCK5w0HSyn0nXHghd5kPPPdke8GgRSd0ch3R07oKjZBxYI52Myf_BsoraNjIbWxGEfH8jaNTZwIxgVnlVHcvTYPDqsHJof3ve1mOPMaZ7ePMKV26Y2dq1kQDofujWJ3kY2R3as7ZtPJ9IDzxvE9ZzxwFbuP5My0iqtIKnmKctW3oMFkH4bxm1lyMgtubw9afxyy_jhkdW5GhyCcm9GhaG8cuv7AnYYHfD45tOjVZOru7PuZYlJvL3Cua_0NJr5ftew3amnE-zObH85OcTYRsI2ObSJgd7e_HgJ2f_vDqvzIeCxPM5YpWOZgQ35kGpY5WCZhmUFkBslXkBlEZpDjN4BW2-q4egXg0y84_JELroPbHfIpVxw-p7_SSTW_9hVnVsZCTqedfIh20u5on0I7Oae_Eu3dr017tzIW7XTatQ_RrrU7-qfQrp3TX4n23temvVcZi3467fqHaNfbHeNTaNfP6a9Ee_9r094_53nv83SdxCmvvWcPr6TWVmpj-fDlbM6LV3KabETEpyKJ8thCneRAuYHxNCu8uFC8eOdKM8Hpav_vpIyEG5FIBQmXkYw6Emmu6ZyitEYo_TgSriPp723PrCMZjUjm8ZpIHcl8b03dOlK3Eal3vCatjtR7b029OlK_eRuox4vS_9qbzdu8oaq-PDoPy-TPbMGgBRkzTN3oqW1Tp1pbN03c7uOe2u4b3UjX7iOmcvn0fljSeSrPb_Az-ZPDhs9refoe6DLlCF7TX3zIMy5Wi3iRZoto63l9_ef_AAAA__-qz29N


query T
EXPLAIN (DISTSQL) SELECT sum(a), min(b), max(c), count(d), avg(a+b+c::INT+d), stddev(a+b), variance(c::INT+d), covar_pop(b, d), regr_sxx(a, c), regr_sxy(a, c), regr_syy(a, c), regr_avgx(a, c), regr_avgy(b, c), regr_intercept(a, b), regr_r2(b, c), regr_slope(a, c), sqrdiff(a), regr_count(a, b), covar_samp(b, c), corr(a, c) FROM data
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • render
    │
    └── • scan
          missing stats
          table: data@data_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzsV01v4joU3b9fYXllVCOwk0DIyhGkKFILTML0dfRUIZMYBg0kGSd0WlX9708On8kAgnbBphuwzz05uTf3-Ep-g-nvObSg8zi4s90eQB3XH_rf7irAd-6c9hCkywXiFQwWswiN1T9_QUEFgyBeRhkKKxjw5ylCiIMbMK6AGxBYltsbmmqpomkWhuJ5HcbgmcsZjwKB1rQ1K4ifuRwlcYLGOAekmMpR-vKCOAbBbv9a3L8W9_x5-lIGXpXiFphFmZCBSDJFG29QSQukdB4nYqOT_pbhbDLJv0EeXRW-fnyVd8oXyUYhiKVcPQtuvf49CHnGIYZRHIoeX4gUWv9BAjGkEEMNYqhDDA34hGEi40CkaSwV5S1_wA1foFXHcBYly0zBTxgGsRTQeoPZLJsLaMEhH8-FJ3goZK0OMQxFxmfz_DXq1Uz9jJJf4hVi2I7ny0WUWkBlj0GAQQgx9BOusGqNAB6FgIA4-ykkxNATUSikBZh-gxAjN4xWbpi2bi8GOYJVdAMqDIMc1FQAPr1jGC-zXfZpxqcCWmSvXLcDrfo7Pr9iezqVYsqzWNaMYsH-93vE9ArE8N7tIWbkK_sRsYZatfvfe8OR1__XR2qbk8k2sF7737yOe3uLGN1y6B6HFjjalqPtcfL10LN7vjt0-72R53Q9x_fV0u52PadrDx3EDMyaZxF1vEr_HMXziDpefZptHfpe9nrlaNdoqWvG0a7tmrWMYhkKKcJCp57eT_eV1A80lmwbS7eN3XRg5K5zX_fDKOD5Z7l1e_bdyB92Os4DYk3MTMxau8CD7bl2r-0gRuqYEYIZobtou_9ge6NBf4AY0Xaw-r4j__ERMaL_hf44hP44hNoP3UMS9kNXsY0S7PaGjtd2BsqyjVLMowce8O_6A6eov209aWKmajXLtfr2_aCo1e573kZlOxoK5x0DZtRYAwPWxICpcdBSI6GufhSRKCZRVKK4xFA_ik4Un5hrDaKeovWjPtRKPiTF8UHOH5jkMwOzRqo1erWRSS6pee9oNb5G5hVHZqPQNXq-U-mnnEqrNe1qTqWX1Lzn1OaXU6_o1Gaha9r5TtU-5VStWtOv5lTtkpr3nGp-OfWKTjULXdPPd6r-Kafq1ZpxNafql9S859TWl1Ov6NTWJddcT6RJHKWidHE6_KZ66U1Vom5YIpyK1XUsjZcyEAMZBzl3te3nQjkQijRbRclq40abUJpJwRfbW_q-EjmpRAtKZF_JKCvR0zldkpR2Uko_rkTKSvpHy2uUlYyTSo3jOdGyUuOjOTXLSs2TSubxnLSykvnRnMyyUuu0DerHk9L_8uZpm5_IqqWOzmQe_xnNQmhBGoy5aQpS5a0mrer1wKiaZlOrhpS2xiLgEzpWU3Uy59NUnV__Z_wnlx2-Jur0Tfg8FRje81-iIzIhF7NolmazYB15f__n_wAAAP__iQIvJw==


# Verify that local and final aggregation is correctly shared and de-duplicated.
query T
EXPLAIN (DISTSQL) SELECT sum(a), stddev(a), avg(a) FILTER (WHERE a > 5), count(b), avg(b), variance(b) FILTER (WHERE b < 8), sum(b) FILTER (WHERE b < 8), stddev(b) FILTER (WHERE b > 2) FROM data
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • render
    │
    └── • scan
          missing stats
          table: data@data_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzsl0tv4kgQx-_7KVp1MlJbdvsBtk8dBdBaImQGmJmVdiPU2BUGDdisH5kdRXz3VeMEbAc8hksuuSTu6up_PfpXyH6G9N81eDD469Poxh8Tpe9PZ9PPow6ZDkaD2xlJ840iOpSkWRji0_5RPC0V0SFDfzQbTIjy7c_BZEAE-SfXdROJ3aEkiPMoUxYvvvL_k0hWIgpQWdQPLoqDAXFklHzzO48ij3NOSIwOGU7u70goMgEUojjEsdhgCt7fwICCARRMoGABBRseKGyTOMA0jRPp8rw_4If_gadTWEXbPJPmBwpBnCB4z5CtsjWCBzOxWOMERYiJpgOFEDOxWu_DyNBc_plvf-AvoHAbr_NNlHpEULIACtOtkCtVY0REIWEkzr5jAhQmGIWYeISzohrb8zx_PHMo4UbRBKduQeNoYdIKDzsKcZ4dU08zsUTwWKlWvw-evqPty71ZLhNciixONLta7fTLncKtjizr86TvD4cvq9v7L-PZ607h83pnnJX331rnk_tvU-Vw0C7J2ZVA9vGwcfSu2A7nqp4nFMwTCuZJBfNsj41aj-2zPT62No_iJMQEw0pfH3bNt8D0E9fAZHeG_vhmNJ_O-v3BV4UblDPKzdItFE9z_9jO11X34NWr2J2j7NebiX8zvh0o3KWc6ZQzdjjE9LfhmYxvUs72cY98S1Ip4abGLUq4TQnvarxHCZccu5Jl_WyTzVqTWZVk1n5w2XWDqzFVM95zdNklBZeg6X6MbuvR7VZ6bLSHyrgSKkPVzPeEyrik4BJUvQ-oWkPVq_TYbA-VeSVUpqpZ7wmVeUnBJaicD6haQ-VUemy1h8q6EipL1ez3hMq6pOASVO4HVK2hci_5Ophguo2jFGtvsKcj6bVIKpOvuhgusXgvTuM8CfBTEgd732J5vxfaG0JMs2KXFQs_et1KswTF5vBxU1ZijUpGRYmVley6ktGc0yVJmY1S1nklVleyri2vW1eyG5W653My6krda3Pq1ZV6jUrO-ZzMupJzbU5OXcltxkA_n5T1hs1mzBuycuXoPK7jn_NVCB6gYQTo9FzVegy6qqW7qIoFc1V0kDF0F04Yyt_8x7VYpnJ-p9_jn3vZ2a-tnL5HsU6Rwp34gX3MMNmsolWarYKXnd3uj_8DAAD__3llSPM=

query T
EXPLAIN (DISTSQL) SELECT sum(a), avg(DISTINCT a), variance(a) FILTER (WHERE a > 0) FROM data
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • render
    │
    └── • scan
          missing stats
          table: data@data_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0lVFvmzoUx9_vp7DOUyIZgYH0pjwlSum9SGnaEdZN2qLKxQeKSnBmQ7uqynefTLa1RG0VIeUF4XPM_5yf_vbhGfSPEgIIv17Np9GCDM6iZbL8NB-SZTgPZwnRzXrAh5Twh7zNRYtZQkzggauCVykO-JCcR_MkjMngy_9hHBJOvjeO4yFxhuQ8vrwggtccKFRS4IKvUUPwDRhQcIGCBxR8oDCCFYWNkilqLZXZ8tx-EImfEDgUimrT1Ca8opBKhRA8Q13UJUIACb8tMUYuUNkOUBBY86Jsy5jSE_O42dzjE1CYybJZVzogpqPlhptXy2aEV4IwIus7VEAhxkqgCsiE7VCcIAiiRTKmZMJgtaUgm_qlH13zHCFgrwCiMwicLX2H4aX1ppJKoELRaXu1fYNymucKc15LZY-6kMvPF4OJOwQK0-v_Xlzaha6ncTRdzEKz449RH0C4exCjDgQ73AjWwwibWbZ7DCtYh8I9nMLtQ-FatncMCrdD4R1O4fWh8CzbPwaF16HwD6fw-1D4lj06BoX_7uV-gyJGvZGVxr1L_nYlZ6-Sxcw0QJHjbnRo2agUr5RM27275WUr1AYE6nqXZbtFVLUpZioo5Ou_s-m1EvtQ6aSj5Hyo5Pbtie0reX2V3H0lv6-St6806qvkGxezUj7eFAICwFM8GTORWV6WMssfcW6NvVvH-pdnjJ2ycea45p-QlTzX5igt7-RjK5s8bcxByHipkcIFv8czrFGti6rQdZH-zmy3__wKAAD__wxifDY=

query T
EXPLAIN (DISTSQL) SELECT sum(a), avg(a), count(a), stddev(a), variance(a) FROM data
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • scan
      missing stats
      table: data@data_pkey
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy8lVtvgkgUx9_3U5DzpMkQGC5eeMJUTUi8tGK7m2yMmTJHS4rgMthu0_jdN4O7W2AXojz4onM4w__85s-ZnG8Qf0TgwOS3x9nIWyidseev_adZV_Ens8nDWhGnQ4d1icI-9vl_kJziLF-JjHP8yJcfLA1ZHGCHdZXpajlXOMsYEIgTjgt2QAHO70CBgAEETCBgAQEbNgSOaRKgEEkqt3znL3j8T3B0AmF8PGXy8YZAkKQIzjdkYRYhOLBmrxGukHFMNR0IcMxYGOVlZGlX_myP7_gFBB6S6HSIhaNIIv_I5FLVqMJirlAlyd4whc2ZQHLKfgqKjO0RHFog9Mbg6GdyPeRov09xz7Ik1ewyo_8877i0K-GWz4t1cb1dLX_1OzL0n1ZjbzrNk3V8RoXPruX7wTrFScoxRV5i2pybT0D1uiP4z_OtJw9hlCJTRlNvMZpt_fV4PHnpuBZxKblsuyReRitvtHiYlFIrjDmmjuJSorhUcw2iuCZRXIsorl3rhFlxgpY_Fb2-n2iLftKoqhmtOoregln4Hr07dVSvxGdcb6PRxkZD1cxWNhq3YBZs7N_Jxn6Jz7zeRrONjaaqWa1sNG_BLNg4uJONgxKfdb2NVhsbLVWzW9lo3YJZsHF4JxuHt4yxFYpjEgusjIv_r6RXKqlUzhXke7wMIZGc0gAf0yTI917CZS6UP-AoskuWXgIv_iclshTZ4d8pXFSijUpGSYkWleyqktHMdAuU2Shl1SvRqpLV9ni9qpLdqNSrZzKqSr22TP2qUr9RaVDPZFaVBm2ZBlWlYXMb6PVQ1n96s7nNG6iG8ursouRzG3JwIEBq6JwHqr0zhqqFA6a-Dg2m2jqjnPesV8uW02wXsb2Q99d_Sz5z2fXXUd6-HYsEEpizdxxjhukhjEORhcHfmfP5l78CAAD__-52ztU=

query T
EXPLAIN (DISTSQL) SELECT sum(a), avg(b), sum(a), sum(a), avg(b) FROM data
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • scan
      missing stats
      table: data@data_pkey
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0lVFvmzwUhu-_X4HOVSIZgQ0hhKtUbT8pUtN2IZUmTVHlwilFJTizybqqyn-fTNYW2GAJUm7QOTZ-z-NXx_YbqO8ZBHD59fbqbHZtDC5m4TL8cjU0wsury_OlobbrAR8Sg_9IBg9D8pHXx43_FzdzI-YFBwK5iPGar1FB8A0oEGBAwAECLhAYwYrARooIlRJS__JWLpjFPyGwCaT5Zlvo4RWBSEiE4A2KtMgQAljyhwwXyGOUlg0EYix4mpVldOmp_txvnvEVCJyLbLvOVWBwYjwAgXDDdWZa1OB5bFBDFE8oYbUjILbFZ01V8AQhoBXI2QUE9o4cznmWJBITXghpjeqY4d18MKVDzaMjpqPzm7vrZRm3wbAGzKgV5pNhmwsZo8S4BrDadeNS-9-84d38fqaJHZ0tMI9RBsaUEmPKrKlD9uF72ropp7EpWreYHt4KtF8rWNS0WK9moMeQVtz1TtEMXg2GHW4b62kbMy2nl23sGNKKbeNT2DauwTiH2-b0tM0xLbeXbc4xpBXb_FPY5tdg3MNtc3va5prWqJdt7jGkFdsmp7BtcszzsUC1EbnCxs3990p2o5JJ9RWPcYL790CJrYzwVoqo_Hef3pRC5UCMqtjP0n0yy9-nVCGRrz9ev6oS7VRiNSVaVRo1lVg30zFQTqeU265Em0pu3-15TaVRp5LXzsSaSl5fpnFTadyp5LczOU0lvy-T31SadLeB3Q7l_tGb3W3eQTXRR-cxEy_3aQwB2NRmEWe-yX0_Ml2HTUyfs8jE2PMm3gRd34tAL-CJ0uc3fBIvpezydaNP3yPPFBKY82e8wALlOs1TVaTR75nd7r9fAQAA__9fyqcP

query T
EXPLAIN (DISTSQL) SELECT avg(c), sum(c), avg(d), sum(d) FROM data
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • scan
      missing stats
      table: data@data_pkey
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy0lV1v4joQhu_Pr4jmqkiOEsfhK1egfkhIUHoIlY50hCqDBxo1xKwdtltV_PeVA7tNspsIInGDmbF55_HLWPMJ-lsMAdz_9zQejh6tm7tROA__Hbes8H58fzu3-PfNzapFLL3fZquJxSkWLethNp1YgqccCCRS4CPfoobgf6BAwAMCDAj4QKANCwI7JVeotVTmyGf2g5H4AYFLIEp2-9SkFwRWUiEEn5BGaYwQwJwvY5whF6gcFwgITHkUZ2VM6YH5eNm94QcQuJXxfpvowFoRSwCBcMdNZDvU4omwqCXTV1SwOBCQ-_Srpk75BiGgOcjRHQTugZzPOdxsFG54KpXTLmKGz5ObAW0Zvunz4_z0Pct6uazXqgTzSmDtSrAvnn0ilUCFogCzONSjU7eKPXyevIxOnCd6Vsj7JpphIlAF1oA6t8PQnB6GD-PpcN5rEWtAiTVgzsA3S-VlWemytPg30PPbhTZrF4fajteoYeglpDnXO9dumE4BzDvfQq-hhZ7tsEYWepeQ5izsXtvCbgGMnW8ha2ghsx2_kYXsEtKchb1rW9grgPnnW-g3tNC3nXYjC_1LSHMW9q9tYf-SkTRDvZOJxtIE-Hslt1TJpmZUoNjgca5ouVcrfFJylZ09htNMKEsI1Olxlx6DUfJrS6cK-fb3RM0r0Volr6BE80rtspJXz3QJFKuV8quVaFnJb3q9TlmpXavUqWbyykqdpkzdslK3VqlXzcTKSr2mTL2yUr--DdxqKP-P3qxv8xqqvnk661i-v0QCAhBr5ou2t7Zd1ndtn4u-vVwuu7YrlmzZ73K3uzZzdh3zjTbvN3yV75ns_GNnXt-axxoJTPgb3mGKahslkU6j1WnncPjnZwAAAP__Ne-5og==

query T
EXPLAIN (DISTSQL) SELECT max(a), min(b) FROM data HAVING min(b) > 2
----
distribution: local
vectorized: true
·
• root
│
├── • filter
│   │ filter: min > 2
│   │
│   └── • values
│         size: 2 columns, 1 row
│
├── • subquery
│   │ id: @S1
│   │ original sql: <unknown>
│   │ exec mode: one row
│   │
│   └── • group (scalar)
│       │
│       └── • revscan
│             missing stats
│             table: data@data_pkey
│             spans: LIMITED SCAN
│             limit: 1
│
└── • subquery
    │ id: @S2
    │ original sql: <unknown>
    │ exec mode: one row
    │
    └── • group (scalar)
        │
        └── • scan
              missing stats
              table: data@data_pkey
              spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyUkFFrnEAUhd_7K4b7pDASx80Wmaem3U0rbEwaJRRaKaNz3QxRx86MJGXxvxe12TaFhuRxzr3z3XPOAeyPBjhsv1ztzpKUeJsky7PPO59k2932Q05a8eAJn5JWdV7pk_PrywsihRPk09lNkn581L8NYbhCEgGFTktMRYsW-FdgUFDoja7QWm0m6TAvJPIBeEhBdf3gJrmgUGmDwA_glGsQONyIZkB7EgIFiU6oZiZG5D3xGKluh-7O-lCMFPTg_lCsE3uc2cezyQZ4ONKXXz5XjUOD5oQ9vb3onLyLjoE550max__1wf7xwV7j4xptrzuLT1y8NHHAxoICyj0utVs9mAqvjK7m3eV5OYNmQaJ1y5Qtj6R7HFlnULTHGv8msWdJ0XOkgkLd6PvvSgIHuS5jsRJvgzouw-C0PsWgLNcykAxruV5JrDGG6YPY26mi7Fbfz9j8Zz8FrEVjkcKFuMMNOjSt6pR1qvo9Gcc3vwIAAP__kynv2w==

query T
EXPLAIN (DISTSQL) SELECT DISTINCT (a) FROM data
----
distribution: full
vectorized: true
·
• distinct
│ distinct on: a
│ order key: a
│
└── • scan
      missing stats
      table: data@data_pkey
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy8lt1u2jAYhs93FdF31GqJEjs_QI46lU5CamlXOJg0ocokpqBCnMVBXVVx75Nh4ydu3NggTqqGJK-ffO8j2e_Af88hhpufD7ffen3rotsbDAc_bi-twc3tzfXQEte9_vXQuiCX1vfH-zsrJSUBGzKW0j5ZUA7xL0BgAwYbfLAhABtCGNmQFyyhnLNCPPK-fqGX_oHYs2GW5ctS_DyyIWEFhfgdylk5pxDDkIzn9JGSlBauBzaktCSz-XoZsfSV-POUv9A3sOGazZeLjMeWIBrkRPzruMgiWWohi5VTWsBoZQNblrsFeUmeKcRoj7DXhdhb2c0huzNezrKkdMNDwisxifsipQVNY-sKVVbfBYzfrCnhU-nt0WpHiCuEYS3hLpdt1q7mft0E134G8rS-Y8foVxhR_Rh3yy6zjzA_JOwzh-UuCitPfgwTVGEOJ4aai4cMxHOR42Ij9ZAO5raz6IzqRbWEx6uHTqXe4Rhx87axSdvYcX2jtrEO5nZMrTO23aolPL5tfKq2D8foN2_bN2nbd9zAqG1fB3M7pvYZ227XEh7ftn-qtg_HGDRvOzBpO3Dc0KjtQAdzO6bOGdvu1BIe33ZwqrYDnbPYI-U5yzhtdETwKks5SHwSTZ_pZgScLYuEPhQsWT-7ubxfB61_SCkvN3fR5qKX_b_Fy4KSxfYouZ-EqkloPwkfJKH9pFAvKapPQppQHUWUJhVSfCDWxEKhIkviwsoG_fooX8Ly1TJEGjYEyqiwPglVk0JTryK9JJVXmlAqrzSplF5pYim9krgiY68krJYyql0vA64mtU1laOklqWTQhFLJoEmllEETSymDxNUxlkHCQp9sOYo9x5eyjDedtmaUSghdLJURulxKJXTBlE7IZOY7jwz2ydYT1EsRSFnS3tNUio5mlEoKXSyVFLpcSil0wZRSyGTSFtRYikCcUidz9vo0SyGGpINTL8KR0w4nkRNEie90cDp2yMRroXYyJgn1QLxAnrk4Kg-m7HWdO3zLxUF3Quac2nBHXmiXlrRYzDJxiE_-3VmtvvwNAAD__538Lmg=

query T
EXPLAIN (DISTSQL) SELECT SUM (DISTINCT A) FROM data
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • distinct
    │ distinct on: a
    │ order key: a
    │
    └── • scan
          missing stats
          table: data@data_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJy8l11v4kYUhu_7K6xztVFtmfkwYF9llaQSUj62gUqVqmg1wROC1tjUY7SNIv57ZWjBeOIjHzviJgoY3vNw5pljzzuYvxOI4ObPb7dfJ_fOl-vJdDb9_fbCmd7c3lzNHLNZ7d6b3F_NHHXh_Pb4cOfEqlDgQprF-l6ttIHoL2DgAgcXBLggwYUAnlxY59lcG5Pl5Ufed1-YxP9ANHBhma43Rfn2kwvzLNcQvUOxLBINEczUc6IftYp17g_AhVgXapnsypSlL8s_39c_9Bu4cJUlm1VqIqckmq5V-a_nM0elscOcrHjVOTxtXcg2xbGgKdRCQ8QqhJNriAZbtz3k9dIUy3Re-MEp4WXZiYc81rmOI-eS1aofA57fnFdlXq1vP22PhLxGGDQSHnOzfe167q_74MafwQak33FkFDVGRmrj18Ui1wtVZLnPap2c_nH35ZJdNBaW9cJturNJP-rPh62poPEBDS2oofHTnrD2_rMO_vvM83mnHcAomAd1hmfcAcNGwv47gH3WDiC1sboDhj13wGl3eHvNeBfNuOeLTppxCuZhfUZn1GzUSNhfM_5ZmpHaWNVs1FOz0-6I9pqJLpoJz5edNBMUzMP6jM-o2biRsL9m4rM0I7Wxqtm4p2an3ZHtNZNdNJOeH3TSTFIwD-sTnlGzsJGwv2byszQjtbGqWdhTs5DyvPqozTpLja49Pn5calAr5bGylzpe6H3vTbbJ5_pbns13n92_fNgF7d6ItSn2V9n-xST9_5Ipcq1Wh1NLNYnVk1g1iZ8ksWpSQEsaNScxIhRjSBYRiwXNWZzKFSJZFhdHl1A0L6GwsAQaJZuphEUl0ShOMStAo4bNSayeNOzq6JCWhDlKhEIdJWKhjlK5MEctrhG6hGPEUQtr3NlRiyrEh9-gGYtbG9oapG3VGhGjMLeoWKhcVDDULjIZppdNZs3T05XkiGA2GT5QMcNsMHyiMomAWVnWSG2r2JgYhSlGxUIVo4KhipHJMMVsMvwuxJDbkLDJrNnaWjEbDJ-tDBmu0sqyhmtbxUJiFKYYFQtVjAqGKkYmwxSzyfD7EUfuR8Ii4_iTPaZYWB4XXpLs5_dlDBFIJrSeK-XFAzn0JB_PvVA-a4-NAxGKYRgoXh76XxK1MOWZZfqa_dzlzt7W5YnjRSVGu3CnfuhrXeh8tUzLY9z8vyvb7S__BgAA__8fXHSN

query T
EXPLAIN (DISTSQL) SELECT SUM (DISTINCT A), SUM (DISTINCT B) FROM data
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • scan
      missing stats
      table: data@data_pkey
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJykll9v2jwUxu_fTxGdqxfJUWLHgZArqtJJSP23wqRJE6pMcqBRQ8xso66q-O5TwkYbr4kg3CD5ODzPw-_Yh7yB_plDDFff768vJrfO_-PJdDb9et1zplfXV5czR2_XVW1yezlzRI_UC4ue8-Xh7sZJhRFAoJAp3oo1aoh_AAUCDAgEQIADgRDmBDZKJqi1VOUjb9UXJukviH0CWbHZmrI8J5BIhRC_gclMjhDDTCxyfECRovJ8IJCiEVle2ZTWo_LjcfOMr0DgUubbdaFjRxBnAQSmG1GuXI86okgd6kjzhArmOwJya949tRErhJh-CDkZQ-zvyPE5x5k2WZEYL6yHHFEyYo2WzLIMGy3fnbaFVCkqTGtG890noS5WK4UrYaTyqAVv-u3mvZkj2itx1Uqs15g6sFLTOil6fEdpt4561PVYp57SU5Ieeto_p6f9miU7Hg7rCIe5XtAJDjsl6QHO4Bw4g5plcDycoCOcwPV4JzjBKUkPcKJz4EQ1S348HN4RDne9sBMcfkrSA5zhOXCGp0znB9QbWWi0RubnTr7l5NJytmK6wv0g1nKrErxXMqme3S_vKqGqkKI2-126X0yKv1vaKBTrw5_LRyXaqsRqSvSjUmgrsfZMp4QKWqV4sxK1lXjXn9e3lcJWpX5zJmYr9btmGthKg1alqDlTYCtFXTNFttKw_Rj4zaH4P2ez_Zi3pBqWV2eZy5fHLIUYRBgN-wNOXZbwpcuZT90oCVKXJowLny_4cli-EixzsdLl_Z0-yZdKdva6KW_fUuQaCdyIZxyjQbXOinKYJH92drv_fgcAAP__QE1_PA==

query T
EXPLAIN (DISTSQL) SELECT DISTINCT a, b FROM data WHERE (a + b + c::INT) = 27 ORDER BY a,b
----
distribution: full
vectorized: true
·
• distinct
│ distinct on: a, b
│ order key: a, b
│
└── • filter
    │ filter: ((a + b) + c::INT8) = 27
    │
    └── • scan
          missing stats
          table: data@data_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzEl1Fv4kYQx9_7KVbzlIi1zK5twJYq0QZORcrBFZDaqopOi70k6BxMbaNrFPHdK-MWg_d26vWh5CWSbfjvz7O_GbKvkP0VQwDj3z_d_zSZkpvRZLFc_Hp_Sxbj-_HdkhTXk-ndkghKVuTDfPaRRCIX5LdfxvMxubkRpENWt6RDwiCYTJeDW_Ij4X0ym4_Gc_LzH8evAYVtEsmpeJYZBH8CAwocKDhAwQUKHjxQ2KVJKLMsSYuPvB6_MIn-hqBLYbPd7fPi9gOFMEklBK-Qb_JYQgBLsYrlXIpIpnYXKEQyF5v4uEzBOSz-fN59kS9A4S6J98_bLDhCURIChcVOFDcsmxGxjQgjSf4kU3g4UEj2ebVslotHCQE745yMIOgeaHPUD5s4l6lMbe-Ss7wfkJubISMdMuRFOYfOeT2D8gIozPZ5QIaMDrkWktcgPRPI0SbLN9swt1mtmuWaFGZpJFMZfRuiylm9kCeRPX0r4-FQsTo1VqavaJWdlAj17A4d8k6Zrn8rr8VbVbhuHVdf2-_BnSZWsrP55Q7omLwaE78sIWveP6x1_9jMsnmrDmImsKcO6r1tB_VMICvX2Lt0kL6i1-mg3nU76LK2vLmtvL2t3LKdVrZyE9iTrf23tbVvAlntK38XW_UVvY6t_evaellbp7mtTntbHct2W9nqmMCebB28ra0DE8hqX513sVVf0evYOriurZe1dZvb6ra31bVsr5WtrgnsyVb_bW31TSCrfXXfxVZ9Ra9jq39dW32Tc8pcZrtkm8lG_yJ3a0tZrHgxGT3KshhZsk9D-SlNwuNny8vZMeh4I5JZXj5l5cVk-9-jLE-leD6dBc-TGJrE9UlePYnXk9h5knORxM6TmAKFRw2QKEMqxvVZ3BCL9ZAsQy7e1Wc5CpeD7qGLRClYLq6DiVkeGtXTJ7F6Ug9N6uuTevWkfmtHFSg8CnPUkAp11BALddSQC3VU4Rq0dlTB8vHh19X7wJXp9z-DFPG9r2Qpo7SxXCoXnoXZZcqF6mUKhvplSoYKppIpE7WxYSoYPlGZq9fCUbLwkco8fdZAyVJmamPFVC48C1PMlAtVzBQMVcyUDFVMJcN_iDDFVDBluF5qMdBr4SpZ-HBlvj7LV7KU6dpYMZULz8IUM-VCFTMFQxUzJUMVU8g4_oOEKeYXx4V1nHz9vIkggD6LGHN7a0tG4cpyfV9Ywl8zy_NWvlx1-76QxblkHYvHrDizLJ6Sr8fc5cuuOHGsRZxJCh_FFzmSuUyfN9viTBX---Rw-OGfAAAA___PoMnc

query T
EXPLAIN (DISTSQL) SELECT DISTINCT a, b FROM data WHERE (a + b + c::INT) = 27 ORDER BY b,a
----
distribution: full
vectorized: true
·
• sort
│ order: +b,+a
│
└── • distinct
    │ distinct on: a, b
    │ order key: a, b
    │
    └── • filter
        │ filter: ((a + b) + c::INT8) = 27
        │
        └── • scan
              missing stats
              table: data@data_pkey
              spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzEmFFv4kYUhd_7K0b3KRFjmRmPDViqRBtYFSkLW0BqqypaGXtI0BJMbaNtFPHfK0PB4Invci2UvKxkA2c-DuccrfMK6T9L8KH_55f7XwZDdtMbTKaT3-9v2aR_37-bsvx6MLybsoCzGfs0Hn1mUZAF7I_f-uM-u7kJWIPNblmDhb4_GE7bt-xnJltsNO71x-zXv9iMswA4rOJID4NnnYL_NwjgIIGDAxwUcHDhgcM6iUOdpnGSv-V194FB9C_4TQ6L1XqT5bcfOIRxosF_hWyRLTX4MA1mSz3WQaQTuwkcIp0Fi-XumJyzm__zdf1NvwCHu3i5eV6l_u67cBYCh8k6yG9YtmDBKmKCxdmTTuBhyyHeZMWxaRY8avDFCeegB35zyy9H_bRYZjrRie2ec-7v--zmpitYg3VlbmfXOfXT318Ah9Em81lX8K6shJQlSJcC2Vuk2WIVZrYoubk_k8MoiXSio7chCp3ZC3sK0qe3NB62BatTYhXVjhba8R6hrN3gXdnYq1d_K7fGtypwVRmX5O0kTjKd2LLsrGzwrmhUHuqWDpX1PTqe9AbdMLbitS3PDapi8spM50aIy0srapfWFpYta9VWUGCPtfXet7YeBbIIuPiQ2lY7ep3aetetLcnbQ23LzlJre-6RvLwisn5FpGU7tSoiKbDHirTetyItCmQRJvkhFal29DoVaV23IiRvDxUpO0utyLlHzuUVcepXxLFsVasiDgX2WJH2-1akTYEswuR8SEWqHb1ORdrXrQjJ20NFys5SK3Lukbq8Iqp-RZRlu7Uqoiiwx4p03rciHQpkESb1IRWpdvQ6FelctyIkbw8VKTtLrYiiPJSNdbqOV6m-6LGnWTrKErmbOnrU-18gjTdJqL8kcbh77_5ytBPa3Yh0mu1fFfuLwerwUpolOng-_lHhVEmgSrJayS0rybKSOFVyzpTEqZIwoHCpDiJFpBKqWksSsQTCJYlcEuFyDC4H_Q1V9W_oGFgKlXKrqZRB5eLJ8ggh9VCpVrWSKCu1UKV2tZJXVmrXjrsBhUthcSdSoXEnYqFxJ3KhcTe4Ovj4NZG8G1wCX1Is8AaXwLdUIGMqDS1jH861nGqtlqFl7MPFUTW5cC0sq1QuNKxUMDStVDI0riYZvqnCRfJqkuGriuXVBMNnVSC76hha-LAKZFnbhlb9aTW56m8rlQvNKxUMzSuVDM2rSYbvq8T21SCT9ffVAJM_-L8qsq_K0ML3VSL72jG06u-ryVV_X6lcaF6pYGheqWRoXk0yfF8ltq8mWf19Vfnj2nwZf_-6iMAHx515YSQ8azZvu5ZyZWR1OjNlOXLuRfNm2PGUB_kHgsc0f2acPMXfd7rTl3X-xDcPlqnm8Dn4pns608nzYpU_SIf_v7Ld_vRfAAAA___IBP9x

query T
EXPLAIN (DISTSQL) SELECT c, d, sum(a+c::INT) + avg(b+d) FROM data GROUP BY c, d
----
distribution: full
vectorized: true
·
• render
│
└── • group (hash)
    │ group by: c, d
    │
    └── • render
        │
        └── • scan
              missing stats
              table: data@data_pkey
              spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzUmNFvqkgUxt_3r5icJ41DYGZAhSe6bXdjYrWrNtmbTWNQptZcFRdw7zaN__sNalthLidMtUn70iDgx-_M-b5Dx2dI_l2AB9d_33YvOj1Su-oMR8O_unUyvO5eX47IlJKQkmSzrAWkQaae1-mN2nXSIMF_s9qENEhYJ38M-jckDNKA_Dno392S37_tvgYUVlEoe8FSJuD9AwwocKAggIINFBy4p7COo6lMkijObnnefaET_g-eRWG-Wm_S7PQ9hWkUS_CeIZ2nCwkejILJQg5kEMrYtIBCKNNgvtg9JgPxsz_j9Xf5BBQuo8VmuUo8ElAyoS9ow3WQnTNMRoJVSBiJ0kcZA4WBXIUy9ojPGr7Y10uJzxu-TYkvKPFtuN9SiDbpG16SBjMJHjuqp3MFnrWl1Uu6mM1iOQvSKDadfEW-oH62YBe9b-NefzTu3XW7NV_UlVN2dmp4d1Pz2esRz44u-3e90e44j_729MkTeQySx8KDGfU53G_fKuSFCp3SCt-kN6soDmUsw5z4ThVZA2b9iqVYMVMXgb-WLl6PXhZm3MmWwann2px196W1pu-UdlcUamda7e1FRrQ2WaG1KkUD8ZddJDjz8u8ZuVW489cwTgGG55eDVQ8wOyXAJjNM_nERZjpFHdm3-WUi3Cyt8OQIs08fYa32HiLcPGuE88vPq6eGn5Qabpji41LDdYo6ckzry6SmVVrhyanhnz41Wu09pKZ11tTkl19UT404KTXCMO2PS43QKerIMe0vk5p2aYUnp0Z8-tRotfeQmvZZU5Nffrt6auyTUmMbpvNxqbF1ijpyjPtlUuOWVnhyauxPnxqt9h5S4541Na7ONm8gk3W0SmSlLZRVeJTBsn7JcCb3zU2iTTyVt3E03d27_9jfCe1OhDJJ91fZ_kNn9XIpSWMZLF9_hDhWYkUldqzEc0rsWMnRU2qVKzFNKMYQLU0s5pRrcV0uF9FSuDjaQlHeQqFgCVTKLqcSCpWNSnEdZzmoVLNciRWVmu_1aFNPCfOoJhTqUU0s1KO6XJhHFa4W2sI24lEFq_1ujypULj78rHIsrgRaGaRVrdXSlMK8pYuFmksXDHWXNhlmL5VMmaf5TnLEYCoZPlAxh6lg-ERlNgKmaCkjtarF2ppSmMV0sVCL6YKhFtMmwyymkuFvIYa8hoRKpszWyhZTwfDZypDhaitaynCtajFXUwqzmC4WajFdMNRi2mSYxVQy_H3EkfeRUMg4_p89ZjE32y48LKIf43kIHti87QbTsGVMWtbEsFlTGBOrLQ35YE-skE-clpttDx8WwSzJ9izDx-jHTnf0tM52HA_BIpEUboLv8kqmMl7OV_MknU8PV7bb334GAAD__-IdbTE=

query T
EXPLAIN (DISTSQL) SELECT c, d, sum(a+c::INT) + avg(b+d) FROM data GROUP BY c, d ORDER BY c, d
----
distribution: full
vectorized: true
·
• render
│
└── • group (streaming)
    │ group by: c, d
    │ ordered: +c,+d
    │
    └── • sort
        │ order: +c,+d
        │
        └── • render
            │
            └── • scan
                  missing stats
                  table: data@data_pkey
                  spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzUmF9v8jYUxu_3Kaxz1SqOgp2Eklyla7sJiUIHVNqrqUImcSl6gbAk7F1V8d2n8KclsXyGX9oLbqrgkMfPOf49B6VvkP89gxDu_nzoXLe75OK2PRgO_uhcksFd5-5mSGJKEkry1fxCEIvEYdjuDluXxCLin8nFmFgkuSS_9Xv3JBGFIL_3e48P5Ndvm8dIr397199_AgqLNJFdMZc5hH8BAwocKLhAwQMKPjxRWGZpLPM8zcqvvG0eaCf_QtigMF0sV0W5_EQhTjMJ4RsU02ImIYShGM9kX4pEZk4DKCSyENPZZpvSVlT-GS2_y1egcJPOVvNFHhJByZjurQ2WolyzHUbEIiGMpMWLzIBCXy4SmYUkYlbkbqunJOJW5FESuZREHjytKaSr4sNeXoiJhJAd1NO-hbCxpseXNEizQmaOX60mci0aeZZ2S17b0jfZ8noyyeREFGnmsEZ9XxqVh9TLEpnJJCT7hevut1G3Nxx1Hzudi8i9VJa8cmnweH8RsfcrXl7d9B67w811tZgPP-NX8iLyl5oTRiMOT-uPmt1azUzf5w_tdFtIXduiEbe26lh36qey8XTYnd1CtRVM7Q5_74n7frXv2Khd9se_rEBYsrcHz4l8LQhevSl6Ek5pSje106XDa7Sodi0kJn7NKq-eHzs--uyU6DvMdvjXhZ-ZFLULf_O08DdNtjzEm51x-PV9_qzw10_lDMJfJYEfnyh-UqK47bhflyhuUtQuUVenJerKZMtDZvgZJ0rf589KVP1UziBRVRLc4xPlnpQo13a8r0uUa1LULlGt0xLVMtnykBn3jBOl7_NnJap-KmeQqCoJ3vGJ8k5KlGc7_tclyjMpapeo4LREBSZbHjLjnXGi9H3-rETVT-UMEhWYvPz3Zb5MF7mslKnbqlHbymZl-2QykduW5-kqi-VDlsab724_9jZCm4VE5sX2Ltt-aC_2t_Iik2L-_u-SQyWGKnG9kl9X4nUldqjkVpTYoRJTTOFSLUTK0BXjei1uaIs1ES1DX7yh13IVXy56hh4ipdjycBxMyPJRqaZeidWVmqjSlV6pWVe6-mlGFVO4FMaooSuUUUNbKKOGvlBGFV-tn2ZUsRXgw6-h54Er0-9_BinC-5WipYzSo-FSfeFaGF2mvlC8TI2hfJk6QwFTnSkT9WjCVGP4RGWeHgtX0cJHKvP1Wi1FS5mpRyOm-sK1MMRMfaGImRpDETN1hiKmOsN_iDDEVGPKcK1i0dJj4Sla-HBlgV4rULSU6Xo0YqovXAtDzNQXipipMRQxU2coYoozjv8gYYgF5evC8yz9MZomEILkMkh8P7a9OPFtL2kGdjBmY7s5brmi8TxmfhBD-YCY5OU7y-Al_bHRHb4uyzeOZzHLJYV78V3eykJm8-limhfTeHdnvf7lvwAAAP__742Znw==

# There should be no "by hash" routers if there is a single stream.
query T
EXPLAIN (DISTSQL) SELECT c, d, sum(a+c::INT) + avg(b+d) FROM data WHERE a > 9 GROUP BY c, d
----
distribution: full
vectorized: true
·
• render
│
└── • group (hash)
    │ group by: c, d
    │
    └── • render
        │
        └── • scan
              missing stats
              table: data@data_pkey
              spans: [/10 - ]
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyUkt9u2kwQxe-_pxjNFYi1WP-JIHu1-RKaIhGTAmkbtRFavBPXivG63nXTKOLdK5umDVShzY2lPTNzjn4zfkT7NUeBo4-Xk5NxDJ2z8Xwxfzfpwnw0GZ0uIGGgGdh63VHQg0SIcbwYdqEH6lvaWUEPdBfezKYXoJVT8OHtaDYCBZ9rzkOCYzifTa8u4f_r1gcZFkZTrNZkUXxCHxke4Q3DsjIJWWuqRn5sm8b6OwrOMCvK2jXyDcPEVITiEV3mckKBsfFM2Q-QoSansrxt2zA0tfs9ZJ1KCUX4LGV8hiLYsGdB_uGghVrlNCOlqerznThssGXzWZZ39IAMT01erwsrQDFYsSfueakare9zDxnOqNBUCZB-T4bblTKQQU9GDGTIQEb4Eoe_x8Ffw3GSphWlypmq7-9iyJDJCBmexNfLeLpYxleTSUeG3T-kqJHmVxcd6bfF9-cdGXR3mBqUhqN3ACPYw_B3MP5y9xnZ0hSW_unwfC_J8zc3DEmntP3ZrKmrhC4rk7S92-e0NWoFTdZtq-H2MS6eStZVpNa_rvDcyT_oFLzCKTjoxF92ajlvc3O_zDQK5El0rKOIPD7kvhcNBkNvdaQSj3M-DAYDTnxwhM2ASm2z7PkXc9_aLh7KZlW3KrfE8ELd0Rk5qtZZkVmXJT8rm81_PwIAAP__aj1TzQ==

query T
EXPLAIN (DISTSQL) SELECT sum(a), sum(b), sum(c) FROM data GROUP BY d HAVING sum(a+b) > 10
----
distribution: full
vectorized: true
·
• filter
│ filter: sum > 10
│
└── • group (hash)
    │ group by: d
    │
    └── • render
        │
        └── • scan
              missing stats
              table: data@data_pkey
              spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzMl19v4kYUxd_7KUb3KWjHsmfGBuwn0yS7RSKQAqm6aqNowBOCFjC1jbZRxHevDNsYPPWVJzR_XoL_Hv-u7znXmSdI_1pAAJe_X_c63T45u-iOxqNfew0yuuxdno9JulmeyQbd_U5-_E4b5PNwcEUimUnyZTi4uSY_fyUR-aXzW7f_ZX8L-UQmDfLnxnGEIswBCqs4Un25VCkEfwADChwoCKDgAgUPbimsk3iq0jRO8kuedjd0o78hcCjMV-tNlh--pTCNEwXBE2TzbKEggLGcLNRQyUgldv6gSGVyvtg9JicM8z9362_qESicx4vNcpUGRFIyoWRKSQQURmuZH7NsRuQqIozE2YNKgMJQrSKVBCRkn0JOScgo2f0KSkIXbrcU4k1WkKWZnCkI2EEp3QsInC2tX01nNkvUTGZxYnvHxYT5fqf_9a4_GN_1b3q9s9Br5PQ3V2chf94Sz1vu8xZrlGCL500eyYNMH0qPYnC7LQripYK8yoIK3c0qTiKVqOhIeaeKlMwcDaRcM6tZs1euuahHlOphRh36PF9kKlGJzUoN2p8ISOgVxg-C4OLyvHvV6QGFwSYLcgOFgiL2cct0__Pr7sdWvLa5U7ryv2G8Egw_flWsfjTZKdG0mWXzVwknM6nnwKnNjxrOZmVBJ4eTvUs4jTpUhLP5NuE8ft28fh74SXngli1eJQ_cpJ4Dc7Q-ah5alQWdnAf-Lnkw6lCRh9bb5OH4dYv6eRAn5UFYtvsqeRAm9RyYo_1R89CuLOjkPIh3yYNRh4o8tN8mD8ev262fB_ekPLiW7b1KHlyTeg7M4X_UPPiVBZ2cB_dd8mDUoSIP_tvkwTdZag1Vuo5Xqaq1VHFKj7JY3h8VzdS-mWm8SabqOomnu2v3u4Od0O5ApNJsf5btd7qrf0-lWaLk8nktf6jEykrsUIkfKbFDJc9MqVWtxAyhGEO0DLGYV63FTbl8REvj4mgLRXULhYYlUCm3mkpoVC4qxU2c5aFSzWolVlZqvtSjTTMlzKOGUKhHDbFQj5pyYR7VuFpoC9uIRzWs9os9qlH5-PBzqrG4FmhtkNa1VstQCvOWKRZqLlMw1F3GZJi9dDJtnh53kiMG08nwgYo5TAfDJypzETBNSxupdS3WNpTCLGaKhVrMFAy1mDEZZjGdDP8KMeQzJHQybbbWtpgOhs9WhgxXV9PShmtdi_mGUpjFTLFQi5mCoRYzJsMsppPh3yOOfI-ERsbx_-wxi_n5cuF-EX-_m0cQgKvavh_xe0uJyLFch7WttvQ9y1c-b6qJ8FstAfkNcpbma5bRQ_x9pzt-XOcrjnu5SBWFK_lNXahMJcv5ap5m8-mPM9vtT_8EAAD__4BaQmw=

query T
EXPLAIN (DISTSQL) SELECT avg(a+b), c FROM data GROUP BY c, d HAVING c = d
----
distribution: full
vectorized: true
·
• group (hash)
│ group by: d
│
└── • render
    │
    └── • filter
        │ filter: c = d
        │
        └── • scan
              missing stats
              table: data@data_pkey
              spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzMl19v4kYXxu_fTzE6V0E7lpnxP2xpJfIm2S0SgRRI1VUVoQFPCFqCqW26jSK-e2WTEttTn_WAInGDzNg8_p0zz3PQvELy5woCuPn9rn_ZG5CL6954Mv613yLjm_7N1YSIvxYXgnwisxYlc_JlNLwloUgF-Toa3t-R_38jc0pC8svlb73BVzInn0kIFNZRKAfiWSYQ_AEMKHCgYAEFGyg48EBhE0dzmSRRnD3ymv-gF_4NQZvCcr3ZptnyA4V5FEsIXiFdpisJAUzEbCVHUoQyNttAIZSpWK7y12RU3exjuvkuX4DCVbTaPq-TgAhKZjTnBArjjcjWDJMRsQ4JI1H6JGN42FGItun7m5NULCQErIDau4agvaPNab8sV6mMZWw6ZdT9ekC6FvlMullPRnId5ivsU5dT0rVotl4HxStQjg7U5WIRy4VIo9hklRZ2sy26HHybDoaT6eC-37_oWq2sZ_e3F12WXV0N7weTt-vyg7xVwX1_4-yFPInkqfIuBg-795KsSkmsvtHvwtt1FIcylmFJOpfFqnYUkmox7FA1f7ua9rK6LbVuu1XcPm7-ZOvsap31e3dUnYPIiDYmb1ee_G8YpwLDy01nzbPITsmiyQyTH5VGpsN7SKP7sWl0daCKvmTnm8b6Rp-cRvec0ljeO948APykAHDDtI4KANfhPQTA-9gAeDpQRSvw8w1AfaNPDoB3TgEo753VPADWSQGwDNM-KgCWDu8hAJ2PDUBHB6poBet8A1Df6JMD0DmnAJT3zm4eAPukANiG6RwVAFuH9xAA_2MD4OtAFa1gn28A6ht9cgD8cwqAr3OYHMlkE60T2ei40a68ymBZY2S4kPsuJtE2nsu7OJrnz-6_DnOhfCGUSbq_y_Zfeut_byVpLMXz4YBeVGKoEq9XcqpKvKrEikpWSYkVlZgChUt1EClNKsbrtbgmFnMRLU0u3q7XshQuC91DG5FSsGzcDjrOclApt16JVZVcVMmrV3KrSt7RHlWgcCnMo5pUqEc1sVCPanKhHlW4Okd7VMHy8eHXrvcDV6bfTwYp4ndP0VJGaWNzqVy4FuYuXS7UXrpgqL90yVCDqWTKRG3sMBUMn6jMrreFpWjhI5U59VodRUuZqY0tpnLhWpjFdLlQi-mCoRbTJUMtppLhf0SYxVQwZbiWbdGpt4WtaOHDlfn1Wr6ipUzXxhZTuXAtzGK6XKjFdMFQi-mSoRZTyDj-h4RZzM-OC4-r6Md0GUIA3uyROUJ6Rui5zLAld41Zx28bluu4jzPf8Touh-wHYpFkZ5bxU_Qj1528bLITx6NYJZLCrfgur2Uq4-flepmky_nbnd3uf_8EAAD__8obNqE=

query T
EXPLAIN (DISTSQL) SELECT sum(a+b), sum(a+b) FILTER (WHERE a < d), sum(a+b) FILTER (WHERE a = c) FROM data GROUP BY d
----
distribution: full
vectorized: true
·
• group (hash)
│ group by: d
│
└── • render
    │
    └── • scan
          missing stats
          table: data@data_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzMl2Fv4jYcxt_vU1j_V1TnKDh2AkQ6Kd2V25AodEC1nbaqMomh6CBmcdCtqvjuU8JdCcnFxaCqfYMcxzx-Hv9_lp0nUP8uwYfuXzf9y94ANa5648n4j_4FGnf73U8TpDarBkcf0PQCF9roc68_6Y5Q48_fu6Mu4uifTbNJQxTpR31E4QX6PBpeo4inHP02Gt7eoF-_oAgwxDISA74SCvy_gQAGBzBQwMAAgwt3GNaJDIVSMsmGPOV_6EX_gd_EsIjXmzTrvsMQykSA_wTpIl0K8GHCp0sxEjwSid0EDJFI-WKZT5O5CLKf-_VX8QgYPsnlZhUrH3GMphiFOLc2XvOsz7IJ4nGECJLpg0gAw0jEkUh8FJAPgYNRQHbLELCs_TGgGAUM7rYY5CbdG1QpnwvwSSFR7wr85hYfH-pyPk_EnKcysd3DTEG2XpeDL_eD4eR-cNvvNwJ2kYW4vW4EpND6UZ3A-UkfLdnezzx9RA9cPZQmJXC33UdzStHc2mh73U0sk0gkIjpQzlU14UmzYqScfp_ZeW7R51a-NsNN6qPAwQHFmoLRUipSX7GTYg2kJdc2cUsjf26Glc0crjE5fk-Qc_aETSzbec1dQUxiFcDw3v-u8Gqjnb0ryBvuisOKOceD6JwFomPZ9DVBdExiFWrRev8gtmqjnQ2i84YgHlaMHg8iPQtEatnsNUGkJrEKtWi_fxDbtdHOBpG-IYiHFWPHg8jOApFZtvuaIDKTWIVadN4_iJ3aaGeDyN4QRGbyiTESai1jJY66jjZLU1kkWwcRzcVu0ZTcJKG4SWSYj909DnOhvCMSKt29JbuHXvzjlUoTwVfPX0hFJVJWIkUl50CJFJVcMyWvXokYmupopAxdEU1Ax9AWcTVaFV-OtoK0XopWbFE9DJ4BDUwr5dYrkbKSeypXnpmSjitDUzquDF1puTK0peWq4ss7mauKrZZWql0Pg1NWap8KQ8tMSQeDoSkdDIautDAY2tLCUPHVORmGii3ywpGjOXNoRevkQ6dtKKUDwtSWjghTX1okTI1pmag6O_3kqRp74ehh9VCwilbl7DkWio6hlA4KU1s6KEx9aaEwNaaFouqscgQdDQXLbqmzpfx2v4jABxoSMaN0ZomZ17YYcz1ryqmwyCyinZC1PdLKru-zJZ-r7Ko8fpDfct3J4zq76M74UgkM1_yruBKpSFaLeKHSRfj9zXb7y_8BAAD__8W_-dg=

# Same query but restricted to a single range; no local aggregation stage.
query T
EXPLAIN (DISTSQL) SELECT sum(a+b), sum(a+b) FILTER (WHERE a < d), sum(a+b) FILTER (WHERE a = c) FROM data WHERE a = 1 GROUP BY d
----
distribution: full
vectorized: true
·
• group (hash)
│ group by: d
│
└── • render
    │
    └── • scan
          missing stats
          table: data@data_pkey
          spans: [/1 - /1]
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyUkmFP2zwQx98_n-J0r1rhqHFS-tBISGZQtkolZWnQhjZUufEli0jjLHbEEOp3n5KOUdDoxpvo_L_L__y78wOa7wUGOPl8OTuZhtA7my7ixcdZHxaT2eQ0BtOsexIOYNVnOzGcT2fxJILepw-TaAISvjau6yeg9lcdQ9KH82h-AUpaCU8yh_fR_OoS3l2DQoalVhTKNRkMviBHhh7eMKxqnZAxum7lh65oqn5g4DLMy6qxrXzDMNE1YfCANrcFYYChdnQ18JChIivzoivbMNSNffrJWJkRBv5Ol-kZBt6G7TTi-xvFclVQRFJRPXCftcMWV7SfZXVL98jwVBfNujQBSAYrBgnruBeVbLUBd7r7RlQqqgMQ_EB4DATfTlkM2_hY-AzEEF9D4S9Q3LegnGRZTZm0uh7w5yRiiAxPwutlOI-X4dVs1hPDfnv1q4ue4DvR4_KF9wfNR4bzxgYgPCZ8tgfDe4HBn2H8ZfURmUqXhv5p9-6LTg7f3DAkldH2vRnd1Ald1jrparfHeWfUCYqM3Wb97WFaPqaMrUmuf29h14nvdfLe4OTtdXJfd-o400LfLXOFAY5WKj1MXddJ1WjsDP_3V86Y6NAZ06Ecj45GR0q2byItZGbaYS--6bvONr6v2lGlsjDE8ELe0hlZqtd5mRubJ78ym81_PwMAAP__q_NfQg==

# Verify the XOR execution plan
query T
EXPLAIN (DISTSQL) SELECT xor_agg(to_hex(a)::bytes) FROM data
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • render
    │
    └── • scan
          missing stats
          table: data@data_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyslVtvokwYx-_fT0GeqzYZgsNJ5ap9W7cx6WnVi242xkyZR0qKjDszpm0av_tmtN0CuxJBb4ww8D_85sA7qF8ZRDB4uL8-H95aJ5fD8WT8_frUGg-uBxcT61XIGUuSEy1mT_h6wk6j6P8fk8H41Po2uruxONMMCOSC4y1boILoJ1Ag4AIBDwj4QCCAKYGlFDEqJaR55H3zwpC_QtQhkObLlTa3pwRiIRGid9CpzhAimLDHDEfIOEqnAwQ4apZmGxtjfWZ-ZstnfAMCFyJbLXIVWSbReMnMX9uhFsu5RS2hn1ACgRHmHGVkfRQ6o5-NYLomIFb6K4zSLEGIaCH98BKizprsX-A8SSQmTAvpBOX8D3ej2fnVlUmw09qtWAc7rb8cV7mQHCXykt10XR-Odpqn8yrpaJkM3X9qaYupdajtuEefXNqkQoFfePjkhiVrd396bht6ru14R6fnNqlQoNc9nF63ZO3tT89rQ8-zHf_o9LwmFQr0eofT65Ws_f3p-W3o-bYTHJ2e36RCgV7_cHr9Jl-EEaqlyBVWjud_O3UqTjY15zjyBLeHvhIrGeO9FPHm2e3l3UZoc4Oj0ttRur0Y5p9DSktkiz8ftKISrVVyS0q0qBRUldz6TE1CebVS_m4lWlXy29YLq0pBrVK4O5NbVQrbZupWlbq1Sr3dmbyqUq9tpl5VqV-_DDq7Q_l_rc36ZV6Tqm-2zjwTL7OUQwQeC_u--9i33d48sP24O7cZRW7HHgac-XMWhOZgnWcsUWb_jp_Ey0Z28rY0u2_OMoUEbtgzXqJGuUjzVOk0_hhZr__7HQAA___ftq0b

# Verify the XOR execution plan
query T
EXPLAIN (DISTSQL) SELECT xor_agg(a) FROM data
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • scan
      missing stats
      table: data@data_pkey
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJykll1vokwYhs_fX0GeozYZgjOAfBy1afs2Jv1a9aDJxpip80hJkXFnxrSN8b9v0N0tsAsRPDHC4H1fXvOhW9A_Mojh5vnp7nL0YJ1djybTybe7c2tyc3dzNbU-pJrzJDnj59b_48d7S3DDgUAuBT7wFWqIvwMFAgwIuEDAAwI-zAislVyg1lIVj2z3HxiJD4gHBNJ8vTHF7RmBhVQI8RZMajKEGKb8JcMxcoHKGQABgYan2b6mqL4oXubrN_wEAlcy26xyHVsF0WTNi7e2Qy2eC4ta0ryigtmOgNyYr0JteIIQ0xLh6BriwY4cD3mZJAoTbqRy_Crj8-N4fnl7e3ZBzxurWa3ab6z-atzkUglUKCp1s107HB10p3NrdLRqhh4_fbTH9DnUdlivCaRdMEuOhqdP4LBSzY43xPoYYrbj9jLEumCWDAWnGwoq1e7xhtw-hlzb8XoZcrtglgyFpxsKK9Xe8Ya8PoY82_F7GfK6YJYMRacbirqc0GPUa5lrrB2X_24a1JpsWpyrKBI8HMJabtQCn5Rc7J89XD7ug_Y3BGpzGKWHi1H-e0gbhXz15wemnERbk1gliZaT_HoSa2fqAuW2RnnNSbSe5PX9esN6kt-aNGxmYvWkYV-moJ4UtCaFzUxuPSnsyxTWk6L2ZTBohvL-Wpvty7yFKiq2zjKT7_NUQAzMZ65ARFuwMLK9MFzake9Tm4owevECGgRY_E1YZjzRxf6dvMr3fez0c13sviXPNBK45294jQbVKs1TbdLFr5Hd7r-fAQAA___7y31D

query T
EXPLAIN (DISTSQL) SELECT max(t.a), min(t.b), avg(t.c)  FROM (VALUES (1, 2, 3), (4, 5, 6), (7, 8, 0)) AS t(a, b, c) WHERE b > 3
----
distribution: local
vectorized: true
·
• group (scalar)
│ estimated row count: 1
│
└── • filter
    │ estimated row count: 1
    │ filter: column2 > 3
    │
    └── • values
          size: 3 columns, 3 rows
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyUklGPmkAQx9_7KSbztCTrHbvoaXmSVq4lUe8q1l7SmmaFOY4cgmWX3jXG794Ara0mmru33ZnhNz_-sEX9I0MX_bvbsRdMgY2CcB5-GlsQ-mP__RzW6pmZC2VxWKc5Mxcri4P6mTBzEVlwPbuZAFt4489-CExwkBwciwPrcuhxuKqPfQ4DDrZlgReCAaY4rDhEFnz56M98WMG3yrYdAgc55kVMU7Umje5XFLjkuCmLiLQuyrq0bQaC-Bldm2OabypTl5cco6IkdLdoUpMRurhQWUX60kaOMRmVZi1xAO-AORA9VPmjtnC541hU5h9GG5VQA9_vDUbo2jv-8tXXaWaopPJSHC5v6y4M5f6NXdcNpvPBSQ9x5CFe4-ElSUmJMkV5KQ9NJt4dGwoLOU6CKRvK-uQtPrChczoSeaQiX6MyI70pck0HGi8NvyN2S44UJ9T-ArqoyohuyyJqZtvrTQNqCjFp03ZFewnyvy1tSlLr_Rf9nyTOkuRpkjgmybMk55zTkuN9Vjx9T2N0MXJ61Bf9q4607VWnK51-563sRZ2uTaJPXekM7C7WD6hE12GHD8VTg53_2tRR3atME8eJeqQRGSrXaZ5qk0Z_Orvdm98BAAD__3V_PC0=

query T
EXPLAIN (DISTSQL) SELECT * FROM (VALUES (1, '222'), (2, '444')) t1(a,b) JOIN (VALUES (1, 100.0), (3, 32.0)) t2(a,b) ON t1.a = t2.a
----
distribution: local
vectorized: true
·
• hash join
│ estimated row count: 2
│ equality: (column1) = (column1)
│
├── • values
│     size: 2 columns, 2 rows
│
└── • values
      size: 2 columns, 2 rows
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyck19v2jwUxu_fT3F0bkheGRo7oaKRKsEG06godA2rJk1ocpMTiBpiZjvqJsR3n5J0LaB1G7uLz5_f4-dRvEXzNccQR59uJoPxFJzhOJpHHyYuRKPJ6O0c_od3t7NrcO4Gk4-jCBzOoCWEaLkMHMGgFQRBy3VhEIHl4EgG9y5czSrS3gb3vI5XbfgMfNHxnhbEz4XZFCzvSLgEKzoSGRYqoalck8HwM3JcMNxoFZMxSlelbT0wTr5h6DHMik1pq_KCYaw0YbhFm9mcMMQ7mZdkzjxkmJCVWd4QA3gDjoB4VRYPxsXFjqEq7QvGWLmkGv6sOx5i6O3YydL8SPr836T5q9IvimWhdEKakgPJRbX5p5Ff3P-9NKsrlRWkz8Shh5xS6_S5e6mz5ar-Qoaz0obQ56wvWN9n_eBVZ_zImTgl1FsyG1UYOnb4Vxm2eeWTkiU1uRlV6phutIrr2eY4q0F1ISFjm65oDuOibvFKQZNcP_8T-yR-Aknsk_gxSfyW5B-QvMM7LRimuXr8kiUYon9BXtxN_fZ5L6V2kPqi3ZO9bjtIJI_vgwvZ61aPLs3l0lRhRyv1WGPn3zdVVKnMDTG8lg80JEt6nRWZsVn81Nnt_vsRAAD__yPVVR0=

statement ok
CREATE TABLE nullables (a INT, b INT, c INT, PRIMARY KEY (a))

query T
EXPLAIN (DISTSQL) SELECT array_agg(a) FROM (SELECT a FROM data WHERE b = 1 AND c = 1.0 AND d = 1.0 ORDER BY a)
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • filter
    │ filter: ((b = 1) AND (c = 1.0)) AND (d = 1.0)
    │
    └── • scan
          missing stats
          table: data@data_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzMlV1v-jYUh-_3KaxzFTRniZMAwdIkskI7JApdQNqqCSGDD2nUQJgT1FUV330KUNpk_0S83HCDsB1-fs7DcfwByT8RcOj-9dT3egOidXqj8eiPfo2Muv3u3ZgIpcT7VASBJmrk3h8-Eu1zZT-UIhXkz9-7fpdo2oz8SliNeIMO0ebZ91_M2mEoD0My9Dtdn_z2TEQNKKxiiQOxxAT438CAggUUbKDgAIU6TCisVTzHJIlV9sjH7gc9-S9wk0K4Wm_SbHpCYR4rBP4BaZhGCBzGYhahj0KiMkygIDEVYbTbJkNuZx_T9Su-A4W7ONosVwkngpIZJXNKJFAYrUU2pxuMiJUkjMTpCyqYbCnEm_Rr5yQVAQJn31B7HeDmlp5Oex9GKSpURj2Pup_nRNPaViaQc94bjN2D07a9l8o5v-8PvbH7KbvtHBc63bveo9fPXA83KSdtVlqBVaigXlrBF3isJCqUeeo2-xkm2x-U6QWBwkCksTJY4U_xfN97nnoPD1qb1UoR7QIiy1tmp_cEu6YnDKYb1kVdwc7hPXZF44a6opGrwDrduHWVcUs37IuMW-fwHo03b8h4M1eBfbpx-yrjtm44Fxm3z-E9GndvyLibq8A53bhzlXFHN-oXGXfO4T0ab92Q8dY5t6WPyTpeJZjjL9vJLOyks-xmQhng_iZL4o2a45OK57tn98PhLmg3ITFJ96tsP-itPpeSVKFYHi_770msMsnKJbHvSfViklXNdA6UXRnllCexYpJzaXmNYlK9MqlRzmQVkxqXMjWLSc3KJLecyS4muZcyucWkVnUbmOVQzv96s7rNK6ha2dFZRPHbNJTAoWmZMzQdqVtSWLrj2k29tVhIHS1T2vVmi80a2QtxEYkgyc7v6CV-28WO39fZ6VuIKEEKj-IVO5iiWoarMEnD-WFlu_3pvwAAAP__8wHoNg==

query T
EXPLAIN (DISTSQL) SELECT json_agg(a) FROM (SELECT a FROM data WHERE b = 1 AND c = 1.0 AND d = 1.0 ORDER BY a)
----
distribution: full
vectorized: true
·
• group (scalar)
│
└── • filter
    │ filter: ((b = 1) AND (c = 1.0)) AND (d = 1.0)
    │
    └── • scan
          missing stats
          table: data@data_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzMld9u4jgUh-_3KaxzFbTOBicBgqWVYAvtsqLQBaSZ0QghB5s005AwtlGnqnj3UYDSJjOJ-HPDDcJ2-Pk7Hyc6r6C-R0Ch-_mh3-4NkNHpjSfj__sVNO72uzcT9E0l8YwFgcEq6HY0vEfG_oDtlpxphj792x11kWH46G9EKqg96CBjnn7_q1rZL_l-iYajTneE_vmCWAUwxAkXA7YUCuhXIIDBBgwOYHABQw2mGFYymQulEpk-8rr9QY__AFrFEMartU63pxjmiRRAX0GHOhJAYcL8SIwE40JaVcDAhWZhtL0mRW6lH7PVk3gBDDdJtF7GiiKGkY_RHCMOGMYrlu6ZFkEs5oigRD8KCdMNhmSt329WmgUCKPmA2usArW7w8bS3YaSFFNKqZVF3-xQZRstOBVJKe4OJt3facnZSKaW3_WF74r3JbrmHg073pnff7qeuh2tNUYsUVmDnKqgVVvAOnkgupOBZ6hb5E6ab35TZDgIpAqYTaZHcn_LfeDiYte_ujBapFBI6OUKSlUyObwlySUtYxLTss5qCnMJ7aIr6FTVFPVOBfbxx-yLjtmk5Zxm3T-E9GG9ckfFGpgLneOPORcYd03LPMu6cwnsw7l2RcS9TgXu8cfci465p1c4y7p7CezDevCLjzVOG5UioVRIrkeEvuqmau8kk6WASPBC7QaaStZyLB5nMt8_ulsNt0HaDC6V3p2S36MVvR0pLwZaHWf8xiZQm2Zkk8jGplk-yy5lOgXJKo9ziJJJPcs8tr55PqpUm1YuZ7HxS_VymRj6pUZrkFTM5-STvXCYvn9Qsb4NqMZT7S2-Wt3kJVTN9dRZR8jwLOVDw7Jrt1zk367bjm64vmOlx4pvMs_3mgnvEaaZDfxGxQKXv7_gxed7GTl5W6du3YJESGO7Zk-gILeQyjEOlw_n-ZLP542cAAAD__6FC5-w=

# Test that orderings on GROUP BY columns are propagated through aggregations.
statement ok
CREATE TABLE sorted_data (a INT PRIMARY KEY, b INT, c FLOAT, INDEX foo(b))

# Split into ten parts.
statement ok
ALTER TABLE sorted_data SPLIT AT SELECT i FROM generate_series(1, 9) AS g(i)

# Relocate the ten parts to the five nodes.
statement ok
ALTER TABLE sorted_data EXPERIMENTAL_RELOCATE
  SELECT ARRAY[i%5+1], i FROM generate_series(0, 9) AS g(i)

# Verify data placement.
query TTTI colnames,rowsort
SELECT start_key, end_key, replicas, lease_holder FROM [SHOW RANGES FROM TABLE sorted_data WITH DETAILS]
----
start_key                end_key       replicas  lease_holder
<before:/Table/106/1/9>  …/1/1         {1}       1
…/1/1                    …/1/2         {2}       2
…/1/2                    …/1/3         {3}       3
…/1/3                    …/1/4         {4}       4
…/1/4                    …/1/5         {5}       5
…/1/5                    …/1/6         {1}       1
…/1/6                    …/1/7         {2}       2
…/1/7                    …/1/8         {3}       3
…/1/8                    …/1/9         {4}       4
…/1/9                    <after:/Max>  {5}       5

query T
EXPLAIN (DISTSQL) SELECT a, max(b) FROM sorted_data GROUP BY a
----
distribution: full
vectorized: true
·
• group (hash)
│ group by: a
│
└── • scan
      missing stats
      table: sorted_data@foo
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyUUu-PmkAQ_d6_gswnTZYI6JGTT9rTNiSIVrjkLo0xIztQUmDp7pq7xvC_N2B_qIn27uObmX3v7Zs5gPpRgAfzp1Uw9UOjN_OjOPoS9I1oHswfYgOZUeJrb9c3Pq2XC0MJqYlvOWo0Pq-Xjyvj47OBwKASnEIsSYH3FWxgcAcbBrUUCSklZFs-dEM-fwXPYpBX9V635Q2DREgC7wA61wWBB6EwRT1wgAEnjXnRjTUMxF7_e6Q0ZgTe8ETFn4HnNOxEyL4tFOOuoDUhJzmwzuTg5KeTVAhg8CCKfVkpr81kBwyiGltkwjVr9oU16z3WplkmKUMt5MA-dzZp8TR83obLeBs-BkFvYveBwWL61Js4_at2nAs79pmd_6xkTaoWlaI37cS6UDLtZsOAeEbHO1BiLxNaSZF0s0e47Ii6Aielj93hEfjVn5bSkrD8m-Ypk32TyXkHk3OTybrO1P0zLcTLNufgwdi1U3fo3JspDl1zRO69iWMam7uRhS6Nhnd81B5SWmCm2rCjb-Klo41_1m1UKRaKGCzwO81IkyzzKlc6T353mubDrwAAAP__rh00mw==

query T
EXPLAIN (DISTSQL) SELECT a, max(b) FROM sorted_data GROUP BY a ORDER BY a
----
distribution: full
vectorized: true
·
• group (streaming)
│ group by: a
│ ordered: +a
│
└── • scan
      missing stats
      table: sorted_data@sorted_data_pkey
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzMl12L6jgcxu_3U5T_lbIpNX3xpVe6o7sIjs6qAzMsItHEF6Yat6nMDIPf_dB6zrG2NNOUIt41bX36e5IfJH6B-N8DF3ovT4NOf6hVuv3JdPLvoKpNeoPew1QjSNuRj8qiqv09Hj1qgvsBo3NKAqL9Mx49P2l_vWpEG427vXF0CQj2nLIh2TEB7n-AAYEJCCxAYAMCB2YIDj5fMiG4H77yFf2gTz_ArSHY7g_HILw9Q7DkPgP3C4Jt4DFwYUoWHhszQplv1AABZQHZetFnYlzt2PX88MY-AcED9467vXDDOgtAMDmQcKQbWCN7qmGNBxvmw-yEgB-DC4EIyJqBi2PI_S64tRPKT91Zr322JgH3Decauh1OzsinzGfU1aJRZ_g6H46m8-HzYFBp4yogeOy8VNpmNQF3yV98ahsiNqno2elSwEwUcDILXHL5GSyZ--c5WNIS18qrealgJSrg7EUo2mHIdX4w8PUqZfHYSZ7rOcX5VcZlqGxg3TALyYxVuGPLXL8XmeuZBcqQGd9E5utFMPPLY5Yij6kbViF5TBXu2LQ27kWeRmaBMuQxbyLP9SJY-eWxSpHH0g27kDyWCndsWpv3Ik8zs0AZ8lg3ked6Eez88tilyGPrhlNIHluFOzatrXuRp5VZoAx57JvIY6schMdMHPhesFzHq1riUzoOGzO6ZucZEvzoL9mTz5fRu-fhKAqKblAmgvNTfB70978eicBnZPf7HB9PwskkHE8yr5JwPMlRS6pnJ2FFqJYkSpEKSwqailjYkWSluEzpClrZUVYKy5LLUFewwZZGOdlJOJnkFPWqrpYk80oRSuaVIpXUK0UsqVcprnphr1JYDWlUM1sGM5nULCpDQy1JJoMilEwGRSqpDIpYUhlSXK3CMqSw8DdbjmTPsVJZhTedpmKUTAhVLJkRqlxSJVTBpE6kyYrvPGmwb7YeO1sKO5WV2nvyStFSjJJJoYolk0KVSyqFKphUijRZagvKLYUdnlJXHn-fbym4sFotWK21auoOo0S3qdnQF0t7pRPHosua1aALM_wzu_LIWoRH5cmGv0e5089DeNBdEU8wBI_kjXVZwPzddr8VwXb588np9MePAAAA__9EFaa-

query T
EXPLAIN (DISTSQL) SELECT c, min(b), a FROM sorted_data GROUP BY a, c
----
distribution: full
vectorized: true
·
• group (streaming)
│ group by: a
│ ordered: +a
│
└── • scan
      missing stats
      table: sorted_data@sorted_data_pkey
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzMl11v6jYYx-_3KaznqmiOgp0XQq7oTrsJiUJXONKOpgqZxFB0IGZx0FlV8d2nhG2EhLhxlIvckRf-_j32z3qcD5B_7cCHxz-eJ_fjKbp7GM8X898nPTR_nDx-WaAAo_02ulv1MGLo15fZE5IiTni4DFnC0G8vs6_P6JdviGEUAIZIhHzK9lyC_ycQwEABgwUYbMDgwCuGQywCLqWI01c-sj-Mw7_B72PYRodjkt5-xRCImIP_Ack22XHwYcFWO_7CWchjsw8YQp6w7S4bJsczyv1eHr7zd8DwReyO-0j6KeLqTDk_sPSGYRLEohARJJI3HsPrCYM4JhcImbANB5_kqMcP4PdPuD74_WYT8w1LRGw619yjdH5mcchjHvoou7qffltOZ4vl9OtkcjciPcDwNJ7ejWiv9NDqFXgvQ67e0RuTb6XRXk-XmmihJqeypkuuOLMWc38-BysKJ_2WK8cwOyY-Gll4RHFW2e2VswpVkuqlu4Afo1uF3qxxKgxxMIlTePM2jF2EuZ5zUn8DkJY2gEkMkzbaAkQHPWeC2-Et4FbW1MYWIF3ZAtdLR-tbR9uyjhqm1cg6qoOem_xBh60bVNbUhnW0K9ZdL51V3zqrLessw7QbWWfpoOcm3-uwdV5lTW1YZ3XFuuuls-tbZ7dlnW2YTiPrbB303OQPO2zdsLKmNqyzu2KdrfN98MLlQUSS1zpC9gtDGSSdFB5u-HkSpTjGAX-ORZC9e76cZUHZjZDL5PyUnC_G0X-PZBJztv__8yafRIpJJJ9Er5JIPsnRS3Krk4gm1FARpUlFFAVSTSziKLJKXFS5glZ1lFXCstQyuBo22MoopzqJFJOcpl65ekkqrzShVF5pUim90sRSelXicht7VcIaKKO8ahloMclrKsNAL0klgyaUSgZNKqUMmlhKGUpcw8YylLDIJy1H0XOsUlbjpuNpRqmE0MVSGaHLpVRCF0zpRJmseecpg33SeuxqKexSVqn31JViqBmlkkIXSyWFLpdSCl0wpRRlslILqi2FnZ5S1zvxY7kNwQe6Yi5nrmf0vbVn2OtVYLChOzA4dcMhWweuN6CQ_oFtZHpUnr-JH1nu4v2QHnTXbCc5hif2nT_whMf7bbSVyTb498np9NM_AQAA__-37-zL

query T
EXPLAIN (DISTSQL) SELECT c, min(b), a FROM sorted_data GROUP BY a, c ORDER BY a
----
distribution: full
vectorized: true
·
• group (streaming)
│ group by: a
│ ordered: +a
│
└── • scan
      missing stats
      table: sorted_data@sorted_data_pkey
      spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzMl19v6jYYh-_3Kaz3qmiOgp1_JFd0p92ERKEDjrSjqUImMTQ6ELM46Kyq-O5TwjZCsvjgKFO5a2Ly8_O-fiy77yD_2EIAj789j-9HE3T3MJov5r-Oe2j-OH78tEAhRrs4uVv1MGLo59n0CUmRZjxaRixj6JfZ9PMz-ukLYhiFaDp7eJwVT4AhERGfsB2XEPwOBDBQwGABBhswOPCCYZ-KkEsp0vwn78UHo-hPCPoY4mR_yPLXLxhCkXII3iGLsy2HABZsteUzziKemn3AEPGMxdtimhLasPT3cv-VvwGGT2J72CUyyGlXGIWAYb5n-QvDJIglESJIZK88hZcjBnHIzhAyYxsOASlRjx4g6B_x9eD3m03KNywTqelccg_z_kzTiKc8ClDxdD_5spxMF8vJ5_H4bkh6gOFpNLkb0l5t0OpVeM9Trt7QK5OvtdlejueaaKUmp7Gmc644sVZzfzwFKwon_f-18nNVVqUq0rxUbcuaCEPsTVJZy-khC9DQwkOKi0b_N55dxbvsOrl-C5COtoBJDJO22gREB73kgnvDm8BtrKmLTUA-ahNcLhW93jLalWXUMK1WllEd9FKzvRu2zGusqQvL6EdZdrlU1vWWWV1ZZhmm3coySwe91OzBDVs2aKypC8usj7Lscqns6y2zu7LMNkynlWW2Dnqp2f4NW-Y31tSFZfZHWWbr3PBnXO5FIvkFbNNU_cpUBsmbwKMNPzVNikMa8udUhMVvT4_TIqh4EXGZnUbJ6WGU_DMks5Sz3b__oJSTSDWJlJPoRRIpJzl6SW5zEtGE8hVRmlREUSDVxCKOIqvGRZUraDVHWTUsSy2Dq2GDrYxympNINclp65Wrl6TyShNK5ZUmldIrTSylVzUut7VXNSxPGTVoloFWkwZtZfD0klQyaEKpZNCkUsqgiaWUocblt5ahhkW-c-QozhyrltX60BloRqmE0MVSGaHLpVRCF0zpRJ2s_clTB_vO0WM3S2HXsmpnz7VS-JpRKil0sVRS6HIppdAFU0pRJ6sdQVdLYee31PVWfFvGEQTghyHxvZVluDTyDHvt-Abz1sRYD7jvhp4_oN4a8g_YRuZX5fmr-FbkLt72-UV3zbaSY3hiX_kDz3i6i5NYZnH498jx-MNfAQAA__9jROA5

query T
EXPLAIN (DISTSQL) SELECT b, max(c) FROM sorted_data@foo GROUP BY b
----
distribution: full
vectorized: true
·
• group (streaming)
│ group by: b
│ ordered: +b
│
└── • index join
    │ table: sorted_data@sorted_data_pkey
    │
    └── • scan
          missing stats
          table: sorted_data@foo
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJyUkt9u2jAUxu_3FNa5AslR4wTomitYYRMTJAyo1GpCyNiHLGqIM9uorRDvPiV0W4gUNu58_vj7fj4-BzA_Uwhg9DibDMYhaQ3Hi-Xi26RNFqPJ6H5JNpTs-GtLtMnneTQlRmmLci255f2tUuTLPHqYkU9PZAMUMiUx5Ds0EHwHBhS6sKKQayXQGKWL9KFsGstXCFwKSZbvbZFeURBKIwQHsIlNEQIIlaPyGx8oSLQ8Scu2IwW1t38vGctjhKBTcRkPIfCPtGLELhst-SbFOXKJ-sY9s4Paa4HCvUr3u8wEhNPyyYucF5EDFKK9DUifQRMkq0G610B-VUn2zsiaGSvndf6Mb1XgDSWikc2rsbFr2AZxrDHmVukb75ytX7BGWqJGWc6GwiB8WofRch0-TCatPmsDhengsdX32o1wfg3OO4P7xxrN0eQqM_hfe-TWnBx2XFFAGeNpd43aa4EzrUTZewqjUqhMSDT2VO2cgnH2u2SsRr778-9VJXZRybtCybuo5DcrsbqSf1HJbVbyioltU_WyTiQEIFwh2C1zHb-HvtO52zDnjn9Ep4e3na5we6wju1Bc4LEpvm3xQ72Ussu3vBj6lqcGKUz5Mw7Rot4lWWJsIt4rx-OHXwEAAP__hTuJhQ==

query T
EXPLAIN (DISTSQL) SELECT * FROM (SELECT a, max(c) FROM sorted_data GROUP BY a) JOIN (SELECT b, min(c) FROM sorted_data@foo GROUP BY b) ON a = b
----
distribution: full
vectorized: true
·
• merge join
│ equality: (a) = (b)
│ left cols are key
│ right cols are key
│
├── • group (streaming)
│   │ group by: a
│   │ ordered: +a
│   │
│   └── • scan
│         missing stats
│         table: sorted_data@sorted_data_pkey
│         spans: FULL SCAN
│
└── • group (streaming)
    │ group by: b
    │ ordered: +b
    │
    └── • index join
        │ table: sorted_data@sorted_data_pkey
        │
        └── • scan
              missing stats
              table: sorted_data@foo
              spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzMmF9v2kgXh-_fT2GdK3g7CGb8B2OpEtk2u6JKIJukUqtVFBk8EFRgWNuojSK--8qQLtgnc-yhJMtdDPaT3zmeZ2aYJ0j-nkEA51-uLs56fav2sXdze_PnRd26Ob84_3Br_d_6_XpwadWeL0NmzcMftVF9-3Gi4lRG91GYhtYf14PPV9ZvX62wbn0aZKznZ4bMmk8XLz3THSu1e25YtwZ9K7TeW0NgsFCR7IdzmUDwF3BgIICBDQwcYODCHYNlrEYySVSc3fK0eaAX_YCgxWC6WK7S7OM7BiMVSwieIJ2mMwkB3IbDmbyWYSTjZgsYRDINp7PNv9mPtvf3_fKbfAQGH9RsNV8kQdaFETC4WYbZVaPJrXARWdxS6YOM4W7NQK3SXYIkDScSAr4XufcRgtaaVU99NpnEchKmKm66-dDdrDmDOJKxjAJrc3XW_3rfH9ze9z9fXNS6vA4MLs--1LqiXgi34w8frYcweUDou_WuAFEowNUWsOOqbbAi990WTFTJW_9VmXahTK5_UZXqZLu7VouX7nuxFZcynshParqQcZP7ee5MjtNal7-rv4-nk4ftn1l3VmnWGdYVrGuzrqMdie1ihX6FCg2y91VDLZvCLtz5chi_EEbYuTC8us38GDY3eaMpDvKZm-TeG-neqfjsaQs4hs_8ZHzWv6i38rnzyj53chWK6gqJoygkGk37IIWESe69wdU-FYXa2gKOoZA4GYX0L-qNFBKt11VI5Bd9u7pC9lEUshtN5yCFbJPce4PLPxWFfG0Bx1DIPhmF9C_qrRTir6xQfp11qivkHEUhp9F0D1LIMcm9N7g6p6JQR1vAMRRyTkYhoxeV-6Xg6kfYWKnCoBru_dbfCaEdTk4xpmsSM5PzZ0rvMA-GmQe6dG4xnXfgaOeHbbp6_V8eB16xhPavjfcjTKXiladSYXJWdC2TpVokstLP71bhXzV4VqyMJnLbv0St4pG8itVoc-_2crABbT6IZJJuv-Xbi97i51dJGstw_u9R1z6JF0l8nyRyJL5Pcs1IbT2JG4binGAZxuKuniVMc3UIFsolSJatR9nCDOUTKN8MxYnx4DiGLI8YW6jzNEsQ7XK9Issm5XH0KA913iFRwjEQ0SVRnp7EiyTvUKVRp2gSpbRhKFJpw1ik0qa5KKVRrvbBSttmKErpjhmKVBpNWiUsSmnUeZpFKt0usvyDlUad79BLa0svIpodOFqmq5qICixBUSqaxiJdNA1GymicjLIRJ6NXa0pHtJSVsAgfHbyJKNlFUEKiKacMRhmJ21-yGaSURDsJjpbsyk7i9tNLNifWWeQ3R2t2VSlxiTSKktI0FimlaTBSSuNklJQ4GdrmVJYS7-xpFiUlWoxKWKSUeOYpgVFS4vbTMFJKtBfgaLtTWUrcfrSA56X09VJiwdECXlVKXCKNoqQ0jUVKaRqMlNI4GSUlTob2PJWlxAsSzaKkxOsRzSKlxDNPCYySErefhlFSevi3LX2aI4jjHBvD0BqehwkChmZFYXJIIXIsNCmWsHw9y0FzYgmrMDDyMDT6y2CeHubiUx2jg4oczMPtP_ykwlvfMRjP1Pf7aQQBSNFqub4_aoT-kDcc23Ea_tCOGpEYO-Nhpz1yQxuyB8JJAsET3Dyo7xvu7eNSJhCMw1kiGVyG3-RHmcp4Pl1Mk3Q6ev5mvf7fPwEAAP___wYlfw==

# Verify that the stages preserve the ordering as expected.
query T
EXPLAIN (DISTSQL) SELECT sum(x) FROM (SELECT a, b::float + c AS x FROM data) GROUP BY a ORDER BY a
----
distribution: full
vectorized: true
·
• group (streaming)
│ group by: a
│ ordered: +a
│
└── • render
    │
    └── • scan
          missing stats
          table: data@data_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzMl0Fv4jgYhu_7K6zvBKojsOOEJCfYaWeFREkXqLSjVVW5xKVoIGbjoGlV9b-vkswMIVE8OIOqXqrGSd48r_1INq-g_ttAAFf_3ExG4ynqXI7ni_nfky6aX02uPi2Q2m87z130eRZeo873MY7RQxB8noSjhYcu0BKN5ui5eCTiKe-iv2bh7Q368wviKJxdXs3yfwFDLCMx5VuhIPgXCGCggMEGDAwwOHCHYZfIpVBKJtkjr_kL4-gZgj6Gdbzbp9nwHYalTAQEr5Cu042AABb8YSNmgkci6fUBQyRSvt7kn8mIhtmf-91X8QIYPsnNfhurIK-B0RIwzHc8G7B6BPE4QhTJ9EkkCjDMRByJJEBD-2JIf3TGaEjg7g2D3KcHJpXylYCAlEqMLyHov-HTe4xWq0SseCqTnnNcY5hNVZhEIhFRgPKr0fTL_TRc3E9vJ5POkHazIrfXnSHpVuAO-Q8v6Imrp0p0VuZQgFYKOI0FDrmyAKvmXhTBmpakX2Mp1yS1muRnTVqteahgVyqQ5kVo22EqLbnrkcoqhfs0X5wmMFYFO55ccrrlpLXlPWL1aO45KTw_i-bEpEhJAPejaO42FjiH5uRdND9eBHq6TbS9TdTq2We3iZoUKc3z4KPYNGgscA6b6LvYdLwI9uk22e1tsq0eO7tNtkmR0jx7H8Umr7HAOWyy38Wm40Vgp9vE2tvErPwY9fsGMRP40tz6H8Ugv7HAOQxi72IQMzlJz4TayViJI7KmT_Urn7JI1lhEK1HMkJL7ZCluErnMny0uwzwoH4iESou7pLgYxz9uqTQRfPvzh0A5iVSTSDmJHiWRcpJjluQ2JxFDKF8TZUhFNAWpIRZxNFk1LqpdQbs5yq5h2XoZXAMbmDbKaU4i1SSnrVeuWZLOK0MonVeGVFqvDLG0XtW43NZe1bAG2iivWQZaTfLayjAwS9LJYAilk8GQSiuDIZZWhhqX31qGGhb5xZaj2XPsWlbrTcczjNIJYYqlM8KUS6uEKZjWiTpZ-52nDvaLrYc1S8FqWbW951QpfMMonRSmWDopTLm0UpiCaaWok9W2oJOlYNkp9XEjv92vIwhA-I-e43sD68FjrsWEJyzP7zuW6zGHOoPIpi6H7AW-UtlRef4kv-W5i5dddtB95BslMFzzr-JSpCLZruO1StfL73fe3v74PwAA__9w_rN_

query T
EXPLAIN (DISTSQL) SELECT sum(x) FROM (SELECT a, b::float + c AS x FROM data) WHERE a > x GROUP BY a ORDER BY a
----
distribution: full
vectorized: true
·
• group (streaming)
│ group by: a
│ ordered: +a
│
└── • filter
    │ filter: a > x
    │
    └── • render
        │
        └── • scan
              missing stats
              table: data@data_pkey
              spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzMl99u4kYUh-_7FKNzBcpYeMY2GF9BN6RFIpACUbtqo2iwB4IWMLWNNlGUd69sNvzxyKce1opyEwXb-fk7c745ZF4h_ncFHvT-uht0-0NSu-5PppM_BnUy6Q16X6Yk3q1rz3VyMx7dktqPa4KSmefdDEbdqUuuiE-6E_K8fyQQiaiTP3_vjXtEkH92pmlJ8kx-G4_u78ivX4kgo_F1b5z9ChQ2YSCHYi1j8P4GBhQ4ULCAgg0UHHigsI1CX8ZxGKWPvGZ_0A-ewTMpLDfbXZJefqDgh5EE7xWSZbKS4MFUzFZyLEUgo4YJFAKZiOUqe02K2El_PG6_yReg8CVc7dab2MvqosQHCpOtSC8YDUbEJiCchMmTjGKgMJabQEYe6VhXHf6-CJR0GDy8UQh3yZEpTsRCgsdOiuhfg2e-0fJ13CxXiYxk1HDOi9hf90iHvy8yQsBzBI4OQXexiORCJGHUYLmV7KTdGkWBjGSQogCF7vDr43A0fRzeDwa1Dq-na3l_W-uweo7u-ILZC3kS8VMuOq3mWIGVq4AVL-IxONyT5YOv9slYnY4Cc1onU-pkhzp5vs5jDXa-huI2XFrDMDTCbYPn2jTaJVl3isCcHBg_X1xWfqexi3dagxkNnu01tt9rlWw1plPIYas1K9xqTR2CUwXZp9lqxYtYxVZrfshWO28DL280v9xobjSsyo3mOoUcjG5VaHRLh-C00_zTGF28iFUY3foQo8_bYJU32rrcaMto2JUbbekUcjDardBoV4fgtNPWpzG6eBGrMNr9EKPP22CXN9q-3GjbyP6x_nmLbR34g8XtCi1u6xCcdtf-NBYXL2IVFrc_xOK2ztlqLONtuInlGVnRq8zcqwyWViyDhdyvUBzuIl_eRaGfPbv_OMqCsguBjJP9Xbb_0N-834qTSIr14XB6msTQJF6c5OSTeD6JnSZZZ0nsNIkpUHiUi0RpUjFenMU1sVgTydLk4mZxlqVwWWgPbSRKwbJxHXTMctCoZnESyyc10aRWcVIzn9S62FEFCo_CHNWkQh3VxEId1eRCHVW43IsdVbDa-PAzi33gyvT7n0GK-N5SspRRWloulQvPwuzS5UL10gVD_dIlQwVTyZSJWtowFQyfqMwu1sJSsvCRypziLFfJUmZqacVULjwLU0yXC1VMFwxVTJcMVUwlw7-IMMVUMGW4nmvhFmthK1n4cGXt4qy2kqVM19KKqVx4FqaYLheqmC4YqpguGaqYQsbxLyRMsXZ6XJivwu-PywA88GfzuT13bcP028ywZ45vCKc5Nyy35Zti7vPZLD37zVdiEadnlslT-D3Lnb5s0xPHXKxiSeFWfJPXMpHRerlZxsnS_3Hn7e2X_wIAAP__JfEKwA==

# Ensure that an interesting input ordering that causes an ordered group by
# forces an ordered synchronizer. We create an index on b even though it's
# not used to help the optimizer realize that there's an ordering available
# on b for a constrained scan on the a,b primary index.

statement ok
CREATE TABLE data2 (a INT, b INT, PRIMARY KEY (a, b), INDEX(b));
ALTER TABLE data2 SPLIT AT SELECT 1,i FROM generate_series(1, 9) AS g(i);
ALTER TABLE data2 EXPERIMENTAL_RELOCATE
  SELECT ARRAY[i%5+1], i FROM generate_series(0, 9) AS g(i);

# Verify data placement.
query TTTI colnames,rowsort
SELECT start_key, end_key, replicas, lease_holder FROM [SHOW RANGES FROM TABLE data2 WITH DETAILS]
----
start_key                end_key       replicas  lease_holder
<before:/Table/108/1/9>  …/1/1/1       {2}       2
…/1/1/1                  …/1/1/2       {5}       5
…/1/1/2                  …/1/1/3       {5}       5
…/1/1/3                  …/1/1/4       {5}       5
…/1/1/4                  …/1/1/5       {5}       5
…/1/1/5                  …/1/1/6       {5}       5
…/1/1/6                  …/1/1/7       {5}       5
…/1/1/7                  …/1/1/8       {5}       5
…/1/1/8                  …/1/1/9       {5}       5
…/1/1/9                  <after:/Max>  {5}       5


query T
EXPLAIN (opt,verbose) SELECT b, count(*) FROM data2 WHERE a=1 GROUP BY b
----
group-by (streaming)
 ├── columns: b:2 count:5
 ├── grouping columns: b:2
 ├── internal-ordering: +2 opt(1)
 ├── stats: [rows=9.561793, distinct(2)=9.56179, null(2)=0]
 ├── cost: 29.145618
 ├── key: (2)
 ├── fd: (2)-->(5)
 ├── distribution: test
 ├── prune: (5)
 ├── scan data2
 │    ├── columns: a:1 b:2
 │    ├── constraint: /1/2: [/1 - /1]
 │    ├── stats: [rows=10, distinct(1)=1, null(1)=0, distinct(2)=9.56179, null(2)=0]
 │    ├── cost: 28.8200001
 │    ├── key: (2)
 │    ├── fd: ()-->(1)
 │    ├── ordering: +2 opt(1) [actual: +2]
 │    ├── distribution: test
 │    ├── prune: (2)
 │    └── interesting orderings: (+2 opt(1))
 └── aggregations
      └── count-rows [as=count_rows:5]

query T
EXPLAIN (verbose) SELECT b, count(*), corr(a, b) FROM data2 WHERE a=1 GROUP BY b
----
distribution: full
vectorized: true
·
• group (streaming)
│ columns: (b, count, corr)
│ estimated row count: 10 (missing stats)
│ aggregate 0: count_rows()
│ aggregate 1: corr(a, b)
│ group by: b
│ ordered: +b
│
└── • scan
      columns: (a, b)
      ordering: +b
      estimated row count: 10 (missing stats)
      table: data2@data2_pkey
      spans: /1-/2

query T
EXPLAIN (DISTSQL) SELECT b, count(*) FROM data2 WHERE a=1 GROUP BY b;
----
distribution: full
vectorized: true
·
• group (streaming)
│ group by: b
│ ordered: +b
│
└── • scan
      missing stats
      table: data2@data2_pkey
      spans: [/1 - /1]
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzMlN9q2zAYxe_3FOK7SjaZWP6XYhika7MtkNpd7NCVEYJsKampY3mWTFdK3n3Y6RbHa0ITxtiNQZb4feccHfsJ5PcUXBh-vR6fjzzUuRwFYfBl3EXBcDy8CFGEUSzKTHXedtHHiX-FGFXUQDefh5Mhoug9IujTxJ9eow-3KAIMmWDcoysuwf0GBDAYgMGGGYa8EDGXUhTV1lN9cMR-gKtjSLK8VJvXKlEpBxfKTBSMF5wBBsYVTdJqf7aeYYhFwcHdHvWEJvKe0zqIQZTqGTvDIBVdcnCtho7RJbjOGjekkIaUFwaFNEr5hFPGi56-Mw7qVAb1c57f80fAcCHScpVJF1FcJxPktFr1iNYjvSoZv1QuGhiwTytpadWP0Xq-XBZ8SZUoesau1EE9exOui-rVuXc79_xw7k3H486AdCv1_tQL5xP_Juh0Wwq3Q6JHdEfl3R_8-pqeXRgtF8ZeF1vuS1cPA_IOXrz_hlXrFKvB9Go-8sLOwGg73bowWy6sHRfG63tDTu9N1RzjhN6QY7Q2wjT_q96Ye138hd7Y_6o39o4L_fBdTLjMRSb5q_5semuSRirPnC35JiMpyiLm14WI67ObpV-D6heMS7XZ7W8Wo-zXllQFp6vfv6AmiRwkGUeQjDaJNEnmDok0ScZxJGc_yWqTzIPu9P0kp02yDpLs_TmRNsk-NSfzONKBnOw2yTk1p37V0UUqHuYJAxf6lDGTR7pmnsVUs5yzvhYZOtPOrKi_6DvEjmn1MSxSupTVhxLciYcaGz7mVc0XNJUcwxW955dc8WKVZIlUSfy8s16_-RkAAP__KZ3ZWQ==

statement ok
CREATE TABLE uv (u INT PRIMARY KEY, v INT);
INSERT INTO uv SELECT x, x*10 FROM generate_series(2, 8) AS g(x);

# Regression test for #37211 (incorrect ordering between aggregator stages).
query T
EXPLAIN (DISTSQL) SELECT sum(v) FROM data INNER LOOKUP JOIN uv ON (a=u) GROUP BY u ORDER BY u
----
distribution: full
vectorized: true
·
• group (streaming)
│ group by: u
│ ordered: +u
│
└── • lookup join
    │ table: uv@uv_pkey
    │ equality: (a) = (u)
    │ equality cols are key
    │
    └── • scan
          missing stats
          table: data@data_pkey
          spans: FULL SCAN
·
Diagram: https://cockroachdb.github.io/distsqlplan/decode.html#eJzMl29v6jYUh9_vU1jnFWiJwE4gEGkS3S2buKNJB1Ta1VRVhriUFWKWP9xVFd99Sri3hFg5N0YV6psKCP35OT6PD_IrxP-uwYXhX7fjq5FHGtej6Wz657hJpsPx8NOMxOmmsWuS3yb-DQl4wsnI84YTMvb9P-5uyWd_5JF0R3yPNDj5haRN8vvEv7slv34hKfEn18NJ_hIMCGUgPL4RMbh_AwUDGBhggQE2GNCBewO2kVyIOJZR9pXX_B9GwX_gtg1Yhds0yT6-N2AhIwHuKySrZC3AhRmfr8VE8EBErTYYEIiEr9b5MhnwIPvzsH0WL2DAJ7lON2HsEg4GTLc8e2m2KOFhQBiRyZOIYrjfGyDT5LhinPClAJcWEEfX4Lb3Rn3Kz3IVfoPsnEKmu0G6-w44lvI53ZJ_5CokMnTJgBapU4PsKvFYCa-jg3e1XEZiyRMZtWhpEwdZo_woEJEIXJK_u_K-PHj-7MG7G48bA9bMNvPupjGwmiW64wLzF_LE46dSNIX7_bECq1QBrd7hY7A8kJWDfz4kY3V2FJhinVSpk77Vycp1HmuwyzVUt-HcGjxpym2Lldrkp0nenSqwTgmMnW4urX_I6BmHrEXNFsuPGT0cs9qnjOpgFk5Z9zKnrKuDV7SPfphTVr3D73HKuhc5ZadtYPVlZufIzMyWdZbMTAezILNzGZkdHbxik9mHkbl6h99DZuciMp-2waovs3WOzJbZss-S2dLBLMjcu4zMPR28YpOtDyNz9Q6_h8y9i8h82ga7vsz2OTLbZqtTW2BbB60gcP8yAvd18IqNtT-MwNU7_B4C9y8icF_nHjUR8VaGsTghq1qqXVrKpFnFIliKww7FMo0W4jaSi_y7h7d-HpR_EIg4OTylhzej8PujOIkE37zdUotJFE1i1UmdchIrJ9FiknWSRItJVIHCo3pIlCYVZdVZTBOLdpEsTS7Wrs6yFC4L7aGNRClYNq6DjlkdNKpbnUTLSV00yalO6paTnLMdVaDwKMxRTSrUUU0s1FFNLtRRhat3tqMKVh8ffu1qH5gy_X4wSBHfHSVLGaW15VK58CzMLl0uVC9dMNQvXTJUMJVMmai1DVPB8IlK7WotLCULH6m0U53VU7KUmVpbMZULz8IU0-VCFdMFQxXTJUMVU8nwHyJMMRVMGa6nWvSqtbCVLHy40n51Vl_JUqZrbcVULjwLU0yXC1VMFwxVTJcMVUwhY_gPEqZYP7suPK7l14dVAC70u3NhO-2Fac3nzLRZMDfngSNM9sg4c6jjcJ7dSx7XfBlnd5bpk_ya585ettmN45GvY2HADX8W1yIR0WYVruJktfj2ZL__6f8AAAD__7mxEA0=
