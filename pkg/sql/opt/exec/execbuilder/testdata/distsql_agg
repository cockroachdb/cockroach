# LogicTest: 5node-dist-opt

statement ok
CREATE TABLE data (a INT, b INT, c FLOAT, d DECIMAL, PRIMARY KEY (a, b, c, d))

# Prevent the merge queue from immediately discarding our splits.
statement ok
SET CLUSTER SETTING kv.range_merge.queue_enabled = false;

# Split into ten parts.
statement ok
ALTER TABLE data SPLIT AT SELECT i FROM generate_series(1, 9) AS g(i)

# Relocate the ten parts to the five nodes.
statement ok
ALTER TABLE data EXPERIMENTAL_RELOCATE
  SELECT ARRAY[i%5+1], i FROM generate_series(0, 9) AS g(i)

# Verify data placement.
query TTTI colnames
SELECT start_key, end_key, replicas, lease_holder FROM [SHOW EXPERIMENTAL_RANGES FROM TABLE data]
----
start_key  end_key  replicas  lease_holder
NULL       /1       {1}       1
/1         /2       {2}       2
/2         /3       {3}       3
/3         /4       {4}       4
/4         /5       {5}       5
/5         /6       {1}       1
/6         /7       {2}       2
/7         /8       {3}       3
/8         /9       {4}       4
/9         NULL     {5}       5

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJyslL3OmzAUhvdeBTpTKxkZG8gPUzpmaFOl7VQxuPiIIiUY2UZqFXHvFTAEosTwyd8I5PXzPifWuUGtJH4VVzSQ_QIGBDgQiIFAAgRSyAk0WhVojNL9T8bAUf6FLCJQ1U1r-9c5gUJphOwGtrIXhAx-iN8XPKOQqGkEBCRaUV0GTKOrq9D_DlJYAQRCygJRy4AFyv5BDQROrc2CA4O8I6Bae4cYK0qEjHVkfZHPZamxFFZpms57fP_55eOBfXqJ4S8x99PbWmmJGuXs6LxzF2HR25rEsyZs_eSZc_KUhZR7zX6hykR54zN7vt6Yu415SGMv44UqE-Otj3G83jh2G8chTbyMF6pMjHc-xsl648RtnIQ09TJeqDIx3r_XRnmCOaNpVG3wYbM8PznqNw7KEsf1ZFSrC_ymVTFgxsfTkBteSDR2_MrGh2M9fuoLTsPMGeazMHsMczd5AR0704k7nPj0Tp3hjZu88SFvneGdm7zzIe_d_1W0cE3cl-yRnXcf_gcAAP__YRvBag==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum((a-1)*1000 + (b-1)*100 + (c::INT-1)*10 + (d-1)) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzUlc9q20AQxu99CjMnpV2h_WfH2ZNC24OhSYubnooOW--gGhyt2V1DS_C7F0uESCZeqSgX3TSa_fab-c3CPEFlDd7rR_SgfgIDAhwICCAggcAcCgJ7ZzfovXWnI41gZf6AogS21f4QTr8LAhvrENQThG3YISh40L92uEZt0GUUCBgMerurbfZu-6jd39zooIFAmrGZrsyMzWz4jQ4IrLEy6NQsSZIkZylTSq3uH5ZX7xml9Dn4kCQ57-aev-ucaILOidaBXNaZT58_ru5uv1xBcSRgD-GlIR90iaDYkQxv-rYsHZY6WJfNuz1__3GX5OyyDb9o83L7obLOoEPTubo4xgth9P8qEZ1K2PAps-iUM5ZmfDJz7mm7hXcxZs58OF0ep8vTTEyGbk_bLbrXY-iK4XRFnK5IMzkZuj1tt-gux9CVw-nKOF2ZZvPJ0O1pu0X35q02wCs2a_R7W3k82wSv30xPGwJNic068fbgNvjN2U1t04Rfa139w6APTZY1wapqUqcC22IWFfOOmJ2Ledy5x1pE1TIulmPqnkfFi7jzYozzdVS8jDsvxzjfxGdFe55J_JGdexfHd_8CAAD__y0ePI8=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), count(a), max(a) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy0lEGLm0AUx-_9FOGdWhgZZ8Zks56y9JRDNmV3A4UiZeo8rJB1ZGaElsXvXtTS1RBHwfSmTv75_fm94b1BoRU-yle0EH8DBgQ4EBBAIAICa0gIlEanaK02zU-6wF79gjgkkBdl5ZrPCYFUG4T4DVzuzggxvMgfZ3xCqdDQEAgodDI_t5jS5K_S_N4p6SQQCChbyUKt2Eq7n2iAwLFy8WrHIKkJ6Mq9Q6yTGULMajK_yEOWGcyk04auhz2eT4ePO_YJCHw-nh5f_j4fHr62T2NwPgp_Z1aFNgoNqgEwqf31WDjW7_l0-L5vGvJ_DcV4QzFoyObPiXnnRFlA-aJJTVTpqdjcflJ8vgfu98ADKhZ5mKjS83B3ew9ivgfh9yACGi3yMFGl52F7ew_RfA-R30MU0PUiDxNVeh7u_-8GuwJ_QlvqwuLFJrv-z2Gz4VBl2K1DqyuT4hej0xbTvR7bXPtBoXXdKete9kV31BTsh5k3zAdhdhnmfvIEWnjTkT8cLem99oY3fvJmCfnOG976ydsl5Hv_rMKJa-K_ZJfspP7wJwAA____MN8V

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a+b), count(a+b), max(a+b) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy0lEFr2zAUx-_7FOGdNiYjS3LS1KeUnXJIO9IGBsMMzXp4htQykgwbxd992B6rHWrZEPdmW_nn9-f3xHuBQiu8l89oIf4ODAhwICCAQAQE1pAQKI1O0Vptmp90gb36DXFIIC_KyjWfEwKpNgjxC7jcnRFieJI_z3hEqdDQEAgodDI_t5jS5M_S_Nkp6SQQCChbyUKt2Eq7X2iAwBELhSZe7djnHYekJqAr94qyTmYIMavJ_Dp3WWYwk04buh62eTwdPu7YJyDw5eF0__Tv-XD3rX0ag_NR-CuzKrRRaFANgEntr8fCsX6Pp8OPfdOQ_28oxhuKQUM2f1rMOy3KAsoXmNdEoZ6QzfLz4vNtcL8NHlCxgI2JQj0bN8vbEPNtCL8NEdBoARsThXo2tsvbiObbiPw2ooCuF7AxUahn4_Z9N9sb8CPaUhcWLzbc2_8cNpsPVYbdmrS6Mil-NTptMd3rQ5trPyi0rjtl3cu-6I6agv0w84b5IMwuw9xPnkALbzryh6Nreq-94Y2fvLmGfOMNb_3k7TXkW_-swolr4r9kl-yk_vA3AAD__6Qr5-4=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum((a-1)*1000) + sum((b-1)*100) + sum((c::INT-1)*10) + sum(d-1) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzMVU2L2zwQvr-_wszJeSNj6yPZrE5a2h4C3W1Jt6figxoNbiBrBVmBliX_vcQuiR02smlIyW2k8ePnQwPzCqU1-KRfsAL5DSgQYECAAwEBBCaQE9g4u8Sqsm7_SQOYm58gMwKrcrP1--ucwNI6BPkKfuXXCBKe9fc1LlAbdGkGBAx6vVrXNBu3etHulzLaayCQpDTSpYloZP0PdEBggaVBJ6NY0YRKKedPz7PR_zTLsj8HEsWKdVutDm_KTv_QVqK-f__h3fzx4SPkOwJ2648-Kq8LBEl3ZLjXh6JwWGhvXTrpWv3y9TFWdASkqdih4odKjM6KYGdFHLm3pXUGHZoOcb4Ly6TZ3-g8vowS41jxcazoWLHReQe844AOHxkaHJmUJim79aHpcdt6jen1hoYNj5yFI2dJym898h63rcjvrhc5Hx45D0fOk1TceuQ9bluRz64XuRgeuQhHLpJ0cuuR97htRX7_b7bRGyIWWG1sWeHJVnr7z9l-W6EpsFltld26JX52dlnTNMdPNa6-MFj5pkubw7xsWnuBbTANglkHTE_BLMzcQ82DaBEGi0t0T4LgaZh5egnzXRA8CzPPLmG-D79V1jMm4SE75c53__0OAAD__9fMYfk=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), min(b), max(c), count(d) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy8lF1r2zAUhu_3K8K5SkFG1kfS1Fcuu8pF0tE2MBhmaNHBC6RWkGTYKP7vw_ZF7dDKnkN656_X78NzxHmFwmjcqhd0kPwABgQ4EBBAQAKBBWQETtbs0Tlj60_awFr_gSQmcChOpa8fZwT2xiIkr-AP_oiQwLP6dcRHVBotjYGARq8Ox6bmZA8vyv5NtfIKCESUzVShZ2xm_G-0kFUETOnffu28yhESVpHx9fd5bjFX3li66Lc_7TbzlN0Agc16O095c3X_fZ6K-urrw277PE_lzYcY_EOMt_ayMFajRd2rzqowKIv_h_Rpt_m5HmAVPVY2fmIsODHKIsonzGwAoKNiec2Z8fEeeNgDj6iY4GEAoOPh9poexHgPIuxBRFRO8DAA0PGwuqYHOd6DDHuQEV1M8DAA0PFw91m77B2MR3QnUzg822nv_zmudx3qHNvF6Exp9_jNmn1T094-NLnmgUbn27esvVkX7asasBtmwTDvhdl5mIebB6pFMC3DYXkJ9yIYXoabl5c03wbDq3Dz6pLmu_Cs4oFjEj5k591Z9eVfAAAA___JBN97

# AVG is more tricky: we do two aggregations (for the sum and for the count)
# and calculate the average at the end.
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT avg(a+b+c::INT+d) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy0lEGL4jAUx-_7KeSdFFPSpNFxcuqyJw_jLI6elrJkzaMrOI0kEXYZ_O5D28NUsWlBe7ON__7-_F54H1AYjSv1jg7kL2BAgAOBBAgIIDCDjMDRmh06Z2z5lzqw1P9AxgT2xfHky9cZgZ2xCPID_N4fECRs1J8DrlFptDQGAhq92h8qzNHu35X9n2rlFRCIKBupQo_YyPi_aIHAGguNVo5SMR2PUzZN-WSaJlIuV5vFBLIzAXPyX2jnVY4g2Zn0r_c9zy3myhtLZ5ft3rYv45RNgMCP1-1qU_1uQ_JW5BfpVBir0aK-wGTncCkWt7V62778Xpa9-KSpitGUt_ZMLnqy_pNjwclRFlE-wOw6CjY0zR81O97fCQ874RFNBnDSUbDh5OlRTpL-TpKwkySiYgAnHQUbThaPciL6OxFhJyKiswGcdBRsOHkeYu_dQK7RHU3h8Gr_3f5yXO5F1DnWS9SZk93hT2t2FaZ-fK1y1QuNztenrH5YFvVRWbAZZsEwvwiz6zAPkzvQSTAtwmFxT-9ZMDwPk-f3kJ-C4UWYvLiH_ByeVdxxTcKX7Jqdnb99BgAA__9A7fDm

# VARIANCE/STDDEV have three local (sqrdiff, sum, and count) and one final stage aggregations.
# We calculate and render the variance/stddev at the end.
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), round(stddev(b), 1) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy8lEGL2zAQhe_9FWZOKcjYkp1sVicvTQOGNmmTbC_FFDUa3EDWCrIMLUv-e7F8WCfEssFkb5LGz-_pGzGvUCiJK_GCJfCfQIEAAwIREIiBwBQyAiet9liWStefNIJU_gUeEjgUp8rUxxmBvdII_BXMwRwROOzE7yNuUEjUQQgEJBpxOFqbkz68CP0vkcIIIOAH1BOF9KinzB_UQGBdGe4llCQMsjMBVZk3n9KIHIHTMxme5SnPNebCKB1ML6Nsn79OEvoRCGy_bxbpcjlJmN3V53b1af282tl1VxTWGeUtQVUoLVGjvLDPzu6wNOxKu0xXT19-bXeLxecfk4SRJCJJXBc2WEjUlp6nVVXIuko55-lqN---Q3RxBzq8tdTZ2oD6ARvb3J40LV6zezeXDQfD3GCYH0RjwfSkaYF5uDeYaDiYyA0m8oN4LJieNC0w83uDiYeDid1gYj-YjgXTk6YF5vE95-SNKBssT6oo8Wpe3v5zWM9RlDk2Q7dUld7jN6321qbZrq3OHkgsTVOlzSYtmlIdsC2mTjG7ENNrMXM791hHTnXsFsdjck-d4pnbeTbG-cEpnrud52OcH929CnueifuRXXtn5w__AwAA__-3hPxD

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), round(variance(b), 1) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy8lEGL2zAQhe_9FWZOKcjYkp1sVieHbQOG1mm92V6KKWo0uIGsFWQZWpb892L5sE7YyAaTvUkaP7-nb8S8QKUkZuIZa-A_gQIBBgQiIBADgTkUBI5a7bCulW4_6QSp_As8JLCvjo1pjwsCO6UR-AuYvTkgcNiK3wfMUUjUQQgEJBqxP1ibo94_C_0vkcIIIOAH1BOV9KinzB_UQGDTGO4llCQMihMB1ZhXn9qIEoHTExmfZVWWGkthlA7m51Een77OEvoRCDx-zz-l6_UsYXbXntvVw-Yp29r1tSjsapTXBE2ltESN8sy-OLnD0vBa2nWarb78-rHK01X28HmWMJJEJInbUo6VRG35eVo1lWyrlHOeZtvl9VtEZ7eg45tLnc0NqB-wqe0dSNMjtrh1e9l4MMwNhvlBNBXMQJoemLtbg4nGg4ncYCI_iKeCGUjTA7O8NZh4PJjYDSb2g_lUMANpemDu33NSvhElx_qoqhovJubbfw7bSYqyxG7s1qrRO_ym1c7adNuN1dkDibXpqrTbpFVXagP2xdQpZmdieilmbucB68ipjt3ieEruuVO8cDsvpjjfOcVLt_NyivO9u1fhwDNxP7JL7-L04X8AAAD__6AZ_MI=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT stddev(a+b+c::INT+d) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy0lFGr2jAUx9_3KeQ8KabUJNXr7VMuc0Jh827q3csoIzOHTvA2kkTYuPjdh-3gVtG0IHlrG__-f_xOOG9QaoUL-YoW0h9AgQADAhwIJEBgDDmBvdEbtFab00_qQKb-QDoisC33B3f6nBPYaIOQvoHbuh1CCmv5a4dLlApNPAICCp3c7qqavdm-SvNXKOkkEIhi2pOl6tGedr_RAIEllgpN2hPJsN8XdCjYYCh4mmaL9XQA-ZGAPrj3autkgZDSI-mO91QUBgvptInH53Srb8tZNp_3BR0AgdXLl_9PH59fFuvq-RYAuwnw3nsotVFoUJ2V5kc_Ir0wOM8WT59_rtaz2afvfUGJYETw22D8DIx2Hxz1Di6mUcwCjK4FsOFlEmZ0rLsh5jfEopgHMNQC2DD0EMYQ726I-w3xKE4CGGoBbBiahjGUdDeU-A0lUTwOYKgFsGHoMfyCvAKwRLvXpcWLRXn9n0enBYqqwHrbWn0wG_xq9KaqqV-fq1z1QaF19SmtX7KyPjoBNsPUG2ZnYXoZZv7mlmruTSf-cHIP99gbnvibJ_c0P3jDU3_z9J7mR_-sRi3XxH_JLrvz44d_AQAA__-NzP1Y

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT variance(a+b+c::INT+d) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy0lNFq2zAUhu_3FOFcJUTGkeSkqa8UugUMm7u56W6GGVp08AKpFWQFNkrefcQe1DGNbAi6s638-T--I84rlFphKl-wgvgHUCDAgAAHAhEQmENO4GD0FqtKm_NPmkCi_kA8I7ArD0d7_pwT2GqDEL-C3dk9Qgwb-WuPGUqFJpwBAYVW7vZ1zcHsXqT5K5S0EggEIR3JUo3oSNvfaIBAhqVCE49ENB2PBZ0KNpkKHsdJullOID8R0Ef7Vl1ZWSDE9ESG462KwmAhrTbh_JLu6Vv2MVmvx4JOgMDT85f_Tw-Pz-mmfr4GwK4CvPUeS20UGlQXpfnJjUg7BtdJuvr88_sqS1bpw6exoEQwIvh1NH6BRoePjjpHF9IgZB6G1wPYMrPwMzw23BBzG2JByD0Y6gFsGbrzY4gPN8TdhngQRh4M9QC2DC39GIqGG4rchqIgnHsw1APYMnTvf0W-A5BhddBlhZ1V-f4_z84rFFWBzb6t9NFs8avR27qmeX2sc_UHhZVtTmnzkpTN0RmwHabOMLsI026YuZt7qrkzHbnD0S3cc2d44W5e3NJ85wwv3c3LW5rv3bOa9VwT9yXrduenD_8CAAD__3h2_dc=

# Test various combinations of aggregation functions and verify that the
# aggregation processors are set up correctly.
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), avg(b), sum(c), avg(d), stddev(a), variance(b), sum(a+b+c::INT+d) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzUld-L4jAQx9_vrwjzpOxIm7TV2qfI_oDCnXun7r4csvTM4AluI2mFOxb_96Otp1XWVBAE3yaZfDPf-WQgH5BqRcPknTKIfgIHBAEIHiD4gBDAFGFl9IyyTJviSCWI1R-IXIRFulrnxfYUYaYNQfQB-SJfEkQwSX4taUSJIuO4gKAoTxbLsszKLN4T81eqJE8AoeNwlqSKcabz32QAYUSpIhMx6d-1WpLfSdG-k14UxcNJ2EYmOTIpkEkPmfRhukHQ63xvJcuTOUHEN3i-3cF8bmie5No4waHb8cu3lhRtwCryiuj--WU42cblrr-Lglq-jMc_Rg_x09P2jm1GHGT29_D2yXbEyXb2XaxTbRQZUgctTDf2hrn7Scd85-l_72-xtefdiW6xeoqHg69v48nDw-NrS_ZQcpThPvE6GMWD4f1jS_ZRCqwTcNv1CSif2qleGpkMHNlFJnvIZIhM9k_S8g5o8fNnlVtn1eEdR1xhWhsM1x6vewvTKs7nL-z8RcfxrsC_wXCNf-8W-Hvn8_fs_L2O41-Bf4PhGv_wFvj75_P37fz9jhNcgX-D4Rr__i3wb_j8R5StdJrR0a_5-c1u8ZuSmlP19WZ6bWb03ehZWaZaPpe6ckNRlldZXi3itEoVButibhWLAzE_Fgt75YbSnlXt28X-Jb4Dq7hrr9y9pHLPKg7tlcNLKvftb-U2jIl9yI5rTzdf_gUAAP__Mt2FMA==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), min(b), max(c), count(d), avg(a+b+c::INT+d), stddev(a+b), variance(c::INT+d) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzUVlFro1wQff9-hcyToRP03quJ9emGpgHhq91N0rKwhOLGIRtINVwN7FLy3xeVGg3NNZCHkLdxZo5nzpwB_YAkjSmM3ikD_ycwQOCAIADBAQQXFghblS4py1JVtFSAIP4Dvo2wTra7vEgvEJapIvA_IF_nGwIf5tGvDU0piklZNiDElEfrTUmzVev3SP2VcZRHgNC3mBElscGMNP9NChCmlMSkfEM6d6Yp2Z3kvTspfD8I514PjTKDRfUzWeTQKJOiKMBij5Du8sN4WR6tCHy2x_MljFYrRasoT5XlthXMXp5M6fQA4SkITemW0eiHKQdF9PD8Es5NOSzispM1smU8-z4dB5OJKXndwxs9vNUj6h7R6BG9kyL5SZEHbbskVTEpilvCFnv9Gpj9xR5YvQde7-Fz5regmNWpFbitfLmtSRCO_n-bzcfjx1dTDlF6KO8PhdfRNBiFD4-mZDZKxlCykqa-kZbxaEjXkgM05BAN6Z1ckWitiJ1_ykx7yhbrW_xKx9whouHi4HaPmZ_vFNc7xfuWuJJTHSIaTg1v1ylxvlNC75ToW86VnOoQ0XDKu12nnPOdcvROOX3LvZJTHSIaTt3frlMd_ytTyrZpktHRJ_3rN9vFp57iFVX_BVm6U0v6ptJlSVM9Ppe4MhFTlldVVj0ESVUqBmyCmRbMW2B2DOZ65g5qoUU7erBzydyuFjzQMw8uYR5qwZ6e2buE-V7vld1xJvojO-Ze7P_7FwAA__8tSLAZ

# Verify that local and final aggregation is correctly shared and de-duplicated.
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), stddev(a), avg(a) FILTER (WHERE a > 5), count(b), avg(b), variance(b) FILTER (WHERE b < 8), sum(b) FILTER (WHERE b < 8), stddev(b) FILTER (WHERE b > 2) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzslsFum0AQhu99CjSnVBoLdhdszGmtJJaQUqclTi6tFVEzci0lYC1YahX53SvAtcGFBckHX3yI4p2df_6d4VtpPyBOIpqF75SC9x0YIHBAEIBgA4IDC4SNSpaUponKU0qBH_0Gz0JYx5ttlocXCMtEEXgfkK2zNwIP5uHPNwoojEiZFiBElIXrt8Jmo9bvofojozALAWFgMiOMI4MZSfaLFCAEFEekPEMyNCT7sbUsQY7nef5s7qIhef5XRJduJVrm8X0EFjuEZJsdT5hm4YrAYzvs38VktVK0CrNEmU69iafnLzeSfQaEp2_BnT-d7le3j8-z-b-dMseY-g_z-8CQvLrfFBUHlahVFsds-5hRix0q1DMbKjgNFZzGCk7rEHnrEI-z28aJikhRVBvcYqcfM7Pa5jz1Z5OH16f53d39y43kKBlWBmbvf736eRNObTU8ZI2OhV4mgT-Z3d7fSBflGCWzDlnj_-0YQ8lyz8KxBmiOozCljYZ00JBDs_g3QkPmWI5bZyhqM2T9rxPTXieTDUx-uQvV0UflSw-vF6rtQvH-MHA9DHxgisvB0NFHBYbRFYY2GER_GIQeBjEw7cvB0NFHBQb3CkMbDHZ_GGw9DPbAdC4HQ0cfFRjGVxj6vLsahhhQuknilE7eX82VrfxdRtGKykdcmmzVkr6qZFnYlMvHQlcEIkqzcpeVCz8ut_IDVsVMK-Y1MTsVc71zh7XQqm292D7n3I5WPNQ7D89xHmnFrt7ZPcd5rP9WVgcmeshOvRe7T38DAAD__ze0PaY=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), avg(DISTINCT a), variance(a) FILTER (WHERE a > 0) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy000GLnDAUB_B7P0V4py1EYqJTSk7KdluE1hbX7qX1kJqHFWaNJBFaFr97UQ9blxmxzPSYl_zzfjx4T9AZjbl6RAfyG3CgIIBCBBRioHCAikJvTY3OGTs9WQKZ_gUypNB2_eCnckWhNhZBPoFv_RFBQql-HLFApdGyECho9Ko9zm162z4q-zvRyiugEDBOVKcJJ8b_RAsUCuw0WkkSTknCvw9hGGEopczy8i1UIwUz-OfOzqsGQfKRntE9o4bOWI0W9QpUjSf8adNYbJQ3lh3W_Puvn24S_hoopA8fbt5l92WW35ZkKT2kRZbmt3fTC_I--1jeFSQRZ9Fiheb7R8o3R8p4wMT1hyr2-8S2TwQsur4v2u-Ltn1RwOLr--L9vnjbFwfs8H-X5oSvQNebzuGL5Tn9czgtFeoGlw10ZrA1frGmntssx89zbi5odH655csh6-arGfh3mG-G36zC4cuwuKRzdEk4viR8-KdwNb76EwAA__9m8ts6

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), avg(a), count(a), stddev(a), variance(a) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy0lNFr2zAQxt_3V5h76kDGluSkqZ8cmgYMa7I5SV-GKVp0eIHUCrIMGyX_-7A9qB0a2WDyEMjp8uX79Dtx75AriSvxhgWEP4ECAQYEOBAIgMAEUgInrfZYFEpXP2kEsfwDoU_gkJ9KUx2nBPZKI4TvYA7miBDCVvw6YoJCovZ8ICDRiMOxtjnpw5vQfyMpjAACrkcdkUuHOsr8Rg0E1qUJnYhCeiagSvNhUhiRIYT0TIYHmWeZxkwYpb1JN8dm93wX0a9A4HG9W23_f9_8SBbxcllX1wKwqwE-fMtcaYkaZcc0PdsjUv9axs3u-TWuUrKqWsar-bfXzXaxeHq5iziJKGk3XuZJPF89PnVaCeYSdUWWOBH1Ikac-sOJEwVX78o7d6XDp06tU_eo67FRc--J0oI6vc3c2XAWzM6CuR4fxaInSovF_W1Y8OEsuJ0Fd71gFIueKC0Ws9uwCIazCOwsAtebjGLRE6XF4uH2u_GTAAkWJ5UXeLEjP_9nv9qdKDNsFm2hSr3H71rta5umXNe6-kBiYZoubYo4b1pVwLaYWsWsI6aXYmZ37rHmVnVgFwdjck-s4qndeTrG-d4qntmdZ2OcH-yz8nueif2RXXqn5y__AgAA__-Ob_aB

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), avg(b), sum(a), sum(a), avg(b) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy0lEGL2zAQhe_9FWZOLcjIkpxs1ieXnnLYTcluTsUUNRrcQNYykgwti_97sUVZO2xkg7O3GSsv7-kbMa9QaYWP8gUtZD-AAQEOBAQQSIHACgoCtdFHtFab7idesFV_IEsInKq6cd3ngsBRG4TsFdzJnREyeJa_zrhHqdDQBAgodPJ07m1qc3qR5m-upJNAIKYskpWKWKTdbzRAYNe4LMoZyTkULQHduDcf62SJkLGWzM_ytSwNltJpQ1fjKE-Hh885-wLEV7yrvu0Oj899fc2cXzV_82wqbRQaVCPDog3HY8l0vqfDw89tl1B03R4rhabHFeWc5oL48n979RJidAk2f5osOE3KYsqXznMizQDY-vbz5PNR8DAKHlOxFMVEmgGKu9ujEPNRiDAKEdN0KYqJNAMUm9ujSOejSMMo0piulqKYSDNAcf-xC-8d8z3aWlcWLxbf-_-cdAsRVYl-e1rdmCN-N_rY2_h21-v6Dwqt86fMN9vKH3UBh2IWFPORmF2Kedh5wloE1WlYnC7JvQqK12Hn9RLnu6B4E3beLHG-D88qmXgm4Ud26V20n_4FAAD__6fC6mQ=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT avg(c), sum(c), avg(d), sum(d) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy8lF9r2zAUxd_3Kcx9WkBG1p-kqZ8cCoPA2oz8eRpmaNHFC6RWkGXYKPnuw3agdmhkg0mfEl3p-Bz9rrhvkBuNL-oVC4h_AgMCHAgIICCBwBRSAidr9lgUxlZHGsFS_4U4InDIT6WryimBvbEI8Ru4gzsixLBVv4-4RqXR0ggIaHTqcKxtTvbwquy_RCungEBIWaByHbDAuD9ogcCqdHGQCJJISM8ETOnefQqnMoSYncnwLIsss5gpZyyddqNsds9fEzYBAk-r3cv28r-u8laVT24G4TeDvPuXubEaLeqOeXr2R2XRrayb3fOv5SXXJa3o1GW1WmOu0cZBwujTYlOdXmy-fV8ttvMJCRJGgkTQRFY_Ny8nOpdjwzvOvB2nLKR8bM970rRAzu7bcz4cC_dj4SEVY7H0pGlhebgvFjEci_BjESGVY7H0pGlhmd8XixyORfqxyJBOx2LpSdPC8vh5g_ODIGssTiYv8GqAfvzlqBqsqDNspnBhSrvHH9bsa5tmuap1dUFj4Zpd1iyWebNVBWyLmVfMO2J2LeZ-5x5r4VVLv1iOyT31imd-59kY5weveO53no9xfvT3Kup5Jv5Hdu2dnr_8DwAA___-8v6W

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT max(a), min(b) FROM data HAVING min(b) > 2]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJyslEFr2zAYhu_7FeY9tSBjS3bSVCf3Msih6Sg9DDYftOjDM6RWkGTYKPnvJfGhTkhkg320lTfP-_gT3wcao2mj3slB_gIHgwBDBoYcDAuUDHtrtuScscefdIG1_geZMtTNvvXH1yXD1liC_ICv_Y4g8ab-7OiVlCabpGDQ5FW9O2H2tn5X9n-hlVdgiBMeqUZHPDL-L1kwvLReRgVnhUB5YDCt_-I4ryqC5Ac2vstTVVmqlDc2WZxXeX76eVfwezA8rzd3hbi_CRQ3gV-ctjFWkyV9BikP4Uo8HerE8L3eebIyKkT0u03TjCIhpVxv3lY3C2dnhfn4afHgtBIeJ2LqvAba9D7Ocp55ifH6Iqwv4iSbqj_Qpqf_MI9-Nl4_C-tncZJP1R9o09NfzaOfj9fPw_p5nCym6g-06ek_zr-srgBfye1N4-hiaV3_5_S4zEhX1G0-Z1q7pR_WbE-Y7vHllDu90OR8d8q7h3XTHR0L9sM8GBZnYX4ZFmHyADoLpvNwOJ_SexEML8Pk5RTyQzC8CpNXU8iP4VmlA9ckfMku2eXh22cAAAD__9wd2F4=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT DISTINCT (a) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJyslLGumzAUhvc-BTprjYwN5OYyZeiSpamibhWDi49SpAQj20itIt69AiRSouaALozY_P7-T8fyHSqj8au6oYPsBwhgIIFBDAwSYJBCzqC2pkDnjO1-GQJH_RuyiEFZ1Y3vlnMGhbEI2R186a8IGXxXP694RqXR8ggYaPSqvPaY2pY3Zf8ctPIKGIRcBKrSgQiM_4UWGJwanwUHAXnLwDT-AXFeXRAy0bLlRb6UzpdV4Xk6bXHobE9Wo0VN0uRL2gNihnOeCZ8hb6lKIvpgp3jSSSwfhSBHwUXI5aphzFQZzXebDEMuF5e0uAx5vEp8psoo_raJeLxcPKbF45Anq8Rnqozi-03Ek-XiCS2ehDxdJT5TZRR_3_zd-Q_tjK42lcMJ69XJUfcoob7g8Ig509gCv1lT9Jjh89Tn-gWNzg-7Yvg4VsNWV_DfsCDDchIWz2FJk2fQMZlO6HCypndKhnc0ebeG_EaG9zR5v4b8Ts8qmrkm9CV7Zuftp78BAAD__1TmzT0=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT SUM (DISTINCT A) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJyslEGPmzAQhe_9FWhOrWRkbCCb5ZSqe-HQ3Wo3PVUcXDyiSFmMbCO1ivjvFSCRghKDQo_YefPe92LNGSol8Vm8o4HkBzAgwIFACAQiIBBDRqDWKkdjlO5-MghS-RuSgEBZ1Y3tjjMCudIIyRlsaU8ICRzFzxO-opCoaQAEJFpRnnqbWpfvQv85SGEFEPAp80QlPeYp-ws1EHhpbOIdGGQtAdXYi4mxokBIWEvWB3kqjS2r3NJ4msIxn9-cfxnbVEpL1CgnU7P2SoLPRaGxEFZpymZVvH3_-vEpfTumz1-O3oF9uhkpnERi67tnzu4p8ynf1P5ClLH93Z3t8_Wo3I3KfRpuQl2IMqI-3IkarkcN3aihT6NNqAtRRtT9najRetTIjRr5NN6EuhBlRH38D-vjyvxXNLWqDM7WyPXJQbdeUBY47CKjGp3jN63y3mb4fOl1_YFEY4dbNnyk1XDVBfxXzJxiPhGzuZi7nResQ6c6coujLbljp3jndt5tcX5wivdu5_0W50f3fxUsPBP3I5t7Z-2HvwEAAP__TJu5yQ==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT SUM (DISTINCT A), SUM (DISTINCT B) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJyslEFvnDAUhO_9FeidGsnI2MBmw4mquXBoUiXbU8XBxU8UaYORbaRWEf-9AiRS0MagJUfbjGc-xnqvUCuJD-IFDSQ_gQEBDgRCIBABgRhyAo1WBRqjdP_JKMjkH0gCAlXdtLbfzgkUSiMkr2Are0ZI4CR-nfEJhURNAyAg0YrqPNg0unoR-m8qhRVAwKfME7X0mKfsb9RA4LG1iZcyknLIOwKqtW8-xooSIWEd2Z7lvjK2qgtL43kQtwV_1-Lt5rZWWqJGObs47y6E-FKWGkthlaZs8UOef3z7fJ89n7KHrycvZTdAFlv85t2U4Swl214Kc5ZCmU_53lpW0ky1HK6vhW8H5m5g7tNwL_BKmgn49nrgcDtw6AYOfRrtBV5JMwEfrweOtgNHbuDIp_Fe4JU0E_Ddx0yaCxZPaBpVG1xMnMs3B_0kQlniOLaManWB37UqBptx-Tjohg2Jxo6nbFxk9XjUB_xfzJxiPhOzpZi7nVesQ6c6coujPbljp_jgdj7scb51io9u5-Me5zt3V8HKM3E_sqV33n36FwAA__-jvMSf

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT DISTINCT a, b FROM data WHERE (a + b + c::INT) = 27 ORDER BY a,b]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy8lE9r2zAYxu_7FOI5tUTBluz8qWDgwxjk0ozS2_BBs146Q2oFSYGNku8-HEG6hFU2JMslICuPfg-_V-gNnTX0qF_JQ32HAIcERwGOEhwz1BxbZxvy3rr-LzGwMr-gco622-5C_7nmaKwjqDeENmwICs_6x4aeSBtyWQ4OQ0G3mwNm69pX7X5XRgcNjmkmmO4ME8yGn-TA8bXdBHKK3d1Vgk1YJe_730Kp1ePz8p59ZnKh4gIc611QrBK8kqj3HHYX3kv5oF8ISuz5-OJfWh_argnZ7LR1RHCsnSFHZogpP2S-o2w86pwz4ZWcoN6nyon8onbFSTsxfpQiOcpMTDN502EOVD_6ml9xmHK8LpnWJadZcVNdA9WPuhZX1FWM11WkdRXTrLyproHqR13LK-oqx-sq07rKaTa7qa6B6kddD__pZf0H84n81naeTogfnZz3Ty6ZF4rPtLc719A3Z5sDJi7Xh9zhgyEf4q6Ii1UXt_qCf4dFMixPwuI8LNPkAXSRTJfpcHlJ71kyPE-T55eQF8nwMk1eXkJ-SM8qH7gm6Ut2zq73n_4EAAD__3p5DA8=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT DISTINCT a, b FROM data WHERE (a + b + c::INT) = 27 ORDER BY b,a]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy8lUFr2zAYhu_7FeI7tVhGkWQ3iWDgwxjk0oyut-GDZn10htQKkgIbJf99OIJ0CYvskDSXgKy8et48-ZDfoLMGH_UrelA_gAMFARQkUCiAQgk1hbWzDXpvXf-VGFiY36AmFNpuvQn945pCYx2CeoPQhhWCgmf9c4VPqA06NgEKBoNuVzvM2rWv2v2pjA4aKOSME90ZwokNv9ABha_tKqBT5O6u4iQjlbjvP6VSi8fn2T35TMRUxQVQWG6CIhWnlYB6S8FuwnspH_QLguJbOr74l9aHtmsCKw9bRwSFpTPo0AwxxUnmO8rGo445Ga1EBvU2VY5PLmonzzHy3bqAjnF-hBQZrXh2klEcMPj4ceHJcWE8Z-KmAzNQff-fPFxxYMR4XSKtS-RM3lTXQPW9rukVdcnxumRal8xZcVNdA9X3umZX1FWM11WkdRU5K2-qa6D6Xtf8g27v_zCf0K9t5_GAeOrkSX-to3nB-CrwduMa_OZss8PE5XKX2z0w6EPc5XGx6OJWX_DfME-GxUGYH4dFMizTZJmuLdLpIpku0-Hykh_9kAxP0-TpJeRZMjxPk-eXkPnAjA0N2XlTVm8__Q0AAP__7DZAPg==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT c, d, sum(a+c::INT) + avg(b+d) FROM data GROUP BY c, d]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzUll9r4lwQxu_fTxHmqqVH4pxz4p9cpbxXQjdduvZiWaSk5mCFNpGTCFuK332JsdUYO6MYQe9izJOZM89vHvIBSRqbMHozGfh_AEGABAEKBGgQ4MFIwMymY5NlqS0eKQWD-C_4bQHTZDbPi9sjAePUGvA_IJ_mrwZ8GEbPr-bBRLGxbhsExCaPpq_LMjM7fYvsexBHeQQCWi46URI76KT5i7Eg4MEksbG-E-BNoHx_EA57wgnkTaCFEyjhBBpGCwHpPF_Xz_JoYsDHhdi_x9vJxJpJlKfW9aotBkoExQRuw99P4f3wKXy8u7sK1HXtli5u_Xr8cRXg15Usrv6_fwyHy-tqq-vqz-_OS5S9bBVGEUgYLdYnkt-eaP2qeZLa2FgTV162fAtxZmzvqr19QqwfWn4dVX1dfQ7iaVAc27uu2Fi492mdG3jfuqcOcS9MW-nMxS3n6kVvCFx0s8MtW5LtrSd31_YqtXH_dUJynVxsufJUC8V0uQFX50IWCptcKDzvhWLcWy1Up7mFkvtDLWmoZctVp4Ka6XLD4O6FQC2bhFqeN9SMeyuou81BrfaHWtFQq5arTwU10-WGwb0LgVo1CbU6b6gZ91ZQ95qDWu8Ptaah1i3XOxXUTJcbBvcvBGrdJNT6vKFm3FtB3T_N9_yOgg8mm6VJZvb6Wm8XwzfxxJROZencjs1Pm46XZcqf90vd8kZssrz8F8sfg6T8q2hwU4zbYtwUy4oYDxN3jxEjHqX2jlL3abUkB67ogStSrOnKmhRLxmuPVHdocecYUGgxAwot5kBh1AwojJoBpUsOvEcPvHcMKH06E9pMKNQi5aBUoNVcLNBqNhcYORcMjJwxHGvBUp27ZOZOJwvjOdLRgpopXguXg0yn1ZzptJo1nZFzpjNyznQ6V5EJVqxlzEGm0xmDTMhgLWUOMp1Wc6bTatZ0Rs6Zzsg50-mElUzCSvqjbdv00eK_fwEAAP__FMnkng==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT c, d, sum(a+c::INT) + avg(b+d) FROM data GROUP BY c, d ORDER BY c, d]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzUl19r4kwUxu_fTxHOVYsjcf7E2lxNea-Eri6tvVgWKakZrNAamaSwpfjdl5i0JnE9R5kG9C6OPnlOzjm_h_gByyQ2o-jVpBD-Bg4MBDCQwEABgwCmDFY2mZk0TWz-k0IwjP9A2GOwWK7esvx4ymCWWAPhB2SL7MVACJPo6cXcmSg21u8Bg9hk0eJlY7Oyi9fIvus4yiJg0PW5Fy1jj3tJ9mwsMLgzy9jY0NO8o2UYDkeTAfO06GjFPC2ZpxVM1wySt2zrn2bR3EDI1-zwGu8TmxnrB_XytOwwrTp7LcQxFjfzuTXzKEusz3tNH6bzLo9tbKyJQ-_z4Gb063E0njyOHm5vL7S83DlS-dH9w48Lzb-uRH71__hhNNlc14vf1vP07j1H6XOjEs60gOl6-4xy7zNub5UUdTdv1WFadIqbYc1oNn1TQrUZ5UH9yfluM8RXC-TX1WeDHod5O4LL2k7lq_S5R74O9s5ZHTPnUdJNVr5ojHjXtIPsbtBK08vK6v3eV0K_VgI_HHGOIu7zri_agpyosoS87wI5YVHda36ukPMWIG82_dQhJ-ZcosS_D3JxOGECJ0x0fdkWYUSVJWFXLoQRFtWlEudKmGiBsGbTT50wYs4lYeL7CJOHEyZxwmTXV20RRlRZEjZwIYywqC6VPFfCZAuENZt-6oQRcy4Jk99HmDqcMIUTprp-0BZhRJUlYdcuhBEW1aVS50qYaoGwZtNPnTBiziVhqp2_gv8wvDPpKlmm5qB_eL18Giaem2KCafJmZ-anTWYbm-LjeKPbHMQmzYpvefFhuCy-ygusijkqFrhYNMW8KpY1MT9OfO0i5spJ7eQtCG-JNlzhDVeoOMCdA3zUfdy6j6qvcPEVKh7g4oHLluFiYtK4mNoyQu3kTW3ZNZ4JPSIU8Egh9ozjmcKJUOE7fNXlkpDvAHbMuhBqYmaEmloYSu7mTq0Mx8OFB0Tf8XihdgaPF07kC8cDhhMJw50ihlBTU3MLGUru5k7uDJ4zgsgZ4ZQzgnh3oV5e8JwRRM4Ip5wh1NQbiFvOUHI3d2pnBJ4zgsgZcVzOTNf__Q0AAP__RbMdvw==

# There should be no "by hash" routers if there is a single stream.
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT c, d, sum(a+c::INT) + avg(b+d) FROM data WHERE a > 9 GROUP BY c, d]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJyUkkFrs0AQhu_fr5A5JWSCrvpB2dPmVAKpKWlSKEXC1h1ESFzZXaEl-N-L7qGxpbY9zjvzjI_MXqDWijJ5Jgv8GRgg_IccoTG6IGu16WM_tFavwCOEqm5a18c5QqENAb-Aq9yJgEOml7oJY0BQ5GR1GsY6BN26D8g6WRLwpMOrxWx68V6-nGhHUpEJo9F6aEx1luZNKOkkIIQsWgLCjmpFhgeCLUTC-Trb32Ag4oVIMRAJBiKF78TYX8RWZWmolE6bkI29RIIiBYRV9nTMtvtjdthsZiKZf4nSPno43M0EG5qPtzMRz0f_0Kv33osJ7Xik_cOhdmQbXVv61aWiLkcgVZJ_DFa3pqB7o4vhM77cDtwQKLLOdxNfrGvf6gWvYTYJx9NwPAlHn-C8-_ceAAD__ywG6r0=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), sum(b), sum(c) FROM data GROUP BY d HAVING sum(a+b) > 10]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzUlk1r20wQx-_PpxBzSnjWSLO7chKdFPoCgcQpaXIorQmKtTgGR2tWa2gI_u7FMsRv7YzC2mCfLNn-aWbn92fQG1S2NL3ixdSQ_QQEARIEKBCgQUAKfQETZwemrq2b_2UBXJW_IUsEjKrJ1M-_7gsYWGcgewM_8mMDGdwXT2NzZ4rSuDgBAaXxxWjclJm40UvhXvOy8AUI6MQYFVUZYWT9s3Eg4M5UpXFZlOP_uRRRjiJqPpWIcg39mQA79cvStS-GBjKcifbtXQ6HzgwLb12crneXz-8vez8ee7f3j72H6-uTPD0FAd8fbk5y-X6l3q_0-xWebjS3rPf0Gj0X9fNGKYT-bHkA-c8DLJ8zrawrjTPl2pOapxBHxGSr8OYZseUZm1l8HY19IyiNfk2TRJkIkyzLPn_5dHVzeQ0Cbqc-mzvLlSCMqd0euGc7dhJjuvHPv9fWa7WxfZiRDHOMnVjuIc5Mgyuuu4cZZ9xlnPEI4izbR0rSkZKdWO0hUkyDK_M-O8xIyV1GSh5BpFT7SCk6UqoT6z1EimlwZd7nhxkptctIqSOIlG4fKU1HSnfidA-RYhpcmffFYUZK7zJS-ggixbx535l6YqvatHpLS-YDMeXQLKZX26kbmG_ODpoyi9vbhmu-KE3tF7_i4uaqWvw0b3AVxk0YV2G5BuPH4G4IfBECY1DfmNK0JOetaFjRsrq0LU3SKQ2nIappmFFNw4xqGuZUMzSjuhui-oyEz2lZ5yGyaJiRRcOMLBrmZDE0I-siRBYyW5Rbo2F7NGyRhm3SwFUatksxaJkis001I21rnX5IGk1z0miak0bTrDQG56RtLVVSWn_2358AAAD__2K3tAE=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT avg(a+b), c FROM data GROUP BY c, d HAVING c = d]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzMltFro04Qx99_f4XMU8tvxcyupq1wYDk4KPTs0WsfjiMUG5ckkLphNXCl5H8_1HIxyd2MZRPwTVc_7sx-vgy-QWFynWYvuoT4JyAIkCBAgYAQBEQwEbCyZqrL0tj6lRa4yX9BPBKwKFbrql6eCJgaqyF-g2pRLTXE8JA9L_W9znJtgxEIyHWVLZbNNiu7eMnsa5JnVQYC_AC9rMg99Ew11xYEfFksK21jL1HeJy-pK7nXRd6s4P-JFF6iRL0-2Qgw62pbRFllMw0xbkT_Qq9nM6tnWWVsEO3WmdTncJ3-eErvHp7Sx9vbs0Sdg4Dvj1_PEqyvPt89pg_v17svyvO96rYbPr9686yc7-2FMNlsO5D_7GD7nXVhbK6tzne-1HyF6BFHBxvv145_mpTvV083dZvqsM3wvCtHBowYddy2UuObVYDR3pt_3zvc2Rv7pxfJ9AboB_Kk-WVK7bgdDzS_eMz84mDyK_tnSNIZkn6gTpohptTO-V4MNEPymBmSg8mQ6p8hRWdI-UF40gwxpXbO93KgGVLHzJAaTIbC_hkK6QyFfhCdNENMqZ3zvRpohsJjZigcTIaYn-R7Xa5MUepef1qjum2dz3R7RqVZ26n-Zs202aa9vWu4ZiHXZdU-xfbmpmgf1QV2YdyHsQvLHRg_Bo9d4CsXGJ3qxoimJXneioYVLWtM2wpJOqLhyEU1DTOqaZhRTcOcaoZmVI9dVF-Q8CUt69JFFg0zsmiYkUXDnCyGZmRduchCZopyY9RtjroNUrdJ6jhK3WYpOg1TZKZpyEg7GKcfkkbTnDSa5qTRNCuNwTlpB0OVlDbZ_Pc7AAD__whKrso=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a+b), sum(a+b) FILTER (WHERE a < d), sum(a+b) FILTER (WHERE a = c) FROM data GROUP BY d]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzMll1r20wQhe_fXyHmKuFdIe2HnERQUC5aCLhOcZ2L0pqgWIttcLRmJUND8H8vsgqSPzqjsBb4ytZKj-bMnMOgd8hNpkfpqy4g_gkcGAhgIIGBAgYRTBmsrZnpojC2eqQGHrLfEIcMlvl6U1bHUwYzYzXE71Auy5WGGCbpy0qPdZppG4TAINNlulztyqzt8jW1b0mWlikw8APupXnmcc-UC22BwVjnmbaxlyjmJfz_RFQ_vzZhKGf10adEwnTLwGzKRkFRpnMNMd-y7irv53Or52lpbBDti0yqYXx_-nqViOvmn_flYTj5PPYSeeKsGtn96Mfz6HHyPHoaDq8Sfn0gs6n88uYt0mJxUFTBdNu0Iv7ZSvOeTW5spq3O9t60ewvSLA-PCv_th18f9y0P22gkyvNKHBnfrAMeHTx5urbaq82755GjeQy4H4j-EknobJk0uPRE8nMmkveSSNE9FQJPhfAD2V8qCJ2tQd1ceirEOVMhekmF7J4KiadC-oHqLxWEztagbi89FfKcqZC9pEJ1T4XCU6H8IOovFYTO1qDuLj0V6pypUL1_05wQMNbF2uSF7vTFElYt6Gyu634Ls7Ez_c2a2a5Mffm443YHmS7K-i6vLx7y-lYlsA3zQ5i3YbEH84_BAxf4zgXmTrp5hNMCnbfEYYmbNcDdUigd4XDkYjUOE1bjMGE1DlNWEzRh9cDF6hsUvsXNunUxC4cJs3CYMAuHKbMImjDrzsUsTmxRao267VG3Req2SR1Xqdsu5U7LlBPbVBGmHa3TD5mG05RpOE2ZhtOkaQROmXa0VFHTptv__gQAAP__LThq5g==

# Same query but restricted to a single range; no local aggregation stage.
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a+b), sum(a+b) FILTER (WHERE a < d), sum(a+b) FILTER (WHERE a = c) FROM data WHERE a = 1 GROUP BY d]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJyUkUFL9DAQhu_fryjv6ROztEn3FBDiQWFBV6nrSXuIzVAKu01JUlCW_ndpc9hdcaue2nlnnskDs0drDa31jjzkCzgYBEqGztmKvLdujOPQyrxDZgxN2_VhjEuGyjqC3CM0YUuQWNuF7VIBBkNBN9tpbGCwfThAPuiaIPOBHS3m84s3-m1LBWlDLs1O1qNzzU67D2V00GBI-WISKKg15GSilixR_FKJ8fPaZ1lexehK5Tjnxv_idl3XjmodrEv5qZoa66fn-_9KXBz-ktvV3eamSFT-TbY86yROnH44REG-s62nX10iG0oGMjXFY3vbu4oena2mZ2L5MHFTYMiH2M1jsWpjaxQ8hvksLOZhMQtnX-By-PcZAAD__wBM4mk=

# Verify the XOR execution plan
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT xor_agg(to_hex(a)::bytes) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJyslN9rnTAUx9_3V8h52iASE_X2Nk_tYJS-rMP1YWNIyczBCrdGkggdxf99qA_VSxst-uiPbz5fPiecF6i1wu_yCS2IP8CAAAcCMRBIgEAKOYHG6AKt1ab_ZQzcqmcQEYGqblrXv84JFNogiBdwlTshCLiXf0-YoVRoaAQEFDpZnQZMY6onaf5dKekkEAgpC2StAhZo94gGCGRYKzQicPrhEZ8_X7EvQnz9ff_tJ-QdAd26V6x1skQQrCPrq12XpcFSOm1oOm_26y57uL656Ynvovi7qFdCW2uj0KCaHZ93_jIs-nibeNaGrZ8J886EspDynaeyUG4i4rB1Kny9B-73wEMa7-xhodzEw8VWD_F6D7HfQxzSZGcPC-UmHo5bPSTrPSR-D0lI0509LJSbeLjcc1u9gcrQNrq2eLa13j456rcZqhLH1Wd1awr8YXQxYMbHuyE3vFBo3fiVjQ-39fipLzgNM2-Yz8LsPMz95AV07E0n_nCypXfqDR_85MMW8oU3fPSTj1vIl_5ZRQvXxH_Jztl59-l_AAAA__-TneZ9

# Verify the XOR execution plan
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT xor_agg(a) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJyslE_rmzAYx-97FfKcNojERO2vP0_tqfSyjrLDYMjIzIMTWiNJhI3iex_qoVra6MiO_vnm8_3whOcGtZL4WVzRQPYdGBDgQCAGAgkQSCEn0GhVoDFK97-MgaP8DVlEoKqb1vavcwKF0gjZDWxlLwgZfBU_L3hGIVHTCAhItKK6DJhGV1eh_-yksAIIhJQFopYBC5T9hRoInFqbBTsGeUdAtfYOMVaUCBnryPoi-7LUWAqrNE3nPb6dzj_2h8PHHfv0EsVfou6EtlZaokY5Oz7v3GVY9O9t4lkbtn4CzDkBykLKvWawUGWivfGdAV9vzd3WPKSxl_VClYn1m691vN46dlvHIU28rBeqTKy3vtbJeuvEbZ2ENPWyXqgysX7_n1vmCeqMplG1wYdt8_zkqN9CKEscV5ZRrS7wi1bFgBkfT0NueCHR2PErGx-O9fipLzgNM2eYz8LsMczd5AV07Ewn7nDi0zt1hjdu8saH_OYMb93krQ_53T2raOGauC_ZIzvvPvwNAAD__-21yJY=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT max(t.a), min(t.b), avg(t.c)  FROM (VALUES (1, 2, 3), (4, 5, 6), (7, 8, 0)) AS t(a, b, c) WHERE b > 3]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJyUkM1KxDAUhfc-RTmrGQhM0m4kq3ajdDFVRETQLkJ7KYXYW_IjwtB3lzYLHWFEd7nn5jtfyAkT99SYN_LQL1BoBWbHHXnPbo3Shbr_gJYC4zTHsMatQMeOoE8IY7AEDcudsdm7sZF8Jg8SAj0FM9qt-Wa0gZzOyjx7jVIWlBVa67p5vEa7CHAMX80-mIGg1SL-bq-GwdFgAruDOjcfq-ddqfYQONbNrszXU_V0uyuL_UV1_h_1A_mZJ09n2kvNcmkFqB8ofa7n6Dq6d9xtmjTebdwW9ORD2qo01FNarQ_8Dqtf4fwH3C5XnwEAAP__aQiixw==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT * FROM (VALUES (1, '222'), (2, '444')) t1(a,b) JOIN (VALUES (1, 100.0), (3, 32.0)) t2(a,b) ON t1.a = t2.a]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJyckUFL_DAQxe__T1Hm9BcCbVJPAaFH14MrXqWH0IzdQsyUTCLC0u8uTQ7rLq7ueuvMvN-8zssePFl8NG_IoF9AQi9gDjQgM4W1VQQb-wG6ETD5OcW13QsYKCDoPcQpOgQNjgbjqnfjEnLV1A0IsBjN5LJ-EUApHmiOZkTQchF_dJC1vMhBnXU4LE6egsWA9nTj75JvfvPe8O6BJo-hVkdqcPga_3fy5i5M4y5_gYBtirrqpOiU6FrR3cK5S9prsnpGnskzXpRRs56BdsQSC1MKAz4FGrJNKbeZyw2LHMtUlWLj8yg_5ldYXgGrU1j9CLdHcLP0y7_PAAAA__870evq

statement ok
CREATE TABLE nullables (a INT, b INT, c INT, PRIMARY KEY (a))

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT array_agg(a) FROM (SELECT a FROM data WHERE b = 1 AND c = 1.0 AND d = 1.0 ORDER BY a)]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzMlMGK2zAQhu99CvGfEipXluyURVCw6XaXwDYpIZdSTFGjwTVkrSAp0LLk3Uts2q1L46bkkqNm_Hn-bw7zhNZZWphHCtCfIMGhwJGBIwfHDBXHzrsNheD88ZMemNtv0ClH0-728ViuODbOE_QTYhO3BI21-bKlFRlLXqTgsBRNs-3G7HzzaPz3wppowJEIyUxrmWQufiUPjrtmG8lrNpkUir1hUms9X6xvpqxc3LJJkR1rr1Kt9d3DslzfTH828l-N23dv5-_Lhyk4lvuoWSFRHTjcPj4nDtHUBC0P_ITVs4zzljzZoUYhX6I6_EW9rGtPtYnOi9kQKVer8uPn8v5-UsjpyURqkEiev2c5umchE6GuZ9PqfC817qUSkV2PV3a-VzbulSUivx6v_HyvfNwrT8Tserz-ccdWFHauDTRQOvXn9HgOyNbUn4_g9n5DH7zbdGP657LjuoKlEPuu7B_ztmt1AX-H5Sj8egCnf8LqksnZJXB-CTz7L7g6vPgRAAD__yJBDZ0=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT json_agg(a) FROM (SELECT a FROM data WHERE b = 1 AND c = 1.0 AND d = 1.0 ORDER BY a)]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzMlMGK2zAQhu99CvGfEipXluyURVCw6XaXlG1StrkVU9RocA1ZK0gKtCx59xKbduvSuFlyyVEz_jz_N4d5ROssLcwDBejPkOBQ4MjAkYNjhopj692aQnD-8EkPzO136JSjabe7eChXHGvnCfoRsYkbgsbKfN3QPRlLXqTgsBRNs-nGbH3zYPyPwppowJEIyUxrmWQufiMPjptmE8lrNpkUir1hUms9X6yupqxcXLNJkR1qr1Kt9c3dslxdTX818t-N63dv5x_Kuyk4lruoWSFR7TncLj4lDtHUBC33_IjVk4zzljzZoUYhX6La_0O9rGtPtYnOi9kQef9pufhS3t5OCjk9GkgNAsnT1yxH1yxkItTlLFqd7qXGvVQissvxyk73ysa9skTkl-OVn-6Vj3vliZhdjtd_ztg9ha1rAw2Ujv05PVwDsjX11yO4nV_TR-_W3Zj-uey4rmApxL4r-8e87VpdwD9hOQq_HsDp37A6Z3J2DpyfA8-eBVf7Fz8DAAD__0NIDVg=

# Test that orderings on GROUP BY columns are propagated through aggregations.
statement ok
CREATE TABLE sorted_data (a INT PRIMARY KEY, b INT, c FLOAT, INDEX foo(b))

# Split into ten parts.
statement ok
ALTER TABLE sorted_data SPLIT AT SELECT i FROM generate_series(1, 9) AS g(i)

# Relocate the ten parts to the five nodes.
statement ok
ALTER TABLE sorted_data EXPERIMENTAL_RELOCATE
  SELECT ARRAY[i%5+1], i FROM generate_series(0, 9) AS g(i)

# Verify data placement.
query TTTI colnames
SELECT start_key, end_key, replicas, lease_holder FROM [SHOW EXPERIMENTAL_RANGES FROM TABLE sorted_data]
----
start_key  end_key  replicas  lease_holder
NULL       /1       {1}       1
/1         /2       {2}       2
/2         /3       {3}       3
/3         /4       {4}       4
/4         /5       {5}       5
/5         /6       {1}       1
/6         /7       {2}       2
/7         /8       {3}       3
/8         /9       {4}       4
/9         NULL     {5}       5

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT a, max(b) FROM sorted_data GROUP BY a]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJyUkcFq8zAQhO__U_zMKYENsRx68Uk5BlKnhBRaigmqtTWB1GskGQrB715sHRoX4rbHHe03M6wuqMVybt7ZI3uBAuEOBaFxUrL34no5Lm3sB7KEcKqbNvRyQSjFMbILwimcGRlyWUizTEGwHMzpPKx1BGnDF-SDqRjZqqMrYzVtfDCvZ96zseyWycgebyLaiwtsj9YEA8IChF0bsv9akU5xq4D6S4F1VTmuTBC3VON83c_r_PmY7w7H_HG7nWk1B-F-_TTT6fxmfDqK_-Gwe_aN1J5_ddmkKwhsK46f56V1JT84KYeYOO4GbhAs-xBfV3HY1PGpL3gNq0k4nYbTSTj5Bhfdv88AAAD__w_v2EE=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT a, max(b) FROM sorted_data GROUP BY a ORDER BY a]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzMlkFr4kAUx-_7KeSdWnZCfJPEtjmlx0JXl9KFXRaRqfNQwToyGWFL8bsvMQejbuelTFw8mvib-c_8Hn_yDiujaaheqYT8NyAIkCAgAQEpCMhgLGBtzZTK0tjqLzXwoP9A3hewWK03rno8FjA1liB_B7dwS4IcntXLkp5IabJxHwRocmqx3G2ztotXZd-K0lhHeqKVUyAgirGnVrqHPePmZEHAaOPyXoGikDDeCjAbt9-udGpGkONWtI90P5tZmilnbJwdJiqqk4-sJku62hIE3A9_TYaj58nwx-PjVYHXIODb_c-rQl4fhdmv__LWm6tyfrL0eLsPLD8MvF_H1EGO1_laL-Q5Ffa7O9Y-ctJ55KGJzDrGQwkfbZ8ebI_tpw7bTF2MUSxD544J1TA0uIy5w47nDs8_d7K9eNlKvIziJFQ8E6pxRTeXIV52LF6eX3zSXnzSSnwSxWmoeCZU44puL0N80rH45Pzi0_bi01bi0yjOQsUzoRpXdHcZ4tOOxaf_9xPjH2meqFybVUmtvh761XlIz6g-f2k2dkrfrZnutql_jnbc7oGm0tVvsf7xsKpfVQGbMB7D2ITlAYyfgwch8F0IjEG5MfPT0nvfiR9O_LIGflupl878cBai2g8zqv0wo9oPc6oZmlE9CFF944Vv_bJuQ2T5YUaWH2Zk-WFOFkMzsu5CZCHTolyNhvVoWJGGNWlglYZ1KQaVKTJtmjLSTur0U9L8NCfNT3PS_DQrjcE5aSel6pU23n75GwAA__8cdVaJ

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT c, min(b), a FROM sorted_data GROUP BY a, c]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzMlk1r4zAQhu_7K8ycWlbGkWSnjU_uMdB1ltI9LEsIaiSSQGoFWYEtJf99iX2I87EaNcrBR388nhm9D4M_odJSleJd1ZD_AQoEGBDgQCAFAhlMCWyMnqu61mb_SguM5V_IBwRW1WZr97enBObaKMg_wa7sWkEOr-JtrV6UkMokAyAglRWrdVNmY1bvwnwUtTZWyZkUVgCBOKGRqGREI22XysB0R0Bv7aFCbcVCQU53xL-Lp8XCqIWw2iTZcRPFftiJkcoomUfN1VP5e1ZOXmflr-fnu4LeA4Ef4_KuYPdnD_n9SX-Hkm8f0VLUy7Nq091hBvbfGQ7f0W1vp9_53n7IMSgd3HhSApOtzaOCk4KRZpLLyXCPqbbVpbkujlTqWG8Smp28ebl2elSb-rtJfdxMaJywK-xE-uiENuytnfTGdtJe2Mn8DWFehrA44VcYgvTRObiH3hrCbmwI64Uh3N8Q7mUIj5P0CkOQPjoH99hbQ_iNDeG9MCT1NyT1MiSNk-wKQ5A-Ogc36q0h6Y0NSXthCPJ3-qLqja5q5fWHM9iPrORCtUdU662Zq59Gz5sy7eWk4ZobUtW2fUrbi3HVPto32IXpKUy7MDuC6dfgYQg8CoFpUN80c9PMed7cDXN3WEN3WqmTztxwFhK1G0aidsNI1G4YixqhkaiHIVE_OOFHd1iPIWG5YSQsN4yE5YaxsBAaCWsUEhZFtii2RsP2aNgiDdukgas0bJfSoGVKkW2aIqGdrdMvheamsdDcNBaam0ZDQ3AstLOl6gxtuvv2LwAA___Jb4vP

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT c, min(b), a FROM sorted_data GROUP BY a, c ORDER BY a]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzMlsFu4jAQhu_7FNGcitZRsJ1QyCk9InXDquoeViuEUjwCJIqRY6StKt59RXIgwOJJMYccQ_g8M_5-jfIJG60wL96xhPQPcGAggIEEBjEwSGDKYGv0HMtSm8NfamCs_kLaZ7DabHf28POUwVwbhPQT7MquEVJ4Ld7W-IKFQhP1gYFCW6zWVZmtWb0X5iMrtbGoZqqwBTAIIx4UGxXwQNslGpjuGeidPVYobbFASPmete_iabEwuCisNlFy2kR2GHZiFBpUaVA9PeW_Z_nkdZb_en5-yHgPGPwY5w-Z6F28lL2z_o4l3z6CZVEuL6pN98cZxNUZjufourfzc77XBzkG5f07T8pgsrNpkEmWCVZN8n8z8uap5JWpch3qbcRP1V0rH5-U5-3jydvEM-JhJG4IKNFHw9ugswHldw4o70RARfuEiFYJEWEkb0gI0Ufj4h47mxBx54SITiREtk-IbJUQGUbxDQkh-mhc3LCzCZF3TojsRELi9gmJWyUkDqPkhoQQfTQubtTZhMR3TkjciYQQH6gvWG71psRWXzj9w8ioFlhfUal3Zo4_jZ5XZerHScVVPygsbf2W1w_jTf3q0GAT5ucwb8LiBOZfgwc-8MgH5l5988RNC-d9Szcs3bIGbluxk07ccOKj2g0Tqt0wodoNU6oJmlA98FH96ISHbllDH1lumJDlhglZbpiSRdCErJGPLE5sUWqN-u1Rv0Xqt0k9V6nfLuVey5QT2zQmpF2s0y9Jc9OUNDdNSXPTpDQCp6RdLFWntOn-278AAAD__wh0i84=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT b, max(c) FROM sorted_data@foo GROUP BY b]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJyUkkFrq0AQx-_vUzz-pwQ2xNW8iydzzCNPHyGFliJh605FSBzZXaEl-N2LbqExENscd2Z-8_vLeEbNmlJ1Iov4GRICf5ALNIYLspZNX_ZDG_2GOBCo6qZ1fTkXKNgQ4jNc5Y6EGCkvuFlGENDkVHUcxjoBbt0XZJ0qCfGqExeL5fTivXo50o6UJrMMRuvxypxYNo70QSunILCAQNa6-Hciccsu77H_5ar-lMuxvDHVSZn3qwBeHookuukP7_Gvy9JQqRybZTj2J32ezGgypIfvFVinT4c02x_Sh-12lsg5BP6tH2dJOL8ZJhqF-ebGO7IN15Z-dOSgywVIl-T_I8utKei_4WLQ-Gc2cENBk3W-u_KPTe1bfcBLWE7C4TQcTsLRNBxNwsEVnHe_PgIAAP__RlAaYA==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT * FROM (SELECT a, max(c) FROM sorted_data GROUP BY a) JOIN (SELECT b, min(c) FROM sorted_data@foo GROUP BY b) ON a = b]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzMl11r6zgQhu_3V4S5aqmCI9n5hAX3skubLKULuyyhuLGaBNIoyA5sKfnvS2IO-XA6r1Wl5_iuif1IM9XzdqoPWppUD5M3ndHgX5IkSJGgkARFJKhNY0ErayY6y4zdvlIAd-l_NGgJmi9X63z79VjQxFhNgw_K5_lC04CekpeFftRJqm3QIkGpzpP5YrfNys7fEvseZ8bmOn1OkzwhQc1ANpJl2pANk8-0JUGjdT5oxFLEIY03gsw632-X5clU00BuRPWSbqdTq6dJbmzQPq4o3nY-sqm2Ot1uSYJuh_88D0dPz8O_7u-vYnlNgh5u_76K1fVJMfv1X94bsySblZYeb_YFq08L3q9jikJO17kpFmK6kq1f1Vbo15bYv7VennvvbOcP2k71H2a-1DaQveN1F_o1v4rlzfXvdj6dFT8eKqVEHIo4-lSsboWGHEodmqZZBSo8efP83r2jvWX1nMkqOQtkM1C-SQNFHTjZqUfS5IWTJuuRNOe2LpC0_ncmTVW3XVWyXTWD0Nd2UNSBF9162K4ubLuqh-3ObfnbrlrfaXtY3fawku1hM4h8bQdFHXjRq4ft4YVtD-thu3NbF7BdfqftUXXbo0q2R82g7Ws7KOrAi349bI8ubHtUD9sd5JAnt7dXY07vknsTPtUgctl-m48fu3equFnsrjgP21_0UH7tn4y7ofeJdfxEvMDfJ_WzbnlnCnnU2cosM13pDtfatqLTqS5-O5lZ24n-05rJbpvi42jH7b5IdZYXT2Xx4W5ZPNoWeAjLU1gewuoIlm5w1weW0otue9F9nlYsHfrAPR9YguMCdMeHVqDtkJU04uGIhVXEK95m6Q4Pd3zywcMgHzyM8gFokA9Ag3x0ffLBwyAfPIzyAWiQD55G-ej55KPPT4AWGAGlAeI0A3gaDQGehlMA4GgMABx4LvkxAk4c0MB0QCPVEQ5cBziSXZZmiYvtkp8lEowDWZomTrrzNNKdp6HuAEe6AxzpXhqkTrrzNNKdp6HuAEe68zjUvTROnXQvDZZj3XtA99JkcdKdp5HuPA11BzjSHeBI99JUddKdp5HuPA11BzjSnceR7oq_kCpwI1Wl2XKMK4C73M6UI93zok-OzRnveOEKte52RRtvfvs_AAD__09QBJo=

# Verify that the stages preserve the ordering as expected.
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(x) FROM (SELECT a, b::float + c AS x FROM data) GROUP BY a ORDER BY a]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzMlkGL4k4Qxe__TxHqNMN0iNWJjuYUL38YcHVxncOyyJAxjQpOWjoRdhj87ksSWKOuVZnt4Hps46_rVb1H0R-Q6kSN4zeVQfgDEARIEOCDgAAEdGEuYGv0QmWZNsVfKuAp-QlhR8A63e7y4ue5gIU2CsIPyNf5RkEIs_h1o6YqTpTxOiAgUXm83pRltmb9Fpv3KInzGAS4HjpxmjjS0flKmQwETFWaKBM6kf8QyTD8fzQZzvrCiRDmewF6lx_qZnm8VBDiXjTXNlwujVrGuTZe91haVLQ_MYkyKgmd8jQcf38ZT2Yv4-fR6C6S9yDg2_OXuwjvT8Qc7n99d1Zxtjq5uhB_ECwvCj7coyshp_c8VBcRXWHnrHa9LTxrC3-3VTY42eVF94IYuP_X-uUF_WPt6q2Hx45cKh8clcfmWUQyix66nizTiFUaWwgjI65mW-82wogthxGvHEbZPA2SToN0Pb_lNDDianN7vI00yJbTIK-cBr95Gnw6Db7rBS2ngRFXm1v_NtLgt5wG_8ppCJqnIaDTELjl48E2AYyg2qwGt5GAoOUEBP_wqfIHaVOVbXWaqUavkE7RnEqWqhpGpndmob4avSjLVMdJyZU_JCrLq69YHZ7S6lMhsA7jKYx1WB7B-Dm4ZwMPbGC00o1dmpbkvH0a9mmzerRbAUl3abhrYzUNM1bTMGM1DXNWMzRjdc_G6kcS7tNm9W3MomHGLBpmzKJhziyGZswa2JiFzBbl1qjdHrVbpHab1HKV2u1StFqmyGzTgDHtbJ1-yjSa5kyjac40mmZNY3DOtLOlSpo23__3KwAA__8spGiF

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(x) FROM (SELECT a, b::float + c AS x FROM data) WHERE a > x GROUP BY a ORDER BY a]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzMlk9r20wQh-_vpxBzSsgaaXblfzopl0Agr13S5FBaExRrcQyO16zW0BDy3Yu0UMtWM2PXwvXRkp-dmf09DHqHpcn1KHvVBSTfAUGABAEKBMQgoAsTAStrproojC3_4oHb_CckkYD5crV25eOJgKmxGpJ3cHO30JDAQ_a80Pc6y7UNIxCQa5fNF1WZlZ2_ZvYtzTOXgYBOiEG2zAMZGPeibQEC7vUy1zYJUnWVyiS5uRtfPwxEkCJMPgSYtdvULVw205Dgh9i_t5HpmFXY3e7qZr5wVU0Z_FhHkdJUOXlIuevZzOpZ5owNcecq0vK6xzbXVudlaRBwPfr2NBo_PI0e7-4uUnkJAr4-_n-R4uVON5sCz2_BS1a87Bxddr_pWH3a8eYc4xvZPefKH0SN1W3Uro-FjbHw91jVgOO1K6cXxI3Hf92__KR_b4HcTuSz8t2t8ri_-0i6H2InlJX96O1vQX6mOT92rzX5mXJ1S_A85MeW5e-dWH65v32Stk92QtWyfUxz3r5-a_Yx5eoxyfOwT7ZsX__E9qn97VO0faoTxi3bxzTn7Ru0Zh9Trh6TOg_7VMv2DU5sX7y_fTFtX9ypvgCPNY5pyBs3bM04plw9mvg8jItbNm74Dz81_9DavS5WZlnovb4io3I4nc-0v4zCrO1Uf7FmWpXxP8cVVz3IdeH8W_Q_bpf-VdlgHUYSljQsd2Gsw2oLxsPgwTEwyqPo3jG0jGhakRce03BMp8Vk3SXpHg33SLhPw_1jRKFhRhQa5kRhaEYUmuZEGRwjypDeCRGzFJiVwu2UxlI5JG6GZvJmaC5wDmcSZ3AucmyslkMyR3q1YMykRi8X7DJ4Y7scFDpNc6HTNBs6g3Oh0zgbOr1ZudAbS2Y7tQGTGr1lcMjgjT1zUOg0zYVO02zoDM6FTuNc6JLesLuhTz7--xUAAP__X82CAQ==
