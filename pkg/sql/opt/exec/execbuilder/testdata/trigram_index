# LogicTest: local

statement ok
CREATE TABLE a (
  a INT PRIMARY KEY,
  b TEXT,
  FAMILY (a,b),
  INVERTED INDEX(b)
)

query T
EXPLAIN SELECT * FROM a WHERE b LIKE '%foo%'
----
distribution: local
vectorized: true
·
• filter
│ filter: b LIKE '%foo%'
│
└── • index join
    │ table: a@a_pkey
    │
    └── • scan
          missing stats
          table: a@a_b_idx
          spans: 1 span

query T
EXPLAIN SELECT * FROM a WHERE b ILIKE '%foo%'
----
distribution: local
vectorized: true
·
• filter
│ filter: b ILIKE '%foo%'
│
└── • index join
    │ table: a@a_pkey
    │
    └── • scan
          missing stats
          table: a@a_b_idx
          spans: 1 span

query T
EXPLAIN SELECT * FROM a WHERE b LIKE '%foo%' OR b ILIKE '%bar%'
----
distribution: local
vectorized: true
·
• filter
│ filter: (b LIKE '%foo%') OR (b ILIKE '%bar%')
│
└── • index join
    │ table: a@a_pkey
    │
    └── • inverted filter
        │ inverted column: b_inverted_key
        │ num spans: 2
        │
        └── • scan
              missing stats
              table: a@a_b_idx
              spans: 2 spans

query T
EXPLAIN SELECT * FROM a WHERE b LIKE '%foo%' OR b ILIKE '%bar%'
----
distribution: local
vectorized: true
·
• filter
│ filter: (b LIKE '%foo%') OR (b ILIKE '%bar%')
│
└── • index join
    │ table: a@a_pkey
    │
    └── • inverted filter
        │ inverted column: b_inverted_key
        │ num spans: 2
        │
        └── • scan
              missing stats
              table: a@a_b_idx
              spans: 2 spans

query T
EXPLAIN SELECT * FROM a WHERE b LIKE '%foo%zoo%'
----
distribution: local
vectorized: true
·
• lookup join
│ table: a@a_pkey
│ equality: (a) = (a)
│ equality cols are key
│ pred: b LIKE '%foo%zoo%'
│
└── • zigzag join
      left table: a@a_b_idx
      left columns: (a, b_inverted_key)
      left fixed values: 1 column
      right table: a@a_b_idx
      right columns: (a, b_inverted_key)
      right fixed values: 1 column

# Test that trigram index can't support searches with fewer than 3 characters.
query T
EXPLAIN SELECT * FROM a WHERE b LIKE '%fo'
----
distribution: local
vectorized: true
·
• filter
│ filter: b LIKE '%fo'
│
└── • scan
      missing stats
      table: a@a_pkey
      spans: FULL SCAN
