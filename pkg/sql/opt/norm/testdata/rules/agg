exec-ddl
CREATE TABLE a (k INT PRIMARY KEY, i INT, f FLOAT, s STRING, j JSON, arr int[])
----

# --------------------------------------------------
# EliminateAggDistinct
# --------------------------------------------------

norm expect=EliminateAggDistinct
SELECT min(DISTINCT i), max(DISTINCT i), bool_and(DISTINCT i>f), bool_or(DISTINCT i>f), corr(DISTINCT k, i) FROM a
----
scalar-group-by
 ├── columns: min:7 max:8 bool_and:10 bool_or:11 corr:12
 ├── cardinality: [1 - 1]
 ├── key: ()
 ├── fd: ()-->(7,8,10-12)
 ├── project
 │    ├── columns: column9:9 k:1!null i:2
 │    ├── key: (1)
 │    ├── fd: (1)-->(2,9)
 │    ├── scan a
 │    │    ├── columns: k:1!null i:2 f:3
 │    │    ├── key: (1)
 │    │    └── fd: (1)-->(2,3)
 │    └── projections
 │         └── i > f [outer=(2,3)]
 └── aggregations
      ├── min [outer=(2)] [aggregated as min:7]
      │    └── variable: i:2
      ├── max [outer=(2)] [aggregated as max:8]
      │    └── variable: i:2
      ├── bool-and [outer=(9)] [aggregated as bool_and:10]
      │    └── variable: column9:9
      ├── bool-or [outer=(9)] [aggregated as bool_or:11]
      │    └── variable: column9:9
      └── corr [outer=(1,2)] [aggregated as corr:12]
           ├── variable: k:1
           └── variable: i:2

# The rule should still work when FILTER is present.
norm expect=EliminateAggDistinct
SELECT
    min(DISTINCT i) FILTER (WHERE i > 5),
    max(DISTINCT i) FILTER (WHERE i > 5),
    bool_and(DISTINCT i>f) FILTER (WHERE f > 0.0),
    bool_or(DISTINCT i>f) FILTER (WHERE f > 1.0),
    corr(DISTINCT k, i) FILTER(WHERE k > 5 AND i > 5)
FROM a
----
scalar-group-by
 ├── columns: min:8 max:9 bool_and:12 bool_or:14 corr:16
 ├── cardinality: [1 - 1]
 ├── key: ()
 ├── fd: ()-->(8,9,12,14,16)
 ├── project
 │    ├── columns: column7:7 column10:10 column11:11 column13:13 column15:15 k:1!null i:2
 │    ├── key: (1)
 │    ├── fd: (1)-->(2,7,10,11,13), (2)-->(7), (1,2)-->(15)
 │    ├── scan a
 │    │    ├── columns: k:1!null i:2 f:3
 │    │    ├── key: (1)
 │    │    └── fd: (1)-->(2,3)
 │    └── projections
 │         ├── i > 5 [outer=(2)]
 │         ├── i > f [outer=(2,3)]
 │         ├── f > 0.0 [outer=(3)]
 │         ├── f > 1.0 [outer=(3)]
 │         └── (k > 5) AND (i > 5) [outer=(1,2)]
 └── aggregations
      ├── agg-filter [outer=(2,7)] [aggregated as min:8]
      │    ├── min
      │    │    └── variable: i:2
      │    └── variable: column7:7
      ├── agg-filter [outer=(2,7)] [aggregated as max:9]
      │    ├── max
      │    │    └── variable: i:2
      │    └── variable: column7:7
      ├── agg-filter [outer=(10,11)] [aggregated as bool_and:12]
      │    ├── bool-and
      │    │    └── variable: column10:10
      │    └── variable: column11:11
      ├── agg-filter [outer=(10,13)] [aggregated as bool_or:14]
      │    ├── bool-or
      │    │    └── variable: column10:10
      │    └── variable: column13:13
      └── agg-filter [outer=(1,2,15)] [aggregated as corr:16]
           ├── corr
           │    ├── variable: k:1
           │    └── variable: i:2
           └── variable: column15:15

# The rule should not apply to these aggregations.
norm expect-not=EliminateAggDistinct
SELECT
    count(DISTINCT i),
    sum(DISTINCT i) FILTER (WHERE i > 5),
    sum_int(DISTINCT i),
    avg(DISTINCT i),
    stddev(DISTINCT f),
    variance(DISTINCT f),
    xor_agg(DISTINCT s::BYTES),
    array_agg(DISTINCT i),
    json_agg(DISTINCT j)
FROM a
----
scalar-group-by
 ├── columns: count:7!null sum:9 sum_int:10 avg:11 stddev:12 variance:13 xor_agg:15 array_agg:16 json_agg:17
 ├── cardinality: [1 - 1]
 ├── key: ()
 ├── fd: ()-->(7,9-13,15-17)
 ├── project
 │    ├── columns: column8:8 column14:14 i:2 f:3 j:5
 │    ├── fd: (2)-->(8)
 │    ├── scan a
 │    │    └── columns: i:2 f:3 s:4 j:5
 │    └── projections
 │         ├── i > 5 [outer=(2)]
 │         └── s::BYTES [outer=(4)]
 └── aggregations
      ├── agg-distinct [outer=(2)] [aggregated as count:7]
      │    └── count
      │         └── variable: i:2
      ├── agg-filter [outer=(2,8)] [aggregated as sum:9]
      │    ├── agg-distinct
      │    │    └── sum
      │    │         └── variable: i:2
      │    └── variable: column8:8
      ├── agg-distinct [outer=(2)] [aggregated as sum_int:10]
      │    └── sum-int
      │         └── variable: i:2
      ├── agg-distinct [outer=(2)] [aggregated as avg:11]
      │    └── avg
      │         └── variable: i:2
      ├── agg-distinct [outer=(3)] [aggregated as stddev:12]
      │    └── std-dev
      │         └── variable: f:3
      ├── agg-distinct [outer=(3)] [aggregated as variance:13]
      │    └── variance
      │         └── variable: f:3
      ├── agg-distinct [outer=(14)] [aggregated as xor_agg:15]
      │    └── xor-agg
      │         └── variable: column14:14
      ├── agg-distinct [outer=(2)] [aggregated as array_agg:16]
      │    └── array-agg
      │         └── variable: i:2
      └── agg-distinct [outer=(5)] [aggregated as json_agg:17]
           └── json-agg
                └── variable: j:5
