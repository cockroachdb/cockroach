# tests adapted from logictest -- where

exec-ddl
CREATE TABLE kv (
  k INT PRIMARY KEY,
  v INT
)
----

exec-ddl
CREATE TABLE kvString (
  k STRING PRIMARY KEY,
  v STRING
)
----

build
SELECT * FROM kv WHERE k IN (1, 3)
----
select
 ├── columns: k:1!null v:2
 ├── scan kv
 │    └── columns: k:1!null v:2
 └── filters
      └── k IN (1, 3)

build
SELECT * FROM kv WHERE v IN (6)
----
select
 ├── columns: k:1!null v:2!null
 ├── scan kv
 │    └── columns: k:1!null v:2
 └── filters
      └── v IN (6,)

build
SELECT * FROM kv WHERE k IN (SELECT k FROM kv)
----
select
 ├── columns: k:1!null v:2
 ├── scan kv
 │    └── columns: k:1!null v:2
 └── filters
      └── any: eq
           ├── project
           │    ├── columns: k:3!null
           │    └── scan kv
           │         └── columns: k:3!null v:4
           └── variable: k:1

build
SELECT * FROM kv WHERE (k,v) IN (SELECT * FROM kv)
----
select
 ├── columns: k:1!null v:2
 ├── scan kv
 │    └── columns: k:1!null v:2
 └── filters
      └── any: eq
           ├── project
           │    ├── columns: column5:5
           │    ├── scan kv
           │    │    └── columns: k:3!null v:4
           │    └── projections
           │         └── (k, v)
           └── (k, v)

build
SELECT * FROM kv WHERE nonexistent = 1
----
error (42703): column "nonexistent" does not exist

build
SELECT 'hello' LIKE v AS r FROM kvString WHERE k LIKE 'like%' ORDER BY k
----
project
 ├── columns: r:3  [hidden: k:1!null]
 ├── ordering: +1
 ├── select
 │    ├── columns: k:1!null v:2
 │    ├── ordering: +1
 │    ├── scan kvstring
 │    │    ├── columns: k:1!null v:2
 │    │    └── ordering: +1
 │    └── filters
 │         └── k LIKE 'like%'
 └── projections
      └── 'hello' LIKE v

build
SELECT 'hello' SIMILAR TO v AS r FROM kvString WHERE k SIMILAR TO 'like[1-2]' ORDER BY k
----
project
 ├── columns: r:3  [hidden: k:1!null]
 ├── ordering: +1
 ├── select
 │    ├── columns: k:1!null v:2
 │    ├── ordering: +1
 │    ├── scan kvstring
 │    │    ├── columns: k:1!null v:2
 │    │    └── ordering: +1
 │    └── filters
 │         └── k SIMILAR TO 'like[1-2]'
 └── projections
      └── 'hello' SIMILAR TO v

build
SELECT 'hello' ~ replace(v, '%', '.*') AS r FROM kvString WHERE k ~ 'like[1-2]' ORDER BY k
----
project
 ├── columns: r:3  [hidden: k:1!null]
 ├── ordering: +1
 ├── select
 │    ├── columns: k:1!null v:2
 │    ├── ordering: +1
 │    ├── scan kvstring
 │    │    ├── columns: k:1!null v:2
 │    │    └── ordering: +1
 │    └── filters
 │         └── k ~ 'like[1-2]'
 └── projections
      └── 'hello' ~ replace(v, '%', '.*')

# Test mixed type tuple comparison.

build
SELECT * FROM kv WHERE k IN (1, 5.0, 9)
----
select
 ├── columns: k:1!null v:2
 ├── scan kv
 │    └── columns: k:1!null v:2
 └── filters
      └── k IN (1, 5, 9)

# Regression tests for #22670.
exec-ddl
CREATE TABLE ab (a INT, b INT)
----

build
SELECT * FROM ab WHERE a IN (1, 3, 4)
----
project
 ├── columns: a:1!null b:2
 └── select
      ├── columns: a:1!null b:2 rowid:3!null
      ├── scan ab
      │    └── columns: a:1 b:2 rowid:3!null
      └── filters
           └── a IN (1, 3, 4)

build
SELECT * FROM ab WHERE a IN (1, 3, 4, NULL)
----
project
 ├── columns: a:1!null b:2
 └── select
      ├── columns: a:1!null b:2 rowid:3!null
      ├── scan ab
      │    └── columns: a:1 b:2 rowid:3!null
      └── filters
           └── a IN (1, 3, 4, NULL)

build
SELECT * FROM ab WHERE (a, b) IN ((1, 10), (3, 30), (4, 40))
----
project
 ├── columns: a:1!null b:2!null
 └── select
      ├── columns: a:1!null b:2!null rowid:3!null
      ├── scan ab
      │    └── columns: a:1 b:2 rowid:3!null
      └── filters
           └── (a, b) IN ((1, 10), (3, 30), (4, 40))

build
SELECT * FROM ab WHERE (a, b) IN ((1, 10), (4, NULL), (NULL, 50))
----
project
 ├── columns: a:1!null b:2!null
 └── select
      ├── columns: a:1!null b:2!null rowid:3!null
      ├── scan ab
      │    └── columns: a:1 b:2 rowid:3!null
      └── filters
           └── (a, b) IN ((1, 10), (4, NULL), (NULL, 50))

# Where clause must be type bool.
build
SELECT * FROM ab WHERE a
----
error (42804): argument of WHERE must be type bool, not type int
