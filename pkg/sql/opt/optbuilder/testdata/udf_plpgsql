exec-ddl
CREATE TABLE xy (x INT, y INT);
----

exec-ddl
CREATE TABLE kv (k INT PRIMARY KEY, v INT);
----

exec-ddl
CREATE OR REPLACE FUNCTION f(a INT, b INT) RETURNS INT AS $$
  BEGIN
    RETURN a;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(1, 2);
----
project
 ├── columns: f:4
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:4]
           ├── args
           │    ├── const: 1
           │    └── const: 2
           ├── params: a:1 b:2
           └── body
                └── limit
                     ├── columns: stmt_return_1:3
                     ├── project
                     │    ├── columns: stmt_return_1:3
                     │    ├── values
                     │    │    └── tuple
                     │    └── projections
                     │         └── variable: a:1 [as=stmt_return_1:3]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(a INT, b INT) RETURNS INT AS $$
  BEGIN
    RETURN a + b;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(1, 2);
----
project
 ├── columns: f:4
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:4]
           ├── args
           │    ├── const: 1
           │    └── const: 2
           ├── params: a:1 b:2
           └── body
                └── limit
                     ├── columns: stmt_return_1:3
                     ├── project
                     │    ├── columns: stmt_return_1:3
                     │    ├── values
                     │    │    └── tuple
                     │    └── projections
                     │         └── plus [as=stmt_return_1:3]
                     │              ├── variable: a:1
                     │              └── variable: b:2
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(a INT, b INT) RETURNS INT AS $$
  DECLARE
    c INT;
  BEGIN
    RETURN c;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(1, 2);
----
project
 ├── columns: f:5
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:5]
           ├── args
           │    ├── const: 1
           │    └── const: 2
           ├── params: a:1 b:2
           └── body
                └── limit
                     ├── columns: stmt_return_1:4
                     ├── project
                     │    ├── columns: stmt_return_1:4
                     │    ├── project
                     │    │    ├── columns: c:3
                     │    │    ├── values
                     │    │    │    └── tuple
                     │    │    └── projections
                     │    │         └── cast: INT8 [as=c:3]
                     │    │              └── null
                     │    └── projections
                     │         └── variable: c:3 [as=stmt_return_1:4]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(a INT, b INT) RETURNS INT AS $$
  DECLARE
    c INT := 0;
  BEGIN
    RETURN c;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(1, 2);
----
project
 ├── columns: f:5
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:5]
           ├── args
           │    ├── const: 1
           │    └── const: 2
           ├── params: a:1 b:2
           └── body
                └── limit
                     ├── columns: stmt_return_1:4!null
                     ├── project
                     │    ├── columns: stmt_return_1:4!null
                     │    ├── project
                     │    │    ├── columns: c:3!null
                     │    │    ├── values
                     │    │    │    └── tuple
                     │    │    └── projections
                     │    │         └── const: 0 [as=c:3]
                     │    └── projections
                     │         └── variable: c:3 [as=stmt_return_1:4]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(a INT, b INT) RETURNS INT AS $$
  DECLARE
    c INT;
  BEGIN
    c := 0;
    RETURN c;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(1, 2);
----
project
 ├── columns: f:6
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:6]
           ├── args
           │    ├── const: 1
           │    └── const: 2
           ├── params: a:1 b:2
           └── body
                └── limit
                     ├── columns: stmt_return_1:5!null
                     ├── project
                     │    ├── columns: stmt_return_1:5!null
                     │    ├── project
                     │    │    ├── columns: c:4!null
                     │    │    ├── project
                     │    │    │    ├── columns: c:3
                     │    │    │    ├── values
                     │    │    │    │    └── tuple
                     │    │    │    └── projections
                     │    │    │         └── cast: INT8 [as=c:3]
                     │    │    │              └── null
                     │    │    └── projections
                     │    │         └── const: 0 [as=c:4]
                     │    └── projections
                     │         └── variable: c:4 [as=stmt_return_1:5]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(a INT, b INT) RETURNS INT AS $$
  DECLARE
    c INT;
  BEGIN
    IF a < b THEN
      c := a;
    END IF;
    RETURN c;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(1, 2);
----
project
 ├── columns: f:12
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:12]
           ├── args
           │    ├── const: 1
           │    └── const: 2
           ├── params: a:1 b:2
           └── body
                └── limit
                     ├── columns: stmt_if_3:11
                     ├── project
                     │    ├── columns: stmt_if_3:11
                     │    ├── project
                     │    │    ├── columns: c:3
                     │    │    ├── values
                     │    │    │    └── tuple
                     │    │    └── projections
                     │    │         └── cast: INT8 [as=c:3]
                     │    │              └── null
                     │    └── projections
                     │         └── case [as=stmt_if_3:11]
                     │              ├── true
                     │              ├── when
                     │              │    ├── lt
                     │              │    │    ├── variable: a:1
                     │              │    │    └── variable: b:2
                     │              │    └── subquery
                     │              │         └── project
                     │              │              ├── columns: stmt_if_1:9
                     │              │              ├── project
                     │              │              │    ├── columns: c:8
                     │              │              │    ├── values
                     │              │              │    │    └── tuple
                     │              │              │    └── projections
                     │              │              │         └── variable: a:1 [as=c:8]
                     │              │              └── projections
                     │              │                   └── udf: stmt_if_1 [as=stmt_if_1:9]
                     │              │                        ├── args
                     │              │                        │    ├── variable: c:8
                     │              │                        │    ├── variable: a:1
                     │              │                        │    └── variable: b:2
                     │              │                        ├── params: c:4 a:5 b:6
                     │              │                        └── body
                     │              │                             └── project
                     │              │                                  ├── columns: stmt_return_2:7
                     │              │                                  ├── values
                     │              │                                  │    └── tuple
                     │              │                                  └── projections
                     │              │                                       └── variable: c:4 [as=stmt_return_2:7]
                     │              └── subquery
                     │                   └── project
                     │                        ├── columns: stmt_if_1:10
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── udf: stmt_if_1 [as=stmt_if_1:10]
                     │                                  ├── args
                     │                                  │    ├── variable: c:3
                     │                                  │    ├── variable: a:1
                     │                                  │    └── variable: b:2
                     │                                  ├── params: c:4 a:5 b:6
                     │                                  └── body
                     │                                       └── project
                     │                                            ├── columns: stmt_return_2:7
                     │                                            ├── values
                     │                                            │    └── tuple
                     │                                            └── projections
                     │                                                 └── variable: c:4 [as=stmt_return_2:7]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(a INT, b INT) RETURNS INT AS $$
  DECLARE
    c INT;
  BEGIN
    IF a < b THEN
      c := a;
    ELSE
      c := b;
    END IF;
    RETURN c;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(1, 2);
----
project
 ├── columns: f:13
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:13]
           ├── args
           │    ├── const: 1
           │    └── const: 2
           ├── params: a:1 b:2
           └── body
                └── limit
                     ├── columns: stmt_if_3:12
                     ├── project
                     │    ├── columns: stmt_if_3:12
                     │    ├── project
                     │    │    ├── columns: c:3
                     │    │    ├── values
                     │    │    │    └── tuple
                     │    │    └── projections
                     │    │         └── cast: INT8 [as=c:3]
                     │    │              └── null
                     │    └── projections
                     │         └── case [as=stmt_if_3:12]
                     │              ├── true
                     │              ├── when
                     │              │    ├── lt
                     │              │    │    ├── variable: a:1
                     │              │    │    └── variable: b:2
                     │              │    └── subquery
                     │              │         └── project
                     │              │              ├── columns: stmt_if_1:9
                     │              │              ├── project
                     │              │              │    ├── columns: c:8
                     │              │              │    ├── values
                     │              │              │    │    └── tuple
                     │              │              │    └── projections
                     │              │              │         └── variable: a:1 [as=c:8]
                     │              │              └── projections
                     │              │                   └── udf: stmt_if_1 [as=stmt_if_1:9]
                     │              │                        ├── args
                     │              │                        │    ├── variable: c:8
                     │              │                        │    ├── variable: a:1
                     │              │                        │    └── variable: b:2
                     │              │                        ├── params: c:4 a:5 b:6
                     │              │                        └── body
                     │              │                             └── project
                     │              │                                  ├── columns: stmt_return_2:7
                     │              │                                  ├── values
                     │              │                                  │    └── tuple
                     │              │                                  └── projections
                     │              │                                       └── variable: c:4 [as=stmt_return_2:7]
                     │              └── subquery
                     │                   └── project
                     │                        ├── columns: stmt_if_1:11
                     │                        ├── project
                     │                        │    ├── columns: c:10
                     │                        │    ├── values
                     │                        │    │    └── tuple
                     │                        │    └── projections
                     │                        │         └── variable: b:2 [as=c:10]
                     │                        └── projections
                     │                             └── udf: stmt_if_1 [as=stmt_if_1:11]
                     │                                  ├── args
                     │                                  │    ├── variable: c:10
                     │                                  │    ├── variable: a:1
                     │                                  │    └── variable: b:2
                     │                                  ├── params: c:4 a:5 b:6
                     │                                  └── body
                     │                                       └── project
                     │                                            ├── columns: stmt_return_2:7
                     │                                            ├── values
                     │                                            │    └── tuple
                     │                                            └── projections
                     │                                                 └── variable: c:4 [as=stmt_return_2:7]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(a INT, b INT) RETURNS INT AS $$
  DECLARE
    c INT;
  BEGIN
    IF a < b THEN
      c := a;
    ELSE
      RETURN 100;
    END IF;
    RETURN c;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(1, 2);
----
project
 ├── columns: f:12
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:12]
           ├── args
           │    ├── const: 1
           │    └── const: 2
           ├── params: a:1 b:2
           └── body
                └── limit
                     ├── columns: stmt_if_4:11
                     ├── project
                     │    ├── columns: stmt_if_4:11
                     │    ├── project
                     │    │    ├── columns: c:3
                     │    │    ├── values
                     │    │    │    └── tuple
                     │    │    └── projections
                     │    │         └── cast: INT8 [as=c:3]
                     │    │              └── null
                     │    └── projections
                     │         └── case [as=stmt_if_4:11]
                     │              ├── true
                     │              ├── when
                     │              │    ├── lt
                     │              │    │    ├── variable: a:1
                     │              │    │    └── variable: b:2
                     │              │    └── subquery
                     │              │         └── project
                     │              │              ├── columns: stmt_if_1:9
                     │              │              ├── project
                     │              │              │    ├── columns: c:8
                     │              │              │    ├── values
                     │              │              │    │    └── tuple
                     │              │              │    └── projections
                     │              │              │         └── variable: a:1 [as=c:8]
                     │              │              └── projections
                     │              │                   └── udf: stmt_if_1 [as=stmt_if_1:9]
                     │              │                        ├── args
                     │              │                        │    ├── variable: c:8
                     │              │                        │    ├── variable: a:1
                     │              │                        │    └── variable: b:2
                     │              │                        ├── params: c:4 a:5 b:6
                     │              │                        └── body
                     │              │                             └── project
                     │              │                                  ├── columns: stmt_return_2:7
                     │              │                                  ├── values
                     │              │                                  │    └── tuple
                     │              │                                  └── projections
                     │              │                                       └── variable: c:4 [as=stmt_return_2:7]
                     │              └── subquery
                     │                   └── project
                     │                        ├── columns: stmt_return_3:10!null
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── const: 100 [as=stmt_return_3:10]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(a INT, b INT) RETURNS INT AS $$
  DECLARE
    c INT;
  BEGIN
    IF a < b THEN
      RETURN 100;
    ELSE
      c := b;
    END IF;
    RETURN c;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(1, 2);
----
project
 ├── columns: f:12
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:12]
           ├── args
           │    ├── const: 1
           │    └── const: 2
           ├── params: a:1 b:2
           └── body
                └── limit
                     ├── columns: stmt_if_4:11
                     ├── project
                     │    ├── columns: stmt_if_4:11
                     │    ├── project
                     │    │    ├── columns: c:3
                     │    │    ├── values
                     │    │    │    └── tuple
                     │    │    └── projections
                     │    │         └── cast: INT8 [as=c:3]
                     │    │              └── null
                     │    └── projections
                     │         └── case [as=stmt_if_4:11]
                     │              ├── true
                     │              ├── when
                     │              │    ├── lt
                     │              │    │    ├── variable: a:1
                     │              │    │    └── variable: b:2
                     │              │    └── subquery
                     │              │         └── project
                     │              │              ├── columns: stmt_return_3:8!null
                     │              │              ├── values
                     │              │              │    └── tuple
                     │              │              └── projections
                     │              │                   └── const: 100 [as=stmt_return_3:8]
                     │              └── subquery
                     │                   └── project
                     │                        ├── columns: stmt_if_1:10
                     │                        ├── project
                     │                        │    ├── columns: c:9
                     │                        │    ├── values
                     │                        │    │    └── tuple
                     │                        │    └── projections
                     │                        │         └── variable: b:2 [as=c:9]
                     │                        └── projections
                     │                             └── udf: stmt_if_1 [as=stmt_if_1:10]
                     │                                  ├── args
                     │                                  │    ├── variable: c:9
                     │                                  │    ├── variable: a:1
                     │                                  │    └── variable: b:2
                     │                                  ├── params: c:4 a:5 b:6
                     │                                  └── body
                     │                                       └── project
                     │                                            ├── columns: stmt_return_2:7
                     │                                            ├── values
                     │                                            │    └── tuple
                     │                                            └── projections
                     │                                                 └── variable: c:4 [as=stmt_return_2:7]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(a INT, b INT) RETURNS INT AS $$
  DECLARE
    c INT;
  BEGIN
    IF a < b THEN
      RETURN 100;
    ELSE
      RETURN 0;
    END IF;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(1, 2);
----
project
 ├── columns: f:16
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:16]
           ├── args
           │    ├── const: 1
           │    └── const: 2
           ├── params: a:1 b:2
           └── body
                └── limit
                     ├── columns: stmt_if_7:15
                     ├── project
                     │    ├── columns: stmt_if_7:15
                     │    ├── project
                     │    │    ├── columns: c:3
                     │    │    ├── values
                     │    │    │    └── tuple
                     │    │    └── projections
                     │    │         └── cast: INT8 [as=c:3]
                     │    │              └── null
                     │    └── projections
                     │         └── case [as=stmt_if_7:15]
                     │              ├── true
                     │              ├── when
                     │              │    ├── lt
                     │              │    │    ├── variable: a:1
                     │              │    │    └── variable: b:2
                     │              │    └── subquery
                     │              │         └── project
                     │              │              ├── columns: stmt_return_5:13!null
                     │              │              ├── values
                     │              │              │    └── tuple
                     │              │              └── projections
                     │              │                   └── const: 100 [as=stmt_return_5:13]
                     │              └── subquery
                     │                   └── project
                     │                        ├── columns: stmt_return_6:14!null
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── const: 0 [as=stmt_return_6:14]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(a INT, b INT) RETURNS INT AS $$
  DECLARE
    i INT := a;
  BEGIN
    LOOP
      RETURN 100;
    END LOOP;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(1, 2);
----
project
 ├── columns: f:18
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:18]
           ├── args
           │    ├── const: 1
           │    └── const: 2
           ├── params: a:1 b:2
           └── body
                └── limit
                     ├── columns: stmt_loop_5:17
                     ├── project
                     │    ├── columns: stmt_loop_5:17
                     │    ├── project
                     │    │    ├── columns: i:3
                     │    │    ├── values
                     │    │    │    └── tuple
                     │    │    └── projections
                     │    │         └── variable: a:1 [as=i:3]
                     │    └── projections
                     │         └── udf: stmt_loop_5 [as=stmt_loop_5:17]
                     │              ├── args
                     │              │    ├── variable: i:3
                     │              │    ├── variable: a:1
                     │              │    └── variable: b:2
                     │              ├── params: i:13 a:14 b:15
                     │              └── body
                     │                   └── project
                     │                        ├── columns: stmt_return_6:16!null
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── const: 100 [as=stmt_return_6:16]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(a INT, b INT) RETURNS INT AS $$
  DECLARE
    i INT := a;
  BEGIN
    LOOP
      IF a < b THEN
        RETURN 0;
      END IF;
      RETURN 100;
    END LOOP;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(1, 2);
----
project
 ├── columns: f:24
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:24]
           ├── args
           │    ├── const: 1
           │    └── const: 2
           ├── params: a:1 b:2
           └── body
                └── limit
                     ├── columns: stmt_loop_5:23
                     ├── project
                     │    ├── columns: stmt_loop_5:23
                     │    ├── project
                     │    │    ├── columns: i:3
                     │    │    ├── values
                     │    │    │    └── tuple
                     │    │    └── projections
                     │    │         └── variable: a:1 [as=i:3]
                     │    └── projections
                     │         └── udf: stmt_loop_5 [as=stmt_loop_5:23]
                     │              ├── args
                     │              │    ├── variable: i:3
                     │              │    ├── variable: a:1
                     │              │    └── variable: b:2
                     │              ├── params: i:13 a:14 b:15
                     │              └── body
                     │                   └── project
                     │                        ├── columns: stmt_if_9:22
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── case [as=stmt_if_9:22]
                     │                                  ├── true
                     │                                  ├── when
                     │                                  │    ├── lt
                     │                                  │    │    ├── variable: a:14
                     │                                  │    │    └── variable: b:15
                     │                                  │    └── subquery
                     │                                  │         └── project
                     │                                  │              ├── columns: stmt_return_8:20!null
                     │                                  │              ├── values
                     │                                  │              │    └── tuple
                     │                                  │              └── projections
                     │                                  │                   └── const: 0 [as=stmt_return_8:20]
                     │                                  └── subquery
                     │                                       └── project
                     │                                            ├── columns: stmt_if_6:21
                     │                                            ├── values
                     │                                            │    └── tuple
                     │                                            └── projections
                     │                                                 └── udf: stmt_if_6 [as=stmt_if_6:21]
                     │                                                      ├── args
                     │                                                      │    ├── variable: i:13
                     │                                                      │    ├── variable: a:14
                     │                                                      │    └── variable: b:15
                     │                                                      ├── params: i:16 a:17 b:18
                     │                                                      └── body
                     │                                                           └── project
                     │                                                                ├── columns: stmt_return_7:19!null
                     │                                                                ├── values
                     │                                                                │    └── tuple
                     │                                                                └── projections
                     │                                                                     └── const: 100 [as=stmt_return_7:19]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(a INT, b INT) RETURNS INT AS $$
  DECLARE
    i INT := a;
  BEGIN
    LOOP
      IF i >= b THEN EXIT; END IF;
      IF i = 8 THEN RETURN 100; END IF;
      i := i + 1;
    END LOOP;
    RETURN i;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(1, 2);
----
project
 ├── columns: f:26
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:26]
           ├── args
           │    ├── const: 1
           │    └── const: 2
           ├── params: a:1 b:2
           └── body
                └── limit
                     ├── columns: stmt_loop_3:25
                     ├── project
                     │    ├── columns: stmt_loop_3:25
                     │    ├── project
                     │    │    ├── columns: i:3
                     │    │    ├── values
                     │    │    │    └── tuple
                     │    │    └── projections
                     │    │         └── variable: a:1 [as=i:3]
                     │    └── projections
                     │         └── udf: stmt_loop_3 [as=stmt_loop_3:25]
                     │              ├── args
                     │              │    ├── variable: i:3
                     │              │    ├── variable: a:1
                     │              │    └── variable: b:2
                     │              ├── params: i:8 a:9 b:10
                     │              └── body
                     │                   └── project
                     │                        ├── columns: stmt_if_8:24
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── case [as=stmt_if_8:24]
                     │                                  ├── true
                     │                                  ├── when
                     │                                  │    ├── ge
                     │                                  │    │    ├── variable: i:8
                     │                                  │    │    └── variable: b:10
                     │                                  │    └── subquery
                     │                                  │         └── project
                     │                                  │              ├── columns: loop_exit_1:22
                     │                                  │              ├── values
                     │                                  │              │    └── tuple
                     │                                  │              └── projections
                     │                                  │                   └── udf: loop_exit_1 [as=loop_exit_1:22]
                     │                                  │                        ├── args
                     │                                  │                        │    ├── variable: i:8
                     │                                  │                        │    ├── variable: a:9
                     │                                  │                        │    └── variable: b:10
                     │                                  │                        ├── params: i:4 a:5 b:6
                     │                                  │                        └── body
                     │                                  │                             └── project
                     │                                  │                                  ├── columns: stmt_return_2:7
                     │                                  │                                  ├── values
                     │                                  │                                  │    └── tuple
                     │                                  │                                  └── projections
                     │                                  │                                       └── variable: i:4 [as=stmt_return_2:7]
                     │                                  └── subquery
                     │                                       └── project
                     │                                            ├── columns: stmt_if_4:23
                     │                                            ├── values
                     │                                            │    └── tuple
                     │                                            └── projections
                     │                                                 └── udf: stmt_if_4 [as=stmt_if_4:23]
                     │                                                      ├── args
                     │                                                      │    ├── variable: i:8
                     │                                                      │    ├── variable: a:9
                     │                                                      │    └── variable: b:10
                     │                                                      ├── params: i:11 a:12 b:13
                     │                                                      └── body
                     │                                                           └── project
                     │                                                                ├── columns: stmt_if_7:21
                     │                                                                ├── values
                     │                                                                │    └── tuple
                     │                                                                └── projections
                     │                                                                     └── case [as=stmt_if_7:21]
                     │                                                                          ├── true
                     │                                                                          ├── when
                     │                                                                          │    ├── eq
                     │                                                                          │    │    ├── variable: i:11
                     │                                                                          │    │    └── const: 8
                     │                                                                          │    └── subquery
                     │                                                                          │         └── project
                     │                                                                          │              ├── columns: stmt_return_6:19!null
                     │                                                                          │              ├── values
                     │                                                                          │              │    └── tuple
                     │                                                                          │              └── projections
                     │                                                                          │                   └── const: 100 [as=stmt_return_6:19]
                     │                                                                          └── subquery
                     │                                                                               └── project
                     │                                                                                    ├── columns: stmt_if_5:20
                     │                                                                                    ├── values
                     │                                                                                    │    └── tuple
                     │                                                                                    └── projections
                     │                                                                                         └── udf: stmt_if_5 [as=stmt_if_5:20]
                     │                                                                                              ├── args
                     │                                                                                              │    ├── variable: i:11
                     │                                                                                              │    ├── variable: a:12
                     │                                                                                              │    └── variable: b:13
                     │                                                                                              ├── params: i:14 a:15 b:16
                     │                                                                                              └── body
                     │                                                                                                   └── project
                     │                                                                                                        ├── columns: stmt_loop_3:18
                     │                                                                                                        ├── project
                     │                                                                                                        │    ├── columns: i:17
                     │                                                                                                        │    ├── values
                     │                                                                                                        │    │    └── tuple
                     │                                                                                                        │    └── projections
                     │                                                                                                        │         └── plus [as=i:17]
                     │                                                                                                        │              ├── variable: i:14
                     │                                                                                                        │              └── const: 1
                     │                                                                                                        └── projections
                     │                                                                                                             └── udf: stmt_loop_3 [as=stmt_loop_3:18]
                     │                                                                                                                  ├── args
                     │                                                                                                                  │    ├── variable: i:17
                     │                                                                                                                  │    ├── variable: a:15
                     │                                                                                                                  │    └── variable: b:16
                     │                                                                                                                  └── recursive-call
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(a INT, b INT) RETURNS INT AS $$
  DECLARE
    i INT := a;
  BEGIN
    LOOP
      IF i >= b THEN EXIT; END IF;
      i := i + 1;
    END LOOP;
    RETURN i;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(1, 5);
----
project
 ├── columns: f:20
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:20]
           ├── args
           │    ├── const: 1
           │    └── const: 5
           ├── params: a:1 b:2
           └── body
                └── limit
                     ├── columns: stmt_loop_3:19
                     ├── project
                     │    ├── columns: stmt_loop_3:19
                     │    ├── project
                     │    │    ├── columns: i:3
                     │    │    ├── values
                     │    │    │    └── tuple
                     │    │    └── projections
                     │    │         └── variable: a:1 [as=i:3]
                     │    └── projections
                     │         └── udf: stmt_loop_3 [as=stmt_loop_3:19]
                     │              ├── args
                     │              │    ├── variable: i:3
                     │              │    ├── variable: a:1
                     │              │    └── variable: b:2
                     │              ├── params: i:8 a:9 b:10
                     │              └── body
                     │                   └── project
                     │                        ├── columns: stmt_if_5:18
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── case [as=stmt_if_5:18]
                     │                                  ├── true
                     │                                  ├── when
                     │                                  │    ├── ge
                     │                                  │    │    ├── variable: i:8
                     │                                  │    │    └── variable: b:10
                     │                                  │    └── subquery
                     │                                  │         └── project
                     │                                  │              ├── columns: loop_exit_1:16
                     │                                  │              ├── values
                     │                                  │              │    └── tuple
                     │                                  │              └── projections
                     │                                  │                   └── udf: loop_exit_1 [as=loop_exit_1:16]
                     │                                  │                        ├── args
                     │                                  │                        │    ├── variable: i:8
                     │                                  │                        │    ├── variable: a:9
                     │                                  │                        │    └── variable: b:10
                     │                                  │                        ├── params: i:4 a:5 b:6
                     │                                  │                        └── body
                     │                                  │                             └── project
                     │                                  │                                  ├── columns: stmt_return_2:7
                     │                                  │                                  ├── values
                     │                                  │                                  │    └── tuple
                     │                                  │                                  └── projections
                     │                                  │                                       └── variable: i:4 [as=stmt_return_2:7]
                     │                                  └── subquery
                     │                                       └── project
                     │                                            ├── columns: stmt_if_4:17
                     │                                            ├── values
                     │                                            │    └── tuple
                     │                                            └── projections
                     │                                                 └── udf: stmt_if_4 [as=stmt_if_4:17]
                     │                                                      ├── args
                     │                                                      │    ├── variable: i:8
                     │                                                      │    ├── variable: a:9
                     │                                                      │    └── variable: b:10
                     │                                                      ├── params: i:11 a:12 b:13
                     │                                                      └── body
                     │                                                           └── project
                     │                                                                ├── columns: stmt_loop_3:15
                     │                                                                ├── project
                     │                                                                │    ├── columns: i:14
                     │                                                                │    ├── values
                     │                                                                │    │    └── tuple
                     │                                                                │    └── projections
                     │                                                                │         └── plus [as=i:14]
                     │                                                                │              ├── variable: i:11
                     │                                                                │              └── const: 1
                     │                                                                └── projections
                     │                                                                     └── udf: stmt_loop_3 [as=stmt_loop_3:15]
                     │                                                                          ├── args
                     │                                                                          │    ├── variable: i:14
                     │                                                                          │    ├── variable: a:12
                     │                                                                          │    └── variable: b:13
                     │                                                                          └── recursive-call
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(a INT, b INT) RETURNS INT AS $$
  DECLARE
    sum INT := 0;
    i INT := a;
  BEGIN
    IF a IS NOT NULL AND b is NOT NULL THEN
      LOOP
        IF i >= b THEN EXIT; END IF;
        sum := sum + i;
        i := i + 1;
      END LOOP;
    END IF;
    RETURN sum;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(0, 0);
----
project
 ├── columns: f:32
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:32]
           ├── args
           │    ├── const: 0
           │    └── const: 0
           ├── params: a:1 b:2
           └── body
                └── limit
                     ├── columns: stmt_if_7:31
                     ├── project
                     │    ├── columns: stmt_if_7:31
                     │    ├── project
                     │    │    ├── columns: i:4 sum:3!null
                     │    │    ├── project
                     │    │    │    ├── columns: sum:3!null
                     │    │    │    ├── values
                     │    │    │    │    └── tuple
                     │    │    │    └── projections
                     │    │    │         └── const: 0 [as=sum:3]
                     │    │    └── projections
                     │    │         └── variable: a:1 [as=i:4]
                     │    └── projections
                     │         └── case [as=stmt_if_7:31]
                     │              ├── true
                     │              ├── when
                     │              │    ├── and
                     │              │    │    ├── is-not
                     │              │    │    │    ├── variable: a:1
                     │              │    │    │    └── null
                     │              │    │    └── is-not
                     │              │    │         ├── variable: b:2
                     │              │    │         └── null
                     │              │    └── subquery
                     │              │         └── project
                     │              │              ├── columns: stmt_loop_4:29
                     │              │              ├── values
                     │              │              │    └── tuple
                     │              │              └── projections
                     │              │                   └── udf: stmt_loop_4 [as=stmt_loop_4:29]
                     │              │                        ├── args
                     │              │                        │    ├── variable: sum:3
                     │              │                        │    ├── variable: i:4
                     │              │                        │    ├── variable: a:1
                     │              │                        │    └── variable: b:2
                     │              │                        ├── params: sum:15 i:16 a:17 b:18
                     │              │                        └── body
                     │              │                             └── project
                     │              │                                  ├── columns: stmt_if_6:28
                     │              │                                  ├── values
                     │              │                                  │    └── tuple
                     │              │                                  └── projections
                     │              │                                       └── case [as=stmt_if_6:28]
                     │              │                                            ├── true
                     │              │                                            ├── when
                     │              │                                            │    ├── ge
                     │              │                                            │    │    ├── variable: i:16
                     │              │                                            │    │    └── variable: b:18
                     │              │                                            │    └── subquery
                     │              │                                            │         └── project
                     │              │                                            │              ├── columns: loop_exit_3:26
                     │              │                                            │              ├── values
                     │              │                                            │              │    └── tuple
                     │              │                                            │              └── projections
                     │              │                                            │                   └── udf: loop_exit_3 [as=loop_exit_3:26]
                     │              │                                            │                        ├── args
                     │              │                                            │                        │    ├── variable: sum:15
                     │              │                                            │                        │    ├── variable: i:16
                     │              │                                            │                        │    ├── variable: a:17
                     │              │                                            │                        │    └── variable: b:18
                     │              │                                            │                        ├── params: sum:10 i:11 a:12 b:13
                     │              │                                            │                        └── body
                     │              │                                            │                             └── project
                     │              │                                            │                                  ├── columns: stmt_if_1:14
                     │              │                                            │                                  ├── values
                     │              │                                            │                                  │    └── tuple
                     │              │                                            │                                  └── projections
                     │              │                                            │                                       └── udf: stmt_if_1 [as=stmt_if_1:14]
                     │              │                                            │                                            ├── args
                     │              │                                            │                                            │    ├── variable: sum:10
                     │              │                                            │                                            │    ├── variable: i:11
                     │              │                                            │                                            │    ├── variable: a:12
                     │              │                                            │                                            │    └── variable: b:13
                     │              │                                            │                                            ├── params: sum:5 i:6 a:7 b:8
                     │              │                                            │                                            └── body
                     │              │                                            │                                                 └── project
                     │              │                                            │                                                      ├── columns: stmt_return_2:9
                     │              │                                            │                                                      ├── values
                     │              │                                            │                                                      │    └── tuple
                     │              │                                            │                                                      └── projections
                     │              │                                            │                                                           └── variable: sum:5 [as=stmt_return_2:9]
                     │              │                                            └── subquery
                     │              │                                                 └── project
                     │              │                                                      ├── columns: stmt_if_5:27
                     │              │                                                      ├── values
                     │              │                                                      │    └── tuple
                     │              │                                                      └── projections
                     │              │                                                           └── udf: stmt_if_5 [as=stmt_if_5:27]
                     │              │                                                                ├── args
                     │              │                                                                │    ├── variable: sum:15
                     │              │                                                                │    ├── variable: i:16
                     │              │                                                                │    ├── variable: a:17
                     │              │                                                                │    └── variable: b:18
                     │              │                                                                ├── params: sum:19 i:20 a:21 b:22
                     │              │                                                                └── body
                     │              │                                                                     └── project
                     │              │                                                                          ├── columns: stmt_loop_4:25
                     │              │                                                                          ├── project
                     │              │                                                                          │    ├── columns: i:24 sum:23
                     │              │                                                                          │    ├── project
                     │              │                                                                          │    │    ├── columns: sum:23
                     │              │                                                                          │    │    ├── values
                     │              │                                                                          │    │    │    └── tuple
                     │              │                                                                          │    │    └── projections
                     │              │                                                                          │    │         └── plus [as=sum:23]
                     │              │                                                                          │    │              ├── variable: sum:19
                     │              │                                                                          │    │              └── variable: i:20
                     │              │                                                                          │    └── projections
                     │              │                                                                          │         └── plus [as=i:24]
                     │              │                                                                          │              ├── variable: i:20
                     │              │                                                                          │              └── const: 1
                     │              │                                                                          └── projections
                     │              │                                                                               └── udf: stmt_loop_4 [as=stmt_loop_4:25]
                     │              │                                                                                    ├── args
                     │              │                                                                                    │    ├── variable: sum:23
                     │              │                                                                                    │    ├── variable: i:24
                     │              │                                                                                    │    ├── variable: a:21
                     │              │                                                                                    │    └── variable: b:22
                     │              │                                                                                    └── recursive-call
                     │              └── subquery
                     │                   └── project
                     │                        ├── columns: stmt_if_1:30
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── udf: stmt_if_1 [as=stmt_if_1:30]
                     │                                  ├── args
                     │                                  │    ├── variable: sum:3
                     │                                  │    ├── variable: i:4
                     │                                  │    ├── variable: a:1
                     │                                  │    └── variable: b:2
                     │                                  ├── params: sum:5 i:6 a:7 b:8
                     │                                  └── body
                     │                                       └── project
                     │                                            ├── columns: stmt_return_2:9
                     │                                            ├── values
                     │                                            │    └── tuple
                     │                                            └── projections
                     │                                                 └── variable: sum:5 [as=stmt_return_2:9]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(a INT, b INT) RETURNS INT AS $$
  DECLARE
    sum INT := 0;
    i INT := a;
  BEGIN
    LOOP
      IF i >= b THEN EXIT; END IF;
      IF i = 2 THEN
        i := i + 1;
        CONTINUE;
      END IF;
      sum := sum + i;
      i := i + 1;
    END LOOP;
    RETURN sum;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(5, -5);
----
project
 ├── columns: f:33
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:33]
           ├── args
           │    ├── const: 5
           │    └── const: -5
           ├── params: a:1 b:2
           └── body
                └── limit
                     ├── columns: stmt_loop_3:32
                     ├── project
                     │    ├── columns: stmt_loop_3:32
                     │    ├── project
                     │    │    ├── columns: i:4 sum:3!null
                     │    │    ├── project
                     │    │    │    ├── columns: sum:3!null
                     │    │    │    ├── values
                     │    │    │    │    └── tuple
                     │    │    │    └── projections
                     │    │    │         └── const: 0 [as=sum:3]
                     │    │    └── projections
                     │    │         └── variable: a:1 [as=i:4]
                     │    └── projections
                     │         └── udf: stmt_loop_3 [as=stmt_loop_3:32]
                     │              ├── args
                     │              │    ├── variable: sum:3
                     │              │    ├── variable: i:4
                     │              │    ├── variable: a:1
                     │              │    └── variable: b:2
                     │              ├── params: sum:10 i:11 a:12 b:13
                     │              └── body
                     │                   └── project
                     │                        ├── columns: stmt_if_7:31
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── case [as=stmt_if_7:31]
                     │                                  ├── true
                     │                                  ├── when
                     │                                  │    ├── ge
                     │                                  │    │    ├── variable: i:11
                     │                                  │    │    └── variable: b:13
                     │                                  │    └── subquery
                     │                                  │         └── project
                     │                                  │              ├── columns: loop_exit_1:29
                     │                                  │              ├── values
                     │                                  │              │    └── tuple
                     │                                  │              └── projections
                     │                                  │                   └── udf: loop_exit_1 [as=loop_exit_1:29]
                     │                                  │                        ├── args
                     │                                  │                        │    ├── variable: sum:10
                     │                                  │                        │    ├── variable: i:11
                     │                                  │                        │    ├── variable: a:12
                     │                                  │                        │    └── variable: b:13
                     │                                  │                        ├── params: sum:5 i:6 a:7 b:8
                     │                                  │                        └── body
                     │                                  │                             └── project
                     │                                  │                                  ├── columns: stmt_return_2:9
                     │                                  │                                  ├── values
                     │                                  │                                  │    └── tuple
                     │                                  │                                  └── projections
                     │                                  │                                       └── variable: sum:5 [as=stmt_return_2:9]
                     │                                  └── subquery
                     │                                       └── project
                     │                                            ├── columns: stmt_if_4:30
                     │                                            ├── values
                     │                                            │    └── tuple
                     │                                            └── projections
                     │                                                 └── udf: stmt_if_4 [as=stmt_if_4:30]
                     │                                                      ├── args
                     │                                                      │    ├── variable: sum:10
                     │                                                      │    ├── variable: i:11
                     │                                                      │    ├── variable: a:12
                     │                                                      │    └── variable: b:13
                     │                                                      ├── params: sum:14 i:15 a:16 b:17
                     │                                                      └── body
                     │                                                           └── project
                     │                                                                ├── columns: stmt_if_6:28
                     │                                                                ├── values
                     │                                                                │    └── tuple
                     │                                                                └── projections
                     │                                                                     └── case [as=stmt_if_6:28]
                     │                                                                          ├── true
                     │                                                                          ├── when
                     │                                                                          │    ├── eq
                     │                                                                          │    │    ├── variable: i:15
                     │                                                                          │    │    └── const: 2
                     │                                                                          │    └── subquery
                     │                                                                          │         └── project
                     │                                                                          │              ├── columns: stmt_loop_3:26
                     │                                                                          │              ├── project
                     │                                                                          │              │    ├── columns: i:25
                     │                                                                          │              │    ├── values
                     │                                                                          │              │    │    └── tuple
                     │                                                                          │              │    └── projections
                     │                                                                          │              │         └── plus [as=i:25]
                     │                                                                          │              │              ├── variable: i:15
                     │                                                                          │              │              └── const: 1
                     │                                                                          │              └── projections
                     │                                                                          │                   └── udf: stmt_loop_3 [as=stmt_loop_3:26]
                     │                                                                          │                        ├── args
                     │                                                                          │                        │    ├── variable: sum:14
                     │                                                                          │                        │    ├── variable: i:25
                     │                                                                          │                        │    ├── variable: a:16
                     │                                                                          │                        │    └── variable: b:17
                     │                                                                          │                        └── recursive-call
                     │                                                                          └── subquery
                     │                                                                               └── project
                     │                                                                                    ├── columns: stmt_if_5:27
                     │                                                                                    ├── values
                     │                                                                                    │    └── tuple
                     │                                                                                    └── projections
                     │                                                                                         └── udf: stmt_if_5 [as=stmt_if_5:27]
                     │                                                                                              ├── args
                     │                                                                                              │    ├── variable: sum:14
                     │                                                                                              │    ├── variable: i:15
                     │                                                                                              │    ├── variable: a:16
                     │                                                                                              │    └── variable: b:17
                     │                                                                                              ├── params: sum:18 i:19 a:20 b:21
                     │                                                                                              └── body
                     │                                                                                                   └── project
                     │                                                                                                        ├── columns: stmt_loop_3:24
                     │                                                                                                        ├── project
                     │                                                                                                        │    ├── columns: i:23 sum:22
                     │                                                                                                        │    ├── project
                     │                                                                                                        │    │    ├── columns: sum:22
                     │                                                                                                        │    │    ├── values
                     │                                                                                                        │    │    │    └── tuple
                     │                                                                                                        │    │    └── projections
                     │                                                                                                        │    │         └── plus [as=sum:22]
                     │                                                                                                        │    │              ├── variable: sum:18
                     │                                                                                                        │    │              └── variable: i:19
                     │                                                                                                        │    └── projections
                     │                                                                                                        │         └── plus [as=i:23]
                     │                                                                                                        │              ├── variable: i:19
                     │                                                                                                        │              └── const: 1
                     │                                                                                                        └── projections
                     │                                                                                                             └── udf: stmt_loop_3 [as=stmt_loop_3:24]
                     │                                                                                                                  ├── args
                     │                                                                                                                  │    ├── variable: sum:22
                     │                                                                                                                  │    ├── variable: i:23
                     │                                                                                                                  │    ├── variable: a:20
                     │                                                                                                                  │    └── variable: b:21
                     │                                                                                                                  └── recursive-call
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(a INT, b INT) RETURNS INT AS $$
  DECLARE
    sum INT := 0;
    i INT := a;
    j INT;
  BEGIN
    LOOP
      IF i >= b THEN EXIT; END IF;
      j := 0;
      LOOP
        IF j >= i THEN EXIT; END IF;
        sum := sum + j;
        j := j + 1;
      END LOOP;
      i := i + 1;
    END LOOP;
    RETURN sum;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(1, 5)
----
project
 ├── columns: f:51
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:51]
           ├── args
           │    ├── const: 1
           │    └── const: 5
           ├── params: a:1 b:2
           └── body
                └── limit
                     ├── columns: stmt_loop_3:50
                     ├── project
                     │    ├── columns: stmt_loop_3:50
                     │    ├── project
                     │    │    ├── columns: j:5 sum:3!null i:4
                     │    │    ├── project
                     │    │    │    ├── columns: i:4 sum:3!null
                     │    │    │    ├── project
                     │    │    │    │    ├── columns: sum:3!null
                     │    │    │    │    ├── values
                     │    │    │    │    │    └── tuple
                     │    │    │    │    └── projections
                     │    │    │    │         └── const: 0 [as=sum:3]
                     │    │    │    └── projections
                     │    │    │         └── variable: a:1 [as=i:4]
                     │    │    └── projections
                     │    │         └── cast: INT8 [as=j:5]
                     │    │              └── null
                     │    └── projections
                     │         └── udf: stmt_loop_3 [as=stmt_loop_3:50]
                     │              ├── args
                     │              │    ├── variable: sum:3
                     │              │    ├── variable: i:4
                     │              │    ├── variable: j:5
                     │              │    ├── variable: a:1
                     │              │    └── variable: b:2
                     │              ├── params: sum:12 i:13 j:14 a:15 b:16
                     │              └── body
                     │                   └── project
                     │                        ├── columns: stmt_if_9:49
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── case [as=stmt_if_9:49]
                     │                                  ├── true
                     │                                  ├── when
                     │                                  │    ├── ge
                     │                                  │    │    ├── variable: i:13
                     │                                  │    │    └── variable: b:16
                     │                                  │    └── subquery
                     │                                  │         └── project
                     │                                  │              ├── columns: loop_exit_1:47
                     │                                  │              ├── values
                     │                                  │              │    └── tuple
                     │                                  │              └── projections
                     │                                  │                   └── udf: loop_exit_1 [as=loop_exit_1:47]
                     │                                  │                        ├── args
                     │                                  │                        │    ├── variable: sum:12
                     │                                  │                        │    ├── variable: i:13
                     │                                  │                        │    ├── variable: j:14
                     │                                  │                        │    ├── variable: a:15
                     │                                  │                        │    └── variable: b:16
                     │                                  │                        ├── params: sum:6 i:7 j:8 a:9 b:10
                     │                                  │                        └── body
                     │                                  │                             └── project
                     │                                  │                                  ├── columns: stmt_return_2:11
                     │                                  │                                  ├── values
                     │                                  │                                  │    └── tuple
                     │                                  │                                  └── projections
                     │                                  │                                       └── variable: sum:6 [as=stmt_return_2:11]
                     │                                  └── subquery
                     │                                       └── project
                     │                                            ├── columns: stmt_if_4:48
                     │                                            ├── values
                     │                                            │    └── tuple
                     │                                            └── projections
                     │                                                 └── udf: stmt_if_4 [as=stmt_if_4:48]
                     │                                                      ├── args
                     │                                                      │    ├── variable: sum:12
                     │                                                      │    ├── variable: i:13
                     │                                                      │    ├── variable: j:14
                     │                                                      │    ├── variable: a:15
                     │                                                      │    └── variable: b:16
                     │                                                      ├── params: sum:17 i:18 j:19 a:20 b:21
                     │                                                      └── body
                     │                                                           └── project
                     │                                                                ├── columns: stmt_loop_6:46
                     │                                                                ├── project
                     │                                                                │    ├── columns: j:22!null
                     │                                                                │    ├── values
                     │                                                                │    │    └── tuple
                     │                                                                │    └── projections
                     │                                                                │         └── const: 0 [as=j:22]
                     │                                                                └── projections
                     │                                                                     └── udf: stmt_loop_6 [as=stmt_loop_6:46]
                     │                                                                          ├── args
                     │                                                                          │    ├── variable: sum:17
                     │                                                                          │    ├── variable: i:18
                     │                                                                          │    ├── variable: j:22
                     │                                                                          │    ├── variable: a:20
                     │                                                                          │    └── variable: b:21
                     │                                                                          ├── params: sum:30 i:31 j:32 a:33 b:34
                     │                                                                          └── body
                     │                                                                               └── project
                     │                                                                                    ├── columns: stmt_if_8:45
                     │                                                                                    ├── values
                     │                                                                                    │    └── tuple
                     │                                                                                    └── projections
                     │                                                                                         └── case [as=stmt_if_8:45]
                     │                                                                                              ├── true
                     │                                                                                              ├── when
                     │                                                                                              │    ├── ge
                     │                                                                                              │    │    ├── variable: j:32
                     │                                                                                              │    │    └── variable: i:31
                     │                                                                                              │    └── subquery
                     │                                                                                              │         └── project
                     │                                                                                              │              ├── columns: loop_exit_5:43
                     │                                                                                              │              ├── values
                     │                                                                                              │              │    └── tuple
                     │                                                                                              │              └── projections
                     │                                                                                              │                   └── udf: loop_exit_5 [as=loop_exit_5:43]
                     │                                                                                              │                        ├── args
                     │                                                                                              │                        │    ├── variable: sum:30
                     │                                                                                              │                        │    ├── variable: i:31
                     │                                                                                              │                        │    ├── variable: j:32
                     │                                                                                              │                        │    ├── variable: a:33
                     │                                                                                              │                        │    └── variable: b:34
                     │                                                                                              │                        ├── params: sum:23 i:24 j:25 a:26 b:27
                     │                                                                                              │                        └── body
                     │                                                                                              │                             └── project
                     │                                                                                              │                                  ├── columns: stmt_loop_3:29
                     │                                                                                              │                                  ├── project
                     │                                                                                              │                                  │    ├── columns: i:28
                     │                                                                                              │                                  │    ├── values
                     │                                                                                              │                                  │    │    └── tuple
                     │                                                                                              │                                  │    └── projections
                     │                                                                                              │                                  │         └── plus [as=i:28]
                     │                                                                                              │                                  │              ├── variable: i:24
                     │                                                                                              │                                  │              └── const: 1
                     │                                                                                              │                                  └── projections
                     │                                                                                              │                                       └── udf: stmt_loop_3 [as=stmt_loop_3:29]
                     │                                                                                              │                                            ├── args
                     │                                                                                              │                                            │    ├── variable: sum:23
                     │                                                                                              │                                            │    ├── variable: i:28
                     │                                                                                              │                                            │    ├── variable: j:25
                     │                                                                                              │                                            │    ├── variable: a:26
                     │                                                                                              │                                            │    └── variable: b:27
                     │                                                                                              │                                            └── recursive-call
                     │                                                                                              └── subquery
                     │                                                                                                   └── project
                     │                                                                                                        ├── columns: stmt_if_7:44
                     │                                                                                                        ├── values
                     │                                                                                                        │    └── tuple
                     │                                                                                                        └── projections
                     │                                                                                                             └── udf: stmt_if_7 [as=stmt_if_7:44]
                     │                                                                                                                  ├── args
                     │                                                                                                                  │    ├── variable: sum:30
                     │                                                                                                                  │    ├── variable: i:31
                     │                                                                                                                  │    ├── variable: j:32
                     │                                                                                                                  │    ├── variable: a:33
                     │                                                                                                                  │    └── variable: b:34
                     │                                                                                                                  ├── params: sum:35 i:36 j:37 a:38 b:39
                     │                                                                                                                  └── body
                     │                                                                                                                       └── project
                     │                                                                                                                            ├── columns: stmt_loop_6:42
                     │                                                                                                                            ├── project
                     │                                                                                                                            │    ├── columns: j:41 sum:40
                     │                                                                                                                            │    ├── project
                     │                                                                                                                            │    │    ├── columns: sum:40
                     │                                                                                                                            │    │    ├── values
                     │                                                                                                                            │    │    │    └── tuple
                     │                                                                                                                            │    │    └── projections
                     │                                                                                                                            │    │         └── plus [as=sum:40]
                     │                                                                                                                            │    │              ├── variable: sum:35
                     │                                                                                                                            │    │              └── variable: j:37
                     │                                                                                                                            │    └── projections
                     │                                                                                                                            │         └── plus [as=j:41]
                     │                                                                                                                            │              ├── variable: j:37
                     │                                                                                                                            │              └── const: 1
                     │                                                                                                                            └── projections
                     │                                                                                                                                 └── udf: stmt_loop_6 [as=stmt_loop_6:42]
                     │                                                                                                                                      ├── args
                     │                                                                                                                                      │    ├── variable: sum:40
                     │                                                                                                                                      │    ├── variable: i:36
                     │                                                                                                                                      │    ├── variable: j:41
                     │                                                                                                                                      │    ├── variable: a:38
                     │                                                                                                                                      │    └── variable: b:39
                     │                                                                                                                                      └── recursive-call
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(n INT) RETURNS INT AS $$
  DECLARE
    sum INT := 0;
    i INT := 0;
  BEGIN
    WHILE i < n LOOP
      sum := sum + i;
      i := i + 1;
    END LOOP;
    RETURN sum;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(5)
----
project
 ├── columns: f:21
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:21]
           ├── args
           │    └── const: 5
           ├── params: n:1
           └── body
                └── limit
                     ├── columns: stmt_loop_3:20
                     ├── project
                     │    ├── columns: stmt_loop_3:20
                     │    ├── project
                     │    │    ├── columns: i:3!null sum:2!null
                     │    │    ├── project
                     │    │    │    ├── columns: sum:2!null
                     │    │    │    ├── values
                     │    │    │    │    └── tuple
                     │    │    │    └── projections
                     │    │    │         └── const: 0 [as=sum:2]
                     │    │    └── projections
                     │    │         └── const: 0 [as=i:3]
                     │    └── projections
                     │         └── udf: stmt_loop_3 [as=stmt_loop_3:20]
                     │              ├── args
                     │              │    ├── variable: sum:2
                     │              │    ├── variable: i:3
                     │              │    └── variable: n:1
                     │              ├── params: sum:8 i:9 n:10
                     │              └── body
                     │                   └── project
                     │                        ├── columns: stmt_if_5:19
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── case [as=stmt_if_5:19]
                     │                                  ├── true
                     │                                  ├── when
                     │                                  │    ├── lt
                     │                                  │    │    ├── variable: i:9
                     │                                  │    │    └── variable: n:10
                     │                                  │    └── subquery
                     │                                  │         └── project
                     │                                  │              ├── columns: stmt_if_4:17
                     │                                  │              ├── project
                     │                                  │              │    ├── columns: i:16 sum:15
                     │                                  │              │    ├── project
                     │                                  │              │    │    ├── columns: sum:15
                     │                                  │              │    │    ├── values
                     │                                  │              │    │    │    └── tuple
                     │                                  │              │    │    └── projections
                     │                                  │              │    │         └── plus [as=sum:15]
                     │                                  │              │    │              ├── variable: sum:8
                     │                                  │              │    │              └── variable: i:9
                     │                                  │              │    └── projections
                     │                                  │              │         └── plus [as=i:16]
                     │                                  │              │              ├── variable: i:9
                     │                                  │              │              └── const: 1
                     │                                  │              └── projections
                     │                                  │                   └── udf: stmt_if_4 [as=stmt_if_4:17]
                     │                                  │                        ├── args
                     │                                  │                        │    ├── variable: sum:15
                     │                                  │                        │    ├── variable: i:16
                     │                                  │                        │    └── variable: n:10
                     │                                  │                        ├── params: sum:11 i:12 n:13
                     │                                  │                        └── body
                     │                                  │                             └── project
                     │                                  │                                  ├── columns: stmt_loop_3:14
                     │                                  │                                  ├── values
                     │                                  │                                  │    └── tuple
                     │                                  │                                  └── projections
                     │                                  │                                       └── udf: stmt_loop_3 [as=stmt_loop_3:14]
                     │                                  │                                            ├── args
                     │                                  │                                            │    ├── variable: sum:11
                     │                                  │                                            │    ├── variable: i:12
                     │                                  │                                            │    └── variable: n:13
                     │                                  │                                            └── recursive-call
                     │                                  └── subquery
                     │                                       └── project
                     │                                            ├── columns: loop_exit_1:18
                     │                                            ├── values
                     │                                            │    └── tuple
                     │                                            └── projections
                     │                                                 └── udf: loop_exit_1 [as=loop_exit_1:18]
                     │                                                      ├── args
                     │                                                      │    ├── variable: sum:8
                     │                                                      │    ├── variable: i:9
                     │                                                      │    └── variable: n:10
                     │                                                      ├── params: sum:4 i:5 n:6
                     │                                                      └── body
                     │                                                           └── project
                     │                                                                ├── columns: stmt_return_2:7
                     │                                                                ├── values
                     │                                                                │    └── tuple
                     │                                                                └── projections
                     │                                                                     └── variable: sum:4 [as=stmt_return_2:7]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(n INT) RETURNS INT AS $$
  DECLARE
    sum INT := 0;
    i INT := 0;
  BEGIN
    LOOP
      EXIT WHEN i > n;
      sum := sum + i;
      i := i + 1;
    END LOOP;
    RETURN sum;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(5)
----
error (0A000): unimplemented: conditional EXIT statements are not yet supported

exec-ddl
CREATE OR REPLACE FUNCTION f(n INT) RETURNS INT AS $$
  DECLARE
    sum INT := 0;
    i INT := 0;
  BEGIN
    LOOP
      CONTINUE WHEN i % 2 = 0;
      sum := sum + i;
      i := i + 1;
    END LOOP;
    RETURN sum;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(5)
----
error (0A000): unimplemented: conditional CONTINUE statements are not yet supported

# TODO(drewk): consider adding a norm rules to fold nested UDFs.
# Testing RAISE statements.
exec-ddl
CREATE OR REPLACE FUNCTION f() RETURNS INT AS $$
  BEGIN
    RAISE DEBUG 'foo';
    RAISE LOG 'foo';
    RAISE INFO 'foo';
    RAISE NOTICE 'foo';
    RAISE WARNING 'foo';
    return 0;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f();
----
project
 ├── columns: f:12
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:12]
           └── body
                └── limit
                     ├── columns: "_stmt_raise_1":11
                     ├── project
                     │    ├── columns: "_stmt_raise_1":11
                     │    ├── values
                     │    │    └── tuple
                     │    └── projections
                     │         └── udf: _stmt_raise_1 [as="_stmt_raise_1":11]
                     │              └── body
                     │                   ├── project
                     │                   │    ├── columns: stmt_raise_2:1
                     │                   │    ├── values
                     │                   │    │    └── tuple
                     │                   │    └── projections
                     │                   │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_2:1]
                     │                   │              ├── const: 'DEBUG1'
                     │                   │              ├── const: 'foo'
                     │                   │              ├── const: ''
                     │                   │              ├── const: ''
                     │                   │              └── const: '00000'
                     │                   └── project
                     │                        ├── columns: "_stmt_raise_3":10
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── udf: _stmt_raise_3 [as="_stmt_raise_3":10]
                     │                                  └── body
                     │                                       ├── project
                     │                                       │    ├── columns: stmt_raise_4:2
                     │                                       │    ├── values
                     │                                       │    │    └── tuple
                     │                                       │    └── projections
                     │                                       │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_4:2]
                     │                                       │              ├── const: 'LOG'
                     │                                       │              ├── const: 'foo'
                     │                                       │              ├── const: ''
                     │                                       │              ├── const: ''
                     │                                       │              └── const: '00000'
                     │                                       └── project
                     │                                            ├── columns: "_stmt_raise_5":9
                     │                                            ├── values
                     │                                            │    └── tuple
                     │                                            └── projections
                     │                                                 └── udf: _stmt_raise_5 [as="_stmt_raise_5":9]
                     │                                                      └── body
                     │                                                           ├── project
                     │                                                           │    ├── columns: stmt_raise_6:3
                     │                                                           │    ├── values
                     │                                                           │    │    └── tuple
                     │                                                           │    └── projections
                     │                                                           │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_6:3]
                     │                                                           │              ├── const: 'INFO'
                     │                                                           │              ├── const: 'foo'
                     │                                                           │              ├── const: ''
                     │                                                           │              ├── const: ''
                     │                                                           │              └── const: '00000'
                     │                                                           └── project
                     │                                                                ├── columns: "_stmt_raise_7":8
                     │                                                                ├── values
                     │                                                                │    └── tuple
                     │                                                                └── projections
                     │                                                                     └── udf: _stmt_raise_7 [as="_stmt_raise_7":8]
                     │                                                                          └── body
                     │                                                                               ├── project
                     │                                                                               │    ├── columns: stmt_raise_8:4
                     │                                                                               │    ├── values
                     │                                                                               │    │    └── tuple
                     │                                                                               │    └── projections
                     │                                                                               │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_8:4]
                     │                                                                               │              ├── const: 'NOTICE'
                     │                                                                               │              ├── const: 'foo'
                     │                                                                               │              ├── const: ''
                     │                                                                               │              ├── const: ''
                     │                                                                               │              └── const: '00000'
                     │                                                                               └── project
                     │                                                                                    ├── columns: "_stmt_raise_9":7
                     │                                                                                    ├── values
                     │                                                                                    │    └── tuple
                     │                                                                                    └── projections
                     │                                                                                         └── udf: _stmt_raise_9 [as="_stmt_raise_9":7]
                     │                                                                                              └── body
                     │                                                                                                   ├── project
                     │                                                                                                   │    ├── columns: stmt_raise_10:5
                     │                                                                                                   │    ├── values
                     │                                                                                                   │    │    └── tuple
                     │                                                                                                   │    └── projections
                     │                                                                                                   │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_10:5]
                     │                                                                                                   │              ├── const: 'WARNING'
                     │                                                                                                   │              ├── const: 'foo'
                     │                                                                                                   │              ├── const: ''
                     │                                                                                                   │              ├── const: ''
                     │                                                                                                   │              └── const: '00000'
                     │                                                                                                   └── project
                     │                                                                                                        ├── columns: stmt_return_11:6!null
                     │                                                                                                        ├── values
                     │                                                                                                        │    └── tuple
                     │                                                                                                        └── projections
                     │                                                                                                             └── const: 0 [as=stmt_return_11:6]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f() RETURNS INT AS $$
  BEGIN
    RAISE NOTICE '%', 1;
    RAISE NOTICE 'foo: %, %, %', 1, 2, 3;
    RAISE NOTICE '%%';
    RAISE NOTICE '%%%', 1;
    RAISE NOTICE '%%%foo%% bar%%%% %% %%%% ba%z%', 1, 2, 3;
    RETURN 0;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f();
----
project
 ├── columns: f:12
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:12]
           └── body
                └── limit
                     ├── columns: "_stmt_raise_1":11
                     ├── project
                     │    ├── columns: "_stmt_raise_1":11
                     │    ├── values
                     │    │    └── tuple
                     │    └── projections
                     │         └── udf: _stmt_raise_1 [as="_stmt_raise_1":11]
                     │              └── body
                     │                   ├── project
                     │                   │    ├── columns: stmt_raise_2:1
                     │                   │    ├── values
                     │                   │    │    └── tuple
                     │                   │    └── projections
                     │                   │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_2:1]
                     │                   │              ├── const: 'NOTICE'
                     │                   │              ├── concat
                     │                   │              │    ├── concat
                     │                   │              │    │    ├── const: ''
                     │                   │              │    │    └── coalesce
                     │                   │              │    │         ├── const: 1
                     │                   │              │    │         └── const: '<NULL>'
                     │                   │              │    └── const: ''
                     │                   │              ├── const: ''
                     │                   │              ├── const: ''
                     │                   │              └── const: '00000'
                     │                   └── project
                     │                        ├── columns: "_stmt_raise_3":10
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── udf: _stmt_raise_3 [as="_stmt_raise_3":10]
                     │                                  └── body
                     │                                       ├── project
                     │                                       │    ├── columns: stmt_raise_4:2
                     │                                       │    ├── values
                     │                                       │    │    └── tuple
                     │                                       │    └── projections
                     │                                       │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_4:2]
                     │                                       │              ├── const: 'NOTICE'
                     │                                       │              ├── concat
                     │                                       │              │    ├── concat
                     │                                       │              │    │    ├── concat
                     │                                       │              │    │    │    ├── concat
                     │                                       │              │    │    │    │    ├── concat
                     │                                       │              │    │    │    │    │    ├── concat
                     │                                       │              │    │    │    │    │    │    ├── const: 'foo: '
                     │                                       │              │    │    │    │    │    │    └── coalesce
                     │                                       │              │    │    │    │    │    │         ├── const: 1
                     │                                       │              │    │    │    │    │    │         └── const: '<NULL>'
                     │                                       │              │    │    │    │    │    └── const: ', '
                     │                                       │              │    │    │    │    └── coalesce
                     │                                       │              │    │    │    │         ├── const: 2
                     │                                       │              │    │    │    │         └── const: '<NULL>'
                     │                                       │              │    │    │    └── const: ', '
                     │                                       │              │    │    └── coalesce
                     │                                       │              │    │         ├── const: 3
                     │                                       │              │    │         └── const: '<NULL>'
                     │                                       │              │    └── const: ''
                     │                                       │              ├── const: ''
                     │                                       │              ├── const: ''
                     │                                       │              └── const: '00000'
                     │                                       └── project
                     │                                            ├── columns: "_stmt_raise_5":9
                     │                                            ├── values
                     │                                            │    └── tuple
                     │                                            └── projections
                     │                                                 └── udf: _stmt_raise_5 [as="_stmt_raise_5":9]
                     │                                                      └── body
                     │                                                           ├── project
                     │                                                           │    ├── columns: stmt_raise_6:3
                     │                                                           │    ├── values
                     │                                                           │    │    └── tuple
                     │                                                           │    └── projections
                     │                                                           │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_6:3]
                     │                                                           │              ├── const: 'NOTICE'
                     │                                                           │              ├── concat
                     │                                                           │              │    ├── concat
                     │                                                           │              │    │    ├── const: ''
                     │                                                           │              │    │    └── const: '%'
                     │                                                           │              │    └── const: ''
                     │                                                           │              ├── const: ''
                     │                                                           │              ├── const: ''
                     │                                                           │              └── const: '00000'
                     │                                                           └── project
                     │                                                                ├── columns: "_stmt_raise_7":8
                     │                                                                ├── values
                     │                                                                │    └── tuple
                     │                                                                └── projections
                     │                                                                     └── udf: _stmt_raise_7 [as="_stmt_raise_7":8]
                     │                                                                          └── body
                     │                                                                               ├── project
                     │                                                                               │    ├── columns: stmt_raise_8:4
                     │                                                                               │    ├── values
                     │                                                                               │    │    └── tuple
                     │                                                                               │    └── projections
                     │                                                                               │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_8:4]
                     │                                                                               │              ├── const: 'NOTICE'
                     │                                                                               │              ├── concat
                     │                                                                               │              │    ├── concat
                     │                                                                               │              │    │    ├── concat
                     │                                                                               │              │    │    │    ├── concat
                     │                                                                               │              │    │    │    │    ├── const: ''
                     │                                                                               │              │    │    │    │    └── const: '%'
                     │                                                                               │              │    │    │    └── const: ''
                     │                                                                               │              │    │    └── coalesce
                     │                                                                               │              │    │         ├── const: 1
                     │                                                                               │              │    │         └── const: '<NULL>'
                     │                                                                               │              │    └── const: ''
                     │                                                                               │              ├── const: ''
                     │                                                                               │              ├── const: ''
                     │                                                                               │              └── const: '00000'
                     │                                                                               └── project
                     │                                                                                    ├── columns: "_stmt_raise_9":7
                     │                                                                                    ├── values
                     │                                                                                    │    └── tuple
                     │                                                                                    └── projections
                     │                                                                                         └── udf: _stmt_raise_9 [as="_stmt_raise_9":7]
                     │                                                                                              └── body
                     │                                                                                                   ├── project
                     │                                                                                                   │    ├── columns: stmt_raise_10:5
                     │                                                                                                   │    ├── values
                     │                                                                                                   │    │    └── tuple
                     │                                                                                                   │    └── projections
                     │                                                                                                   │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_10:5]
                     │                                                                                                   │              ├── const: 'NOTICE'
                     │                                                                                                   │              ├── concat
                     │                                                                                                   │              │    ├── concat
                     │                                                                                                   │              │    │    ├── concat
                     │                                                                                                   │              │    │    │    ├── concat
                     │                                                                                                   │              │    │    │    │    ├── concat
                     │                                                                                                   │              │    │    │    │    │    ├── concat
                     │                                                                                                   │              │    │    │    │    │    │    ├── concat
                     │                                                                                                   │              │    │    │    │    │    │    │    ├── concat
                     │                                                                                                   │              │    │    │    │    │    │    │    │    ├── concat
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    ├── concat
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    ├── concat
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    ├── concat
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    │    ├── concat
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    │    │    ├── concat
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    │    │    │    ├── concat
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    ├── concat
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    ├── concat
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    ├── concat
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    ├── concat
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    ├── concat
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    ├── const: ''
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    └── const: '%'
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    └── const: ''
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    └── coalesce
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │         ├── const: 1
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │         └── const: '<NULL>'
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    └── const: 'foo'
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    └── const: '%'
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    │    │    │    │    └── const: ' bar'
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    │    │    │    └── const: '%'
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    │    │    └── const: ''
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    │    └── const: '%'
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    │    └── const: ' '
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    │    └── const: '%'
                     │                                                                                                   │              │    │    │    │    │    │    │    │    │    └── const: ' '
                     │                                                                                                   │              │    │    │    │    │    │    │    │    └── const: '%'
                     │                                                                                                   │              │    │    │    │    │    │    │    └── const: ''
                     │                                                                                                   │              │    │    │    │    │    │    └── const: '%'
                     │                                                                                                   │              │    │    │    │    │    └── const: ' ba'
                     │                                                                                                   │              │    │    │    │    └── coalesce
                     │                                                                                                   │              │    │    │    │         ├── const: 2
                     │                                                                                                   │              │    │    │    │         └── const: '<NULL>'
                     │                                                                                                   │              │    │    │    └── const: 'z'
                     │                                                                                                   │              │    │    └── coalesce
                     │                                                                                                   │              │    │         ├── const: 3
                     │                                                                                                   │              │    │         └── const: '<NULL>'
                     │                                                                                                   │              │    └── const: ''
                     │                                                                                                   │              ├── const: ''
                     │                                                                                                   │              ├── const: ''
                     │                                                                                                   │              └── const: '00000'
                     │                                                                                                   └── project
                     │                                                                                                        ├── columns: stmt_return_11:6!null
                     │                                                                                                        ├── values
                     │                                                                                                        │    └── tuple
                     │                                                                                                        └── projections
                     │                                                                                                             └── const: 0 [as=stmt_return_11:6]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f() RETURNS INT AS $$
  BEGIN
    RAISE NOTICE division_by_zero;
    RAISE NOTICE null_value_not_allowed;
    RAISE NOTICE reading_sql_data_not_permitted;
    RAISE NOTICE SQLSTATE '22012';
    RAISE NOTICE SQLSTATE '22004';
    RAISE NOTICE SQLSTATE '39004';
    RAISE NOTICE SQLSTATE '2F004';
    RAISE NOTICE SQLSTATE '38004';
    return 0;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f();
----
project
 ├── columns: f:18
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:18]
           └── body
                └── limit
                     ├── columns: "_stmt_raise_1":17
                     ├── project
                     │    ├── columns: "_stmt_raise_1":17
                     │    ├── values
                     │    │    └── tuple
                     │    └── projections
                     │         └── udf: _stmt_raise_1 [as="_stmt_raise_1":17]
                     │              └── body
                     │                   ├── project
                     │                   │    ├── columns: stmt_raise_2:1
                     │                   │    ├── values
                     │                   │    │    └── tuple
                     │                   │    └── projections
                     │                   │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_2:1]
                     │                   │              ├── const: 'NOTICE'
                     │                   │              ├── const: 'division_by_zero'
                     │                   │              ├── const: ''
                     │                   │              ├── const: ''
                     │                   │              └── const: 'division_by_zero'
                     │                   └── project
                     │                        ├── columns: "_stmt_raise_3":16
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── udf: _stmt_raise_3 [as="_stmt_raise_3":16]
                     │                                  └── body
                     │                                       ├── project
                     │                                       │    ├── columns: stmt_raise_4:2
                     │                                       │    ├── values
                     │                                       │    │    └── tuple
                     │                                       │    └── projections
                     │                                       │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_4:2]
                     │                                       │              ├── const: 'NOTICE'
                     │                                       │              ├── const: 'null_value_not_allowed'
                     │                                       │              ├── const: ''
                     │                                       │              ├── const: ''
                     │                                       │              └── const: 'null_value_not_allowed'
                     │                                       └── project
                     │                                            ├── columns: "_stmt_raise_5":15
                     │                                            ├── values
                     │                                            │    └── tuple
                     │                                            └── projections
                     │                                                 └── udf: _stmt_raise_5 [as="_stmt_raise_5":15]
                     │                                                      └── body
                     │                                                           ├── project
                     │                                                           │    ├── columns: stmt_raise_6:3
                     │                                                           │    ├── values
                     │                                                           │    │    └── tuple
                     │                                                           │    └── projections
                     │                                                           │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_6:3]
                     │                                                           │              ├── const: 'NOTICE'
                     │                                                           │              ├── const: 'reading_sql_data_not_permitted'
                     │                                                           │              ├── const: ''
                     │                                                           │              ├── const: ''
                     │                                                           │              └── const: 'reading_sql_data_not_permitted'
                     │                                                           └── project
                     │                                                                ├── columns: "_stmt_raise_7":14
                     │                                                                ├── values
                     │                                                                │    └── tuple
                     │                                                                └── projections
                     │                                                                     └── udf: _stmt_raise_7 [as="_stmt_raise_7":14]
                     │                                                                          └── body
                     │                                                                               ├── project
                     │                                                                               │    ├── columns: stmt_raise_8:4
                     │                                                                               │    ├── values
                     │                                                                               │    │    └── tuple
                     │                                                                               │    └── projections
                     │                                                                               │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_8:4]
                     │                                                                               │              ├── const: 'NOTICE'
                     │                                                                               │              ├── const: '22012'
                     │                                                                               │              ├── const: ''
                     │                                                                               │              ├── const: ''
                     │                                                                               │              └── const: '22012'
                     │                                                                               └── project
                     │                                                                                    ├── columns: "_stmt_raise_9":13
                     │                                                                                    ├── values
                     │                                                                                    │    └── tuple
                     │                                                                                    └── projections
                     │                                                                                         └── udf: _stmt_raise_9 [as="_stmt_raise_9":13]
                     │                                                                                              └── body
                     │                                                                                                   ├── project
                     │                                                                                                   │    ├── columns: stmt_raise_10:5
                     │                                                                                                   │    ├── values
                     │                                                                                                   │    │    └── tuple
                     │                                                                                                   │    └── projections
                     │                                                                                                   │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_10:5]
                     │                                                                                                   │              ├── const: 'NOTICE'
                     │                                                                                                   │              ├── const: '22004'
                     │                                                                                                   │              ├── const: ''
                     │                                                                                                   │              ├── const: ''
                     │                                                                                                   │              └── const: '22004'
                     │                                                                                                   └── project
                     │                                                                                                        ├── columns: "_stmt_raise_11":12
                     │                                                                                                        ├── values
                     │                                                                                                        │    └── tuple
                     │                                                                                                        └── projections
                     │                                                                                                             └── udf: _stmt_raise_11 [as="_stmt_raise_11":12]
                     │                                                                                                                  └── body
                     │                                                                                                                       ├── project
                     │                                                                                                                       │    ├── columns: stmt_raise_12:6
                     │                                                                                                                       │    ├── values
                     │                                                                                                                       │    │    └── tuple
                     │                                                                                                                       │    └── projections
                     │                                                                                                                       │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_12:6]
                     │                                                                                                                       │              ├── const: 'NOTICE'
                     │                                                                                                                       │              ├── const: '39004'
                     │                                                                                                                       │              ├── const: ''
                     │                                                                                                                       │              ├── const: ''
                     │                                                                                                                       │              └── const: '39004'
                     │                                                                                                                       └── project
                     │                                                                                                                            ├── columns: "_stmt_raise_13":11
                     │                                                                                                                            ├── values
                     │                                                                                                                            │    └── tuple
                     │                                                                                                                            └── projections
                     │                                                                                                                                 └── udf: _stmt_raise_13 [as="_stmt_raise_13":11]
                     │                                                                                                                                      └── body
                     │                                                                                                                                           ├── project
                     │                                                                                                                                           │    ├── columns: stmt_raise_14:7
                     │                                                                                                                                           │    ├── values
                     │                                                                                                                                           │    │    └── tuple
                     │                                                                                                                                           │    └── projections
                     │                                                                                                                                           │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_14:7]
                     │                                                                                                                                           │              ├── const: 'NOTICE'
                     │                                                                                                                                           │              ├── const: '2F004'
                     │                                                                                                                                           │              ├── const: ''
                     │                                                                                                                                           │              ├── const: ''
                     │                                                                                                                                           │              └── const: '2F004'
                     │                                                                                                                                           └── project
                     │                                                                                                                                                ├── columns: "_stmt_raise_15":10
                     │                                                                                                                                                ├── values
                     │                                                                                                                                                │    └── tuple
                     │                                                                                                                                                └── projections
                     │                                                                                                                                                     └── udf: _stmt_raise_15 [as="_stmt_raise_15":10]
                     │                                                                                                                                                          └── body
                     │                                                                                                                                                               ├── project
                     │                                                                                                                                                               │    ├── columns: stmt_raise_16:8
                     │                                                                                                                                                               │    ├── values
                     │                                                                                                                                                               │    │    └── tuple
                     │                                                                                                                                                               │    └── projections
                     │                                                                                                                                                               │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_16:8]
                     │                                                                                                                                                               │              ├── const: 'NOTICE'
                     │                                                                                                                                                               │              ├── const: '38004'
                     │                                                                                                                                                               │              ├── const: ''
                     │                                                                                                                                                               │              ├── const: ''
                     │                                                                                                                                                               │              └── const: '38004'
                     │                                                                                                                                                               └── project
                     │                                                                                                                                                                    ├── columns: stmt_return_17:9!null
                     │                                                                                                                                                                    ├── values
                     │                                                                                                                                                                    │    └── tuple
                     │                                                                                                                                                                    └── projections
                     │                                                                                                                                                                         └── const: 0 [as=stmt_return_17:9]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f() RETURNS INT AS $$
  BEGIN
    RAISE NOTICE USING MESSAGE = 'foo';
    RAISE NOTICE USING MESSAGE = format('%s %s!','Hello','World');
    RAISE NOTICE USING MESSAGE = 'foo', DETAIL = 'bar', HINT = 'baz';
    RAISE NOTICE 'foo' USING ERRCODE = 'division_by_zero';
    RAISE NOTICE 'foo' USING ERRCODE = '22012';
    -- If no message is specified, the error code is used.
    RAISE NOTICE USING ERRCODE = 'division_by_zero';
    RETURN 0;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f();
----
project
 ├── columns: f:14
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:14]
           └── body
                └── limit
                     ├── columns: "_stmt_raise_1":13
                     ├── project
                     │    ├── columns: "_stmt_raise_1":13
                     │    ├── values
                     │    │    └── tuple
                     │    └── projections
                     │         └── udf: _stmt_raise_1 [as="_stmt_raise_1":13]
                     │              └── body
                     │                   ├── project
                     │                   │    ├── columns: stmt_raise_2:1
                     │                   │    ├── values
                     │                   │    │    └── tuple
                     │                   │    └── projections
                     │                   │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_2:1]
                     │                   │              ├── const: 'NOTICE'
                     │                   │              ├── const: 'foo'
                     │                   │              ├── const: ''
                     │                   │              ├── const: ''
                     │                   │              └── const: '00000'
                     │                   └── project
                     │                        ├── columns: "_stmt_raise_3":12
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── udf: _stmt_raise_3 [as="_stmt_raise_3":12]
                     │                                  └── body
                     │                                       ├── project
                     │                                       │    ├── columns: stmt_raise_4:2
                     │                                       │    ├── values
                     │                                       │    │    └── tuple
                     │                                       │    └── projections
                     │                                       │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_4:2]
                     │                                       │              ├── const: 'NOTICE'
                     │                                       │              ├── function: format
                     │                                       │              │    ├── const: '%s %s!'
                     │                                       │              │    ├── const: 'Hello'
                     │                                       │              │    └── const: 'World'
                     │                                       │              ├── const: ''
                     │                                       │              ├── const: ''
                     │                                       │              └── const: '00000'
                     │                                       └── project
                     │                                            ├── columns: "_stmt_raise_5":11
                     │                                            ├── values
                     │                                            │    └── tuple
                     │                                            └── projections
                     │                                                 └── udf: _stmt_raise_5 [as="_stmt_raise_5":11]
                     │                                                      └── body
                     │                                                           ├── project
                     │                                                           │    ├── columns: stmt_raise_6:3
                     │                                                           │    ├── values
                     │                                                           │    │    └── tuple
                     │                                                           │    └── projections
                     │                                                           │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_6:3]
                     │                                                           │              ├── const: 'NOTICE'
                     │                                                           │              ├── const: 'foo'
                     │                                                           │              ├── const: 'bar'
                     │                                                           │              ├── const: 'baz'
                     │                                                           │              └── const: '00000'
                     │                                                           └── project
                     │                                                                ├── columns: "_stmt_raise_7":10
                     │                                                                ├── values
                     │                                                                │    └── tuple
                     │                                                                └── projections
                     │                                                                     └── udf: _stmt_raise_7 [as="_stmt_raise_7":10]
                     │                                                                          └── body
                     │                                                                               ├── project
                     │                                                                               │    ├── columns: stmt_raise_8:4
                     │                                                                               │    ├── values
                     │                                                                               │    │    └── tuple
                     │                                                                               │    └── projections
                     │                                                                               │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_8:4]
                     │                                                                               │              ├── const: 'NOTICE'
                     │                                                                               │              ├── const: 'foo'
                     │                                                                               │              ├── const: ''
                     │                                                                               │              ├── const: ''
                     │                                                                               │              └── const: 'division_by_zero'
                     │                                                                               └── project
                     │                                                                                    ├── columns: "_stmt_raise_9":9
                     │                                                                                    ├── values
                     │                                                                                    │    └── tuple
                     │                                                                                    └── projections
                     │                                                                                         └── udf: _stmt_raise_9 [as="_stmt_raise_9":9]
                     │                                                                                              └── body
                     │                                                                                                   ├── project
                     │                                                                                                   │    ├── columns: stmt_raise_10:5
                     │                                                                                                   │    ├── values
                     │                                                                                                   │    │    └── tuple
                     │                                                                                                   │    └── projections
                     │                                                                                                   │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_10:5]
                     │                                                                                                   │              ├── const: 'NOTICE'
                     │                                                                                                   │              ├── const: 'foo'
                     │                                                                                                   │              ├── const: ''
                     │                                                                                                   │              ├── const: ''
                     │                                                                                                   │              └── const: '22012'
                     │                                                                                                   └── project
                     │                                                                                                        ├── columns: "_stmt_raise_11":8
                     │                                                                                                        ├── values
                     │                                                                                                        │    └── tuple
                     │                                                                                                        └── projections
                     │                                                                                                             └── udf: _stmt_raise_11 [as="_stmt_raise_11":8]
                     │                                                                                                                  └── body
                     │                                                                                                                       ├── project
                     │                                                                                                                       │    ├── columns: stmt_raise_12:6
                     │                                                                                                                       │    ├── values
                     │                                                                                                                       │    │    └── tuple
                     │                                                                                                                       │    └── projections
                     │                                                                                                                       │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_12:6]
                     │                                                                                                                       │              ├── const: 'NOTICE'
                     │                                                                                                                       │              ├── const: 'division_by_zero'
                     │                                                                                                                       │              ├── const: ''
                     │                                                                                                                       │              ├── const: ''
                     │                                                                                                                       │              └── const: 'division_by_zero'
                     │                                                                                                                       └── project
                     │                                                                                                                            ├── columns: stmt_return_13:7!null
                     │                                                                                                                            ├── values
                     │                                                                                                                            │    └── tuple
                     │                                                                                                                            └── projections
                     │                                                                                                                                 └── const: 0 [as=stmt_return_13:7]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f() RETURNS INT AS $$
  DECLARE
    i INT := 0;
  BEGIN
    RAISE NOTICE '1: i = %', i;
    i := 100;
    RAISE NOTICE '2: i = %', i;
    i := (SELECT count(*) FROM xy);
    RAISE NOTICE '3: i = %', i;
    RAISE NOTICE 'max_x: %', (SELECT max(x) FROM xy);
    return i;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f();
----
project
 ├── columns: f:29
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:29]
           └── body
                └── limit
                     ├── columns: "_stmt_raise_1":28
                     ├── project
                     │    ├── columns: "_stmt_raise_1":28
                     │    ├── project
                     │    │    ├── columns: i:1!null
                     │    │    ├── values
                     │    │    │    └── tuple
                     │    │    └── projections
                     │    │         └── const: 0 [as=i:1]
                     │    └── projections
                     │         └── udf: _stmt_raise_1 [as="_stmt_raise_1":28]
                     │              ├── args
                     │              │    └── variable: i:1
                     │              ├── params: i:2
                     │              └── body
                     │                   ├── project
                     │                   │    ├── columns: stmt_raise_2:3
                     │                   │    ├── values
                     │                   │    │    └── tuple
                     │                   │    └── projections
                     │                   │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_2:3]
                     │                   │              ├── const: 'NOTICE'
                     │                   │              ├── concat
                     │                   │              │    ├── concat
                     │                   │              │    │    ├── const: '1: i = '
                     │                   │              │    │    └── coalesce
                     │                   │              │    │         ├── variable: i:2
                     │                   │              │    │         └── const: '<NULL>'
                     │                   │              │    └── const: ''
                     │                   │              ├── const: ''
                     │                   │              ├── const: ''
                     │                   │              └── const: '00000'
                     │                   └── project
                     │                        ├── columns: "_stmt_raise_3":27
                     │                        ├── project
                     │                        │    ├── columns: i:4!null
                     │                        │    ├── values
                     │                        │    │    └── tuple
                     │                        │    └── projections
                     │                        │         └── const: 100 [as=i:4]
                     │                        └── projections
                     │                             └── udf: _stmt_raise_3 [as="_stmt_raise_3":27]
                     │                                  ├── args
                     │                                  │    └── variable: i:4
                     │                                  ├── params: i:5
                     │                                  └── body
                     │                                       ├── project
                     │                                       │    ├── columns: stmt_raise_4:6
                     │                                       │    ├── values
                     │                                       │    │    └── tuple
                     │                                       │    └── projections
                     │                                       │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_4:6]
                     │                                       │              ├── const: 'NOTICE'
                     │                                       │              ├── concat
                     │                                       │              │    ├── concat
                     │                                       │              │    │    ├── const: '2: i = '
                     │                                       │              │    │    └── coalesce
                     │                                       │              │    │         ├── variable: i:5
                     │                                       │              │    │         └── const: '<NULL>'
                     │                                       │              │    └── const: ''
                     │                                       │              ├── const: ''
                     │                                       │              ├── const: ''
                     │                                       │              └── const: '00000'
                     │                                       └── project
                     │                                            ├── columns: "_stmt_raise_5":26
                     │                                            ├── project
                     │                                            │    ├── columns: i:13
                     │                                            │    ├── values
                     │                                            │    │    └── tuple
                     │                                            │    └── projections
                     │                                            │         └── subquery [as=i:13]
                     │                                            │              └── max1-row
                     │                                            │                   ├── columns: count_rows:12!null
                     │                                            │                   └── scalar-group-by
                     │                                            │                        ├── columns: count_rows:12!null
                     │                                            │                        ├── project
                     │                                            │                        │    └── scan xy
                     │                                            │                        │         └── columns: x:7 y:8 rowid:9!null crdb_internal_mvcc_timestamp:10 tableoid:11
                     │                                            │                        └── aggregations
                     │                                            │                             └── count-rows [as=count_rows:12]
                     │                                            └── projections
                     │                                                 └── udf: _stmt_raise_5 [as="_stmt_raise_5":26]
                     │                                                      ├── args
                     │                                                      │    └── variable: i:13
                     │                                                      ├── params: i:14
                     │                                                      └── body
                     │                                                           ├── project
                     │                                                           │    ├── columns: stmt_raise_6:15
                     │                                                           │    ├── values
                     │                                                           │    │    └── tuple
                     │                                                           │    └── projections
                     │                                                           │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_6:15]
                     │                                                           │              ├── const: 'NOTICE'
                     │                                                           │              ├── concat
                     │                                                           │              │    ├── concat
                     │                                                           │              │    │    ├── const: '3: i = '
                     │                                                           │              │    │    └── coalesce
                     │                                                           │              │    │         ├── variable: i:14
                     │                                                           │              │    │         └── const: '<NULL>'
                     │                                                           │              │    └── const: ''
                     │                                                           │              ├── const: ''
                     │                                                           │              ├── const: ''
                     │                                                           │              └── const: '00000'
                     │                                                           └── project
                     │                                                                ├── columns: "_stmt_raise_7":25
                     │                                                                ├── values
                     │                                                                │    └── tuple
                     │                                                                └── projections
                     │                                                                     └── udf: _stmt_raise_7 [as="_stmt_raise_7":25]
                     │                                                                          ├── args
                     │                                                                          │    └── variable: i:14
                     │                                                                          ├── params: i:16
                     │                                                                          └── body
                     │                                                                               ├── project
                     │                                                                               │    ├── columns: stmt_raise_8:23
                     │                                                                               │    ├── values
                     │                                                                               │    │    └── tuple
                     │                                                                               │    └── projections
                     │                                                                               │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_8:23]
                     │                                                                               │              ├── const: 'NOTICE'
                     │                                                                               │              ├── concat
                     │                                                                               │              │    ├── concat
                     │                                                                               │              │    │    ├── const: 'max_x: '
                     │                                                                               │              │    │    └── coalesce
                     │                                                                               │              │    │         ├── subquery
                     │                                                                               │              │    │         │    └── max1-row
                     │                                                                               │              │    │         │         ├── columns: max:22
                     │                                                                               │              │    │         │         └── scalar-group-by
                     │                                                                               │              │    │         │              ├── columns: max:22
                     │                                                                               │              │    │         │              ├── project
                     │                                                                               │              │    │         │              │    ├── columns: x:17
                     │                                                                               │              │    │         │              │    └── scan xy
                     │                                                                               │              │    │         │              │         └── columns: x:17 y:18 rowid:19!null crdb_internal_mvcc_timestamp:20 tableoid:21
                     │                                                                               │              │    │         │              └── aggregations
                     │                                                                               │              │    │         │                   └── max [as=max:22]
                     │                                                                               │              │    │         │                        └── variable: x:17
                     │                                                                               │              │    │         └── const: '<NULL>'
                     │                                                                               │              │    └── const: ''
                     │                                                                               │              ├── const: ''
                     │                                                                               │              ├── const: ''
                     │                                                                               │              └── const: '00000'
                     │                                                                               └── project
                     │                                                                                    ├── columns: stmt_return_9:24
                     │                                                                                    ├── values
                     │                                                                                    │    └── tuple
                     │                                                                                    └── projections
                     │                                                                                         └── variable: i:16 [as=stmt_return_9:24]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f() RETURNS INT AS $$
  DECLARE
    i INT := 0;
  BEGIN
    LOOP
      IF i >= 5 THEN EXIT; END IF;
      RAISE NOTICE 'i = %', i;
      i := i + 1;
    END LOOP;
    RAISE NOTICE 'finished with i = %', i;
    RETURN 0;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f();
----
project
 ├── columns: f:18
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:18]
           └── body
                └── limit
                     ├── columns: stmt_loop_5:17
                     ├── project
                     │    ├── columns: stmt_loop_5:17
                     │    ├── project
                     │    │    ├── columns: i:1!null
                     │    │    ├── values
                     │    │    │    └── tuple
                     │    │    └── projections
                     │    │         └── const: 0 [as=i:1]
                     │    └── projections
                     │         └── udf: stmt_loop_5 [as=stmt_loop_5:17]
                     │              ├── args
                     │              │    └── variable: i:1
                     │              ├── params: i:7
                     │              └── body
                     │                   └── project
                     │                        ├── columns: stmt_if_9:16
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── case [as=stmt_if_9:16]
                     │                                  ├── true
                     │                                  ├── when
                     │                                  │    ├── ge
                     │                                  │    │    ├── variable: i:7
                     │                                  │    │    └── const: 5
                     │                                  │    └── subquery
                     │                                  │         └── project
                     │                                  │              ├── columns: loop_exit_1:14
                     │                                  │              ├── values
                     │                                  │              │    └── tuple
                     │                                  │              └── projections
                     │                                  │                   └── udf: loop_exit_1 [as=loop_exit_1:14]
                     │                                  │                        ├── args
                     │                                  │                        │    └── variable: i:7
                     │                                  │                        ├── params: i:2
                     │                                  │                        └── body
                     │                                  │                             └── project
                     │                                  │                                  ├── columns: "_stmt_raise_2":6
                     │                                  │                                  ├── values
                     │                                  │                                  │    └── tuple
                     │                                  │                                  └── projections
                     │                                  │                                       └── udf: _stmt_raise_2 [as="_stmt_raise_2":6]
                     │                                  │                                            ├── args
                     │                                  │                                            │    └── variable: i:2
                     │                                  │                                            ├── params: i:3
                     │                                  │                                            └── body
                     │                                  │                                                 ├── project
                     │                                  │                                                 │    ├── columns: stmt_raise_3:4
                     │                                  │                                                 │    ├── values
                     │                                  │                                                 │    │    └── tuple
                     │                                  │                                                 │    └── projections
                     │                                  │                                                 │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_3:4]
                     │                                  │                                                 │              ├── const: 'NOTICE'
                     │                                  │                                                 │              ├── concat
                     │                                  │                                                 │              │    ├── concat
                     │                                  │                                                 │              │    │    ├── const: 'finished with i = '
                     │                                  │                                                 │              │    │    └── coalesce
                     │                                  │                                                 │              │    │         ├── variable: i:3
                     │                                  │                                                 │              │    │         └── const: '<NULL>'
                     │                                  │                                                 │              │    └── const: ''
                     │                                  │                                                 │              ├── const: ''
                     │                                  │                                                 │              ├── const: ''
                     │                                  │                                                 │              └── const: '00000'
                     │                                  │                                                 └── project
                     │                                  │                                                      ├── columns: stmt_return_4:5!null
                     │                                  │                                                      ├── values
                     │                                  │                                                      │    └── tuple
                     │                                  │                                                      └── projections
                     │                                  │                                                           └── const: 0 [as=stmt_return_4:5]
                     │                                  └── subquery
                     │                                       └── project
                     │                                            ├── columns: stmt_if_6:15
                     │                                            ├── values
                     │                                            │    └── tuple
                     │                                            └── projections
                     │                                                 └── udf: stmt_if_6 [as=stmt_if_6:15]
                     │                                                      ├── args
                     │                                                      │    └── variable: i:7
                     │                                                      ├── params: i:8
                     │                                                      └── body
                     │                                                           └── project
                     │                                                                ├── columns: "_stmt_raise_7":13
                     │                                                                ├── values
                     │                                                                │    └── tuple
                     │                                                                └── projections
                     │                                                                     └── udf: _stmt_raise_7 [as="_stmt_raise_7":13]
                     │                                                                          ├── args
                     │                                                                          │    └── variable: i:8
                     │                                                                          ├── params: i:9
                     │                                                                          └── body
                     │                                                                               ├── project
                     │                                                                               │    ├── columns: stmt_raise_8:10
                     │                                                                               │    ├── values
                     │                                                                               │    │    └── tuple
                     │                                                                               │    └── projections
                     │                                                                               │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_8:10]
                     │                                                                               │              ├── const: 'NOTICE'
                     │                                                                               │              ├── concat
                     │                                                                               │              │    ├── concat
                     │                                                                               │              │    │    ├── const: 'i = '
                     │                                                                               │              │    │    └── coalesce
                     │                                                                               │              │    │         ├── variable: i:9
                     │                                                                               │              │    │         └── const: '<NULL>'
                     │                                                                               │              │    └── const: ''
                     │                                                                               │              ├── const: ''
                     │                                                                               │              ├── const: ''
                     │                                                                               │              └── const: '00000'
                     │                                                                               └── project
                     │                                                                                    ├── columns: stmt_loop_5:12
                     │                                                                                    ├── project
                     │                                                                                    │    ├── columns: i:11
                     │                                                                                    │    ├── values
                     │                                                                                    │    │    └── tuple
                     │                                                                                    │    └── projections
                     │                                                                                    │         └── plus [as=i:11]
                     │                                                                                    │              ├── variable: i:9
                     │                                                                                    │              └── const: 1
                     │                                                                                    └── projections
                     │                                                                                         └── udf: stmt_loop_5 [as=stmt_loop_5:12]
                     │                                                                                              ├── args
                     │                                                                                              │    └── variable: i:11
                     │                                                                                              └── recursive-call
                     └── const: 1

# Testing RAISE statement with EXCEPTION log level.
exec-ddl
CREATE OR REPLACE FUNCTION f() RETURNS INT AS $$
  BEGIN
    RAISE EXCEPTION 'foo';
    return 0;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f();
----
project
 ├── columns: f:4
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:4]
           └── body
                └── limit
                     ├── columns: "_stmt_raise_1":3
                     ├── project
                     │    ├── columns: "_stmt_raise_1":3
                     │    ├── values
                     │    │    └── tuple
                     │    └── projections
                     │         └── udf: _stmt_raise_1 [as="_stmt_raise_1":3]
                     │              └── body
                     │                   ├── project
                     │                   │    ├── columns: stmt_raise_2:1
                     │                   │    ├── values
                     │                   │    │    └── tuple
                     │                   │    └── projections
                     │                   │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_2:1]
                     │                   │              ├── const: 'ERROR'
                     │                   │              ├── const: 'foo'
                     │                   │              ├── const: ''
                     │                   │              ├── const: ''
                     │                   │              └── const: 'P0001'
                     │                   └── project
                     │                        ├── columns: stmt_return_3:2!null
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── const: 0 [as=stmt_return_3:2]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f() RETURNS INT AS $$
  BEGIN
    RAISE EXCEPTION division_by_zero;
    return 0;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f();
----
project
 ├── columns: f:4
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:4]
           └── body
                └── limit
                     ├── columns: "_stmt_raise_1":3
                     ├── project
                     │    ├── columns: "_stmt_raise_1":3
                     │    ├── values
                     │    │    └── tuple
                     │    └── projections
                     │         └── udf: _stmt_raise_1 [as="_stmt_raise_1":3]
                     │              └── body
                     │                   ├── project
                     │                   │    ├── columns: stmt_raise_2:1
                     │                   │    ├── values
                     │                   │    │    └── tuple
                     │                   │    └── projections
                     │                   │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_2:1]
                     │                   │              ├── const: 'ERROR'
                     │                   │              ├── const: 'division_by_zero'
                     │                   │              ├── const: ''
                     │                   │              ├── const: ''
                     │                   │              └── const: 'division_by_zero'
                     │                   └── project
                     │                        ├── columns: stmt_return_3:2!null
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── const: 0 [as=stmt_return_3:2]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f() RETURNS INT AS $$
  BEGIN
    RAISE EXCEPTION SQLSTATE '22012';
    return 0;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f();
----
project
 ├── columns: f:4
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:4]
           └── body
                └── limit
                     ├── columns: "_stmt_raise_1":3
                     ├── project
                     │    ├── columns: "_stmt_raise_1":3
                     │    ├── values
                     │    │    └── tuple
                     │    └── projections
                     │         └── udf: _stmt_raise_1 [as="_stmt_raise_1":3]
                     │              └── body
                     │                   ├── project
                     │                   │    ├── columns: stmt_raise_2:1
                     │                   │    ├── values
                     │                   │    │    └── tuple
                     │                   │    └── projections
                     │                   │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_2:1]
                     │                   │              ├── const: 'ERROR'
                     │                   │              ├── const: '22012'
                     │                   │              ├── const: ''
                     │                   │              ├── const: ''
                     │                   │              └── const: '22012'
                     │                   └── project
                     │                        ├── columns: stmt_return_3:2!null
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── const: 0 [as=stmt_return_3:2]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f() RETURNS INT AS $$
  DECLARE
    i INT := 0;
  BEGIN
    LOOP
      IF i >= 5 THEN EXIT; END IF;
      IF i = 3 THEN
        RAISE EXCEPTION 'i = %', i;
      END IF;
      RAISE NOTICE 'i = %', i;
      i := i + 1;
    END LOOP;
    RAISE NOTICE 'finished with i = %', i;
    RETURN 0;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f();
----
project
 ├── columns: f:25
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:25]
           └── body
                └── limit
                     ├── columns: stmt_loop_5:24
                     ├── project
                     │    ├── columns: stmt_loop_5:24
                     │    ├── project
                     │    │    ├── columns: i:1!null
                     │    │    ├── values
                     │    │    │    └── tuple
                     │    │    └── projections
                     │    │         └── const: 0 [as=i:1]
                     │    └── projections
                     │         └── udf: stmt_loop_5 [as=stmt_loop_5:24]
                     │              ├── args
                     │              │    └── variable: i:1
                     │              ├── params: i:7
                     │              └── body
                     │                   └── project
                     │                        ├── columns: stmt_if_13:23
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── case [as=stmt_if_13:23]
                     │                                  ├── true
                     │                                  ├── when
                     │                                  │    ├── ge
                     │                                  │    │    ├── variable: i:7
                     │                                  │    │    └── const: 5
                     │                                  │    └── subquery
                     │                                  │         └── project
                     │                                  │              ├── columns: loop_exit_1:21
                     │                                  │              ├── values
                     │                                  │              │    └── tuple
                     │                                  │              └── projections
                     │                                  │                   └── udf: loop_exit_1 [as=loop_exit_1:21]
                     │                                  │                        ├── args
                     │                                  │                        │    └── variable: i:7
                     │                                  │                        ├── params: i:2
                     │                                  │                        └── body
                     │                                  │                             └── project
                     │                                  │                                  ├── columns: "_stmt_raise_2":6
                     │                                  │                                  ├── values
                     │                                  │                                  │    └── tuple
                     │                                  │                                  └── projections
                     │                                  │                                       └── udf: _stmt_raise_2 [as="_stmt_raise_2":6]
                     │                                  │                                            ├── args
                     │                                  │                                            │    └── variable: i:2
                     │                                  │                                            ├── params: i:3
                     │                                  │                                            └── body
                     │                                  │                                                 ├── project
                     │                                  │                                                 │    ├── columns: stmt_raise_3:4
                     │                                  │                                                 │    ├── values
                     │                                  │                                                 │    │    └── tuple
                     │                                  │                                                 │    └── projections
                     │                                  │                                                 │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_3:4]
                     │                                  │                                                 │              ├── const: 'NOTICE'
                     │                                  │                                                 │              ├── concat
                     │                                  │                                                 │              │    ├── concat
                     │                                  │                                                 │              │    │    ├── const: 'finished with i = '
                     │                                  │                                                 │              │    │    └── coalesce
                     │                                  │                                                 │              │    │         ├── variable: i:3
                     │                                  │                                                 │              │    │         └── const: '<NULL>'
                     │                                  │                                                 │              │    └── const: ''
                     │                                  │                                                 │              ├── const: ''
                     │                                  │                                                 │              ├── const: ''
                     │                                  │                                                 │              └── const: '00000'
                     │                                  │                                                 └── project
                     │                                  │                                                      ├── columns: stmt_return_4:5!null
                     │                                  │                                                      ├── values
                     │                                  │                                                      │    └── tuple
                     │                                  │                                                      └── projections
                     │                                  │                                                           └── const: 0 [as=stmt_return_4:5]
                     │                                  └── subquery
                     │                                       └── project
                     │                                            ├── columns: stmt_if_6:22
                     │                                            ├── values
                     │                                            │    └── tuple
                     │                                            └── projections
                     │                                                 └── udf: stmt_if_6 [as=stmt_if_6:22]
                     │                                                      ├── args
                     │                                                      │    └── variable: i:7
                     │                                                      ├── params: i:8
                     │                                                      └── body
                     │                                                           └── project
                     │                                                                ├── columns: stmt_if_12:20
                     │                                                                ├── values
                     │                                                                │    └── tuple
                     │                                                                └── projections
                     │                                                                     └── case [as=stmt_if_12:20]
                     │                                                                          ├── true
                     │                                                                          ├── when
                     │                                                                          │    ├── eq
                     │                                                                          │    │    ├── variable: i:8
                     │                                                                          │    │    └── const: 3
                     │                                                                          │    └── subquery
                     │                                                                          │         └── project
                     │                                                                          │              ├── columns: "_stmt_raise_10":18
                     │                                                                          │              ├── values
                     │                                                                          │              │    └── tuple
                     │                                                                          │              └── projections
                     │                                                                          │                   └── udf: _stmt_raise_10 [as="_stmt_raise_10":18]
                     │                                                                          │                        ├── args
                     │                                                                          │                        │    └── variable: i:8
                     │                                                                          │                        ├── params: i:15
                     │                                                                          │                        └── body
                     │                                                                          │                             ├── project
                     │                                                                          │                             │    ├── columns: stmt_raise_11:16
                     │                                                                          │                             │    ├── values
                     │                                                                          │                             │    │    └── tuple
                     │                                                                          │                             │    └── projections
                     │                                                                          │                             │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_11:16]
                     │                                                                          │                             │              ├── const: 'ERROR'
                     │                                                                          │                             │              ├── concat
                     │                                                                          │                             │              │    ├── concat
                     │                                                                          │                             │              │    │    ├── const: 'i = '
                     │                                                                          │                             │              │    │    └── coalesce
                     │                                                                          │                             │              │    │         ├── variable: i:15
                     │                                                                          │                             │              │    │         └── const: '<NULL>'
                     │                                                                          │                             │              │    └── const: ''
                     │                                                                          │                             │              ├── const: ''
                     │                                                                          │                             │              ├── const: ''
                     │                                                                          │                             │              └── const: 'P0001'
                     │                                                                          │                             └── project
                     │                                                                          │                                  ├── columns: stmt_if_7:17
                     │                                                                          │                                  ├── values
                     │                                                                          │                                  │    └── tuple
                     │                                                                          │                                  └── projections
                     │                                                                          │                                       └── udf: stmt_if_7 [as=stmt_if_7:17]
                     │                                                                          │                                            ├── args
                     │                                                                          │                                            │    └── variable: i:15
                     │                                                                          │                                            ├── params: i:9
                     │                                                                          │                                            └── body
                     │                                                                          │                                                 └── project
                     │                                                                          │                                                      ├── columns: "_stmt_raise_8":14
                     │                                                                          │                                                      ├── values
                     │                                                                          │                                                      │    └── tuple
                     │                                                                          │                                                      └── projections
                     │                                                                          │                                                           └── udf: _stmt_raise_8 [as="_stmt_raise_8":14]
                     │                                                                          │                                                                ├── args
                     │                                                                          │                                                                │    └── variable: i:9
                     │                                                                          │                                                                ├── params: i:10
                     │                                                                          │                                                                └── body
                     │                                                                          │                                                                     ├── project
                     │                                                                          │                                                                     │    ├── columns: stmt_raise_9:11
                     │                                                                          │                                                                     │    ├── values
                     │                                                                          │                                                                     │    │    └── tuple
                     │                                                                          │                                                                     │    └── projections
                     │                                                                          │                                                                     │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_9:11]
                     │                                                                          │                                                                     │              ├── const: 'NOTICE'
                     │                                                                          │                                                                     │              ├── concat
                     │                                                                          │                                                                     │              │    ├── concat
                     │                                                                          │                                                                     │              │    │    ├── const: 'i = '
                     │                                                                          │                                                                     │              │    │    └── coalesce
                     │                                                                          │                                                                     │              │    │         ├── variable: i:10
                     │                                                                          │                                                                     │              │    │         └── const: '<NULL>'
                     │                                                                          │                                                                     │              │    └── const: ''
                     │                                                                          │                                                                     │              ├── const: ''
                     │                                                                          │                                                                     │              ├── const: ''
                     │                                                                          │                                                                     │              └── const: '00000'
                     │                                                                          │                                                                     └── project
                     │                                                                          │                                                                          ├── columns: stmt_loop_5:13
                     │                                                                          │                                                                          ├── project
                     │                                                                          │                                                                          │    ├── columns: i:12
                     │                                                                          │                                                                          │    ├── values
                     │                                                                          │                                                                          │    │    └── tuple
                     │                                                                          │                                                                          │    └── projections
                     │                                                                          │                                                                          │         └── plus [as=i:12]
                     │                                                                          │                                                                          │              ├── variable: i:10
                     │                                                                          │                                                                          │              └── const: 1
                     │                                                                          │                                                                          └── projections
                     │                                                                          │                                                                               └── udf: stmt_loop_5 [as=stmt_loop_5:13]
                     │                                                                          │                                                                                    ├── args
                     │                                                                          │                                                                                    │    └── variable: i:12
                     │                                                                          │                                                                                    └── recursive-call
                     │                                                                          └── subquery
                     │                                                                               └── project
                     │                                                                                    ├── columns: stmt_if_7:19
                     │                                                                                    ├── values
                     │                                                                                    │    └── tuple
                     │                                                                                    └── projections
                     │                                                                                         └── udf: stmt_if_7 [as=stmt_if_7:19]
                     │                                                                                              ├── args
                     │                                                                                              │    └── variable: i:8
                     │                                                                                              ├── params: i:9
                     │                                                                                              └── body
                     │                                                                                                   └── project
                     │                                                                                                        ├── columns: "_stmt_raise_8":14
                     │                                                                                                        ├── values
                     │                                                                                                        │    └── tuple
                     │                                                                                                        └── projections
                     │                                                                                                             └── udf: _stmt_raise_8 [as="_stmt_raise_8":14]
                     │                                                                                                                  ├── args
                     │                                                                                                                  │    └── variable: i:9
                     │                                                                                                                  ├── params: i:10
                     │                                                                                                                  └── body
                     │                                                                                                                       ├── project
                     │                                                                                                                       │    ├── columns: stmt_raise_9:11
                     │                                                                                                                       │    ├── values
                     │                                                                                                                       │    │    └── tuple
                     │                                                                                                                       │    └── projections
                     │                                                                                                                       │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_9:11]
                     │                                                                                                                       │              ├── const: 'NOTICE'
                     │                                                                                                                       │              ├── concat
                     │                                                                                                                       │              │    ├── concat
                     │                                                                                                                       │              │    │    ├── const: 'i = '
                     │                                                                                                                       │              │    │    └── coalesce
                     │                                                                                                                       │              │    │         ├── variable: i:10
                     │                                                                                                                       │              │    │         └── const: '<NULL>'
                     │                                                                                                                       │              │    └── const: ''
                     │                                                                                                                       │              ├── const: ''
                     │                                                                                                                       │              ├── const: ''
                     │                                                                                                                       │              └── const: '00000'
                     │                                                                                                                       └── project
                     │                                                                                                                            ├── columns: stmt_loop_5:13
                     │                                                                                                                            ├── project
                     │                                                                                                                            │    ├── columns: i:12
                     │                                                                                                                            │    ├── values
                     │                                                                                                                            │    │    └── tuple
                     │                                                                                                                            │    └── projections
                     │                                                                                                                            │         └── plus [as=i:12]
                     │                                                                                                                            │              ├── variable: i:10
                     │                                                                                                                            │              └── const: 1
                     │                                                                                                                            └── projections
                     │                                                                                                                                 └── udf: stmt_loop_5 [as=stmt_loop_5:13]
                     │                                                                                                                                      ├── args
                     │                                                                                                                                      │    └── variable: i:12
                     │                                                                                                                                      └── recursive-call
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f() RETURNS INT AS $$
  BEGIN
    RAISE EXCEPTION USING ERRCODE = 'division_by_zero';
    return 0;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f();
----
project
 ├── columns: f:4
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:4]
           └── body
                └── limit
                     ├── columns: "_stmt_raise_1":3
                     ├── project
                     │    ├── columns: "_stmt_raise_1":3
                     │    ├── values
                     │    │    └── tuple
                     │    └── projections
                     │         └── udf: _stmt_raise_1 [as="_stmt_raise_1":3]
                     │              └── body
                     │                   ├── project
                     │                   │    ├── columns: stmt_raise_2:1
                     │                   │    ├── values
                     │                   │    │    └── tuple
                     │                   │    └── projections
                     │                   │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_2:1]
                     │                   │              ├── const: 'ERROR'
                     │                   │              ├── const: 'division_by_zero'
                     │                   │              ├── const: ''
                     │                   │              ├── const: ''
                     │                   │              └── const: 'division_by_zero'
                     │                   └── project
                     │                        ├── columns: stmt_return_3:2!null
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── const: 0 [as=stmt_return_3:2]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f() RETURNS INT AS $$
  BEGIN
    RAISE EXCEPTION USING ERRCODE = '22012';
    return 0;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f();
----
project
 ├── columns: f:4
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:4]
           └── body
                └── limit
                     ├── columns: "_stmt_raise_1":3
                     ├── project
                     │    ├── columns: "_stmt_raise_1":3
                     │    ├── values
                     │    │    └── tuple
                     │    └── projections
                     │         └── udf: _stmt_raise_1 [as="_stmt_raise_1":3]
                     │              └── body
                     │                   ├── project
                     │                   │    ├── columns: stmt_raise_2:1
                     │                   │    ├── values
                     │                   │    │    └── tuple
                     │                   │    └── projections
                     │                   │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_2:1]
                     │                   │              ├── const: 'ERROR'
                     │                   │              ├── const: '22012'
                     │                   │              ├── const: ''
                     │                   │              ├── const: ''
                     │                   │              └── const: '22012'
                     │                   └── project
                     │                        ├── columns: stmt_return_3:2!null
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── const: 0 [as=stmt_return_3:2]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f() RETURNS INT AS $$
  BEGIN
    RAISE EXCEPTION USING DETAIL = 'use default errcode for the code and message';
    return 0;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f();
----
project
 ├── columns: f:4
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:4]
           └── body
                └── limit
                     ├── columns: "_stmt_raise_1":3
                     ├── project
                     │    ├── columns: "_stmt_raise_1":3
                     │    ├── values
                     │    │    └── tuple
                     │    └── projections
                     │         └── udf: _stmt_raise_1 [as="_stmt_raise_1":3]
                     │              └── body
                     │                   ├── project
                     │                   │    ├── columns: stmt_raise_2:1
                     │                   │    ├── values
                     │                   │    │    └── tuple
                     │                   │    └── projections
                     │                   │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_2:1]
                     │                   │              ├── const: 'ERROR'
                     │                   │              ├── const: 'P0001'
                     │                   │              ├── const: 'use default errcode for the code and message'
                     │                   │              ├── const: ''
                     │                   │              └── const: 'P0001'
                     │                   └── project
                     │                        ├── columns: stmt_return_3:2!null
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── const: 0 [as=stmt_return_3:2]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f() RETURNS INT AS $$
  BEGIN
    RAISE 'foo';
    return 0;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f();
----
project
 ├── columns: f:4
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:4]
           └── body
                └── limit
                     ├── columns: "_stmt_raise_1":3
                     ├── project
                     │    ├── columns: "_stmt_raise_1":3
                     │    ├── values
                     │    │    └── tuple
                     │    └── projections
                     │         └── udf: _stmt_raise_1 [as="_stmt_raise_1":3]
                     │              └── body
                     │                   ├── project
                     │                   │    ├── columns: stmt_raise_2:1
                     │                   │    ├── values
                     │                   │    │    └── tuple
                     │                   │    └── projections
                     │                   │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_2:1]
                     │                   │              ├── const: 'ERROR'
                     │                   │              ├── const: 'foo'
                     │                   │              ├── const: ''
                     │                   │              ├── const: ''
                     │                   │              └── const: 'P0001'
                     │                   └── project
                     │                        ├── columns: stmt_return_3:2!null
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── const: 0 [as=stmt_return_3:2]
                     └── const: 1

# Testing IF statements with ELSIF branches.
exec-ddl
CREATE OR REPLACE FUNCTION f(n INT) RETURNS INT AS $$
  DECLARE
    i INT := -1;
  BEGIN
    IF n = 0 THEN
      RETURN 0;
    ELSIF n = 1 THEN
      i := 100;
    ELSIF n = 2 THEN
      i := 200;
      RETURN i;
    END IF;
    RETURN i;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(0);
----
project
 ├── columns: f:13
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:13]
           ├── args
           │    └── const: 0
           ├── params: n:1
           └── body
                └── limit
                     ├── columns: stmt_if_5:12
                     ├── project
                     │    ├── columns: stmt_if_5:12
                     │    ├── project
                     │    │    ├── columns: i:2!null
                     │    │    ├── values
                     │    │    │    └── tuple
                     │    │    └── projections
                     │    │         └── const: -1 [as=i:2]
                     │    └── projections
                     │         └── case [as=stmt_if_5:12]
                     │              ├── true
                     │              ├── when
                     │              │    ├── eq
                     │              │    │    ├── variable: n:1
                     │              │    │    └── const: 0
                     │              │    └── subquery
                     │              │         └── project
                     │              │              ├── columns: stmt_return_3:6!null
                     │              │              ├── values
                     │              │              │    └── tuple
                     │              │              └── projections
                     │              │                   └── const: 0 [as=stmt_return_3:6]
                     │              ├── when
                     │              │    ├── eq
                     │              │    │    ├── variable: n:1
                     │              │    │    └── const: 1
                     │              │    └── subquery
                     │              │         └── project
                     │              │              ├── columns: stmt_if_1:8
                     │              │              ├── project
                     │              │              │    ├── columns: i:7!null
                     │              │              │    ├── values
                     │              │              │    │    └── tuple
                     │              │              │    └── projections
                     │              │              │         └── const: 100 [as=i:7]
                     │              │              └── projections
                     │              │                   └── udf: stmt_if_1 [as=stmt_if_1:8]
                     │              │                        ├── args
                     │              │                        │    ├── variable: i:7
                     │              │                        │    └── variable: n:1
                     │              │                        ├── params: i:3 n:4
                     │              │                        └── body
                     │              │                             └── project
                     │              │                                  ├── columns: stmt_return_2:5
                     │              │                                  ├── values
                     │              │                                  │    └── tuple
                     │              │                                  └── projections
                     │              │                                       └── variable: i:3 [as=stmt_return_2:5]
                     │              ├── when
                     │              │    ├── eq
                     │              │    │    ├── variable: n:1
                     │              │    │    └── const: 2
                     │              │    └── subquery
                     │              │         └── project
                     │              │              ├── columns: stmt_return_4:10!null
                     │              │              ├── project
                     │              │              │    ├── columns: i:9!null
                     │              │              │    ├── values
                     │              │              │    │    └── tuple
                     │              │              │    └── projections
                     │              │              │         └── const: 200 [as=i:9]
                     │              │              └── projections
                     │              │                   └── variable: i:9 [as=stmt_return_4:10]
                     │              └── subquery
                     │                   └── project
                     │                        ├── columns: stmt_if_1:11
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── udf: stmt_if_1 [as=stmt_if_1:11]
                     │                                  ├── args
                     │                                  │    ├── variable: i:2
                     │                                  │    └── variable: n:1
                     │                                  ├── params: i:3 n:4
                     │                                  └── body
                     │                                       └── project
                     │                                            ├── columns: stmt_return_2:5
                     │                                            ├── values
                     │                                            │    └── tuple
                     │                                            └── projections
                     │                                                 └── variable: i:3 [as=stmt_return_2:5]
                     └── const: 1

# Testing EXCEPTION blocks.
exec-ddl
CREATE OR REPLACE FUNCTION f() RETURNS INT AS $$
  BEGIN
    RETURN 1 // 0;
  EXCEPTION
    WHEN division_by_zero THEN
      RETURN 100;
    WHEN invalid_regular_expression THEN
      RETURN 200;
    WHEN SQLSTATE '2200C' THEN
      RETURN 300;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f();
----
project
 ├── columns: f:6
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:6]
           └── body
                └── limit
                     ├── columns: exception_block_7:5
                     ├── project
                     │    ├── columns: exception_block_7:5
                     │    ├── values
                     │    │    └── tuple
                     │    └── projections
                     │         └── udf: exception_block_7 [as=exception_block_7:5]
                     │              ├── body
                     │              │    └── project
                     │              │         ├── columns: stmt_return_8:4!null
                     │              │         ├── values
                     │              │         │    └── tuple
                     │              │         └── projections
                     │              │              └── floor-div [as=stmt_return_8:4]
                     │              │                   ├── const: 1
                     │              │                   └── const: 0
                     │              └── exception-handler
                     │                   ├── SQLSTATE '22012'
                     │                   │    └── project
                     │                   │         ├── columns: stmt_return_2:1!null
                     │                   │         ├── values
                     │                   │         │    └── tuple
                     │                   │         └── projections
                     │                   │              └── const: 100 [as=stmt_return_2:1]
                     │                   ├── SQLSTATE '2201B'
                     │                   │    └── project
                     │                   │         ├── columns: stmt_return_4:2!null
                     │                   │         ├── values
                     │                   │         │    └── tuple
                     │                   │         └── projections
                     │                   │              └── const: 200 [as=stmt_return_4:2]
                     │                   └── SQLSTATE '2200C'
                     │                        └── project
                     │                             ├── columns: stmt_return_6:3!null
                     │                             ├── values
                     │                             │    └── tuple
                     │                             └── projections
                     │                                  └── const: 300 [as=stmt_return_6:3]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(i INT) RETURNS INT AS $$
  BEGIN
    IF i > 0 THEN
      RETURN 1 // 0;
    ELSE
      RETURN sqrt(i::FLOAT)::INT;
    END IF;
  EXCEPTION
    WHEN SQLSTATE '22012' OR indicator_overflow THEN
      RETURN 100;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(0);
----
project
 ├── columns: f:14
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:14]
           ├── args
           │    └── const: 0
           ├── params: i:1
           └── body
                └── limit
                     ├── columns: exception_block_3:13
                     ├── project
                     │    ├── columns: exception_block_3:13
                     │    ├── values
                     │    │    └── tuple
                     │    └── projections
                     │         └── udf: exception_block_3 [as=exception_block_3:13]
                     │              ├── args
                     │              │    └── variable: i:1
                     │              ├── params: i:4
                     │              ├── body
                     │              │    └── project
                     │              │         ├── columns: stmt_if_10:12
                     │              │         ├── values
                     │              │         │    └── tuple
                     │              │         └── projections
                     │              │              └── case [as=stmt_if_10:12]
                     │              │                   ├── true
                     │              │                   ├── when
                     │              │                   │    ├── gt
                     │              │                   │    │    ├── variable: i:4
                     │              │                   │    │    └── const: 0
                     │              │                   │    └── subquery
                     │              │                   │         └── project
                     │              │                   │              ├── columns: stmt_return_8:10!null
                     │              │                   │              ├── values
                     │              │                   │              │    └── tuple
                     │              │                   │              └── projections
                     │              │                   │                   └── floor-div [as=stmt_return_8:10]
                     │              │                   │                        ├── const: 1
                     │              │                   │                        └── const: 0
                     │              │                   └── subquery
                     │              │                        └── project
                     │              │                             ├── columns: stmt_return_9:11
                     │              │                             ├── values
                     │              │                             │    └── tuple
                     │              │                             └── projections
                     │              │                                  └── cast: INT8 [as=stmt_return_9:11]
                     │              │                                       └── function: sqrt
                     │              │                                            └── cast: FLOAT8
                     │              │                                                 └── variable: i:4
                     │              └── exception-handler
                     │                   ├── SQLSTATE '22012'
                     │                   │    └── project
                     │                   │         ├── columns: stmt_return_2:3!null
                     │                   │         ├── values
                     │                   │         │    └── tuple
                     │                   │         └── projections
                     │                   │              └── const: 100 [as=stmt_return_2:3]
                     │                   └── SQLSTATE '22022'
                     │                        └── project
                     │                             ├── columns: stmt_return_2:3!null
                     │                             ├── values
                     │                             │    └── tuple
                     │                             └── projections
                     │                                  └── const: 100 [as=stmt_return_2:3]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(i INT) RETURNS INT AS $$
  BEGIN
    IF i > 0 THEN
      RETURN 1 // 0;
    ELSE
      RETURN sqrt(i::FLOAT)::INT;
    END IF;
  EXCEPTION
    WHEN division_by_zero THEN
      RETURN 100;
    WHEN SQLSTATE '22022' THEN
      RETURN -1;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(0);
----
project
 ├── columns: f:16
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:16]
           ├── args
           │    └── const: 0
           ├── params: i:1
           └── body
                └── limit
                     ├── columns: exception_block_5:15
                     ├── project
                     │    ├── columns: exception_block_5:15
                     │    ├── values
                     │    │    └── tuple
                     │    └── projections
                     │         └── udf: exception_block_5 [as=exception_block_5:15]
                     │              ├── args
                     │              │    └── variable: i:1
                     │              ├── params: i:6
                     │              ├── body
                     │              │    └── project
                     │              │         ├── columns: stmt_if_12:14
                     │              │         ├── values
                     │              │         │    └── tuple
                     │              │         └── projections
                     │              │              └── case [as=stmt_if_12:14]
                     │              │                   ├── true
                     │              │                   ├── when
                     │              │                   │    ├── gt
                     │              │                   │    │    ├── variable: i:6
                     │              │                   │    │    └── const: 0
                     │              │                   │    └── subquery
                     │              │                   │         └── project
                     │              │                   │              ├── columns: stmt_return_10:12!null
                     │              │                   │              ├── values
                     │              │                   │              │    └── tuple
                     │              │                   │              └── projections
                     │              │                   │                   └── floor-div [as=stmt_return_10:12]
                     │              │                   │                        ├── const: 1
                     │              │                   │                        └── const: 0
                     │              │                   └── subquery
                     │              │                        └── project
                     │              │                             ├── columns: stmt_return_11:13
                     │              │                             ├── values
                     │              │                             │    └── tuple
                     │              │                             └── projections
                     │              │                                  └── cast: INT8 [as=stmt_return_11:13]
                     │              │                                       └── function: sqrt
                     │              │                                            └── cast: FLOAT8
                     │              │                                                 └── variable: i:6
                     │              └── exception-handler
                     │                   ├── SQLSTATE '22012'
                     │                   │    └── project
                     │                   │         ├── columns: stmt_return_2:3!null
                     │                   │         ├── values
                     │                   │         │    └── tuple
                     │                   │         └── projections
                     │                   │              └── const: 100 [as=stmt_return_2:3]
                     │                   └── SQLSTATE '22022'
                     │                        └── project
                     │                             ├── columns: stmt_return_4:5!null
                     │                             ├── values
                     │                             │    └── tuple
                     │                             └── projections
                     │                                  └── const: -1 [as=stmt_return_4:5]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f() RETURNS INT AS $$
  BEGIN
    RAISE division_by_zero;
    RETURN 0;
  EXCEPTION
    WHEN division_by_zero THEN
      RETURN 101;
    WHEN SQLSTATE '22P02' THEN
      RETURN 102;
    WHEN invalid_binary_representation THEN
      RETURN 103;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f();
----
project
 ├── columns: f:8
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:8]
           └── body
                └── limit
                     ├── columns: exception_block_7:7
                     ├── project
                     │    ├── columns: exception_block_7:7
                     │    ├── values
                     │    │    └── tuple
                     │    └── projections
                     │         └── udf: exception_block_7 [as=exception_block_7:7]
                     │              ├── body
                     │              │    └── project
                     │              │         ├── columns: "_stmt_raise_8":6
                     │              │         ├── values
                     │              │         │    └── tuple
                     │              │         └── projections
                     │              │              └── udf: _stmt_raise_8 [as="_stmt_raise_8":6]
                     │              │                   └── body
                     │              │                        ├── project
                     │              │                        │    ├── columns: stmt_raise_9:4
                     │              │                        │    ├── values
                     │              │                        │    │    └── tuple
                     │              │                        │    └── projections
                     │              │                        │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_9:4]
                     │              │                        │              ├── const: 'ERROR'
                     │              │                        │              ├── const: 'division_by_zero'
                     │              │                        │              ├── const: ''
                     │              │                        │              ├── const: ''
                     │              │                        │              └── const: 'division_by_zero'
                     │              │                        └── project
                     │              │                             ├── columns: stmt_return_10:5!null
                     │              │                             ├── values
                     │              │                             │    └── tuple
                     │              │                             └── projections
                     │              │                                  └── const: 0 [as=stmt_return_10:5]
                     │              └── exception-handler
                     │                   ├── SQLSTATE '22012'
                     │                   │    └── project
                     │                   │         ├── columns: stmt_return_2:1!null
                     │                   │         ├── values
                     │                   │         │    └── tuple
                     │                   │         └── projections
                     │                   │              └── const: 101 [as=stmt_return_2:1]
                     │                   ├── SQLSTATE '22P02'
                     │                   │    └── project
                     │                   │         ├── columns: stmt_return_4:2!null
                     │                   │         ├── values
                     │                   │         │    └── tuple
                     │                   │         └── projections
                     │                   │              └── const: 102 [as=stmt_return_4:2]
                     │                   └── SQLSTATE '22P03'
                     │                        └── project
                     │                             ├── columns: stmt_return_6:3!null
                     │                             ├── values
                     │                             │    └── tuple
                     │                             └── projections
                     │                                  └── const: 103 [as=stmt_return_6:3]
                     └── const: 1

# The exception block does not catch errors thrown during variable declaration.
exec-ddl
CREATE OR REPLACE FUNCTION f(n INT) RETURNS INT AS $$
  DECLARE
    i INT := 100 // n;
  BEGIN
    RETURN i;
  EXCEPTION
    WHEN division_by_zero THEN
      RETURN 101;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(0);
----
project
 ├── columns: f:10
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:10]
           ├── args
           │    └── const: 0
           ├── params: n:1
           └── body
                └── limit
                     ├── columns: exception_block_3:9
                     ├── project
                     │    ├── columns: exception_block_3:9
                     │    ├── project
                     │    │    ├── columns: i:2
                     │    │    ├── values
                     │    │    │    └── tuple
                     │    │    └── projections
                     │    │         └── floor-div [as=i:2]
                     │    │              ├── const: 100
                     │    │              └── variable: n:1
                     │    └── projections
                     │         └── udf: exception_block_3 [as=exception_block_3:9]
                     │              ├── args
                     │              │    ├── variable: i:2
                     │              │    └── variable: n:1
                     │              ├── params: i:6 n:7
                     │              ├── body
                     │              │    └── project
                     │              │         ├── columns: stmt_return_4:8
                     │              │         ├── values
                     │              │         │    └── tuple
                     │              │         └── projections
                     │              │              └── variable: i:6 [as=stmt_return_4:8]
                     │              └── exception-handler
                     │                   └── SQLSTATE '22012'
                     │                        └── project
                     │                             ├── columns: stmt_return_2:5!null
                     │                             ├── values
                     │                             │    └── tuple
                     │                             └── projections
                     │                                  └── const: 101 [as=stmt_return_2:5]
                     └── const: 1

# Each variable assignment is wrapped in an exception handler.
exec-ddl
CREATE OR REPLACE FUNCTION f(i INT, j INT, k INT) RETURNS INT AS $$
  DECLARE
    x INT := 0;
  BEGIN
    x := 1 // i;
    x := 2 // j;
    x := 3 // k;
    RETURN x;
  EXCEPTION
    WHEN division_by_zero THEN
      RETURN x;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(0, 0, 0);
----
project
 ├── columns: f:34
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:34]
           ├── args
           │    ├── const: 0
           │    ├── const: 0
           │    └── const: 0
           ├── params: i:1 j:2 k:3
           └── body
                └── limit
                     ├── columns: exception_block_3:33
                     ├── project
                     │    ├── columns: exception_block_3:33
                     │    ├── project
                     │    │    ├── columns: x:4!null
                     │    │    ├── values
                     │    │    │    └── tuple
                     │    │    └── projections
                     │    │         └── const: 0 [as=x:4]
                     │    └── projections
                     │         └── udf: exception_block_3 [as=exception_block_3:33]
                     │              ├── args
                     │              │    ├── variable: x:4
                     │              │    ├── variable: i:1
                     │              │    ├── variable: j:2
                     │              │    └── variable: k:3
                     │              ├── params: x:10 i:11 j:12 k:13
                     │              ├── body
                     │              │    └── project
                     │              │         ├── columns: assign_exception_block_4:32
                     │              │         ├── project
                     │              │         │    ├── columns: x:14
                     │              │         │    ├── values
                     │              │         │    │    └── tuple
                     │              │         │    └── projections
                     │              │         │         └── floor-div [as=x:14]
                     │              │         │              ├── const: 1
                     │              │         │              └── variable: i:11
                     │              │         └── projections
                     │              │              └── udf: assign_exception_block_4 [as=assign_exception_block_4:32]
                     │              │                   ├── args
                     │              │                   │    ├── variable: x:14
                     │              │                   │    ├── variable: i:11
                     │              │                   │    ├── variable: j:12
                     │              │                   │    └── variable: k:13
                     │              │                   ├── params: x:15 i:16 j:17 k:18
                     │              │                   └── body
                     │              │                        └── project
                     │              │                             ├── columns: assign_exception_block_5:31
                     │              │                             ├── project
                     │              │                             │    ├── columns: x:19
                     │              │                             │    ├── values
                     │              │                             │    │    └── tuple
                     │              │                             │    └── projections
                     │              │                             │         └── floor-div [as=x:19]
                     │              │                             │              ├── const: 2
                     │              │                             │              └── variable: j:17
                     │              │                             └── projections
                     │              │                                  └── udf: assign_exception_block_5 [as=assign_exception_block_5:31]
                     │              │                                       ├── args
                     │              │                                       │    ├── variable: x:19
                     │              │                                       │    ├── variable: i:16
                     │              │                                       │    ├── variable: j:17
                     │              │                                       │    └── variable: k:18
                     │              │                                       ├── params: x:20 i:21 j:22 k:23
                     │              │                                       └── body
                     │              │                                            └── project
                     │              │                                                 ├── columns: assign_exception_block_6:30
                     │              │                                                 ├── project
                     │              │                                                 │    ├── columns: x:24
                     │              │                                                 │    ├── values
                     │              │                                                 │    │    └── tuple
                     │              │                                                 │    └── projections
                     │              │                                                 │         └── floor-div [as=x:24]
                     │              │                                                 │              ├── const: 3
                     │              │                                                 │              └── variable: k:23
                     │              │                                                 └── projections
                     │              │                                                      └── udf: assign_exception_block_6 [as=assign_exception_block_6:30]
                     │              │                                                           ├── args
                     │              │                                                           │    ├── variable: x:24
                     │              │                                                           │    ├── variable: i:21
                     │              │                                                           │    ├── variable: j:22
                     │              │                                                           │    └── variable: k:23
                     │              │                                                           ├── params: x:25 i:26 j:27 k:28
                     │              │                                                           └── body
                     │              │                                                                └── project
                     │              │                                                                     ├── columns: stmt_return_7:29
                     │              │                                                                     ├── values
                     │              │                                                                     │    └── tuple
                     │              │                                                                     └── projections
                     │              │                                                                          └── variable: x:25 [as=stmt_return_7:29]
                     │              └── exception-handler
                     │                   └── SQLSTATE '22012'
                     │                        └── project
                     │                             ├── columns: stmt_return_2:9
                     │                             ├── values
                     │                             │    └── tuple
                     │                             └── projections
                     │                                  └── variable: x:5 [as=stmt_return_2:9]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(i INT) RETURNS INT AS $$
  DECLARE
    x INT;
  BEGIN
    IF i = 0 THEN
      x := 100;
      RAISE division_by_zero;
    ELSE
      x := 200;
      RAISE division_by_zero;
    END IF;
    RETURN 0;
  EXCEPTION
    WHEN division_by_zero THEN
      RETURN x;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(0);
----
project
 ├── columns: f:31
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:31]
           ├── args
           │    └── const: 0
           ├── params: i:1
           └── body
                └── limit
                     ├── columns: exception_block_3:30
                     ├── project
                     │    ├── columns: exception_block_3:30
                     │    ├── project
                     │    │    ├── columns: x:2
                     │    │    ├── values
                     │    │    │    └── tuple
                     │    │    └── projections
                     │    │         └── cast: INT8 [as=x:2]
                     │    │              └── null
                     │    └── projections
                     │         └── udf: exception_block_3 [as=exception_block_3:30]
                     │              ├── args
                     │              │    ├── variable: x:2
                     │              │    └── variable: i:1
                     │              ├── params: x:6 i:7
                     │              ├── body
                     │              │    └── project
                     │              │         ├── columns: stmt_if_12:29
                     │              │         ├── values
                     │              │         │    └── tuple
                     │              │         └── projections
                     │              │              └── case [as=stmt_if_12:29]
                     │              │                   ├── true
                     │              │                   ├── when
                     │              │                   │    ├── eq
                     │              │                   │    │    ├── variable: i:7
                     │              │                   │    │    └── const: 0
                     │              │                   │    └── subquery
                     │              │                   │         └── project
                     │              │                   │              ├── columns: assign_exception_block_6:19
                     │              │                   │              ├── project
                     │              │                   │              │    ├── columns: x:11!null
                     │              │                   │              │    ├── values
                     │              │                   │              │    │    └── tuple
                     │              │                   │              │    └── projections
                     │              │                   │              │         └── const: 100 [as=x:11]
                     │              │                   │              └── projections
                     │              │                   │                   └── udf: assign_exception_block_6 [as=assign_exception_block_6:19]
                     │              │                   │                        ├── args
                     │              │                   │                        │    ├── variable: x:11
                     │              │                   │                        │    └── variable: i:7
                     │              │                   │                        ├── params: x:12 i:13
                     │              │                   │                        └── body
                     │              │                   │                             └── project
                     │              │                   │                                  ├── columns: "_stmt_raise_7":18
                     │              │                   │                                  ├── values
                     │              │                   │                                  │    └── tuple
                     │              │                   │                                  └── projections
                     │              │                   │                                       └── udf: _stmt_raise_7 [as="_stmt_raise_7":18]
                     │              │                   │                                            ├── args
                     │              │                   │                                            │    ├── variable: x:12
                     │              │                   │                                            │    └── variable: i:13
                     │              │                   │                                            ├── params: x:14 i:15
                     │              │                   │                                            └── body
                     │              │                   │                                                 ├── project
                     │              │                   │                                                 │    ├── columns: stmt_raise_8:16
                     │              │                   │                                                 │    ├── values
                     │              │                   │                                                 │    │    └── tuple
                     │              │                   │                                                 │    └── projections
                     │              │                   │                                                 │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_8:16]
                     │              │                   │                                                 │              ├── const: 'ERROR'
                     │              │                   │                                                 │              ├── const: 'division_by_zero'
                     │              │                   │                                                 │              ├── const: ''
                     │              │                   │                                                 │              ├── const: ''
                     │              │                   │                                                 │              └── const: 'division_by_zero'
                     │              │                   │                                                 └── project
                     │              │                   │                                                      ├── columns: stmt_if_4:17
                     │              │                   │                                                      ├── values
                     │              │                   │                                                      │    └── tuple
                     │              │                   │                                                      └── projections
                     │              │                   │                                                           └── udf: stmt_if_4 [as=stmt_if_4:17]
                     │              │                   │                                                                ├── args
                     │              │                   │                                                                │    ├── variable: x:14
                     │              │                   │                                                                │    └── variable: i:15
                     │              │                   │                                                                ├── params: x:8 i:9
                     │              │                   │                                                                └── body
                     │              │                   │                                                                     └── project
                     │              │                   │                                                                          ├── columns: stmt_return_5:10!null
                     │              │                   │                                                                          ├── values
                     │              │                   │                                                                          │    └── tuple
                     │              │                   │                                                                          └── projections
                     │              │                   │                                                                               └── const: 0 [as=stmt_return_5:10]
                     │              │                   └── subquery
                     │              │                        └── project
                     │              │                             ├── columns: assign_exception_block_9:28
                     │              │                             ├── project
                     │              │                             │    ├── columns: x:20!null
                     │              │                             │    ├── values
                     │              │                             │    │    └── tuple
                     │              │                             │    └── projections
                     │              │                             │         └── const: 200 [as=x:20]
                     │              │                             └── projections
                     │              │                                  └── udf: assign_exception_block_9 [as=assign_exception_block_9:28]
                     │              │                                       ├── args
                     │              │                                       │    ├── variable: x:20
                     │              │                                       │    └── variable: i:7
                     │              │                                       ├── params: x:21 i:22
                     │              │                                       └── body
                     │              │                                            └── project
                     │              │                                                 ├── columns: "_stmt_raise_10":27
                     │              │                                                 ├── values
                     │              │                                                 │    └── tuple
                     │              │                                                 └── projections
                     │              │                                                      └── udf: _stmt_raise_10 [as="_stmt_raise_10":27]
                     │              │                                                           ├── args
                     │              │                                                           │    ├── variable: x:21
                     │              │                                                           │    └── variable: i:22
                     │              │                                                           ├── params: x:23 i:24
                     │              │                                                           └── body
                     │              │                                                                ├── project
                     │              │                                                                │    ├── columns: stmt_raise_11:25
                     │              │                                                                │    ├── values
                     │              │                                                                │    │    └── tuple
                     │              │                                                                │    └── projections
                     │              │                                                                │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_11:25]
                     │              │                                                                │              ├── const: 'ERROR'
                     │              │                                                                │              ├── const: 'division_by_zero'
                     │              │                                                                │              ├── const: ''
                     │              │                                                                │              ├── const: ''
                     │              │                                                                │              └── const: 'division_by_zero'
                     │              │                                                                └── project
                     │              │                                                                     ├── columns: stmt_if_4:26
                     │              │                                                                     ├── values
                     │              │                                                                     │    └── tuple
                     │              │                                                                     └── projections
                     │              │                                                                          └── udf: stmt_if_4 [as=stmt_if_4:26]
                     │              │                                                                               ├── args
                     │              │                                                                               │    ├── variable: x:23
                     │              │                                                                               │    └── variable: i:24
                     │              │                                                                               ├── params: x:8 i:9
                     │              │                                                                               └── body
                     │              │                                                                                    └── project
                     │              │                                                                                         ├── columns: stmt_return_5:10!null
                     │              │                                                                                         ├── values
                     │              │                                                                                         │    └── tuple
                     │              │                                                                                         └── projections
                     │              │                                                                                              └── const: 0 [as=stmt_return_5:10]
                     │              └── exception-handler
                     │                   └── SQLSTATE '22012'
                     │                        └── project
                     │                             ├── columns: stmt_return_2:5
                     │                             ├── values
                     │                             │    └── tuple
                     │                             └── projections
                     │                                  └── variable: x:3 [as=stmt_return_2:5]
                     └── const: 1

exec-ddl
CREATE OR REPLACE FUNCTION f(n INT, a INT) RETURNS INT AS $$
  DECLARE
    x INT;
    i INT := 0;
  BEGIN
    LOOP IF i >= n THEN EXIT; END IF;
      x := 1 // (i - a);
      i := i + 1;
    END LOOP;
    RETURN -1;
  EXCEPTION
    WHEN division_by_zero THEN
      RETURN i;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f(0, 0);
----
project
 ├── columns: f:45
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:45]
           ├── args
           │    ├── const: 0
           │    └── const: 0
           ├── params: n:1 a:2
           └── body
                └── limit
                     ├── columns: exception_block_3:44
                     ├── project
                     │    ├── columns: exception_block_3:44
                     │    ├── project
                     │    │    ├── columns: i:4!null x:3
                     │    │    ├── project
                     │    │    │    ├── columns: x:3
                     │    │    │    ├── values
                     │    │    │    │    └── tuple
                     │    │    │    └── projections
                     │    │    │         └── cast: INT8 [as=x:3]
                     │    │    │              └── null
                     │    │    └── projections
                     │    │         └── const: 0 [as=i:4]
                     │    └── projections
                     │         └── udf: exception_block_3 [as=exception_block_3:44]
                     │              ├── args
                     │              │    ├── variable: x:3
                     │              │    ├── variable: i:4
                     │              │    ├── variable: n:1
                     │              │    └── variable: a:2
                     │              ├── params: x:10 i:11 n:12 a:13
                     │              ├── body
                     │              │    └── project
                     │              │         ├── columns: stmt_loop_6:43
                     │              │         ├── values
                     │              │         │    └── tuple
                     │              │         └── projections
                     │              │              └── udf: stmt_loop_6 [as=stmt_loop_6:43]
                     │              │                   ├── args
                     │              │                   │    ├── variable: x:10
                     │              │                   │    ├── variable: i:11
                     │              │                   │    ├── variable: n:12
                     │              │                   │    └── variable: a:13
                     │              │                   ├── params: x:19 i:20 n:21 a:22
                     │              │                   └── body
                     │              │                        └── project
                     │              │                             ├── columns: stmt_if_10:42
                     │              │                             ├── values
                     │              │                             │    └── tuple
                     │              │                             └── projections
                     │              │                                  └── case [as=stmt_if_10:42]
                     │              │                                       ├── true
                     │              │                                       ├── when
                     │              │                                       │    ├── ge
                     │              │                                       │    │    ├── variable: i:20
                     │              │                                       │    │    └── variable: n:21
                     │              │                                       │    └── subquery
                     │              │                                       │         └── project
                     │              │                                       │              ├── columns: loop_exit_4:40
                     │              │                                       │              ├── values
                     │              │                                       │              │    └── tuple
                     │              │                                       │              └── projections
                     │              │                                       │                   └── udf: loop_exit_4 [as=loop_exit_4:40]
                     │              │                                       │                        ├── args
                     │              │                                       │                        │    ├── variable: x:19
                     │              │                                       │                        │    ├── variable: i:20
                     │              │                                       │                        │    ├── variable: n:21
                     │              │                                       │                        │    └── variable: a:22
                     │              │                                       │                        ├── params: x:14 i:15 n:16 a:17
                     │              │                                       │                        └── body
                     │              │                                       │                             └── project
                     │              │                                       │                                  ├── columns: stmt_return_5:18!null
                     │              │                                       │                                  ├── values
                     │              │                                       │                                  │    └── tuple
                     │              │                                       │                                  └── projections
                     │              │                                       │                                       └── const: -1 [as=stmt_return_5:18]
                     │              │                                       └── subquery
                     │              │                                            └── project
                     │              │                                                 ├── columns: stmt_if_7:41
                     │              │                                                 ├── values
                     │              │                                                 │    └── tuple
                     │              │                                                 └── projections
                     │              │                                                      └── udf: stmt_if_7 [as=stmt_if_7:41]
                     │              │                                                           ├── args
                     │              │                                                           │    ├── variable: x:19
                     │              │                                                           │    ├── variable: i:20
                     │              │                                                           │    ├── variable: n:21
                     │              │                                                           │    └── variable: a:22
                     │              │                                                           ├── params: x:23 i:24 n:25 a:26
                     │              │                                                           └── body
                     │              │                                                                └── project
                     │              │                                                                     ├── columns: assign_exception_block_8:39
                     │              │                                                                     ├── project
                     │              │                                                                     │    ├── columns: x:27
                     │              │                                                                     │    ├── values
                     │              │                                                                     │    │    └── tuple
                     │              │                                                                     │    └── projections
                     │              │                                                                     │         └── floor-div [as=x:27]
                     │              │                                                                     │              ├── const: 1
                     │              │                                                                     │              └── minus
                     │              │                                                                     │                   ├── variable: i:24
                     │              │                                                                     │                   └── variable: a:26
                     │              │                                                                     └── projections
                     │              │                                                                          └── udf: assign_exception_block_8 [as=assign_exception_block_8:39]
                     │              │                                                                               ├── args
                     │              │                                                                               │    ├── variable: x:27
                     │              │                                                                               │    ├── variable: i:24
                     │              │                                                                               │    ├── variable: n:25
                     │              │                                                                               │    └── variable: a:26
                     │              │                                                                               ├── params: x:28 i:29 n:30 a:31
                     │              │                                                                               └── body
                     │              │                                                                                    └── project
                     │              │                                                                                         ├── columns: assign_exception_block_9:38
                     │              │                                                                                         ├── project
                     │              │                                                                                         │    ├── columns: i:32
                     │              │                                                                                         │    ├── values
                     │              │                                                                                         │    │    └── tuple
                     │              │                                                                                         │    └── projections
                     │              │                                                                                         │         └── plus [as=i:32]
                     │              │                                                                                         │              ├── variable: i:29
                     │              │                                                                                         │              └── const: 1
                     │              │                                                                                         └── projections
                     │              │                                                                                              └── udf: assign_exception_block_9 [as=assign_exception_block_9:38]
                     │              │                                                                                                   ├── args
                     │              │                                                                                                   │    ├── variable: x:28
                     │              │                                                                                                   │    ├── variable: i:32
                     │              │                                                                                                   │    ├── variable: n:30
                     │              │                                                                                                   │    └── variable: a:31
                     │              │                                                                                                   ├── params: x:33 i:34 n:35 a:36
                     │              │                                                                                                   └── body
                     │              │                                                                                                        └── project
                     │              │                                                                                                             ├── columns: stmt_loop_6:37
                     │              │                                                                                                             ├── values
                     │              │                                                                                                             │    └── tuple
                     │              │                                                                                                             └── projections
                     │              │                                                                                                                  └── udf: stmt_loop_6 [as=stmt_loop_6:37]
                     │              │                                                                                                                       ├── args
                     │              │                                                                                                                       │    ├── variable: x:33
                     │              │                                                                                                                       │    ├── variable: i:34
                     │              │                                                                                                                       │    ├── variable: n:35
                     │              │                                                                                                                       │    └── variable: a:36
                     │              │                                                                                                                       └── recursive-call
                     │              └── exception-handler
                     │                   └── SQLSTATE '22012'
                     │                        └── project
                     │                             ├── columns: stmt_return_2:9
                     │                             ├── values
                     │                             │    └── tuple
                     │                             └── projections
                     │                                  └── variable: i:6 [as=stmt_return_2:9]
                     └── const: 1

# Testing SQL statement execution.
exec-ddl
CREATE OR REPLACE FUNCTION f() RETURNS INT AS $$
  BEGIN
    INSERT INTO kv VALUES (100, 100);
    DELETE FROM kv WHERE k = 100;
    INSERT INTO kv VALUES (100, 100);
    RETURN (SELECT v FROM kv WHERE k = 100);
  END
$$ LANGUAGE PLpgSQL;
----

# TODO(drewk): add norm rule to fold the non-output body statements of nested
# routines.
build format=show-scalars
SELECT f();
----
project
 ├── columns: f:29
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:29]
           └── body
                └── limit
                     ├── columns: "_stmt_exec_1":28
                     ├── project
                     │    ├── columns: "_stmt_exec_1":28
                     │    ├── values
                     │    │    └── tuple
                     │    └── projections
                     │         └── udf: _stmt_exec_1 [as="_stmt_exec_1":28]
                     │              └── body
                     │                   ├── insert kv
                     │                   │    ├── columns: <none>
                     │                   │    ├── insert-mapping:
                     │                   │    │    ├── column1:5 => k:1
                     │                   │    │    └── column2:6 => v:2
                     │                   │    └── values
                     │                   │         ├── columns: column1:5!null column2:6!null
                     │                   │         └── tuple
                     │                   │              ├── const: 100
                     │                   │              └── const: 100
                     │                   └── project
                     │                        ├── columns: "_stmt_exec_2":27
                     │                        ├── values
                     │                        │    └── tuple
                     │                        └── projections
                     │                             └── udf: _stmt_exec_2 [as="_stmt_exec_2":27]
                     │                                  └── body
                     │                                       ├── delete kv
                     │                                       │    ├── columns: <none>
                     │                                       │    ├── fetch columns: k:11 v:12
                     │                                       │    └── select
                     │                                       │         ├── columns: k:11!null v:12 crdb_internal_mvcc_timestamp:13 tableoid:14
                     │                                       │         ├── scan kv
                     │                                       │         │    └── columns: k:11!null v:12 crdb_internal_mvcc_timestamp:13 tableoid:14
                     │                                       │         └── filters
                     │                                       │              └── eq
                     │                                       │                   ├── variable: k:11
                     │                                       │                   └── const: 100
                     │                                       └── project
                     │                                            ├── columns: "_stmt_exec_3":26
                     │                                            ├── values
                     │                                            │    └── tuple
                     │                                            └── projections
                     │                                                 └── udf: _stmt_exec_3 [as="_stmt_exec_3":26]
                     │                                                      └── body
                     │                                                           ├── insert kv
                     │                                                           │    ├── columns: <none>
                     │                                                           │    ├── insert-mapping:
                     │                                                           │    │    ├── column1:19 => k:15
                     │                                                           │    │    └── column2:20 => v:16
                     │                                                           │    └── values
                     │                                                           │         ├── columns: column1:19!null column2:20!null
                     │                                                           │         └── tuple
                     │                                                           │              ├── const: 100
                     │                                                           │              └── const: 100
                     │                                                           └── project
                     │                                                                ├── columns: stmt_return_4:25
                     │                                                                ├── values
                     │                                                                │    └── tuple
                     │                                                                └── projections
                     │                                                                     └── subquery [as=stmt_return_4:25]
                     │                                                                          └── max1-row
                     │                                                                               ├── columns: v:22
                     │                                                                               └── project
                     │                                                                                    ├── columns: v:22
                     │                                                                                    └── select
                     │                                                                                         ├── columns: k:21!null v:22 crdb_internal_mvcc_timestamp:23 tableoid:24
                     │                                                                                         ├── scan kv
                     │                                                                                         │    └── columns: k:21!null v:22 crdb_internal_mvcc_timestamp:23 tableoid:24
                     │                                                                                         └── filters
                     │                                                                                              └── eq
                     │                                                                                                   ├── variable: k:21
                     │                                                                                                   └── const: 100
                     └── const: 1

# Testing SELECT INTO.
exec-ddl
CREATE OR REPLACE FUNCTION f() RETURNS INT AS $$
  DECLARE
    i INT;
    j INT;
  BEGIN
    SELECT x, y INTO i, j FROM xy ORDER BY x DESC;
    RETURN i + j;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f();
----
project
 ├── columns: f:17
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:17]
           └── body
                └── limit
                     ├── columns: "_stmt_exec_1":16
                     ├── project
                     │    ├── columns: "_stmt_exec_1":16
                     │    ├── project
                     │    │    ├── columns: j:2 i:1
                     │    │    ├── project
                     │    │    │    ├── columns: i:1
                     │    │    │    ├── values
                     │    │    │    │    └── tuple
                     │    │    │    └── projections
                     │    │    │         └── cast: INT8 [as=i:1]
                     │    │    │              └── null
                     │    │    └── projections
                     │    │         └── cast: INT8 [as=j:2]
                     │    │              └── null
                     │    └── projections
                     │         └── udf: _stmt_exec_1 [as="_stmt_exec_1":16]
                     │              ├── args
                     │              │    ├── variable: i:1
                     │              │    └── variable: j:2
                     │              ├── params: i:3 j:4
                     │              └── body
                     │                   └── project
                     │                        ├── columns: "_stmt_exec_ret_2":15
                     │                        ├── project
                     │                        │    ├── columns: i:13 j:14
                     │                        │    ├── limit
                     │                        │    │    ├── columns: x:5 y:6
                     │                        │    │    ├── internal-ordering: -5
                     │                        │    │    ├── project
                     │                        │    │    │    ├── columns: x:5 y:6
                     │                        │    │    │    └── scan xy
                     │                        │    │    │         └── columns: x:5 y:6 rowid:7!null crdb_internal_mvcc_timestamp:8 tableoid:9
                     │                        │    │    └── const: 1
                     │                        │    └── projections
                     │                        │         ├── variable: x:5 [as=i:13]
                     │                        │         └── variable: y:6 [as=j:14]
                     │                        └── projections
                     │                             └── udf: _stmt_exec_ret_2 [as="_stmt_exec_ret_2":15]
                     │                                  ├── args
                     │                                  │    ├── variable: i:13
                     │                                  │    └── variable: j:14
                     │                                  ├── params: i:10 j:11
                     │                                  └── body
                     │                                       └── project
                     │                                            ├── columns: stmt_return_3:12
                     │                                            ├── values
                     │                                            │    └── tuple
                     │                                            └── projections
                     │                                                 └── plus [as=stmt_return_3:12]
                     │                                                      ├── variable: i:10
                     │                                                      └── variable: j:11
                     └── const: 1

# It is possible to reference a previous value of a target variable in a
# SELECT INTO statement (note the "x < i" filter).
exec-ddl
CREATE OR REPLACE FUNCTION f() RETURNS INT AS $$
  DECLARE
    i INT;
  BEGIN
    SELECT x INTO i FROM xy ORDER BY x DESC;
    RAISE NOTICE 'i = %', i;
    SELECT x INTO i FROM xy WHERE x < i ORDER BY x DESC;
    RAISE NOTICE 'i = %', i;
    RETURN 0;
  END
$$ LANGUAGE PLpgSQL;
----

build format=show-scalars
SELECT f();
----
project
 ├── columns: f:29
 ├── values
 │    └── tuple
 └── projections
      └── udf: f [as=f:29]
           └── body
                └── limit
                     ├── columns: "_stmt_exec_1":28
                     ├── project
                     │    ├── columns: "_stmt_exec_1":28
                     │    ├── project
                     │    │    ├── columns: i:1
                     │    │    ├── values
                     │    │    │    └── tuple
                     │    │    └── projections
                     │    │         └── cast: INT8 [as=i:1]
                     │    │              └── null
                     │    └── projections
                     │         └── udf: _stmt_exec_1 [as="_stmt_exec_1":28]
                     │              ├── args
                     │              │    └── variable: i:1
                     │              ├── params: i:2
                     │              └── body
                     │                   └── project
                     │                        ├── columns: "_stmt_exec_ret_2":27
                     │                        ├── project
                     │                        │    ├── columns: i:26
                     │                        │    ├── limit
                     │                        │    │    ├── columns: x:3
                     │                        │    │    ├── internal-ordering: -3
                     │                        │    │    ├── project
                     │                        │    │    │    ├── columns: x:3
                     │                        │    │    │    └── scan xy
                     │                        │    │    │         └── columns: x:3 y:4 rowid:5!null crdb_internal_mvcc_timestamp:6 tableoid:7
                     │                        │    │    └── const: 1
                     │                        │    └── projections
                     │                        │         └── variable: x:3 [as=i:26]
                     │                        └── projections
                     │                             └── udf: _stmt_exec_ret_2 [as="_stmt_exec_ret_2":27]
                     │                                  ├── args
                     │                                  │    └── variable: i:26
                     │                                  ├── params: i:8
                     │                                  └── body
                     │                                       └── project
                     │                                            ├── columns: "_stmt_raise_3":25
                     │                                            ├── values
                     │                                            │    └── tuple
                     │                                            └── projections
                     │                                                 └── udf: _stmt_raise_3 [as="_stmt_raise_3":25]
                     │                                                      ├── args
                     │                                                      │    └── variable: i:8
                     │                                                      ├── params: i:9
                     │                                                      └── body
                     │                                                           ├── project
                     │                                                           │    ├── columns: stmt_raise_4:10
                     │                                                           │    ├── values
                     │                                                           │    │    └── tuple
                     │                                                           │    └── projections
                     │                                                           │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_4:10]
                     │                                                           │              ├── const: 'NOTICE'
                     │                                                           │              ├── concat
                     │                                                           │              │    ├── concat
                     │                                                           │              │    │    ├── const: 'i = '
                     │                                                           │              │    │    └── coalesce
                     │                                                           │              │    │         ├── variable: i:9
                     │                                                           │              │    │         └── const: '<NULL>'
                     │                                                           │              │    └── const: ''
                     │                                                           │              ├── const: ''
                     │                                                           │              ├── const: ''
                     │                                                           │              └── const: '00000'
                     │                                                           └── project
                     │                                                                ├── columns: "_stmt_exec_5":24
                     │                                                                ├── values
                     │                                                                │    └── tuple
                     │                                                                └── projections
                     │                                                                     └── udf: _stmt_exec_5 [as="_stmt_exec_5":24]
                     │                                                                          ├── args
                     │                                                                          │    └── variable: i:9
                     │                                                                          ├── params: i:11
                     │                                                                          └── body
                     │                                                                               └── project
                     │                                                                                    ├── columns: "_stmt_exec_ret_6":23
                     │                                                                                    ├── project
                     │                                                                                    │    ├── columns: i:22!null
                     │                                                                                    │    ├── limit
                     │                                                                                    │    │    ├── columns: x:12!null
                     │                                                                                    │    │    ├── internal-ordering: -12
                     │                                                                                    │    │    ├── project
                     │                                                                                    │    │    │    ├── columns: x:12!null
                     │                                                                                    │    │    │    └── select
                     │                                                                                    │    │    │         ├── columns: x:12!null y:13 rowid:14!null crdb_internal_mvcc_timestamp:15 tableoid:16
                     │                                                                                    │    │    │         ├── scan xy
                     │                                                                                    │    │    │         │    └── columns: x:12 y:13 rowid:14!null crdb_internal_mvcc_timestamp:15 tableoid:16
                     │                                                                                    │    │    │         └── filters
                     │                                                                                    │    │    │              └── lt
                     │                                                                                    │    │    │                   ├── variable: x:12
                     │                                                                                    │    │    │                   └── variable: i:11
                     │                                                                                    │    │    └── const: 1
                     │                                                                                    │    └── projections
                     │                                                                                    │         └── variable: x:12 [as=i:22]
                     │                                                                                    └── projections
                     │                                                                                         └── udf: _stmt_exec_ret_6 [as="_stmt_exec_ret_6":23]
                     │                                                                                              ├── args
                     │                                                                                              │    └── variable: i:22
                     │                                                                                              ├── params: i:17
                     │                                                                                              └── body
                     │                                                                                                   └── project
                     │                                                                                                        ├── columns: "_stmt_raise_7":21
                     │                                                                                                        ├── values
                     │                                                                                                        │    └── tuple
                     │                                                                                                        └── projections
                     │                                                                                                             └── udf: _stmt_raise_7 [as="_stmt_raise_7":21]
                     │                                                                                                                  ├── args
                     │                                                                                                                  │    └── variable: i:17
                     │                                                                                                                  ├── params: i:18
                     │                                                                                                                  └── body
                     │                                                                                                                       ├── project
                     │                                                                                                                       │    ├── columns: stmt_raise_8:19
                     │                                                                                                                       │    ├── values
                     │                                                                                                                       │    │    └── tuple
                     │                                                                                                                       │    └── projections
                     │                                                                                                                       │         └── function: crdb_internal.plpgsql_raise [as=stmt_raise_8:19]
                     │                                                                                                                       │              ├── const: 'NOTICE'
                     │                                                                                                                       │              ├── concat
                     │                                                                                                                       │              │    ├── concat
                     │                                                                                                                       │              │    │    ├── const: 'i = '
                     │                                                                                                                       │              │    │    └── coalesce
                     │                                                                                                                       │              │    │         ├── variable: i:18
                     │                                                                                                                       │              │    │         └── const: '<NULL>'
                     │                                                                                                                       │              │    └── const: ''
                     │                                                                                                                       │              ├── const: ''
                     │                                                                                                                       │              ├── const: ''
                     │                                                                                                                       │              └── const: '00000'
                     │                                                                                                                       └── project
                     │                                                                                                                            ├── columns: stmt_return_9:20!null
                     │                                                                                                                            ├── values
                     │                                                                                                                            │    └── tuple
                     │                                                                                                                            └── projections
                     │                                                                                                                                 └── const: 0 [as=stmt_return_9:20]
                     └── const: 1
