exec-ddl
CREATE TABLE t (x INT PRIMARY KEY, a INT, v VECTOR(3), w VECTOR(2), VECTOR INDEX (v));
----

exec-ddl
CREATE TABLE t_multi (
  x INT,
  y INT,
  a INT,
  b INT,
  c INT,
  v VECTOR (3),
  PRIMARY KEY (x, y),
  VECTOR INDEX (a, b, v)
);
----

build
INSERT INTO t VALUES (1, 1, '[1,2,3]'), (2, 2, '[4,5,6]');
----
insert t
 ├── columns: <none>
 ├── insert-mapping:
 │    ├── column1:7 => x:1
 │    ├── column2:8 => a:2
 │    ├── v_cast:10 => v:3
 │    └── w_default:11 => w:4
 ├── vector index put partition columns: vector_index_put_partition1:12
 ├── vector index put quantized vector columns: vector_index_put_quantized_vec1:13
 └── vector-mutation-search t@t_v_idx,vector
      ├── columns: column1:7!null column2:8!null v_cast:10!null w_default:11 vector_index_put_partition1:12 vector_index_put_quantized_vec1:13
      ├── index put
      ├── query vector column: v_cast:10
      ├── partition col: vector_index_put_partition1:12
      ├── quantized vector col: vector_index_put_quantized_vec1:13
      └── project
           ├── columns: w_default:11 column1:7!null column2:8!null v_cast:10!null
           ├── project
           │    ├── columns: v_cast:10!null column1:7!null column2:8!null
           │    ├── values
           │    │    ├── columns: column1:7!null column2:8!null column3:9!null
           │    │    ├── (1, 1, '[1,2,3]')
           │    │    └── (2, 2, '[4,5,6]')
           │    └── projections
           │         └── assignment-cast: VECTOR(3) [as=v_cast:10]
           │              └── column3:9
           └── projections
                └── NULL::VECTOR(2) [as=w_default:11]

build
UPDATE t SET v = '[4,5,6]' WHERE x = 1;
----
update t
 ├── columns: <none>
 ├── fetch columns: x:7 a:8 v:9 w:10
 ├── update-mapping:
 │    └── v_cast:14 => v:3
 ├── vector index del partition columns: vector_index_del_partition1:15
 ├── vector index put partition columns: vector_index_put_partition1:16
 ├── vector index put quantized vector columns: vector_index_put_quantized_vec1:17
 └── vector-mutation-search t@t_v_idx,vector
      ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12 v_cast:14!null vector_index_del_partition1:15 vector_index_put_partition1:16 vector_index_put_quantized_vec1:17
      ├── index put
      ├── query vector column: v_cast:14
      ├── partition col: vector_index_put_partition1:16
      ├── quantized vector col: vector_index_put_quantized_vec1:17
      └── vector-mutation-search t@t_v_idx,vector
           ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12 v_cast:14!null vector_index_del_partition1:15
           ├── index del
           ├── query vector column: v:9
           ├── suffix key columns: [7]
           ├── partition col: vector_index_del_partition1:15
           └── project
                ├── columns: v_cast:14!null x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
                ├── project
                │    ├── columns: v_new:13!null x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
                │    ├── select
                │    │    ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
                │    │    ├── scan t
                │    │    │    ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
                │    │    │    └── flags: avoid-full-scan
                │    │    └── filters
                │    │         └── x:7 = 1
                │    └── projections
                │         └── '[4,5,6]' [as=v_new:13]
                └── projections
                     └── assignment-cast: VECTOR(3) [as=v_cast:14]
                          └── v_new:13

# Index entries must be updated if *any* column from the index is modified, not
# just the vector column.
build
UPDATE t SET x = 3 WHERE x = 1;
----
update t
 ├── columns: <none>
 ├── fetch columns: x:7 a:8 v:9 w:10
 ├── update-mapping:
 │    └── x_new:13 => x:1
 ├── vector index del partition columns: vector_index_del_partition1:14
 ├── vector index put partition columns: vector_index_put_partition1:15
 ├── vector index put quantized vector columns: vector_index_put_quantized_vec1:16
 └── vector-mutation-search t@t_v_idx,vector
      ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12 x_new:13!null vector_index_del_partition1:14 vector_index_put_partition1:15 vector_index_put_quantized_vec1:16
      ├── index put
      ├── query vector column: v:9
      ├── partition col: vector_index_put_partition1:15
      ├── quantized vector col: vector_index_put_quantized_vec1:16
      └── vector-mutation-search t@t_v_idx,vector
           ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12 x_new:13!null vector_index_del_partition1:14
           ├── index del
           ├── query vector column: v:9
           ├── suffix key columns: [7]
           ├── partition col: vector_index_del_partition1:14
           └── project
                ├── columns: x_new:13!null x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
                ├── select
                │    ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
                │    ├── scan t
                │    │    ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
                │    │    └── flags: avoid-full-scan
                │    └── filters
                │         └── x:7 = 1
                └── projections
                     └── 3 [as=x_new:13]

# Case with a non-indexed column modified.
build
UPDATE t SET a = 1 WHERE x = 3;
----
update t
 ├── columns: <none>
 ├── fetch columns: x:7 a:8 v:9 w:10
 ├── update-mapping:
 │    └── a_new:13 => a:2
 └── project
      ├── columns: a_new:13!null x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
      ├── select
      │    ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
      │    ├── scan t
      │    │    ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
      │    │    └── flags: avoid-full-scan
      │    └── filters
      │         └── x:7 = 3
      └── projections
           └── 1 [as=a_new:13]

build
DELETE FROM t WHERE x = 1;
----
delete t
 ├── columns: <none>
 ├── fetch columns: x:7 a:8 v:9 w:10
 ├── vector index del partition columns: vector_index_del_partition1:13
 └── vector-mutation-search t@t_v_idx,vector
      ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12 vector_index_del_partition1:13
      ├── index del
      ├── query vector column: v:9
      ├── suffix key columns: [7]
      ├── partition col: vector_index_del_partition1:13
      └── select
           ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
           ├── scan t
           │    ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
           │    └── flags: avoid-full-scan
           └── filters
                └── x:7 = 1

build
UPSERT INTO t VALUES (1, 1, '[1,2,3]'), (2, 2, '[4,5,6]');
----
upsert t
 ├── arbiter indexes: t_pkey
 ├── columns: <none>
 ├── canary column: x:12
 ├── fetch columns: x:12 a:13 v:14 w:15
 ├── insert-mapping:
 │    ├── column1:7 => x:1
 │    ├── column2:8 => a:2
 │    ├── v_cast:10 => v:3
 │    └── w_default:11 => w:4
 ├── update-mapping:
 │    ├── column2:8 => a:2
 │    ├── v_cast:10 => v:3
 │    └── w_default:11 => w:4
 ├── vector index del partition columns: vector_index_del_partition1:19
 ├── vector index put partition columns: vector_index_put_partition1:20
 ├── vector index put quantized vector columns: vector_index_put_quantized_vec1:21
 └── vector-mutation-search t@t_v_idx,vector
      ├── columns: column1:7!null column2:8!null v_cast:10!null w_default:11 x:12 a:13 v:14 w:15 crdb_internal_mvcc_timestamp:16 tableoid:17 upsert_x:18 vector_index_del_partition1:19 vector_index_put_partition1:20 vector_index_put_quantized_vec1:21
      ├── index put
      ├── query vector column: v_cast:10
      ├── partition col: vector_index_put_partition1:20
      ├── quantized vector col: vector_index_put_quantized_vec1:21
      └── vector-mutation-search t@t_v_idx,vector
           ├── columns: column1:7!null column2:8!null v_cast:10!null w_default:11 x:12 a:13 v:14 w:15 crdb_internal_mvcc_timestamp:16 tableoid:17 upsert_x:18 vector_index_del_partition1:19
           ├── index del
           ├── query vector column: v:14
           ├── suffix key columns: [12]
           ├── partition col: vector_index_del_partition1:19
           └── project
                ├── columns: upsert_x:18 column1:7!null column2:8!null v_cast:10!null w_default:11 x:12 a:13 v:14 w:15 crdb_internal_mvcc_timestamp:16 tableoid:17
                ├── left-join (hash)
                │    ├── columns: column1:7!null column2:8!null v_cast:10!null w_default:11 x:12 a:13 v:14 w:15 crdb_internal_mvcc_timestamp:16 tableoid:17
                │    ├── ensure-upsert-distinct-on
                │    │    ├── columns: column1:7!null column2:8!null v_cast:10!null w_default:11
                │    │    ├── grouping columns: column1:7!null
                │    │    ├── project
                │    │    │    ├── columns: w_default:11 column1:7!null column2:8!null v_cast:10!null
                │    │    │    ├── project
                │    │    │    │    ├── columns: v_cast:10!null column1:7!null column2:8!null
                │    │    │    │    ├── values
                │    │    │    │    │    ├── columns: column1:7!null column2:8!null column3:9!null
                │    │    │    │    │    ├── (1, 1, '[1,2,3]')
                │    │    │    │    │    └── (2, 2, '[4,5,6]')
                │    │    │    │    └── projections
                │    │    │    │         └── assignment-cast: VECTOR(3) [as=v_cast:10]
                │    │    │    │              └── column3:9
                │    │    │    └── projections
                │    │    │         └── NULL::VECTOR(2) [as=w_default:11]
                │    │    └── aggregations
                │    │         ├── first-agg [as=column2:8]
                │    │         │    └── column2:8
                │    │         ├── first-agg [as=v_cast:10]
                │    │         │    └── v_cast:10
                │    │         └── first-agg [as=w_default:11]
                │    │              └── w_default:11
                │    ├── scan t
                │    │    ├── columns: x:12!null a:13 v:14 w:15 crdb_internal_mvcc_timestamp:16 tableoid:17
                │    │    └── flags: avoid-full-scan disabled not visible index feature
                │    └── filters
                │         └── column1:7 = x:12
                └── projections
                     └── CASE WHEN x:12 IS NULL THEN column1:7 ELSE x:12 END [as=upsert_x:18]

build
INSERT INTO t VALUES (1, 1, '[1,2,3]'), (2, 2, '[4,5,6]')
ON CONFLICT (x) DO UPDATE SET v = '[-4,-5,-6]';
----
upsert t
 ├── arbiter indexes: t_pkey
 ├── columns: <none>
 ├── canary column: x:12
 ├── fetch columns: x:12 a:13 v:14 w:15
 ├── insert-mapping:
 │    ├── column1:7 => x:1
 │    ├── column2:8 => a:2
 │    ├── v_cast:10 => v:3
 │    └── w_default:11 => w:4
 ├── update-mapping:
 │    └── upsert_v:22 => v:3
 ├── vector index del partition columns: vector_index_del_partition1:24
 ├── vector index put partition columns: vector_index_put_partition1:25
 ├── vector index put quantized vector columns: vector_index_put_quantized_vec1:26
 └── vector-mutation-search t@t_v_idx,vector
      ├── columns: column1:7!null column2:8!null v_cast:10!null w_default:11 x:12 a:13 v:14 w:15 crdb_internal_mvcc_timestamp:16 tableoid:17 v_cast:19!null upsert_x:20 upsert_a:21 upsert_v:22!null upsert_w:23 vector_index_del_partition1:24 vector_index_put_partition1:25 vector_index_put_quantized_vec1:26
      ├── index put
      ├── query vector column: upsert_v:22
      ├── partition col: vector_index_put_partition1:25
      ├── quantized vector col: vector_index_put_quantized_vec1:26
      └── vector-mutation-search t@t_v_idx,vector
           ├── columns: column1:7!null column2:8!null v_cast:10!null w_default:11 x:12 a:13 v:14 w:15 crdb_internal_mvcc_timestamp:16 tableoid:17 v_cast:19!null upsert_x:20 upsert_a:21 upsert_v:22!null upsert_w:23 vector_index_del_partition1:24
           ├── index del
           ├── query vector column: v:14
           ├── suffix key columns: [12]
           ├── partition col: vector_index_del_partition1:24
           └── project
                ├── columns: upsert_x:20 upsert_a:21 upsert_v:22!null upsert_w:23 column1:7!null column2:8!null v_cast:10!null w_default:11 x:12 a:13 v:14 w:15 crdb_internal_mvcc_timestamp:16 tableoid:17 v_cast:19!null
                ├── project
                │    ├── columns: v_cast:19!null column1:7!null column2:8!null v_cast:10!null w_default:11 x:12 a:13 v:14 w:15 crdb_internal_mvcc_timestamp:16 tableoid:17
                │    ├── project
                │    │    ├── columns: v_new:18!null column1:7!null column2:8!null v_cast:10!null w_default:11 x:12 a:13 v:14 w:15 crdb_internal_mvcc_timestamp:16 tableoid:17
                │    │    ├── left-join (hash)
                │    │    │    ├── columns: column1:7!null column2:8!null v_cast:10!null w_default:11 x:12 a:13 v:14 w:15 crdb_internal_mvcc_timestamp:16 tableoid:17
                │    │    │    ├── ensure-upsert-distinct-on
                │    │    │    │    ├── columns: column1:7!null column2:8!null v_cast:10!null w_default:11
                │    │    │    │    ├── grouping columns: column1:7!null
                │    │    │    │    ├── project
                │    │    │    │    │    ├── columns: w_default:11 column1:7!null column2:8!null v_cast:10!null
                │    │    │    │    │    ├── project
                │    │    │    │    │    │    ├── columns: v_cast:10!null column1:7!null column2:8!null
                │    │    │    │    │    │    ├── values
                │    │    │    │    │    │    │    ├── columns: column1:7!null column2:8!null column3:9!null
                │    │    │    │    │    │    │    ├── (1, 1, '[1,2,3]')
                │    │    │    │    │    │    │    └── (2, 2, '[4,5,6]')
                │    │    │    │    │    │    └── projections
                │    │    │    │    │    │         └── assignment-cast: VECTOR(3) [as=v_cast:10]
                │    │    │    │    │    │              └── column3:9
                │    │    │    │    │    └── projections
                │    │    │    │    │         └── NULL::VECTOR(2) [as=w_default:11]
                │    │    │    │    └── aggregations
                │    │    │    │         ├── first-agg [as=column2:8]
                │    │    │    │         │    └── column2:8
                │    │    │    │         ├── first-agg [as=v_cast:10]
                │    │    │    │         │    └── v_cast:10
                │    │    │    │         └── first-agg [as=w_default:11]
                │    │    │    │              └── w_default:11
                │    │    │    ├── scan t
                │    │    │    │    ├── columns: x:12!null a:13 v:14 w:15 crdb_internal_mvcc_timestamp:16 tableoid:17
                │    │    │    │    └── flags: avoid-full-scan disabled not visible index feature
                │    │    │    └── filters
                │    │    │         └── column1:7 = x:12
                │    │    └── projections
                │    │         └── '[-4,-5,-6]' [as=v_new:18]
                │    └── projections
                │         └── assignment-cast: VECTOR(3) [as=v_cast:19]
                │              └── v_new:18
                └── projections
                     ├── CASE WHEN x:12 IS NULL THEN column1:7 ELSE x:12 END [as=upsert_x:20]
                     ├── CASE WHEN x:12 IS NULL THEN column2:8 ELSE a:13 END [as=upsert_a:21]
                     ├── CASE WHEN x:12 IS NULL THEN v_cast:10 ELSE v_cast:19 END [as=upsert_v:22]
                     └── CASE WHEN x:12 IS NULL THEN w_default:11 ELSE w:15 END [as=upsert_w:23]

# Create another vector index, verify that mutations correctly update both
# indexes.
exec-ddl
CREATE VECTOR INDEX ON t (w);
----

build
INSERT INTO t VALUES (1, 1, '[1,2,3]', '[10, 20]'), (2, 2, '[4,5,6]', '[30, 40]');
----
insert t
 ├── columns: <none>
 ├── insert-mapping:
 │    ├── column1:7 => x:1
 │    ├── column2:8 => a:2
 │    ├── v_cast:11 => v:3
 │    └── w_cast:12 => w:4
 ├── vector index put partition columns: vector_index_put_partition1:13 vector_index_put_partition2:15
 ├── vector index put quantized vector columns: vector_index_put_quantized_vec1:14 vector_index_put_quantized_vec2:16
 └── vector-mutation-search t@t_w_idx,vector
      ├── columns: column1:7!null column2:8!null v_cast:11!null w_cast:12!null vector_index_put_partition1:13 vector_index_put_quantized_vec1:14 vector_index_put_partition2:15 vector_index_put_quantized_vec2:16
      ├── index put
      ├── query vector column: w_cast:12
      ├── partition col: vector_index_put_partition2:15
      ├── quantized vector col: vector_index_put_quantized_vec2:16
      └── vector-mutation-search t@t_v_idx,vector
           ├── columns: column1:7!null column2:8!null v_cast:11!null w_cast:12!null vector_index_put_partition1:13 vector_index_put_quantized_vec1:14
           ├── index put
           ├── query vector column: v_cast:11
           ├── partition col: vector_index_put_partition1:13
           ├── quantized vector col: vector_index_put_quantized_vec1:14
           └── project
                ├── columns: v_cast:11!null w_cast:12!null column1:7!null column2:8!null
                ├── values
                │    ├── columns: column1:7!null column2:8!null column3:9!null column4:10!null
                │    ├── (1, 1, '[1,2,3]', '[10,20]')
                │    └── (2, 2, '[4,5,6]', '[30,40]')
                └── projections
                     ├── assignment-cast: VECTOR(3) [as=v_cast:11]
                     │    └── column3:9
                     └── assignment-cast: VECTOR(2) [as=w_cast:12]
                          └── column4:10

build
UPDATE t SET v = '[4,5,6]', w = '[20, 40]' WHERE x = 1;
----
update t
 ├── columns: <none>
 ├── fetch columns: x:7 a:8 v:9 w:10
 ├── update-mapping:
 │    ├── v_cast:15 => v:3
 │    └── w_cast:16 => w:4
 ├── vector index del partition columns: vector_index_del_partition1:17 vector_index_del_partition2:20
 ├── vector index put partition columns: vector_index_put_partition1:18 vector_index_put_partition2:21
 ├── vector index put quantized vector columns: vector_index_put_quantized_vec1:19 vector_index_put_quantized_vec2:22
 └── vector-mutation-search t@t_w_idx,vector
      ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12 v_cast:15!null w_cast:16!null vector_index_del_partition1:17 vector_index_put_partition1:18 vector_index_put_quantized_vec1:19 vector_index_del_partition2:20 vector_index_put_partition2:21 vector_index_put_quantized_vec2:22
      ├── index put
      ├── query vector column: w_cast:16
      ├── partition col: vector_index_put_partition2:21
      ├── quantized vector col: vector_index_put_quantized_vec2:22
      └── vector-mutation-search t@t_w_idx,vector
           ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12 v_cast:15!null w_cast:16!null vector_index_del_partition1:17 vector_index_put_partition1:18 vector_index_put_quantized_vec1:19 vector_index_del_partition2:20
           ├── index del
           ├── query vector column: w:10
           ├── suffix key columns: [7]
           ├── partition col: vector_index_del_partition2:20
           └── vector-mutation-search t@t_v_idx,vector
                ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12 v_cast:15!null w_cast:16!null vector_index_del_partition1:17 vector_index_put_partition1:18 vector_index_put_quantized_vec1:19
                ├── index put
                ├── query vector column: v_cast:15
                ├── partition col: vector_index_put_partition1:18
                ├── quantized vector col: vector_index_put_quantized_vec1:19
                └── vector-mutation-search t@t_v_idx,vector
                     ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12 v_cast:15!null w_cast:16!null vector_index_del_partition1:17
                     ├── index del
                     ├── query vector column: v:9
                     ├── suffix key columns: [7]
                     ├── partition col: vector_index_del_partition1:17
                     └── project
                          ├── columns: v_cast:15!null w_cast:16!null x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
                          ├── project
                          │    ├── columns: v_new:13!null w_new:14!null x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
                          │    ├── select
                          │    │    ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
                          │    │    ├── scan t
                          │    │    │    ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
                          │    │    │    └── flags: avoid-full-scan
                          │    │    └── filters
                          │    │         └── x:7 = 1
                          │    └── projections
                          │         ├── '[4,5,6]' [as=v_new:13]
                          │         └── '[20,40]' [as=w_new:14]
                          └── projections
                               ├── assignment-cast: VECTOR(3) [as=v_cast:15]
                               │    └── v_new:13
                               └── assignment-cast: VECTOR(2) [as=w_cast:16]
                                    └── w_new:14

build
DELETE FROM t WHERE x = 1;
----
delete t
 ├── columns: <none>
 ├── fetch columns: x:7 a:8 v:9 w:10
 ├── vector index del partition columns: vector_index_del_partition1:13 vector_index_del_partition2:14
 └── vector-mutation-search t@t_w_idx,vector
      ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12 vector_index_del_partition1:13 vector_index_del_partition2:14
      ├── index del
      ├── query vector column: w:10
      ├── suffix key columns: [7]
      ├── partition col: vector_index_del_partition2:14
      └── vector-mutation-search t@t_v_idx,vector
           ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12 vector_index_del_partition1:13
           ├── index del
           ├── query vector column: v:9
           ├── suffix key columns: [7]
           ├── partition col: vector_index_del_partition1:13
           └── select
                ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
                ├── scan t
                │    ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
                │    └── flags: avoid-full-scan
                └── filters
                     └── x:7 = 1

build
UPSERT INTO t VALUES (1, 1, '[1,2,3]', '[10, 20]'), (2, 2, '[4,5,6]', '[30, 40]');;
----
upsert t
 ├── arbiter indexes: t_pkey
 ├── columns: <none>
 ├── canary column: x:13
 ├── fetch columns: x:13 a:14 v:15 w:16
 ├── insert-mapping:
 │    ├── column1:7 => x:1
 │    ├── column2:8 => a:2
 │    ├── v_cast:11 => v:3
 │    └── w_cast:12 => w:4
 ├── update-mapping:
 │    ├── column2:8 => a:2
 │    ├── v_cast:11 => v:3
 │    └── w_cast:12 => w:4
 ├── vector index del partition columns: vector_index_del_partition1:20 vector_index_del_partition2:23
 ├── vector index put partition columns: vector_index_put_partition1:21 vector_index_put_partition2:24
 ├── vector index put quantized vector columns: vector_index_put_quantized_vec1:22 vector_index_put_quantized_vec2:25
 └── vector-mutation-search t@t_w_idx,vector
      ├── columns: column1:7!null column2:8!null v_cast:11!null w_cast:12!null x:13 a:14 v:15 w:16 crdb_internal_mvcc_timestamp:17 tableoid:18 upsert_x:19 vector_index_del_partition1:20 vector_index_put_partition1:21 vector_index_put_quantized_vec1:22 vector_index_del_partition2:23 vector_index_put_partition2:24 vector_index_put_quantized_vec2:25
      ├── index put
      ├── query vector column: w_cast:12
      ├── partition col: vector_index_put_partition2:24
      ├── quantized vector col: vector_index_put_quantized_vec2:25
      └── vector-mutation-search t@t_w_idx,vector
           ├── columns: column1:7!null column2:8!null v_cast:11!null w_cast:12!null x:13 a:14 v:15 w:16 crdb_internal_mvcc_timestamp:17 tableoid:18 upsert_x:19 vector_index_del_partition1:20 vector_index_put_partition1:21 vector_index_put_quantized_vec1:22 vector_index_del_partition2:23
           ├── index del
           ├── query vector column: w:16
           ├── suffix key columns: [13]
           ├── partition col: vector_index_del_partition2:23
           └── vector-mutation-search t@t_v_idx,vector
                ├── columns: column1:7!null column2:8!null v_cast:11!null w_cast:12!null x:13 a:14 v:15 w:16 crdb_internal_mvcc_timestamp:17 tableoid:18 upsert_x:19 vector_index_del_partition1:20 vector_index_put_partition1:21 vector_index_put_quantized_vec1:22
                ├── index put
                ├── query vector column: v_cast:11
                ├── partition col: vector_index_put_partition1:21
                ├── quantized vector col: vector_index_put_quantized_vec1:22
                └── vector-mutation-search t@t_v_idx,vector
                     ├── columns: column1:7!null column2:8!null v_cast:11!null w_cast:12!null x:13 a:14 v:15 w:16 crdb_internal_mvcc_timestamp:17 tableoid:18 upsert_x:19 vector_index_del_partition1:20
                     ├── index del
                     ├── query vector column: v:15
                     ├── suffix key columns: [13]
                     ├── partition col: vector_index_del_partition1:20
                     └── project
                          ├── columns: upsert_x:19 column1:7!null column2:8!null v_cast:11!null w_cast:12!null x:13 a:14 v:15 w:16 crdb_internal_mvcc_timestamp:17 tableoid:18
                          ├── left-join (hash)
                          │    ├── columns: column1:7!null column2:8!null v_cast:11!null w_cast:12!null x:13 a:14 v:15 w:16 crdb_internal_mvcc_timestamp:17 tableoid:18
                          │    ├── ensure-upsert-distinct-on
                          │    │    ├── columns: column1:7!null column2:8!null v_cast:11!null w_cast:12!null
                          │    │    ├── grouping columns: column1:7!null
                          │    │    ├── project
                          │    │    │    ├── columns: v_cast:11!null w_cast:12!null column1:7!null column2:8!null
                          │    │    │    ├── values
                          │    │    │    │    ├── columns: column1:7!null column2:8!null column3:9!null column4:10!null
                          │    │    │    │    ├── (1, 1, '[1,2,3]', '[10,20]')
                          │    │    │    │    └── (2, 2, '[4,5,6]', '[30,40]')
                          │    │    │    └── projections
                          │    │    │         ├── assignment-cast: VECTOR(3) [as=v_cast:11]
                          │    │    │         │    └── column3:9
                          │    │    │         └── assignment-cast: VECTOR(2) [as=w_cast:12]
                          │    │    │              └── column4:10
                          │    │    └── aggregations
                          │    │         ├── first-agg [as=column2:8]
                          │    │         │    └── column2:8
                          │    │         ├── first-agg [as=v_cast:11]
                          │    │         │    └── v_cast:11
                          │    │         └── first-agg [as=w_cast:12]
                          │    │              └── w_cast:12
                          │    ├── scan t
                          │    │    ├── columns: x:13!null a:14 v:15 w:16 crdb_internal_mvcc_timestamp:17 tableoid:18
                          │    │    └── flags: avoid-full-scan disabled not visible index feature
                          │    └── filters
                          │         └── column1:7 = x:13
                          └── projections
                               └── CASE WHEN x:13 IS NULL THEN column1:7 ELSE x:13 END [as=upsert_x:19]

build
INSERT INTO t VALUES (1, 1, '[1,2,3]', '[10, 20]'), (2, 2, '[4,5,6]', '[30, 40]')
ON CONFLICT (x) DO UPDATE SET v = '[-4,-5,-6]', w = '[-40, -30]';
----
upsert t
 ├── arbiter indexes: t_pkey
 ├── columns: <none>
 ├── canary column: x:13
 ├── fetch columns: x:13 a:14 v:15 w:16
 ├── insert-mapping:
 │    ├── column1:7 => x:1
 │    ├── column2:8 => a:2
 │    ├── v_cast:11 => v:3
 │    └── w_cast:12 => w:4
 ├── update-mapping:
 │    ├── upsert_v:25 => v:3
 │    └── upsert_w:26 => w:4
 ├── vector index del partition columns: vector_index_del_partition1:27 vector_index_del_partition2:30
 ├── vector index put partition columns: vector_index_put_partition1:28 vector_index_put_partition2:31
 ├── vector index put quantized vector columns: vector_index_put_quantized_vec1:29 vector_index_put_quantized_vec2:32
 └── vector-mutation-search t@t_w_idx,vector
      ├── columns: column1:7!null column2:8!null v_cast:11!null w_cast:12!null x:13 a:14 v:15 w:16 crdb_internal_mvcc_timestamp:17 tableoid:18 v_cast:21!null w_cast:22!null upsert_x:23 upsert_a:24 upsert_v:25!null upsert_w:26!null vector_index_del_partition1:27 vector_index_put_partition1:28 vector_index_put_quantized_vec1:29 vector_index_del_partition2:30 vector_index_put_partition2:31 vector_index_put_quantized_vec2:32
      ├── index put
      ├── query vector column: upsert_w:26
      ├── partition col: vector_index_put_partition2:31
      ├── quantized vector col: vector_index_put_quantized_vec2:32
      └── vector-mutation-search t@t_w_idx,vector
           ├── columns: column1:7!null column2:8!null v_cast:11!null w_cast:12!null x:13 a:14 v:15 w:16 crdb_internal_mvcc_timestamp:17 tableoid:18 v_cast:21!null w_cast:22!null upsert_x:23 upsert_a:24 upsert_v:25!null upsert_w:26!null vector_index_del_partition1:27 vector_index_put_partition1:28 vector_index_put_quantized_vec1:29 vector_index_del_partition2:30
           ├── index del
           ├── query vector column: w:16
           ├── suffix key columns: [13]
           ├── partition col: vector_index_del_partition2:30
           └── vector-mutation-search t@t_v_idx,vector
                ├── columns: column1:7!null column2:8!null v_cast:11!null w_cast:12!null x:13 a:14 v:15 w:16 crdb_internal_mvcc_timestamp:17 tableoid:18 v_cast:21!null w_cast:22!null upsert_x:23 upsert_a:24 upsert_v:25!null upsert_w:26!null vector_index_del_partition1:27 vector_index_put_partition1:28 vector_index_put_quantized_vec1:29
                ├── index put
                ├── query vector column: upsert_v:25
                ├── partition col: vector_index_put_partition1:28
                ├── quantized vector col: vector_index_put_quantized_vec1:29
                └── vector-mutation-search t@t_v_idx,vector
                     ├── columns: column1:7!null column2:8!null v_cast:11!null w_cast:12!null x:13 a:14 v:15 w:16 crdb_internal_mvcc_timestamp:17 tableoid:18 v_cast:21!null w_cast:22!null upsert_x:23 upsert_a:24 upsert_v:25!null upsert_w:26!null vector_index_del_partition1:27
                     ├── index del
                     ├── query vector column: v:15
                     ├── suffix key columns: [13]
                     ├── partition col: vector_index_del_partition1:27
                     └── project
                          ├── columns: upsert_x:23 upsert_a:24 upsert_v:25!null upsert_w:26!null column1:7!null column2:8!null v_cast:11!null w_cast:12!null x:13 a:14 v:15 w:16 crdb_internal_mvcc_timestamp:17 tableoid:18 v_cast:21!null w_cast:22!null
                          ├── project
                          │    ├── columns: v_cast:21!null w_cast:22!null column1:7!null column2:8!null v_cast:11!null w_cast:12!null x:13 a:14 v:15 w:16 crdb_internal_mvcc_timestamp:17 tableoid:18
                          │    ├── project
                          │    │    ├── columns: v_new:19!null w_new:20!null column1:7!null column2:8!null v_cast:11!null w_cast:12!null x:13 a:14 v:15 w:16 crdb_internal_mvcc_timestamp:17 tableoid:18
                          │    │    ├── left-join (hash)
                          │    │    │    ├── columns: column1:7!null column2:8!null v_cast:11!null w_cast:12!null x:13 a:14 v:15 w:16 crdb_internal_mvcc_timestamp:17 tableoid:18
                          │    │    │    ├── ensure-upsert-distinct-on
                          │    │    │    │    ├── columns: column1:7!null column2:8!null v_cast:11!null w_cast:12!null
                          │    │    │    │    ├── grouping columns: column1:7!null
                          │    │    │    │    ├── project
                          │    │    │    │    │    ├── columns: v_cast:11!null w_cast:12!null column1:7!null column2:8!null
                          │    │    │    │    │    ├── values
                          │    │    │    │    │    │    ├── columns: column1:7!null column2:8!null column3:9!null column4:10!null
                          │    │    │    │    │    │    ├── (1, 1, '[1,2,3]', '[10,20]')
                          │    │    │    │    │    │    └── (2, 2, '[4,5,6]', '[30,40]')
                          │    │    │    │    │    └── projections
                          │    │    │    │    │         ├── assignment-cast: VECTOR(3) [as=v_cast:11]
                          │    │    │    │    │         │    └── column3:9
                          │    │    │    │    │         └── assignment-cast: VECTOR(2) [as=w_cast:12]
                          │    │    │    │    │              └── column4:10
                          │    │    │    │    └── aggregations
                          │    │    │    │         ├── first-agg [as=column2:8]
                          │    │    │    │         │    └── column2:8
                          │    │    │    │         ├── first-agg [as=v_cast:11]
                          │    │    │    │         │    └── v_cast:11
                          │    │    │    │         └── first-agg [as=w_cast:12]
                          │    │    │    │              └── w_cast:12
                          │    │    │    ├── scan t
                          │    │    │    │    ├── columns: x:13!null a:14 v:15 w:16 crdb_internal_mvcc_timestamp:17 tableoid:18
                          │    │    │    │    └── flags: avoid-full-scan disabled not visible index feature
                          │    │    │    └── filters
                          │    │    │         └── column1:7 = x:13
                          │    │    └── projections
                          │    │         ├── '[-4,-5,-6]' [as=v_new:19]
                          │    │         └── '[-40,-30]' [as=w_new:20]
                          │    └── projections
                          │         ├── assignment-cast: VECTOR(3) [as=v_cast:21]
                          │         │    └── v_new:19
                          │         └── assignment-cast: VECTOR(2) [as=w_cast:22]
                          │              └── w_new:20
                          └── projections
                               ├── CASE WHEN x:13 IS NULL THEN column1:7 ELSE x:13 END [as=upsert_x:23]
                               ├── CASE WHEN x:13 IS NULL THEN column2:8 ELSE a:14 END [as=upsert_a:24]
                               ├── CASE WHEN x:13 IS NULL THEN v_cast:11 ELSE v_cast:21 END [as=upsert_v:25]
                               └── CASE WHEN x:13 IS NULL THEN w_cast:12 ELSE w_cast:22 END [as=upsert_w:26]

build
UPDATE t SET x = 3, v = '[1,2,3]' WHERE x = 3;
----
update t
 ├── columns: <none>
 ├── fetch columns: x:7 a:8 v:9 w:10
 ├── update-mapping:
 │    ├── x_new:13 => x:1
 │    └── v_cast:15 => v:3
 ├── vector index del partition columns: vector_index_del_partition1:16 vector_index_del_partition2:19
 ├── vector index put partition columns: vector_index_put_partition1:17 vector_index_put_partition2:20
 ├── vector index put quantized vector columns: vector_index_put_quantized_vec1:18 vector_index_put_quantized_vec2:21
 └── vector-mutation-search t@t_w_idx,vector
      ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12 x_new:13!null v_cast:15!null vector_index_del_partition1:16 vector_index_put_partition1:17 vector_index_put_quantized_vec1:18 vector_index_del_partition2:19 vector_index_put_partition2:20 vector_index_put_quantized_vec2:21
      ├── index put
      ├── query vector column: w:10
      ├── partition col: vector_index_put_partition2:20
      ├── quantized vector col: vector_index_put_quantized_vec2:21
      └── vector-mutation-search t@t_w_idx,vector
           ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12 x_new:13!null v_cast:15!null vector_index_del_partition1:16 vector_index_put_partition1:17 vector_index_put_quantized_vec1:18 vector_index_del_partition2:19
           ├── index del
           ├── query vector column: w:10
           ├── suffix key columns: [7]
           ├── partition col: vector_index_del_partition2:19
           └── vector-mutation-search t@t_v_idx,vector
                ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12 x_new:13!null v_cast:15!null vector_index_del_partition1:16 vector_index_put_partition1:17 vector_index_put_quantized_vec1:18
                ├── index put
                ├── query vector column: v_cast:15
                ├── partition col: vector_index_put_partition1:17
                ├── quantized vector col: vector_index_put_quantized_vec1:18
                └── vector-mutation-search t@t_v_idx,vector
                     ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12 x_new:13!null v_cast:15!null vector_index_del_partition1:16
                     ├── index del
                     ├── query vector column: v:9
                     ├── suffix key columns: [7]
                     ├── partition col: vector_index_del_partition1:16
                     └── project
                          ├── columns: v_cast:15!null x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12 x_new:13!null
                          ├── project
                          │    ├── columns: x_new:13!null v_new:14!null x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
                          │    ├── select
                          │    │    ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
                          │    │    ├── scan t
                          │    │    │    ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
                          │    │    │    └── flags: avoid-full-scan
                          │    │    └── filters
                          │    │         └── x:7 = 3
                          │    └── projections
                          │         ├── 3 [as=x_new:13]
                          │         └── '[1,2,3]' [as=v_new:14]
                          └── projections
                               └── assignment-cast: VECTOR(3) [as=v_cast:15]
                                    └── v_new:14

build
UPDATE t SET x = 3 WHERE x = 3;
----
update t
 ├── columns: <none>
 ├── fetch columns: x:7 a:8 v:9 w:10
 ├── update-mapping:
 │    └── x_new:13 => x:1
 ├── vector index del partition columns: vector_index_del_partition1:14 vector_index_del_partition2:17
 ├── vector index put partition columns: vector_index_put_partition1:15 vector_index_put_partition2:18
 ├── vector index put quantized vector columns: vector_index_put_quantized_vec1:16 vector_index_put_quantized_vec2:19
 └── vector-mutation-search t@t_w_idx,vector
      ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12 x_new:13!null vector_index_del_partition1:14 vector_index_put_partition1:15 vector_index_put_quantized_vec1:16 vector_index_del_partition2:17 vector_index_put_partition2:18 vector_index_put_quantized_vec2:19
      ├── index put
      ├── query vector column: w:10
      ├── partition col: vector_index_put_partition2:18
      ├── quantized vector col: vector_index_put_quantized_vec2:19
      └── vector-mutation-search t@t_w_idx,vector
           ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12 x_new:13!null vector_index_del_partition1:14 vector_index_put_partition1:15 vector_index_put_quantized_vec1:16 vector_index_del_partition2:17
           ├── index del
           ├── query vector column: w:10
           ├── suffix key columns: [7]
           ├── partition col: vector_index_del_partition2:17
           └── vector-mutation-search t@t_v_idx,vector
                ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12 x_new:13!null vector_index_del_partition1:14 vector_index_put_partition1:15 vector_index_put_quantized_vec1:16
                ├── index put
                ├── query vector column: v:9
                ├── partition col: vector_index_put_partition1:15
                ├── quantized vector col: vector_index_put_quantized_vec1:16
                └── vector-mutation-search t@t_v_idx,vector
                     ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12 x_new:13!null vector_index_del_partition1:14
                     ├── index del
                     ├── query vector column: v:9
                     ├── suffix key columns: [7]
                     ├── partition col: vector_index_del_partition1:14
                     └── project
                          ├── columns: x_new:13!null x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
                          ├── select
                          │    ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
                          │    ├── scan t
                          │    │    ├── columns: x:7!null a:8 v:9 w:10 crdb_internal_mvcc_timestamp:11 tableoid:12
                          │    │    └── flags: avoid-full-scan
                          │    └── filters
                          │         └── x:7 = 3
                          └── projections
                               └── 3 [as=x_new:13]

build
INSERT INTO t_multi VALUES (1, 2, 1, 2, 3, '[1, 2, 3]');
----
insert t_multi
 ├── columns: <none>
 ├── insert-mapping:
 │    ├── column1:9 => x:1
 │    ├── column2:10 => y:2
 │    ├── column3:11 => a:3
 │    ├── column4:12 => b:4
 │    ├── column5:13 => c:5
 │    └── v_cast:15 => v:6
 ├── vector index put partition columns: vector_index_put_partition1:16
 ├── vector index put quantized vector columns: vector_index_put_quantized_vec1:17
 └── vector-mutation-search t_multi@t_multi_a_b_v_idx,vector
      ├── columns: column1:9!null column2:10!null column3:11!null column4:12!null column5:13!null v_cast:15!null vector_index_put_partition1:16 vector_index_put_quantized_vec1:17
      ├── index put
      ├── prefix key columns: [11 12]
      ├── query vector column: v_cast:15
      ├── partition col: vector_index_put_partition1:16
      ├── quantized vector col: vector_index_put_quantized_vec1:17
      └── project
           ├── columns: v_cast:15!null column1:9!null column2:10!null column3:11!null column4:12!null column5:13!null
           ├── values
           │    ├── columns: column1:9!null column2:10!null column3:11!null column4:12!null column5:13!null column6:14!null
           │    └── (1, 2, 1, 2, 3, '[1,2,3]')
           └── projections
                └── assignment-cast: VECTOR(3) [as=v_cast:15]
                     └── column6:14

build
UPDATE t_multi SET v = '[1, 2, 3]' WHERE a = 1 AND b = 2;
----
update t_multi
 ├── columns: <none>
 ├── fetch columns: x:9 y:10 a:11 b:12 c:13 v:14
 ├── update-mapping:
 │    └── v_cast:18 => v:6
 ├── vector index del partition columns: vector_index_del_partition1:19
 ├── vector index put partition columns: vector_index_put_partition1:20
 ├── vector index put quantized vector columns: vector_index_put_quantized_vec1:21
 └── vector-mutation-search t_multi@t_multi_a_b_v_idx,vector
      ├── columns: x:9!null y:10!null a:11!null b:12!null c:13 v:14 crdb_internal_mvcc_timestamp:15 tableoid:16 v_cast:18!null vector_index_del_partition1:19 vector_index_put_partition1:20 vector_index_put_quantized_vec1:21
      ├── index put
      ├── prefix key columns: [11 12]
      ├── query vector column: v_cast:18
      ├── partition col: vector_index_put_partition1:20
      ├── quantized vector col: vector_index_put_quantized_vec1:21
      └── vector-mutation-search t_multi@t_multi_a_b_v_idx,vector
           ├── columns: x:9!null y:10!null a:11!null b:12!null c:13 v:14 crdb_internal_mvcc_timestamp:15 tableoid:16 v_cast:18!null vector_index_del_partition1:19
           ├── index del
           ├── prefix key columns: [11 12]
           ├── query vector column: v:14
           ├── suffix key columns: [9 10]
           ├── partition col: vector_index_del_partition1:19
           └── project
                ├── columns: v_cast:18!null x:9!null y:10!null a:11!null b:12!null c:13 v:14 crdb_internal_mvcc_timestamp:15 tableoid:16
                ├── project
                │    ├── columns: v_new:17!null x:9!null y:10!null a:11!null b:12!null c:13 v:14 crdb_internal_mvcc_timestamp:15 tableoid:16
                │    ├── select
                │    │    ├── columns: x:9!null y:10!null a:11!null b:12!null c:13 v:14 crdb_internal_mvcc_timestamp:15 tableoid:16
                │    │    ├── scan t_multi
                │    │    │    ├── columns: x:9!null y:10!null a:11 b:12 c:13 v:14 crdb_internal_mvcc_timestamp:15 tableoid:16
                │    │    │    └── flags: avoid-full-scan
                │    │    └── filters
                │    │         └── (a:11 = 1) AND (b:12 = 2)
                │    └── projections
                │         └── '[1,2,3]' [as=v_new:17]
                └── projections
                     └── assignment-cast: VECTOR(3) [as=v_cast:18]
                          └── v_new:17

# Case where a non-vector column from the index is modified. The vector index
# still must be updated.
build
UPDATE t_multi SET a = 2 WHERE a = 1;
----
update t_multi
 ├── columns: <none>
 ├── fetch columns: x:9 y:10 a:11 b:12 c:13 v:14
 ├── update-mapping:
 │    └── a_new:17 => a:3
 ├── vector index del partition columns: vector_index_del_partition1:18
 ├── vector index put partition columns: vector_index_put_partition1:19
 ├── vector index put quantized vector columns: vector_index_put_quantized_vec1:20
 └── vector-mutation-search t_multi@t_multi_a_b_v_idx,vector
      ├── columns: x:9!null y:10!null a:11!null b:12 c:13 v:14 crdb_internal_mvcc_timestamp:15 tableoid:16 a_new:17!null vector_index_del_partition1:18 vector_index_put_partition1:19 vector_index_put_quantized_vec1:20
      ├── index put
      ├── prefix key columns: [17 12]
      ├── query vector column: v:14
      ├── partition col: vector_index_put_partition1:19
      ├── quantized vector col: vector_index_put_quantized_vec1:20
      └── vector-mutation-search t_multi@t_multi_a_b_v_idx,vector
           ├── columns: x:9!null y:10!null a:11!null b:12 c:13 v:14 crdb_internal_mvcc_timestamp:15 tableoid:16 a_new:17!null vector_index_del_partition1:18
           ├── index del
           ├── prefix key columns: [11 12]
           ├── query vector column: v:14
           ├── suffix key columns: [9 10]
           ├── partition col: vector_index_del_partition1:18
           └── project
                ├── columns: a_new:17!null x:9!null y:10!null a:11!null b:12 c:13 v:14 crdb_internal_mvcc_timestamp:15 tableoid:16
                ├── select
                │    ├── columns: x:9!null y:10!null a:11!null b:12 c:13 v:14 crdb_internal_mvcc_timestamp:15 tableoid:16
                │    ├── scan t_multi
                │    │    ├── columns: x:9!null y:10!null a:11 b:12 c:13 v:14 crdb_internal_mvcc_timestamp:15 tableoid:16
                │    │    └── flags: avoid-full-scan
                │    └── filters
                │         └── a:11 = 1
                └── projections
                     └── 2 [as=a_new:17]

# Case with a non-indexed column modified.
build
UPDATE t_multi SET c = 2 WHERE a = 1;
----
update t_multi
 ├── columns: <none>
 ├── fetch columns: x:9 y:10 a:11 b:12 c:13 v:14
 ├── update-mapping:
 │    └── c_new:17 => c:5
 └── project
      ├── columns: c_new:17!null x:9!null y:10!null a:11!null b:12 c:13 v:14 crdb_internal_mvcc_timestamp:15 tableoid:16
      ├── select
      │    ├── columns: x:9!null y:10!null a:11!null b:12 c:13 v:14 crdb_internal_mvcc_timestamp:15 tableoid:16
      │    ├── scan t_multi
      │    │    ├── columns: x:9!null y:10!null a:11 b:12 c:13 v:14 crdb_internal_mvcc_timestamp:15 tableoid:16
      │    │    └── flags: avoid-full-scan
      │    └── filters
      │         └── a:11 = 1
      └── projections
           └── 2 [as=c_new:17]

build
DELETE FROM t_multi WHERE a = 1 AND b = 2;
----
delete t_multi
 ├── columns: <none>
 ├── fetch columns: x:9 y:10 a:11 b:12 c:13 v:14
 ├── vector index del partition columns: vector_index_del_partition1:17
 └── vector-mutation-search t_multi@t_multi_a_b_v_idx,vector
      ├── columns: x:9!null y:10!null a:11!null b:12!null c:13 v:14 crdb_internal_mvcc_timestamp:15 tableoid:16 vector_index_del_partition1:17
      ├── index del
      ├── prefix key columns: [11 12]
      ├── query vector column: v:14
      ├── suffix key columns: [9 10]
      ├── partition col: vector_index_del_partition1:17
      └── select
           ├── columns: x:9!null y:10!null a:11!null b:12!null c:13 v:14 crdb_internal_mvcc_timestamp:15 tableoid:16
           ├── scan t_multi
           │    ├── columns: x:9!null y:10!null a:11 b:12 c:13 v:14 crdb_internal_mvcc_timestamp:15 tableoid:16
           │    └── flags: avoid-full-scan
           └── filters
                └── (a:11 = 1) AND (b:12 = 2)

build
DELETE FROM t_multi WHERE a = 1;
----
delete t_multi
 ├── columns: <none>
 ├── fetch columns: x:9 y:10 a:11 b:12 c:13 v:14
 ├── vector index del partition columns: vector_index_del_partition1:17
 └── vector-mutation-search t_multi@t_multi_a_b_v_idx,vector
      ├── columns: x:9!null y:10!null a:11!null b:12 c:13 v:14 crdb_internal_mvcc_timestamp:15 tableoid:16 vector_index_del_partition1:17
      ├── index del
      ├── prefix key columns: [11 12]
      ├── query vector column: v:14
      ├── suffix key columns: [9 10]
      ├── partition col: vector_index_del_partition1:17
      └── select
           ├── columns: x:9!null y:10!null a:11!null b:12 c:13 v:14 crdb_internal_mvcc_timestamp:15 tableoid:16
           ├── scan t_multi
           │    ├── columns: x:9!null y:10!null a:11 b:12 c:13 v:14 crdb_internal_mvcc_timestamp:15 tableoid:16
           │    └── flags: avoid-full-scan
           └── filters
                └── a:11 = 1
