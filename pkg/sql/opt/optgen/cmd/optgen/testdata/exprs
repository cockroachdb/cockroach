#
# Generate code for op that has Expr, ExprList, and private fields.
#
optgen -pkg test exprs test.opt
define FuncCall {
    Name Expr
    Args ExprList
    Def  FuncDef
}
----
----
// Code generated by optgen; [omitted]

package test

type childCountLookupFunc func(ev *ExprView) int

var childCountLookup = [...]childCountLookupFunc{
	// UnknownOp
	func(ev *ExprView) int {
		panic("op type not initialized")
	},

	// FuncCallOp
	func(ev *ExprView) int {
		funcCallExpr := (*funcCallExpr)(ev.mem.lookupExpr(ev.loc))
		return 1 + int(funcCallExpr.args().len)
	},
}

type childGroupLookupFunc func(ev *ExprView, n int) GroupID

var childGroupLookup = [...]childGroupLookupFunc{
	// UnknownOp
	func(ev *ExprView, n int) GroupID {
		panic("op type not initialized")
	},

	// FuncCallOp
	func(ev *ExprView, n int) GroupID {
		funcCallExpr := (*funcCallExpr)(ev.mem.lookupExpr(ev.loc))

		switch n {
		case 0:
			return funcCallExpr.name()
		default:
			list := ev.mem.lookupList(funcCallExpr.args())
			return list[n-1]
		}
	},
}

type privateLookupFunc func(ev *ExprView) PrivateID

var privateLookup = [...]privateLookupFunc{
	// UnknownOp
	func(ev *ExprView) PrivateID {
		panic("op type not initialized")
	},

	// FuncCallOp
	func(ev *ExprView) PrivateID {
		funcCallExpr := (*funcCallExpr)(ev.mem.lookupExpr(ev.loc))
		return funcCallExpr.def()
	},
}

type funcCallExpr memoExpr

func makeFuncCallExpr(name GroupID, args ListID, def PrivateID) funcCallExpr {
	return funcCallExpr{op: FuncCallOp, state: exprState{uint32(name), args.offset, args.len, uint32(def)}}
}

func (e *funcCallExpr) name() GroupID {
	return GroupID(e.state[0])
}

func (e *funcCallExpr) args() ListID {
	return ListID{offset: e.state[1], len: e.state[2]}
}

func (e *funcCallExpr) def() PrivateID {
	return PrivateID(e.state[3])
}

func (e *funcCallExpr) fingerprint() fingerprint {
	return fingerprint(*e)
}

func (m *memoExpr) asFuncCall() *funcCallExpr {
	if m.op != FuncCallOp {
		return nil
	}
	return (*funcCallExpr)(m)
}
----
----

#
# Generate code for enforcer op.
#
optgen -pkg test exprs test.opt
[Enforcer]
define Sort {
    Input Expr
}
----
----
// Code generated by optgen; [omitted]

package test

type childCountLookupFunc func(ev *ExprView) int

var childCountLookup = [...]childCountLookupFunc{
	// UnknownOp
	func(ev *ExprView) int {
		panic("op type not initialized")
	},

	// SortOp
	func(ev *ExprView) int {
		return 1
	},
}

type childGroupLookupFunc func(ev *ExprView, n int) GroupID

var childGroupLookup = [...]childGroupLookupFunc{
	// UnknownOp
	func(ev *ExprView, n int) GroupID {
		panic("op type not initialized")
	},

	// SortOp
	func(ev *ExprView, n int) GroupID {
		if n == 0 {
			return ev.loc.group
		}

		panic("child index out of range")
	},
}

type privateLookupFunc func(ev *ExprView) PrivateID

var privateLookup = [...]privateLookupFunc{
	// UnknownOp
	func(ev *ExprView) PrivateID {
		panic("op type not initialized")
	},

	// SortOp
	func(ev *ExprView) PrivateID {
		return 0
	},
}

var isEnforcerLookup = [...]bool{
	false, // UnknownOp

	true, // SortOp
}

func (ev *ExprView) IsEnforcer() bool {
	return isEnforcerLookup[ev.op]
}
----
----
