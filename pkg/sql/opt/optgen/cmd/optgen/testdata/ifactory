#
# Generate construct methods for factory that have GroupID, ListID, and
# PrivateID args.
#
optgen ifactory test.opt
[Scalar]
define FuncCall {
    Name Expr
    Args ExprList
    Def  FuncDef
}

[Relational]
define Union {
    Left   Expr
    Right  Expr
    ColMap ColMap
}

# This shouldn't be added to the factory.
[Enforcer]
define Sort {
    Input Expr
}
----
----
// Code generated by optgen; [omitted]

package opt

type Factory interface {
	// Metadata returns the query-specific metadata, which includes information
	// about the columns and tables used in this particular query.
	Metadata() *Metadata

	// StoreList allocates storage for a list of group IDs in the memo and
	// returns an ID that can be used for later lookup.
	StoreList(items []GroupID) ListID

	// InternPrivate adds the given private value to the memo and returns an ID
	// that can be used for later lookup. If the same value was added before,
	// then this method is a no-op and returns the ID of the previous value.
	InternPrivate(private interface{}) PrivateID

	// DynamicConstruct dynamically constructs an operator with the given type
	// and operands. It is equivalent to a switch statement that calls the
	// ConstructXXX method that corresponds to the given operator.
	DynamicConstruct(op Operator, children []GroupID, private PrivateID) GroupID

	// Scalar operator constructors.
	ConstructFuncCall(name GroupID, args ListID, def PrivateID) GroupID

	// Relational operator constructors.
	ConstructUnion(left GroupID, right GroupID, colMap PrivateID) GroupID
}
----
----
