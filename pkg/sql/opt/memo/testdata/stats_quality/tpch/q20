import file=tpch_schema
----

import file=tpch_stats
----

# --------------------------------------------------
# Q20
# Potential Part Promotion
# Identifies suppliers in a particular nation having selected parts that may be
# candidates for a promotional offer.
#
# Identifies suppliers who have an excess of a given part available; an excess
# defined to be more than 50% of the parts like the given part that the supplier
# shipped in a given year for a given nation. Only parts whose names share a
# certain naming convention are considered.
#
# TODO:
#   1. Push 'forest%' prefix filter down into Scan
# --------------------------------------------------
save-tables database=tpch save-tables-prefix=q20
SELECT
    s_name,
    s_address
FROM
    supplier,
    nation
WHERE
    s_suppkey IN (
        SELECT
            ps_suppkey
        FROM
            partsupp
        WHERE
            ps_partkey IN (
                SELECT
                    p_partkey
                FROM
                    part
                WHERE
                    p_name LIKE 'forest%'
            )
            AND ps_availqty > (
                SELECT
                    0.5 * sum(l_quantity)
                FROM
                    lineitem
                WHERE
                    l_partkey = ps_partkey
                    AND l_suppkey = ps_suppkey
                    AND l_shipdate >= DATE '1994-01-01'
                    AND l_shipdate < DATE '1994-01-01' + INTERVAL '1' YEAR
            )
    )
    AND s_nationkey = n_nationkey
    AND n_name = 'CANADA'
ORDER BY
    s_name;
----
sort
 ├── save-table-name: q20_sort_1
 ├── columns: s_name:2(char!null) s_address:3(varchar!null)
 ├── immutable
 ├── stats: [rows=5.13396896, distinct(2)=5.13396829, null(2)=0, distinct(3)=5.13396896, null(3)=0]
 ├── ordering: +2
 └── project
      ├── save-table-name: q20_project_2
      ├── columns: s_name:2(char!null) s_address:3(varchar!null)
      ├── immutable
      ├── stats: [rows=5.13396896, distinct(2)=5.13396829, null(2)=0, distinct(3)=5.13396896, null(3)=0]
      └── project
           ├── save-table-name: q20_project_3
           ├── columns: s_suppkey:1(int!null) s_name:2(char!null) s_address:3(varchar!null) s_nationkey:4(int!null) n_nationkey:9(int!null) n_name:10(char!null)
           ├── immutable
           ├── stats: [rows=5.13396896, distinct(1)=5.13312469, null(1)=0, distinct(2)=5.13396829, null(2)=0, distinct(3)=5.13396896, null(3)=0, distinct(4)=1, null(4)=0, distinct(9)=1, null(9)=0, distinct(10)=0.994700339, null(10)=0]
           ├── key: (1)
           ├── fd: ()-->(10), (1)-->(2-4), (4)==(9), (9)==(4)
           └── inner-join (hash)
                ├── save-table-name: q20_inner_join_4
                ├── columns: s_suppkey:1(int!null) s_name:2(char!null) s_address:3(varchar!null) s_nationkey:4(int!null) n_nationkey:9(int!null) n_name:10(char!null) ps_suppkey:15(int!null)
                ├── multiplicity: left-rows(zero-or-one), right-rows(zero-or-more)
                ├── immutable
                ├── stats: [rows=126.594795, distinct(1)=126.574101, null(1)=0, distinct(2)=108.633373, null(2)=0, distinct(3)=108.633704, null(3)=0, distinct(4)=1, null(4)=0, distinct(9)=1, null(9)=0, distinct(10)=1, null(10)=0, distinct(15)=126.574101, null(15)=0]
                ├── key: (15)
                ├── fd: ()-->(10), (1)-->(2-4), (4)==(9), (9)==(4), (1)==(15), (15)==(1)
                ├── inner-join (lookup supplier)
                │    ├── save-table-name: q20_lookup_join_5
                │    ├── columns: s_suppkey:1(int!null) s_name:2(char!null) s_address:3(varchar!null) s_nationkey:4(int!null) ps_suppkey:15(int!null)
                │    ├── key columns: [15] = [1]
                │    ├── lookup columns are key
                │    ├── immutable
                │    ├── stats: [rows=127.59486, distinct(1)=126.574101, null(1)=0, distinct(2)=126.789831, null(2)=0, distinct(3)=126.790639, null(3)=0, distinct(4)=24.8481976, null(4)=0, distinct(15)=126.574101, null(15)=0]
                │    ├── key: (15)
                │    ├── fd: (1)-->(2-4), (1)==(15), (15)==(1)
                │    ├── distinct-on
                │    │    ├── save-table-name: q20_distinct_on_6
                │    │    ├── columns: ps_suppkey:15(int!null)
                │    │    ├── grouping columns: ps_suppkey:15(int!null)
                │    │    ├── immutable
                │    │    ├── stats: [rows=126.574101, distinct(15)=126.574101, null(15)=0]
                │    │    ├── key: (15)
                │    │    └── semi-join (lookup part)
                │    │         ├── save-table-name: q20_lookup_join_7
                │    │         ├── columns: ps_partkey:14(int!null) ps_suppkey:15(int!null)
                │    │         ├── key columns: [14] = [20]
                │    │         ├── lookup columns are key
                │    │         ├── immutable
                │    │         ├── stats: [rows=126.574101, distinct(14)=126.574101, null(14)=0, distinct(15)=126.574101, null(15)=0]
                │    │         ├── key: (14,15)
                │    │         ├── project
                │    │         │    ├── save-table-name: q20_project_8
                │    │         │    ├── columns: ps_partkey:14(int!null) ps_suppkey:15(int!null)
                │    │         │    ├── immutable
                │    │         │    ├── stats: [rows=126.574101, distinct(14)=126.574101, null(14)=0, distinct(15)=126.574101, null(15)=0]
                │    │         │    ├── key: (14,15)
                │    │         │    └── select
                │    │         │         ├── save-table-name: q20_select_9
                │    │         │         ├── columns: ps_partkey:14(int!null) ps_suppkey:15(int!null) ps_availqty:16(int!null) sum:47(float!null)
                │    │         │         ├── immutable
                │    │         │         ├── stats: [rows=126.574101, distinct(14)=126.574101, null(14)=0, distinct(15)=126.574101, null(15)=0, distinct(16)=126.574101, null(16)=0, distinct(47)=126.574101, null(47)=0]
                │    │         │         ├── key: (14,15)
                │    │         │         ├── fd: (14,15)-->(16,47)
                │    │         │         ├── group-by
                │    │         │         │    ├── save-table-name: q20_group_by_10
                │    │         │         │    ├── columns: ps_partkey:14(int!null) ps_suppkey:15(int!null) ps_availqty:16(int!null) sum:47(float!null)
                │    │         │         │    ├── grouping columns: ps_partkey:14(int!null) ps_suppkey:15(int!null)
                │    │         │         │    ├── stats: [rows=379.722303, distinct(14)=379.722303, null(14)=0, distinct(15)=379.722303, null(15)=0, distinct(16)=379.722303, null(16)=0, distinct(47)=379.722303, null(47)=0, distinct(14,15)=379.722303, null(14,15)=0]
                │    │         │         │    ├── key: (14,15)
                │    │         │         │    ├── fd: (14,15)-->(16,47)
                │    │         │         │    ├── inner-join (hash)
                │    │         │         │    │    ├── save-table-name: q20_inner_join_11
                │    │         │         │    │    ├── columns: ps_partkey:14(int!null) ps_suppkey:15(int!null) ps_availqty:16(int!null) l_partkey:31(int!null) l_suppkey:32(int!null) l_quantity:34(float!null) l_shipdate:40(date!null)
                │    │         │         │    │    ├── multiplicity: left-rows(exactly-one), right-rows(zero-or-more)
                │    │         │         │    │    ├── stats: [rows=379.722303, distinct(14)=379.722303, null(14)=0, distinct(15)=379.722303, null(15)=0, distinct(16)=372.546594, null(16)=0, distinct(31)=379.722303, null(31)=0, distinct(32)=379.722303, null(32)=0, distinct(34)=49.9748381, null(34)=0, distinct(40)=236.032274, null(40)=0, distinct(14,15)=379.722303, null(14,15)=0]
                │    │         │         │    │    ├── fd: (14,15)-->(16), (14)==(31), (31)==(14), (15)==(32), (32)==(15)
                │    │         │         │    │    ├── index-join lineitem
                │    │         │         │    │    │    ├── save-table-name: q20_index_join_12
                │    │         │         │    │    │    ├── columns: l_partkey:31(int!null) l_suppkey:32(int!null) l_quantity:34(float!null) l_shipdate:40(date!null)
                │    │         │         │    │    │    ├── stats: [rows=938137.516, distinct(31)=198050.435, null(31)=0, distinct(32)=9920, null(32)=0, distinct(34)=50, null(34)=0, distinct(40)=365, null(40)=0]
                │    │         │         │    │    │    │   histogram(40)=  0       0        3150.6      4200      25805      3600      25805      3600      26405      3600      28805      1200      27605      2400      27005      3600      28805      1200      27005      4800      28205      3000      25205      4800      28805      4800      28805      600       28205      1200      24604      6601      24604      4800      28205      3600      27605      3600      27005      4200      28205      2400      28205      4200      28805      1200      28205      1800      28205      1200      28205      3000      27005      4800      28805      600       27005      3600      25805      5401      27005      2400      28205      3000      11502     2300.4
                │    │         │         │    │    │    │                 <--- '1993-12-31' -------- '1994-01-02' ------- '1994-01-16' ------- '1994-01-30' ------- '1994-02-08' ------- '1994-02-18' ------- '1994-03-04' ------- '1994-03-15' ------- '1994-03-29' ------- '1994-04-10' ------- '1994-04-24' ------- '1994-05-03' ------- '1994-05-13' ------- '1994-05-24' ------- '1994-06-04' ------- '1994-06-13' ------- '1994-06-22' ------- '1994-07-05' ------- '1994-07-16' ------- '1994-07-29' ------- '1994-08-09' ------- '1994-08-22' ------- '1994-09-04' ------- '1994-09-15' ------- '1994-09-29' ------- '1994-10-10' ------- '1994-10-20' ------- '1994-11-03' ------- '1994-11-16' ------- '1994-11-29' ------- '1994-12-11' ------- '1994-12-25' ------- '1994-12-31'
                │    │         │         │    │    │    └── scan lineitem@l_sd
                │    │         │         │    │    │         ├── save-table-name: q20_scan_13
                │    │         │         │    │    │         ├── columns: l_orderkey:30(int!null) l_linenumber:33(int!null) l_shipdate:40(date!null)
                │    │         │         │    │    │         ├── constraint: /40/30/33: [/'1994-01-01' - /'1994-12-31']
                │    │         │         │    │    │         ├── stats: [rows=938137.516, distinct(30)=744144.6, null(30)=0, distinct(33)=7, null(33)=0, distinct(40)=365, null(40)=0]
                │    │         │         │    │    │         │   histogram(30)=  0 93.795 4596.7 93.795  4596.7 93.795  4596.7 93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795  4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4596.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795   4690.7  93.795
                │    │         │         │    │    │         │                 <--- 326 --------- 28929 -------- 50503 -------- 89793 -------- 115938 -------- 146944 -------- 176768 -------- 211201 -------- 237860 -------- 266885 -------- 297604 -------- 330021 -------- 365889 -------- 398951 -------- 426117 -------- 451328 -------- 472134 -------- 499590 -------- 529284 -------- 557254 -------- 589154 -------- 619394 -------- 642951 -------- 670113 -------- 692931 -------- 721157 -------- 751687 -------- 777766 -------- 804582 -------- 836740 -------- 868868 -------- 898912 -------- 922500 -------- 946403 -------- 984870 -------- 1007936 -------- 1030117 -------- 1062275 -------- 1093572 -------- 1120709 -------- 1150981 -------- 1182786 -------- 1206406 -------- 1234116 -------- 1260961 -------- 1290502 -------- 1329510 -------- 1355426 -------- 1381313 -------- 1409796 -------- 1445254 -------- 1479233 -------- 1504935 -------- 1531079 -------- 1559650 -------- 1583616 -------- 1617504 -------- 1655749 -------- 1685185 -------- 1718183 -------- 1747716 -------- 1772131 -------- 1802372 -------- 1833315 -------- 1862403 -------- 1897894 -------- 1922819 -------- 1954405 -------- 1979329 -------- 2009859 -------- 2041670 -------- 2070851 -------- 2093828 -------- 2127973 -------- 2167777 -------- 2194883 -------- 2227814 -------- 2262437 -------- 2296353 -------- 2321024 -------- 2346051 -------- 2376257 -------- 2404932 -------- 2446273 -------- 2474081 -------- 2504515 -------- 2535302 -------- 2561413 -------- 2592737 -------- 2616801 -------- 2646112 -------- 2676546 -------- 2702116 -------- 2732454 -------- 2765382 -------- 2799495 -------- 2828866 -------- 2868737 -------- 2910625 -------- 2938464 -------- 2963140 -------- 3003302 -------- 3043264 -------- 3069123 -------- 3095909 -------- 3126693 -------- 3160485 -------- 3196039 -------- 3229504 -------- 3259712 -------- 3286439 -------- 3318852 -------- 3346821 -------- 3370119 -------- 3395204 -------- 3425888 -------- 3448611 -------- 3476130 -------- 3502372 -------- 3529474 -------- 3556390 -------- 3583553 -------- 3612550 -------- 3647875 -------- 3679140 -------- 3702661 -------- 3738017 -------- 3778050 -------- 3806114 -------- 3839074 -------- 3872805 -------- 3905697 -------- 3926212 -------- 3959841 -------- 3997281 -------- 4033861 -------- 4063591 -------- 4097831 -------- 4124807 -------- 4158656 -------- 4195748 -------- 4234274 -------- 4269952 -------- 4298949 -------- 4332806 -------- 4364705 -------- 4398246 -------- 4430695 -------- 4466403 -------- 4494662 -------- 4524420 -------- 4558561 -------- 4601092 -------- 4632871 -------- 4658694 -------- 4690501 -------- 4728066 -------- 4758657 -------- 4788294 -------- 4818597 -------- 4855874 -------- 4890913 -------- 4915366 -------- 4940709 -------- 4972357 -------- 4995298 -------- 5019523 -------- 5043329 -------- 5077376 -------- 5109920 -------- 5136582 -------- 5161152 -------- 5191846 -------- 5219973 -------- 5251015 -------- 5282021 -------- 5312355 -------- 5343207 -------- 5381318 -------- 5416163 -------- 5445382 -------- 5476933 -------- 5509185 -------- 5539237 -------- 5566818 -------- 5588739 -------- 5620481 -------- 5644001 -------- 5667010 -------- 5689476 -------- 5724709 -------- 5755398 -------- 5790598 -------- 5819425 -------- 5846341 -------- 5874656 -------- 5908067 -------- 5933572 -------- 5962659 -------- 5999971
                │    │         │         │    │    │         │   histogram(40)=  0       0        3150.6      4200      25805      3600      25805      3600      26405      3600      28805      1200      27605      2400      27005      3600      28805      1200      27005      4800      28205      3000      25205      4800      28805      4800      28805      600       28205      1200      24604      6601      24604      4800      28205      3600      27605      3600      27005      4200      28205      2400      28205      4200      28805      1200      28205      1800      28205      1200      28205      3000      27005      4800      28805      600       27005      3600      25805      5401      27005      2400      28205      3000      11502     2300.4
                │    │         │         │    │    │         │                 <--- '1993-12-31' -------- '1994-01-02' ------- '1994-01-16' ------- '1994-01-30' ------- '1994-02-08' ------- '1994-02-18' ------- '1994-03-04' ------- '1994-03-15' ------- '1994-03-29' ------- '1994-04-10' ------- '1994-04-24' ------- '1994-05-03' ------- '1994-05-13' ------- '1994-05-24' ------- '1994-06-04' ------- '1994-06-13' ------- '1994-06-22' ------- '1994-07-05' ------- '1994-07-16' ------- '1994-07-29' ------- '1994-08-09' ------- '1994-08-22' ------- '1994-09-04' ------- '1994-09-15' ------- '1994-09-29' ------- '1994-10-10' ------- '1994-10-20' ------- '1994-11-03' ------- '1994-11-16' ------- '1994-11-29' ------- '1994-12-11' ------- '1994-12-25' ------- '1994-12-31'
                │    │         │         │    │    │         ├── key: (30,33)
                │    │         │         │    │    │         └── fd: (30,33)-->(40)
                │    │         │         │    │    ├── scan partsupp
                │    │         │         │    │    │    ├── save-table-name: q20_scan_14
                │    │         │         │    │    │    ├── columns: ps_partkey:14(int!null) ps_suppkey:15(int!null) ps_availqty:16(int!null)
                │    │         │         │    │    │    ├── stats: [rows=800000, distinct(14)=199241, null(14)=0, distinct(15)=9920, null(15)=0, distinct(16)=9920, null(16)=0, distinct(14,15)=798302, null(14,15)=0]
                │    │         │         │    │    │    │   histogram(14)=  0 80  3920  80   3920   80   3920   80   3920   80   3840  160   3840  160   3920   80   3920   80   3920   80   3920   80   3920   160   3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3840   160   3920   80    3920   80    3920   80    3920   80    3920   160   3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3840   160   3920   80    3920   80    3920   160   3920   80    3920   160   3920   80    3920   80    3920   80    3920   80    3920   80    3920   160   3920   80    3920   80    3920   80    3920   80    3920   80    3920   160   3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920   80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    3920    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    3920   160    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80    4000    80
                │    │         │         │    │    │    │                 <--- 4 ------ 793 ------ 1856 ------ 2808 ------ 3809 ------ 4923 ------ 5975 ------ 6944 ------ 8085 ------ 8945 ------ 9831 ------ 10952 ------ 11932 ------ 12775 ------ 13849 ------ 14925 ------ 16016 ------ 16828 ------ 17768 ------ 18705 ------ 19631 ------ 20600 ------ 21491 ------ 22254 ------ 23327 ------ 24491 ------ 25470 ------ 26331 ------ 27327 ------ 28308 ------ 29359 ------ 30542 ------ 31592 ------ 32495 ------ 33408 ------ 34624 ------ 35726 ------ 36676 ------ 37637 ------ 38485 ------ 39368 ------ 40372 ------ 41034 ------ 42185 ------ 43333 ------ 44466 ------ 45440 ------ 46571 ------ 47469 ------ 48346 ------ 49379 ------ 50571 ------ 51830 ------ 52967 ------ 53673 ------ 54656 ------ 55504 ------ 56539 ------ 57393 ------ 58366 ------ 59577 ------ 60559 ------ 61676 ------ 62471 ------ 63421 ------ 64449 ------ 65409 ------ 66254 ------ 67127 ------ 68127 ------ 69177 ------ 70183 ------ 71209 ------ 72101 ------ 73102 ------ 73994 ------ 74899 ------ 76016 ------ 77098 ------ 77842 ------ 79137 ------ 80242 ------ 81364 ------ 82331 ------ 83158 ------ 84283 ------ 85282 ------ 86437 ------ 87450 ------ 88419 ------ 89493 ------ 90478 ------ 91468 ------ 92552 ------ 93200 ------ 94191 ------ 95067 ------ 96272 ------ 97228 ------ 98126 ------ 99198 ------ 100219 ------ 101057 ------ 102038 ------ 102775 ------ 103711 ------ 104623 ------ 105710 ------ 106734 ------ 107932 ------ 109255 ------ 110220 ------ 111235 ------ 112174 ------ 113260 ------ 114081 ------ 115103 ------ 115864 ------ 116794 ------ 117741 ------ 118712 ------ 119470 ------ 120528 ------ 121572 ------ 122536 ------ 123629 ------ 124404 ------ 125301 ------ 126257 ------ 127139 ------ 128267 ------ 129258 ------ 130442 ------ 131845 ------ 133164 ------ 134005 ------ 135076 ------ 135868 ------ 137297 ------ 138777 ------ 139806 ------ 140741 ------ 141896 ------ 142719 ------ 143727 ------ 144645 ------ 145510 ------ 146507 ------ 147449 ------ 148467 ------ 149635 ------ 150563 ------ 151751 ------ 152613 ------ 153416 ------ 154612 ------ 155853 ------ 156866 ------ 158311 ------ 159230 ------ 160390 ------ 161455 ------ 162555 ------ 163435 ------ 164549 ------ 165663 ------ 166891 ------ 167757 ------ 168732 ------ 169644 ------ 170532 ------ 171671 ------ 172778 ------ 173599 ------ 174321 ------ 175624 ------ 176663 ------ 177632 ------ 178555 ------ 179551 ------ 180510 ------ 181682 ------ 182648 ------ 183408 ------ 184543 ------ 185722 ------ 186713 ------ 187787 ------ 188730 ------ 189604 ------ 190711 ------ 191690 ------ 192692 ------ 193702 ------ 194685 ------ 195725 ------ 196730 ------ 197724 ------ 198701 ------ 199973
                │    │         │         │    │    │    │   histogram(15)=  0 80  3920 240  3920  80  3920  160  3920  80   3920  240  3920  80   3760  320  3680  320  3920  80   3920  160  3920  240  3920  80   3920  160  3840  160  3920  80   3920  80   3760  240  3840  160  3920  80   3840  160  3680  320   3920   80   3840  160   3840  160   3760  320   3840  160   3840  160   3920   80   3840  240   3920   80   3920   80   3840  160   3760  240   3920  160   3920   80   3920   80   3920   80   3920  320   3920   80   3920  160   3840  400   3760  240   3920  160   3920  160   3600  480   3920   80   3680  320   3840  160   3840  160   3920  240   3840  160   3920  160   3920   80   3920  160   3920   80   3760  240   3920   80   3920   80   3840  320   3840  160   3840  160   3920  240   3840  480   3920  160   3840  240   3920  160   3920  160   3920   80   3840  160   3920   80   3920   80   3920   80   3920   80   3840  240   3840  240   3920   80   3840  320   3920   80   3920   80   3920  240   3840  240   3920  160   3920   80   3840  160   3840  240   3920  240   3840   80   3680  320   3920  160   3840  160   3840   80   3920   80   3840  160   3840  160   3920   80   3920   80   3840  160   3920   80   3920  160   3840  240   3840   80   3840  160   3760  160   3920   80   3920   80   3840  240   3760  240   3840   80   3920  160   3840   80   3920   80   3920   80   3920   80   3920  160   3840   80   3920   80   3760  240   3920   80   3920  160   3760  160   3920  160   3840   80   3920  160   3840  160   3840  160   3600  320   3920  160   3840   80   3920   80   3680  320   3840  240   3760  160   3920   80   3920   80   3920   80   3920   80   3920   80   3680  320   3920  160   3840  160   3760  160   3920  240   3840  160   3840  240   3600  320   3840   80   3840   80   3920  160   3760  160   3840  160   3840  320   3840   80   3840  160   3760  240   3840   80   3840  240   3760  160   3840  160   3840  160   3920  240   3760  160   3840   80   3920  160   3680  240   3840  160   3840  160   3760  240   3920   80   3920  240   3760  160   3760  240   3840   80   3840  240   3840  240   3760  320   3760  240   3840   80   3840  160   3840  240   3760  320   3760  160   3840  160   3840  160   3840   80   3760  160   3840   80   3840  160   3920  160   3840   80   3920   80   3840  160   3920   80   3840  240   3840   80   3920   80   3760  240   3920  240   3840   80   3680   240
                │    │         │         │    │    │    │                 <--- 2 ------ 49 ------ 90 ------ 141 ------ 183 ------ 235 ------ 278 ------ 319 ------ 360 ------ 406 ------ 458 ------ 511 ------ 561 ------ 622 ------ 674 ------ 731 ------ 781 ------ 822 ------ 882 ------ 934 ------ 988 ------ 1026 ------ 1072 ------ 1114 ------ 1188 ------ 1245 ------ 1291 ------ 1335 ------ 1380 ------ 1433 ------ 1488 ------ 1537 ------ 1590 ------ 1642 ------ 1692 ------ 1751 ------ 1807 ------ 1846 ------ 1887 ------ 1939 ------ 1994 ------ 2045 ------ 2097 ------ 2139 ------ 2190 ------ 2240 ------ 2293 ------ 2344 ------ 2385 ------ 2427 ------ 2484 ------ 2538 ------ 2601 ------ 2651 ------ 2730 ------ 2781 ------ 2825 ------ 2874 ------ 2938 ------ 2978 ------ 3034 ------ 3086 ------ 3139 ------ 3179 ------ 3231 ------ 3274 ------ 3334 ------ 3387 ------ 3431 ------ 3477 ------ 3530 ------ 3581 ------ 3633 ------ 3680 ------ 3725 ------ 3775 ------ 3820 ------ 3876 ------ 3923 ------ 3982 ------ 4036 ------ 4078 ------ 4116 ------ 4183 ------ 4227 ------ 4275 ------ 4336 ------ 4376 ------ 4424 ------ 4481 ------ 4537 ------ 4582 ------ 4630 ------ 4680 ------ 4727 ------ 4779 ------ 4828 ------ 4881 ------ 4938 ------ 4986 ------ 5040 ------ 5087 ------ 5138 ------ 5188 ------ 5237 ------ 5280 ------ 5318 ------ 5358 ------ 5405 ------ 5459 ------ 5516 ------ 5561 ------ 5615 ------ 5681 ------ 5744 ------ 5790 ------ 5847 ------ 5885 ------ 5927 ------ 5991 ------ 6042 ------ 6111 ------ 6165 ------ 6207 ------ 6259 ------ 6313 ------ 6359 ------ 6418 ------ 6471 ------ 6530 ------ 6587 ------ 6626 ------ 6672 ------ 6739 ------ 6784 ------ 6837 ------ 6886 ------ 6952 ------ 6994 ------ 7040 ------ 7081 ------ 7134 ------ 7178 ------ 7232 ------ 7280 ------ 7330 ------ 7378 ------ 7435 ------ 7486 ------ 7537 ------ 7593 ------ 7636 ------ 7680 ------ 7737 ------ 7788 ------ 7836 ------ 7877 ------ 7928 ------ 7993 ------ 8036 ------ 8083 ------ 8135 ------ 8180 ------ 8221 ------ 8263 ------ 8313 ------ 8352 ------ 8399 ------ 8453 ------ 8517 ------ 8566 ------ 8612 ------ 8664 ------ 8716 ------ 8766 ------ 8821 ------ 8871 ------ 8922 ------ 8956 ------ 9007 ------ 9050 ------ 9100 ------ 9154 ------ 9203 ------ 9246 ------ 9311 ------ 9358 ------ 9407 ------ 9470 ------ 9525 ------ 9564 ------ 9633 ------ 9672 ------ 9730 ------ 9778 ------ 9824 ------ 9868 ------ 9919 ------ 9959 ------ 10000
                │    │         │         │    │    │    ├── key: (14,15)
                │    │         │         │    │    │    └── fd: (14,15)-->(16)
                │    │         │         │    │    └── filters
                │    │         │         │    │         ├── l_partkey:31 = ps_partkey:14 [type=bool, outer=(14,31), constraints=(/14: (/NULL - ]; /31: (/NULL - ]), fd=(14)==(31), (31)==(14)]
                │    │         │         │    │         └── l_suppkey:32 = ps_suppkey:15 [type=bool, outer=(15,32), constraints=(/15: (/NULL - ]; /32: (/NULL - ]), fd=(15)==(32), (32)==(15)]
                │    │         │         │    └── aggregations
                │    │         │         │         ├── sum [as=sum:47, type=float, outer=(34)]
                │    │         │         │         │    └── l_quantity:34 [type=float]
                │    │         │         │         └── const-agg [as=ps_availqty:16, type=int, outer=(16)]
                │    │         │         │              └── ps_availqty:16 [type=int]
                │    │         │         └── filters
                │    │         │              └── ps_availqty:16 > (sum:47 * 0.5) [type=bool, outer=(16,47), immutable, constraints=(/16: (/NULL - ])]
                │    │         └── filters
                │    │              └── p_name:21 LIKE 'forest%' [type=bool, outer=(21), constraints=(/21: [/'forest' - /'foresu'); tight)]
                │    └── filters (true)
                ├── select
                │    ├── save-table-name: q20_select_15
                │    ├── columns: n_nationkey:9(int!null) n_name:10(char!null)
                │    ├── stats: [rows=1, distinct(9)=1, null(9)=0, distinct(10)=1, null(10)=0]
                │    ├── key: (9)
                │    ├── fd: ()-->(10)
                │    ├── scan nation
                │    │    ├── save-table-name: q20_scan_16
                │    │    ├── columns: n_nationkey:9(int!null) n_name:10(char!null)
                │    │    ├── stats: [rows=25, distinct(9)=25, null(9)=0, distinct(10)=25, null(10)=0]
                │    │    │   histogram(9)=  0  1  0  1  0  1  0  1  0  1  0  1  0  1  0  1  0  1  0  1  0  1   0  1   0  1   0  1   0  1   0  1   0  1   0  1   0  1   0  1   0  1   0  1   0  1   0  1   0  1
                │    │    │                <--- 0 --- 1 --- 2 --- 3 --- 4 --- 5 --- 6 --- 7 --- 8 --- 9 --- 10 --- 11 --- 12 --- 13 --- 14 --- 15 --- 16 --- 17 --- 18 --- 19 --- 20 --- 21 --- 22 --- 23 --- 24
                │    │    ├── key: (9)
                │    │    └── fd: (9)-->(10)
                │    └── filters
                │         └── n_name:10 = 'CANADA' [type=bool, outer=(10), constraints=(/10: [/'CANADA' - /'CANADA']; tight), fd=()-->(10)]
                └── filters
                     └── s_nationkey:4 = n_nationkey:9 [type=bool, outer=(4,9), constraints=(/4: (/NULL - ]; /9: (/NULL - ]), fd=(4)==(9), (9)==(4)]

stats table=q20_sort_1
----
column_names  row_count  distinct_count  null_count
{s_address}   186        186             0
{s_name}      186        186             0
~~~~
column_names  row_count_est  row_count_err  distinct_count_est  distinct_count_err  null_count_est  null_count_err
{s_address}   5.00           37.20 <==      5.00                37.20 <==           0.00            1.00
{s_name}      5.00           37.20 <==      5.00                37.20 <==           0.00            1.00

stats table=q20_project_2
----
column_names  row_count  distinct_count  null_count
{s_address}   186        186             0
{s_name}      186        186             0
~~~~
column_names  row_count_est  row_count_err  distinct_count_est  distinct_count_err  null_count_est  null_count_err
{s_address}   5.00           37.20 <==      5.00                37.20 <==           0.00            1.00
{s_name}      5.00           37.20 <==      5.00                37.20 <==           0.00            1.00

stats table=q20_project_3
----
column_names   row_count  distinct_count  null_count
{n_name}       186        1               0
{n_nationkey}  186        1               0
{s_address}    186        186             0
{s_name}       186        186             0
{s_nationkey}  186        1               0
{s_suppkey}    186        186             0
~~~~
column_names   row_count_est  row_count_err  distinct_count_est  distinct_count_err  null_count_est  null_count_err
{n_name}       5.00           37.20 <==      1.00                1.00                0.00            1.00
{n_nationkey}  5.00           37.20 <==      1.00                1.00                0.00            1.00
{s_address}    5.00           37.20 <==      5.00                37.20 <==           0.00            1.00
{s_name}       5.00           37.20 <==      5.00                37.20 <==           0.00            1.00
{s_nationkey}  5.00           37.20 <==      1.00                1.00                0.00            1.00
{s_suppkey}    5.00           37.20 <==      5.00                37.20 <==           0.00            1.00

stats table=q20_inner_join_4
----
column_names   row_count  distinct_count  null_count
{n_name}       186        1               0
{n_nationkey}  186        1               0
{ps_suppkey}   186        186             0
{s_address}    186        186             0
{s_name}       186        186             0
{s_nationkey}  186        1               0
{s_suppkey}    186        186             0
~~~~
column_names   row_count_est  row_count_err  distinct_count_est  distinct_count_err  null_count_est  null_count_err
{n_name}       127.00         1.46           1.00                1.00                0.00            1.00
{n_nationkey}  127.00         1.46           1.00                1.00                0.00            1.00
{ps_suppkey}   127.00         1.46           127.00              1.46                0.00            1.00
{s_address}    127.00         1.46           109.00              1.71                0.00            1.00
{s_name}       127.00         1.46           109.00              1.71                0.00            1.00
{s_nationkey}  127.00         1.46           1.00                1.00                0.00            1.00
{s_suppkey}    127.00         1.46           127.00              1.46                0.00            1.00

stats table=q20_lookup_join_5
----
column_names   row_count  distinct_count  null_count
{ps_suppkey}   4397       4434            0
{s_address}    4397       4369            0
{s_name}       4397       4373            0
{s_nationkey}  4397       25              0
{s_suppkey}    4397       4434            0
~~~~
column_names   row_count_est  row_count_err  distinct_count_est  distinct_count_err  null_count_est  null_count_err
{ps_suppkey}   128.00         34.35 <==      127.00              34.91 <==           0.00            1.00
{s_address}    128.00         34.35 <==      127.00              34.40 <==           0.00            1.00
{s_name}       128.00         34.35 <==      127.00              34.43 <==           0.00            1.00
{s_nationkey}  128.00         34.35 <==      25.00               1.00                0.00            1.00
{s_suppkey}    128.00         34.35 <==      127.00              34.91 <==           0.00            1.00

stats table=q20_distinct_on_6
----
column_names  row_count  distinct_count  null_count
{ps_suppkey}  4397       4434            0
~~~~
column_names  row_count_est  row_count_err  distinct_count_est  distinct_count_err  null_count_est  null_count_err
{ps_suppkey}  127.00         34.62 <==      127.00              34.91 <==           0.00            1.00

stats table=q20_lookup_join_7
----
column_names  row_count  distinct_count  null_count
{ps_partkey}  5833       2106            0
{ps_suppkey}  5833       4434            0
~~~~
column_names  row_count_est  row_count_err  distinct_count_est  distinct_count_err  null_count_est  null_count_err
{ps_partkey}  127.00         45.93 <==      127.00              16.58 <==           0.00            1.00
{ps_suppkey}  127.00         45.93 <==      127.00              34.91 <==           0.00            1.00

stats table=q20_project_8
----
column_names  row_count  distinct_count  null_count
{ps_partkey}  542095     197197          0
{ps_suppkey}  542095     9920            0
~~~~
column_names  row_count_est  row_count_err  distinct_count_est  distinct_count_err  null_count_est  null_count_err
{ps_partkey}  127.00         4268.46 <==    127.00              1552.73 <==         0.00            1.00
{ps_suppkey}  127.00         4268.46 <==    127.00              78.11 <==           0.00            1.00

stats table=q20_select_9
----
column_names   row_count  distinct_count  null_count
{ps_availqty}  542095     9920            0
{ps_partkey}   542095     197197          0
{ps_suppkey}   542095     9920            0
{sum}          542095     246             0
~~~~
column_names   row_count_est  row_count_err  distinct_count_est  distinct_count_err  null_count_est  null_count_err
{ps_availqty}  127.00         4268.46 <==    127.00              78.11 <==           0.00            1.00
{ps_partkey}   127.00         4268.46 <==    127.00              1552.73 <==         0.00            1.00
{ps_suppkey}   127.00         4268.46 <==    127.00              78.11 <==           0.00            1.00
{sum}          127.00         4268.46 <==    127.00              1.94 <==            0.00            1.00

stats table=q20_group_by_10
----
column_names   row_count  distinct_count  null_count
{ps_availqty}  543210     9920            0
{ps_partkey}   543210     197252          0
{ps_suppkey}   543210     9920            0
{sum}          543210     246             0
~~~~
column_names   row_count_est  row_count_err  distinct_count_est  distinct_count_err  null_count_est  null_count_err
{ps_availqty}  380.00         1429.50 <==    380.00              26.11 <==           0.00            1.00
{ps_partkey}   380.00         1429.50 <==    380.00              519.08 <==          0.00            1.00
{ps_suppkey}   380.00         1429.50 <==    380.00              26.11 <==           0.00            1.00
{sum}          380.00         1429.50 <==    380.00              1.54                0.00            1.00

stats table=q20_inner_join_11
----
column_names   row_count  distinct_count  null_count
{l_partkey}    909455     197252          0
{l_quantity}   909455     50              0
{l_shipdate}   909455     365             0
{l_suppkey}    909455     9920            0
{ps_availqty}  909455     9920            0
{ps_partkey}   909455     197252          0
{ps_suppkey}   909455     9920            0
~~~~
column_names   row_count_est  row_count_err  distinct_count_est  distinct_count_err  null_count_est  null_count_err
{l_partkey}    380.00         2393.30 <==    380.00              519.08 <==          0.00            1.00
{l_quantity}   380.00         2393.30 <==    50.00               1.00                0.00            1.00
{l_shipdate}   380.00         2393.30 <==    236.00              1.55                0.00            1.00
{l_suppkey}    380.00         2393.30 <==    380.00              26.11 <==           0.00            1.00
{ps_availqty}  380.00         2393.30 <==    373.00              26.60 <==           0.00            1.00
{ps_partkey}   380.00         2393.30 <==    380.00              519.08 <==          0.00            1.00
{ps_suppkey}   380.00         2393.30 <==    380.00              26.11 <==           0.00            1.00

stats table=q20_index_join_12
----
column_names  row_count  distinct_count  null_count
{l_partkey}   909455     197252          0
{l_quantity}  909455     50              0
{l_shipdate}  909455     365             0
{l_suppkey}   909455     9920            0
~~~~
column_names  row_count_est  row_count_err  distinct_count_est  distinct_count_err  null_count_est  null_count_err
{l_partkey}   938138.00      1.03           198050.00           1.00                0.00            1.00
{l_quantity}  938138.00      1.03           50.00               1.00                0.00            1.00
{l_shipdate}  938138.00      1.03           365.00              1.00                0.00            1.00
{l_suppkey}   938138.00      1.03           9920.00             1.00                0.00            1.00

stats table=q20_scan_13
----
column_names    row_count  distinct_count  null_count
{l_linenumber}  909455     7               0
{l_orderkey}    909455     266035          0
{l_shipdate}    909455     365             0
~~~~
column_names    row_count_est  row_count_err  distinct_count_est  distinct_count_err  null_count_est  null_count_err
{l_linenumber}  938138.00      1.03           7.00                1.00                0.00            1.00
{l_orderkey}    938138.00      1.03           744145.00           2.80 <==            0.00            1.00
{l_shipdate}    938138.00      1.03           365.00              1.00                0.00            1.00

stats table=q20_scan_14
----
column_names   row_count  distinct_count  null_count
{ps_availqty}  800000     9920            0
{ps_partkey}   800000     199241          0
{ps_suppkey}   800000     9920            0
~~~~
column_names   row_count_est  row_count_err  distinct_count_est  distinct_count_err  null_count_est  null_count_err
{ps_availqty}  800000.00      1.00           9920.00             1.00                0.00            1.00
{ps_partkey}   800000.00      1.00           199241.00           1.00                0.00            1.00
{ps_suppkey}   800000.00      1.00           9920.00             1.00                0.00            1.00

stats table=q20_select_15
----
column_names   row_count  distinct_count  null_count
{n_name}       1          1               0
{n_nationkey}  1          1               0
~~~~
column_names   row_count_est  row_count_err  distinct_count_est  distinct_count_err  null_count_est  null_count_err
{n_name}       1.00           1.00           1.00                1.00                0.00            1.00
{n_nationkey}  1.00           1.00           1.00                1.00                0.00            1.00

stats table=q20_scan_16
----
column_names   row_count  distinct_count  null_count
{n_name}       25         25              0
{n_nationkey}  25         25              0
~~~~
column_names   row_count_est  row_count_err  distinct_count_est  distinct_count_err  null_count_est  null_count_err
{n_name}       25.00          1.00           25.00               1.00                0.00            1.00
{n_nationkey}  25.00          1.00           25.00               1.00                0.00            1.00
