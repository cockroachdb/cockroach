exec
CREATE TABLE t.orders (oid INT PRIMARY KEY, cid INT, value DECIMAL, date DATE)
----

# In the string version, the constants are not anonymized.
plan-string
SELECT oid FROM t.orders WHERE oid = 123
----
      distribution         local
      vectorized           false
scan                                          (oid int)
      estimated row count  1 (missing stats)
      table                orders@primary
      spans                /123-/123/#

plan-tree
SELECT oid FROM t.orders WHERE oid = 123
----
name: scan
attrs:
- key: missing stats
  value: ""
- key: table
  value: orders@primary
- key: spans
  value: 1 span
children: []

plan-string
SELECT cid, date, value FROM t.orders
----
      distribution         local
      vectorized           false
scan                                             (cid int, date date, value decimal)
      estimated row count  1000 (missing stats)
      table                orders@primary
      spans                FULL SCAN

plan-tree
SELECT cid, date, value FROM t.orders
----
name: scan
attrs:
- key: missing stats
  value: ""
- key: table
  value: orders@primary
- key: spans
  value: FULL SCAN
children: []

plan-string
SELECT cid, sum(value) FROM t.orders WHERE date > '2015-01-01' GROUP BY cid ORDER BY 1 - sum(value)
----
                                    distribution         local
                                    vectorized           false
project                                                                                               (cid int, sum decimal)
 └── sort                                                                                             (column7 decimal, cid int, sum decimal)  +column7
      │                             estimated row count  98 (missing stats)
      │                             order                +column7
      └── render                                                                                      (column7 decimal, cid int, sum decimal)
           │                        estimated row count  98 (missing stats)
           │                        render 0             ((1)[decimal] - (sum)[decimal])[decimal]
           │                        render 1             (cid)[int]
           │                        render 2             (sum)[decimal]
           └── group                                                                                  (cid int, sum decimal)
                │                   estimated row count  98 (missing stats)
                │                   aggregate 0          sum(value)
                │                   group by             cid
                └── project                                                                           (cid int, value decimal)
                     └── filter                                                                       (cid int, value decimal, date date)
                          │         estimated row count  333 (missing stats)
                          │         filter               ((date)[date] > ('2015-01-01')[date])[bool]
                          └── scan                                                                    (cid int, value decimal, date date)
                                    estimated row count  1000 (missing stats)
                                    table                orders@primary
                                    spans                FULL SCAN

plan-tree
SELECT cid, sum(value) FROM t.orders WHERE date > '2015-01-01' GROUP BY cid ORDER BY 1 - sum(value)
----
name: sort
attrs:
- key: order
  value: +column7
children:
- name: render
  attrs: []
  children:
  - name: group
    attrs:
    - key: group by
      value: cid
    children:
    - name: filter
      attrs:
      - key: filter
        value: date > _
      children:
      - name: scan
        attrs:
        - key: missing stats
          value: ""
        - key: table
          value: orders@primary
        - key: spans
          value: FULL SCAN
        children: []

plan-string
SELECT value FROM (SELECT cid, date, value FROM t.orders)
----
      distribution         local
      vectorized           false
scan                                             (value decimal)
      estimated row count  1000 (missing stats)
      table                orders@primary
      spans                FULL SCAN

plan-tree
SELECT value FROM (SELECT cid, date, value FROM t.orders)
----
name: scan
attrs:
- key: missing stats
  value: ""
- key: table
  value: orders@primary
- key: spans
  value: FULL SCAN
children: []

plan-string
SELECT cid, date, value FROM t.orders WHERE date IN (SELECT date FROM t.orders)
----
                        distribution         local
                        vectorized           false
project                                                            (cid int, date date, value decimal)
 │                      estimated row count  1000 (missing stats)
 └── hash join (inner)                                             (cid int, value decimal, date date, date date)
      │                 estimated row count  980 (missing stats)
      │                 equality             (date) = (date)
      │                 right cols are key
      ├── scan                                                     (cid int, value decimal, date date)
      │                 estimated row count  1000 (missing stats)
      │                 table                orders@primary
      │                 spans                FULL SCAN
      └── distinct                                                 (date date)
           │            estimated row count  100 (missing stats)
           │            distinct on          date
           └── scan                                                (date date)
                        estimated row count  1000 (missing stats)
                        table                orders@primary
                        spans                FULL SCAN

plan-tree
SELECT cid, date, value FROM t.orders WHERE date IN (SELECT date FROM t.orders)
----
name: hash join
attrs:
- key: equality
  value: (date) = (date)
- key: right cols are key
  value: ""
children:
- name: scan
  attrs:
  - key: missing stats
    value: ""
  - key: table
    value: orders@primary
  - key: spans
    value: FULL SCAN
  children: []
- name: distinct
  attrs:
  - key: distinct on
    value: date
  children:
  - name: scan
    attrs:
    - key: missing stats
      value: ""
    - key: table
      value: orders@primary
    - key: spans
      value: FULL SCAN
    children: []

exec
CREATE TABLE t.movies (
  id SERIAL PRIMARY KEY,
  title TEXT,
  released INT
)
----

exec
CREATE TABLE t.actors (
  id SERIAL PRIMARY KEY,
  name TEXT
)
----

# Subquery.
plan-string
SELECT id AS movie_id, title, (SELECT name FROM t.actors WHERE name = 'Foo') FROM t.movies
----
                          distribution         local
                          vectorized           false
root                                                                                           (movie_id int, title string, name string)
 ├── render                                                                                    (movie_id int, title string, name string)
 │    │                   estimated row count  1000 (missing stats)
 │    │                   render 0             (@S1)[string]
 │    │                   render 1             (id)[int]
 │    │                   render 2             (title)[string]
 │    └── scan                                                                                 (id int, title string)
 │                        estimated row count  1000 (missing stats)
 │                        table                movies@primary
 │                        spans                FULL SCAN
 └── subquery
      │                   id                   @S1
      │                   original sql         (SELECT name FROM t.actors WHERE name = 'Foo')
      │                   exec mode            one row
      └── max1row                                                                              (name string)
           │              estimated row count  1
           └── filter                                                                          (name string)
                │         estimated row count  10 (missing stats)
                │         filter               ((name)[string] = ('Foo')[string])[bool]
                └── scan                                                                       (name string)
                          estimated row count  1000 (missing stats)
                          table                actors@primary
                          spans                FULL SCAN

plan-tree
SELECT id AS movie_id, title, (SELECT name FROM t.actors WHERE name = 'Foo') FROM t.movies
----
name: root
attrs: []
children:
- name: render
  attrs: []
  children:
  - name: scan
    attrs:
    - key: missing stats
      value: ""
    - key: table
      value: movies@primary
    - key: spans
      value: FULL SCAN
    children: []
- name: subquery
  attrs:
  - key: id
    value: '@S1'
  - key: original sql
    value: (SELECT name FROM t.actors WHERE name = 'Foo')
  - key: exec mode
    value: one row
  children:
  - name: max1row
    attrs: []
    children:
    - name: filter
      attrs:
      - key: filter
        value: name = _
      children:
      - name: scan
        attrs:
        - key: missing stats
          value: ""
        - key: table
          value: actors@primary
        - key: spans
          value: FULL SCAN
        children: []
