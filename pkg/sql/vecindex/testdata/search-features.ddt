# Load 500 512-dimension features and search them. Use small partition size to
# ensure a deeper tree.

new-index dims=512 min-partition-size=4 max-partition-size=16 quality-samples=8 beam-size=4 load-features=1000 hide-tree
----
Created index with 1000 vectors with 512 dimensions.

# Start with 1 result and default beam size of 4.
search max-results=1 use-feature=5000
----
vec117: 0.7576 (centroid=0.5439)
52 leaf vectors, 81 vectors, 4 full vectors, 7 partitions

# Search for additional results.
search max-results=6 use-feature=5000
----
vec117: 0.7576 (centroid=0.5439)
vec556: 0.7595 (centroid=0.5235)
vec457: 0.8084 (centroid=0.4855)
vec879: 0.8291 (centroid=0.7103)
vec968: 0.85 (centroid=0.5089)
vec326: 0.8592 (centroid=0.5047)
52 leaf vectors, 81 vectors, 19 full vectors, 7 partitions

# Use a larger beam size.
search max-results=6 use-feature=5000 beam-size=8
----
vec771: 0.5624 (centroid=0.601)
vec356: 0.5976 (centroid=0.4792)
vec640: 0.6525 (centroid=0.5295)
vec302: 0.6601 (centroid=0.504)
vec249: 0.7268 (centroid=0.4463)
vec309: 0.7311 (centroid=0.5252)
100 leaf vectors, 147 vectors, 24 full vectors, 13 partitions

# Turn off re-ranking, which results in increased inaccuracy.
search max-results=6 use-feature=5000 beam-size=8 skip-rerank
----
vec771: 0.5835 ±0.0413 (centroid=0.601)
vec356: 0.6015 ±0.0305 (centroid=0.4792)
vec302: 0.6659 ±0.032 (centroid=0.504)
vec640: 0.6718 ±0.0361 (centroid=0.5295)
vec309: 0.7326 ±0.0361 (centroid=0.5252)
vec249: 0.7368 ±0.031 (centroid=0.4463)
100 leaf vectors, 147 vectors, 0 full vectors, 13 partitions

# Return top 25 results with large beam size.
search max-results=25 use-feature=5000 beam-size=32
----
vec771: 0.5624 (centroid=0.601)
vec356: 0.5976 (centroid=0.4792)
vec640: 0.6525 (centroid=0.5295)
vec302: 0.6601 (centroid=0.504)
vec329: 0.6871 (centroid=0.5296)
vec95: 0.7008 (centroid=0.5872)
vec249: 0.7268 (centroid=0.4463)
vec386: 0.7301 (centroid=0.5489)
vec309: 0.7311 (centroid=0.5252)
vec633: 0.7513 (centroid=0.4483)
vec117: 0.7576 (centroid=0.5439)
vec556: 0.7595 (centroid=0.5235)
vec25: 0.761 (centroid=0.4471)
vec859: 0.7708 (centroid=0.5824)
vec240: 0.7723 (centroid=0.5999)
vec347: 0.7745 (centroid=0.5255)
vec11: 0.777 (centroid=0.5791)
vec340: 0.7858 (centroid=0.5709)
vec239: 0.7878 (centroid=0.4782)
vec423: 0.7956 (centroid=0.4699)
vec220: 0.7957 (centroid=0.4546)
vec848: 0.7958 (centroid=0.5976)
vec387: 0.8038 (centroid=0.4427)
vec637: 0.8039 (centroid=0.5122)
vec410: 0.8062 (centroid=0.5032)
352 leaf vectors, 449 vectors, 85 full vectors, 41 partitions

# Test recall at different beam sizes.
recall topk=10 beam-size=4 samples=50
----
55.40% recall@10
48.40 leaf vectors, 78.02 vectors, 20.46 full vectors, 7.00 partitions

recall topk=10 beam-size=8 samples=50
----
77.00% recall@10
94.84 leaf vectors, 147.08 vectors, 25.28 full vectors, 13.00 partitions

recall topk=10 beam-size=16 samples=50
----
90.20% recall@10
187.36 leaf vectors, 284.36 vectors, 29.54 full vectors, 25.00 partitions

recall topk=10 beam-size=32 samples=50
----
98.80% recall@10
369.10 leaf vectors, 466.10 vectors, 32.90 full vectors, 41.00 partitions
