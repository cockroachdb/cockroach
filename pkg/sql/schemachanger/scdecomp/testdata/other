setup
CREATE DATABASE db1;
COMMENT ON DATABASE db1 IS 'db1 is good';
CREATE SCHEMA db1.sc1;
COMMENT ON SCHEMA db1.sc1 IS 'sc1 is good';
CREATE SEQUENCE db1.public.sq1;
CREATE SEQUENCE db1.sc1.sq1;
CREATE TABLE db1.sc1.t1 (id INT PRIMARY KEY, val INT DEFAULT nextval('db1.sc1.sq1'));
CREATE TYPE db1.sc1.typ AS ENUM('a');
CREATE VIEW db1.sc1.v1 AS (SELECT id FROM db1.sc1.t1);
CREATE VIEW db1.sc1.v2 AS (SELECT 'a'::db1.sc1.typ::STRING AS k, id FROM db1.sc1.v1);
----

setup
USE db1;
CREATE USER u1;
CREATE USER u2;
GRANT u1 TO root;
ALTER DEFAULT PRIVILEGES FOR ALL ROLES IN SCHEMA sc1 GRANT SELECT,UPDATE ON TABLES TO u2;
ALTER DEFAULT PRIVILEGES FOR ROLE u1 IN SCHEMA sc1 GRANT SELECT,UPDATE ON TABLES TO u2;
ALTER DEFAULT PRIVILEGES FOR ALL ROLES GRANT DELETE ON TABLES TO u2;
ALTER DEFAULT PRIVILEGES FOR ROLE u1 GRANT DELETE ON TABLES TO u2;
USE defaultdb;
----

decompose
sc1
----
BackReferencedIDs:
ElementState:
- Namespace:
    databaseId: 10000
    descriptorId: 10002
    name: sc1
    schemaId: 0
  Status: PUBLIC
- Owner:
    descriptorId: 10002
    owner: root
  Status: PUBLIC
- Schema:
    isPublic: false
    isTemporary: false
    isVirtual: false
    schemaId: 10002
  Status: PUBLIC
- SchemaComment:
    comment: sc1 is good
    schemaId: 10002
  Status: PUBLIC
- SchemaParent:
    parentDatabaseId: 10000
    schemaId: 10002
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 10002
    privileges: "2"
    userName: admin
    withGrantOption: "2"
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 10002
    privileges: "2"
    userName: root
    withGrantOption: "2"
  Status: PUBLIC

decompose
public
----
BackReferencedIDs:
ElementState:
- Namespace:
    databaseId: 10000
    descriptorId: 10001
    name: public
    schemaId: 0
  Status: PUBLIC
- Owner:
    descriptorId: 10001
    owner: admin
  Status: PUBLIC
- Schema:
    isPublic: true
    isTemporary: false
    isVirtual: false
    schemaId: 10001
  Status: PUBLIC
- SchemaParent:
    parentDatabaseId: 10000
    schemaId: 10001
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 10001
    privileges: "2"
    userName: admin
    withGrantOption: "2"
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 10001
    privileges: "2"
    userName: root
    withGrantOption: "2"
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 10001
    privileges: "516"
    userName: public
    withGrantOption: "0"
  Status: PUBLIC

decompose
db1
----
BackReferencedIDs:
  - 10001
  - 10002
ElementState:
- Database:
    databaseId: 10000
  Status: PUBLIC
- DatabaseComment:
    comment: db1 is good
    databaseId: 10000
  Status: PUBLIC
- DatabaseData:
    databaseId: 10000
  Status: PUBLIC
- DatabaseRoleSetting:
    databaseId: 10000
    roleName: __placeholder_role_name__
  Status: PUBLIC
- Namespace:
    databaseId: 0
    descriptorId: 10000
    name: db1
    schemaId: 0
  Status: PUBLIC
- Owner:
    descriptorId: 10000
    owner: root
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 10000
    privileges: "2"
    userName: admin
    withGrantOption: "2"
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 10000
    privileges: "2"
    userName: root
    withGrantOption: "2"
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 10000
    privileges: "2048"
    userName: public
    withGrantOption: "0"
  Status: PUBLIC

decompose
typ
----
BackReferencedIDs:
  - 10009
ElementState:
- EnumType:
    arrayTypeId: 10007
    isMultiRegion: false
    typeId: 10006
  Status: PUBLIC
- EnumTypeValue:
    logicalRepresentation: a
    physicalRepresentation: gA==
    typeId: 10006
  Status: PUBLIC
- Namespace:
    databaseId: 10000
    descriptorId: 10006
    name: typ
    schemaId: 10002
  Status: PUBLIC
- Owner:
    descriptorId: 10006
    owner: root
  Status: PUBLIC
- SchemaChild:
    childObjectId: 10006
    schemaId: 10002
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 10006
    privileges: "2"
    userName: admin
    withGrantOption: "2"
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 10006
    privileges: "2"
    userName: root
    withGrantOption: "2"
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 10006
    privileges: "512"
    userName: public
    withGrantOption: "0"
  Status: PUBLIC

decompose
v1
----
BackReferencedIDs:
  - 10009
ElementState:
- Column:
    columnId: 1
    generatedAsIdentitySequenceOption: ""
    generatedAsIdentityType: 0
    isHidden: false
    isInaccessible: false
    isSystemColumn: false
    pgAttributeNum: 0
    tableId: 10008
  Status: PUBLIC
- Column:
    columnId: 4.294967294e+09
    generatedAsIdentitySequenceOption: ""
    generatedAsIdentityType: 0
    isHidden: true
    isInaccessible: false
    isSystemColumn: true
    pgAttributeNum: 0
    tableId: 10008
  Status: PUBLIC
- Column:
    columnId: 4.294967295e+09
    generatedAsIdentitySequenceOption: ""
    generatedAsIdentityType: 0
    isHidden: true
    isInaccessible: false
    isSystemColumn: true
    pgAttributeNum: 0
    tableId: 10008
  Status: PUBLIC
- ColumnName:
    columnId: 1
    name: id
    tableId: 10008
  Status: PUBLIC
- ColumnName:
    columnId: 4.294967294e+09
    name: tableoid
    tableId: 10008
  Status: PUBLIC
- ColumnName:
    columnId: 4.294967295e+09
    name: crdb_internal_mvcc_timestamp
    tableId: 10008
  Status: PUBLIC
- ColumnType:
    closedTypeIds: []
    columnId: 1
    computeExpr: null
    elementCreationMetadata:
      in231OrLater: true
    familyId: 0
    isNullable: true
    isVirtual: false
    tableId: 10008
    type:
      arrayContents: null
      arrayDimensions: []
      arrayElemType: null
      family: IntFamily
      geoMetadata: null
      intervalDurationField: null
      locale: null
      oid: 20
      precision: 0
      timePrecisionIsSet: false
      tupleContents: []
      tupleLabels: []
      udtMetadata: null
      visibleType: 0
      width: 64
  Status: PUBLIC
- ColumnType:
    closedTypeIds: []
    columnId: 4.294967294e+09
    computeExpr: null
    elementCreationMetadata:
      in231OrLater: true
    familyId: 0
    isNullable: true
    isVirtual: false
    tableId: 10008
    type:
      arrayContents: null
      arrayDimensions: []
      arrayElemType: null
      family: OidFamily
      geoMetadata: null
      intervalDurationField: null
      locale: null
      oid: 26
      precision: 0
      timePrecisionIsSet: false
      tupleContents: []
      tupleLabels: []
      udtMetadata: null
      visibleType: 0
      width: 0
  Status: PUBLIC
- ColumnType:
    closedTypeIds: []
    columnId: 4.294967295e+09
    computeExpr: null
    elementCreationMetadata:
      in231OrLater: true
    familyId: 0
    isNullable: true
    isVirtual: false
    tableId: 10008
    type:
      arrayContents: null
      arrayDimensions: []
      arrayElemType: null
      family: DecimalFamily
      geoMetadata: null
      intervalDurationField: null
      locale: null
      oid: 1700
      precision: 0
      timePrecisionIsSet: false
      tupleContents: []
      tupleLabels: []
      udtMetadata: null
      visibleType: 0
      width: 0
  Status: PUBLIC
- Namespace:
    databaseId: 10000
    descriptorId: 10008
    name: v1
    schemaId: 10002
  Status: PUBLIC
- Owner:
    descriptorId: 10008
    owner: root
  Status: PUBLIC
- SchemaChild:
    childObjectId: 10008
    schemaId: 10002
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 10008
    privileges: "2"
    userName: admin
    withGrantOption: "2"
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 10008
    privileges: "2"
    userName: root
    withGrantOption: "2"
  Status: PUBLIC
- View:
    forwardReferences:
    - columnIds:
      - 1
      indexId: 0
      toId: 10005
    isMaterialized: false
    isTemporary: false
    usesRelationIds:
    - 10005
    usesTypeIds: []
    viewId: 10008
  Status: PUBLIC

decompose
v2
----
BackReferencedIDs:
ElementState:
- Column:
    columnId: 1
    generatedAsIdentitySequenceOption: ""
    generatedAsIdentityType: 0
    isHidden: false
    isInaccessible: false
    isSystemColumn: false
    pgAttributeNum: 0
    tableId: 10009
  Status: PUBLIC
- Column:
    columnId: 2
    generatedAsIdentitySequenceOption: ""
    generatedAsIdentityType: 0
    isHidden: false
    isInaccessible: false
    isSystemColumn: false
    pgAttributeNum: 0
    tableId: 10009
  Status: PUBLIC
- Column:
    columnId: 4.294967294e+09
    generatedAsIdentitySequenceOption: ""
    generatedAsIdentityType: 0
    isHidden: true
    isInaccessible: false
    isSystemColumn: true
    pgAttributeNum: 0
    tableId: 10009
  Status: PUBLIC
- Column:
    columnId: 4.294967295e+09
    generatedAsIdentitySequenceOption: ""
    generatedAsIdentityType: 0
    isHidden: true
    isInaccessible: false
    isSystemColumn: true
    pgAttributeNum: 0
    tableId: 10009
  Status: PUBLIC
- ColumnName:
    columnId: 1
    name: k
    tableId: 10009
  Status: PUBLIC
- ColumnName:
    columnId: 2
    name: id
    tableId: 10009
  Status: PUBLIC
- ColumnName:
    columnId: 4.294967294e+09
    name: tableoid
    tableId: 10009
  Status: PUBLIC
- ColumnName:
    columnId: 4.294967295e+09
    name: crdb_internal_mvcc_timestamp
    tableId: 10009
  Status: PUBLIC
- ColumnType:
    closedTypeIds: []
    columnId: 1
    computeExpr: null
    elementCreationMetadata:
      in231OrLater: true
    familyId: 0
    isNullable: true
    isVirtual: false
    tableId: 10009
    type:
      arrayContents: null
      arrayDimensions: []
      arrayElemType: null
      family: StringFamily
      geoMetadata: null
      intervalDurationField: null
      locale: null
      oid: 25
      precision: 0
      timePrecisionIsSet: false
      tupleContents: []
      tupleLabels: []
      udtMetadata: null
      visibleType: 0
      width: 0
  Status: PUBLIC
- ColumnType:
    closedTypeIds: []
    columnId: 2
    computeExpr: null
    elementCreationMetadata:
      in231OrLater: true
    familyId: 0
    isNullable: true
    isVirtual: false
    tableId: 10009
    type:
      arrayContents: null
      arrayDimensions: []
      arrayElemType: null
      family: IntFamily
      geoMetadata: null
      intervalDurationField: null
      locale: null
      oid: 20
      precision: 0
      timePrecisionIsSet: false
      tupleContents: []
      tupleLabels: []
      udtMetadata: null
      visibleType: 0
      width: 64
  Status: PUBLIC
- ColumnType:
    closedTypeIds: []
    columnId: 4.294967294e+09
    computeExpr: null
    elementCreationMetadata:
      in231OrLater: true
    familyId: 0
    isNullable: true
    isVirtual: false
    tableId: 10009
    type:
      arrayContents: null
      arrayDimensions: []
      arrayElemType: null
      family: OidFamily
      geoMetadata: null
      intervalDurationField: null
      locale: null
      oid: 26
      precision: 0
      timePrecisionIsSet: false
      tupleContents: []
      tupleLabels: []
      udtMetadata: null
      visibleType: 0
      width: 0
  Status: PUBLIC
- ColumnType:
    closedTypeIds: []
    columnId: 4.294967295e+09
    computeExpr: null
    elementCreationMetadata:
      in231OrLater: true
    familyId: 0
    isNullable: true
    isVirtual: false
    tableId: 10009
    type:
      arrayContents: null
      arrayDimensions: []
      arrayElemType: null
      family: DecimalFamily
      geoMetadata: null
      intervalDurationField: null
      locale: null
      oid: 1700
      precision: 0
      timePrecisionIsSet: false
      tupleContents: []
      tupleLabels: []
      udtMetadata: null
      visibleType: 0
      width: 0
  Status: PUBLIC
- Namespace:
    databaseId: 10000
    descriptorId: 10009
    name: v2
    schemaId: 10002
  Status: PUBLIC
- Owner:
    descriptorId: 10009
    owner: root
  Status: PUBLIC
- SchemaChild:
    childObjectId: 10009
    schemaId: 10002
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 10009
    privileges: "2"
    userName: admin
    withGrantOption: "2"
  Status: PUBLIC
- UserPrivileges:
    descriptorId: 10009
    privileges: "2"
    userName: root
    withGrantOption: "2"
  Status: PUBLIC
- View:
    forwardReferences:
    - columnIds:
      - 1
      indexId: 0
      toId: 10008
    isMaterialized: false
    isTemporary: false
    usesRelationIds:
    - 10008
    usesTypeIds:
    - 10006
    - 10007
    viewId: 10009
  Status: PUBLIC
