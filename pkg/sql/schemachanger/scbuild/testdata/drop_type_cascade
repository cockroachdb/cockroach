setup
SET experimental_enable_unique_without_index_constraints = true;
CREATE TYPE defaultdb.typ AS ENUM('a');
CREATE TYPE defaultdb.ctyp AS (a INT, b INT);
CREATE TYPE defaultdb.greeting AS ENUM('hello', 'hi');
CREATE VIEW defaultdb.view AS SELECT 'hi'::defaultdb.greeting AS hi;
CREATE TABLE defaultdb.tbl (
  id INT PRIMARY KEY,
  gs greeting AS ('hi'::defaultdb.greeting) STORED,
  gv string AS ('hello'::defaultdb.greeting::STRING) VIRTUAL,
  other greeting[],
  name STRING NOT NULL,
  CONSTRAINT mycheck CHECK (gs::STRING = name),
  CONSTRAINT myuwi UNIQUE WITHOUT INDEX (name) WHERE ('hi'::defaultdb.greeting::STRING = 'hi'),
  INDEX partial (name) WHERE (gs::STRING = 'hi')
);
----

build
DROP TYPE defaultdb.typ
----
- [[Namespace:{DescID: 104, Name: typ, ReferencedDescID: 100}, ABSENT], PUBLIC]
  {databaseId: 100, descriptorId: 104, name: typ, schemaId: 101}
- [[Owner:{DescID: 104}, ABSENT], PUBLIC]
  {descriptorId: 104, owner: root}
- [[UserPrivileges:{DescID: 104, Name: admin}, ABSENT], PUBLIC]
  {descriptorId: 104, privileges: "2", userName: admin, withGrantOption: "2"}
- [[UserPrivileges:{DescID: 104, Name: public}, ABSENT], PUBLIC]
  {descriptorId: 104, privileges: "512", userName: public}
- [[UserPrivileges:{DescID: 104, Name: root}, ABSENT], PUBLIC]
  {descriptorId: 104, privileges: "2", userName: root, withGrantOption: "2"}
- [[EnumType:{DescID: 104}, ABSENT], PUBLIC]
  {arrayTypeId: 105, typeId: 104}
- [[EnumTypeValue:{DescID: 104, Name: a}, ABSENT], PUBLIC]
  {logicalRepresentation: a, physicalRepresentation: gA==, typeId: 104}
- [[ObjectParent:{DescID: 104, ReferencedDescID: 101}, ABSENT], PUBLIC]
  {objectId: 104, parentSchemaId: 101}
- [[Namespace:{DescID: 105, Name: _typ, ReferencedDescID: 100}, ABSENT], PUBLIC]
  {databaseId: 100, descriptorId: 105, name: _typ, schemaId: 101}
- [[Owner:{DescID: 105}, ABSENT], PUBLIC]
  {descriptorId: 105, owner: root}
- [[UserPrivileges:{DescID: 105, Name: admin}, ABSENT], PUBLIC]
  {descriptorId: 105, privileges: "2", userName: admin, withGrantOption: "2"}
- [[UserPrivileges:{DescID: 105, Name: public}, ABSENT], PUBLIC]
  {descriptorId: 105, privileges: "512", userName: public}
- [[UserPrivileges:{DescID: 105, Name: root}, ABSENT], PUBLIC]
  {descriptorId: 105, privileges: "2", userName: root, withGrantOption: "2"}
- [[AliasType:{DescID: 105, ReferencedTypeIDs: [104 105]}, ABSENT], PUBLIC]
  {closedTypeIds: [104, 105], type: {arrayContents: {family: EnumFamily, oid: 100104, udtMetadata: {arrayTypeOid: 100105}}, arrayElemType: EnumFamily, family: ArrayFamily, oid: 100105}, typeId: 105}
- [[ObjectParent:{DescID: 105, ReferencedDescID: 101}, ABSENT], PUBLIC]
  {objectId: 105, parentSchemaId: 101}

build
DROP TYPE defaultdb.ctyp
----
- [[Namespace:{DescID: 106, Name: ctyp, ReferencedDescID: 100}, ABSENT], PUBLIC]
  {databaseId: 100, descriptorId: 106, name: ctyp, schemaId: 101}
- [[Owner:{DescID: 106}, ABSENT], PUBLIC]
  {descriptorId: 106, owner: root}
- [[UserPrivileges:{DescID: 106, Name: admin}, ABSENT], PUBLIC]
  {descriptorId: 106, privileges: "2", userName: admin, withGrantOption: "2"}
- [[UserPrivileges:{DescID: 106, Name: public}, ABSENT], PUBLIC]
  {descriptorId: 106, privileges: "512", userName: public}
- [[UserPrivileges:{DescID: 106, Name: root}, ABSENT], PUBLIC]
  {descriptorId: 106, privileges: "2", userName: root, withGrantOption: "2"}
- [[CompositeType:{DescID: 106}, ABSENT], PUBLIC]
  {arrayTypeId: 107, typeId: 106}
- [[CompositeTypeAttrName:{DescID: 106, Name: a}, ABSENT], PUBLIC]
  {compositeTypeId: 106, name: a}
- [[CompositeTypeAttrType:{DescID: 106}, ABSENT], PUBLIC]
  {compositeTypeId: 106, type: {family: IntFamily, oid: 20, width: 64}}
- [[CompositeTypeAttrName:{DescID: 106, Name: b}, ABSENT], PUBLIC]
  {compositeTypeId: 106, name: b}
- [[ObjectParent:{DescID: 106, ReferencedDescID: 101}, ABSENT], PUBLIC]
  {objectId: 106, parentSchemaId: 101}
- [[Namespace:{DescID: 107, Name: _ctyp, ReferencedDescID: 100}, ABSENT], PUBLIC]
  {databaseId: 100, descriptorId: 107, name: _ctyp, schemaId: 101}
- [[Owner:{DescID: 107}, ABSENT], PUBLIC]
  {descriptorId: 107, owner: root}
- [[UserPrivileges:{DescID: 107, Name: admin}, ABSENT], PUBLIC]
  {descriptorId: 107, privileges: "2", userName: admin, withGrantOption: "2"}
- [[UserPrivileges:{DescID: 107, Name: public}, ABSENT], PUBLIC]
  {descriptorId: 107, privileges: "512", userName: public}
- [[UserPrivileges:{DescID: 107, Name: root}, ABSENT], PUBLIC]
  {descriptorId: 107, privileges: "2", userName: root, withGrantOption: "2"}
- [[AliasType:{DescID: 107, ReferencedTypeIDs: [106 107]}, ABSENT], PUBLIC]
  {closedTypeIds: [106, 107], type: {arrayContents: {family: TupleFamily, oid: 100106, tupleContents: [{family: IntFamily, oid: 20, width: 64}, {family: IntFamily, oid: 20, width: 64}], tupleLabels: [a, b], udtMetadata: {arrayTypeOid: 100107}}, arrayElemType: TupleFamily, family: ArrayFamily, oid: 100107}, typeId: 107}
- [[ObjectParent:{DescID: 107, ReferencedDescID: 101}, ABSENT], PUBLIC]
  {objectId: 107, parentSchemaId: 101}

build
DROP TYPE defaultdb.greeting CASCADE
----
- [[Namespace:{DescID: 108, Name: greeting, ReferencedDescID: 100}, ABSENT], PUBLIC]
  {databaseId: 100, descriptorId: 108, name: greeting, schemaId: 101}
- [[Owner:{DescID: 108}, ABSENT], PUBLIC]
  {descriptorId: 108, owner: root}
- [[UserPrivileges:{DescID: 108, Name: admin}, ABSENT], PUBLIC]
  {descriptorId: 108, privileges: "2", userName: admin, withGrantOption: "2"}
- [[UserPrivileges:{DescID: 108, Name: public}, ABSENT], PUBLIC]
  {descriptorId: 108, privileges: "512", userName: public}
- [[UserPrivileges:{DescID: 108, Name: root}, ABSENT], PUBLIC]
  {descriptorId: 108, privileges: "2", userName: root, withGrantOption: "2"}
- [[EnumType:{DescID: 108}, ABSENT], PUBLIC]
  {arrayTypeId: 109, typeId: 108}
- [[EnumTypeValue:{DescID: 108, Name: hello}, ABSENT], PUBLIC]
  {logicalRepresentation: hello, physicalRepresentation: QA==, typeId: 108}
- [[EnumTypeValue:{DescID: 108, Name: hi}, ABSENT], PUBLIC]
  {logicalRepresentation: hi, physicalRepresentation: gA==, typeId: 108}
- [[ObjectParent:{DescID: 108, ReferencedDescID: 101}, ABSENT], PUBLIC]
  {objectId: 108, parentSchemaId: 101}
- [[Namespace:{DescID: 109, Name: _greeting, ReferencedDescID: 100}, ABSENT], PUBLIC]
  {databaseId: 100, descriptorId: 109, name: _greeting, schemaId: 101}
- [[Owner:{DescID: 109}, ABSENT], PUBLIC]
  {descriptorId: 109, owner: root}
- [[UserPrivileges:{DescID: 109, Name: admin}, ABSENT], PUBLIC]
  {descriptorId: 109, privileges: "2", userName: admin, withGrantOption: "2"}
- [[UserPrivileges:{DescID: 109, Name: public}, ABSENT], PUBLIC]
  {descriptorId: 109, privileges: "512", userName: public}
- [[UserPrivileges:{DescID: 109, Name: root}, ABSENT], PUBLIC]
  {descriptorId: 109, privileges: "2", userName: root, withGrantOption: "2"}
- [[AliasType:{DescID: 109, ReferencedTypeIDs: [108 109]}, ABSENT], PUBLIC]
  {closedTypeIds: [108, 109], type: {arrayContents: {family: EnumFamily, oid: 100108, udtMetadata: {arrayTypeOid: 100109}}, arrayElemType: EnumFamily, family: ArrayFamily, oid: 100109}, typeId: 109}
- [[ObjectParent:{DescID: 109, ReferencedDescID: 101}, ABSENT], PUBLIC]
  {objectId: 109, parentSchemaId: 101}
- [[Namespace:{DescID: 110, Name: view, ReferencedDescID: 100}, ABSENT], PUBLIC]
  {databaseId: 100, descriptorId: 110, name: view, schemaId: 101}
- [[Owner:{DescID: 110}, ABSENT], PUBLIC]
  {descriptorId: 110, owner: root}
- [[UserPrivileges:{DescID: 110, Name: admin}, ABSENT], PUBLIC]
  {descriptorId: 110, privileges: "2", userName: admin, withGrantOption: "2"}
- [[UserPrivileges:{DescID: 110, Name: root}, ABSENT], PUBLIC]
  {descriptorId: 110, privileges: "2", userName: root, withGrantOption: "2"}
- [[View:{DescID: 110}, ABSENT], PUBLIC]
  {forwardReferences: [], usesTypeIds: [108, 109], viewId: 110}
- [[ObjectParent:{DescID: 110, ReferencedDescID: 101}, ABSENT], PUBLIC]
  {objectId: 110, parentSchemaId: 101}
- [[Column:{DescID: 110, ColumnID: 1}, ABSENT], PUBLIC]
  {columnId: 1, pgAttributeNum: 1, tableId: 110}
- [[ColumnName:{DescID: 110, Name: hi, ColumnID: 1}, ABSENT], PUBLIC]
  {columnId: 1, name: hi, tableId: 110}
- [[ColumnType:{DescID: 110, ReferencedTypeIDs: [108 109], ColumnFamilyID: 0, ColumnID: 1}, ABSENT], PUBLIC]
  {closedTypeIds: [108, 109], columnId: 1, elementCreationMetadata: {in231OrLater: true}, isNullable: true, tableId: 110, type: {family: EnumFamily, oid: 100108, udtMetadata: {arrayTypeOid: 100109}}}
- [[Column:{DescID: 110, ColumnID: 4294967295}, ABSENT], PUBLIC]
  {columnId: 4.294967295e+09, isHidden: true, isSystemColumn: true, pgAttributeNum: 4.294967295e+09, tableId: 110}
- [[ColumnName:{DescID: 110, Name: crdb_internal_mvcc_timestamp, ColumnID: 4294967295}, ABSENT], PUBLIC]
  {columnId: 4.294967295e+09, name: crdb_internal_mvcc_timestamp, tableId: 110}
- [[ColumnType:{DescID: 110, ColumnFamilyID: 0, ColumnID: 4294967295}, ABSENT], PUBLIC]
  {columnId: 4.294967295e+09, elementCreationMetadata: {in231OrLater: true}, isNullable: true, tableId: 110, type: {family: DecimalFamily, oid: 1700}}
- [[Column:{DescID: 110, ColumnID: 4294967294}, ABSENT], PUBLIC]
  {columnId: 4.294967294e+09, isHidden: true, isSystemColumn: true, pgAttributeNum: 4.294967294e+09, tableId: 110}
- [[ColumnName:{DescID: 110, Name: tableoid, ColumnID: 4294967294}, ABSENT], PUBLIC]
  {columnId: 4.294967294e+09, name: tableoid, tableId: 110}
- [[ColumnType:{DescID: 110, ColumnFamilyID: 0, ColumnID: 4294967294}, ABSENT], PUBLIC]
  {columnId: 4.294967294e+09, elementCreationMetadata: {in231OrLater: true}, isNullable: true, tableId: 110, type: {family: OidFamily, oid: 26}}
- [[Column:{DescID: 111, ColumnID: 2}, ABSENT], PUBLIC]
  {columnId: 2, pgAttributeNum: 2, tableId: 111}
- [[ColumnName:{DescID: 111, Name: gs, ColumnID: 2}, ABSENT], PUBLIC]
  {columnId: 2, name: gs, tableId: 111}
- [[ColumnType:{DescID: 111, ReferencedTypeIDs: [108 109], ColumnFamilyID: 0, ColumnID: 2}, ABSENT], PUBLIC]
  {closedTypeIds: [108, 109], columnId: 2, computeExpr: {expr: 'x''80'':::@100108', usesTypeIds: [108, 109]}, elementCreationMetadata: {in231OrLater: true}, isNullable: true, tableId: 111, type: {family: EnumFamily, oid: 100108, udtMetadata: {arrayTypeOid: 100109}}}
- [[Column:{DescID: 111, ColumnID: 3}, ABSENT], PUBLIC]
  {columnId: 3, pgAttributeNum: 3, tableId: 111}
- [[ColumnName:{DescID: 111, Name: gv, ColumnID: 3}, ABSENT], PUBLIC]
  {columnId: 3, name: gv, tableId: 111}
- [[ColumnType:{DescID: 111, ColumnFamilyID: 0, ColumnID: 3}, ABSENT], PUBLIC]
  {columnId: 3, computeExpr: {expr: 'x''40'':::@100108::STRING', usesTypeIds: [108, 109]}, elementCreationMetadata: {in231OrLater: true}, isNullable: true, isVirtual: true, tableId: 111, type: {family: StringFamily, oid: 25}}
- [[Column:{DescID: 111, ColumnID: 4}, ABSENT], PUBLIC]
  {columnId: 4, pgAttributeNum: 4, tableId: 111}
- [[ColumnName:{DescID: 111, Name: other, ColumnID: 4}, ABSENT], PUBLIC]
  {columnId: 4, name: other, tableId: 111}
- [[ColumnType:{DescID: 111, ReferencedTypeIDs: [108 109], ColumnFamilyID: 0, ColumnID: 4}, ABSENT], PUBLIC]
  {closedTypeIds: [108, 109], columnId: 4, elementCreationMetadata: {in231OrLater: true}, isNullable: true, tableId: 111, type: {arrayContents: {family: EnumFamily, oid: 100108, udtMetadata: {arrayTypeOid: 100109}}, arrayElemType: EnumFamily, family: ArrayFamily, oid: 100109}}
- [[IndexColumn:{DescID: 111, ColumnID: 1, IndexID: 1}, ABSENT], PUBLIC]
  {columnId: 1, indexId: 1, tableId: 111}
- [[IndexColumn:{DescID: 111, ColumnID: 2, IndexID: 1}, ABSENT], PUBLIC]
  {columnId: 2, indexId: 1, kind: STORED, tableId: 111}
- [[IndexColumn:{DescID: 111, ColumnID: 4, IndexID: 1}, ABSENT], PUBLIC]
  {columnId: 4, indexId: 1, kind: STORED, ordinalInKind: 1, tableId: 111}
- [[IndexColumn:{DescID: 111, ColumnID: 5, IndexID: 1}, ABSENT], PUBLIC]
  {columnId: 5, indexId: 1, kind: STORED, ordinalInKind: 2, tableId: 111}
- [[PrimaryIndex:{DescID: 111, IndexID: 1, ConstraintID: 1}, ABSENT], PUBLIC]
  {constraintId: 1, indexId: 1, isUnique: true, tableId: 111}
- [[IndexName:{DescID: 111, Name: tbl_pkey, IndexID: 1}, ABSENT], PUBLIC]
  {indexId: 1, name: tbl_pkey, tableId: 111}
- [[IndexData:{DescID: 111, IndexID: 1}, ABSENT], PUBLIC]
  {indexId: 1, tableId: 111}
- [[IndexColumn:{DescID: 111, ColumnID: 5, IndexID: 2}, ABSENT], PUBLIC]
  {columnId: 5, indexId: 2, tableId: 111}
- [[IndexColumn:{DescID: 111, ColumnID: 1, IndexID: 2}, ABSENT], PUBLIC]
  {columnId: 1, indexId: 2, kind: KEY_SUFFIX, tableId: 111}
- [[SecondaryIndexPartial:{DescID: 111, IndexID: 2}, ABSENT], PUBLIC]
  {expr: 'gs::STRING = ''hi'':::STRING', indexId: 2, referencedColumnIds: [2], tableId: 111}
- [[SecondaryIndex:{DescID: 111, IndexID: 2, ConstraintID: 0}, ABSENT], PUBLIC]
  {indexId: 2, tableId: 111}
- [[IndexName:{DescID: 111, Name: partial, IndexID: 2}, ABSENT], PUBLIC]
  {indexId: 2, name: partial, tableId: 111}
- [[IndexData:{DescID: 111, IndexID: 2}, ABSENT], PUBLIC]
  {indexId: 2, tableId: 111}
- [[UniqueWithoutIndexConstraint:{DescID: 111, ConstraintID: 3}, ABSENT], PUBLIC]
  {columnIds: [5], constraintId: 3, predicate: {expr: 'x''80'':::@100108::STRING = ''hi'':::STRING', usesTypeIds: [108, 109]}, tableId: 111}
- [[ConstraintWithoutIndexName:{DescID: 111, Name: myuwi, ConstraintID: 3}, ABSENT], PUBLIC]
  {constraintId: 3, name: myuwi, tableId: 111}
- [[CheckConstraint:{DescID: 111, IndexID: 0, ConstraintID: 2}, ABSENT], PUBLIC]
  {columnIds: [2, 5], constraintId: 2, expr: 'gs::STRING = name', referencedColumnIds: [2, 5], tableId: 111}
- [[ConstraintWithoutIndexName:{DescID: 111, Name: mycheck, ConstraintID: 2}, ABSENT], PUBLIC]
  {constraintId: 2, name: mycheck, tableId: 111}
- [[PrimaryIndex:{DescID: 111, IndexID: 3, ConstraintID: 4, TemporaryIndexID: 4, SourceIndexID: 1}, PUBLIC], ABSENT]
  {constraintId: 4, indexId: 3, isUnique: true, sourceIndexId: 1, tableId: 111, temporaryIndexId: 4}
- [[IndexName:{DescID: 111, Name: tbl_pkey, IndexID: 3}, PUBLIC], ABSENT]
  {indexId: 3, name: tbl_pkey, tableId: 111}
- [[IndexColumn:{DescID: 111, ColumnID: 1, IndexID: 3}, PUBLIC], ABSENT]
  {columnId: 1, indexId: 3, tableId: 111}
- [[IndexColumn:{DescID: 111, ColumnID: 5, IndexID: 3}, PUBLIC], ABSENT]
  {columnId: 5, indexId: 3, kind: STORED, tableId: 111}
- [[IndexData:{DescID: 111, IndexID: 3}, PUBLIC], ABSENT]
  {indexId: 3, tableId: 111}
- [[TemporaryIndex:{DescID: 111, IndexID: 4, ConstraintID: 5, SourceIndexID: 1}, TRANSIENT_ABSENT], ABSENT]
  {constraintId: 5, indexId: 4, isUnique: true, sourceIndexId: 1, tableId: 111}
- [[IndexColumn:{DescID: 111, ColumnID: 1, IndexID: 4}, TRANSIENT_ABSENT], ABSENT]
  {columnId: 1, indexId: 4, tableId: 111}
- [[IndexColumn:{DescID: 111, ColumnID: 5, IndexID: 4}, PUBLIC], ABSENT]
  {columnId: 5, indexId: 4, kind: STORED, tableId: 111}
- [[IndexData:{DescID: 111, IndexID: 4}, TRANSIENT_ABSENT], ABSENT]
  {indexId: 4, tableId: 111}
