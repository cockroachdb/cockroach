create-table
CREATE TABLE defaultdb.t1 (id INT PRIMARY KEY, name varchar(256))
----

create-view
CREATE VIEW defaultdb.v1 AS (SELECT name FROM defaultdb.t1)
----

build
DROP VIEW defaultdb.v1
----
- [[Locality:{DescID: 1006}, ABSENT], PUBLIC]
  details:
    descriptorId: 1006
- [[Namespace:{DescID: 1006, Name: v1}, ABSENT], PUBLIC]
  details:
    databaseId: 1001
    descriptorId: 1006
    name: v1
    schemaId: 1002
- [[Owner:{DescID: 1006}, ABSENT], PUBLIC]
  details:
    descriptorId: 1006
    owner: root
- [[RelationDependedOnBy:{DescID: 1005, ReferencedDescID: 1006}, ABSENT], PUBLIC]
  details:
    dependedOn: 1006
    tableId: 1005
- [[TableComment:{DescID: 1006}, ABSENT], PUBLIC]
  details:
    comment: TODO(fqazi) Comments are not currently fetched from system.comments when
      doing decomposition
    tableId: 1006
- [[UserPrivileges:{DescID: 1006, Username: admin}, ABSENT], PUBLIC]
  details:
    descriptorId: 1006
    privileges: 2
    username: admin
- [[UserPrivileges:{DescID: 1006, Username: public}, ABSENT], PUBLIC]
  details:
    descriptorId: 1006
    username: public
- [[UserPrivileges:{DescID: 1006, Username: root}, ABSENT], PUBLIC]
  details:
    descriptorId: 1006
    privileges: 2
    username: root
- [[View:{DescID: 1006}, ABSENT], PUBLIC]
  details:
    tableId: 1006

create-view
CREATE VIEW defaultdb.v2 AS (SELECT name AS n1, name AS n2 FROM v1)
----

create-view
CREATE VIEW defaultdb.v3 AS (SELECT name, n1 FROM v1, v2);
----

create-view
CREATE VIEW defaultdb.v4 AS (SELECT n2, n1 FROM v2);
----

create-type
CREATE TYPE defaultdb.typ AS ENUM('a')
----

create-view
CREATE VIEW v5 AS (SELECT 'a'::defaultdb.typ::string AS k, n2, n1 from defaultdb.v4)
----

build
DROP VIEW defaultdb.v1 CASCADE
----
- [[Locality:{DescID: 1006}, ABSENT], PUBLIC]
  details:
    descriptorId: 1006
- [[Locality:{DescID: 1007}, ABSENT], PUBLIC]
  details:
    descriptorId: 1007
- [[Locality:{DescID: 1008}, ABSENT], PUBLIC]
  details:
    descriptorId: 1008
- [[Locality:{DescID: 1009}, ABSENT], PUBLIC]
  details:
    descriptorId: 1009
- [[Locality:{DescID: 1012}, ABSENT], PUBLIC]
  details:
    descriptorId: 1012
- [[Namespace:{DescID: 1006, Name: v1}, ABSENT], PUBLIC]
  details:
    databaseId: 1001
    descriptorId: 1006
    name: v1
    schemaId: 1002
- [[Namespace:{DescID: 1007, Name: v2}, ABSENT], PUBLIC]
  details:
    databaseId: 1001
    descriptorId: 1007
    name: v2
    schemaId: 1002
- [[Namespace:{DescID: 1008, Name: v3}, ABSENT], PUBLIC]
  details:
    databaseId: 1001
    descriptorId: 1008
    name: v3
    schemaId: 1002
- [[Namespace:{DescID: 1009, Name: v4}, ABSENT], PUBLIC]
  details:
    databaseId: 1001
    descriptorId: 1009
    name: v4
    schemaId: 1002
- [[Namespace:{DescID: 1012, Name: v5}, ABSENT], PUBLIC]
  details:
    databaseId: 1001
    descriptorId: 1012
    name: v5
    schemaId: 1002
- [[Owner:{DescID: 1006}, ABSENT], PUBLIC]
  details:
    descriptorId: 1006
    owner: root
- [[Owner:{DescID: 1007}, ABSENT], PUBLIC]
  details:
    descriptorId: 1007
    owner: root
- [[Owner:{DescID: 1008}, ABSENT], PUBLIC]
  details:
    descriptorId: 1008
    owner: root
- [[Owner:{DescID: 1009}, ABSENT], PUBLIC]
  details:
    descriptorId: 1009
    owner: root
- [[Owner:{DescID: 1012}, ABSENT], PUBLIC]
  details:
    descriptorId: 1012
    owner: root
- [[RelationDependedOnBy:{DescID: 1005, ReferencedDescID: 1006}, ABSENT], PUBLIC]
  details:
    dependedOn: 1006
    tableId: 1005
- [[RelationDependedOnBy:{DescID: 1006, ReferencedDescID: 1007}, ABSENT], PUBLIC]
  details:
    columnID: 1
    dependedOn: 1007
    tableId: 1006
- [[RelationDependedOnBy:{DescID: 1006, ReferencedDescID: 1008}, ABSENT], PUBLIC]
  details:
    columnID: 1
    dependedOn: 1008
    tableId: 1006
- [[RelationDependedOnBy:{DescID: 1007, ReferencedDescID: 1008}, ABSENT], PUBLIC]
  details:
    columnID: 1
    dependedOn: 1008
    tableId: 1007
- [[RelationDependedOnBy:{DescID: 1007, ReferencedDescID: 1009}, ABSENT], PUBLIC]
  details:
    columnID: 1
    dependedOn: 1009
    tableId: 1007
- [[RelationDependedOnBy:{DescID: 1009, ReferencedDescID: 1012}, ABSENT], PUBLIC]
  details:
    columnID: 1
    dependedOn: 1012
    tableId: 1009
- [[TableComment:{DescID: 1006}, ABSENT], PUBLIC]
  details:
    comment: TODO(fqazi) Comments are not currently fetched from system.comments when
      doing decomposition
    tableId: 1006
- [[TableComment:{DescID: 1007}, ABSENT], PUBLIC]
  details:
    comment: TODO(fqazi) Comments are not currently fetched from system.comments when
      doing decomposition
    tableId: 1007
- [[TableComment:{DescID: 1008}, ABSENT], PUBLIC]
  details:
    comment: TODO(fqazi) Comments are not currently fetched from system.comments when
      doing decomposition
    tableId: 1008
- [[TableComment:{DescID: 1009}, ABSENT], PUBLIC]
  details:
    comment: TODO(fqazi) Comments are not currently fetched from system.comments when
      doing decomposition
    tableId: 1009
- [[TableComment:{DescID: 1012}, ABSENT], PUBLIC]
  details:
    comment: TODO(fqazi) Comments are not currently fetched from system.comments when
      doing decomposition
    tableId: 1012
- [[UserPrivileges:{DescID: 1006, Username: admin}, ABSENT], PUBLIC]
  details:
    descriptorId: 1006
    privileges: 2
    username: admin
- [[UserPrivileges:{DescID: 1006, Username: public}, ABSENT], PUBLIC]
  details:
    descriptorId: 1006
    username: public
- [[UserPrivileges:{DescID: 1006, Username: root}, ABSENT], PUBLIC]
  details:
    descriptorId: 1006
    privileges: 2
    username: root
- [[UserPrivileges:{DescID: 1007, Username: admin}, ABSENT], PUBLIC]
  details:
    descriptorId: 1007
    privileges: 2
    username: admin
- [[UserPrivileges:{DescID: 1007, Username: public}, ABSENT], PUBLIC]
  details:
    descriptorId: 1007
    username: public
- [[UserPrivileges:{DescID: 1007, Username: root}, ABSENT], PUBLIC]
  details:
    descriptorId: 1007
    privileges: 2
    username: root
- [[UserPrivileges:{DescID: 1008, Username: admin}, ABSENT], PUBLIC]
  details:
    descriptorId: 1008
    privileges: 2
    username: admin
- [[UserPrivileges:{DescID: 1008, Username: public}, ABSENT], PUBLIC]
  details:
    descriptorId: 1008
    username: public
- [[UserPrivileges:{DescID: 1008, Username: root}, ABSENT], PUBLIC]
  details:
    descriptorId: 1008
    privileges: 2
    username: root
- [[UserPrivileges:{DescID: 1009, Username: admin}, ABSENT], PUBLIC]
  details:
    descriptorId: 1009
    privileges: 2
    username: admin
- [[UserPrivileges:{DescID: 1009, Username: public}, ABSENT], PUBLIC]
  details:
    descriptorId: 1009
    username: public
- [[UserPrivileges:{DescID: 1009, Username: root}, ABSENT], PUBLIC]
  details:
    descriptorId: 1009
    privileges: 2
    username: root
- [[UserPrivileges:{DescID: 1012, Username: admin}, ABSENT], PUBLIC]
  details:
    descriptorId: 1012
    privileges: 2
    username: admin
- [[UserPrivileges:{DescID: 1012, Username: public}, ABSENT], PUBLIC]
  details:
    descriptorId: 1012
    username: public
- [[UserPrivileges:{DescID: 1012, Username: root}, ABSENT], PUBLIC]
  details:
    descriptorId: 1012
    privileges: 2
    username: root
- [[View:{DescID: 1006}, ABSENT], PUBLIC]
  details:
    tableId: 1006
- [[View:{DescID: 1007}, ABSENT], PUBLIC]
  details:
    tableId: 1007
- [[View:{DescID: 1008}, ABSENT], PUBLIC]
  details:
    tableId: 1008
- [[View:{DescID: 1009}, ABSENT], PUBLIC]
  details:
    tableId: 1009
- [[View:{DescID: 1012}, ABSENT], PUBLIC]
  details:
    tableId: 1012
- [[ViewDependsOnType:{DescID: 1012, ReferencedDescID: 1010}, ABSENT], PUBLIC]
  details:
    tableId: 1012
    typeId: 1010
- [[ViewDependsOnType:{DescID: 1012, ReferencedDescID: 1011}, ABSENT], PUBLIC]
  details:
    tableId: 1012
    typeId: 1011
