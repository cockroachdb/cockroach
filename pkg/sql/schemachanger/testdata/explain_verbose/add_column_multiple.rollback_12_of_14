/* setup */
CREATE DATABASE db;
CREATE TABLE db.public.tbl (i INT PRIMARY KEY, k INT);
CREATE SEQUENCE db.public.sq1;

/* test */
ALTER TABLE db.public.tbl ADD COLUMN l INT UNIQUE DEFAULT NULL, ADD COLUMN j INT NOT NULL DEFAULT 42, ADD COLUMN m INT NOT NULL DEFAULT 42;
EXPLAIN (ddl, verbose) rollback at post-commit stage 12 of 14;
----
• Schema change plan for rolling back ALTER TABLE ‹db›.public.‹tbl› ADD COLUMN ‹l› INT8 UNIQUE DEFAULT ‹NULL›, ADD COLUMN ‹j› INT8 NOT NULL DEFAULT ‹42›, ADD COLUMN ‹m› INT8 NOT NULL DEFAULT ‹42›;
│
└── • PostCommitNonRevertiblePhase
    │
    ├── • Stage 1 of 3 in PostCommitNonRevertiblePhase
    │   │
    │   ├── • 2 elements transitioning toward PUBLIC
    │   │   │
    │   │   ├── • PrimaryIndex:{DescID: 106, IndexID: 1, ConstraintID: 1}
    │   │   │   │ VALIDATED → PUBLIC
    │   │   │   │
    │   │   │   ├── • Precedence dependency from PUBLIC IndexColumn:{DescID: 106, ColumnID: 1, IndexID: 1}
    │   │   │   │     rule: "index dependents exist before index becomes public"
    │   │   │   │
    │   │   │   ├── • Precedence dependency from PUBLIC IndexColumn:{DescID: 106, ColumnID: 2, IndexID: 1}
    │   │   │   │     rule: "index dependents exist before index becomes public"
    │   │   │   │
    │   │   │   ├── • PreviousTransactionPrecedence dependency from VALIDATED PrimaryIndex:{DescID: 106, IndexID: 1, ConstraintID: 1}
    │   │   │   │     rule: "PrimaryIndex transitions to PUBLIC uphold 2-version invariant: VALIDATED->PUBLIC"
    │   │   │   │
    │   │   │   ├── • SameStagePrecedence dependency from PUBLIC IndexName:{DescID: 106, Name: tbl_pkey, IndexID: 1}
    │   │   │   │     rule: "index dependents exist before index becomes public"
    │   │   │   │     rule: "primary index named right before index becomes public"
    │   │   │   │
    │   │   │   └── • SameStagePrecedence dependency from VALIDATED PrimaryIndex:{DescID: 106, IndexID: 4, ConstraintID: 4, TemporaryIndexID: 5, SourceIndexID: 1}
    │   │   │         rule: "primary index swap"
    │   │   │
    │   │   └── • IndexName:{DescID: 106, Name: tbl_pkey, IndexID: 1}
    │   │         ABSENT → PUBLIC
    │   │
    │   ├── • 21 elements transitioning toward ABSENT
    │   │   │
    │   │   ├── • Column:{DescID: 106, ColumnID: 3}
    │   │   │   │ WRITE_ONLY → DELETE_ONLY
    │   │   │   │
    │   │   │   └── • PreviousTransactionPrecedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 3}
    │   │   │         rule: "Column transitions to ABSENT uphold 2-version invariant: WRITE_ONLY->DELETE_ONLY"
    │   │   │
    │   │   ├── • ColumnName:{DescID: 106, Name: l, ColumnID: 3}
    │   │   │   │ PUBLIC → ABSENT
    │   │   │   │
    │   │   │   └── • Precedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 3}
    │   │   │         rule: "column no longer public before dependents"
    │   │   │
    │   │   ├── • IndexColumn:{DescID: 106, ColumnID: 3, IndexID: 2}
    │   │   │   │ PUBLIC → ABSENT
    │   │   │   │
    │   │   │   ├── • Precedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 3}
    │   │   │   │     rule: "column no longer public before dependents"
    │   │   │   │
    │   │   │   └── • Precedence dependency from DELETE_ONLY SecondaryIndex:{DescID: 106, IndexID: 2, ConstraintID: 2, TemporaryIndexID: 3, SourceIndexID: 4, RecreateSourceIndexID: 0}
    │   │   │         rule: "index drop mutation visible before cleaning up index columns"
    │   │   │
    │   │   ├── • IndexColumn:{DescID: 106, ColumnID: 1, IndexID: 2}
    │   │   │   │ PUBLIC → ABSENT
    │   │   │   │
    │   │   │   └── • Precedence dependency from DELETE_ONLY SecondaryIndex:{DescID: 106, IndexID: 2, ConstraintID: 2, TemporaryIndexID: 3, SourceIndexID: 4, RecreateSourceIndexID: 0}
    │   │   │         rule: "index drop mutation visible before cleaning up index columns"
    │   │   │
    │   │   ├── • SecondaryIndex:{DescID: 106, IndexID: 2, ConstraintID: 2, TemporaryIndexID: 3, SourceIndexID: 4, RecreateSourceIndexID: 0}
    │   │   │   │ MERGE_ONLY → DELETE_ONLY
    │   │   │   │
    │   │   │   └── • PreviousTransactionPrecedence dependency from MERGE_ONLY SecondaryIndex:{DescID: 106, IndexID: 2, ConstraintID: 2, TemporaryIndexID: 3, SourceIndexID: 4, RecreateSourceIndexID: 0}
    │   │   │         rule: "SecondaryIndex transitions to ABSENT uphold 2-version invariant: MERGE_ONLY->WRITE_ONLY"
    │   │   │
    │   │   ├── • IndexName:{DescID: 106, Name: tbl_l_key, IndexID: 2}
    │   │   │   │ PUBLIC → ABSENT
    │   │   │   │
    │   │   │   └── • Precedence dependency from DELETE_ONLY SecondaryIndex:{DescID: 106, IndexID: 2, ConstraintID: 2, TemporaryIndexID: 3, SourceIndexID: 4, RecreateSourceIndexID: 0}
    │   │   │         rule: "index no longer public before index name"
    │   │   │
    │   │   ├── • IndexColumn:{DescID: 106, ColumnID: 3, IndexID: 3}
    │   │   │   │ PUBLIC → ABSENT
    │   │   │   │
    │   │   │   ├── • Precedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 3}
    │   │   │   │     rule: "column no longer public before dependents"
    │   │   │   │
    │   │   │   └── • Precedence dependency from DELETE_ONLY TemporaryIndex:{DescID: 106, IndexID: 3, ConstraintID: 3, SourceIndexID: 1}
    │   │   │         rule: "index drop mutation visible before cleaning up index columns"
    │   │   │
    │   │   ├── • IndexColumn:{DescID: 106, ColumnID: 1, IndexID: 3}
    │   │   │   │ PUBLIC → ABSENT
    │   │   │   │
    │   │   │   └── • Precedence dependency from DELETE_ONLY TemporaryIndex:{DescID: 106, IndexID: 3, ConstraintID: 3, SourceIndexID: 1}
    │   │   │         rule: "index drop mutation visible before cleaning up index columns"
    │   │   │
    │   │   ├── • TemporaryIndex:{DescID: 106, IndexID: 3, ConstraintID: 3, SourceIndexID: 1}
    │   │   │   │ WRITE_ONLY → DELETE_ONLY
    │   │   │   │
    │   │   │   └── • PreviousTransactionPrecedence dependency from WRITE_ONLY TemporaryIndex:{DescID: 106, IndexID: 3, ConstraintID: 3, SourceIndexID: 1}
    │   │   │         rule: "TemporaryIndex transitions to ABSENT uphold 2-version invariant: WRITE_ONLY->DELETE_ONLY"
    │   │   │
    │   │   ├── • ColumnName:{DescID: 106, Name: j, ColumnID: 4}
    │   │   │   │ PUBLIC → ABSENT
    │   │   │   │
    │   │   │   └── • Precedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 4}
    │   │   │         rule: "column no longer public before dependents"
    │   │   │
    │   │   ├── • PrimaryIndex:{DescID: 106, IndexID: 4, ConstraintID: 4, TemporaryIndexID: 5, SourceIndexID: 1}
    │   │   │   │ PUBLIC → VALIDATED
    │   │   │   │
    │   │   │   └── • PreviousTransactionPrecedence dependency from PUBLIC PrimaryIndex:{DescID: 106, IndexID: 4, ConstraintID: 4, TemporaryIndexID: 5, SourceIndexID: 1}
    │   │   │         rule: "PrimaryIndex transitions to ABSENT uphold 2-version invariant: PUBLIC->VALIDATED"
    │   │   │
    │   │   ├── • IndexName:{DescID: 106, Name: tbl_pkey, IndexID: 4}
    │   │   │   │ PUBLIC → ABSENT
    │   │   │   │
    │   │   │   └── • Precedence dependency from VALIDATED PrimaryIndex:{DescID: 106, IndexID: 4, ConstraintID: 4, TemporaryIndexID: 5, SourceIndexID: 1}
    │   │   │         rule: "index no longer public before dependents, excluding columns"
    │   │   │
    │   │   ├── • TemporaryIndex:{DescID: 106, IndexID: 5, ConstraintID: 5, SourceIndexID: 1}
    │   │   │   │ WRITE_ONLY → DELETE_ONLY
    │   │   │   │
    │   │   │   └── • PreviousTransactionPrecedence dependency from WRITE_ONLY TemporaryIndex:{DescID: 106, IndexID: 5, ConstraintID: 5, SourceIndexID: 1}
    │   │   │         rule: "TemporaryIndex transitions to ABSENT uphold 2-version invariant: WRITE_ONLY->DELETE_ONLY"
    │   │   │
    │   │   ├── • IndexColumn:{DescID: 106, ColumnID: 1, IndexID: 5}
    │   │   │   │ PUBLIC → ABSENT
    │   │   │   │
    │   │   │   └── • Precedence dependency from DELETE_ONLY TemporaryIndex:{DescID: 106, IndexID: 5, ConstraintID: 5, SourceIndexID: 1}
    │   │   │         rule: "index drop mutation visible before cleaning up index columns"
    │   │   │
    │   │   ├── • IndexColumn:{DescID: 106, ColumnID: 2, IndexID: 5}
    │   │   │   │ PUBLIC → ABSENT
    │   │   │   │
    │   │   │   └── • Precedence dependency from DELETE_ONLY TemporaryIndex:{DescID: 106, IndexID: 5, ConstraintID: 5, SourceIndexID: 1}
    │   │   │         rule: "index drop mutation visible before cleaning up index columns"
    │   │   │
    │   │   ├── • IndexColumn:{DescID: 106, ColumnID: 3, IndexID: 5}
    │   │   │   │ PUBLIC → ABSENT
    │   │   │   │
    │   │   │   ├── • Precedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 3}
    │   │   │   │     rule: "column no longer public before dependents"
    │   │   │   │
    │   │   │   └── • Precedence dependency from DELETE_ONLY TemporaryIndex:{DescID: 106, IndexID: 5, ConstraintID: 5, SourceIndexID: 1}
    │   │   │         rule: "index drop mutation visible before cleaning up index columns"
    │   │   │
    │   │   ├── • IndexColumn:{DescID: 106, ColumnID: 4, IndexID: 5}
    │   │   │   │ PUBLIC → ABSENT
    │   │   │   │
    │   │   │   ├── • Precedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 4}
    │   │   │   │     rule: "column no longer public before dependents"
    │   │   │   │
    │   │   │   └── • Precedence dependency from DELETE_ONLY TemporaryIndex:{DescID: 106, IndexID: 5, ConstraintID: 5, SourceIndexID: 1}
    │   │   │         rule: "index drop mutation visible before cleaning up index columns"
    │   │   │
    │   │   ├── • ColumnNotNull:{DescID: 106, ColumnID: 4, IndexID: 4}
    │   │   │   │ PUBLIC → VALIDATED
    │   │   │   │
    │   │   │   └── • PreviousTransactionPrecedence dependency from PUBLIC ColumnNotNull:{DescID: 106, ColumnID: 4, IndexID: 4}
    │   │   │         rule: "ColumnNotNull transitions to ABSENT uphold 2-version invariant: PUBLIC->VALIDATED"
    │   │   │
    │   │   ├── • ColumnName:{DescID: 106, Name: m, ColumnID: 5}
    │   │   │   │ PUBLIC → ABSENT
    │   │   │   │
    │   │   │   └── • Precedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 5}
    │   │   │         rule: "column no longer public before dependents"
    │   │   │
    │   │   ├── • IndexColumn:{DescID: 106, ColumnID: 5, IndexID: 5}
    │   │   │   │ PUBLIC → ABSENT
    │   │   │   │
    │   │   │   ├── • Precedence dependency from DELETE_ONLY TemporaryIndex:{DescID: 106, IndexID: 5, ConstraintID: 5, SourceIndexID: 1}
    │   │   │   │     rule: "index drop mutation visible before cleaning up index columns"
    │   │   │   │
    │   │   │   └── • Precedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 5}
    │   │   │         rule: "column no longer public before dependents"
    │   │   │
    │   │   └── • ColumnNotNull:{DescID: 106, ColumnID: 5, IndexID: 4}
    │   │       │ PUBLIC → VALIDATED
    │   │       │
    │   │       └── • PreviousTransactionPrecedence dependency from PUBLIC ColumnNotNull:{DescID: 106, ColumnID: 5, IndexID: 4}
    │   │             rule: "ColumnNotNull transitions to ABSENT uphold 2-version invariant: PUBLIC->VALIDATED"
    │   │
    │   └── • 25 Mutation operations
    │       │
    │       ├── • SetIndexName
    │       │     IndexID: 1
    │       │     Name: tbl_pkey
    │       │     TableID: 106
    │       │
    │       ├── • MakeWriteOnlyColumnDeleteOnly
    │       │     ColumnID: 3
    │       │     TableID: 106
    │       │
    │       ├── • SetColumnName
    │       │     ColumnID: 3
    │       │     Name: crdb_internal_column_3_name_placeholder
    │       │     TableID: 106
    │       │
    │       ├── • MakeWriteOnlyIndexDeleteOnly
    │       │     IndexID: 3
    │       │     TableID: 106
    │       │
    │       ├── • SetColumnName
    │       │     ColumnID: 4
    │       │     Name: crdb_internal_column_4_name_placeholder
    │       │     TableID: 106
    │       │
    │       ├── • MakePublicPrimaryIndexWriteOnly
    │       │     IndexID: 4
    │       │     TableID: 106
    │       │
    │       ├── • SetIndexName
    │       │     IndexID: 4
    │       │     Name: crdb_internal_index_4_name_placeholder
    │       │     TableID: 106
    │       │
    │       ├── • MakeWriteOnlyIndexDeleteOnly
    │       │     IndexID: 5
    │       │     TableID: 106
    │       │
    │       ├── • RemoveColumnFromIndex
    │       │     ColumnID: 1
    │       │     IndexID: 5
    │       │     TableID: 106
    │       │
    │       ├── • RemoveColumnFromIndex
    │       │     ColumnID: 2
    │       │     IndexID: 5
    │       │     Kind: 2
    │       │     TableID: 106
    │       │
    │       ├── • RemoveColumnFromIndex
    │       │     ColumnID: 3
    │       │     IndexID: 5
    │       │     Kind: 2
    │       │     Ordinal: 1
    │       │     TableID: 106
    │       │
    │       ├── • RemoveColumnFromIndex
    │       │     ColumnID: 4
    │       │     IndexID: 5
    │       │     Kind: 2
    │       │     Ordinal: 2
    │       │     TableID: 106
    │       │
    │       ├── • MakePublicColumnNotNullValidated
    │       │     ColumnID: 4
    │       │     TableID: 106
    │       │
    │       ├── • SetColumnName
    │       │     ColumnID: 5
    │       │     Name: crdb_internal_column_5_name_placeholder
    │       │     TableID: 106
    │       │
    │       ├── • RemoveColumnFromIndex
    │       │     ColumnID: 5
    │       │     IndexID: 5
    │       │     Kind: 2
    │       │     Ordinal: 3
    │       │     TableID: 106
    │       │
    │       ├── • MakePublicColumnNotNullValidated
    │       │     ColumnID: 5
    │       │     TableID: 106
    │       │
    │       ├── • MakeValidatedPrimaryIndexPublic
    │       │     IndexID: 1
    │       │     TableID: 106
    │       │
    │       ├── • MakeWriteOnlyIndexDeleteOnly
    │       │     IndexID: 2
    │       │     TableID: 106
    │       │
    │       ├── • SetIndexName
    │       │     IndexID: 2
    │       │     Name: crdb_internal_index_2_name_placeholder
    │       │     TableID: 106
    │       │
    │       ├── • RemoveColumnFromIndex
    │       │     ColumnID: 3
    │       │     IndexID: 3
    │       │     TableID: 106
    │       │
    │       ├── • RemoveColumnFromIndex
    │       │     ColumnID: 1
    │       │     IndexID: 3
    │       │     Kind: 1
    │       │     TableID: 106
    │       │
    │       ├── • RemoveColumnFromIndex
    │       │     ColumnID: 3
    │       │     IndexID: 2
    │       │     TableID: 106
    │       │
    │       ├── • RemoveColumnFromIndex
    │       │     ColumnID: 1
    │       │     IndexID: 2
    │       │     Kind: 1
    │       │     TableID: 106
    │       │
    │       ├── • SetJobStateOnDescriptor
    │       │     DescriptorID: 106
    │       │
    │       └── • UpdateSchemaChangerJob
    │             IsNonCancelable: true
    │             JobID: 1
    │             RunningStatus: PostCommitNonRevertiblePhase stage 2 of 3 with 13 MutationType ops pending
    │
    ├── • Stage 2 of 3 in PostCommitNonRevertiblePhase
    │   │
    │   ├── • 13 elements transitioning toward ABSENT
    │   │   │
    │   │   ├── • SecondaryIndex:{DescID: 106, IndexID: 2, ConstraintID: 2, TemporaryIndexID: 3, SourceIndexID: 4, RecreateSourceIndexID: 0}
    │   │   │   │ DELETE_ONLY → ABSENT
    │   │   │   │
    │   │   │   ├── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 3, IndexID: 2}
    │   │   │   │     rule: "dependents removed before index"
    │   │   │   │
    │   │   │   ├── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 1, IndexID: 2}
    │   │   │   │     rule: "dependents removed before index"
    │   │   │   │
    │   │   │   ├── • PreviousTransactionPrecedence dependency from DELETE_ONLY SecondaryIndex:{DescID: 106, IndexID: 2, ConstraintID: 2, TemporaryIndexID: 3, SourceIndexID: 4, RecreateSourceIndexID: 0}
    │   │   │   │     rule: "SecondaryIndex transitions to ABSENT uphold 2-version invariant: DELETE_ONLY->ABSENT"
    │   │   │   │
    │   │   │   └── • Precedence dependency from ABSENT IndexName:{DescID: 106, Name: tbl_l_key, IndexID: 2}
    │   │   │         rule: "dependents removed before index"
    │   │   │
    │   │   ├── • TemporaryIndex:{DescID: 106, IndexID: 3, ConstraintID: 3, SourceIndexID: 1}
    │   │   │   │ DELETE_ONLY → ABSENT
    │   │   │   │
    │   │   │   ├── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 3, IndexID: 3}
    │   │   │   │     rule: "dependents removed before index"
    │   │   │   │
    │   │   │   ├── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 1, IndexID: 3}
    │   │   │   │     rule: "dependents removed before index"
    │   │   │   │
    │   │   │   └── • PreviousTransactionPrecedence dependency from DELETE_ONLY TemporaryIndex:{DescID: 106, IndexID: 3, ConstraintID: 3, SourceIndexID: 1}
    │   │   │         rule: "TemporaryIndex transitions to ABSENT uphold 2-version invariant: DELETE_ONLY->ABSENT"
    │   │   │
    │   │   ├── • Column:{DescID: 106, ColumnID: 4}
    │   │   │   │ WRITE_ONLY → DELETE_ONLY
    │   │   │   │
    │   │   │   ├── • PreviousTransactionPrecedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 4}
    │   │   │   │     rule: "Column transitions to ABSENT uphold 2-version invariant: WRITE_ONLY->DELETE_ONLY"
    │   │   │   │
    │   │   │   └── • SameStagePrecedence dependency from ABSENT ColumnNotNull:{DescID: 106, ColumnID: 4, IndexID: 4}
    │   │   │         rule: "column constraint removed right before column reaches delete only"
    │   │   │
    │   │   ├── • PrimaryIndex:{DescID: 106, IndexID: 4, ConstraintID: 4, TemporaryIndexID: 5, SourceIndexID: 1}
    │   │   │   │ VALIDATED → DELETE_ONLY
    │   │   │   │
    │   │   │   └── • PreviousTransactionPrecedence dependency from VALIDATED PrimaryIndex:{DescID: 106, IndexID: 4, ConstraintID: 4, TemporaryIndexID: 5, SourceIndexID: 1}
    │   │   │         rule: "PrimaryIndex transitions to ABSENT uphold 2-version invariant: VALIDATED->WRITE_ONLY"
    │   │   │
    │   │   ├── • IndexColumn:{DescID: 106, ColumnID: 1, IndexID: 4}
    │   │   │   │ PUBLIC → ABSENT
    │   │   │   │
    │   │   │   └── • Precedence dependency from DELETE_ONLY PrimaryIndex:{DescID: 106, IndexID: 4, ConstraintID: 4, TemporaryIndexID: 5, SourceIndexID: 1}
    │   │   │         rule: "index drop mutation visible before cleaning up index columns"
    │   │   │
    │   │   ├── • IndexColumn:{DescID: 106, ColumnID: 2, IndexID: 4}
    │   │   │   │ PUBLIC → ABSENT
    │   │   │   │
    │   │   │   └── • Precedence dependency from DELETE_ONLY PrimaryIndex:{DescID: 106, IndexID: 4, ConstraintID: 4, TemporaryIndexID: 5, SourceIndexID: 1}
    │   │   │         rule: "index drop mutation visible before cleaning up index columns"
    │   │   │
    │   │   ├── • IndexColumn:{DescID: 106, ColumnID: 3, IndexID: 4}
    │   │   │   │ PUBLIC → ABSENT
    │   │   │   │
    │   │   │   ├── • Precedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 3}
    │   │   │   │     rule: "column no longer public before dependents"
    │   │   │   │
    │   │   │   └── • Precedence dependency from DELETE_ONLY PrimaryIndex:{DescID: 106, IndexID: 4, ConstraintID: 4, TemporaryIndexID: 5, SourceIndexID: 1}
    │   │   │         rule: "index drop mutation visible before cleaning up index columns"
    │   │   │
    │   │   ├── • IndexColumn:{DescID: 106, ColumnID: 4, IndexID: 4}
    │   │   │   │ PUBLIC → ABSENT
    │   │   │   │
    │   │   │   ├── • Precedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 4}
    │   │   │   │     rule: "column no longer public before dependents"
    │   │   │   │
    │   │   │   └── • Precedence dependency from DELETE_ONLY PrimaryIndex:{DescID: 106, IndexID: 4, ConstraintID: 4, TemporaryIndexID: 5, SourceIndexID: 1}
    │   │   │         rule: "index drop mutation visible before cleaning up index columns"
    │   │   │
    │   │   ├── • TemporaryIndex:{DescID: 106, IndexID: 5, ConstraintID: 5, SourceIndexID: 1}
    │   │   │   │ DELETE_ONLY → ABSENT
    │   │   │   │
    │   │   │   ├── • PreviousTransactionPrecedence dependency from DELETE_ONLY TemporaryIndex:{DescID: 106, IndexID: 5, ConstraintID: 5, SourceIndexID: 1}
    │   │   │   │     rule: "TemporaryIndex transitions to ABSENT uphold 2-version invariant: DELETE_ONLY->ABSENT"
    │   │   │   │
    │   │   │   ├── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 1, IndexID: 5}
    │   │   │   │     rule: "dependents removed before index"
    │   │   │   │
    │   │   │   ├── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 2, IndexID: 5}
    │   │   │   │     rule: "dependents removed before index"
    │   │   │   │
    │   │   │   ├── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 3, IndexID: 5}
    │   │   │   │     rule: "dependents removed before index"
    │   │   │   │
    │   │   │   ├── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 4, IndexID: 5}
    │   │   │   │     rule: "dependents removed before index"
    │   │   │   │
    │   │   │   └── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 5, IndexID: 5}
    │   │   │         rule: "dependents removed before index"
    │   │   │
    │   │   ├── • ColumnNotNull:{DescID: 106, ColumnID: 4, IndexID: 4}
    │   │   │   │ VALIDATED → ABSENT
    │   │   │   │
    │   │   │   ├── • Precedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 4}
    │   │   │   │     rule: "column no longer public before dependents"
    │   │   │   │
    │   │   │   └── • PreviousTransactionPrecedence dependency from VALIDATED ColumnNotNull:{DescID: 106, ColumnID: 4, IndexID: 4}
    │   │   │         rule: "ColumnNotNull transitions to ABSENT uphold 2-version invariant: VALIDATED->ABSENT"
    │   │   │
    │   │   ├── • Column:{DescID: 106, ColumnID: 5}
    │   │   │   │ WRITE_ONLY → DELETE_ONLY
    │   │   │   │
    │   │   │   ├── • PreviousTransactionPrecedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 5}
    │   │   │   │     rule: "Column transitions to ABSENT uphold 2-version invariant: WRITE_ONLY->DELETE_ONLY"
    │   │   │   │
    │   │   │   └── • SameStagePrecedence dependency from ABSENT ColumnNotNull:{DescID: 106, ColumnID: 5, IndexID: 4}
    │   │   │         rule: "column constraint removed right before column reaches delete only"
    │   │   │
    │   │   ├── • IndexColumn:{DescID: 106, ColumnID: 5, IndexID: 4}
    │   │   │   │ PUBLIC → ABSENT
    │   │   │   │
    │   │   │   ├── • Precedence dependency from DELETE_ONLY PrimaryIndex:{DescID: 106, IndexID: 4, ConstraintID: 4, TemporaryIndexID: 5, SourceIndexID: 1}
    │   │   │   │     rule: "index drop mutation visible before cleaning up index columns"
    │   │   │   │
    │   │   │   └── • Precedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 5}
    │   │   │         rule: "column no longer public before dependents"
    │   │   │
    │   │   └── • ColumnNotNull:{DescID: 106, ColumnID: 5, IndexID: 4}
    │   │       │ VALIDATED → ABSENT
    │   │       │
    │   │       ├── • Precedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 5}
    │   │       │     rule: "column no longer public before dependents"
    │   │       │
    │   │       └── • PreviousTransactionPrecedence dependency from VALIDATED ColumnNotNull:{DescID: 106, ColumnID: 5, IndexID: 4}
    │   │             rule: "ColumnNotNull transitions to ABSENT uphold 2-version invariant: VALIDATED->ABSENT"
    │   │
    │   └── • 15 Mutation operations
    │       │
    │       ├── • MakeIndexAbsent
    │       │     IndexID: 2
    │       │     TableID: 106
    │       │
    │       ├── • MakeIndexAbsent
    │       │     IndexID: 3
    │       │     TableID: 106
    │       │
    │       ├── • MakeIndexAbsent
    │       │     IndexID: 5
    │       │     TableID: 106
    │       │
    │       ├── • RemoveColumnNotNull
    │       │     ColumnID: 4
    │       │     TableID: 106
    │       │
    │       ├── • RemoveColumnNotNull
    │       │     ColumnID: 5
    │       │     TableID: 106
    │       │
    │       ├── • MakeWriteOnlyColumnDeleteOnly
    │       │     ColumnID: 4
    │       │     TableID: 106
    │       │
    │       ├── • MakeWriteOnlyIndexDeleteOnly
    │       │     IndexID: 4
    │       │     TableID: 106
    │       │
    │       ├── • RemoveColumnFromIndex
    │       │     ColumnID: 1
    │       │     IndexID: 4
    │       │     TableID: 106
    │       │
    │       ├── • RemoveColumnFromIndex
    │       │     ColumnID: 2
    │       │     IndexID: 4
    │       │     Kind: 2
    │       │     TableID: 106
    │       │
    │       ├── • RemoveColumnFromIndex
    │       │     ColumnID: 3
    │       │     IndexID: 4
    │       │     Kind: 2
    │       │     Ordinal: 1
    │       │     TableID: 106
    │       │
    │       ├── • RemoveColumnFromIndex
    │       │     ColumnID: 4
    │       │     IndexID: 4
    │       │     Kind: 2
    │       │     Ordinal: 2
    │       │     TableID: 106
    │       │
    │       ├── • MakeWriteOnlyColumnDeleteOnly
    │       │     ColumnID: 5
    │       │     TableID: 106
    │       │
    │       ├── • RemoveColumnFromIndex
    │       │     ColumnID: 5
    │       │     IndexID: 4
    │       │     Kind: 2
    │       │     Ordinal: 3
    │       │     TableID: 106
    │       │
    │       ├── • SetJobStateOnDescriptor
    │       │     DescriptorID: 106
    │       │
    │       └── • UpdateSchemaChangerJob
    │             IsNonCancelable: true
    │             JobID: 1
    │             RunningStatus: PostCommitNonRevertiblePhase stage 3 of 3 with 10 MutationType ops pending
    │
    └── • Stage 3 of 3 in PostCommitNonRevertiblePhase
        │
        ├── • 13 elements transitioning toward ABSENT
        │   │
        │   ├── • Column:{DescID: 106, ColumnID: 3}
        │   │   │ DELETE_ONLY → ABSENT
        │   │   │
        │   │   ├── • PreviousTransactionPrecedence dependency from DELETE_ONLY Column:{DescID: 106, ColumnID: 3}
        │   │   │     rule: "Column transitions to ABSENT uphold 2-version invariant: DELETE_ONLY->ABSENT"
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT ColumnName:{DescID: 106, Name: l, ColumnID: 3}
        │   │   │     rule: "dependents removed before column"
        │   │   │
        │   │   ├── • SameStagePrecedence dependency from ABSENT ColumnType:{DescID: 106, ColumnFamilyID: 0, ColumnID: 3}
        │   │   │     rule: "dependents removed before column"
        │   │   │     rule: "column type removed right before column when not dropping relation"
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 3, IndexID: 2}
        │   │   │     rule: "dependents removed before column"
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT SecondaryIndex:{DescID: 106, IndexID: 2, ConstraintID: 2, TemporaryIndexID: 3, SourceIndexID: 4, RecreateSourceIndexID: 0}
        │   │   │     rule: "indexes containing column reach absent before column"
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 3, IndexID: 3}
        │   │   │     rule: "dependents removed before column"
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT PrimaryIndex:{DescID: 106, IndexID: 4, ConstraintID: 4, TemporaryIndexID: 5, SourceIndexID: 1}
        │   │   │     rule: "indexes containing column reach absent before column"
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 3, IndexID: 4}
        │   │   │     rule: "dependents removed before column"
        │   │   │
        │   │   └── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 3, IndexID: 5}
        │   │         rule: "dependents removed before column"
        │   │
        │   ├── • ColumnType:{DescID: 106, ColumnFamilyID: 0, ColumnID: 3}
        │   │   │ PUBLIC → ABSENT
        │   │   │
        │   │   └── • Precedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 3}
        │   │         rule: "column no longer public before dependents"
        │   │
        │   ├── • IndexData:{DescID: 106, IndexID: 2}
        │   │   │ PUBLIC → ABSENT
        │   │   │
        │   │   └── • Precedence dependency from ABSENT SecondaryIndex:{DescID: 106, IndexID: 2, ConstraintID: 2, TemporaryIndexID: 3, SourceIndexID: 4, RecreateSourceIndexID: 0}
        │   │         rule: "index removed before garbage collection"
        │   │
        │   ├── • IndexData:{DescID: 106, IndexID: 3}
        │   │   │ PUBLIC → ABSENT
        │   │   │
        │   │   ├── • SameStagePrecedence dependency from DROPPED IndexData:{DescID: 106, IndexID: 2}
        │   │   │     rule: "schedule all GC jobs for a descriptor in the same stage"
        │   │   │
        │   │   └── • Precedence dependency from ABSENT TemporaryIndex:{DescID: 106, IndexID: 3, ConstraintID: 3, SourceIndexID: 1}
        │   │         rule: "index removed before garbage collection"
        │   │
        │   ├── • Column:{DescID: 106, ColumnID: 4}
        │   │   │ DELETE_ONLY → ABSENT
        │   │   │
        │   │   ├── • PreviousTransactionPrecedence dependency from DELETE_ONLY Column:{DescID: 106, ColumnID: 4}
        │   │   │     rule: "Column transitions to ABSENT uphold 2-version invariant: DELETE_ONLY->ABSENT"
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT ColumnName:{DescID: 106, Name: j, ColumnID: 4}
        │   │   │     rule: "dependents removed before column"
        │   │   │
        │   │   ├── • SameStagePrecedence dependency from ABSENT ColumnType:{DescID: 106, ColumnFamilyID: 0, ColumnID: 4}
        │   │   │     rule: "dependents removed before column"
        │   │   │     rule: "column type removed right before column when not dropping relation"
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT ColumnDefaultExpression:{DescID: 106, ColumnID: 4}
        │   │   │     rule: "dependents removed before column"
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT PrimaryIndex:{DescID: 106, IndexID: 4, ConstraintID: 4, TemporaryIndexID: 5, SourceIndexID: 1}
        │   │   │     rule: "indexes containing column reach absent before column"
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 4, IndexID: 4}
        │   │   │     rule: "dependents removed before column"
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 4, IndexID: 5}
        │   │   │     rule: "dependents removed before column"
        │   │   │
        │   │   └── • Precedence dependency from ABSENT ColumnNotNull:{DescID: 106, ColumnID: 4, IndexID: 4}
        │   │         rule: "dependents removed before column"
        │   │
        │   ├── • ColumnType:{DescID: 106, ColumnFamilyID: 0, ColumnID: 4}
        │   │   │ PUBLIC → ABSENT
        │   │   │
        │   │   ├── • Precedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 4}
        │   │   │     rule: "column no longer public before dependents"
        │   │   │
        │   │   └── • SameStagePrecedence dependency from ABSENT ColumnDefaultExpression:{DescID: 106, ColumnID: 4}
        │   │         rule: "column type dependents removed right before column type"
        │   │
        │   ├── • ColumnDefaultExpression:{DescID: 106, ColumnID: 4}
        │   │   │ PUBLIC → ABSENT
        │   │   │
        │   │   └── • Precedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 4}
        │   │         rule: "column no longer public before dependents"
        │   │
        │   ├── • PrimaryIndex:{DescID: 106, IndexID: 4, ConstraintID: 4, TemporaryIndexID: 5, SourceIndexID: 1}
        │   │   │ DELETE_ONLY → ABSENT
        │   │   │
        │   │   ├── • PreviousTransactionPrecedence dependency from DELETE_ONLY PrimaryIndex:{DescID: 106, IndexID: 4, ConstraintID: 4, TemporaryIndexID: 5, SourceIndexID: 1}
        │   │   │     rule: "PrimaryIndex transitions to ABSENT uphold 2-version invariant: DELETE_ONLY->ABSENT"
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT IndexName:{DescID: 106, Name: tbl_pkey, IndexID: 4}
        │   │   │     rule: "dependents removed before index"
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 1, IndexID: 4}
        │   │   │     rule: "dependents removed before index"
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 2, IndexID: 4}
        │   │   │     rule: "dependents removed before index"
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 3, IndexID: 4}
        │   │   │     rule: "dependents removed before index"
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 4, IndexID: 4}
        │   │   │     rule: "dependents removed before index"
        │   │   │
        │   │   └── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 5, IndexID: 4}
        │   │         rule: "dependents removed before index"
        │   │
        │   ├── • IndexData:{DescID: 106, IndexID: 4}
        │   │   │ PUBLIC → ABSENT
        │   │   │
        │   │   ├── • SameStagePrecedence dependency from DROPPED IndexData:{DescID: 106, IndexID: 2}
        │   │   │     rule: "schedule all GC jobs for a descriptor in the same stage"
        │   │   │
        │   │   ├── • SameStagePrecedence dependency from DROPPED IndexData:{DescID: 106, IndexID: 3}
        │   │   │     rule: "schedule all GC jobs for a descriptor in the same stage"
        │   │   │
        │   │   └── • Precedence dependency from ABSENT PrimaryIndex:{DescID: 106, IndexID: 4, ConstraintID: 4, TemporaryIndexID: 5, SourceIndexID: 1}
        │   │         rule: "index removed before garbage collection"
        │   │
        │   ├── • IndexData:{DescID: 106, IndexID: 5}
        │   │   │ PUBLIC → ABSENT
        │   │   │
        │   │   ├── • SameStagePrecedence dependency from DROPPED IndexData:{DescID: 106, IndexID: 2}
        │   │   │     rule: "schedule all GC jobs for a descriptor in the same stage"
        │   │   │
        │   │   ├── • SameStagePrecedence dependency from DROPPED IndexData:{DescID: 106, IndexID: 3}
        │   │   │     rule: "schedule all GC jobs for a descriptor in the same stage"
        │   │   │
        │   │   ├── • SameStagePrecedence dependency from DROPPED IndexData:{DescID: 106, IndexID: 4}
        │   │   │     rule: "schedule all GC jobs for a descriptor in the same stage"
        │   │   │
        │   │   └── • Precedence dependency from ABSENT TemporaryIndex:{DescID: 106, IndexID: 5, ConstraintID: 5, SourceIndexID: 1}
        │   │         rule: "index removed before garbage collection"
        │   │
        │   ├── • Column:{DescID: 106, ColumnID: 5}
        │   │   │ DELETE_ONLY → ABSENT
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT PrimaryIndex:{DescID: 106, IndexID: 4, ConstraintID: 4, TemporaryIndexID: 5, SourceIndexID: 1}
        │   │   │     rule: "indexes containing column reach absent before column"
        │   │   │
        │   │   ├── • PreviousTransactionPrecedence dependency from DELETE_ONLY Column:{DescID: 106, ColumnID: 5}
        │   │   │     rule: "Column transitions to ABSENT uphold 2-version invariant: DELETE_ONLY->ABSENT"
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT ColumnName:{DescID: 106, Name: m, ColumnID: 5}
        │   │   │     rule: "dependents removed before column"
        │   │   │
        │   │   ├── • SameStagePrecedence dependency from ABSENT ColumnType:{DescID: 106, ColumnFamilyID: 0, ColumnID: 5}
        │   │   │     rule: "dependents removed before column"
        │   │   │     rule: "column type removed right before column when not dropping relation"
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT ColumnDefaultExpression:{DescID: 106, ColumnID: 5}
        │   │   │     rule: "dependents removed before column"
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 5, IndexID: 4}
        │   │   │     rule: "dependents removed before column"
        │   │   │
        │   │   ├── • Precedence dependency from ABSENT IndexColumn:{DescID: 106, ColumnID: 5, IndexID: 5}
        │   │   │     rule: "dependents removed before column"
        │   │   │
        │   │   └── • Precedence dependency from ABSENT ColumnNotNull:{DescID: 106, ColumnID: 5, IndexID: 4}
        │   │         rule: "dependents removed before column"
        │   │
        │   ├── • ColumnType:{DescID: 106, ColumnFamilyID: 0, ColumnID: 5}
        │   │   │ PUBLIC → ABSENT
        │   │   │
        │   │   ├── • Precedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 5}
        │   │   │     rule: "column no longer public before dependents"
        │   │   │
        │   │   └── • SameStagePrecedence dependency from ABSENT ColumnDefaultExpression:{DescID: 106, ColumnID: 5}
        │   │         rule: "column type dependents removed right before column type"
        │   │
        │   └── • ColumnDefaultExpression:{DescID: 106, ColumnID: 5}
        │       │ PUBLIC → ABSENT
        │       │
        │       └── • Precedence dependency from WRITE_ONLY Column:{DescID: 106, ColumnID: 5}
        │             rule: "column no longer public before dependents"
        │
        └── • 12 Mutation operations
            │
            ├── • CreateGCJobForIndex
            │     IndexID: 2
            │     StatementForDropJob:
            │       Rollback: true
            │       Statement: ALTER TABLE db.public.tbl ADD COLUMN l INT8 UNIQUE DEFAULT NULL, ADD COLUMN j INT8 NOT NULL DEFAULT 42, ADD COLUMN m INT8 NOT NULL DEFAULT 42
            │     TableID: 106
            │
            ├── • CreateGCJobForIndex
            │     IndexID: 3
            │     StatementForDropJob:
            │       Rollback: true
            │       Statement: ALTER TABLE db.public.tbl ADD COLUMN l INT8 UNIQUE DEFAULT NULL, ADD COLUMN j INT8 NOT NULL DEFAULT 42, ADD COLUMN m INT8 NOT NULL DEFAULT 42
            │     TableID: 106
            │
            ├── • RemoveColumnDefaultExpression
            │     ColumnID: 4
            │     TableID: 106
            │
            ├── • MakeIndexAbsent
            │     IndexID: 4
            │     TableID: 106
            │
            ├── • CreateGCJobForIndex
            │     IndexID: 4
            │     StatementForDropJob:
            │       Rollback: true
            │       Statement: ALTER TABLE db.public.tbl ADD COLUMN l INT8 UNIQUE DEFAULT NULL, ADD COLUMN j INT8 NOT NULL DEFAULT 42, ADD COLUMN m INT8 NOT NULL DEFAULT 42
            │     TableID: 106
            │
            ├── • CreateGCJobForIndex
            │     IndexID: 5
            │     StatementForDropJob:
            │       Rollback: true
            │       Statement: ALTER TABLE db.public.tbl ADD COLUMN l INT8 UNIQUE DEFAULT NULL, ADD COLUMN j INT8 NOT NULL DEFAULT 42, ADD COLUMN m INT8 NOT NULL DEFAULT 42
            │     TableID: 106
            │
            ├── • RemoveColumnDefaultExpression
            │     ColumnID: 5
            │     TableID: 106
            │
            ├── • MakeDeleteOnlyColumnAbsent
            │     ColumnID: 3
            │     TableID: 106
            │
            ├── • MakeDeleteOnlyColumnAbsent
            │     ColumnID: 4
            │     TableID: 106
            │
            ├── • MakeDeleteOnlyColumnAbsent
            │     ColumnID: 5
            │     TableID: 106
            │
            ├── • RemoveJobStateFromDescriptor
            │     DescriptorID: 106
            │     JobID: 1
            │
            └── • UpdateSchemaChangerJob
                  DescriptorIDsToRemove:
                  - 106
                  IsNonCancelable: true
                  JobID: 1
                  RunningStatus: all stages completed
