schema
i32: Int32
i64: Int64
u32: Uint32
s:   String
----

# Define 5 entities for use below. Note e5 and e1 are the same.
entities
e1: {i32: 1, i64: 1, u32: 1, s: hi}
e2: {i32: 1, i64: 1, u32: 2, s: hi}
e3: {i32: 1, i64: 1, u32: 1}
e4: {i32: 1, i64: 1}
e5: {i32: 1, i64: 1, u32: 1, s: hi}
e6: {i32: 2, i64: 1, u32: 1, s: hi}
e7: {i32: 2, i64: 1, u32: 2, s: yo}
e8: {i32: 2, i64: 1, u32: 2, s: sup}
e9: {i32: 3, i64: 2, u32: 2, s: yo}
e10: {i32: 4, i64: 2, u32: 2, s: howdy}
----

# Construct a new database.
new-db name=foo
----


# Insert some of the items.
insert db=foo
[e1, e2, e3]
----

iterate db=foo
{s: hi}
----
e1,e2

# Make sure we get what we inserted.
iterate db=foo
----
e1,e2,e3

iterate db=foo
{u32: 1}
----
e1,e3


# insert the rest. Observe that e1 was overwritten.
insert db=foo
[e4, e5, e6, e7, e8, e9, e10]
----

iterate db=foo
----
e10,e2,e3,e4,e5,e6,e7,e8,e9

iterate db=foo
{i32: 2, s: hi}
----
e6

iterate db=foo
{i32: 2, s: yo}
----
e7


# Construct a new database with indexes.
new-db name=bar
- [u32]
- [s, i32]
- [i32, s]
----

# Insert some of the items.
insert db=bar
[e1, e2, e3, e4, e5, e6, e7, e8, e9, e10]
----

iterate db=bar
----
e10,e2,e3,e4,e5,e6,e7,e8,e9

iterate db=bar
{u32: 1}
----
e3,e5,e6

iterate db=bar
{s: hi}
----
e2,e5,e6

iterate db=bar
{i32: 2}
----
e6,e7,e8


iterate db=bar
{i32: 2, s: hi}
----
e6

iterate db=bar
{i32: 2, s: yo}
----
e7


iterate db=bar
{u32: nil}
----
e10,e2,e3,e4,e5,e6,e7,e8,e9
