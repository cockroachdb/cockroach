# Verify information_schema database handles mutation statements correctly.

# TODO(nvanbenschoten) Blocked on #7998.
#query error dsaodjassjdoiasjdio
#ALTER DATABASE information_schema RENAME TO not_information_schema

statement error user root does not have CREATE privilege on database information_schema
CREATE TABLE information_schema.t (x INT)

query error user root does not have DROP privilege on database information_schema
DROP DATABASE information_schema


# Verify other databases cant be called "information_schema".

statement ok
CREATE DATABASE other_db

statement error the new database name "information_schema" already exists
ALTER DATABASE other_db RENAME TO information_schema

statement error database "information_schema" already exists
CREATE DATABASE information_schema

statement ok
DROP DATABASE other_db


# Verify information_schema tables handle mutation statements correctly.

statement error user root does not have DROP privilege on table tables
ALTER TABLE information_schema.tables RENAME TO information_schema.bad

statement error user root does not have CREATE privilege on table tables
ALTER TABLE information_schema.tables RENAME COLUMN x TO y

statement error user root does not have CREATE privilege on table tables
ALTER TABLE information_schema.tables ADD COLUMN x DECIMAL

statement error user root does not have CREATE privilege on table tables
ALTER TABLE information_schema.tables DROP COLUMN x

statement error user root does not have CREATE privilege on table tables
ALTER TABLE information_schema.tables ADD CONSTRAINT foo UNIQUE (b)

statement error user root does not have CREATE privilege on table tables
ALTER TABLE information_schema.tables DROP CONSTRAINT bar

statement error user root does not have CREATE privilege on table tables
ALTER TABLE information_schema.tables ALTER COLUMN x SET DEFAULT 'foo'

statement error user root does not have CREATE privilege on table tables
ALTER TABLE information_schema.tables ALTER x DROP NOT NULL

statement error user root does not have CREATE privilege on table tables
CREATE INDEX i on information_schema.tables (x)

statement error user root does not have DROP privilege on table tables
DROP TABLE information_schema.tables

statement error user root does not have CREATE privilege on table tables
DROP INDEX information_schema.tables@i

statement error user root does not have GRANT privilege on table tables
GRANT CREATE ON information_schema.tables TO root

statement error user root does not have GRANT privilege on table tables
REVOKE CREATE ON information_schema.tables FROM root


# Verify information_schema tables handles read-only property correctly.

query error user root does not have DELETE privilege on table tables
DELETE FROM information_schema.tables

query error user root does not have INSERT privilege on table tables
INSERT INTO information_schema.tables VALUES ('abc')

statement error user root does not have UPDATE privilege on table tables
UPDATE information_schema.tables SET a = 'abc'

statement error user root does not have DROP privilege on table tables
TRUNCATE TABLE information_schema.tables


# Verify information_schema can be used like a normal database.

statement ok
SET DATABASE = information_schema

statement ok
SET DATABASE = ''


# Verify information_schema handles reflection correctly.

query T
SHOW DATABASES
----
information_schema
system
test

query T
SHOW TABLES FROM information_schema
----
tables

query TT colnames
SHOW CREATE TABLE information_schema.tables
----
Table                      CreateTable
information_schema.tables  CREATE TABLE "information_schema.tables" (
                               TABLE_CATALOG STRING NOT NULL DEFAULT '',
                               TABLE_SCHEMA STRING NOT NULL DEFAULT '',
                               TABLE_NAME STRING NOT NULL DEFAULT '',
                               TABLE_TYPE STRING NOT NULL DEFAULT '',
                               ENGINE STRING NULL,
                               VERSION INT NULL,
                               ROW_FORMAT STRING NULL,
                               TABLE_ROWS INT NULL,
                               AVG_ROW_LENGTH INT NULL,
                               DATA_LENGTH INT NULL,
                               MAX_DATA_LENGTH INT NULL,
                               INDEX_LENGTH INT NULL,
                               DATA_FREE INT NULL,
                               AUTO_INCREMENT INT NULL,
                               CREATE_TIME TIMESTAMP NULL,
                               UPDATE_TIME TIMESTAMP NULL,
                               CHECK_TIME TIMESTAMP NULL,
                               TABLE_COLLATION STRING NULL,
                               CHECKSUM INT NULL,
                               CREATE_OPTIONS STRING NULL,
                               TABLE_COMMENT STRING NOT NULL DEFAULT ''
                           )

query TTBT colnames
SHOW COLUMNS FROM information_schema.tables
----
Field            Type       Null   Default
TABLE_CATALOG    STRING     false  ''
TABLE_SCHEMA     STRING     false  ''
TABLE_NAME       STRING     false  ''
TABLE_TYPE       STRING     false  ''
ENGINE           STRING     true   NULL
VERSION          INT        true   NULL
ROW_FORMAT       STRING     true   NULL
TABLE_ROWS       INT        true   NULL
AVG_ROW_LENGTH   INT        true   NULL
DATA_LENGTH      INT        true   NULL
MAX_DATA_LENGTH  INT        true   NULL
INDEX_LENGTH     INT        true   NULL
DATA_FREE        INT        true   NULL
AUTO_INCREMENT   INT        true   NULL
CREATE_TIME      TIMESTAMP  true   NULL
UPDATE_TIME      TIMESTAMP  true   NULL
CHECK_TIME       TIMESTAMP  true   NULL
TABLE_COLLATION  STRING     true   NULL
CHECKSUM         INT        true   NULL
CREATE_OPTIONS   STRING     true   NULL
TABLE_COMMENT    STRING     false  ''

query TTTTTTT colnames
SHOW INDEXES FROM information_schema.tables
----
Table  Name  Unique  Seq  Column  Direction  Storing

query TTTTT colnames
SHOW CONSTRAINTS FROM information_schema.tables
----
Table   Name     Type  Column(s)  Details
tables  PRIMARY  KEY   []         NULL

query TTT colnames
SHOW GRANTS ON information_schema.tables
----
Table  User  Privileges
