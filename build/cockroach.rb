### Generated by build/make-brew-formula.rb
### source: build/cockroach-template.rb
### DO NOT EDIT!'

require "language/go"

class Cockroach < Formula
  desc "Distributed SQL database"
  homepage "https://www.cockroachlabs.com"
  url "https://github.com/cockroachdb/cockroach.git",
      :tag => "v0.1-alpha",
      :revision => "26088f81e5ecfb2fd63f8f15f524102c9a0c1c05"
  head "https://github.com/cockroachdb/cockroach.git"

  depends_on "go" => :build

  go_resource "github.com/biogo/store" do
    url "https://github.com/biogo/store.git",
      :revision => "3b4c041f52c224ee4a44f5c8b150d003a40643a0"
  end

  go_resource "github.com/cockroachdb/c-lz4" do
    url "https://github.com/cockroachdb/c-lz4.git",
      :revision => "c40aaae2fc50293eb8750b34632bc3efe813e23f"
  end

  go_resource "github.com/cockroachdb/c-protobuf" do
    url "https://github.com/cockroachdb/c-protobuf.git",
      :revision => "6a18bfcdd5169966cd1235edb71d749c950216e8"
  end

  go_resource "github.com/cockroachdb/c-rocksdb" do
    url "https://github.com/cockroachdb/c-rocksdb.git",
      :revision => "bf15ead80bdc205a19b3d33415b23c156a3cf371"
  end

  go_resource "github.com/cockroachdb/c-snappy" do
    url "https://github.com/cockroachdb/c-snappy.git",
      :revision => "5c6d0932e0adaffce4bfca7bdf2ac37f79952ccf"
  end

  go_resource "github.com/coreos/etcd" do
    url "https://github.com/coreos/etcd.git",
      :revision => "0eb46eb1457bf277a5d6093287290b2b5cd6a964"
  end

  go_resource "github.com/cpuguy83/go-md2man" do
    url "https://github.com/cpuguy83/go-md2man.git",
      :revision => "71acacd42f85e5e82f70a55327789582a5200a90"
  end

  go_resource "github.com/elazarl/go-bindata-assetfs" do
    url "https://github.com/elazarl/go-bindata-assetfs.git",
      :revision => "d5cac425555ca5cf00694df246e04f05e6a55150"
  end

  go_resource "github.com/gogo/protobuf" do
    url "https://github.com/gogo/protobuf.git",
      :revision => "8658879224bd739bf5f1009a686d4841ef397843"
  end

  go_resource "github.com/google/btree" do
    url "https://github.com/google/btree.git",
      :revision => "cc6329d4279e3f025a53a83c397d2339b5705c45"
  end

  go_resource "github.com/inconshreveable/mousetrap" do
    url "https://github.com/inconshreveable/mousetrap.git",
      :revision => "76626ae9c91c4f2a10f34cad8ce83ea42c93bb75"
  end

  go_resource "github.com/julienschmidt/httprouter" do
    url "https://github.com/julienschmidt/httprouter.git",
      :revision => "f30ab90cccbd5171771d26b6557d3c2f49e047a6"
  end

  go_resource "github.com/lib/pq" do
    url "https://github.com/lib/pq.git",
      :revision => "11fc39a580a008f1f39bb3d11d984fb34ed778d9"
  end

  go_resource "github.com/mattn/go-runewidth" do
    url "https://github.com/mattn/go-runewidth.git",
      :revision => "d96d1bd051f2bd9e7e43d602782b37b93b1b5666"
  end

  go_resource "github.com/montanaflynn/stats" do
    url "https://github.com/montanaflynn/stats.git",
      :revision => "4dd27fe9ac7947061538cabe6563c806a4bb3807"
  end

  go_resource "github.com/olekukonko/tablewriter" do
    url "https://github.com/olekukonko/tablewriter.git",
      :revision => "333c0610de3426f738e7ec63801cfd1883b0aeb4"
  end

  go_resource "github.com/peterh/liner" do
    url "https://github.com/peterh/liner.git",
      :revision => "4d47685ab2fd2dbb46c66b831344d558bc4be5b9"
  end

  go_resource "github.com/rcrowley/go-metrics" do
    url "https://github.com/rcrowley/go-metrics.git",
      :revision => "7839c01b09d2b1d7068034e5fe6e423f6ac5be22"
  end

  go_resource "github.com/russross/blackfriday" do
    url "https://github.com/russross/blackfriday.git",
      :revision => "d18b67ae0afd61dae240896eae1785f00709aa31"
  end

  go_resource "github.com/shurcooL/sanitized_anchor_name" do
    url "https://github.com/shurcooL/sanitized_anchor_name.git",
      :revision => "10ef21a441db47d8b13ebcc5fd2310f636973c77"
  end

  go_resource "github.com/spf13/cobra" do
    url "https://github.com/spf13/cobra.git",
      :revision => "ee6224d01f6a83f543ae90f881b703cf195782ba"
  end

  go_resource "github.com/spf13/pflag" do
    url "https://github.com/spf13/pflag.git",
      :revision => "08b1a584251b5b62f458943640fc8ebd4d50aaa5"
  end

  go_resource "golang.org/x/crypto" do
    url "https://golang.org/x/crypto.git",
      :revision => "7b85b097bf7527677d54d3220065e966a0e3b613"
  end

  go_resource "golang.org/x/net" do
    url "https://golang.org/x/net.git",
      :revision => "21af302bb52737bcf1e6ce0128ec5932bf0d8ae9"
  end

  go_resource "golang.org/x/text" do
    url "https://golang.org/x/text.git",
      :revision => "00e205363f74f74c3c03b7a12427ec0747a23089"
  end

  go_resource "gopkg.in/yaml.v1" do
    url "https://gopkg.in/yaml.v1.git",
      :revision => "9f9df34309c04878acc86042b16630b0f696e1de"
  end

  def install
    ENV["GOBIN"] = bin
    ENV["GOPATH"] = buildpath
    ENV["GOHOME"] = buildpath

    files = Dir.glob("*")
    mkdir_p buildpath/"src/github.com/cockroachdb/cockroach"
    mv files, buildpath/"src/github.com/cockroachdb/cockroach"
    Language::Go.stage_deps resources, buildpath/"src"

    # TODO(peter): We should be using the cockroach makefile so that
    # we can get the build information baked into the
    # binary. Unfortunately, this is dying with some weird dwarf
    # linker error:
    #
    #   make -C src/github.com/cockroachdb/cockroach build SKIP_BOOTSTRAP=1
    #
    # Something truly bizarre is going on. The error is:
    #
    # # github.com/cockroachdb/c-snappy
    # cannot load DWARF output from $WORK/github.com/cockroachdb/c-snappy/_obj//_cgo_.o: decoding dwarf section info at offset 0x0: too short
    #
    # But that error only happens when building with make. Using go
    # directly and everything works fine. Additionally,
    # build/depvers.sh returns nothing when run in the homebrew build
    # environment. But if I execute the "go list" directives inside
    # the debugging shell it works. Wtf?
    system "go", "build", "-v", "-o", bin/"cockroach", "github.com/cockroachdb/cockroach"
  end

  test do
    system "#{bin}/cockroach", "version"
  end

  # TODO(peter): Need to figure out how set cockroach to running.
end
