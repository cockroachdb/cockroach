
# Documentation for logging sinks

The supported log output sink types are documented below.


- [output to files](#sink-output-to-files)

- [standard error stream](#sink-standard-error-stream)



<a name="output-to-files">

## Sink type: output to files


Files under a configurable logging directory.

This sink type causes logging data to be captured into *file groups*,
one group per configured sink.

The configuration key under the `sinks` key in the YAML
configuration is `file-groups`. Example configuration:

    sinks:
       file-groups:           # file group configurations start here
          health:             # defines one group called "health"
             channels: HEALTH

Each generated log file is prefixed by the name of the process,
followed by the name of the group, separated by a hyphen.  For
example, the group `health` will generate files named
`cockroach-health.XXX.log`, assuming the process is named
`cockroach`. (A user can influence the prefix by renaming the
program executable.)

The files are named so that a lexicographical sort of the
directory contents presents the file in creation order.

Additionally, every time a new log file is generated,
a shorthand symbolic link (e.g. `cockroach-health.log`)
is maintain to point to the latest file.

Regarding configuration, a cascading defaults mechanism is
available: every new file group sink configured automatically
inherits the configurations set in the `file-defaults` section.

For example:

     file-defaults:
         redactable: false # default: disable redaction markers
         dir: logs
     sinks:
       file-groups:
         health:
            channels: HEALTH
            # This sink has redactable set to false,
            # as the setting is inherited from file-defaults
            # unless overridden here.
            #
            # Example override:
            dir: health-logs # override the default 'logs'

Users are invited to peruse the `check-log-config` tool to
verify the effect of defaults inheritance.



Type-specific configuration options:

| Field | Description |
|--|--|
| `channels` | the list of logging channels that use this sink. See the [channel selection configuration](#channel-format) section for details.  |
| `dir` | specifies the output directory for files generated by this sink. Inherited from `file-defaults.dir` if not specified. |
| `max-file-size` | the approximate maximum size of individual files generated by this sink. Inherited from `file-defaults.max-file-size` if not specified. |
| `max-group-size` | the approximate maximum combined size of all files to be preserved for this sink. An asynchronous garbage collection removes files that cause the file set to grow beyond this specified size. Inherited from `file-defaults.max-group-size` if not specified. |
| `buffered-writes` | specifies whether to flush on every log write. Inherited from `file-defaults.buffered-writes` if not specified. |


Configuration options shared across all sink types:

| Field | Description |
|--|--|
| `filter` | the minimum severity for log events to be emitted to this sink. This can be set to NONE to disable the sink. |
| `format` | the entry format to use. |
| `redact` | whether to strip sensitive information before log events are emitted to this sink. |
| `redactable` | whether to keep redaction markers in the sink's output. The presence of redaction markers makes it possible to strip sensitive data reliably. |
| `exit-on-error` | whether the logging system should terminate the process if an error is encountered while writing to this sink. |
| `auditable` | translated to tweaks to the other settings for this sink during validation. For example, it enables `exit-on-error` and changes the format of files from `crdb-v1` to `crdb-v1-count`. |



<a name="standard-error-stream">

## Sink type: standard error stream


The standard error output stream of the running `cockroach`
process.

The configuration key under the `sinks` key in the YAML configuration
is `stderr`. Example configuration:

    sinks:
       stderr:           # standard error sink configuration starts here
          channels: DEV

Note: the server start-up messages are still emitted at the start
of the standard error stream even when logging to stderr is
enabled.  This makes it generally difficult to automate integration
with log analyzers. Generally, we recommend operators to either use
file logging or native network logging instead of using standard
error when integrating with automated monitoring software.

Note: it is not possible to enable the "redactable" parameter on
the stderr sink if the "capture-stray-errors" functionality
(i.e. capturing stray error information to files) is disabled.

This is because when "capture-stray-errors" is disabled, the
process' standard error stream can contain an arbitrary
interleaving of logging events and stray errors; in particular, it
is possible for stray error output to interfere with redaction
markers and remove the guarantees that information outside of
redaction markers does not contain sensitive information.

Note: for a similar reason, no guarantees of parsability of the output
format is available when the "capture-stray-errors" functionality
is disabled, since the standard error stream can then contain an
arbitrary interleaving of non-formatted error data.



Type-specific configuration options:

| Field | Description |
|--|--|
| `channels` | the list of logging channels that use this sink. See the [channel selection configuration](#channel-format) section for details.  |
| `no-color` | forces the omission of VT color codes in the output even when stderr is a terminal. |


Configuration options shared across all sink types:

| Field | Description |
|--|--|
| `filter` | the minimum severity for log events to be emitted to this sink. This can be set to NONE to disable the sink. |
| `format` | the entry format to use. |
| `redact` | whether to strip sensitive information before log events are emitted to this sink. |
| `redactable` | whether to keep redaction markers in the sink's output. The presence of redaction markers makes it possible to strip sensitive data reliably. |
| `exit-on-error` | whether the logging system should terminate the process if an error is encountered while writing to this sink. |
| `auditable` | translated to tweaks to the other settings for this sink during validation. For example, it enables `exit-on-error` and changes the format of files from `crdb-v1` to `crdb-v1-count`. |




<a name="channel-format">
## Channel selection configuration

Each sink can select multiple channels. The names of selected channels can
be specified as a YAML array or as a string.

Example configurations:

    # Select just these two channels. Space is important.
    channels: [OPS, HEALTH]

    # The selection is case insensitive.
    channels: [ops, HeAlTh]

    # same configuration, as a yaml string. Avoid space around comma
    # if using the YAML "flowed" format.
    channels: OPS,HEALTH

    # same, as a quoted string.
    channels: 'OPS, HEALTH'

    # Same using a multi-line YAML array.
    channels:
    - OPS
    - HEALTH

It is also possible to select all channels, with the "all" keyword.
For example:

    channels: all
    channels: 'all'
    channels: [all]
    channels: ['all']

It is also possible to select all channels except for a subset, using the
"all except" keyword prefix. This makes it possible to define sinks
that capture "everything else". For example:

    channels: all except ops,health
    channels: all except [ops,health]
    channels: 'all except ops, health'
    channels: 'all except [ops, health]'

